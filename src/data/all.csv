summary,description,Security,Performance
Add additional transition states,For running a server (daemon)  the current states are: START and STARTED. It would be nice to have transition state: STARTING  and STOPPING.,0 ,0 
Preserve cluster id  blueprint name  and blueprint revision in agent local disk,After agent execute commands on behave of the controller  agent should store cluster id  blueprint name and blueprint revision in the local disk to keep track of the current deployment state on the agent.,0 ,0 
Agent should retry heartbeat message  if controller did not receive the heartbeat,If the heartbeat was not received correctly by the controller  then it should retry.,0 ,0 
Remove agent entities beans from public schema xsd,Agent entities beans are located ambari-client: org.apache.ambari.common.rest.entities.agent. Hence  schema xsd generation for public rest api will include agent entities beans. We should move it to org.apache.ambari.common.rest.agent to exclude agent entities to expose to public.,0 ,0 
Check for NN safemode during restarts,There is no checks for safemode when we reconfigure the cluster.,0 ,0 
Dependency of templeton on hcat client,hcat client should be installed at the templeton server node.,0 ,0 
Remove import of mysql puppet module from manifest.,Remove import of mysql puppet module from manifest because this module is deprecated.,0 ,0 
Add check to verify jdk path after install,After the jdk install  we do not validate the path. This causes problems during service start in later stages.,0 ,0 
PHP Notice: Undefined variable: manifest in /usr/share/hmc/php/puppet/genmanifest/hostsConfig.php,Undefined variable used.,0 ,0 
Support filtering hosts based on discovery status,Api to get hosts should allow filtering out bad hosts,0 ,0 
Alert table on the right needs to be tied visually/verbally to the context/content it is displaying,Currently in Dashboard when service entry is clicked  right side alerts table caption does not indicate that it is showing alerts related to that service. So Cpation of the table should change indicating the corresponding service name.,0 ,0 
Remove the word alert from all the Nagios alerts descriptions.,IT is sort of redundant..,0 ,0 
Make the daemon names and other field names consistent,Following names need to be consistent: Hdfs -&gt; HDFS Mapreduce -&gt; MapReduce Zookeeper -&gt; ZooKeeper HADOOP -&gt; Hadoop,0 ,0 
Enable LZO should show checkbox instead of text,Currently the enable lzo option shows a text box that needs to be filled with true/false. Changing the UI element to checkbox.,0 ,0 
Increase puppet agent timeout.,Puppet agent timeout should be increases as sometimes (possibly due to a bug in ruby) puppet master takes long time to compile and send back the catalog.,0 ,0 
Refactor puppet kick loop to easily change retries and timeouts.,Refactor puppet kick loop to easily change retries and timeouts.,0 ,1 
Support data cleanup if installation fails.,We need to support data cleanup so that a cluster can be re-installed in case of failures.,0 ,0 
Replace index.php with clusters.php,Like the title says: overwrite index.php with the contents of clusters.php  making sure to add a link to the AddNodesWizard as well.,0 ,0 
Uninstall support from UI,Uninstall/wipeout support from UI.,0 ,0 
Remove 'Playground' files from HMC,There's a bunch of (temporary playground) files that got wrongly committed to the HMC codebase  so this is to remove all of them and get things into a cleaner state (at least on the face of things).,0 ,0 
Support uninstall state in mysql modules,Currently  there is no support for uninstall of mysql package.,0 ,0 
Rename/Relocate files as appropriate,There's some images in the html/ directory (that should be in images/)  there's .html files whose extension should be changed to .htmli  and such  that would be nice to clean up.,0 ,0 
Update hive config to enable authorization,In /etc/hive/conf/hive-site.xml&lt;property&gt; &lt;name&gt;hive.security.authorization.enabled&lt;/name&gt; &lt;value&gt;true&lt;/value&gt; &lt;description&gt;enable or disable the hive client authorization&lt;/description&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;hive.security.authorization.manager&lt;/name&gt; &lt;value&gt;org.apache.hcatalog.security.HdfsAuthorizationProvider&lt;/value&gt; &lt;description&gt;the hive client authorization manager class name. The user defined authorization class should implement interface org.apache.hadoop.hive.ql.security.authorization.HiveAuthorizationProvider. &lt;/description&gt;&lt;/property&gt;In /etc/hive/conf/hive-env.sh  add -export HIVE_AUX_JARS_PATH=/usr/lib/hcatalog/share/hcatalog/hcatalog-0.4.0.jar,0 ,0 
Manage services section will have any empty section when no client only components installed,On the manage services page we have a section for client only services that have no long running processes.If the user has no such component there is a heading but no content. Maybe we can hide the heading when no such service is present.,0 ,0 
Init Wizard: Advanced Config validation errors can be bypassed,Make the Naigos password (and re-type password) different so as you cause a validation error.This will let the user move on to the next screen by ignoring all other validation errors on this page.,0 ,0 
Nagios Admin Contact should be checked to ensure it is always an email address,,0 ,0 
Templeton data on hdfs needs to be readable by all users,Content of /user/templeton dir-bash-3.2$ hadoop dfs -ls /user/templetonFound 4 items-rw-r--r-- 3 templeton hdfs 107373 2012-05-14 19:53 /user/templeton/hadoop-streaming.jar-rw------- 3 templeton hdfs 35352096 2012-05-14 19:53 /user/templeton/hive.tar.gz-rw------- 3 templeton hdfs 47909478 2012-05-14 19:53 /user/templeton/pig.tar.gz-rw------- 3 templeton hdfs 127652 2012-05-14 19:53 /user/templeton/ugi.jarOnly templeton user can use the jars,0 ,0 
Update HDFS parameter configuration description,Updating the short description and tooltip long description as follows:Changing the text that affects WebUI as follows: filesystem -&gt; file system HDFS Append Enabled -&gt; Append enabled HDFS WebHDFS Enabled -&gt; WebHDFS enabled Hadoop maximum Java heap size -&gt; Hadoop maximum Java heap size (MB)  Java Heap Size for slave daemons -&gt; Maximum Java heap size for daemons such as Balancer in MB (-Xmx)   NameNode maximum Java heap size -&gt; NameNode initial Java heap size (MB)  Java Heap Size for NameNode -&gt; Initial and minimum Java heap size for NameNode in MB (-Xms)   Hadoop Young Generation heap size -&gt; NameNode new generation size (MB)  Maximum size for New Generation for java heap size -&gt; Default size of Java new generation in MB for NameNode (-XX:NewSize)   DataNode Java heap size -&gt; DataNode maximum Java heap size (MB)  Java Heap Size for DataNode -&gt; Maximum Java heap size for DataNode in MB (-Xmx),0 ,0 
Cleanup of utilities,We need an api for the UI to figure out the status of the cluster.,0 ,0 
Fixup review and deploy rendering,Currently render of the review and deploy page is messy.,0 ,0 
Add link to uninstall on index page,Uninstall link is now hooked into the index page.,0 ,0 
Comment in addNodesWizardInit.js.,Comment in addNodesWizardInit.js.,0 ,0 
HTML being spewed in the Review+Deploy page.,HTML being spewed in the Review+Deploy page.,0 ,0 
Change the status message (success/error) location so that it shows below the page summary box  rather than above  more better visibility,,0 ,0 
regionservers config in the hbase only has localhost in it,/etc/hbase/conf/regionserver should correctly populate the slaves list,0 ,0 
Upgrade to yui-3.5.1,,0 ,0 
Externalize message resources for the welcome page.  Update styles on various pages.,,0 ,0 
Uninstall's wipe flag should be correctly passed to puppet,,0 ,0 
Grid mount points page doesn't let one pass with only a custom mount point,,0 ,0 
Scale puppet master to large number of nodes.,Scale puppet master to large number of nodes.,0 ,0 
During any process in the cluster initialization wizard  if the user goes back to the '1 Create Cluster' tab  the user is stuck.,,0 ,0 
Dependencies should be added only during install phase,Host level dependencies are being set in running stage as well  which is redundant. It can be assumed that dependencies were installed at install stage.,0 ,0 
Provide a way to resume if browser crashes/is closed during the deploy-in-progress,Currently when the browser is closed one cannot view the install in progress. They will have to look at the logs on the hmc machine to figure out whats going on. It would be nice if we can provide a way to get back to the install progress.,0 ,0 
Redundant downloads even though the artifacts are already installed,Artifacts (such as mysql-connector.zip  hive.tar.gz  pig.tar.gz  ext.zip) are being downloaded even though they are previously installed leading to additional execution time.,0 ,0 
Cluster status update needs to happen for all stages of installation wizard.,Cluster status should be updated in db for each stage of the installation wizard. This is used to enable restart of browser and also showing status of the cluster on the index page.,0 ,0 
Making transitionToNextStage more robust,If the currentStage is null  we should not proceed with a transition.,0 ,0 
Logging in case of error during uninstall needs to be fixed.,Logs disappear post uninstall because the transaction is also cleaned from the db.,0 ,0 
Add flow control - force redirects to appropriate pages based on cluster configuration status for better usability,If no cluster has been set up yet  redirect to the welcome page.If a cluster is being configured (but has not gone thru deployment)  redirect to Step 1 of the cluster init wizard.If a cluster is being deployed  redirect to the deployment progress page.If a cluster has gone thru deployment but failed  redirect to the re-install page.If a cluster has gone thru deployment and succeed  do not perform any forced redirect.,0 ,0 
Redesign master service assignment page so that it takes up less vertical space,,0 ,0 
Create lock file as part of rpm install,Lock file is being created as part of create cluster. This is brittle and needs to be done as part of the rpm install.,0 ,0 
Package up the fonts/ subdirectory in the HMC RPM,The new fonts/ subdirectory used for the buttons on the ManageServices page isn't packaged up.,0 ,0 
Improve Service Management page and general popup styling,,0 ,0 
Mysql packages not being sent during install and uninstall,Mysql packages not being sent during install and uninstall.,0 ,0 
Uninstall does not handle component dependencies.,Uninstall does not handle component dependencies.,0 ,0 
On Single Node install when install all the components the recommended num for Map/Reduce Tasks is too high,Use lower count of maps/reduce slots for a single node install.,0 ,0 
ZooKeeper myid files not existent on ZK install.,ZooKeeper myid files not existent on ZK install.,0 ,0 
Add nodes fails to find node in db,Host not found in db error on assign nodes page,0 ,0 
Cannot uninstall - the page hangs with the spinning icon,,0 ,0 
Manual config changes for nn get reset on stop/start from hmc,Manual config changes for nn get reset on stop/start from hmc,0 ,0 
Completing successful add node takes one to initialize cluster page starting from scratch,,0 ,0 
Unify the top nav for both Monitoring and Cluster Management,,0 ,0 
Add rpm spec for hmc agent.,Add rpm spec for hmc agent.,0 ,0 
Reset service back to original state after reconfiguration,,0 ,0 
Improve style on error log popups,,0 ,0 
Reinstall of cluster after failure to install results in failure,According to Bikas:I tried to install a single node cluster. That failed for some random issue.I was presented an option to reinstall.I clicked on that option and it asked me to uninstall.I chose uninstall and wipe data option.Uninstall failed.This happened because the install did not complete in the first place.Thu May 24 17:45:28 -0400 2012 /Stage17/Hdp-oozie::Service/Hdp-oozie::Service::Createsymlinks/usr/lib/oozie/oozie-server/lib/mapred-site.xml/File/usr/lib/oozie/oozie-server/lib/mapred-site.xml/ensure (err): change from absent to present failed: Could not set 'present on ensure: No such file or directory - /usr/lib/oozie/oozie-server/lib/mapred-site.xml at /etc/puppet/agent/modules/hdp-oozie/manifests/service.pp:61,0 ,0 
Fix bug with jmx parsing on HBase.,Fix bug with jmx parsing on HBase.,0 ,0 
Using service stop instead of killall for uninstall,,0 ,0 
Uninstall needs to update status for failure.,This is to enable the routing layer to redirect appropriately.,0 ,0 
Duplicate definition: Class[Hdp-hbase::Regionserver::Enable-ganglia],Duplicate definition: Class&#91;Hdp-hbase::Regionserver::Enable-ganglia&#93; is already defined; cannot redefine at /etc/puppet/agent/modules/hdp-ganglia/manifests/monitor.pp:37 on node ip-10-64-19-248.ec2.internal,0 ,0 
Post cluster install/deploy the URL hmc/html/initializeCluster.php should be disabled,Install a cluster. Then go to http://&lt;host&gt;/hmc/html/initializeCluster.php URL. You get a page enter cluster name. If you enter a cluster name  existing install is wiped out. We need to disable this URL on an installed cluster.Only way to enable this should be uninstall.,0 ,0 
Boldify/Redify restart HMC message when nagios/ganglia is on the hmc host,,0 ,0 
nagios shows service status critical if hbase is not installed,,0 ,0 
Add nodes page alerts removed in case of adding duplicate nodes,Alerts that are being shown needs to be changed to be compatible with current implementation of showing errors. A link now appears to 'Show the duplicate nodes' which shows the duplicate nodes.,0 ,0 
Fix hive stop to escape $.,,0 ,0 
Post-Install Add Nodes - update progress title and success/error messages to reflect what it's actually doing/has done,,0 ,0 
Add missing JS file for making post cluster install Add Nodes work,,0 ,0 
Show the same welcome page to the user if the user starts configuring a cluster but has not started deploy yet,,0 ,0 
Add Node installs MySQL Server for Hive,Adding slave nodes post cluster install will install MySQL Server if Hive was selected as a service at the time of cluster installation.,0 ,0 
Manage service needs a way to recover from terminated browser sessions,We need to block users from being able to start/stop services when we have a batch of start/stop activities are already in progress.Do something similar to deployment progress display and bring the user back to that modal status display which will end when we detect success/failure.,0 ,0 
Service Reconfiguration screens should respect the 'reconfigurable' attributes set in ConfigProperties table,Some service config parameters are editable (can be customized on initial install)  but cannot be reconfigured post cluster install.This info is stored in ConfigProperties table  but the Service Reconfiguration screens are allowing these non-reconfigurable parameters to be changed.,0 ,0 
make support for os check a bit more robust,,0 ,0 
Add rack_info as column in Hosts table,,0 ,0 
Fix node assignments not not allow slaves on master.,,1 ,0 
Speed up page load/reload times,,0 ,0 
Support Resume For Add Nodes,Just like for Manage Services + Deploy + Uninstall.,0 ,0 
Modify the router to force redirection to 'Add Nodes Progress' popup,,0 ,0 
Fix puppet manifests for tarball downloads via rpms.,,0 ,0 
update to fix the ganglia monitor_and_server anchor problem,update to fix the ganglia monitor_and_server anchor problem,0 ,0 
Fix oozie smoke test failure,Oozie smoke test failing with 'Error: E0301 : E0301: Invalid resource &#91;usr/lib/oozie/conf&#93;',0 ,0 
Fix Advanced Config: HDFS reserved space is in bytes. Too many bytes to count.,Simplify user input.,0 ,0 
Create a spec file with less dependencies for HMC,Simplify process for users that want to use different dependencies for PHP and Ruby.e.g PHP-5.3  ruby-1.8.7,0 ,0 
Rpm naming needs to be corrected.,Rpm naming needs to be corrected.,0 ,0 
Templeton configs for pig archive not correct in HMC,From Arpit:The configs for pig in templeton are wrong.The deployed configs are&lt;property&gt; &lt;name&gt;templeton.pig.archive&lt;/name&gt; &lt;value&gt;hdfs:///apps/templeton/&lt;/value&gt; &lt;description&gt;The path to the Pig archive.&lt;/description&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;templeton.pig.path&lt;/name&gt; &lt;value&gt;/pig-0.9.2/bin/pig&lt;/value&gt; &lt;description&gt;The path to the Pig executable.&lt;/description&gt; &lt;/property&gt;They are missing the pig tar ball. For example they should be&lt;property&gt; &lt;name&gt;templeton.pig.archive&lt;/name&gt; &lt;value&gt;hdfs:///apps/templeton/pig.tar.gz&lt;/value&gt; &lt;description&gt;The path to the Pig archive.&lt;/description&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;templeton.pig.path&lt;/name&gt; &lt;value&gt;pig.tar.gz/pig-0.9.2/bin/pig&lt;/value&gt; &lt;description&gt;The path to the Pig executable.&lt;/description&gt; &lt;/property&gt;So both the properties are missing 'pig-0.9.2.tar.gz',0 ,0 
Puppet fails to install 32-bit JDK properly on RHEL6,mkdir -p /usr/jdk32 ; chmod +x /tmp/HDP-artifacts//jdk-6u31-linux-i586.bin; cd /usr/jdk32 ; echo A | /tmp/HDP-artifacts//jdk-6u31-linux-i586.bin -noregister 2&gt;&amp;1Unpacking...Checksumming...Extracting.../var/www/html/downloads/jdk-6u31-linux-i586.bin: ./install.sfx.1794: /lib/ld-linux.so.2: bad ELF interpreter: No such file or directoryFailed to extract the files. Please refer to the Troubleshooting section ofthe Installation Instructions on the download page for more information.Puppet should ensure glibc.i686 is installed before trying to install jdk.,0 ,0 
Change os type check during node bootstrap to allow RHEL6 or CentOS6 nodes,hmc/php/frontend/addNodes/verifyAndUpdateNodesInfo.php hardcodes checks to only allow rhel5 or centos5 nodes.,0 ,0 
Puppet agent install script should use correct epel repo,hmc/ShellScripts/puppet_agent_install.sh hardcodes to epel-release rpm for CentOS-5.4. Should be more intelligent to handle different OS types.,0 ,0 
Add support to jump to a specified state in the wizard for development purposes,,0 ,0 
Update README to point to trunk,We need to fix the README to point to trunk after the merge of ambari-186 branch.,0 ,0 
Remove YUI source files from SVN,Currently YUI 3.5.1 source files are in SVN.We don't really need to have them checked into SVN as we don't track changes. We are pre-concatenating and minifying the YUI js files  so we don't need the files to run Ambari anyhow.We should just remove them from SVN and instead just checkin the tarball.,0 ,0 
Update documentation,Modify pom.xml to create output files under ../site  rather than ./target.Make minor wording modifications.,0 ,0 
Nagios install fails on RHEL6,Puppet layer  when trying to install nagios  tries to install php-pecl-json when it is not needed and fails when trying to do so. On RHEL6  php-5.3 is default which has the json module built into it.,0 ,0 
Consolidate head tags for organization and combine CSS files for faster load,,0 ,1 
Puppet error: Cannot reassign variable zookeeper_hosts at modules/hdp/manifests/params.pp:47,Seems like a typo: $zookeeper_hosts = hdp_default('zookeeper_hosts')Should be $public_zookeeper_hosts,0 ,0 
In Custom config for Nagios: emails with multiple periods before the '@' fails validation,,0 ,0 
Custom Config page: don't allow form submission if there are client-side validation errors,Currently the button looks disabled when there are client-side validation errors  but it is clickable. This is a problem because there is no server-side validation to make sure that the passwords match.,1 ,0 
special characters in hosts files created on some common windows editors causes issues,,0 ,0 
Rat compliance patch,Adding apache license to all the files within Ambari for rat tool compliance.,0 ,0 
Externalize the manager service name and point the Help link to a valid URL,The master role assignment page (Step 5 of install) and the cluster topology summary page are referencing the manager service name as 'HMC Server'. This needs to be changed to 'Ambari' server.The post-install success message on a single-node install has the same issue.Currently  the Help link in the top nav launches a new tab and loads the page that the user is on. Instead  load the Help page on Ambari project website (for now  we'll point it to the Install Guide as a placeholder).,0 ,0 
License header for PHP files should use PHP comments  not HTML comments,Some PHP files have the HTML-style comments. This is problematic sincethe license headers are becoming part of the HTML response. Worse yet  the headers are repeated multiple times in the response. This can also cause unexpected behavior.,0 ,0 
Add a link to NOTICE file on every page,This is so that stuff with different compatible licenses can be attributed appropriately.,0 ,0 
Remove /usr/bin/php dependency from the rpm's,,0 ,0 
Fix lzo installs to work correctly on RHEL6,,0 ,0 
Increase puppet timeouts to handle single-node installs timing out,,0 ,1 
The database set up script has a duplicate definition of AmbariConfig so install fails,,0 ,0 
Eliminate redundant and unused definition for the columns in the table ConfigProperties,ConfigProperties table has a column named 'display_type'.There's also a JSON-encoded 'display_attributes' column.The 'display_attributes' column has the attributes 'isPassword'  'displayType'  and 'noDisplay'. This is duplicate information is already stored by the 'display_type' column so these attributes are not needed.Upon inspecting the code  these attributes are not used so changing them have no effect. We should simply get rid of these attributes.,0 ,0 
hdp-nagios and hdp-monitoring has wrong configuration file location  also owner:group permissions are wrong.,Suse environment has wrong configuration location for hdp-dashboard and hdp-nagios. Also  owner:group permissions were wrongly set to root:root instead of 'wwwrun' and group is 'www,1 ,0 
Fix invalid HTML markup on Monitoring Dashboard,,0 ,0 
Add Nodes Progress: for partial failure that lets the user continue  display an orange bar rather than a red bar in the progress popup,,0 ,0 
Support for Hadoop Security (front-end changes),,0 ,0 
Weirdness with Custom Config page when the user goes back to previous stages,Issue 1. Going back and forth between different stages in the Cluster Install Wizard  it is possible to get into a state where Custom Config form has the submit button disabled but no field errors are shown.Steps to replicate: Go up to Stage 6  but do not submit the form Go back to Stage 3 Go up to Stage 6 again. No field errors are shown when they should be.Issue 2. Custom Config stage is skipped once you get to 'Review and Deploy' and go back to a stage preceding Custom Config.Steps to replicate: Go thru the Cluster Install Wizard up to Stage 7 ('Review and Deploy')  but do not submit the form. Go back to Stage 4 or 5. Once you submit the form on Stage 5  Stage 6 is skipped and goes directly to Stage 7. If you go back to Stage 3 or earlier  then Stage 6 will not be skipped.,0 ,0 
Ambari should install yum priorities on all nodes to ensure main repo is picked first,Depending on which main hadoop repo is used to setup the cluster  sometimes  wrong packages may be pulled from add-on repos even if the main repo has a higher priority and has the same package. This can create problems by incompatible dependencies getting installed at times.,0 ,0 
Make puppet generate more logs on command failures,,0 ,0 
Fix ambari agent init.d scripts and the bootstrapping.,,0 ,0 
Ambari does not handle a pre-setup user-supplied Hive Metastore,Ambari treats a Hive Metastore as something that it still needs to install and setup even though it may not have the necessary permissions to do so.,0 ,0 
Change text on alerts 'about XX hours ago',Alerts should have text like :OK for about 17 hoursWARN for about 17 hoursCRIT for about 17 hours,0 ,0 
HDFS disk capacity on dashboard is seen as negative number,Sometimes disk capacity calculations end up in negative numbers.,0 ,0 
Remove files from ambari-web that were not meant to be checked in,ambari-web/node_modules  ambari-web/public  ambari-web/ambari.iml were not meant to be checked in. Must remove.,0 ,0 
dashboard > Summary > capacity pie chart keeps changing colors,,0 ,0 
Create heatmap legend entries for missing data/invalid hosts,Currently we dont fill anything which is ambiguous.,0 ,0 
Switching services does not update various UI elements,When you switch services in the UI  sometimes alerts are mismatched compared to selected service. Also the highlights in left-bar are not working.,0 ,0 
Error handling when errors are encountered during preparation for deploy,Currently  if any errors are encountered during preparation for deploy  the user is taken to the deploy page and the hosts will be shown as 'Waiting' but nothing happens. This is bad UX.At a minimum  we should prevent the user from proceeding and display an appropriate error message if any error is encountered after 'Deploy' is clicked  but before we transition to Step 9.We should also think about how a user can recover from this situation.At this point  the deploy has not initiated  but certain API calls may have succeeded  so we may have incomplete info in the database. Currently there's no convenient way to 'rollback'.We can either ask the user to clean the slate by reinitializing the database and try again (should succeed if the original problem was temporary).We can also build more logic in the UI to retry  check if records already exist  etc...,0 ,0 
Need to be able to reliably recover from the case when the browser is closed during deploy (Step 8 post submission  Step 9) of the wizard,Need to be able to reliably recover from the case when the browser is closed during deploy (Step 8 post submission  Step 9) of the wizard.Even after submitting  Step 10  its taking to Step 9 after browser restart. Ideally it should take to monitoring page.,0 ,0 
User-specified custom configs (such as hdfs-site.xml overrides) should be persisted to maintain what the user specified,,0 ,0 
Install Wizard: Confirm host stuck at Preparing stage,With the install wizard went to assign slaves page successfully  returned back to Welcome page  reentered data and then the UI got stuck at Confirm hosts page.,0 ,0 
Host component live status is broken,When datanode is stopped on a host  its status keeps jumping.,0 ,0 
Ambari heatmaps and host information shows infinity for disk space used,When cluster is started after install  it has disk_total of null which results in Infinity.,0 ,0 
Graphs 'degrade' over time,Leave a page with graphs open for several minutes.The graphs become really coarse.It probably has something to do with the fact that Ganglia only provides 6-minute averages beyond the first 61 minutes (first 61 minutes  Ganglia keeps 15-second samples) and we may not be exactly querying for the last 60 minutes.,0 ,0 
On Notification Popup  clicking 'go to nagios UI' doesn't load nagios UI,1) Cause notification to occur (for example  stop oozie)2) On dashboard  click notification icon3) On the notification popup  click 'go to nagios web UI'4) nothing happens.This issue is on IE9  Safari and Chrome. Works fine on Firefox.,0 ,0 
tmpfs filesystem being added to the list in the dir used by Ambari,I saw this on a sles cluster. On EC2 they have a tmpfs mounted and Ambari picked it up.Not sure what the ideal solution is but i feel tmpfs should not be included in the available mount points.Also the tmpfs is being used in various directories that will have to change during the install.Attached screenshots.,0 ,0 
Installer Wizard - Retry feature in Deploy step (Step 9) is broken,,0 ,0 
Reconfigure fails silently; it's not firing any API calls due to a JS error,,0 ,0 
Host jams in status 'Preparing' if host name is wrong,,0 ,0 
The check boxes to check/uncheck one of the members in a multi artifact graphs is not very readable. It should be more apparent on which one the user clicked on,,0 ,0 
Check the log/run dir locations to make sure its an abs path,,0 ,0 
Disk Info Metrics and memory usage sometimes do not show up for an hour or so.,Disk Info Metrics and memory usage sometimes do not show up for an hour or so.,0 ,0 
Clean up table header UI for sorting and filter clear 'x' for Hosts table,,0 ,0 
Clean up table header UI for sorting and filter clear 'x' for Jobs table,,0 ,0 
After adding hosts  the host count shown in the Dashboard is incorrect,,0 ,0 
Detailed log view dialogs are not center-aligned,,0 ,0 
Automatically update host-level popup info/logs,For host-level popup info/logs that appear during the deploy step (Step 9) of the Install and Add Hosts Wizards  the information shown is not automatically updated based on the latest values in the models when the background poller updates the models.Currently  the user needs to close the popup and then re-open to see the updated info.,0 ,0 
Remove /hdp as the httpd conf for any of the nagios urls - should replace it with ambarinagios or something else.,Remove /hdp as the httpd conf for any of the nagios urls - should replace it with ambarinagios or something else.,0 ,0 
Allow capacity scheduler to be attached to host role configs for CS configurability in the API's.,Allow capacity scheduler to be attached to host role configs for CS configurability in the API's.,0 ,0 
In any starts fails  'warn' the host and the overall install,If any service start fails  'warn' the host and 'warn' the overall install.Allow the other start tasks to complete.Allow the user to click next.,0 ,0 
Add filters module,,0 ,0 
Refactor Job Browser User filter,,0 ,0 
Confirm Hosts page: It looks like hosts disappear if you are on 'Fail' filter and click on 'Retry Failed' button,,0 ,0 
Drop the 'all' option from Hosts > Component Filter and Jobs > Users Filter,,0 ,0 
Dashboard - make disk usage pie chart in HDFS summary easier to understand,,0 ,0 
Replace sudo with su in the ambari setup script since ambari server setup is already run as root.,Replace sudo with su in the ambari setup script since ambari server setup is already run as root.,0 ,0 
Directory permissions on httpd /var/www/cgi-bin should not be touched by Ambari.,Directory permissions on httpd /var/www/cgi-bin should not be touched by Ambari.,1 ,0 
Host health indicator should have a tooltip showing details,,0 ,0 
Install Options - line up the Target Hosts section with the rest of the page,,0 ,0 
Use ember-precompiler-brunch npm plugin,Use the Ember Handlebars precompiler plugin (ember-precompiler-brunch) that's in the NPM registry so that we can specify a specific plugin version to use in package.json  rather than the current plugin that Ambari Web uses (which is not in the NPM registry - it is retrieved from a git repo and Ambari Web can break if the plugin gets updated).,0 ,0 
Fix the host roles live status not go back to INSTALLED if it was in START_FAILED state.,Fix the host roles live status not go back to INSTALLED if it was in START_FAILED state.,0 ,0 
Remove hard coded JMX port mappings,The JMXPropertyProvider contains a map of component names to ports ... JMX_PORTS.put('NAMENODE'  '50070'); JMX_PORTS.put('DATANODE'  '50075'); JMX_PORTS.put('JOBTRACKER'  '50030'); JMX_PORTS.put('TASKTRACKER'  '50060'); JMX_PORTS.put('HBASE_MASTER'  '60010');These ports can change in configuration. Need to create the mapping dynamically.This is required for secure HDP cluster to work.,0 ,0 
Service graphs refresh with spinners,Service graphs are refreshing with spinners  rather than simply shifting to the left.See the attached movie clip.,0 ,0 
Job Browser - Filter by Input  output and duration,&lt;expression&gt; ::= [&lt;operator&gt;] [&lt;whitespace&gt;]* &lt;value&gt; [&lt;duration-unit&gt; | &lt;io-unit&gt;]&lt;operator&gt; ::= '&gt;' | '&lt;' | '='&lt;whitespace&gt; ::= ' '&lt;value&gt; :== int | float&lt;duration-unit&gt; ::= 's' | 'm' | 'h'&lt;io-unit&gt; ::= 'k' | 'kb' | 'm' | 'mb' | 'g' | 'gb'If &lt;operator&gt; is ommitted  '=' is assumed.If &lt;duration-unit&gt; is omitted  's' is assumed.If &lt;io-unit&gt; is omitted  'k' is assumed.&lt;duration-unit&gt; and &lt;io-unit&gt; are case-insensitive.,0 ,0 
Agent checks packages as part of host check but doesn't tell which ones are needed or conflicting,Agent checks packages as part of host check but doesn't tell which ones are needed or conflicting,0 ,0 
Store example Hive Queries somewhere in Ambari that's easily accessible for demo/test purposes,Store example Hive Queries somewhere in Ambari that's easily accessible for demo/test purposes,0 ,0 
On Confirm Hosts page  add a link to show the Host Checks popup in the success message,,0 ,0 
Edit User: No error message is shown when the user does not enter the correct 'old password',No error message is shown when the user does not enter the correct 'old password' when editing an user.,0 ,0 
Shrink top nav height,Navbar's height should be shrunk to ~40px.,0 ,0 
Incorrect displaying 'Background operations' window after changing state of component,Steps:1. Change state (start/stop operations are preferable) for lot of components so that the number of background operations was approximately 20-30;2. Change size of browser (800-900 px);3. Go to down of page;4. Change state for next component;5. Confirm changing;Result:'Background operations' window was opened  but it 'OK' button is not visible.Expected result:'Background operations' window contains scroll bar for all background operations. 'OK' button is available for using.,0 ,0 
Failing build due to url moved on Suse.,Failing build due to url moved on Suse. Looks like centos5 and 6 handle redirection all fine but doesnt look like the maven plugin handles that on SUSE.,0 ,0 
Make sure that Ambari Web renders all elements correctly when the browser width is 1024px or narrower,Current behavior is to dynamically layout elements as the browser viewport size changes. This causes elements to overlap  go outside the bounding box  positioned in a weird way  etc.Let's set minimum width to be 1024px (or maybe 980px to account for the scrollbar) and make sure that all elements are laid out correctly.Bigger than 1024px should still utilize more screen space as it does today.,0 ,0 
Bootstrap can hang indefinitely,I was bootstrapping 4 nodes. One of them got stuck in 'Installing' phase and won't time out even after ~30 minutes.It seems like starting of ambari-agent was hanging.,0 ,0 
Service status / host component status can get stuck in the green blinking state if stop fails - no further operation can be performed,This happens when a service/host component is running  but stop fails. This leaves the desired_state in the INSTALLED (i.e.  STOPPED) state  while the live state is STARTED.Currently  UI assumes when desired_state==INSTALLED and state==STARTED  it is STARTING. This was a trick to get around the problem of backend live state update lagging and to make UI more responsive.,0 ,0 
Make sure that Ambari Web renders all elements correctly when the browser width is 1024px or narrower (refactor),Current behavior is to dynamically layout elements as the browser viewport size changes. This causes elements to overlap  go outside the bounding box  positioned in a weird way  etc.Let's set minimum width to be 1024px (or maybe 980px to account for the scrollbar) and make sure that all elements are laid out correctly.Bigger than 1024px should still utilize more screen space as it does today.,0 ,0 
Properly display Apps page aggregate summary and data table when there are no data to be shown,,0 ,0 
Remove all text from Apps views  controllers  templates to messages.js,,0 ,0 
Host health indicator should have a tooltip showing few details (refactoring),,0 ,0 
Switching out of Jobs page does not launch popup anymore,On the jobs page click on Job-X and see the popup with all the job information. Now switch to Services page and come back to the jobs page. Now clicking on Job-X will not launch popup.,0 ,0 
Cluster missing hosts after successful install and restart.,Cluster missing hosts after successful install and restart. This bug got introduced due to my patch in AMBARI-1301.,0 ,0 
Add username validation for Ambari local users,,0 ,0 
Show validation error when the user specifies target hosts that are already part of the cluster,,0 ,0 
Refactor Job Browser filter,,0 ,0 
Enhance Install/Start/Test progress display,When we are showing progress for cluster install  it takes a while for any of the host-level or overall progress to show any progress completion percentage (they can get stuck at 0% for several minutes). This is because host-level completion is not displayed until the first install task for the task is complete. Instead  we should advance percentage complete when the tasks changes the status (from PENDING-&gt;QUEUED-&gt;IN_PROGRESS) to better reflect the install progress to the end user.,0 ,0 
Service Check fails after secure install due to wrong kinit path,For manually installed kdc  the kinit path in the puppet script is /usr/kerberos/bin/kinitActual location:root@ip-10-38-13-250 data]# whereis kinitkinit: /usr/bin/kiniterr: /Stage&#91;2&#93;/Hdp-hbase::Hbase::Service_check/Hdp-hadoop::Exec-hadoop&#91;hbase::service_check::test&#93;/Hdp::Exec&#91;/usr/kerberos/bin/kinit -kt /etc/security/keytabs/hdfs.headless.keytab hdfs; hadoop --config /etc/hadoop/conf fs -test -e /apps/hbase/data/usertable&#93;/Exec&#91;/usr/kerberos/bin/kinit -kt /etc/security/keytabs/hdfs.headless.keytab hdfs; hadoop --config /etc/hadoop/conf fs -test -e /apps/hbase/data/usertable&#93;: Failed to call refresh: Could not find command '/usr/kerberos/bin/kinit',0 ,0 
Externalize strings to messages.js,Externalize string resources to messages.js.,0 ,0 
Provide consistent ordering of hosts in heatmap,,0 ,0 
'No alerts' badge on the Host Detail page should be green  not red,,0 ,0 
App Browser rows colours should alternate from dark grey to light grey and back,,0 ,0 
Mouse cursor hover behavior is strange on Job Browser,When hovering the mouse cursor around Show All  Filtered  the mouse cursor changes to the 'hand' icon as expected. To the right  the cursor turns into a hand even when hovering over areas where there's no link. Hovering over 'Clear filters'  the cursor does not turn into the 'hand'.,0 ,0 
Since there is the ability to log in to Ambari Web as different users the current user should be indicated,,0 ,0 
Wrong calculation of duration filter on apps page,Wrong calculation for the duration filter if we enter just number  without h  m or s to specify the unit. By default we should take seconds as the default unit.,0 ,0 
Ambari Agent registration hangs due to Acceptor bug in Jetty for not reading through accepted connections.,Ambari Agent registration hangs due to Acceptor bug in Jetty for not reading through accepted connections.,0 ,0 
Validation for username used in service configs is broken,,1 ,0 
Failure popup shown for reconfiguring HDFS when MapReduce is not installed,,0 ,0 
Remove hard-coded stack version,,0 ,0 
Cannot proceed after bootstrapping in some cases due to a run-time error while running host checks,,0 ,0 
Optimize query call for retrieving host information,Every 15 seconds  Ambari Web makes a call to retrieve information about all hosts in the cluster. With 400+ nodes  this call retrieves about 10MB of info  since the API returns last_agent_env  which is host check results used during bootstrap and makes the payload huge.By optimizing the query string for this API call  we can cut down on the payload by more than 90%.,0 ,1 
Optimize query for getting service and host component status back from the server,The API response for getting service/host component status back from the server is unnecessarily big due to nagios_alerts being included as part of the response. This optimization can cut the payload in half or more  and also eases load on the server since it does not have to get Nagios alerts as part of fulfilling the API call.,0 ,1 
Minimize Read and Write locks for createHosts,Invocation count and exec time for ClustersImpl.mapHostToCluser very highorg.apache.ambari.server.state.cluster.ClustersImpl.mapHostToCluster(String  String) Time(ms): 252 925 Avg Time(ms): 5 269 Own Time(ms): 211Invocation Count: 48Each time host is mapped to cluster we refresh the entity manager. This results in the createHosts call taking excess of 10 minutes,0 ,1 
Optimize ganglia rrd script to be able to respond within reasonable time to queries made by the UI.,Optimize ganglia rrd script to be able to respond within reasonable time to queries made by the UI.,0 ,1 
Further optimization of querying host information from the server,Further work on optimizing query for getting host information on top of BUG-1460.,0 ,0 
Fix TestHostName to take care of issues when gethostname and getfqdn do not match.,Fix TestHostName to take care of issues when gethostname and getfqdn do not match.,0 ,0 
Fix alerts at host level if MapReduce is not selected not to alert for tasktrackers not running.,Fix alerts at host level if MapReduce is not selected not to alert for tasktrackers not running.,0 ,0 
Nagios script causes unwanted  Datanode logs.,Nagios script causes unwanted Datanode logs.,0 ,0 
Add hadoop-lzo to be one of the rpms to check for before installation.,Add hadoop-lzo to be one of the rpms to check for before installation.,0 ,0 
Make all service properties reconfigurable.,,0 ,0 
Fix start up option for ambari-server where there is a missing space.,Fix start up option for ambari-server where there is a missing space.,0 ,0 
Add hosts is broken,This is due to performance enhancements for querying hosts.Hosts/disk_info for the hosts being added is expected in the Add Hosts wizard  but it is now missing.,0 ,1 
Hosts page: add filtering by host status,Show the host status filter at the top of the Hosts table  showing the status and the number of hosts in that status.,0 ,0 
Ambari Web goes back and forth between frozen and usable state peridocially on a large cluster,The background polling to update the live status of services and host components runs every 6 seconds. When this happens  the whole UI freezes for several seconds periodically.,0 ,1 
Alerts take around 20-30 seconds to show up everytime you refresh the dashboard.,Alerts take around 20-30 seconds to show up everytime you refresh the dashboard.,0 ,1 
Hosts page layout fixes,1.Use Bootstrap-style tooltip for the hover tooltip on the host status dots as well as the disk usage bars. The current tooltip does not show up unless you rest your mouse cursor for more than a second - users will simply assume there's no tooltip hover when quickly moving the mouse cursor over them.2.We can kill some space between the status dots and the hostnames in the table as well.3.Also  there is too much margin at the top compared to the rest of the pages.,0 ,0 
Constrain the width of all wizard popups,Currently  the popup for any wizard resizes to fill up the width of the browser width with some horizontal margin. Vertically  it resizes to fit the height of the content; in some cases  it looks really silly on a wide screen.We should specify the max width of the wizard popup. Ambari Web supports two width configurations (wide and narrow)  so the wizard popup should look good in these two configurations.,0 ,0 
Jobs failed count always returns 0 in the jobtracker API metrics,See the attachments  but after running both successful and failed MapReduce jobs  the jobs submitted count includes all jobs  the jobs successful appears correct  but the jobs failed count is still 0.,0 ,0 
Stack Upgrade Wizard - resume upon page refresh / login,,0 ,0 
Host progress popup - generic component for showing progress on async operations,This is for the popup that shows up upon clicking already-performed or currently-in-progress async operations.We should take what we already have for host-level popup in Step 9 as a base and make it reusable  with a new higher level showing all hosts.,0 ,0 
Cannot start hadoop services after hdfs re-configuration and amabri server restart.,Cannot start hadoop services after several restarts since the agents.,0 ,0 
Templeton smoke test fails for secure cluster,Templeton start fails due to multiple errors.[0;36mnotice: /Stage&#91;2&#93;/Hdp-templeton::Copy-hdfs-directories/Hdp-hadoop::Hdfs::Copyfromlocal&#91;/usr/lib/hadoop/contrib/streaming/hadoop-streaming*.jar&#93;/Hdp-hadoop::Exec-hadoop&#91;fs -copyFromLocal /usr/lib/hadoop/contrib/streaming/hadoop-streaming*.jar /apps/webhcat/hadoop-streaming.jar&#93;/Hdp::Exec&#91;/usr/bin/kinit -kt /etc/security/keytabs/hcat.headless.keytab hcat; hadoop --config /etc/hadoop/conf fs -copyFromLocal /usr/lib/hadoop/contrib/streaming/hadoop-streaming*.jar /apps/webhcat/hadoop-streaming.jar&#93;/Exec&#91;/usr/bin/kinit -kt /etc/security/keytabs/hcat.headless.keytab hcat; hadoop --config /etc/hadoop/conf fs -copyFromLocal /usr/lib/hadoop/contrib/streaming/hadoop-streaming*.jar /apps/webhcat/hadoop-streaming.jar&#93;/returns: kinit: Client not found in Kerberos database while getting initial credentials^[[0m,0 ,0 
Config/Reconfig UI should not allow certain configs to have host-level overrides,,0 ,0 
Security Wizard - integrate host progress popup,,0 ,0 
Some map and reduce task metrics are missing for the tasktrackers in the API,With Ambari 1.2.2  I can窶冲 get the metrics.mapred object to show up for the tasktracker component. Our code is hitting the URL: http://sdll4474.labs.teradata.com:8080/api/v1/clusters/sdll4474.labs.teradata.com/services/MAPREDUCE/components/TASKTRACKER?fields=host_components/*. Here窶冱 one of the objects in the host_components array. Note that the data in metrics.mapred.tasktracker is providing some data I窶况e never seen before. In previous versions we say properties such as reduces_running  reduceTaskSlots  maps_running  etc. in this object. { 'href' : 'http://aster39h1.td.teradata.com:8080/api/v1/clusters/aster39h1.td.teradata.com/hosts/byn001-17/host_components/TASKTRACKER'  'HostRoles' : { 'cluster_name' : 'aster39h1.td.teradata.com'  'desired_state' : 'STARTED'  'state' : 'STARTED'  'component_name' : 'TASKTRACKER'  'service_name' : 'MAPREDUCE'  'host_name' : 'byn001-17' }  'metrics' : { 'boottime' : 1.360089758E9  'process' : { 'proc_total' : 845.211111111  'proc_run' : 0.0 }  'rpc' : { 'rpcAuthorizationSuccesses' : 9  'SentBytes' : 6842  'rpcAuthorizationFailures' : 0  'ReceivedBytes' : 26187  'NumOpenConnections' : 0  'callQueueLen' : 0  'RpcQueueTime_num_ops' : 59  'rpcAuthenticationSuccesses' : 0  'RpcProcessingTime_num_ops' : 59  'rpcAuthenticationFailures' : 0  'RpcProcessingTime_avg_time' : 0.6666666666666666  'RpcQueueTime_avg_time' : 0.0 }  'mapred' : { 'shuffleOutput' : { 'shuffle_success_outputs' : 1  'shuffle_handler_busy_percent' : 0.0  'shuffle_output_bytes' : 1400  'shuffle_failed_outputs' : 0  'shuffle_exceptions_caught' : 0 }  'tasktracker' : { 'ConfigVersion' : 'default'  'HttpPort' : 50060  'TasksInfoJson' : '{/'running/':0 /'failed/':0 /'commit_pending/':0}'  'JobTrackerUrl' : 'aster39h1.td.teradata.com:50300'  'Healthy' : true  'Version' : '1.1.2.22  r'  'Hostname' : 'byn001-17'  'RpcPort' : 48526 } }  'ugi' : { 'loginFailure_num_ops' : 0  'loginSuccess_num_ops' : 0  'loginSuccess_avg_time' : 0.0  'loginFailure_avg_time' : 0.0 }  'disk' : { 'disk_total' : 36841.767  'disk_free' : 36776.9775333  'part_max_used' : 70.7 }  'cpu' : { 'cpu_speed' : 1999.0  'cpu_wio' : 0.0  'cpu_num' : 24.0  'cpu_idle' : 99.8886111111  'cpu_nice' : 0.0  'cpu_aidle' : 0.0  'cpu_system' : 0.1  'cpu_user' : 0.0227777777778 }  'rpcdetailed' : { 'getTask_avg_time' : 1.0  'ping_avg_time' : 0.0  'done_avg_time' : 1.0  'getProtocolVersion_avg_time' : 0.0  'getMapCompletionEvents_avg_time' : 0.0  'done_num_ops' : 9  'getMapCompletionEvents_num_ops' : 6  'canCommit_num_ops' : 6  'ping_num_ops' : 2  'commitPending_avg_time' : 1.0  'statusUpdate_num_ops' : 15  'statusUpdate_avg_time' : 1.0  'getTask_num_ops' : 9  'getProtocolVersion_num_ops' : 9  'commitPending_num_ops' : 3  'canCommit_avg_time' : 0.0 }  'load' : { 'load_fifteen' : 0.0  'load_one' : 0.0  'load_five' : 0.0 }  'jvm' : { 'memHeapCommittedM' : 100.4375  'NonHeapMemoryUsed' : 25214472  'logFatal' : 0  'threadsWaiting' : 17  'gcCount' : 122400  'threadsBlocked' : 0  'HeapMemoryUsed' : 77617416  'logWarn' : 0  'logError' : 0  'HeapMemoryMax' : 954466304  'memNonHeapCommittedM' : 26.125  'memNonHeapUsedM' : 24.046394  'gcTimeMillis' : 81352  'NonHeapMemoryMax' : 136314880  'logInfo' : 3  'memHeapUsedM' : 73.81818  'threadsNew' : 0  'threadsTerminated' : 0  'maxMemoryM' : 758.4375  'threadsTimedWaiting' : 10  'threadsRunnable' : 6 }  'network' : { 'pkts_out' : 111.684472222  'bytes_in' : 1428.83666667  'bytes_out' : 23201.8668056  'pkts_in' : 13.9853333333 }  'memory' : { 'mem_total' : 1.31854096E8  'swap_free' : 6291448.0  'mem_buffers' : 574794.711111  'mem_shared' : 0.0  'swap_total' : 6291448.0  'mem_cached' : 6061952.85556  'mem_free' : 1.23072573378E8 } }  'component' : [ { 'href' : 'http://aster39h1.td.teradata.com:8080/api/v1/clusters/aster39h1.td.teradata.com/services/MAPREDUCE/components/TASKTRACKER'  'ServiceComponentInfo' : { 'cluster_name' : 'aster39h1.td.teradata.com'  'component_name' : 'TASKTRACKER'  'service_name' : 'MAPREDUCE' } } ] },0 ,0 
Undo should not be allowed on component hosts,,0 ,0 
Oozie properties for principal and keytab not read from oozie-site,Oozie principal is create by the UI as oozie/${hostname}@realm.comPuppet script has a bug that does not read this property and uses default 'oozie' as the principal,0 ,0 
Starting all services fails on secure cluster (excluding HBase and ZooKeeper),HDFS service check failure leads to this.After the failure of the 'HDFS service check' task  stage fails. But HDFS comes up.The Ambari server hostname for secure cluster: ec2-54-234-164-5.compute-1.amazonaws.com,0 ,0 
Ambari/GSInstallers need to set the value of mapred.jobtracker.completeuserjobs.maximum,mapred.jobtracker.completeuserjobs.maximum is currently set to 0. This causes issues with failed(/successful) jobs from pig and other job submitters because the references to the failed job is cleared up asap in jobtracker preventing one from accessing the failure reason. This value should be bumped up to about 100 according to the MapReduce team.,0 ,0 
Agent has it hard-coded that HDP repo file can only be downloaded once,Upgrade requires agents to download the repo file anytime.,0 ,0 
It seems upgrades available at the FE is hard-coded to 1.3.0,In order to test upgrade  I modified the available stack definitions to allow upgrade from 1.2.0 to 1.2.2 and removed upgrade to 1.3.0. However  the FE still says '(Upgrade available: HDP-1.3.0)'. However  http://server:8080/api/v1/stacks2/HDP/versions/1.3.0/ has min_upgrade_version as null.{ 'href' : 'http://server:8080/api/v1/stacks2/HDP/versions/1.3.0/'  'Versions' : { 'stack_version' : '1.3.0'  'stack_name' : 'HDP'  'min_upgrade_version' : null } ...,0 ,0 
HBase and Zk failed to start on secure install,Error during starting hbase and zookeeper during secure install.Incorrectly parsed Files:hbase-env.shzookeeper-env.sh,0 ,0 
Backend support for MySQL and Oracle for Oozie and Hive,Add ability to use Oracle DB for Hive and Oozie in Ambari,0 ,0 
Add support for Stack 1.2.2 to Ambari,Add support for Stack 1.2.2 to Ambari.,0 ,0 
Unable to get all tasks from more than one request_id by one request,When trying to get tasks from more than one request_id returns tasks only for one.request 'api/v1/clusters/mycluster/requests?Requests/id=1|Requests/id=2'returns:{'href' : 'http://ec2-23-20-223-127.compute-1.amazonaws.com:8080/api/v1/clusters/mycluster/requests?Requests/id=1|Requests/id=2' 'items' : [{'href' : 'http://ec2-23-20-223-127.compute-1.amazonaws.com:8080/api/v1/clusters/mycluster/requests/2' 'Requests' :{ 'id' : 2  'cluster_name' : 'mycluster' }}]},0 ,0 
Hue installation fails due to manifest errors,Hue installation fails due to following errors:1. Change in the name of rpm bundle2. Empty values in the hue.ini sections,0 ,0 
Security wizard - Javascript error is thrown when zooKeeper is included as a secure service.,,0 ,0 
Stopping and then Starting all services doesn't start NameNode,Security wizard stops all services  applies configuration and then starts all services.Sometimes it has been noticed that the action to stop all service completes successfully but the action to start all services never sends the task to start NameNode.,0 ,0 
Can not specify request context for smoke test request,Regarding BUG-3509 when we send request to server likeapi/v1/clusters/cl1/services/HDFS/actions/HDFS_SERVICE_CHECKRequest Method:POST Form Data:{'RequestInfo':{'context':'Smoke Test'}}This request is not setting request_context.,0 ,0 
Security wizard: Add missing secure configs to Hbase service and make 'zookeeper' as default primary name for zookeeper principal.,,1 ,0 
HBase master shuts down immediately after start in a secure cluster.,HBase master shuts down immediately after start in a secure cluster.Wrong settings in the hbase_master_jaas. Need to replace the 'HOST with actual fqdn,0 ,0 
Few core-site properties vanished after seemingly benign reconfiguration.,UI metadata properties are not being reconfigured and retained on saving services.,0 ,0 
Cluster Management > Services > MapReduce > Config throws JS error and the page comes up blank,,0 ,0 
For global properties show restart for appropriate services only,Currently when one service changes a property which doesnt effect all other services  the rest of the services are marked for restart. This is because the global tags are changed. Using work done in AMBARI-1797  only appropriate services should be marked as needing restart.,0 ,0 
Make single PUT call for multiple host overrides,Currently when we save host-overrides configuration  we have to do PUT of the delta on each host.This is problematic if admin provides an exception to 100 hosts. This will require 100 PUT calls which is expensive. There is a bulk update mechanism  but that requires the same content for all 100 hosts. This will not be the case if any hosts have other properties that are overridden.To save on network calls  we have to make one PUT call via the new API provided by AMBARI-1844.,0 ,0 
Cosmetic problems on HBase Dashboard,,0 ,0 
Capacity Scheduler: when adding a new queue  populate fields,When creating a new queue  populate all fields with default values except for:Queue NameCapacityMax CapacityUsersGroupsAdmin UsersAdmin Groups,0 ,0 
Cannot load Nagios Alerts due to 400 Bad Request,Given the API call: http://dev.hortonworks.com:8080/api/v1/clusters/test403_2/host_components?HostRoles/component_name=NAGIOS_SERVER&amp;fields=HostRoles/nagios_alertsThe feedback is:{ 'status' : 400  'message' : 'The properties [HostRoles/nagios_alerts] specified in the request or predicate are not supported for the resource type HostComponent.' },1 ,0 
Master broken - Cannot deploy services,Datanode install fails on multi-node clusters because the following configuration property:$ambari_db_rca_url= 'jdbc:postgresql://localhost/ambarirca'Ensure all of these variables are wired up:'ambari_db_rca_url''ambari_db_rca_driver''ambari_db_rca_username''ambari_db_rca_password',0 ,0 
ambari-agent RPM claims ownership of /usr/sbin,This may impact other versions  only branch-1.2 was changed.The ambari-agent.spec (generated from rpm-maven-plugin) claims ownership of /usr/sbin $ grep sbin target/rpm/ambari-agent/SPECS/ambari-agent.spec | grep attr%attr(755 root root) /usr/sbinThis is a problem because the filesystem RPM owns /usr/sbin.According to rpm-maven-plugin documentation&#91;0&#93;  this is because the only file under /usr/sbin is ambari-agent and'directoryIncludedIf the value is true then the attribute string will be written for the directory if the sources identify all of the files in the directory (that is  no other mapping contributed files to the directory). This is the default behavior.'The 'no other mapping contributed files to the directory' bit is important.The solution is to add directoryInclude=false to the mapping.&#91;0&#93; http://mojo.codehaus.org/rpm-maven-plugin/map-params.html,0 ,0 
Ambari FE is not setting proper value for fs.checkpoint.edits.dir,,0 ,0 
HUE pid and log dir labels are flip flopped,,0 ,0 
Capacity Scheduler: implement user/group and admin user/group validation rules,,0 ,0 
Reassign Master Wizard  Step 2: prevent proceed next without changing target host,,0 ,0 
stacks2 API uses 'type' to refer to config tags and no longer exposes 'filename' as a property,FE needs to be modified to not to use 'filename' in stacks API to get the config tags. The new property is 'type'.,0 ,0 
API to map global properties to services is partially complete.,API to map global properties to services is partially complete. The API gives 'global.xml' to approximately 47 properties. However the 'global' site has many more properties - so I dont know if some are fully missed.,0 ,1 
Impossibility to scroll metric window after browser width changing,Open detailed view of any metric diagram on Services page  for example 'Total Space Utilization'. After that change width of browser less than width of detailed view of metric diagram. Right arrow for graph time paging is invisible and we can't to resolve this problem using horizontal scrollbar.,0 ,0 
Disable editing Capacity Scheduler on host configs,Go to Configs tab of Host.Result: Queues in Capacity Scheduler category are editable.Expected: Queues in Capacity Scheduler category shouldn't be editable.,0 ,0 
Update default stack version to 1.3.0,,0 ,0 
HBase master doesn't come up after disabling security.,,0 ,0 
Client install tasks are shown twice in install progress popup,Client is re-configured by re-installing all client only hosts. This results in multiple tasks for client install in the UI.API response:{ 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2'  'Requests' : { 'id' : 2  'cluster_name' : 'yusaku' }  'tasks' : [ { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/43'  'Tasks' : { 'exit_code' : 0  'stdout' : 'notice: /Stage[2]/Hdp-oozie/Configgenerator::Configfile[oozie-site]/File[/etc/oozie/conf/oozie-site.xml]/content: content changed '{md5}eaf59cc452c92e64b559071586150a08' to '{md5}cb15303aab1c384d19c102a6ce650ed2'/nnotice: Finished catalog run in 2.04 seconds'  'status' : 'COMPLETED'  'stderr' : 'none'  'host_name' : 'ip-10-40-19-235.ec2.internal'  'id' : 43  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'INSTALL'  'role' : 'OOZIE_CLIENT'  'start_time' : 1365743356709  'stage_id' : 1 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/51'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'QUEUED'  'stderr' : ''  'host_name' : 'ip-10-40-19-235.ec2.internal'  'id' : 51  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'START'  'role' : 'GANGLIA_MONITOR'  'start_time' : 1365743407043  'stage_id' : 2 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/41'  'Tasks' : { 'exit_code' : 0  'stdout' : 'notice: Finished catalog run in 2.22 seconds'  'status' : 'COMPLETED'  'stderr' : 'none'  'host_name' : 'ip-10-40-19-235.ec2.internal'  'id' : 41  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'INSTALL'  'role' : 'HCAT'  'start_time' : 1365743356684  'stage_id' : 1 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/54'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'QUEUED'  'stderr' : ''  'host_name' : 'ip-10-80-81-236.ec2.internal'  'id' : 54  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'START'  'role' : 'GANGLIA_SERVER'  'start_time' : 1365743407078  'stage_id' : 2 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/55'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'QUEUED'  'stderr' : ''  'host_name' : 'ip-10-80-81-236.ec2.internal'  'id' : 55  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'START'  'role' : 'NAGIOS_SERVER'  'start_time' : 1365743407100  'stage_id' : 2 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/50'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'QUEUED'  'stderr' : ''  'host_name' : 'ip-10-40-19-235.ec2.internal'  'id' : 50  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'START'  'role' : 'DATANODE'  'start_time' : 1365743407032  'stage_id' : 2 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/67'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'PENDING'  'stderr' : ''  'host_name' : 'ip-10-40-19-235.ec2.internal'  'id' : 67  'cluster_name' : 'yusaku'  'attempt_cnt' : 0  'request_id' : 2  'command' : 'START'  'role' : 'HBASE_REGIONSERVER'  'start_time' : -1  'stage_id' : 4 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/47'  'Tasks' : { 'exit_code' : 0  'stdout' : 'warning: Dynamic lookup of $hadoop_heapsize is deprecated. Support will be removed in Puppet 2.8. Use a fully-qualified variable name (e.g.  $classname::variable) or parameterized classes./nnotice: /Stage[2]/Hdp-hive/Configgenerator::Configfile[hive-site]/File[/etc/hive/conf/hive-site.xml]/content: content changed '{md5}29d1def766d4aadfddbf38db13a2712e' to '{md5}2d26829fd012bf5f195e760fc8eeb7f9'/nnotice: Finished catalog run in 2.84 seconds'  'status' : 'COMPLETED'  'stderr' : 'none'  'host_name' : 'ip-10-80-81-236.ec2.internal'  'id' : 47  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'INSTALL'  'role' : 'HIVE_CLIENT'  'start_time' : 1365743356758  'stage_id' : 1 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/45'  'Tasks' : { 'exit_code' : 0  'stdout' : 'notice: Finished catalog run in 2.24 seconds'  'status' : 'COMPLETED'  'stderr' : 'none'  'host_name' : 'ip-10-40-19-235.ec2.internal'  'id' : 45  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'INSTALL'  'role' : 'SQOOP'  'start_time' : 1365743356733  'stage_id' : 1 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/44'  'Tasks' : { 'exit_code' : 0  'stdout' : 'notice: Finished catalog run in 2.13 seconds'  'status' : 'COMPLETED'  'stderr' : 'none'  'host_name' : 'ip-10-40-19-235.ec2.internal'  'id' : 44  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'INSTALL'  'role' : 'PIG'  'start_time' : 1365743356721  'stage_id' : 1 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/56'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'QUEUED'  'stderr' : ''  'host_name' : 'ip-10-80-81-236.ec2.internal'  'id' : 56  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'START'  'role' : 'NAMENODE'  'start_time' : 1365743407109  'stage_id' : 2 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/52'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'QUEUED'  'stderr' : ''  'host_name' : 'ip-10-40-19-235.ec2.internal'  'id' : 52  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'START'  'role' : 'ZOOKEEPER_SERVER'  'start_time' : 1365743407062  'stage_id' : 2 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/42'  'Tasks' : { 'exit_code' : 0  'stdout' : 'warning: Dynamic lookup of $hadoop_heapsize is deprecated. Support will be removed in Puppet 2.8. Use a fully-qualified variable name (e.g.  $classname::variable) or parameterized classes./nnotice: /Stage[2]/Hdp-hive/Configgenerator::Configfile[hive-site]/File[/etc/hive/conf/hive-site.xml]/content: content changed '{md5}27e517fec40f6157f75eb3116d5387bf' to '{md5}54ff14d0a6d9968e900f28853125b294'/nnotice: Finished catalog run in 2.28 seconds'  'status' : 'COMPLETED'  'stderr' : 'none'  'host_name' : 'ip-10-40-19-235.ec2.internal'  'id' : 42  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'INSTALL'  'role' : 'HIVE_CLIENT'  'start_time' : 1365743356697  'stage_id' : 1 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/63'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'PENDING'  'stderr' : ''  'host_name' : 'ip-10-80-81-236.ec2.internal'  'id' : 63  'cluster_name' : 'yusaku'  'attempt_cnt' : 0  'request_id' : 2  'command' : 'START'  'role' : 'HBASE_MASTER'  'start_time' : -1  'stage_id' : 3 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/62'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'PENDING'  'stderr' : ''  'host_name' : 'ip-10-40-19-235.ec2.internal'  'id' : 62  'cluster_name' : 'yusaku'  'attempt_cnt' : 0  'request_id' : 2  'command' : 'START'  'role' : 'TASKTRACKER'  'start_time' : -1  'stage_id' : 3 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/46'  'Tasks' : { 'exit_code' : 0  'stdout' : 'notice: Finished catalog run in 2.77 seconds'  'status' : 'COMPLETED'  'stderr' : 'none'  'host_name' : 'ip-10-80-81-236.ec2.internal'  'id' : 46  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'INSTALL'  'role' : 'HCAT'  'start_time' : 1365743356744  'stage_id' : 1 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/58'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'QUEUED'  'stderr' : ''  'host_name' : 'ip-10-85-70-140.ec2.internal'  'id' : 58  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'START'  'role' : 'GANGLIA_MONITOR'  'start_time' : 1365743407125  'stage_id' : 2 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/60'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'QUEUED'  'stderr' : ''  'host_name' : 'ip-10-85-70-140.ec2.internal'  'id' : 60  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'START'  'role' : 'ZOOKEEPER_SERVER'  'start_time' : 1365743407164  'stage_id' : 2 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/69'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'PENDING'  'stderr' : ''  'host_name' : 'ip-10-85-70-140.ec2.internal'  'id' : 69  'cluster_name' : 'yusaku'  'attempt_cnt' : 0  'request_id' : 2  'command' : 'START'  'role' : 'OOZIE_SERVER'  'start_time' : -1  'stage_id' : 4 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/64'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'PENDING'  'stderr' : ''  'host_name' : 'ip-10-85-70-140.ec2.internal'  'id' : 64  'cluster_name' : 'yusaku'  'attempt_cnt' : 0  'request_id' : 2  'command' : 'START'  'role' : 'HIVE_METASTORE'  'start_time' : -1  'stage_id' : 3 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/48'  'Tasks' : { 'exit_code' : 0  'stdout' : 'warning: Dynamic lookup of $service_state at /var/lib/ambari-agent/puppet/modules/hdp-hadoop/manifests/init.pp:213 is deprecated. Support will be removed in Puppet 2.8. Use a fully-qualified variable name (e.g.  $classname::variable) or parameterized classes./nwarning: Dynamic lookup of $tasktracker_port is deprecated. Support will be removed in Puppet 2.8. Use a fully-qualified variable name (e.g.  $classname::variable) or parameterized classes./nwarning: Dynamic lookup of $ambari_db_rca_url is deprecated. Support will be removed in Puppet 2.8. Use a fully-qualified variable name (e.g.  $classname::variable) or parameterized classes./nwarning: Dynamic lookup of $ambari_db_rca_driver is deprecated. Support will be removed in Puppet 2.8. Use a fully-qualified variable name (e.g.  $classname::variable) or parameterized classes./nwarning: Dynamic lookup of $ambari_db_rca_username is deprecated. Support will be removed in Puppet 2.8. Use a fully-qualified variable name (e.g.  $classname::variable) or parameterized classes./nwarning: Dynamic lookup of $ambari_db_rca_password is deprecated. Support will be removed in Puppet 2.8. Use a fully-qualified variable name (e.g.  $classname::variable) or parameterized classes./nnotice: /Stage[2]/Hdp-hadoop::Initialize/Configgenerator::Configfile[core-site]/File[/etc/hadoop/conf/core-site.xml]/content: content changed '{md5}95bdcddd064261ac3a00d8c0a7f79fee' to '{md5}d6f5b9646bf280e915e3b0d42ed622a9'/nnotice: /Stage[2]/Hdp-hadoop::Initialize/Configgenerator::Configfile[hdfs-site]/File[/etc/hadoop/conf/hdfs-site.xml]/content: content changed '{md5}5f83b57cbac46a0b7007ed94720a8c3b' to '{md5}e0e38c4dc10fc81b12637e34796ced70'/nnotice: /Stage[2]/Hdp-hadoop::Initialize/Configgenerator::Configfile[mapred-site]/File[/etc/hadoop/conf/mapred-site.xml]/content: content changed '{md5}42b54b8e096eafa7ba53c8f5b53bda3e' to '{md5}409f4680bc7871db2864afecbcefdb36'/nnotice: Finished catalog run in 3.67 seconds'  'status' : 'COMPLETED'  'stderr' : 'none'  'host_name' : 'ip-10-80-81-236.ec2.internal'  'id' : 48  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'INSTALL'  'role' : 'MAPREDUCE_CLIENT'  'start_time' : 1365743356769  'stage_id' : 1 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/70'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'PENDING'  'stderr' : ''  'host_name' : 'ip-10-85-70-140.ec2.internal'  'id' : 70  'cluster_name' : 'yusaku'  'attempt_cnt' : 0  'request_id' : 2  'command' : 'START'  'role' : 'WEBHCAT_SERVER'  'start_time' : -1  'stage_id' : 5 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/61'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'PENDING'  'stderr' : ''  'host_name' : 'ip-10-40-19-235.ec2.internal'  'id' : 61  'cluster_name' : 'yusaku'  'attempt_cnt' : 0  'request_id' : 2  'command' : 'START'  'role' : 'HBASE_MASTER'  'start_time' : -1  'stage_id' : 3 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/66'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'PENDING'  'stderr' : ''  'host_name' : 'ip-10-85-70-140.ec2.internal'  'id' : 66  'cluster_name' : 'yusaku'  'attempt_cnt' : 0  'request_id' : 2  'command' : 'START'  'role' : 'SECONDARY_NAMENODE'  'start_time' : -1  'stage_id' : 3 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/49'  'Tasks' : { 'exit_code' : 0  'stdout' : 'notice: /Stage[2]/Hdp-oozie/Configgenerator::Configfile[oozie-site]/File[/etc/oozie/conf/oozie-site.xml]/content: content changed '{md5}001c4940080d2ea315a9720676f1bcad' to '{md5}282f1e354fe7f9da0f6de43425a40d40'/nnotice: Finished catalog run in 2.24 seconds'  'status' : 'COMPLETED'  'stderr' : 'none'  'host_name' : 'ip-10-80-81-236.ec2.internal'  'id' : 49  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'INSTALL'  'role' : 'OOZIE_CLIENT'  'start_time' : 1365743356796  'stage_id' : 1 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/53'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'QUEUED'  'stderr' : ''  'host_name' : 'ip-10-80-81-236.ec2.internal'  'id' : 53  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'START'  'role' : 'GANGLIA_MONITOR'  'start_time' : 1365743407070  'stage_id' : 2 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/68'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'PENDING'  'stderr' : ''  'host_name' : 'ip-10-85-70-140.ec2.internal'  'id' : 68  'cluster_name' : 'yusaku'  'attempt_cnt' : 0  'request_id' : 2  'command' : 'START'  'role' : 'HIVE_SERVER'  'start_time' : -1  'stage_id' : 4 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/65'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'PENDING'  'stderr' : ''  'host_name' : 'ip-10-85-70-140.ec2.internal'  'id' : 65  'cluster_name' : 'yusaku'  'attempt_cnt' : 0  'request_id' : 2  'command' : 'START'  'role' : 'JOBTRACKER'  'start_time' : -1  'stage_id' : 3 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/57'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'QUEUED'  'stderr' : ''  'host_name' : 'ip-10-80-81-236.ec2.internal'  'id' : 57  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'START'  'role' : 'ZOOKEEPER_SERVER'  'start_time' : 1365743407117  'stage_id' : 2 } }  { 'href' : 'http://ec2-50-17-99-21.compute-1.amazonaws.com:8080/api/v1/clusters/yusaku/requests/2/tasks/59'  'Tasks' : { 'exit_code' : 999  'stdout' : ''  'status' : 'QUEUED'  'stderr' : ''  'host_name' : 'ip-10-85-70-140.ec2.internal'  'id' : 59  'cluster_name' : 'yusaku'  'attempt_cnt' : 1  'request_id' : 2  'command' : 'START'  'role' : 'MYSQL_SERVER'  'start_time' : 1365743407156  'stage_id' : 2 } } ]},0 ,0 
Ambari Core-Site.xml Missing Property for LZO (enabled) - io.compression.codecs,,0 ,0 
JobTracker History Server failed to come up on 1.3.0 stack and the request for service stall is stalled,Attempted to install a cluster with 1.3.0 stack.Service install was all green  but JobTracker History Server failed to come up.The request for the service start is stalled  with no tasks in QUEUED or IN_PROGRESS state  but with some tasks in PENDING state.,0 ,0 
Allow for users to customize Nagios user accounts,Allow for customers to install the users used for Nagios.,0 ,0 
Allow for users to customize Ganglia gmetad + gmond user accounts,Allow customization of ganglia gmetad and gmond users.For reference: looks like this is available in gsInstaller so the pattern exists to follow for Ambari impl. Defaults to nobody/nobody,0 ,0 
Test failure : testCascadeDeleteStages,mvn clean install produces the following failure ...testCascadeDeleteStages(org.apache.ambari.server.actionmanager.TestActionManager):Exception [EclipseLink-4002] (Eclipse Persistence Services -2.4.0.v20120608-r11652):org.eclipse.persistence.exceptions.DatabaseException(..),0 ,0 
Security vulnerability with Ganglia and Nagios,Ganglia Issue : Unspecified vulnerability in Ganglia Web before 3.5.1 allows remote attackers to execute arbitrary PHP code via unknown attack vectors. http://ganglia.info/?p=549 Ganglia Web 3.5.1 Release 窶・Security Advisory There is a security issue in Ganglia Web going back to at least 3.1.7 which can lead to arbitrary script being executed with web user privileges possibly leading to a machine compromise. Issue has been fixed in the latest version of Ganglia Web which can be downloaded from https://sourceforge.net/projects/ganglia/files/ganglia-web/3.5.1/ Solution: Need to get upgraded rpms with the Ganglia Web version 3.5.7 which has the fix for this vulnerability.Nagios: Multiple stack-based buffer overflows in the get_history function in history.cgi in Nagios Core before 3.4.4  and Icinga 1.6.x before 1.6.2  1.7.x before 1.7.4  and 1.8.x before 1.8.4  might allow remote attackers to execute arbitrary code via a long (1) host_name variable (host parameter) or (2) svc_description variable. http://www.nagios.org/projects/nagioscore/history/core-3x http://lists.grok.org.uk/pipermail/full-disclosure/2012-December/089125.html Vulnerable software and versions - nagios:nagios:3.4.3 and previous versions,1 ,0 
All Service Smoke tests fail when run with service start,has_key(): expects the first argument to be a hash  got '' which is of type String at /var/lib/ambari-agent/puppet/modules/hdp/manifests/init.pp:38 on node ip-10-38-25-227.ec2.internalsite-pp#12.04.2013 03:16:38import '/var/lib/ambari-agent/puppet/modules/hdp/manifests/*.pp'import '/var/lib/ambari-agent/puppet/modules/hdp-hadoop/manifests/*.pp'import '/var/lib/ambari-agent/puppet/modules/hdp-hbase/manifests/*.pp'import '/var/lib/ambari-agent/puppet/modules/hdp-zookeeper/manifests/*.pp'import '/var/lib/ambari-agent/puppet/modules/hdp-oozie/manifests/*.pp'import '/var/lib/ambari-agent/puppet/modules/hdp-pig/manifests/*.pp'import '/var/lib/ambari-agent/puppet/modules/hdp-sqoop/manifests/*.pp'import '/var/lib/ambari-agent/puppet/modules/hdp-templeton/manifests/*.pp'import '/var/lib/ambari-agent/puppet/modules/hdp-hive/manifests/*.pp'import '/var/lib/ambari-agent/puppet/modules/hdp-hcat/manifests/*.pp'import '/var/lib/ambari-agent/puppet/modules/hdp-mysql/manifests/*.pp'import '/var/lib/ambari-agent/puppet/modules/hdp-monitor-webserver/manifests/*.pp'import '/var/lib/ambari-agent/puppet/modules/hdp-repos/manifests/*.pp'$ambari_db_rca_password= ['mapred']$nagios_server_host= ['ip-10-38-25-227.ec2.internal']$ambari_db_rca_url= ['jdbc:postgresql://ip-10-38-25-227.ec2.internal/ambarirca']$webhcat_server_host= ['ip-10-38-25-227.ec2.internal']$hbase_rs_hosts= ['ip-10-38-25-227.ec2.internal']$slave_hosts= ['ip-10-38-25-227.ec2.internal']$namenode_host= ['ip-10-38-25-227.ec2.internal']$ganglia_server_host= ['ip-10-38-25-227.ec2.internal']$hbase_master_hosts= ['ip-10-38-25-227.ec2.internal']$hive_mysql_host= ['ip-10-38-25-227.ec2.internal']$oozie_server= ['ip-10-38-25-227.ec2.internal']$ambari_db_rca_driver= ['org.postgresql.Driver']$zookeeper_hosts= ['ip-10-38-25-227.ec2.internal']$jtnode_host= ['ip-10-38-25-227.ec2.internal']$ambari_db_rca_username= ['mapred']$hive_server_host= ['ip-10-38-25-227.ec2.internal']node /default/ { stage{1 :} -&gt; stage{2 :}class {'hdp': stage =&gt; 1}class {'hdp-zookeeper::quorum::service_check': stage =&gt; 2}},0 ,0 
Oozie Smoke test fails with errors on the start services/install page.,Ozzie smoke tests fail,0 ,0 
System logs are not present on tasktracker,Run a mapreduce job.Find the attempt id and look for system logs on tasktracker.http://ec2-54-224-138-78.compute-1.amazonaws.com:50060/tasklog?attemptid=attempt_201304121816_0003_m_000000_0Actual result:The syslogs are not present here.Only stdout and stderr logs are present.,0 ,0 
hadoop dependency version for ambari-log4j is hardcoded  making it regular expression based to pick latest from the repository.,Ambari-log4j has hardcoded hadoop-core and hadoop-tools dependency. Make it version as regular expression to pick from the range from 1.0 &lt;= x &lt; 2.0.Also  updating the repository url.,0 ,0 
Wrong install status shown in Add Service Wizard,Upon master component install failure  the host status becomes 'warning' instead of 'failed' for Add Service Wizard.,0 ,0 
Hosts table: whether the alert filter is in effect or not is not clear,Currently  when the red badge inside the Hosts tab is clicked  it shows hosts that have at least one alert and no other hosts are displayed.The fact that the alert filter is in effect is not clear to the user and causes confusion.,0 ,0 
Client install tasks are shown twice in progress popup during start phase of install wizard (update API call to include params/reconfigure_client),,0 ,0 
Deploying HDP-1.3.0 results in several alerts - is it related to hard-coded port,TaskTracker  RegionServer  HBase master process down because check_tcp failure.Looks like the hadoop-services.cfg.erb has:check_command check_tcp!&lt;%=scope.function_hdp_template_var('jtnode_port')%&gt;!-w 1 -c 1and looks like the ports are not getting replaced and end up being empty.,0 ,0 
When nagios is unavailable  return null instead of throwing an Exception,NAGIOS_SERVER alerts are retrieved from the nagios server when requesting the host_component. There is a SystemException thrown in the case of an IOException  which propagates as a 500 error for the entire request.In this case  set the nagios_alerts element to null instead of the 500 error.,0 ,0 
Hostname pattern expression is broken,dev[01-03].domain.com expanded to:dev1.domain.comdev2.domain.comdev3.domain.comShould be:dev01.domain.comdev02.domain.comdev03.domain.com,0 ,0 
Filtered hosts get out of sync with the filter selection,1. Browse to Hosts2. Click one of the filters3. Browse to Services and back to Hosts4. The filter links show All as the current filter but the filter didn't reset and still shows a sub-set of hosts,0 ,0 
Action buttons on host details page not formatted properly on Firefox,,0 ,0 
Clicking on Cancel on the Service Config page should not reload the entire app,When Cancel is clicked on the Service Config page  simply reload the config (not the entire app).,0 ,0 
Filtering on Jobs table does not work under certain situations,,0 ,0 
Hosts tab: clicking on red badge should not toggle 'Alerts' filter,Clicking on the red badge in the Hosts tab should not toggle the 'Alerts' filter on the Hosts page (clicking anywhere in Hosts tab should go to Hosts page with 'All' selected).,0 ,0 
Using mixed OS overwrites ambari.repo during install,Performed install on mixed OS environment with 8 hosts.Ambari Server = RHEL6Three Hosts = RHEL6Four Hosts = RHEL5Performed manual ambari-agent bootstrap of the Four RHEL5 hosts. I was able to successfully register all hosts. When install started  the four RHEL5 hosts failed on installing their first component. Looking at the servers  looks like the right HDP.repo and HDP-epel.repo files are put in place.But looks like the ambari.repo file had been overwritten at some point during the install process  and now is point to the RHEL6 repos  causing failures.,0 ,0 
Cannot delete cluster with components in UNKNOWN state,When components are marked in an UNKNOWN state  it is not possible to delete the cluster - this should be possible.,0 ,0 
Cannot decommission data node (ensure recommission also works),stderr: $configuration&#91;hdfs-site&#93; is not an hash or array when accessing it with dfs.hosts.exclude at /var/lib/ambari-agent/puppet/modules/hdp-hadoop/manifests/hdfs/decommission.pp:24 on node ip-10-82-213-66.ec2.internal stdout:None,0 ,1 
Ambari Server becomes unresponsive after crashing on http reads on jersey.,The api's are being handled by a queuedthreadpool. The queuedthread pool size is 25.Somehow the http connections are being torn down from the UI side but the server still is hanging onto that socket and reading (most likely UI will also need to close http connections if its not using them - which might be an issue as well but doesnt have to addressed as urgent). The server has a read timeout of 0 which means it will just hang on to that socket for read. This causes all the threads to block at one time or the other. Simple solution is add read timeouts to all the SelectChannelConnector and SslSelectChannelConnector we use.Exception trace: SEVERE: The exception contained within MappableContainerException could not be mapped to a response  re-throwing to the HTTP containerorg.eclipse.jetty.io.EofException: early EOF at org.eclipse.jetty.server.HttpInput.read(HttpInput.java:65) at org.codehaus.jackson.impl.ByteSourceBootstrapper.ensureLoaded(ByteSourceBootstrapper.java:507) at org.codehaus.jackson.impl.ByteSourceBootstrapper.detectEncoding(ByteSourceBootstrapper.java:129) at org.codehaus.jackson.impl.ByteSourceBootstrapper.constructParser(ByteSourceBootstrapper.java:224) at org.codehaus.jackson.JsonFactory._createJsonParser(JsonFactory.java:785) at org.codehaus.jackson.JsonFactory.createJsonParser(JsonFactory.java:561) at org.codehaus.jackson.jaxrs.JacksonJsonProvider.readFrom(JacksonJsonProvider.java:414) at com.sun.jersey.json.impl.provider.entity.JacksonProviderProxy.readFrom(JacksonProviderProxy.java:139) at com.sun.jersey.spi.container.ContainerRequest.getEntity(ContainerRequest.java:474)Notice the API's is being called all the time - meaning they probalby had a browser up and running for a long time.There might be a possibilility that the browser might have some issues after running for a long time. Something to keep in mind when this happens again. Easy way to check that is to call Ambari server API's and also bring up a new browser window (new instance) and try hitting the browser UI.,0 ,1 
Add validation checks for Add Property on custom site configs,,0 ,0 
Error when loading /main/services directly,,0 ,0 
Make frontend changes to account for the host component status UNKNOWN,Service status: if any of the master components are in UNKNOWN state  show the unknown icon. The action buttons for the service are disabled. Host status: if the host status is UNKNOWN or the heartbeat has not been received in more than 180 seconds  show the unknown icon. Host component status: if the host component status is UNKNOWN  show the unknown icon. The action button for the host component is disabled.,0 ,0 
Add clover code coverage profile,mvn test -Pclover -Dclover.license=&lt;clover.coverage.license&gt; should run the unit tests and return html/xml code coverage reports,0 ,0 
Disable 'Add Component' button in the Host Details page if the host is in UNKNOWN state or !isHeartbeating,,0 ,0 
'Add local user' button is enabled but nothing happens upon clicking it under certain conditions,Steps to reproduce1. Go to Admin tab2. Click on 'Add Local User' button3. Click on Admin tab again4. Clicking on 'Add Local User' button does nothing,0 ,0 
Services links on Dashboard connected to incorrect pages,Click on any of the service links shown on the Dashboard page.It transitions to the service page and the content displayed is correct for the service chosen  but the URL indicates that it is another service and the side-menu shows a different service highlighted.,0 ,0 
Add Unit test to verify  client re-install for install failed client,Add Unit test to verify  When INSTALL is schedules on client components it should also be scheduled on components that are in INSTALL_FAILED state,0 ,0 
If 'Install from Local Repository' selected in install wizard  Add Host wizard not working,,0 ,0 
Host Detail page: if the host component is in INSTALL_FAILED state  we should let the user reinstall it,,0 ,0 
HBase Heatmaps: clean up labels and units,,0 ,0 
Hadoop group customization does not take affect,To customize the hadoop group  when it was changed from 'hadoop' to 'hadoopgroup'  it didn't look like it worked.root@ip-10-85-135-237 hdfsuser# id hdfsuid=495(hdfs) gid=494(hdfs) groups=494(hdfs) 495(hadoop)And looking at the /etc/group filepuppet:x:497:hadoopgroup:x:500:rrdcached:x:496:apache:x:48:hadoop:x:495:mapred hdfs,0 ,0 
'Preparing to install ' message needs spacing,,0 ,0 
Changing service directories should popup a confirmation/warning dialog upon save,Post-install  if the user tries to reconfigure NN  SNN  MapReduce local/system directories  we should popup a confirmation/warning upon Save as this is potentially a dangerous operation.,0 ,0 
Admin role can't be assigned to LDAP user,,0 ,0 
changeUid.sh failing during installation,On SUSE  I received a puppet error on each agent that /tmp/changeUid.sh failed during installation. (Sorry I no longer have the error  I made puppet change and restarted to get by it). But in a nutshell  running the command manually gave:ip-10-82-233-26:/tmp # /tmp/changeUid.sh ambari-qa 1012 /tmp/ambari-qa /home/ambari-qa /var/spool/mail/ambari-qaChanging uid of ambari-qa from 1012 to 1012Changing directory permisions for /tmp/ambari-qa /home/ambari-qa /var/spool/mail/ambari-qausermod: UID 1012 is not unique.Note that the usermod is trying to change to an existing UID  so the command is failing everywhere,0 ,0 
Tasks are not filtered by parent request id,STEPS:1) Get tasks for first request  /api/v1/clusters/&lt;cluster&gt;/requests/&lt;firstRequest&gt;  i.e. task1 ... taskN12) Get tasks for second request by task from first requst  like /api/v1/clusters/&lt;cluster&gt;/requests/&lt;secondRequest&gt;/tasks/task1 (note task1 belongs to first request  not second)3) Notice that task from first request are present in second request.,0 ,0 
Post Ambari upgrade  Hive and Oozie fail to start after reconfigure,,0 ,0 
It's possible to get into a state where install retry is not possible if the agent stops heartbeating,This affects both Install and Add Host Wizards.Steps to reproduce:While installing components  stop the agent on one of the hosts.Waiting for a while puts the components on the host into the UNKNOWN state.Click Retry from the UI. This causes a server-side error and the UI gets confused (the hosts are shown with 'Waiting' message and no 'Retry' button is available).The user is not able to get out of this state.,0 ,0 
Hive service check (still) failing with file permissions,Stack upgrade testing is still showing this to be an issue.warning: Unrecognised escape sequence '/;' in file /var/lib/ambari-agent/puppet/modules/hdp-hive/manifests/hive/service_check.pp at line 32warning: Dynamic lookup of $configuration is deprecated. Support will be removed in Puppet 2.8. Use a fully-qualified variable name (e.g.  $classname::variable) or parameterized classes.notice: /Stage[1]/Hdp::Snappy::Package/Hdp::Snappy::Package::Ln[32]/Hdp::Exec[hdp::snappy::package::ln 32]/Exec[hdp::snappy::package::ln 32]/returns: executed successfullynotice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: ls: cannot access /usr/share/java/*oracle*: No such file or directorynotice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: 13/05/09 15:01:52 WARN conf.HiveConf: DEPRECATED: Configuration property hive.metastore.local no longer has any effect. Make sure to provide a valid value for hive.metastore.uris if you are connecting to a remote metastore.notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: log4j:ERROR setFile(null true) call failed.notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: java.io.FileNotFoundException: /tmp/ambari_qa/hive.log (Permission denied)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at java.io.FileOutputStream.openAppend(Native Method)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:192)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:116)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.log4j.FileAppender.setFile(FileAppender.java:290)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.log4j.FileAppender.activateOptions(FileAppender.java:164)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.log4j.DailyRollingFileAppender.activateOptions(DailyRollingFileAppender.java:216)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.log4j.config.PropertySetter.activate(PropertySetter.java:257)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.log4j.config.PropertySetter.setProperties(PropertySetter.java:133)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.log4j.config.PropertySetter.setProperties(PropertySetter.java:97)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.log4j.PropertyConfigurator.parseAppender(PropertyConfigurator.java:689)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.log4j.PropertyConfigurator.parseCategory(PropertyConfigurator.java:647)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.log4j.PropertyConfigurator.configureRootCategory(PropertyConfigurator.java:544)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.log4j.PropertyConfigurator.doConfigure(PropertyConfigurator.java:440)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.log4j.PropertyConfigurator.doConfigure(PropertyConfigurator.java:476)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.log4j.PropertyConfigurator.configure(PropertyConfigurator.java:354)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.hadoop.hive.common.LogUtils.initHiveLog4jDefault(LogUtils.java:124)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.hadoop.hive.common.LogUtils.initHiveLog4jCommon(LogUtils.java:77)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.hadoop.hive.common.LogUtils.initHiveLog4j(LogUtils.java:58)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.hcatalog.cli.HCatCli.main(HCatCli.java:61)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at java.lang.reflect.Method.invoke(Method.java:597)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.hadoop.util.RunJar.main(RunJar.java:160)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: log4j:ERROR Either File or DatePattern options are not set for appender [DRFA].notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: Exception in thread 'main' java.lang.RuntimeException: java.io.IOException: Permission deniednotice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.hadoop.hive.ql.session.SessionState.start(SessionState.java:272)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at org.apache.hcatalog.cli.HCatCli.main(HCatCli.java:79)notice: /Stage[2]/Hdp-hcat::Hcat::Service_check/Exec[hcatSmoke.sh prepare]/returns: at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method),1 ,0 
Support for configuring and running Ambari Web Server https,Need to be able to run Ambari Web (and access Ambari REST APIs) over HTTPS. Should document assuming the user comes with their own certificate. User should also be able to configure which port to expose HTTPS.,0 ,0 
Enable customization of smoke test user,,0 ,0 
ambari-web modifications to allow for Hadoop Compatible Filesystems (HCFS),Make modifications to ambari-web that will allow for the selection of a Hadoop Compatible Filesystem. These changes include allowing HDFS to be unselected (either HDFS or HCFS must be selected). If HCFS is chosen  push appropriate configuration (site-conf.xml) files during the install so that systems will work with HCFS as the underlying filesystem rather than HDFS.,0 ,0 
Use modified dependencies if a stack contains an HCFS service (Hadoop Compatible File System),Use stack metadata to determine if a stack contains an HCFS service and generate modified RoleCommandOrder dependencies if it does.,0 ,0 
Set default value of oozie property 'oozie.service.AuthorizationService.authorization.enabled' to true.,,0 ,0 
Home paths are not set correctly in /etc/sqoop/conf/sqoop-env.sh,Ambari sets the followings:#Set path to where bin/hadoop is availableexport HADOOP_HOME=${HADOOP_HOME:-/usr}#set the path to where bin/hbase is availableexport HBASE_HOME=${HBASE_HOME:-/usr}#Set the path to where bin/hive is availableexport HIVE_HOME=${HIVE_HOME:-/usr}# add libthrift in hive to sqoop class path first so hive imports workexport SQOOP_USER_CLASSPATH=''ls ${HIVE_HOME}/lib/libthrift-*.jar 2&gt; /dev/null':${SQOOP_USER_CLASSPATH}'#Set the path for where zookeper config dir isexport ZOOCFGDIR=${ZOOCFGDIR:-/etc/zookeeper/conf}It should be the followings (also screenshot is available):#Set path to where bin/hadoop is availableexport HADOOP_HOME=${HADOOP_HOME:-/usr/lib/hadoop}#set the path to where bin/hbase is availableexport HBASE_HOME=${HBASE_HOME:-/usr/lib/hbase}#Set the path to where bin/hive is availableexport HIVE_HOME=${HIVE_HOME:-/usr/lib/hive}#Set the path for where zookeper config dir isexport ZOOCFGDIR=${ZOOCFGDIR:-/etc/zookeeper/conf}# add libthrift in hive to sqoop class path first so hive imports workexport SQOOP_USER_CLASSPATH=''ls ${HIVE_HOME}/lib/libthrift-*.jar 2&gt; /dev/null':${SQOOP_USER_CLASSPATH},0 ,0 
HBASE fails to start on master,HBASE master fails to start on master. From log:2013-05-14 21:06:43 487 FATAL org.apache.hadoop.hbase.master.HMaster: Unhandled exception. Starting shutdown.org.apache.hadoop.security.AccessControlException: org.apache.hadoop.security.AccessControlException: Permission denied: user=hbase  access=EXECUTE  inode='/apps/hbase/data':hdfs:hdfs:drwx------ at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39) at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27) at java.lang.reflect.Constructor.newInstance(Constructor.java:513) at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:95) at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:57) at org.apache.hadoop.hdfs.DFSClient.getFileInfo(DFSClient.java:1134) at org.apache.hadoop.hdfs.DistributedFileSystem.getFileStatus(DistributedFileSystem.java:556) at org.apache.hadoop.fs.FileSystem.exists(FileSystem.java:779) at org.apache.hadoop.hbase.util.FSUtils.getVersion(FSUtils.java:287) at org.apache.hadoop.hbase.util.FSUtils.checkVersion(FSUtils.java:329) at org.apache.hadoop.hbase.master.MasterFileSystem.checkRootDir(MasterFileSystem.java:434) at org.apache.hadoop.hbase.master.MasterFileSystem.createInitialFileSystemLayout(MasterFileSystem.java:146) at org.apache.hadoop.hbase.master.MasterFileSystem.&lt;init&gt;(MasterFileSystem.java:131) at org.apache.hadoop.hbase.master.HMaster.finishInitialization(HMaster.java:532) at org.apache.hadoop.hbase.master.HMaster.run(HMaster.java:391) at java.lang.Thread.run(Thread.java:662),0 ,0 
Installation with existing Oracle DB fails,On Step8 'Customize Services' for HIVE and OOZIE we can use option 'Existing Oracle DB'.But after Cluster install HIVE and OOZIE didn't start (with option 'Existing Oracle DB').In the logs I found such:/var/log/hive/hive.logCaused by: org.datanucleus.exceptions.NucleusException: Attempt to invoke the 'DBCP' plugin to create a ConnectionPool gave an error : The specified datastore driver ('oracle.jdbc.driver.OracleDriver') was not found in the CLASSPATH. Please check your CLASSPATH specification  and the name of the driver./var/log/oozie/oozie.log013-05-14 11:25:59 618 FATAL Services:533 - USER[-] GROUP[-] TOKEN[-] APP[-] JOB[-] ACTION[-] E0103: Could not load service classes  Cannot load JDBC driver class 'oracle.jdbc.driver.OracleDriver'org.apache.oozie.service.ServiceException: E0103: Could not load service classes  Cannot load JDBC driver class 'oracle.jdbc.driver.OracleDriver',0 ,0 
When hive and oozie users have been changed after upgrade hive metastore and oozie cannot start properly,Oozie start failure:^[[0;36mnotice: /Stage[2]/Hdp-oozie::Service/Hdp::Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/returns: Setting OOZIE_BASE_URL: http://ip-10-212-166-111.ec2.internal:11000/oozie^[[0m^[[0;36mnotice: /Stage[2]/Hdp-oozie::Service/Hdp::Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/returns: Using CATALINA_BASE: /var/lib/oozie/oozie-server^[[0m^[[0;36mnotice: /Stage[2]/Hdp-oozie::Service/Hdp::Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/returns: Setting OOZIE_HTTPS_KEYSTORE_FILE: /home/ooziexx/.keystore^[[0m^[[0;36mnotice: /Stage[2]/Hdp-oozie::Service/Hdp::Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/returns: Setting OOZIE_HTTPS_KEYSTORE_PASS: password^[[0m^[[0;36mnotice: /Stage[2]/Hdp-oozie::Service/Hdp::Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/returns: Setting CATALINA_OUT: /var/log/oozie//catalina.out^[[0m^[[0;36mnotice: /Stage[2]/Hdp-oozie::Service/Hdp::Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/returns: Using CATALINA_PID: /var/run/oozie/oozie.pid^[[0m^[[0;36mnotice: /Stage[2]/Hdp-oozie::Service/Hdp::Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/returns: ^[[0m^[[0;36mnotice: /Stage[2]/Hdp-oozie::Service/Hdp::Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/returns: Using CATALINA_OPTS: -Dderby.stream.error.file=/var/log/oozie//derby.log^[[0m^[[0;36mnotice: /Stage[2]/Hdp-oozie::Service/Hdp::Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/returns: Adding to CATALINA_OPTS: -Doozie.home.dir=/usr/lib/oozie -Doozie.config.dir=/etc/oozie/conf -Doozie.log.dir=/var/log/oozie/ -Doozie.data.dir=/grid/0/hadoop/oozie/data/ -Doozie.config.file=oozie-site.xml -Doozie.log4j.file=oozie-log4j.properties -Doozie.log4j.reload=10 -Doozie.http.hostname=ip-10-212-166-111.ec2.internal -Doozie.admin.port=11001 -Doozie.http.port=11000 -Doozie.https.port=11443 -Doozie.base.url=http://ip-10-212-166-111.ec2.internal:11000/oozie -Doozie.https.keystore.file=/home/ooziexx/.keystore -Doozie.https.keystore.pass=password -Djava.library.path=/usr/lib/hadoop/lib/native/Linux-amd64-64^[[0m^[[0;36mnotice: /Stage[2]/Hdp-oozie::Service/Hdp::Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/returns: ^[[0m^[[0;36mnotice: /Stage[2]/Hdp-oozie::Service/Hdp::Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/returns: /usr/lib/oozie/oozie-server/bin/catalina.sh: line 386: /var/run/oozie/oozie.pid: Permission denied^[[0m^[[1;35merr: /Stage[2]/Hdp-oozie::Service/Hdp::Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/returns: change from notrun to 0 failed: su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh' returned 1 instead of one of [0] at /var/lib/ambari-agent/puppet/modules/hdp/manifests/init.pp:340^[[0m^[[0;36mnotice: /Stage[2]/Hdp-oozie::Service/Hdp::Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/Anchor[hdp::exec::exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh'::end]: Dependency Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh'] has failures: true^[[0m^[[0;33mwarning: /Stage[2]/Hdp-oozie::Service/Hdp::Exec[exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh']/Anchor[hdp::exec::exec su - ooziexx -c 'cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-start.sh'::end]: Skipping because of failed dependencies^[[0m^[[0;36mnotice: /Stage[2]/Hdp-oozie::Service/Hdp-oozie::Service::Directory[/var/log/oozie]/Hdp::Directory_recursive_create[/var/log/oozie]/Hdp::Directory[/var/log/oozie]/File[/var/log/oozie]/owner: owner changed 'oozie' to 'ooziexx'^[[0m^[[0;36mnotice: /Stage[2]/Hdp-oozie::Service/Hdp-oozie::Service::Directory[/var/log/oozie]/Hdp::Directory_recursive_create[/var/log/oozie]/Hdp::Directory[/var/log/oozie]/File[/var/log/oozie]/group: group changed 'oozie' to 'hadoopxx'^[[0m^[[0;36mnotice: /Stage[2]/Hdp-oozie::Service/Hdp-oozie::Service::Directory[/var/run/oozie]/Hdp::Directory_recursive_create[/var/run/oozie]/Hdp::Directory[/var/run/oozie]/File[/var/run/oozie]/owner: owner changed 'oozie' to 'ooziexx'^[[0m^[[0;36mnotice: /Stage[2]/Hdp-oozie::Service/Hdp-oozie::Service::Directory[/var/run/oozie]/Hdp::Directory_recursive_create[/var/run/oozie]/Hdp::Directory[/var/run/oozie]/File[/var/run/oozie]/group: group changed 'oozie' to 'hadoopxx'^[[0m^[[0;36mnotice: Finished catalog run in 9.36 seconds^[[0m,0 ,0 
Capture user for auditing config changes,Add the ability to capture username and save in the table for config mappings. This applies to cluster and host level,0 ,0 
Ambari needs to set right path for GC log directory of Hbase process.,Ambari needs to set right path for GC log directory of Hbase process.,0 ,0 
Sometimes stale host / host component indicators are shown,,0 ,0 
After upgrading ambari from 1.2.2.5 to 1.2.3.6 the server throws 500 error when starting/stopping any service,After upgrading ambari from 1.2.2.5 to 1.2.3.6 the server throws 500 error when starting/stopping any service,0 ,0 
Datanode Start fails in secure cluster.,,1 ,0 
Host status filter not restored on Hosts page when navigating back,,0 ,0 
Fix unit tests for Ambari Web,Fix currently failing unit tests.,0 ,0 
TEST BROKEN : FAIL: test_upgradeCommand_executeCommand (TestActionQueue.TestActionQueue),TEST BROKEN : FAIL: test_upgradeCommand_executeCommand (TestActionQueue.TestActionQueue),0 ,0 
Remove '0.1' stack definition since its never been used and is redundant.,Remove '0.1' stack definition since its never been used and is redundant.,0 ,0 
Hadoop2 Monitoring: Jobs page should be hidden when HDP 2.0.x stack is installed,When a HDP 2.0.x stack is installed  the Jobs page should be hidden.,0 ,0 
Update mock json data for Test mode,,0 ,0 
Agent heartbeat lost during install,Agent heartbeat can become lost during install. The underlying issue is that during install  various yum commands are executed for component installation. However  the heartbeat ALSO performs a 'yum -C repolist'. If that command is taking a long time  the yum process can become deadlocked. The results of the repolist'ing are not used at this time  so remove it until needed.,0 ,0 
Ambari has a deadlock when re-installing after reboot of cluster nodes,Java stack information for the threads listed above:==================================================='Thread-2': at org.apache.ambari.server.state.ServiceImpl.getDesiredConfigs(ServiceImpl.java:240) waiting to lock &lt;0x000000077b356dd0&gt; (a org.apache.ambari.server.state.ServiceImpl$$EnhancerByGuice$$9e2acafa) at org.apache.ambari.server.state.ServiceComponentImpl.getDesiredConfigs(ServiceComponentImpl.java:292) locked &lt;0x000000077b39bce8&gt; (a org.apache.ambari.server.state.ServiceComponentImpl$$EnhancerByGuice$$af7a745c) at org.apache.ambari.server.state.svccomphost.ServiceComponentHostImpl.getDesiredConfigs(ServiceComponentHostImpl.java:1057) at org.apache.ambari.server.agent.HeartbeatMonitor.generateStatusCommands(HeartbeatMonitor.java:166) at org.apache.ambari.server.agent.HeartbeatMonitor.doWork(HeartbeatMonitor.java:137) at org.apache.ambari.server.agent.HeartbeatMonitor.run(HeartbeatMonitor.java:85) at java.lang.Thread.run(Thread.java:662)'main': at org.apache.ambari.server.state.ServiceComponentImpl.debugDump(ServiceComponentImpl.java:376) waiting to lock &lt;0x000000077b39bce8&gt; (a org.apache.ambari.server.state.ServiceComponentImpl$$EnhancerByGuice$$af7a745c) at org.apache.ambari.server.state.ServiceImpl.debugDump(ServiceImpl.java:354) locked &lt;0x000000077b356dd0&gt; (a org.apache.ambari.server.state.ServiceImpl$$EnhancerByGuice$$9e2acafa) at org.apache.ambari.server.state.cluster.ClusterImpl.debugDump(ClusterImpl.java:693) at org.apache.ambari.server.state.cluster.ClustersImpl.debugDump(ClustersImpl.java:517) at org.apache.ambari.server.controller.AmbariServer.run(AmbariServer.java:320) at org.apache.ambari.server.controller.AmbariServer.main(AmbariServer.java:432)Found 1 deadlock.,0 ,1 
ambari-server start script (ambari-server.py) will never use SERVER_START_CMD_DEBUG,The ambari-server.py start script has a command defined for starting the ambari-server in debug mode (SERVER_START_CMD_DEBUG  which turns on remote debugging)  but there is currently no option supported that will force the script to use the debug start commaand. I propose adding a --debug option so that you can run 'ambari-server start --debug' to activate remote debugging.,0 ,0 
Background operations popup does not automatically refresh the task log,,0 ,0 
Add unit tests for Utils,,0 ,0 
Reassign Master Wizard: refreshing page on step 2  3 or 4 breaks wizard,,0 ,0 
Change config loading mechanism to allow for different stack versions,,0 ,0 
Increase ambari-agent test coverage,ActionQueue.py missing 'Unrecognized command' testcase (L. 173) /src/test/python/TestActionQueue.py:42 unused test_RetryAction stub (retry is implemented in another way) /src/main/python/ambari_agent/ActionQueue.py:221 not covered case if commandresult&#91;&#39;exitcode&#39;&#93; != 0: /src/main/python/ambari_agent/ActionQueue.py:247 not covered case if command.has_key('roleCommand') and command&#91;&#39;roleCommand&#39;&#93; == 'START':PuppetExecutor.py configureEnviron/generate_repo_manifests/run_manifest/runCommand are not covered.PythonExecutor.py isSuccessfull is not testedRepoInstaller.py prepareReposInfo/generateFiles are not coveredshell.py is not covered,0 ,0 
Using an external MySQL / Oracle database for Oozie does not work,When setting up Oozie with an external database  the following commands are run:cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/oozie-setup.sh -hadoop 0.20.200 /usr/lib/hadoop/ -extjs /usr/share/HDP-oozie/ext.zip -jars /usr/lib/hadoop/lib/hadoop-lzo-0.5.0.jar:/usr/share/java/mysql-connector-java.jarThe above command succeeds.However  the next command fails:cd /var/tmp/oozie &amp;&amp; /usr/lib/oozie/bin/ooziedb.sh create -sqlfile oozie.sql -run setting OOZIE_CONFIG=${OOZIE_CONFIG:-/etc/oozie/conf} setting OOZIE_DATA=${OOZIE_DATA:-/var/lib/oozie} setting OOZIE_LOG=${OOZIE_LOG:-/var/log/oozie} setting CATALINA_BASE=${CATALINA_BASE:-/var/lib/oozie/oozie-server} setting CATALINA_TMPDIR=${CATALINA_TMPDIR:-/var/tmp/oozie} setting CATALINA_PID=${CATALINA_PID:-/var/run/oozie/oozie.pid} setting JAVA_HOME=/usr/jdk/jdk1.6.0_31 setting OOZIE_LOG=/var/log/oozie/ setting CATALINA_PID=/var/run/oozie/oozie.pid setting OOZIE_DATA=/grid/0/hadoop/oozie/data/ setting JAVA_LIBRARY_PATH=/usr/lib/hadoop/lib/native/Linux-amd64-64Validate DB ConnectionError: Could not connect to the database: java.lang.ClassNotFoundException: com.mysql.jdbc.DriverStack trace for the error was (for debug purposes):--------------------------------------java.lang.Exception: Could not connect to the database: java.lang.ClassNotFoundException: com.mysql.jdbc.Driver at org.apache.oozie.tools.OozieDBCLI.validateConnection(OozieDBCLI.java:358) at org.apache.oozie.tools.OozieDBCLI.createDB(OozieDBCLI.java:168) at org.apache.oozie.tools.OozieDBCLI.run(OozieDBCLI.java:112) at org.apache.oozie.tools.OozieDBCLI.main(OozieDBCLI.java:63)Caused by: java.lang.ClassNotFoundException: com.mysql.jdbc.Driver at java.net.URLClassLoader$1.run(URLClassLoader.java:202) at java.security.AccessController.doPrivileged(Native Method) at java.net.URLClassLoader.findClass(URLClassLoader.java:190) at java.lang.ClassLoader.loadClass(ClassLoader.java:306) at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:301) at java.lang.ClassLoader.loadClass(ClassLoader.java:247) at java.lang.Class.forName0(Native Method) at java.lang.Class.forName(Class.java:169) at org.apache.oozie.tools.OozieDBCLI.createConnection(OozieDBCLI.java:347) at org.apache.oozie.tools.OozieDBCLI.validateConnection(OozieDBCLI.java:354) ... 3 more--------------------------------------,0 ,1 
Fix MySQL and Oracle DDL scripts according to last DB changes,user_name column was added to clusterconfigmapping and hostconfigmapping tables. This changes should be made to DDL scripts for Oracle and MySQL also.,0 ,0 
Ensure version values are used appropriately throughout Ambari,The current version of Ambari build is being used in several scenarios: Ensure Ambari Server installs the correct version of Ambari Agent Ensure that Ambari Server only accepts registration from correct version of Ambari Agent Ensure that DB version is compatible with Ambari Server  The DB version itself will be used to control DB upgrades  Towards this end the following open issues remain: Get the build version be automatically embedded in the version file Use the above for deploying agent as well as allowing agents to register Regarding DB version there are two possible paths:  Separate out DB version and have it be modified manually as needed Have the build version be used as DB version - this may make writing upgrade scripts little complicated as build version may change due to some proj mgmt decision,0 ,0 
Allow Security related configs to be modified via custom settings,,0 ,0 
Start/Stop button may stay enabled for 30-40 seconds after it has been clicked,Start/Stop button stays enabled for atleast 30-40 seconds after its been clicked already.,0 ,0 
Bad hosts query example in API docs,The example ...'hosts' : [ { 'href' : 'http://your.ambari.server/api/v1/clusters/c1/hosts/host1'  'Hosts' : { 'cluster_name' : 'c1'  'host_name' : 'some.cluster.host' } }  { 'href' : 'http://your.ambari.server/api/v1/clusters/c1/hosts/host2'  'Hosts' : { 'cluster_name' : 'c1'  'host_name' : 'another.cluster.host' } ]... should read ... 'hosts' : [ { 'href' : 'http://your.ambari.server/api/v1/clusters/c1/hosts/some.host'  'Hosts' : { 'cluster_name' : 'c1'  'host_name' : 'some.host' } }  { 'href' : 'http://your.ambari.server/api/v1/clusters/c1/hosts/another.host'  'Hosts' : { 'cluster_name' : 'c1'  'host_name' : 'another.host' } } ],0 ,0 
On 'install Options' page  when selecting 'Perform manual registration on hosts and do not use SSH' is setting 'Path to 64-bit JDK' disabled,On 'install Options' page  when selecting 'Perform manual registration on hosts and do not use SSH' is setting 'Path to 64-bit JDK' disabled(Screen Shot 2013-06-03 at 10.54.49 AM.png).Also path to 64-bit JDK JAVA_HOME' input field is enabled with unchecked check box(unchecked.png).Steps:1. Go to 'Install Options' page.Result:'Path to 64-bit JDK JAVA_HOME' input field is available for editing when check box is unchecked.,1 ,0 
Provide way to optionally enable two-way SSL for Server-Agent communication,The two-way SSL mechanism used during server-agent registration exists to protect communication. This is useful in production environments but in typical 'first use' or POC scenarios  having this level of security is not necessary. As well  certificate generation can be problematic causing failures.We need to provide a way to make this mechanism optional:1) By default  ship with Server-Agent Two-Way SSL off.2) At any time post install  a user should be able to turn on Two-Way SSL and turn it back off  etc.,1 ,0 
Configuration mapping metadata on ambari-web should be computed as per the stack selection.,,0 ,0 
Ambari Upgrade prcoess should preserve the old configs and add the new config options to the old config files.,The Ambari Upgrade process should preserve the old configs and add the new config options to the old config files.Currently we have it the other way around  that we copy the needed 3 properties from the old config files - this is wrong. We need to use the older config file and add the new options to the old config file. This is because the older config file can have all kinds of config option that the user might have used. We have to really really keep in mind usability of the product when fixing issues.,0 ,0 
500 Exception creating service component during install,I was installing a new cluster in my VM when the progress blocked on step 12. Looking on browser log  the PUTs for clusters desired_configs succeeded  but the very next call to create service component failed.&#91;POST&#93; http://dev.hortonworks.com:8080/api/v1/clusters/vmc/services?ServiceInfo/service_name=HDFSStatus Code:・ｼ500 Invalid arguments  clustername and componentname should be non-null and non-empty when trying to create a componentData uploaded:{'components':[{'ServiceComponentInfo':{'component_name':'NAMENODE'}} {'ServiceComponentInfo':{'component_name':'SECONDARY_NAMENODE'}} {'ServiceComponentInfo':{'component_name':'DATANODE'}} {'ServiceComponentInfo':{'component_name':'HDFS_CLIENT'}}]}:Exception on server console:Mar 21  2013 11:25:09 AM com.sun.jersey.spi.container.ContainerResponse mapMappableContainerExceptionSEVERE: The RuntimeException could not be mapped to a response  re-throwing to the HTTP containerjava.lang.IllegalArgumentException: Invalid arguments  clustername and componentname should be non-null and non-empty when trying to create a component at org.apache.ambari.server.controller.AmbariManagementControllerImpl.createComponents(AmbariManagementControllerImpl.java:387) at org.apache.ambari.server.controller.internal.ComponentResourceProvider$1.invoke(ComponentResourceProvider.java:88) at org.apache.ambari.server.controller.internal.ComponentResourceProvider$1.invoke(ComponentResourceProvider.java:85) at org.apache.ambari.server.controller.internal.AbstractResourceProvider.createResources(AbstractResourceProvider.java:229) at org.apache.ambari.server.controller.internal.ComponentResourceProvider.createResources(ComponentResourceProvider.java:85) at org.apache.ambari.server.controller.internal.ClusterControllerImpl.createResources(ClusterControllerImpl.java:131) at org.apache.ambari.server.api.services.persistence.PersistenceManagerImpl.create(PersistenceManagerImpl.java:75) at org.apache.ambari.server.api.handlers.QueryCreateHandler.persist(QueryCreateHandler.java:163) at org.apache.ambari.server.api.handlers.QueryCreateHandler.handleRequest(QueryCreateHandler.java:68) at org.apache.ambari.server.api.services.BaseRequest.process(BaseRequest.java:98) at org.apache.ambari.server.api.services.BaseService.handleRequest(BaseService.java:73) at org.apache.ambari.server.api.services.ServiceService.createServices(ServiceService.java:114) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597),0 ,0 
UI allows adding already existing properties to custom core-site.xml /hdfs-site.xml settings and creates confusion,Steps:1. Go to 'Services' page.2. Select 'HDFS' service.3. Select 'Configs' tab.4. Open 'Custom core-site.xml' panel.5. Add property with name 'ipc.client.idlethreshold' to this panel.Result:Property with name 'ipc.client.idlethreshold' was added to 'Custom core-site.xml' panel. But there is already presented property with same name in 'core-site.xml' file. After saving added property was disappeared from UI  and after service starting value of the old was changed to new (on UI and in 'core-site.xml' file).Expected result:UI should not allow to add property with existing name in specified file.,0 ,0 
Security Wizard: navigation not locked down  causes artifacts  and other unwanted side effects,,1 ,0 
API call to get 'metrics/cpu' does not work for NameNode and JobTracker host components,1. http://ambari:8080/api/v1/clusters/cluster/services?fields=components/host_components/metricsincludes all metrics for NameNode and JobTracker  including cpu metrics.2. http://ambari:8080/api/v1/clusters/cluster/services?fields=components/host_components/metrics/cpudoes not return cpu metrics for NameNode and JobTracker,0 ,0 
Enhance processing of ojdbc.jar before starting ambari server,Enhancements: Read RESOURCE_DIR from the ambari.properties Ask user twice to place drivers to /usr/share/java,0 ,0 
Unit Tests: Added tests to install wizard for step 3  5  10,,0 ,0 
Intermittent test failure with HBase port Scanner test.,This test fails sometimes and is not very reliable.,0 ,0 
Security Wizard: webhcat Server start fails on enabling security,This happens when templeton.kerberos.principal property is set to HTTP/_HOST@&lt;realm name&gt; instead of HTTP/&lt;internal host name&gt;@&lt;realm name&gt;,1 ,0 
Show installed stack and its services,List the installed stack and its services in Admin &gt; Cluster page.,0 ,0 
Unit Tests: Added tests to models,Added unit tests to models: Rack  Host  HostComponent.,0 ,0 
Add Host Wizard: show info about manual steps required on a secure cluster,When a cluster is in secure mode  there are additional manual steps that need to be performed when adding new hosts to the cluster.In the Review page  add a prominent box with a red background and display the following text:You are running your cluster in secure mode. You must set up the keytabs for all the hosts you are adding before you proceed.'Upon clicking 'Deploy'  show a confirmation popup with the text:Before you proceed  please make sure that the keytabs have been set up on the hosts you are adding per the instructions on the Review page. Otherwise  the assigned components will not be able to start properly on the hosts being added. OK CancelNote that the extra message and confirmation popup should show only when security is enabled on the cluster.,0 ,0 
Add unit tests for ambari-server python changes,AMBARI-2174 - Add missing unit tests for the code changes,0 ,0 
Bootstrap is broken for ambari web with RHEL-5.8,Steps:1. Install ambari-server.2. Go to 'Install Options' page.3. Set the hosts list and ssh-key  click 'Next' button.Result:Ambari Web is blocked in 'Confirm Hosts'. Confirming was not ended after not less than 40 minutes.,0 ,0 
ambari-server setup borken in trunk,install_jce_manually() in the download_jdk() result in fatal exception.Checking JDK...INFO: Loading properties from /etc/ambari-server/conf/ambari.propertiesERROR: Error getting ambari propertiesERROR: Exiting with exit code -1. Reason: Downloading or installing JDK failed: 'Fatal exception: Error getting ambari properties  exit code -1'. Exiting.,0 ,0 
Add support for 'classic' dashboard,,0 ,0 
ambari-server setup should allow user to change database password,If we run setup second time. Amabri should allow user to change the DB password for the ambari-user.Currently  the executed script should allow for this.command: &#91;&#39;su&#39;  &#39;-&#39;  &#39;postgres&#39;  &#39;--command=psql -f /var/lib/ambari-server/resources/Ambari-DDL-Postgres-CREATE.sql -v username=/&#39;&quot;ambari-server&quot;/&#39; -v password=&quot;/&#39;/&#39;&quot;&#39;&#93;,1 ,0 
Kerberos globals are shown in HDFS config page during install,,0 ,0 
Installer Wizard step-6: NameNode and SNameNode should not be co-hosted by default on multinode cluster.,,0 ,0 
HDFS Config page is broken in testMode on trunk,HDFS Config page (post-install) does not load when App.testMode = true,0 ,0 
Set default widgets to show for the Dashboard,,0 ,0 
Bootstrap failed on rhel 5.6,STDOUTTraceback (most recent call last):File '/tmp/setupAgent.py'  line 192  in ?main(sys.argv)File '/tmp/setupAgent.py'  line 188  in mainsys.exit(runAgent(passPhrase  expected_hostname))File '/tmp/setupAgent.py'  line 80  in runAgentagent_retcode = subprocess.call('/usr/sbin/ambari-agent start --expected-hostname={0}'.format(expected_hostname)  shell=True)AttributeError: 'str' object has no attribute 'format'Error seems to be caused by python 2.4 version.,0 ,0 
Ambari server start fails with reconfigured user,STR:1) Run ambari-server setup.2) Choose custom user  user1.3) Delete ambari.user from ambari.properties.4) Run ambari-server setup.5) Choose custom user  different from choosen in step 2  user2.6) Run ambari-server start.Got error:ambari-server startUsing python /usr/bin/python2.6Starting ambari-serverHave root privileges.Checking iptables...iptables is disabled nowRunning server: &#91;&#39;/bin/su&#39;  &#39;user2&#39;  &#39;-s&#39;  &#39;/bin/sh&#39;  &#39;-c&#39;  &#39;/usr/jdk64/jdk1.6.0_31/bin/java -server -XX:NewRatio=3 -XX:+UseConcMarkSweepGC -XX:-UseGCOverheadLimit -XX:CMSInitiatingOccupancyFraction=60 -Xms512m -Xmx2048m -cp /etc/ambari-server/conf:/usr/lib/ambari-server/*:/usr/lib64/qt-3.3/bin:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin:/usr/lib/ambari-server/* org.apache.ambari.server.controller.AmbariServer &gt;/var/log/ambari-server/ambari-server.out 2&gt;&amp;1 &amp; echo $! &gt; /var/run/ambari-server/ambari-server.pid&#39;&#93;done.sh: /var/run/ambari-server/ambari-server.pid: Permission deniedsh: /var/log/ambari-server/ambari-server.out: Permission denied,0 ,0 
Security wizard: smoke test for services fails with customized service user names.,,1 ,0 
Upgrade from 1.2.2/1.2.3.7 to 1.2.5 fails because the ddl script does not work - metainfo version change is broken.,Upgrade from 1.2.2/1.2.3.7 to 1.2.5 fails because the ddl script does not work - metainfo version change is broken.Again we need thorugh testing around this. Please make sure we have tested 1.2.2 and 1.2.3  1.2.4 upgrade to 1.2.5.,0 ,0 
Add unit tests for bootstrap and setupAgent python scripts for the server.,Add unit tests for bootstrap and setupAgent python scripts for the server.We need to find gaps on the bootstrap and setupagent script and add unit tests for them.,0 ,0 
Create command line script to manipulate Ambari configurations (get  set  add  delete),We need a script which can manually set the configs when UI is not able to  or does not support.,0 ,0 
Hive/Oozie database settings should accept custom JDBC URLs,Ran into issues setting up Hive and Oozie with an Oracle database.1. We are hard-coding port 1521 for the JDBC URL. 2. There are two types of JDBC URLs for Oracle: jdbc:oracle:thin:@&#91;HOST&#93;&#91;:PORT&#93;:SID jdbc:oracle:thin:@//&#91;HOST&#93;&#91;:PORT&#93;/SERVICEWe are making the assumption that it is the latter  but this may not work depending on how Oracle is set up.3. We prompt for the 'Database Name'. In Oracle context  this could be the SID or SERVICE NAME  but it's not clear what this is.As a solution to all of the above  we will construct the JDBC URL based on the database type  host  and name for Hive/Oozie and present it to the user as an editable text field during install.Post-install  the JDBC URL remains editable  but does not change automatically as changes other database-related parameters.,0 ,0 
Remove unnecessary check for hostnames/ service name which is wrong.,Remove unnecessary check for hostnames/ service name which is wrong.,0 ,0 
Ambari bootstrap actions report success even if a failure happened,Sometimes  bootstrap actions reports success even if it has failed host tasks:&lt;bootStrapRequest&gt; &lt;status&gt;SUCCESS&lt;/status&gt; &lt;hostsStatus&gt; &lt;hostName&gt;andromeda54.hi.inet&lt;/hostName&gt; &lt;status&gt;FAILED&lt;/status&gt; &lt;statusCode&gt;1&lt;/statusCode&gt; &lt;log&gt; [...] &lt;/log&gt; &lt;/hostsStatus&gt; &lt;hostsStatus&gt; &lt;hostName&gt;andromeda55.hi.inet&lt;/hostName&gt; &lt;status&gt;FAILED&lt;/status&gt; &lt;statusCode&gt;1&lt;/statusCode&gt; &lt;log&gt; [...] &lt;/log&gt; &lt;/hostsStatus&gt; &lt;log&gt; [...] &lt;/log&gt;&lt;/bootStrapRequest&gt;,0 ,0 
Dashboard page has a lot of footer padding,This ticket solved:1. Dashboard page has padding space under footer.2. When a widget got deleted  the page scroll to top.(page should stay in place),0 ,0 
shell.killprocessgrp is not working in a reliable way,We have noticed an issue where shell.killprocessgrp is not working correctly. We have seen a scenario where namenode start takes a long time when on a secure cluster the jce policy is unavailable. After 10 minutes when the agent tries to kill the puppet process it invariably fails.We need to run some experiment (perhaps using long running puppet processes) to ensure that shell.killprocessgrp works as expected.Also  we need to verify that the behavior is as expected on both RHEL and Suse.,0 ,0 
Issues with setup ldap,I got this blow-up (when bind anon was either false or I just pressed returnBind anonymously true/false (false):====================Review Settings====================authentication.ldap.primaryUrl: my.ldap:389authentication.ldap.secondaryUrl: asdauthentication.ldap.useSSL: falseauthentication.ldap.usernameAttribute: uidauthentication.ldap.baseDn: basednauthorization.userRoleName: userauthorization.adminRoleName: adminauthentication.ldap.bindAnonymously: falseTraceback (most recent call last):File '/usr/sbin/ambari-server.py'  line 3047  in &lt;module&gt;main()File '/usr/sbin/ambari-server.py'  line 2891  in mainsetup_ldap()File '/usr/sbin/ambari-server.py'  line 2353  in setup_ldapprint('%s: %s' % (property  ldap_property_value_mapproperty))KeyError: 'authentication.ldap.managerDn',0 ,0 
Security Wizard: show which principals and keytabs need to be created on which hosts,Currently it is very difficult to know what principals and keytabs need to be created on which hosts.We should present this information to the end user in a format that is easy to consume.The user running the wizard may not be the one who will be creating keytabs and principals. We can expose the capability to download a csv file and send it to the appropriate person who may parse the data to create a script to generate principals/keytabs (or do so manually).Display the attached as a popup after Configure Services step is done.Let's show it as a popup so that we don't affect any existing navigation/flow.For generating the content:Keytab paths are based on the user inputPrincipal names are based on the user inputNameNode host: show the nn and HTTP principals and keytab pathsJobTracker host: show the jt principal and keytab pathOozie Server host: show the oozie and HTTP principals and keytab pathsNagios Server host: show the nagios principal and keytab pathHBase Master host: show the hbase principal and keytab pathHive Server host: show the hive principal and keytab pathWebHCat Server host: show the HTTP principal and keytab pathZooKeeper Server host: show the zookeeper principal and keytab pathDataNode host: show the dn principal and keytab pathTaskTracker host: show the tt principal and keytab pathRegionServer host: show the hbase principal and keytab pathIf there are duplicated principals on the same host  display it only once.Clickng on 'Download CSV' downloads the CSV file ('host-principal-keytab-list.csv'). The same content  except each row is a comma-delimited list with a /n at the end.,0 ,0 
Remove dependence on dfs_datanode_http_address global for Nagios checks,ambari-agent/src/main/puppet/modules/hdp-nagios/templates/hadoop-services.cfg.erb shows the following:# HDFS::DATANODE Checksdefine service { hostgroup_name slaves use hadoop-service service_description DATANODE::DataNode process down servicegroups HDFS check_command check_tcp!&lt;%=scope.function_hdp_template_var('dfs_datanode_http_address')%&gt;!-w 1 -c 1 normal_check_interval 1 retry_check_interval 0.5 max_check_attempts 3}define service { hostgroup_name slaves use hadoop-service service_description DATANODE::DataNode storage full servicegroups HDFS check_command check_datanode_storage!&lt;%=scope.function_hdp_template_var('dfs_datanode_http_address')%&gt;!90%!90% normal_check_interval 5 retry_check_interval 1 max_check_attempts 2}We need to remove dependence on dfs_datanode_http_address and use the actual config property like:hdp_get_port_from_url($hdfs-site['dfs.datanode.http.address']),0 ,0 
Cleanup setup https flow,Expected flow:[root@localhost ~]# ambari-server setup-httpsUsing python /usr/bin/python2.6Setting up HTTPS properties...Do you want to configure HTTPS [y/n] (y)?SSL port (8443) ? Please enter path to Certificate: /some/path/on/my/host/server.crtPlease enter path to Private Key: /some/path/on/my/host/server.keyPlease enter password for Private Key:Importing and saving certificate...done.NOTE: Reset Ambari Server to apply changes ('ambari-server restart|stop|start')Ambari Server 'HTTPS setup' completed successfully. Exiting.,0 ,0 
Cannot add property mapred.task.tracker.task-controller,,1 ,0 
Decommission data node not working in secure mode,Decommission datanode does not do kinit before refresh.,0 ,0 
Add download CSV action for security wizard,We need CSV content which shows which principals  keytabs etc. end up on the various hosts. This will be useful in scripts or other tools which can create appropriate environment.,0 ,0 
Zookeeper smoke test failing in secure cluster,Zookeeper smoke test failing in secure cluster,0 ,0 
Add helpful message when not able to download jdk with setup options for the user to be able to specify the jdk.,Add helpful message when not able to download jdk with setup options for the user to be able to specify the jdk.,0 ,0 
Incorrect permission on taskcontroller.cfg,/etc/conf/hadoop/taskcontroller.cfgIn secure mode permissions are set to '400'.,1 ,0 
Some memory configs are set to -1 in Ambari,Some memory configs are set to -1 in ambari-mapred.cluster.reduce.memory.mb-mapred.jobtracker.maxtasks.per.job-mapred.cluster.max.reduce.memory.mb-mapred.cluster.map.memory.mb-mapred.job.map.memory.mb-mapred.job.reduce.memory.mb-mapred.cluster.max.map.memory.mbModify the stack definition to put default values as appropriate.,0 ,0 
Custom Repo URL cannot be set when non-root,The first iteration for creating custom repo URL persisted the new URL to disk. This poses a problem when running Ambari as non-root because the file system is owned by root. Change the implementation to save the override in the metainfo table.,0 ,0 
Regression: Agent external hostname is not verified during bootstrap with no warnings,When confirming hosts using external addresses bootstrapping should be failed immediately and a warning should be logged. Right now this functionality is broken  neither warning in log nor failing immediately present,0 ,0 
Simplify Local Repo setup in installer UI,Enhance the UI to use stacks API to give user a choice of stacks and be able to customize repository locations.,0 ,0 
Security Wizard: Create separate page for principal/keytab,Add step 'Create Principals and Keytabs' to Security wizard.,0 ,0 
Ctrl+C during ambari-server setup prints out a python stack trace,We should be able to catch KeyBoardInterrupt in ambari-server main and print a useful message like:'Aborting ... Keyboard Interrupt.' and avoid the stack trace for the user.,0 ,0 
Setup LDAP does not validate true/false response,Garbage responses to true/false questions just pass thru. Notice below  just put in garbage for Use SSL and that's what it would have written.Need validation to confirm they enter either 1) return to accept default or 2) the word true or 3) the word false. Else  inform the user'Property must be 'true' or 'false'.' and ask again.Secondary URL :Use SS &#91;true/false&#93; (false): asdUser name attribute* (uid):Base DN* :Property cannot be blank.Base DN* : asdBind anonymously* true/false (false):Manager DN* :asdEnter Manager Password*:Re-enter password:Passwords do not matchEnter Manager Password*:Re-enter password:====================Review Settings====================authentication.ldap.primaryUrl: my.url:849authentication.ldap.useSSL: asdauthentication.ldap.usernameAttribute: uid,1 ,0 
Using another user for ambari server user create a local group for the ambari server user with same name.,Using an ambari-qa user (that is a ldap user and he has hadoop set up as a primary ldap group) [root@va21 ldap]# id ambari-qauid=524(ambari-qa) gid=522(hadoop) groups=522(hadoop)causes ambari-server setup to create an ambari-qa local group (at /etc/group). ambari-qa:x:601:ambari-qa[root@va21 ldap]# id ambari-qauid=524(ambari-qa) gid=522(hadoop) groups=522(hadoop) 601(ambari-qa)Ldap users and groups are transparent for ambari-server  it starts well.The problem is that additional group is created.,0 ,0 
Host Check report show hosts without issues,Report contains hosts  which don't have issues  but should show 'A space delimited list of hosts which have issues'.,0 ,0 
JS Error when deleting a widget after sorting it on remove/edit sign,,0 ,0 
HDP installation fails due to puppet syntax error,namenode_host is not an hash or array when accessing it with 0 at /var/lib/ambari-agent/puppet/modules/hdp/manifests/params.pp:70 on node host1.,0 ,0 
Properties of the same name cannot be added to different custom site.xml's,Steps (Installer Wizard):Go to 'Customize Services' page.Select 'HDFS' tab.Add custom property 'xxx' to 'Custom core-site.xml' panel.Try add custom property 'xxx' to 'Custom hdfs-site.xml' panel.Result:Custom property can not be added to 'Custom hdfs-site.xml' panel (see attachment).Steps (Ambari monitoring UI):Go to 'Customize Services' page.Select 'HDFS' tab.Add custom property to 'Custom core-site.xml' panel (for example  'install-test-core-site').Continue and end hadoop installation.Go to 'Services' page.Select 'MapReduce' tab.Try add custom property 'install-test-core-site' to 'Custom mapred-site.xml' panel.Result:Custom property can not be added to 'Custom mapred-site.xml' panel (see attachment).,0 ,0 
Add Quick Links (Web UI) for Oozie  Hue  Nagios  Ganglia,There are no quick links for Oozie. Similarly  some other services also are missing the quick links.,0 ,0 
'kdestroy' not required for zookeeper smoke test,zookeeper smoke test passes without having to 'kdestroy' on the user running the smoke test.,0 ,0 
WebHCat and Oozie services does not start on RHEL5 with enabled security because of 'CRITICAL: Error doing kinit for nagios',FE only has support to provide single path for kinit. As Ambari supports mixed OS deployment it cannot be guaranteed that kinit exists at the same path on all nodes. FE should allow providing a set of look-up paths for kinit as well as the BE should support a set of default lookup paths.,0 ,0 
Rename agent.fqdn property in ambari.props to server.fqdn,lets just rename agent -&gt; server,0 ,0 
Host Checks: truncation on checked processes makes it difficult to know the actual processes in conflict,Processes are truncated too short and can't really tell what's in conflict. Since there is a lot of space on the right (in fact  the hostname column is too far to the left compared to other sections)  we should display more characters (with hover tooltip showing full text).,0 ,0 
Popover with config name goes beyond the container,See attachecd screenshot.,0 ,0 
Wrong info on Services > Summary tab for DataNodes Live  TaskTrackers Live  RegionServers live,1. Install cluster2. On the host with SNameNode  we also have a region server3. Stop snamenode component on that host4. Services &gt; hbase &gt; summary shows region server is not liveAlso after stopping DataNode or TaskTracker  component status changes are not reflected on Services &gt; summary tab,0 ,0 
Host cleanup left two packages(ambari-log4j  libconfuse),,0 ,0 
Dashboard Widgets: 'hover to show details' experience is jarring,,0 ,0 
Reset the latest stack version for 1.2.5,Reset the latest stack version for 1.2.5,0 ,0 
Perf: Service summary view inefficiently binds to host components,In ambari-web/app/views/main/service/info/summary.js#hostComponentsUpd()  is called per each hostComponent's host and master property change. On a 150 node cluster  we get like 300 calls just for this method.Due to this  service_mapper  which usually maps in 600ms  takes now 5.8s.,0 ,1 
Dashboard Metrics legend size increased unexpectedly on mouseover from line space,This happened in a very specific situation.1. Put mouse on the line space around a metric widget.2. hover on the widget with mouse down.Result:The legend show up as a strange bigger size.,0 ,0 
Security CSV cleanup,Should say 'Hive Metastore and HiveServer2'  not just HiveServer2. Even though they are co-located master components  let's make it clear this principal is for both include keytab file column. In addition to the keytab full path column (/etc/security/keytabs/jt.service.keytab)  include a column with just the filename (jt.service.keytab). Easier to copy/paste/parse if you want to use the CSV file.,0 ,0 
Going back to Customize Services page from the Install page resets certain directory values,Steps to reproduce: Install using non-default directories Upon install failure  go back to Customize Services page from the left nav. Certain directories (NN dirs  SNN dir  DN dirs  Oozie Data Dir  ZK Dir  etc) are reverted back to the default. Other parameters are not reverted back.,0 ,0 
Update Ember-I18n,,0 ,0 
Read timeout issues in Oracle JDBC connections where read has a long timeout,Read timeout issues in Oracle JDBC connections where read has a long timeout. This happens when the read timeout is too long. In order to set appropriate timeout  add specially prefixed values in ambari.properties,0 ,1 
Ambari-server can not find password for remote database with password encryption enabled,Performed cluster setup as proposed at E2E test scenario. ambari-server setupambari-server setup-ldapambari-server encrypt-passwordsambari-server setup-httpsambari-server startServer does not start. It complains about missing password file / db password alias19:03:36 249 INFO Configuration:300 - Generation of file with password19:03:37 320 INFO CredentialProvider:146 - action =&gt; PUT  alias =&gt; ambari.db.password19:03:37 885 INFO Configuration:313 - Reading password from existing file19:03:38 838 INFO CredentialProvider:146 - action =&gt; PUT  alias =&gt; ambari.ldap.manager.password19:12:02 925 INFO Configuration:313 - Reading password from existing file19:12:02 946 INFO Configuration:324 - API SSL Authentication is turned on.19:12:02 946 INFO Configuration:329 - Reading password from existing file19:12:02 948 INFO Configuration:481 - Hosts Mapping File null19:12:02 951 INFO HostsMap:60 - Using hostsmap file null19:12:04 467 INFO MasterKeyServiceImpl:209 - Loading from persistent master: #1.0# Fri  Jul 12 2013 19:03:34.71719:12:06 016 INFO AmbariServer:446 - Getting the controller19:12:11 146 INFO CertificateManager:68 - Initialization of root certificate19:12:11 147 INFO CertificateManager:70 - Certificate exists:false19:12:11 147 INFO CertificateManager:137 - Generation of server certificate19:12:16 383 INFO ShellCommandUtil:43 - Command openssl genrsa -des3 -passout pass:n15KV1q6aWRZIP86XAjpTdbTaKo0HHWIsTuaOPZQdxycChECKG -out /var/lib/ambari-server/keys/ca.key 4096 was finished with exit code: 0 - the operation was completely successfully.19:12:16 431 INFO ShellCommandUtil:43 - Command openssl req -passin pass:n15KV1q6aWRZIP86XAjpTdbTaKo0HHWIsTuaOPZQdxycChECKG -new -key /var/lib/ambari-server/keys/ca.key -out /var/lib/ambari-server/keys/ca.crt -batch was finished with exit code: 0 - the operation was completely successfully.19:12:16 483 INFO ShellCommandUtil:43 - Command openssl x509 -passin pass:n15KV1q6aWRZIP86XAjpTdbTaKo0HHWIsTuaOPZQdxycChECKG -req -days 365 -in /var/lib/ambari-server/keys/ca.crt -signkey /var/lib/ambari-server/keys/ca.key -out /var/lib/ambari-server/keys/ca.crt was finished with exit code: 0 - the operation was completely successfully.19:12:16 496 INFO ShellCommandUtil:43 - Command openssl pkcs12 -export -in /var/lib/ambari-server/keys/ca.crt -inkey /var/lib/ambari-server/keys/ca.key -certfile /var/lib/ambari-server/keys/ca.crt -out /var/lib/ambari-server/keys/keystore.p12 -password pass:n15KV1q6aWRZIP86XAjpTdbTaKo0HHWIsTuaOPZQdxycChECKG -passin pass:n15KV1q6aWRZIP86XAjpTdbTaKo0HHWIsTuaOPZQdxycChECKG was finished with exit code: 0 - the operation was completely successfully.19:12:16 883 INFO AmbariServer:123 - ********* Meta Info initialized **********19:12:16 896 INFO ClustersImpl:88 - Initializing the ClustersImpl19:12:17 115 ERROR Configuration:610 - Error reading from credential store.19:12:17 116 ERROR Configuration:616 - Cannot read password for alias = /etc/ambari-server/conf/password.dat19:12:17 117 ERROR AmbariServer:455 - Failed to run the Ambari Serverjava.lang.RuntimeException: Unable to read database password at org.apache.ambari.server.configuration.Configuration.readPasswordFromFile(Configuration.java:596) at org.apache.ambari.server.configuration.Configuration.getRcaDatabasePassword(Configuration.java:583) at org.apache.ambari.eventdb.webservice.WorkflowJsonService.setDBProperties(WorkflowJsonService.java:95) at org.apache.ambari.server.controller.AmbariServer.performStaticInjection(AmbariServer.java:437) at org.apache.ambari.server.controller.AmbariServer.run(AmbariServer.java:125) at org.apache.ambari.server.controller.AmbariServer.main(AmbariServer.java:452)Caused by: java.io.FileNotFoundException: File '/etc/ambari-server/conf/password.dat' does not exist at org.apache.commons.io.FileUtils.openInputStream(FileUtils.java:265) at org.apache.commons.io.FileUtils.readFileToString(FileUtils.java:1457) at org.apache.commons.io.FileUtils.readFileToString(FileUtils.java:1475) at org.apache.ambari.server.configuration.Configuration.readPasswordFromFile(Configuration.java:594) ... 5 more19:12:17 118 ERROR AmbariServer:420 - Error stopping the serverjava.lang.NullPointerException at org.apache.ambari.server.controller.AmbariServer.stop(AmbariServer.java:418) at org.apache.ambari.server.controller.AmbariServer.main(AmbariServer.java:457)Content of ambari.properties:server.jdbc.rca.driver=oracle.jdbc.driver.OracleDriverauthentication.ldap.managerDn=uid=hdfs ou=people ou=dev dc=apache dc=orgauthentication.ldap.primaryUrl=localhost:389server.jdbc.rca.url=jdbc:oracle:thin:@ip-10-34-79-165.ec2.internal:1521/XEserver.connection.max.idle.millis=900000server.jdbc.port=1521server.version.file=/var/lib/ambari-server/resources/versionserver.jdbc.rca.user.passwd=/etc/ambari-server/conf/password.datapi.authenticate=truejce_policy.url=http://public-repo-1.hortonworks.com/ARTIFACTS/jce_policy-6.zipserver.persistence.type=remoteclient.api.ssl.key_name=https.keyauthentication.ldap.useSSL=falseambari-server.user=ambar-serverclient.api.ssl.port=8443authentication.ldap.usernameAttribute=uidserver.jdbc.user.name=ambariserver.jdbc.schema=XEjava.home=/usr/jdk64/jdk1.6.0_31server.os_type=redhat6api.ssl=truebootstrap.script=/usr/lib/python2.6/site-packages/ambari_server/bootstrap.pyclient.api.ssl.cert_name=https.crtauthentication.ldap.bindAnonymously=falseclient.security=ldapserver.jdbc.hostname=ip-10-34-79-165.ec2.internalresources.dir=/var/lib/ambari-server/resourcessecurity.passwords.encryption.enabled=truebootstrap.setup_agent.script=/usr/lib/python2.6/site-packages/ambari_server/setupAgent.pyserver.jdbc.driver=oracle.jdbc.driver.OracleDriverjdk.url=http://public-repo-1.hortonworks.com/ARTIFACTS/jdk-6u31-linux-x64.binsecurity.server.keys_dir=/var/lib/ambari-server/keysserver.jdbc.rca.user.name=ambariwebapp.dir=/usr/lib/ambari-server/webmetadata.path=/var/lib/ambari-server/resources/stacksserver.jdbc.url=jdbc:oracle:thin:@ip-10-34-79-165.ec2.internal:1521/XEserver.fqdn.service.url=http://169.254.169.254/latest/meta-data/public-hostnamebootstrap.dir=/var/run/ambari-server/bootstrapauthentication.ldap.baseDn=dc=apache dc=orgserver.jdbc.user.passwd=${alias=ambari.db.password}authentication.ldap.managerPassword=${alias=ambari.ldap.manager.password}server.jdbc.database=oraclesecurity.server.two_way_ssl=trueFile /etc/ambari-server/conf/password.dat is missingSetup flow:[root@ip-10-116-65-200 kerb]# ambari-server setupUsing python /usr/bin/python2.6Initializing...Setup ambari-serverChecking SELinux...SELinux status is 'enabled'SELinux mode is 'enforcing'Temporarily disabling SELinuxWARNING: SELinux is set to 'permissive' mode and temporarily disabled.OK to continue [y/n] (y)? yCustomize user account for ambari-server daemon [y/n] (n)? yEnter user account for ambari-server daemon (root):ambar-serverAdjusting ambari-server permissions and ownership...Checking iptables...iptables is disabled now. please reenable later.Checking JDK...Downloading JDK from http://public-repo-1.hortonworks.com/ARTIFACTS/jdk-6u31-linux-x64.bin to /var/lib/ambari-server/resources/jdk-6u31-linux-x64.binJDK distribution size is 85581913 bytesjdk-6u31-linux-x64.bin... 100% (81.6 MB of 81.6 MB)Successfully downloaded JDK distribution to /var/lib/ambari-server/resources/jdk-6u31-linux-x64.binTo install the Oracle JDK you must accept the license terms found at http://www.oracle.com/technetwork/java/javase/downloads/jdk-6u21-license-159167.txt. Not accepting will cancel the Ambari Server setup.Do you accept the Oracle Binary Code License Agreement [y/n] (y)? Installing JDK to /usr/jdk64Successfully installed JDK to /usr/jdk64/jdk1.6.0_31Downloading JCE Policy archive from http://public-repo-1.hortonworks.com/ARTIFACTS/jce_policy-6.zip to /var/lib/ambari-server/resources/jce_policy-6.zipSuccessfully downloaded JCE Policy archive to /var/lib/ambari-server/resources/jce_policy-6.zipCompleting setup...Configuring database...Enter advanced database configuration [y/n] (n)? ySelect database:1 - PostgreSQL (Embedded)2 - Oracle[1]:2Hostname [localhost]:ip-10-34-79-165.ec2.internalPort [1521]:Select Oracle identifier type:1 - Service Name2 - SID[1]:XEInvalid number.Select Oracle identifier type:1 - Service Name2 - SID[1]:1Service Name [ambari]:XEUsername [ambari]: Enter Database Password [bigdata]: WARNING: Before starting Ambari Server  you must copy the Oracle JDBC driver JAR file to /usr/share/java.Press &lt;enter&gt; to continue.Copying JDBC drivers to server resources...Configuring remote database connection properties...WARNING: Cannot find oracle sqlplus client in the path to load the Ambari Server schema. Before starting Ambari Server  you must run the following DDL against the database to create the schema sqlplus ambari/bigdata &lt; /var/lib/ambari-server/resources/Ambari-DDL-Oracle-CREATE.sql Press &lt;enter&gt; to continue.WARNING: The cli was not foundAmbari Server 'setup' completed with warnings.[root@ip-10-116-65-200 kerb]# less /etc/passwd,0 ,0 
Improve styles for HostCleanup code area,,0 ,0 
Add umask checks for host checks - we should alert if umask is not 022.,Add umask checks for host checks - we should alert if umask is not 022.,0 ,0 
Add a re-type new password field when changing passwords for ambari users,We should add a third text box to re-type the new password while changing the password for an ambari user.,0 ,0 
Host checks say pass when all hosts failed to register,When all hosts fail to register  there are no warnings  and hence we show OK for host checks.,0 ,0 
Security wizard: Relogin while on step3 without quitting the wizard throws JS error.,Steps to reproduce: Go to step-3 (Generate principals and keytabs) of Enable security wizard. Restart Amabri server. Refresh on step-3. ui will take you to login page. Entering correct credentials  user will be navigated again to step-3 of security wizard. At this point JS error is encountered.,0 ,0 
Start button not available for various components within 10 sec after stop operation finishes,Steps to reproduce: 1. Stop a component. 2. Wait for the corresponding BG operation to finish. Result: 'Start' button isn't available for the component within 10 seconds since stop operation finished in UI. It appears later.This happens cuz of update interval  it is set to 15 seconds (App.contentUpdateInterval)  that's why in some moments it can take up to 15 sec to update components status  after request is done.Solution: Create a seperate update interval specialy for updating host components. In config.js we even have App.componentsUpdateInterval = 6000; But this value was not used anywhere in code till now.,0 ,1 
setup ldap does not validate secondary url,setup ldap does not validate secondary url. It should validate the input (when entered) the same way as the primary.,0 ,0 
Error messages printed to log,Notice in the ambari-server snippet below a lot of these messages:ERROR Configuration:616 - Cannot read password for alias = nullSteps to reproduce:Setup serverSetup encrypt passwords  don't persist the keySetup httpsStart the server  provided master keyDo cluster install,0 ,0 
Enable Security Wizard stops on step '2. Save Configurations' and doesn't let the user leave the wizard,,0 ,0 
Datanode Live widget displays 0 dead when no datanode is live on a cluster.,,0 ,0 
Disable Show report for 0 issues,Report on Host Checks for 0 isses looks like:####################################### Host Checks Report## Generated: Tue Jul 09 2013 13:11:14 GMT+0300 (FLE Daylight Time)############################################################################# Hosts## A space delimited list of hosts which have issues.# Provided so that administrators can easily copy hostnames into scripts  email etc.######################################HOSTSShow Report button should be disabled for 0 issues or at least do not show HOSTS section in report.,0 ,0 
Disable security not working in web-ui testMode.,,1 ,0 
Host specific progress bar for a task has some inconsistencies,See the attached images. The third image added is a summary of what was going on.,0 ,0 
Implement a cleanup thread that removes files in ambari-agent data directory that are older than a configurable amount of time,Implement a cleanup thread that removes files in ambari-agent data directory that are older than a month or so(must be configurable).It's required  because the directory will grow unbounded if it's not cleaned up.,0 ,0 
Fix JS Unit tests after merge 1.4.0 to trunk,,0 ,0 
Make ambari web testMode work for installer wizard with HDP stack-2 selection.,Installer wizard with HDP stack-2 selection in test mode,0 ,0 
Disable autocomplete on form tag for Ambari UI.,,0 ,0 
hbase super user cannot submit jobs since Ambari creates hbase super user with uid<1000,Copytable jobs need to be submitted as the hbase super user however the uid for hbase super user created by Ambari has uid &lt; 1000,0 ,0 
Disallow actions upon host components on hosts that stopped heartbeating,On a host that stopped heartbeating  the UI shows actions to perform on host components. However  upon executing an action  the backend does not create any tasks and returns 200. The UI doesn't do anything in this case. Instead  the UI should disable action buttons in this case.,0 ,0 
While a host component is being installed (INSTALLING state)  it does not show up in the Host Detail page,Say Add Hosts wizard fails to add a host and the host components are in INSTALL_FAILED state. In this case  the UI displays the host component with a red gear and shows the action menu with the current state 'Install Failed' and the action 'Re-Install'. Once you invoke 'Re-Install'  the host component disappears from the UI. Once the host component finishes installing  it magically appears again.,0 ,0 
Hosts and Host Details page UI tweaks,1. Hosts &gt; Design around full hostname being displayed. Consider being able to show 40 characters and then truncate &gt; 40 chars 2. Hosts &gt; Show # control should persist when navigating around app  and after logout/login3. Hosts &gt; Make Components list an expand/collapse control instead of a list with abbreviations4. Host Details &gt; Move Components area above Summary area since the Component Controls are used very often (much more often than viewing the Summary area info).,0 ,0 
Misc logging changes,Additional logs:  When a task is timed-out/failed API requests to update component and component hosts   Remove logs  Do not log ganglia population time when its less than 5 second,0 ,0 
Security Wizard step 4: no hosts shown when clicking on the 'Start Services'/'Stop Services' link,Proceed to step 4 of security wizard  click on 'Start Services' or 'Stop Services' link.Result: popup window is shown with empty contentThis bug was happening due to js error 'Uncaught TypeError: Cannot call method 'filterProperty' of null' in setBackgroundOperationHeader: functionAfter background operation (host popup) popup was optimized for better peformace on large cluster this error showed up. New function on setting popup header  did not account that this popup (HostPopup) is used not only in BG operations  but also in security wizard.,0 ,0 
Jobs page: table is not striped and pagination is not disabled,To reproduce go to the Jobs page from top menu (do not open .../main/apps directly). Table is not striped and pagination buttons are enabled even if there is only one page.,0 ,0 
Stack 2.0.3  Hive Check execute fail,When installing Hadoop 2 stack  Hive service check fails to run.,0 ,0 
Customize Services page - Misc tab: incorrect behavior of popup window for changing user names,In firefoxSteps:Go to 'Customize Services' page.Select 'Misc' tab.Change username for HDFS  HBase or Group (do not move focus to other elements).Click 'Next' button.Result:Browser was switched to 'Review' page.Was opened popup window for changing properties depended with user names. User must to refresh the page for popup menu disappearing.,0 ,0 
Ozzie does not work with local FS user,Running jobs as a local FS user does not work work 2.0.* stack because of permissions on /tmp/hadoop-yarn/staging  which is the default staging dir.,0 ,1 
Host Checks > Show Report is showing bogus information for FILES AND FOLDERS,Host Checks popup is showing that /usr/lib/hadoop already exists.When I clicked on 'Show Reports'  it is showing '/usr/lib/hadoop/ /folder'. This doesn't make much sense. FILES AND FOLDERS/usr/lib/hadoop/ /folderThe API is showing: 'stackFoldersAndFiles' : [ { 'name' : '/usr/lib/hadoop'  'type' : 'directory' },0 ,0 
FE should show the error-details when it encounters error while persisting web client state,Error which occurred while requesting cluster status is not informative.Change url in request for cluster state  go to admin page and try to enable security.,1 ,0 
Cannot save HDFS configs with SNN in MAINTENANCE mode,,0 ,0 
Hadoop2 stack install should merge YARN MR2 options,YARN in current Hadoop 2 stack has only MR2 as application. Since it does not make sense to install YARN without a default application  and MR2 cannot be installed by itself  we should combine both into a single install option (see screenshot).,0 ,0 
YARN time series data needed for NodeManager statuses,We need API call for a graph which will show NodeManager status counts. NodeManagers can be in the following states: active  lost  unhealthy  rebooted  and decommissioned.,0 ,0 
YARN service summary additional information,We need to show below 2 additional information Across cluster memory - used/reserved/total Queues information if available,0 ,0 
Can't add from UI some queues in capacity-scheduler.xml,Properties of capacity-scheduler.xml are truncated by ' '. It make impossible to create multiple queues  please see http://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/CapacityScheduler.html,0 ,0 
Customize Services: directories are shown in comma-delimited format when revisiting,In the Install Wizard  Customize Services page shows multiple directories delimited by newlines.However  when revisiting the page (go back to Customize Services from the Review page  for example)  the directories are shown in comma-delimited format. We should always show the directories in newline-delimited format. Note that when we actually store the value  the directories are comma-delimited (which is correct).,0 ,0 
Dashboard refactor and Unit tests,,0 ,0 
Utility script to generate keytabs is broken,keytab Tar for each host is packaged including hostname. Untaring it on a host creates path starting with &lt;hostanme&gt;/&lt;actual path&gt;. Fix is to package the content inside the hostname directory excluding the hostname directory itself.,0 ,0 
HBase 0.95.2 - Logger doesn't work,Installing 0.95.2 from internal repo 2.0.5. hbase-daemon.sh defines a default logger of INFO RFA{{  when log4j.properties uses {{INFO DRFA. They should match  as startup generates an error and does not continue.We should stop over writing the log4j properties for hbase. This will allow for hbase log4j properties to be in sync with those that come with the rpms.,0 ,0 
Running Requests are not visibile on the UI since the API is not returning the running requests.,The issue is the following:getRequestsByTaskStatus behaves correctly and returns the latest N requests. Note that the N requests have M (M &gt;&gt; N) tasks.Then the call to findByRequestIds gets oldest N tasks where the requestId for tasks belong to the list returned by the first call. So instead of getting M tasks we only get N tasks that too N oldest tasks which are returned. As a result the call never returns that latest request/tasks. The fix is to drop the filter done by the calls findByRequestIds and findByRequestAndTaskIds. Filter should only be applied on the number of requests to be returned.,0 ,0 
YARN and ZK data directory names have ' ' at end,Installed the Hadoop2 stack and upon finishing the zk_data_dir in global  and yarn.nodemanager.local-dirs in yarn-site have the folder names suffixed with ' ' in API. Consequently  the folder names on system end up with a ' ' at end. Ex: /hadoop/yarn  and /hadoop/zookeeper .,0 ,0 
Restart service component fails if pid is reallocated,1. Stop secondary namenode.2. Edit the pid file  default location = /var/run/hadoop/hdfs/hadoop-hdfs-secondarynamenode.pid3. Change the pid to any other process pid that is currently running.4. Start secondary namenode.Outcome:Secondary namenode start command succeeds but secondary namenode does not start. (indicated by live status of the component).,0 ,0 
YARN time series data needed for AllocatedContainers,API call for a graph which will show time series for YARN Allocated containers.,0 ,0 
Host registration fails,Host registration fails with:INFO 2013-08-10 01:50:49 923 Controller.py:99 - Unable to connect to: https://c6401.ambari.apache.org:8441/agent/v1/register/c6403.ambari.apache.orgTraceback (most recent call last): File '/usr/lib/python2.6/site-packages/ambari_agent/Controller.py'  line 80  in registerWithServer ret = json.loads(response) File '/usr/lib64/python2.6/json/__init__.py'  line 307  in loads return _default_decoder.decode(s) File '/usr/lib64/python2.6/json/decoder.py'  line 319  in decode obj  end = self.raw_decode(s  idx=_w(s  0).end()) File '/usr/lib64/python2.6/json/decoder.py'  line 338  in raw_decode raise ValueError('No JSON object could be decoded')ValueError: No JSON object could be decodedambari-server.log is showing:01:55:22 732 WARN [qtp967966535-50] ServletHandler:514 - /agent/v1/register/c6401.ambari.apache.orgcom.google.gson.JsonSyntaxException: java.lang.IllegalStateException: Expected a string but was BEGIN_OBJECT at line 1 column 3680 at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:176) at com.google.gson.internal.bind.TypeAdapterRuntimeTypeWrapper.read(TypeAdapterRuntimeTypeWrapper.java:40) at com.google.gson.internal.bind.ArrayTypeAdapter.read(ArrayTypeAdapter.java:72) at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$1.read(ReflectiveTypeAdapterFactory.java:93) at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:172) at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$1.read(ReflectiveTypeAdapterFactory.java:93) at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:172) at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$1.read(ReflectiveTypeAdapterFactory.java:93) at com.google.gson.internal.bind.ReflectiveTypeAdapterFactory$Adapter.read(ReflectiveTypeAdapterFactory.java:172) at com.google.gson.Gson.fromJson(Gson.java:795) at com.google.gson.Gson.fromJson(Gson.java:761) at org.apache.ambari.server.api.GsonJsonProvider.readFrom(GsonJsonProvider.java:60) at com.sun.jersey.spi.container.ContainerRequest.getEntity(ContainerRequest.java:474) at com.sun.jersey.server.impl.model.method.dispatch.EntityParamDispatchProvider$EntityInjectable.getValue(EntityParamDispatchProvider.java:123) at com.sun.jersey.server.impl.inject.InjectableValuesProvider.getInjectableValues(InjectableValuesProvider.java:46) at com.sun.jersey.server.impl.model.method.dispatch.AbstractResourceMethodDispatchProvider$EntityParamInInvoker.getParams(AbstractResourceMethodDispatchProvider.java:153) at com.sun.jersey.server.impl.model.method.dispatch.AbstractResourceMethodDispatchProvider$TypeOutInvoker._dispatch(AbstractResourceMethodDispatchProvider.java:183) at com.sun.jersey.server.impl.model.method.dispatch.ResourceJavaMethodDispatcher.dispatch(ResourceJavaMethodDispatcher.java:75) at com.sun.jersey.server.impl.uri.rules.HttpMethodRule.accept(HttpMethodRule.java:288) at com.sun.jersey.server.impl.uri.rules.RightHandPathRule.accept(RightHandPathRule.java:147) at com.sun.jersey.server.impl.uri.rules.ResourceClassRule.accept(ResourceClassRule.java:108) at com.sun.jersey.server.impl.uri.rules.RightHandPathRule.accept(RightHandPathRule.java:147) at com.sun.jersey.server.impl.uri.rules.RootResourceClassesRule.accept(RootResourceClassesRule.java:84) at com.sun.jersey.server.impl.application.WebApplicationImpl._handleRequest(WebApplicationImpl.java:1469),0 ,0 
Nagios server fails to start with invalid configuration error,Nagios fails to start with invalid configuration error. (This is likely intermittent).Error: Configuration validation failed - when Nagios is started./usr/sbin/nagios -v /etc/nagios/nagios.cfgCopyright (c) 1999-2009 Ethan GalstadLast Modified: 03-15-2013License: GPLWebsite: http://www.nagios.orgReading configuration data... Read main config file okay...Processing object config file '/etc/nagios/objects/commands.cfg'...Processing object config file '/etc/nagios/objects/contacts.cfg'...Processing object config file '/etc/nagios/objects/timeperiods.cfg'...Processing object config file '/etc/nagios/objects/templates.cfg'...Processing object config file '/etc/nagios/objects/hadoop-hosts.cfg'...Processing object config file '/etc/nagios/objects/hadoop-hostgroups.cfg'...Processing object config file '/etc/nagios/objects/hadoop-servicegroups.cfg'...Processing object config file '/etc/nagios/objects/hadoop-services.cfg'...Processing object config file '/etc/nagios/objects/hadoop-commands.cfg'...Error: Could not find any hostgroup matching 'resourcemanager' (config file '/etc/nagios/objects/hadoop-services.cfg'  starting on line 292) Error processing object config files!***&gt; One or more problems was encountered while processing the config files... Check your configuration file(s) to ensure that they contain valid directives and data defintions. If you are upgrading from a previous version of Nagios  you should be aware that some variables/definitions may have been removed or modified in this version. Make sure to read the HTML documentation regarding the config files  as well as the 'Whats New' section to find out what has changed.,0 ,0 
API JMX mapping needs to be updated due to property name changes,In Ambari UI  we show properties like NameNode RPC Time.We used to get this metric by querying the NameNode component for 'RpcQueueTime_avg_time'.However  in Hadoop 2  it looks like this property name changed to 'RpcQueueTimeAvgTime'  so the Ambari API no longer contains these metrics. Other properties related to NameNode RPC may have changed. We need to update the mapping accordingly.,0 ,0 
Nagios start fails due to invalid configs,Steps to reproduce:1) Deploy HDP-2.0.5 cluster with Nagios.2) Start of Nagios failed  puppet log:notice: /Stage[1]/Hdp::Snappy::Package/Hdp::Snappy::Package::Ln[32]/Hdp::Exec[hdp::snappy::package::ln 32]/Exec[hdp::snappy::package::ln 32]/returns: executed successfullynotice: /Stage[2]/Hdp-nagios::Server::Enable_snmp/Exec[enable_snmp]/returns: executed successfullynotice: /Stage[2]/Hdp-nagios::Server::Config/Hdp-nagios::Server::Configfile[hadoop-hostgroups.cfg]/Hdp::Configfile[/etc/nagios/objects/hadoop-hostgroups.cfg]/File[/etc/nagios/objects/hadoop-hostgroups.cfg]/content: content changed '{md5}873d2be7b9f78137e0740223944d93af' to '{md5}780117e3c2407e9d02b37eab93159149'notice: /Stage[2]/Hdp-nagios::Server::Config/Hdp-nagios::Server::Configfile[nagios]/Hdp::Configfile[/etc/init.d//nagios]/File[/etc/init.d//nagios]/content: content changed '{md5}3990694abc37617c79e2ea5276d71089' to '{md5}c4c4454911c0c6c1ba29d9d0dc2aa28c'notice: /Stage[2]/Hdp-nagios::Server::Config/Hdp-nagios::Server::Configfile[hadoop-hosts.cfg]/Hdp::Configfile[/etc/nagios/objects/hadoop-hosts.cfg]/File[/etc/nagios/objects/hadoop-hosts.cfg]/content: content changed '{md5}7979396ff0b495e40901acdd2ecc457c' to '{md5}fa5ec3a93a4827cc6a691e0b8e22b4f6'notice: /Stage[2]/Hdp-nagios::Server::Config/Hdp-nagios::Server::Configfile[hadoop-services.cfg]/Hdp::Configfile[/etc/nagios/objects/hadoop-services.cfg]/File[/etc/nagios/objects/hadoop-services.cfg]/content: content changed '{md5}06c9d0bb0aa3b1e7b30b19fb1bb30b5a' to '{md5}934241156b5489483dab8018f9cecd22'notice: /Stage[2]/Hdp-nagios::Server::Web_permisssions/Hdp::Exec[htpasswd -c -b /etc/nagios/htpasswd.users nagiosadmin p]/Exec[htpasswd -c -b /etc/nagios/htpasswd.users nagiosadmin p]/returns: executed successfullynotice: /Stage[2]/Hdp-nagios::Server::Web_permisssions/Hdp::Exec[apache_permissions_htpasswd.users]/Exec[apache_permissions_htpasswd.users]/returns: executed successfullynotice: /Stage[2]/Hdp-nagios::Server::Services/Exec[nagios]/returns: nagios is stoppednotice: /Stage[2]/Hdp-nagios::Server::Services/Exec[nagios]/returns: Configuration validation failed[FAILED]err: /Stage[2]/Hdp-nagios::Server::Services/Exec[nagios]/returns: change from notrun to 0 failed: service nagios start returned 1 instead of one of [0] at /var/lib/ambari-agent/puppet/modules/hdp-nagios/manifests/server.pp:284notice: /Stage[2]/Hdp-nagios::Server::Services/Exec[nagios]/returns: nagios is stoppednotice: /Stage[2]/Hdp-nagios::Server::Services/Exec[nagios]/returns: Configuration validation failed[FAILED]err: /Stage[2]/Hdp-nagios::Server::Services/Exec[nagios]: Failed to call refresh: service nagios start returned 1 instead of one of [0] at /var/lib/ambari-agent/puppet/modules/hdp-nagios/manifests/server.pp:284notice: /Stage[2]/Hdp-nagios::Server::Services/Anchor[hdp-nagios::server::services::end]: Dependency Exec[nagios] has failures: truewarning: /Stage[2]/Hdp-nagios::Server::Services/Anchor[hdp-nagios::server::services::end]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-monitor-webserver/Hdp::Package[httpd]/Hdp::Package::Process_pkg[httpd]/Anchor[hdp::package::httpd::begin]: Dependency Exec[nagios] has failures: truewarning: /Stage[2]/Hdp-monitor-webserver/Hdp::Package[httpd]/Hdp::Package::Process_pkg[httpd]/Anchor[hdp::package::httpd::begin]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-monitor-webserver/Hdp::Package[httpd]/Hdp::Package::Process_pkg[httpd]/Package[httpd]: Dependency Exec[nagios] has failures: truewarning: /Stage[2]/Hdp-monitor-webserver/Hdp::Package[httpd]/Hdp::Package::Process_pkg[httpd]/Package[httpd]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-monitor-webserver/Hdp::Package[httpd]/Hdp::Package::Process_pkg[httpd]/Hdp::Java::Package[httpd]/Anchor[hdp::java::package::httpd::begin]: Dependency Exec[nagios] has failures: truewarning: /Stage[2]/Hdp-monitor-webserver/Hdp::Package[httpd]/Hdp::Package::Process_pkg[httpd]/Hdp::Java::Package[httpd]/Anchor[hdp::java::package::httpd::begin]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-monitor-webserver/Hdp::Package[httpd]/Hdp::Package::Process_pkg[httpd]/Hdp::Java::Package[httpd]/Exec[mkdir -p /tmp/HDP-artifacts/ ; curl -kf --retry 10 http://dev01.hortonworks.com:8080/resources//jdk-6u31-linux-x64.bin -o /tmp/HDP-artifacts//jdk-6u31-linux-x64.bin httpd]: Dependency Exec[nagios] has failures: truewarning: /Stage[2]/Hdp-monitor-webserver/Hdp::Package[httpd]/Hdp::Package::Process_pkg[httpd]/Hdp::Java::Package[httpd]/Exec[mkdir -p /tmp/HDP-artifacts/ ; curl -kf --retry 10 http://dev01.hortonworks.com:8080/resources//jdk-6u31-linux-x64.bin -o /tmp/HDP-artifacts//jdk-6u31-linux-x64.bin httpd]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-monitor-webserver/Hdp::Package[httpd]/Hdp::Package::Process_pkg[httpd]/Hdp::Java::Package[httpd]/Exec[mkdir -p /usr/jdk ; chmod +x /tmp/HDP-artifacts//jdk-6u31-linux-x64.bin; cd /usr/jdk ; echo A | /tmp/HDP-artifacts//jdk-6u31-linux-x64.bin -noregister &gt; /dev/null 2&gt;&amp;1 httpd]: Dependency Exec[nagios] has failures: truewarning: /Stage[2]/Hdp-monitor-webserver/Hdp::Package[httpd]/Hdp::Package::Process_pkg[httpd]/Hdp::Java::Package[httpd]/Exec[mkdir -p /usr/jdk ; chmod +x /tmp/HDP-artifacts//jdk-6u31-linux-x64.bin; cd /usr/jdk ; echo A | /tmp/HDP-artifacts//jdk-6u31-linux-x64.bin -noregister &gt; /dev/null 2&gt;&amp;1 httpd]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-monitor-webserver/Hdp::Package[httpd]/Hdp::Package::Process_pkg[httpd]/Hdp::Java::Package[httpd]/File[/usr/jdk/jdk1.6.0_31/bin/java httpd]: Dependency Exec[nagios] has failures: truewarning: /Stage[2]/Hdp-monitor-webserver/Hdp::Package[httpd]/Hdp::Package::Process_pkg[httpd]/Hdp::Java::Package[httpd]/File[/usr/jdk/jdk1.6.0_31/bin/java httpd]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-monitor-webserver/Hdp::Package[httpd]/Hdp::Package::Process_pkg[httpd]/Hdp::Java::Package[httpd]/Anchor[hdp::java::package::httpd::end]: Dependency Exec[nagios] has failures: truewarning: /Stage[2]/Hdp-monitor-webserver/Hdp::Package[httpd]/Hdp::Package::Process_pkg[httpd]/Hdp::Java::Package[httpd]/Anchor[hdp::java::package::httpd::end]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-monitor-webserver/Hdp::Package[httpd]/Hdp::Package::Process_pkg[httpd]/Anchor[hdp::package::httpd::end]: Dependency Exec[nagios] has failures: truewarning: /Stage[2]/Hdp-monitor-webserver/Hdp::Package[httpd]/Hdp::Package::Process_pkg[httpd]/Anchor[hdp::package::httpd::end]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-monitor-webserver/Hdp::Exec[monitor webserver restart]/Anchor[hdp::exec::monitor webserver restart::begin]: Dependency Exec[nagios] has failures: truewarning: /Stage[2]/Hdp-monitor-webserver/Hdp::Exec[monitor webserver restart]/Anchor[hdp::exec::monitor webserver restart::begin]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-monitor-webserver/Hdp::Exec[monitor webserver restart]/Exec[monitor webserver restart]: Dependency Exec[nagios] has failures: truewarning: /Stage[2]/Hdp-monitor-webserver/Hdp::Exec[monitor webserver restart]/Exec[monitor webserver restart]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-monitor-webserver/Hdp::Exec[monitor webserver restart]/Anchor[hdp::exec::monitor webserver restart::end]: Dependency Exec[nagios] has failures: truewarning: /Stage[2]/Hdp-monitor-webserver/Hdp::Exec[monitor webserver restart]/Anchor[hdp::exec::monitor webserver restart::end]: Skipping because of failed dependencies3) Run checkconfig:[root@dev02 ~]# /usr/sbin/nagios -v /etc/nagios/nagios.cfg Nagios Core 3.5.0Copyright (c) 2009-2011 Nagios Core Development Team and Community ContributorsCopyright (c) 1999-2009 Ethan GalstadLast Modified: 03-15-2013License: GPLWebsite: http://www.nagios.orgReading configuration data... Read main config file okay...Processing object config file '/etc/nagios/objects/commands.cfg'...Processing object config file '/etc/nagios/objects/contacts.cfg'...Processing object config file '/etc/nagios/objects/timeperiods.cfg'...Processing object config file '/etc/nagios/objects/templates.cfg'...Processing object config file '/etc/nagios/objects/hadoop-hosts.cfg'...Processing object config file '/etc/nagios/objects/hadoop-hostgroups.cfg'...Processing object config file '/etc/nagios/objects/hadoop-servicegroups.cfg'...Processing object config file '/etc/nagios/objects/hadoop-services.cfg'...Processing object config file '/etc/nagios/objects/hadoop-commands.cfg'...Error: Could not find any servicegroup matching 'MAPREDUCE' (config file '/etc/nagios/objects/hadoop-services.cfg'  starting on line 67) Error processing object config files!***&gt; One or more problems was encountered while processing the config files... Check your configuration file(s) to ensure that they contain valid directives and data defintions. If you are upgrading from a previous version of Nagios  you should be aware that some variables/definitions may have been removed or modified in this version. Make sure to read the HTML documentation regarding the config files  as well as the 'Whats New' section to find out what has changed.[root@dev02 ~]# It seems we have invalid condition for generation of MAPREDUCE Nagios checks.,0 ,0 
Puppet script syntax issues result in hive deployment with custom DB and oozie service check failures,Few puppet variables are missing in jdbc-connector and oozie service-check puppet scripts.,0 ,0 
Oozie failed at smoke test in secured cluster,stderr:None stdout:notice: /Stage[1]/Hdp::Snappy::Package/Hdp::Snappy::Package::Ln[32]/Hdp::Exec[hdp::snappy::package::ln 32]/Exec[hdp::snappy::package::ln 32]/returns: executed successfullynotice: /Stage[1]/Hdp::Snmp/Hdp::Package[snmp]/Hdp::Package::Process_pkg[snmp]/Hdp::Java::Package[snmp]/Hdp::Java::Jce::Package[snmp]/Exec[jce-install snmp]/returns: executed successfullynotice: /Stage[2]/Hdp-oozie::Oozie::Service_check/Hdp-oozie::Smoke_shell_file[oozieSmoke.sh]/Exec[/tmp/oozieSmoke.sh]/returns: Moved to trash: hdfs://domU-12-31-39-07-D5-91.compute-1.internal:8020/user/ambari-qa/examplesnotice: /Stage[2]/Hdp-oozie::Oozie::Service_check/Hdp-oozie::Smoke_shell_file[oozieSmoke.sh]/Exec[/tmp/oozieSmoke.sh]/returns: Moved to trash: hdfs://domU-12-31-39-07-D5-91.compute-1.internal:8020/user/ambari-qa/input-datanotice: /Stage[2]/Hdp-oozie::Oozie::Service_check/Hdp-oozie::Smoke_shell_file[oozieSmoke.sh]/Exec[/tmp/oozieSmoke.sh]/returns: Error: AUTHENTICATION : Could not authenticate  GSSException: No valid credentials provided (Mechanism level: Server not found in Kerberos database (7) - UNKNOWN_SERVER)notice: /Stage[2]/Hdp-oozie::Oozie::Service_check/Hdp-oozie::Smoke_shell_file[oozieSmoke.sh]/Exec[/tmp/oozieSmoke.sh]/returns: Invalid sub-command: Missing argument for option: infonotice: /Stage[2]/Hdp-oozie::Oozie::Service_check/Hdp-oozie::Smoke_shell_file[oozieSmoke.sh]/Exec[/tmp/oozieSmoke.sh]/returns:notice: /Stage[2]/Hdp-oozie::Oozie::Service_check/Hdp-oozie::Smoke_shell_file[oozieSmoke.sh]/Exec[/tmp/oozieSmoke.sh]/returns: use 'help [sub-command]' for help detailsnotice: /Stage[2]/Hdp-oozie::Oozie::Service_check/Hdp-oozie::Smoke_shell_file[oozieSmoke.sh]/Exec[/tmp/oozieSmoke.sh]/returns: Invalid sub-command: Missing argument for option: infonotice: /Stage[2]/Hdp-oozie::Oozie::Service_check/Hdp-oozie::Smoke_shell_file[oozieSmoke.sh]/Exec[/tmp/oozieSmoke.sh]/returns:notice: /Stage[2]/Hdp-oozie::Oozie::Service_check/Hdp-oozie::Smoke_shell_file[oozieSmoke.sh]/Exec[/tmp/oozieSmoke.sh]/returns: use 'help [sub-command]' for help detailsnotice: /Stage[2]/Hdp-oozie::Oozie::Service_check/Hdp-oozie::Smoke_shell_file[oozieSmoke.sh]/Exec[/tmp/oozieSmoke.sh]/returns:notice: /Stage[2]/Hdp-oozie::Oozie::Service_check/Hdp-oozie::Smoke_shell_file[oozieSmoke.sh]/Exec[/tmp/oozieSmoke.sh]/returns: workflow_status=err: /Stage[2]/Hdp-oozie::Oozie::Service_check/Hdp-oozie::Smoke_shell_file[oozieSmoke.sh]/Exec[/tmp/oozieSmoke.sh]/returns: change from notrun to 0 failed: sh /tmp/oozieSmoke.sh /etc/oozie/conf /etc/hadoop/conf ambari-qa true /etc/security/keytabs/smokeuser.headless.keytab EXAMPLE.COM jt/domu-12-31-39-07-d5-91.compute-1.internal@EXAMPLE.COM nn/domu-12-31-39-07-d5-91.compute-1.internal@EXAMPLE.COM /usr/bin/kinit returned 1 instead of one of [0] at /var/lib/ambari-agent/puppet/modules/hdp-oozie/manifests/oozie/service_check.pp:63notice: Finished catalog run in 51.05 seconds,0 ,0 
Oozie start fails - likely due to 'failed install',Oozie start failed with following in the log: hadoop dfs -chmod -R 755 /user/oozie/share' returned 1 instead of one of 0On the node: chmod: '/user/oozie/share': No such file or directoryoozie@c6402 ~$ hadoop dfs -ls /user/ DEPRECATED: Use of this script to execute hdfs command is deprecated.Instead use the hdfs command for it.Found 3 itemsdrwxrwx--- - ambari-qa hdfs 0 2013-08-02 02:40 /user/ambari-qadrwx------ - hive hdfs 0 2013-08-02 02:41 /user/hivedrwxrwxr-x - hdfs hdfs 0 2013-08-02 02:42 /user/oozieoozie@c6402 ~$ hadoop dfs -ls /user/oozieDEPRECATED: Use of this script to execute hdfs command is deprecated.Instead use the hdfs command for it.oozie@c6402 ~$The reason  the oozie smoke is failing to run an oozie job with more than one node in the cluster  due to bad settings in /etc/hadoop/core-site.xml:&lt;property&gt; &lt;name&gt;hadoop.proxyuser.oozie.hosts&lt;/name&gt; &lt;value&gt;host1&lt;/value&gt;&lt;/property&gt;host1  in my case is host on which oozie is not installed. After changing this to host2 (where oozie server is installed)  oozie smoke succeeded.,0 ,0 
HDFS Service Check failed (as designed) but took 10 mins to fail,After I had a cluster up and running successfully  but manually turned HDFS Safe Mode ON by running:hdfs dfsadmin -safemode enter.HDFS Execute Check failed due to Puppet timeout after 10 minutes.It should have failed quicker since task timeout is 10 minutes on server.,0 ,1 
hadoop-env.sh and core-site are missing on hosts that have only yarn components deployed,Yarn component need hadoop-env.sh and core-site.xml. These files should be deployed on hosts on which only yarn components are deployed.,0 ,0 
Add HBase 96 metrics changes to jmx in a backwards compatible way.,Add HBase 96 metrics changes to jmx in a backwards compatible way.,0 ,0 
SNAMENODE should not start after transition to Maintenance mode,Currently  in HA NN cluster  starting HDFS service at services tab  tries to start SNAMENODE as well (through it is in Maintainance state because of executing curl -u admin:admin -i -X PUT -d '{'RequestInfo':{'context':'SNN maintenance'} 'Body':{'HostRoles':{'state':'MAINTENANCE'}}}' http://$SERVER:8080/api/v1/clusters/$CLUSTER/hosts/$SNN_HOST/host_components/SECONDARY_NAMENODE command ),0 ,0 
Rename alert titles and descriptions,Currently Nagios alerts are shown in Ambari UI like so: (green check) NameNode process down &lt;- means NameNode process is up (red X) NameNode process down &lt;- means NameNode process is down (green check) Percent DataNode down &lt;- means % of DataNodes that are up is above the threshold (red X) Percent DataNode down &lt;- means % of DataNodes that are up is below the threshold (green check) Nagios status log staleness &lt;- means Nagios status log is fresh (red X) Nagios status log staleness &lt;- means Nagios status log is staleWhen a user sees the word 'down' with a positive indication (green check) for it  it's confusing. It's like saying 'this is red' in green... is it green or red?The proposal here is to rename these alerts  like so: (green check) NameNode process &lt;- means NameNode process is up/healthy (red X) NameNode process &lt;- means NameNode process is down/unhealthy (green check) Percent DataNodes live &lt;- means % of DataNodes that are up/healthy is above the threshold (red X) Percent DataNodes live &lt;- means % of DataNodes that are up/healthy is below the threshold (green check) Nagios status log freshness &lt;- means Nagios status log is fresh (red X) Nagios status log freshness &lt;- means Nagios status log is staleAlso there are inconsistencies in the way we show component names in alert titles and descriptions (like 'templeton server status' to mean 'WebHCat Server status'  etc). These need to be fixed.,0 ,0 
ResourceManager's RPC and NodeManager counts missing from time-series,ResourceManager's rpc.rpc.RpcQueueTimeAvgTime and yarn.ClusterMetrics.NumActiveNMs are not being provided accurately due to changes introduced in AMBARI-2910 to YARN configuration to collect more metrics.We need to narrow down the scope of metric collection to keep getting these previous metrics.,0 ,0 
Popover stuck after routing to another page,Steps to reporduce:1. Go to Installer-&gt;Welcome step2. Focus on cluster name textfield3. Hover on 'learn more' label4. Press Enter to route to the next pageResult:Popover remains visible on other pages,0 ,0 
Update stack definition for MAPREDUCE2,Update stack definition for MAPREDUCE2 and the default site xml files.,0 ,0 
Update 1.3.2 stack definition for repo url,Update 1.3.2 stack definition for repo url,0 ,0 
Oozie smoke tests fail on Ambari with NPE in Oozie Server.,Oozie smoke tests fail on Ambari with NPE in Oozie Server.,0 ,0 
Use a specific build number for the stck builds.,Use a specific build number for the stck builds.,0 ,0 
Mapreduce pid directory cutomization fails,Changing mapreduce log directory prefix results in Live status showing history server not started.,0 ,0 
Provide read-only view of security wizard entries,After enabling security  when browsing back to Admin &gt; Security  it would be good to see the tabs with the values entered during wizard setup (read-only)  just so it's easy to see what the user specifically entered during the wizard setup.,0 ,0 
Ambari server and agent are not stopped during package uninstall,When ambari-agent and ambari-server packages are uninstalled  uninstall scriplets don't stop running services. That's why processes remain running even after package removal. That may cause issues during upgrade (if administrator misses the 'stop services' step)[root@host01 ~]$ ambari-server statusUsing python /usr/bin/python2.6Ambari-server statusAmbari Server runningFound Ambari Server PID: '7850 at: /var/run/ambari-server/ambari-server.pid[root@host01]# ambari-agent statusFound ambari-agent PID: 3521ambari-agent running.Agent PID at: /var/run/ambari-agent/ambari-agent.pidAgent out at: /var/log/ambari-agent/ambari-agent.outAgent log at: /var/log/ambari-agent/ambari-agent.log[root@host01]# rpm -e ambari-server[root@host01]# rpm -e ambari-agent[root@host01]# ps aux | grep ambari | grep -v grep | grep -v postgresroot 7850 2.1 13.2 3031480 254212 ? Sl 20:51 0:36 /usr/jdk64/jdk1.6.0_31/bin/java -server -XX:NewRatio=3 -XX:+UseConcMarkSweepGC -XX:-UseGCOverheadLimit -XX:CMSInitiatingOccupancyFraction=60 -Xms512m -Xmx2048m -cp /etc/ambari-server/conf:/usr/lib/ambari-server/*:/sbin:/bin:/usr/sbin:/usr/bin:/usr/lib/ambari-server/* org.apache.ambari.server.controller.AmbariServerroot 3521 0.7 1.1 499760 22544 ? Sl 20:53 0:12 /usr/bin/python2.6 /usr/lib/python2.6/site-packages/ambari_agent/main.py start restart --expected-hostname=host01,0 ,0 
Should turn on predicate pushdown by default.,Should turn on predicate pushdown by default.,0 ,0 
Trim and/or validate config parameter values to prevent failures due to extra spaces,Automatically trim whitespaces (both leading and trailing) for: Database Host in Oozie and Hive Database Name in Oozie and Hive Database URL in Oozie and Hive All directories  including log dir  pid dir data dir  etc (I believe we already trim  split  and join for the UI config type 'directories'. We should trim on the single-line directory values  if we are not doing so already).Automatically trim all trailing spaces (but not leading spaces) for all config values with the following exceptions: Password fields Values that consist of spaces only (such as ' '),0 ,0 
Ambari should always point to latest repo,Ambari should always point to latest repo.,0 ,0 
Customize Services page->Misc tab: Popup with related properties does not opened after 'Group User' value changing,,0 ,0 
Oozie oozie-site.xml misssing two xsd values causing shell and sla workflows to fail,Following two values need to be added to oozie-site.xml in order to get sla and shell workflows to run successfully.shell-action-0.2.xsdoozie-sla-0.1.xsd oozie-sla-0.2.xsdFollowing is the property name&lt;property&gt;&lt;name&gt;oozie.service.SchemaService.wf.ext.schemas&lt;/name&gt;&lt;value&gt;shell-action-0.1.xsd email-action-0.1.xsd hive-action-0.2.xsd sqoop-action-0.2.xsd ssh-action-0.1.xsd distcp-action-0.1.xsd&lt;/value&gt;&lt;/property&gt;,0 ,0 
Ambari server setup with silent option prints error statement for the first time,command: ambari-server setup -sCompleting setup...Configuring database...Enter advanced database configuration [y/n] &#40;n&#41;? ERROR: Connection properties not set in config file.Default properties detected. Using built-in database.Checking PostgreSQL...Running initdb: This may take upto a minute.About to start PostgreSQLConfiguring local database...Configuring PostgreSQL...Restarting PostgreSQLAmbari Server 'setup' completed successfully.Running ambari-server setup command again doesn't reproduce the error statement.,0 ,0 
Enhance host clean up to handle tmp files and folders,Host cleanup should: remove files and folders in tmp folder based on what users are being cleaned remove default hadoop group,0 ,0 
Advanced config orders should be consistent in Install Wizard > Customize Services and Monitoring > Services > Config,Compare the config parameter ordering in Install Wizard &gt; Customize Services service configs and Monitoring &gt; Services &gt; Config; they are different.We should use the same parameter ordering that we use in Install Wizard &gt; Customize Services for Monitoring &gt; Services &gt; Config.,0 ,0 
Do not use regex to determine folder name by full path for dfs_domain_socket_path,The point is to use custom puppet function instead of regex for line$dfs_domain_socket_path_dir = regsubst($hdp-hadoop::params::dfs_domain_socket_path  '/[^//]+$'  '').It could be implemented with ruby:File.split('/path/to/file') # =&gt; ['/path/to'  'file'],0 ,0 
Warning messages not cleared when task fails,Installed a cluster  namenode start fails  install exits with warnings.If i go an look at the specific task that fails  the puppet warnings are still present. Seems like those puppet warnings didn't get cleared.In a task failure case  having the warnings clear is when it's most important.,0 ,0 
Fix Unit tests,,0 ,0 
Amabri Client refactoring -2,1) The last patch had an issue with the testcase because of which it did not compile. I might have accidently added a line while I was saving some of the files.(this is fixed in the new patch)The trunk currently fails for ambari-client.https://cwiki.apache.org/confluence/display/AMBARI/Ambari+python+Client has all the exposed methods,0 ,0 
Ambari wont start NodeManager because one of multiple folders not created,yarn-site having:'yarn.nodemanager.local-dirs' : '/grid/0/hadoop/yarn /grid/1/hadoop/yarn /grid/2/hadoop/yarn /grid/3/hadoop/yarn /grid/4/hadoop/yarn /grid/5/hadoop/yarn' 'yarn.nodemanager.log-dirs' : '/grid/0/hadoop/yarn /grid/1/hadoop/yarn /grid/2/hadoop/yarn /grid/3/hadoop/yarn /grid/4/hadoop/yarn /grid/5/hadoop/yarn' Now /grid/3 was mounted as read-only due to some disk errors. Though other folders got successfully created  Ambari will not start the NodeManager process.notice: /Stage[1]/Hdp::Snappy::Package/Hdp::Snappy::Package::Ln[32]/Hdp::Exec[hdp::snappy::package::ln 32]/Exec[hdp::snappy::package::ln 32]/returns: executed successfullynotice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Nodemanager::Create_nm_dirs[/grid/3/hadoop/yarn]/Hdp::Directory_recursive_create[/grid/3/hadoop/yarn]/Hdp::Exec[mkdir -p /grid/3/hadoop/yarn]/Exec[mkdir -p /grid/3/hadoop/yarn]/returns: mkdir: cannot create directory '/grid/3/hadoop': Read-only file systemerr: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Nodemanager::Create_nm_dirs[/grid/3/hadoop/yarn]/Hdp::Directory_recursive_create[/grid/3/hadoop/yarn]/Hdp::Exec[mkdir -p /grid/3/hadoop/yarn]/Exec[mkdir -p /grid/3/hadoop/yarn]/returns: change from notrun to 0 failed: mkdir -p /grid/3/hadoop/yarn returned 1 instead of one of [0] at /var/lib/ambari-agent/puppet/modules/hdp/manifests/init.pp:479notice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Nodemanager::Create_nm_dirs[/grid/3/hadoop/yarn]/Hdp::Directory_recursive_create[/grid/3/hadoop/yarn]/Hdp::Exec[mkdir -p /grid/3/hadoop/yarn]/Anchor[hdp::exec::mkdir -p /grid/3/hadoop/yarn::end]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Nodemanager::Create_nm_dirs[/grid/3/hadoop/yarn]/Hdp::Directory_recursive_create[/grid/3/hadoop/yarn]/Hdp::Exec[mkdir -p /grid/3/hadoop/yarn]/Anchor[hdp::exec::mkdir -p /grid/3/hadoop/yarn::end]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Nodemanager::Create_nm_dirs[/grid/3/hadoop/yarn]/Hdp::Directory_recursive_create[/grid/3/hadoop/yarn]/Hdp::Directory[/grid/3/hadoop/yarn]/File[/grid/3/hadoop/yarn]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Nodemanager::Create_nm_dirs[/grid/3/hadoop/yarn]/Hdp::Directory_recursive_create[/grid/3/hadoop/yarn]/Hdp::Directory[/grid/3/hadoop/yarn]/File[/grid/3/hadoop/yarn]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Initialize/Hdp-yarn::Generate_common_configs[yarn-common-configs]/Configgenerator::Configfile[capacity-scheduler]/File[/etc/hadoop/conf/capacity-scheduler.xml]/content: content changed '{md5}e5d17c21c7a5e1db9f3af35cba71df0a' to '{md5}2ca1d267a46f1aecac726caabaa16774'notice: /Stage[2]/Hdp-yarn::Initialize/Hdp-yarn::Generate_common_configs[yarn-common-configs]/Configgenerator::Configfile[capacity-scheduler]/File[/etc/hadoop/conf/capacity-scheduler.xml]/owner: owner changed 'hdfs' to 'yarn'notice: /Stage[2]/Hdp-yarn::Initialize/Hdp-yarn::Generate_common_configs[yarn-common-configs]/Configgenerator::Configfile[core-site]/File[/etc/hadoop/conf/core-site.xml]/content: content changed '{md5}86d742a780d59a957ea0a283dec03784' to '{md5}8506e4402ba8140ea4f9fed97b6f94e2'notice: /Stage[2]/Hdp-yarn::Initialize/Hdp-yarn::Generate_common_configs[yarn-common-configs]/Configgenerator::Configfile[yarn-site]/File[/etc/hadoop/conf/yarn-site.xml]/content: content changed '{md5}d84a967ce47a6b77734ed8f53d817c6e' to '{md5}42940cca6e8f64ae5de50524fb131274'notice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Anchor[hdp-yarn::service::nodemanager::begin]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Anchor[hdp-yarn::service::nodemanager::begin]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Directory_recursive_create[/var/log/hadoop-yarn]/Hdp::Exec[mkdir -p /var/log/hadoop-yarn]/Anchor[hdp::exec::mkdir -p /var/log/hadoop-yarn::begin]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Directory_recursive_create[/var/log/hadoop-yarn]/Hdp::Exec[mkdir -p /var/log/hadoop-yarn]/Anchor[hdp::exec::mkdir -p /var/log/hadoop-yarn::begin]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Directory_recursive_create[/var/log/hadoop-yarn]/Hdp::Exec[mkdir -p /var/log/hadoop-yarn]/Exec[mkdir -p /var/log/hadoop-yarn]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Directory_recursive_create[/var/log/hadoop-yarn]/Hdp::Exec[mkdir -p /var/log/hadoop-yarn]/Exec[mkdir -p /var/log/hadoop-yarn]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Directory_recursive_create[/var/log/hadoop-yarn]/Hdp::Exec[mkdir -p /var/log/hadoop-yarn]/Anchor[hdp::exec::mkdir -p /var/log/hadoop-yarn::end]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Directory_recursive_create[/var/log/hadoop-yarn]/Hdp::Exec[mkdir -p /var/log/hadoop-yarn]/Anchor[hdp::exec::mkdir -p /var/log/hadoop-yarn::end]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Directory_recursive_create[/var/log/hadoop-yarn]/Hdp::Directory[/var/log/hadoop-yarn]/File[/var/log/hadoop-yarn]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Directory_recursive_create[/var/log/hadoop-yarn]/Hdp::Directory[/var/log/hadoop-yarn]/File[/var/log/hadoop-yarn]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Directory_recursive_create[/var/run/hadoop-yarn/yarn]/Hdp::Exec[mkdir -p /var/run/hadoop-yarn/yarn]/Anchor[hdp::exec::mkdir -p /var/run/hadoop-yarn/yarn::begin]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Directory_recursive_create[/var/run/hadoop-yarn/yarn]/Hdp::Exec[mkdir -p /var/run/hadoop-yarn/yarn]/Anchor[hdp::exec::mkdir -p /var/run/hadoop-yarn/yarn::begin]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Directory_recursive_create[/var/run/hadoop-yarn/yarn]/Hdp::Exec[mkdir -p /var/run/hadoop-yarn/yarn]/Exec[mkdir -p /var/run/hadoop-yarn/yarn]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Directory_recursive_create[/var/run/hadoop-yarn/yarn]/Hdp::Exec[mkdir -p /var/run/hadoop-yarn/yarn]/Exec[mkdir -p /var/run/hadoop-yarn/yarn]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Directory_recursive_create[/var/run/hadoop-yarn/yarn]/Hdp::Exec[mkdir -p /var/run/hadoop-yarn/yarn]/Anchor[hdp::exec::mkdir -p /var/run/hadoop-yarn/yarn::end]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Directory_recursive_create[/var/run/hadoop-yarn/yarn]/Hdp::Exec[mkdir -p /var/run/hadoop-yarn/yarn]/Anchor[hdp::exec::mkdir -p /var/run/hadoop-yarn/yarn::end]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Directory_recursive_create[/var/run/hadoop-yarn/yarn]/Hdp::Directory[/var/run/hadoop-yarn/yarn]/File[/var/run/hadoop-yarn/yarn]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Directory_recursive_create[/var/run/hadoop-yarn/yarn]/Hdp::Directory[/var/run/hadoop-yarn/yarn]/File[/var/run/hadoop-yarn/yarn]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Exec[su - yarn -c 'export HADOOP_LIBEXEC_DIR=/usr/lib/hadoop/libexec &amp;&amp; /usr/lib/hadoop-yarn/sbin/yarn-daemon.sh --config /etc/hadoop/conf start nodemanager']/Anchor[hdp::exec::su - yarn -c 'export HADOOP_LIBEXEC_DIR=/usr/lib/hadoop/libexec &amp;&amp; /usr/lib/hadoop-yarn/sbin/yarn-daemon.sh --config /etc/hadoop/conf start nodemanager'::begin]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Exec[su - yarn -c 'export HADOOP_LIBEXEC_DIR=/usr/lib/hadoop/libexec &amp;&amp; /usr/lib/hadoop-yarn/sbin/yarn-daemon.sh --config /etc/hadoop/conf start nodemanager']/Anchor[hdp::exec::su - yarn -c 'export HADOOP_LIBEXEC_DIR=/usr/lib/hadoop/libexec &amp;&amp; /usr/lib/hadoop-yarn/sbin/yarn-daemon.sh --config /etc/hadoop/conf start nodemanager'::begin]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Exec[su - yarn -c 'export HADOOP_LIBEXEC_DIR=/usr/lib/hadoop/libexec &amp;&amp; /usr/lib/hadoop-yarn/sbin/yarn-daemon.sh --config /etc/hadoop/conf start nodemanager']/Exec[su - yarn -c 'export HADOOP_LIBEXEC_DIR=/usr/lib/hadoop/libexec &amp;&amp; /usr/lib/hadoop-yarn/sbin/yarn-daemon.sh --config /etc/hadoop/conf start nodemanager']: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Exec[su - yarn -c 'export HADOOP_LIBEXEC_DIR=/usr/lib/hadoop/libexec &amp;&amp; /usr/lib/hadoop-yarn/sbin/yarn-daemon.sh --config /etc/hadoop/conf start nodemanager']/Exec[su - yarn -c 'export HADOOP_LIBEXEC_DIR=/usr/lib/hadoop/libexec &amp;&amp; /usr/lib/hadoop-yarn/sbin/yarn-daemon.sh --config /etc/hadoop/conf start nodemanager']: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Exec[su - yarn -c 'export HADOOP_LIBEXEC_DIR=/usr/lib/hadoop/libexec &amp;&amp; /usr/lib/hadoop-yarn/sbin/yarn-daemon.sh --config /etc/hadoop/conf start nodemanager']/Anchor[hdp::exec::su - yarn -c 'export HADOOP_LIBEXEC_DIR=/usr/lib/hadoop/libexec &amp;&amp; /usr/lib/hadoop-yarn/sbin/yarn-daemon.sh --config /etc/hadoop/conf start nodemanager'::end]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Exec[su - yarn -c 'export HADOOP_LIBEXEC_DIR=/usr/lib/hadoop/libexec &amp;&amp; /usr/lib/hadoop-yarn/sbin/yarn-daemon.sh --config /etc/hadoop/conf start nodemanager']/Anchor[hdp::exec::su - yarn -c 'export HADOOP_LIBEXEC_DIR=/usr/lib/hadoop/libexec &amp;&amp; /usr/lib/hadoop-yarn/sbin/yarn-daemon.sh --config /etc/hadoop/conf start nodemanager'::end]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Exec[sleep 5; ls /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid &gt;/dev/null 2&gt;&amp;1 &amp;&amp; ps 'cat /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid' &gt;/dev/null 2&gt;&amp;1]/Anchor[hdp::exec::sleep 5; ls /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid &gt;/dev/null 2&gt;&amp;1 &amp;&amp; ps 'cat /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid' &gt;/dev/null 2&gt;&amp;1::begin]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Exec[sleep 5; ls /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid &gt;/dev/null 2&gt;&amp;1 &amp;&amp; ps 'cat /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid' &gt;/dev/null 2&gt;&amp;1]/Anchor[hdp::exec::sleep 5; ls /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid &gt;/dev/null 2&gt;&amp;1 &amp;&amp; ps 'cat /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid' &gt;/dev/null 2&gt;&amp;1::begin]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Exec[sleep 5; ls /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid &gt;/dev/null 2&gt;&amp;1 &amp;&amp; ps 'cat /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid' &gt;/dev/null 2&gt;&amp;1]/Exec[sleep 5; ls /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid &gt;/dev/null 2&gt;&amp;1 &amp;&amp; ps 'cat /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid' &gt;/dev/null 2&gt;&amp;1]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Exec[sleep 5; ls /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid &gt;/dev/null 2&gt;&amp;1 &amp;&amp; ps 'cat /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid' &gt;/dev/null 2&gt;&amp;1]/Exec[sleep 5; ls /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid &gt;/dev/null 2&gt;&amp;1 &amp;&amp; ps 'cat /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid' &gt;/dev/null 2&gt;&amp;1]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Exec[sleep 5; ls /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid &gt;/dev/null 2&gt;&amp;1 &amp;&amp; ps 'cat /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid' &gt;/dev/null 2&gt;&amp;1]/Anchor[hdp::exec::sleep 5; ls /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid &gt;/dev/null 2&gt;&amp;1 &amp;&amp; ps 'cat /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid' &gt;/dev/null 2&gt;&amp;1::end]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Hdp::Exec[sleep 5; ls /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid &gt;/dev/null 2&gt;&amp;1 &amp;&amp; ps 'cat /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid' &gt;/dev/null 2&gt;&amp;1]/Anchor[hdp::exec::sleep 5; ls /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid &gt;/dev/null 2&gt;&amp;1 &amp;&amp; ps 'cat /var/run/hadoop-yarn/yarn/yarn-yarn-nodemanager.pid' &gt;/dev/null 2&gt;&amp;1::end]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Anchor[hdp-yarn::service::nodemanager::end]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Hdp-yarn::Service[nodemanager]/Anchor[hdp-yarn::service::nodemanager::end]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Nodemanager/Anchor[hdp-yarn::nodemanager::end]: Dependency Exec[mkdir -p /grid/3/hadoop/yarn] has failures: truewarning: /Stage[2]/Hdp-yarn::Nodemanager/Anchor[hdp-yarn::nodemanager::end]: Skipping because of failed dependenciesnotice: /Stage[2]/Hdp-yarn::Initialize/Hdp-yarn::Generate_common_configs[yarn-common-configs]/Configgenerator::Configfile[mapred-site]/File[/etc/hadoop/conf/mapred-site.xml]/content: content changed '{md5}093cb1899b3c3b9dc4a7c1c93729c18b' to '{md5}4c462999cc47e6f6ba0e6381d71d81ba'notice: /Stage[2]/Hdp-yarn::Initialize/Hdp-yarn::Generate_common_configs[yarn-common-configs]/Configgenerator::Configfile[mapred-site]/File[/etc/hadoop/conf/mapred-site.xml]/owner: owner changed 'mapred' to 'yarn'notice: Finished catalog run in 2.39 seconds,0 ,0 
Jobs run date and duration not sorting correctly,Input and output bytes columns have been removed from the UI  but the web service doesn't know about that yet so it doesn't map the column index to a sort field correctly.,0 ,0 
Jobs summary has 'oldest' and 'youngest' run dates swapped,The web service is labeling these incorrectly when they are retrieved from the db.,0 ,0 
Incorrect units of measure for 'HBase Master Heap' widget on Dashboard,'HBase Master Heap' widget on Dashboard displays parameters in TB (param1.png)  but real values are in MB (param0.png).,0 ,0 
Incorrect color of rack indicators on 'Heatmaps' page,Precondition: hadoop is installed. Total disk space for both machines is 100 GB. Used disk space is about 5-15%.Steps: Go to 'Heatmaps' page. Select 'Host Disk Space Used %' metric ('Maximum' input field has '100' value). Both indicators has green color (disk space usage is in 0-20% category). Choose 'Maximum' input field value to '99'.Result:One indicator has red color (79.2% - 99% category)  but real disk space usage is 8.3% and indicator should be green.,0 ,0 
Cannot change JMX ports using Ambari configuration API,Ambari 1.2.5  attached the configs to the cluster  in order to provide ability for override behavior at the service and host component levels.The JMX ports read from the service configs can no longer be modified from their default values since the existing code reads the service configurations which do not exist.,0 ,0 
Random change of blocks for Summary and Alerts and health checks on some Service pages,The height of blocks 'Alerts and health checks' is changed sometimes after Service page refresh.It can change to normal sizes after another tries.Produced only in Firefox.,0 ,0 
Security wizard: disabling security does not return to initial condition after enabling security fails.,Steps to reproduce:1. enable security WITHOUT pre-configuring kerberos on cluster and see failures on '3. Start Services';2. disable security.In the end DataNode fails on ALL hosts without a possibility to get started.When you try to start DataNode manually it also ends with error:err: /Stage[2]/Hdp-hadoop::Datanode/Hdp-hadoop::Service[datanode]/Hdp::Exec[su - hdfs -c 'export HADOOP_LIBEXEC_DIR=/usr/lib/hadoop/libexec &amp;&amp; /usr/lib/hadoop/sbin/hadoop-daemon.sh --config /etc/hadoop/conf start datanode']/Exec[su - hdfs -c 'export HADOOP_LIBEXEC_DIR=/usr/lib/hadoop/libexec &amp;&amp; /usr/lib/hadoop/sbin/hadoop-daemon.sh --config /etc/hadoop/conf start datanode']/returns: change from notrun to 0 failed: su - hdfs -c 'export HADOOP_LIBEXEC_DIR=/usr/lib/hadoop/libexec &amp;&amp; /usr/lib/hadoop/sbin/hadoop-daemon.sh --config /etc/hadoop/conf start datanode' returned 1 instead of one of [0] at /var/lib/ambari-agent/puppet/modules/hdp/manifests/init.pp:479,1 ,0 
HBase Read/Write request metrics seem to have changed for 2.x stack,See the screenshot for HBase Cumulative Requests graph.The graph does not seem like it's displaying cumulative read/write requests  but rather showing the rate... so the label no longer makes sense.This is on the 2.0.5 stack. On the 1.x  I believe this graph would show cumulative read/write requests (which were less useful).So for 2.x stack  we should probably change the label for this graph to say Reads/Writes per Second (or whatever we are showing - need to confirm).,0 ,0 
NullPointerException thrown while retrieving ganglia properties,API Call:curl -u admin:admin http://localhost:8080/api/v1/clusters/c1/services?fields=components/ServiceComponentInfo components/host_components components/host_components/HostRoles components/host_components/metrics/jvm/memHeapUsedM components/host_components/metrics/jvm/memHeapCommittedM components/host_components/metrics/mapred/jobtracker/trackers_decommissioned components/host_components/metrics/cpu/cpu_wio components/host_components/metrics/rpc/RpcQueueTime_avg_time components/host_components/metrics/flume/flume components/host_components/metrics/yarn/QueueAmbari log:20:54:57 044 WARN [qtp912472968-20] ServletHandler:514 - /api/v1/clusters/c1/servicesjava.lang.NullPointerException at org.apache.ambari.server.controller.ganglia.GangliaPropertyProvider.getRRDRequests(GangliaPropertyProvider.java:225) at org.apache.ambari.server.controller.ganglia.GangliaPropertyProvider.populateResources(GangliaPropertyProvider.java:110) at org.apache.ambari.server.controller.internal.VersioningPropertyProvider.populateResources(VersioningPropertyProvider.java:98),0 ,0 
Incorrect behavior after entering wrong current password while editing user;,1. Go to Admin page -&gt; Users tab2. Click Edit for some user3. Try to enter wrong value for Current Password field.The message does not tell me that my entered current password is wrong  so it can be confusing for user.Another scenario:1. Go to Admin page -&gt; Users tab2. Click Edit for some user3. Try to enter wrong value for Current Password field and don't fill fields for a new passwordIt don't really change the password but it still allows to enter wrong Current Password without any message,0 ,0 
Out of memory issues with Request API on large cluster,Number of ExecutionCommandEntity objects keep growing and result in Out of memory on large cluster (100 nodes).Script to re-create the issue:&#91;root@domain user&#93;# cat test1.shfor i in{0..100}doecho 'doing $i'curl -u admin:admin 'http://domain.net:8080/api/v1/clusters/c1/requests?to=end&amp;page_size=10&amp;fields= tasks/Tasks/*' &gt; /dev/nullsleep 5done,0 ,1 
Reduce the size of ExecutionCommand entity,Currently  each ExecutionCommandEntity stores the whole config blob. This is a severe duplication of data as tagged configuration information is already available as immutable entry.We need to reduce the footprint of ExecutionCommandEntity by storing only configuration tags. The tags can be replaced with actual configuration value when the command is handed off to the agent.We need to ensure that when Ambari is upgraded and there is a mix of ExecutionCommandEntity instances with and without embedded config - it works.,0 ,0 
ambari-agent service script should return non-zero when the agent is not running,The ambari-agent service script should return non-zero when the agent is not running. For example  if a customer wants to have puppet ensure the service is always running  it will not start a killed service because it thinks it's already running when it returns 0.&#91;root@host-123-123-123 init.d&#93;# service ambari-agent statusambari-agent currently not runningUsage: /usr/sbin/ambari-agent {start|stop|restart|status}&#91;root@host-123-123-123 init.d&#93;# echo $?0For comparison...&#91;root@host-123-123-123 init.d&#93;# service winbind statuswinbindd is stopped&#91;root@host-123-123-123 init.d&#93;# echo $?3Possible fix:AMBARI_AGENT_PID_PATH='/var/run/ambari-agent/ambari-agent.pid';RES='3';if [ -f $AMBARI_AGENT_PID_PATH ]then RES='cat $AMBARI_AGENT_PID_PATH | xargs ps -f -p | wc -l'; AMBARI_AGENT_PID='cat $AMBARI_AGENT_PID_PATH';else RES=-1;fiif [ $RES -eq '2' ]then echo 'OK: Ambari agent is running &#91;PID:$AMBARI_AGENT_PID&#93;'; exit 0;else echo 'CRITICAL: Ambari agent is not running &#91;$AMBARI_AGENT_PID_PATH not found&#93;'; exit 2;fi,0 ,0 
Modify ganglia config to match the data resolution of the older version,New ganglia version retains almost 50 times more data for higher resolution metrics collection. Ambari needs to modify the configuration to match the older resolution as the new default config has a very high disk space requirement.Looks like the default config for ganglia changed fromRRAs 'RRA:AVERAGE:0.5:1:244' 'RRA:AVERAGE:0.5:24:244' 'RRA:AVERAGE:0.5:168:244' 'RRA:AVERAGE:0.5:672:244' 'RRA:AVERAGE:0.5:5760:374'toRRAs 'RRA:AVERAGE:0.5:1:5856' 'RRA:AVERAGE:0.5:4:20160' 'RRA:AVERAGE:0.5:40:52704'Its an increase from 1350 data points to 78720. After reverting to older configuration the file size for a single metrics and its summary info are-rw-rw-rw- 1 nobody nobody 12224 Sep 7 18:29 ./HDPNameNode/c6402.ambari.apache.org/disk_free.rrd-rw-rw-rw- 1 nobody nobody 23656 Sep 7 18:29 ./HDPNameNode/__SummaryInfo__/disk_free.rrdIn contrast it was-rw-r--r-- 1 root root 630768 Sep 7 17:48 /tmp/rrds/HDPNameNode/c6402.ambari.apache.org/disk_free.rrd-rw-r--r-- 1 root root 1261000 Sep 7 17:47 /tmp/rrds/HDPNameNode/__SummaryInfo__/disk_free.rrdThe recommendation is to revert back to the old config (i.e. do not use the new default config). Confirming that with an older installation of Ambari.,0 ,0 
Oozie install fails with 'could not connect to database' when choosing 'use existing mysql database ' and choosing 'new mysql database' for Hive within Ambari,PROBLEM: When installing with Ambari and selecting an existing MySQL database for oozie and a new MySQL database for Hive  then the Ambariinstall fails when installing the oozie database. The error thrown is 'could not connect to database' [it appears to drop the 'existing' databaseand you are required to start MySQL on the machine and create the database]BUSINESS IMPACT: This will affect all customers who choose an existing MySQL database for oozie and a new MySQL DB for hive when installing a cluster using AmbariSTEPS TO REPRODUCE: Choose an exisiting oozie MySQL database and point Ambari at this  and select a new Hive MySQL database on the installation optionsACTUAL BEHAVIOR: It seems that it drops the exisiting oozie database and then fails with an errot of could not connect (This is due to MySQL being down  but also the Oozie database is not there anymore)After starting MySQL and creating the database then the installer can continue from where it left off.EXPECTED BEHAVIOR: The installer should not stop MySQL and drop the oozie database if you select create a new Hive database and exisiting MySQL database for oozie.SUPPORT ANALYSIS: Reproduced in the lab in HDP 1.3.2 by following the steps above.,0 ,0 
ambari-server command output should point to Apache Ambari documentation,ambari-server command outputs should point to a generic link for current ambari documentation.,0 ,0 
Secure cluster: Yarn service check fails after configuring yarn for spnego authentication.,Yarn smoke test uses REST api exposed by ResourceManager to get its status. After configuring web authentication yarn client that is assigned yarn service check needs to negotiate 401 HTTP authentication response received while using REST api.,0 ,0 
ZKFailoverController should be shown as a component that can be started/stopped in Host Details page,,0 ,0 
WebHCat alert does not nave any description,Steps to reproduce1. Go to Services page2. click on different services. They all have a status and a message for status in 'Alerts and Health Checks' list (as example hive.png)3. WebHCat service has a status but does not have a status message,0 ,0 
Cannot delete a stopped host_component in INSTALLED state,I have a host with 4 stopped host_components. When I issue a DELETE on say http://c6401:8080/api/v1/clusters/vmc/hosts/c6404.ambari.apache.org/host_components/DATANODEThe response is:{ 'status' : 500  'message' : 'org.apache.ambari.server.controller.spi.SystemException: An internal system exception occurred: To remove master or slave components they must be in MAINTENANCE/INIT/INSTALL_FAILED/UNKNOWN state. Current=INSTALLED.'},0 ,0 
ambari-server reset is broken on centos5.8,ambari-server reset fails due to syntax error in centos 5.8 (postgres 8.1).psql:/var/lib/ambari-server/resources/Ambari-DDL-Postgres-DROP.sql:18: LINE 1: DROP DATABASE IF EXISTS ambari;The IF EXISTS clause was only added to DROP command in PotgreSQL8.2.+Show warnings if any SQL commands failed during server reset or upgradestack,0 ,0 
NameNode Uptime does not appear,Due to backend change of the position of NameNode startTime property  this will not show up.,0 ,0 
Ambari does not set the correct value for 'templeton.storage.class' in webhcat-site.xml,Ambari does not set the correct value for 'templeton.storage.class' in webhcat-site.xmlIn an Ambari deployed cluster currently the following value in /etc/hcatalog/conf/webhcat-site.xml is set incorrectly: &lt;property&gt; &lt;name&gt;templeton.storage.class&lt;/name&gt; &lt;value&gt;org.apache.hcatalog.templeton.tool.ZooKeeperStorage&lt;/value&gt; &lt;/property&gt;With the change from HIVE-4895 this should be: &lt;property&gt; &lt;name&gt;templeton.storage.class&lt;/name&gt; &lt;value&gt;org.apache.hive.hcatalog.templeton.tool.ZooKeeperStorage&lt;/value&gt; &lt;/property&gt;All jobs involving MapReduce fail because of this issue.,0 ,0 
URLStreamProvider reads are flooding the log,These logs do not need to be at INFO level. When user is using the UI then theer is roughly one log per second.06:56:34 232 INFO [pool-1-thread-12] URLStreamProvider:81 - readFrom spec:http://c6402.ambari.apache.org:50075/jmx06:56:34 235 INFO [pool-1-thread-5] URLStreamProvider:81 - readFrom spec:http://c6401.ambari.apache.org:50075/jmx06:56:34 248 INFO [qtp1620999494-18] URLStreamProvider:81 - readFrom spec:http://c6401.ambari.apache.org/cgi-bin/rrd.py?c=HDPSlaves&amp;h=c6401.ambari.apache.org c6402.ambari.apache.org&amp;m=cpu_wio jvm.JvmMetrics.MemHeapUsedM rpc.rpc.RpcQueueTimeAvgTime jvm.JvmMetrics.MemHeapCommittedM&amp;e=now&amp;pt=true...,0 ,0 
When Bind DN credentials are incorrect - we should log it,When integrating Ambari with LDAP if you specify the Bind DN  or Bind credentials that are invalid there is no logging to identify that the authentication fails  so the following search for the logging in user DN will fail. I had to use wireshark to figure out why the integration wasn't working.,0 ,0 
Setup the krb5 Jaas configuration using 'ambari-server setup-security',1. Add 'ambari-server setup-security' to replace all of the following operations:'setup-https|setup-ganglia-https|setup-nagios-https|encrypt-passwords'2. Add new operation 'setup-kerberos-auth' to ask the user for: ambari.keytab ambari.principalRelated to  https://issues.apache.org/jira/browse/AMBARI-2941,1 ,0 
Read-only views of security admin tab became editable after visiting other tabs on admin page,STR: Go to Admin page -&gt; Security tab Switch to another tab on admin page (Misc tab  HA tab  etc.) Go back to Security tab--------------------Verify that all input fields on this page are read-onlyExpected Result: Everything should be read-only.Actual Result: Some fields become editable .,1 ,0 
Provide UI page to enable/disable experimental functionality,We have various experimental functionality provided in UI. We need an easy UI page http://server:8080/#/experimental to enable/disable these functionalities.This will make it easy for users to test these functionalities and give feedback.Refresh of Ambari UI will clear the changes.,0 ,0 
Fix text for custom JCE policy setup,Current text:-c JCE_POLICY  --jce-policy=JCE_POLICY Use specified jce_policy. Must be valid on all hostsThis is required only on ambari-server  the agents will download from the server.,0 ,0 
Cleanup UX for advanced database in 'ambari-server setup',Cleanup UX...Enter advanced database configuration [y/n] (n)? y==============================================================================Choose one of the following options:[1] - PostgreSQL (Embedded)[2] - Oracle==============================================================================Enter choice (1):,0 ,0 
Dashboard page: buttons are shifted if screen width is more than 1200px,,0 ,0 
Strange behavior of 'JobTracker CPU WIO' dashboard widget,This happened because when fixing an old issue  jobTrackerCpu got ignored about that fix.,0 ,0 
Help Text for NameService ID when enabling HA is random in responding to mouse movement and clicks.,,0 ,0 
Security wizard: On NameNode HA mode  General category should have spnego principal and keytab field,Earlier dfs.web.authentication.kerberos.keytab field was being used for NameNode and SNameNode component. So we planned to pull this key to NameNode category when HA is enabled as it's the only component then using the key.After HDFS-5091 fix  journalNode also uses this key.So instead of pulling this config key in NameNode section  it should be kept in General category and the description of this principal and keytab location field should be changed accordingly.,0 ,0 
SSH key in logs?,Notice after agent registration (automatic with SSH key)  I see the SSH key in the popup. Also see it in the ambari-agent.log.Not sure we want to capture this in the log and show in the UI?,0 ,0 
Unavailable stacks should be hidden.,Unavailable stacks should be hidden.,0 ,0 
Parameterize the repo url for latest stack,Allow the latest stack repo url to be parameterized for the build. This allows the build to cater to the stack repo as it goes through dev/private/public builds each with different URLs.,0 ,0 
Nagios alert text for NodeManagers should say 'live',Services &gt; YARNSee screen shot.Should say 'Percent NodeManagers live',0 ,0 
Fix Unit tests and create new test for step3 installer,,0 ,0 
HDFS service check should not be disabled when NN HA is enabled and one NN is down,HDFS service check should not be disabled when NN HA is enabled and one NN is down. In fact  service check passing is an indication that NN is available with one NN down.,0 ,0 
Security wizard: 'Create Principals and Keytabs' step doesn't save state after page refresh,,1 ,0 
Use correct case for YARN,,0 ,0 
UI optimization: constrain hostComponents model loading,Constrain loading hostComponents into model  so then it loads only on initial loading or when added new hostComponents.,0 ,0 
Unit test for agents fail/hang at TestActionQueue and TestStackUpgrade.,Running mvn test on agent fails/hangs under Mac Os,0 ,0 
switching to Configs tab causes Quick Links to disappear,In Ambari Web  browse to HDFS  YARN  MapReduce2  etc. Click on the Configs tab  the Quick Links option disappears.See the same regardless of 1.3.2 or 2.0.6  and tried on Firefox and Chrome,0 ,0 
'Services'  'Dashboard' 'Navigation errors,Navigation from Hosts to Services page or from Hosts to Dashboard pagesometimes fails (nothing happens besides highlighting 'Services' tab) and sometimes navigates to an empty page.Uncaught Error: assertion failed: calling set on destroyed object ember-latest.js:43Ember.assert ember-latest.js:43set ember-latest.js:1386Ember.Observable.Ember.Mixin.create.set ember-latest.js:7769App.MainServiceMenuView.Em.CollectionView.extend.renderOnRoute menu.js:52invokeAction ember-latest.js:3174iterateSet ember-latest.js:3156sendEvent ember-latest.js:3273notifyObservers ember-latest.js:1865Ember.notifyObservers ember-latest.js:1980propertyDidChange ember-latest.js:2613set ember-latest.js:1419(anonymous function) ember-latest.js:10459f.event.dispatch jquery-1.7.2.min.js:3h.handle.i jquery-1.7.2.min.js:3,0 ,0 
HDFS health status when HA config'd,When NameNode HA is config'd:1) HDFS status green if and only if there is Active NameNode; red otherwise2) green -&gt; HDFS Service Stop enabled  HDFS Service Start disabled. red -&gt; HDFS Service Start enabled  HDFS Service Stop disabled,0 ,0 
When invalid jce policy file path is specified  ambari-server setup silently switches over to downloading the file from public repo,When an non-existent file is provided as jce-policy parameter we should get ambari-server setup process failed instead of downloading the file from public repo.Also  if the path is a folder then we should gracefully error out instead of allowing shutil.copy to fail with an error stack.,0 ,0 
ambari-agent RPM claims ownership of /usr/sbin,*This also affects trunk*The ambari-agent.spec (generated from rpm-maven-plugin) claims ownership of /usr/sbin $ grep sbin target/rpm/ambari-agent/SPECS/ambari-agent.spec | grep attr%attr(755 root root) /usr/sbinThis is a problem because the filesystem RPM owns /usr/sbin.According to rpm-maven-plugin documentation&#91;0&#93;  this is because the only file under /usr/sbin is ambari-agent and'directoryIncludedIf the value is true then the attribute string will be written for the directory if the sources identify all of the files in the directory (that is  no other mapping contributed files to the directory). This is the default behavior.'The 'no other mapping contributed files to the directory' bit is important.The solution is to add directoryInclude=false to the mapping.&#91;0&#93; http://mojo.codehaus.org/rpm-maven-plugin/map-params.html,0 ,0 
wrong property name for https address of NN in hdfs-site.xml,The property which defines the https address of namenode is dfs.namenode.https-address. In ambari   the property name is mentioned as 'dfs.https.namenode.https-address',0 ,0 
Modify the config mappings in the upgrade script to reflect the latest,Modify the upgrade mappings for hdfs-site  core-site  mapred-site  and global to reflect the latest.,0 ,0 
wrong path being set for JSVC_HOME on suse OS in hadoop-env.sh.,JSVC_HOME is being set to /usr/lib/hadoop/sbin/Linux-amd64-64/ instead of /usr/lib/bigtop-utils.,0 ,0 
Deploy progress bar is not correct,All ajax-requests are completed  but progress bar doesn't filled to 100%.,0 ,0 
The number of alerts in MapReduce item in menu gets out on the next line.,STD:Make the browser window's width less than actual width of the page.Go to Services page.Stop all services.Result:The number of alerts in MapReduce item in menu gets out on the next line.,0 ,0 
ambari-server setup silently fails when it cannot connect to the remote oracle host,The oracle db was installed on a host where port 1521 was not accessible to the ambari-server host. However  'ambari-server setup' did not report failure.Enter advanced database configuration [y/n] (n)? y==============================================================================Choose one of the following options:[1] - PostgreSQL (Embedded)[2] - Oracle==============================================================================Enter choice (1): 2Hostname (localhost): test-sm1.iad1Port (1521):Select Oracle identifier type:1 - Service Name2 - SID(1):Service Name (ambari): XEUsername (ambari):Enter Database Password (bigdata):Copying JDBC drivers to server resources...Configuring remote database connection properties...Copying JDBC drivers to server resources...Ambari Server 'setup' completed successfully.,0 ,0 
Add hcat.bin to pig.properties for hcat integration,Add hcat.bin to pig.properties for hcat integration.hcat.bin=/usr/bin/hcat,0 ,0 
On 2.x stack  dfs.block.local-path-access.user should not be set in hdfs-site,,0 ,0 
YARN cluster should not have shared directories between yarn.nodemanager.local-dirs and yarn.nodemanager.log-dirs,,1 ,0 
Incorrect alert for NodeManager,Error with RM nagios alert for rpc latency.[1380746845] SERVICE NOTIFICATION: nagiosadmin;&lt;hostaname&gt;;RESOURCEMANAGER::ResourceManager RPC latency;CRITICAL;notify-service-by-email;CRITICAL: Data inaccessible  Status code = 200,0 ,0 
'Assign Slaves and Clients' step. 'all | none' click error,Clicking on 'all|none' affects disabled checkboxes.,0 ,0 
When SSL is enabled on Hadoop JMX endpoints ResourceManager quick links become unavailable,When hadoop.ssl.enabled=true  ResourceManager port is 8090. When it is false  the port is still 8088.,0 ,0 
Text of installation stage doesn't correspond to reality,STD:On the latter stages of installing cluster  refresh page 'Install  Start and Test'..Result:Appeared 'Next' button and progress of installation is setted to 100%  but message of installation on the second host says that the Nagios Server is not installed yet. After clicking 'Next' all seems good and Nagios Server is installed normally.,0 ,0 
When multiple MR2 Clients are installed  the label is a bit off,When multiple MR2 Clients are installed  the MR2 summary panel has a label like: '3 MapReduce2 Client s Installed' (with an unnecessary space),0 ,0 
JavaScript errors during service tab changing,Steps:Open browser console.Run start or stop operation for any service.Switch between some services repeatedly.Result:'Calling set on destroyed view' was appeared in console.,0 ,0 
Status does not show up for newly added hosts,The problem is that host can have actual status only when service mapper recieve response(could be long latency  about 10 - 12 seconds) with new hostComponents and then status mapper compute them and set status to host.,0 ,0 
Remove RCO management logic at ambari-agent,In 1.5.0 release  ambari-agent will not need to process RCO to re-order/parallelizing tasks. Let's remove the code/unit-test and keep them aside in a JIRA targeted for release after 1.5.0. If possible  let's remove upgrade related code as well as there is no plan for automatic stack upgrade for Baikal. We can keep the python executor as there is a requirement for python executor.,0 ,0 
HBase Master/RegionServer can no longer be started after reconfiguring HBase or HDFS with NameNode HA enabled,,0 ,0 
Hbase secure config properties in HDP-2.x stack revert back to non-secure values on reconfiguration,,0 ,0 
'Assign Slaves' step. Error with installed NodeManagers,Installed NodeManagers don't appears as selected checkboxes on the 'Assign Slaves' step.,0 ,0 
Nagios doesn't start after upgrade [SLES11  1.3.2->2.0.6],check_cpu needs to be disabled for Suse for JobHistory server and ResourceManager,0 ,0 
Incorrect status counters on cluster deploy,In host stauts filter label shows incorrect number of hosts after deploy failed.Wrong progress bar color  on fail color should be red or yellow  instead of blue.,0 ,0 
DB url isn't calculated automatically,Select Hive or Oozie and go to step 'Customize services'.'Open' Oozie tab.Database Url is 'jdbc'.Click 'Existing MySQL Database'.Click 'New Derby Database'.Database Url became jdbc:derby:${oozie.data.dir}/${oozie.db.schema.name}-db;create=true.Expect:proper value should be right after step is loaded.,0 ,0 
Hadoop Core Health Check script needs to be included in Ambari HDP installations,,0 ,0 
skip 'Customize Services' step for services that can't be customized,Services like PIG  Sqoop can't be customized.Wizard should check services-list (that user want to add) and if no one service can't be customized  should skip 'Customize' step ('Back' click on the next step should also be verified).,0 ,0 
Allow log4j properties to be applied via the API in Ambari for hadoop/oozie/hbase/hive/zookeeper/pig,Allow log4j properties to be applied via the API in Ambari for hadoop/oozie/hbase/hive/zookeeper/pig.,0 ,0 
NameNode HA wizard: Refreshing the wizard displays incorrect manual commands.,Install HDFS with customized hostname hdfs1. Start NameNode HA wizard and Refresh on step-2 (select host). Proceed ahead. Create checkpoint step asks to run command with incorrect user name:sudo su -l hdfs -c 'hdfs dfsadmin -safemode enter' Above command returns safemode: Access denied for user hdfs. Superuser privilege is required Actual command should be:sudo su -l hdfs1 -c 'hdfs dfsadmin -safemode enter',0 ,0 
'Config' step refresh,Go to Config Step on the addServiceWizard.Refresh page.Got JS error  because selected services where not saved.Expect: get page with config list for selected services.,0 ,0 
Cleanup UI restart calculations using actual_configs,As documented in AMBARI-3531  the restart flags will be provided in host_components itself and services will have an API to get restart host_components easily. Due to this  there is no need for actual_configs on the client  and the code to calculate diffs with global properties.,0 ,0 
Reassign Master: Misc UI display fixes,This ticket mainly covers UI label and message changes in reassign master wizard.,0 ,0 
Common storage for different wizards,Some wizards (installer  addHosts  addServices) use common local storage objects.But each should has separated object (for example  based on controllerName).,0 ,0 
Service reconfiguration fails for multiple services,Service reconfiguration fails for HDFS  MapReduce and Hive service with js error. For other services it fails silently without any error (no API call is triggered).,0 ,0 
os_type_check.sh for RHEL is too restrictive (Server vs Workstation),The /etc/redhat-release on my RHEL6.4 dev box containsRed Hat Enterprise Linux Workstation release 6.4 (Santiago)os_type_check.sh is checking for 'Server' on rhel boxes. It should simply check for Red Hat Enterprise Linux and ignore text up to the version number.,0 ,0 
Hosts: clarify which filter is in effect,1. Use a shadow with high contrast to make the current filter more visible.2. Show how many hosts total / how many are in the current view  and a 'Clear all filters' link.,0 ,0 
Enable HA wizard loads after sign in,Steps: Go to 'Admin' page -&gt; 'High Availability' tab and run 'Enable NameNode HA' wizard. Close wizard. Sign out (or reopen browser). Sign in.Result:After sign in was opened first page of 'Enable NameNode HA' wizard instead 'Dashboard' page.,0 ,0 
Ambari agent creates empty folder /var/ambari-agent,Ambari agent creates an empty directory /var/ambari-agent during installation.This directory isn't needed  /var/run/ambari-agent is used instead.,0 ,0 
host actions UI changes based on new stop/start all and delete func,1. Do the right-float on the action menus on the Components section.2. Rename buttons: on SERVICE PAGES: Maintenance --&gt;Service Actions...on HOST PAGES: Maintenance --&gt; Host Actions...on HOST PAGES / COMPONENT SECTION: Actions --&gt; Actions...,0 ,0 
cleanup dialog for unable to delete host,make dialog according to left mockup,0 ,0 
LiveStatus of the component is not updated when username is changed,Steps to reproduce: On installer wizard  make install phase fail by killing any install task of master component. Go back and change hdfs username to hdfs1. Proceed ahead and installer wizard completes successfully. HDFS service is red. Nagios shows no alerts  but API returns INSTALLED status for all hdfs host components. UI impact: On starting HDFS  all tasks completes successfully with 100% green progress bar but service status always remains red. Restarting agent resolves the issue.Looks like AmbariConfig.servicesToPidNames is not getting updated when username is changed.,0 ,0 
traceback when attempting to stop ambari-agent as non-root,I attempted to stop the ambari-agent without going to root first. Prints a pretty bad traceback.&#91;vagrant@c6403 ~&#93;$ ambari-agent stop/usr/sbin/ambari-agent: line 66: /var/lib/ambari-agent/ambari-env.sh: Permission deniedVerifying Python version compatibility...Using python /usr/bin/python2.6Found ambari-agent PID: 2996Stopping ambari-agentTraceback (most recent call last):File '/usr/lib/python2.6/site-packages/ambari_agent/main.py'  line 235  in &lt;module&gt;main()File '/usr/lib/python2.6/site-packages/ambari_agent/main.py'  line 190  in mainsetup_logging(options.verbose)File '/usr/lib/python2.6/site-packages/ambari_agent/main.py'  line 73  in setup_loggingrotateLog = logging.handlers.RotatingFileHandler(logfile  'a'  10000000  25)File '/usr/lib64/python2.6/logging/handlers.py'  line 112  in initBaseRotatingHandler.init(self  filename  mode  encoding  delay)File '/usr/lib64/python2.6/logging/handlers.py'  line 64  in initlogging.FileHandler.init(self  filename  mode  encoding  delay)File '/usr/lib64/python2.6/logging/init.py'  line 827  in __initStreamHandler.init(self  self._open())File '/usr/lib64/python2.6/logging/init.py'  line 846  in _openstream = open(self.baseFilename  self.mode)IOError: &#91;Errno 13&#93; Permission denied: '/var/log/ambari-agent/ambari-agent.log'Removing PID file at /var/run/ambari-agent/ambari-agent.pidrm: cannot remove '/var/run/ambari-agent/ambari-agent.pid': Permission deniedambari-agent successfully stopped,0 ,0 
HA cluster: some dashboard's widgets contain 'Null'  'NaN' values after services stop,Steps:Stop YARN service.Go to 'Dashboard'.Result:'NodeManagers Live' widget contains 'null' values.Similar problem is present for 'HBase Ave Load' widget - 'NaN' value.,0 ,0 
Failed to start Hive Metastore (centos5.8  Stack 2.0),Occurred during install as warning (could not start the service). Clicked next to continue  when into Ambari  then tried to start Hive there as well  same issue.,0 ,0 
Poll for host_components which have stale_configs,UI needs to know which host_components need restart due to stale_configs (saved but not picked up). Server API provide stale_configs flag per host-component. We need this polled and maintained on client model.,0 ,0 
UI does not update active hbase master in display,When we have 3 HBase masters we show in UI that one of them is active. When the master is stopped  the other HBase master is not marked as active in UI. In API it does become active.,0 ,0 
Default value of 'Default virtual memory for a job's map-task' is not valid,The default value of 'Default virtual memory for a job's map-task' (in Customize Services page -&gt; MapReduce2 tab -&gt; General) was '619.5'.Warning hint says 'Must contain digits only'Value depends on quantity of installed components.,0 ,0 
Better error message needed when incompatible ambari-agents installed,On a few days old cluster I attempted to add a host. The add host failed due to ambari-server trying to install ambari-agent-1.4.1.17 and the repo having ambari-agent-1.4.1.23-1.The message in /var/run/ambari-server/bootstrap/11/hostname.log was:STDERRscp /usr/lib/python2.6/site-packages/ambari_server/setupAgent.py done for host srimanth1-5.c.pramod-thangali.internal  exitcode=0Copying files finishedRunning setup agent...STDOUTError: Nothing to do{'exitstatus': 1  'log': ('Loaded plugins: downloadonly  fastestmirror  security/nDetermining fastest mirrors/n * base: www.gtlib.gatech.edu/n * extras: centos.mirror.netriplex.com/n * updates: mirror.cogentco.com/nSetting up Install Process/nNo package ambari-agent-1.4.1.17 available./n'  None)},0 ,0 
NameNode HA wizard (Configure Components step): Task 'Reconfigure HDFS' always fail  and user cannot proceed to next step,This task fails due to bad request:/api/v1/clusters/c1/hosts/HDFS_CLIENT/host_components/dev01.hortonworks.comShould be: api/v1/clusters/c1/hosts/dev01.hortonworks.com/host_components/HDFS_CLIENT,0 ,0 
Typo in text label on Hosts page,On the Hosts page  we have a typo in the label 'filterd'. Should be 'filtered'.,0 ,0 
'Confirm hosts' shows 'ntpd not running' warning  but it's running on host,STR: Install  setup and start Ambari server by default. Reach 'Choose services' phase of installer.Actual result:'Confirm hosts' shows warning that ntpd service isn't running on hosts  but it's running in console by command service ntpd status,0 ,0 
Modify UI text for host cleanup,python /usr/lib/python2.6/site-packages/ambari_agent/HostCleanup.py -s -k 'users'To cleanup in interactive mode  remove *-s* option. To cleanup all resources  including _users_  remove *-k users* option. Use *--help* for a list of available options. The motivation is to provide the conservative option but minimal detail to allow for full clean up.,0 ,0 
Reduce logs emitted to report heartbeats from agents,For a 657 node cluster:~10 minute for 10 MB and 20 log files store about 200 minutes (~3 hours) of log. This is not ideal if an error overnight needs to be investigated. We should try for the log to last 24 hours - ideally 72 hours to account for weekends.-rw-r--r-- 1 root root 10485854 Oct 17 17:35 ambari-server.log.6-rw-r--r-- 1 root root 10485836 Oct 17 17:44 ambari-server.log.5-rw-r--r-- 1 root root 10485811 Oct 17 17:52 ambari-server.log.4-rw-r--r-- 1 root root 10485793 Oct 17 18:01 ambari-server.log.3-rw-r--r-- 1 root root 10485793 Oct 17 18:10 ambari-server.log.2-rw-r--r-- 1 root root 10485854 Oct 17 18:18 ambari-server.log.1,0 ,0 
Reconfigure of dynamic configs not showing modified values,Modifications of dynamic properties are being persisted on server  but default values are being shown in UI. Also  we should not validate dynamic configs which are of type string. mapreduce.map.java.opts mapreduce.reduce.java.opts yarn.app.mapreduce.am.command-opts,0 ,0 
When filtering on hosts  the table column sizes shift  should stay fixed.,For the 'defaultsProvider' and 'serviceValidator' functionalities  we need unit tests,0 ,0 
Reassign Master Wizard does not display folder and hosts on 'Manual commands' page after browser reopening,Steps: Open 'Reassign Master Wizard' for NameNode or SNameNode. Go to 'Manual commands' page. Close browser and open it again.Result: Was opened 'Manual commands' page  but hostnames and foldername were replaced with '{1}'  '{2}' etc.Attached picture for other page  but behavior is similar.,0 ,0 
Provide read-only view of repo options in Ambari Web,If a user is using local repos  and customizes Advanced Repository Options during install  the user might need this info to debug post install (since it is used in Add Hosts)  for example.Note: We should show this information regardless if the user customizes repos or not during install.,0 ,0 
Incorrect host status when slave down,When host has slave down status 'No Heartbeat' status is shown instead of 'Slave Down'.,0 ,0 
Restart indicators for services and hosts disappear after some time.,Goto Service (that have stale configs) -&gt; configs   no restart indicators are shown. Refresh page  for 10-15 seconds you see indicators then they disappear. The same for host detail page,0 ,0 
Ganglia monitor started with second or third attempt on secure cluster,,0 ,0 
Background ops dialog checkbox UI cleanup,The OK and the text should be on the same centerline row.,0 ,0 
Remove Exception message printed to log for successful starts,Following error messages are printed to log with default log level and are misleading.04:19:52 438 ERROR [main] MasterKeyServiceImpl:109 - Master key is not provided as a System property or an environment varialble.04:19:52 439 INFO [main] Configuration:415 - Credential provider creation failed.Master key initialization failed.,0 ,0 
HBase Links widget has 'more' button out of bounds and looks broken when there are multiple masters,When there are multiple HBase Masters  the HBase Links widget looks broken. Let's get rid of the 'and X Standby Masters' static text as it is not a link and not very useful.So the widget would look like:'HBase Master''X RegionServers''Master Web UI',0 ,0 
MR jobs are hanging on a 2-node cluster with default configuration,This is a 2-node cluster with 2GB of RAM each. Cluster deployment goes fine but MR jobs do not complete resulting in service check failures for MR  OOZIE  Pig  etc.,0 ,1 
Add host wizard: After successfully bootstrapping host  'next' button is disabled,See screenshot,0 ,0 
Provide config-group support in add-host wizard,When adding hosts  a user should be able to select which config-groups this host belongs to. Configurations of that group (Default or config-group) will be applied on that host.,0 ,0 
'Uncaught exception' in JS while navigating through services on Services page,This one was discovered while quick navigating through services on Services page.To reproduce just try to click on services links fast.After that service content is not displayed.,0 ,0 
Need better error log message when agent unable to reach server,http://hortonworks.com/community/forums/topic/installing-hdp2-0-6-on-centos6-4/The current ERROR in the agent log can be cryptic.,0 ,0 
Ambari should allow changing Ganglia cache location,Ambari allows changing Ganglia directory during installation  but not after the cluster is installed. We should allow changing this directory after cluster installed,0 ,0 
During cluster install cannot go past Step0,UI makes a call to http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions?fields=Versions operatingSystems/repositories/Repositories.The API is missing the operatingSystems info  except for the suse11 one:{ 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions?fields=Versions operatingSystems/repositories/Repositories'  'items' : [ { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions/1.2.0'  'Versions' : { 'active' : false  'min_upgrade_version' : null  'parent_stack_version' : null  'stack_name' : 'HDP'  'stack_version' : '1.2.0' }  'operatingSystems' : [ ] }  { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions/1.2.1'  'Versions' : { 'active' : false  'min_upgrade_version' : null  'parent_stack_version' : null  'stack_name' : 'HDP'  'stack_version' : '1.2.1' }  'operatingSystems' : [ ] }  { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions/1.3.0'  'Versions' : { 'active' : false  'min_upgrade_version' : null  'parent_stack_version' : null  'stack_name' : 'HDP'  'stack_version' : '1.3.0' }  'operatingSystems' : [ ] }  { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions/1.3.2'  'Versions' : { 'active' : true  'min_upgrade_version' : null  'parent_stack_version' : null  'stack_name' : 'HDP'  'stack_version' : '1.3.2' }  'operatingSystems' : [ ] }  { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions/1.3.3'  'Versions' : { 'active' : true  'min_upgrade_version' : null  'parent_stack_version' : null  'stack_name' : 'HDP'  'stack_version' : '1.3.3' }  'operatingSystems' : [ ] }  { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions/2.0.5'  'Versions' : { 'active' : false  'min_upgrade_version' : null  'parent_stack_version' : null  'stack_name' : 'HDP'  'stack_version' : '2.0.5' }  'operatingSystems' : [ ] }  { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions/2.0.6'  'Versions' : { 'active' : true  'min_upgrade_version' : null  'parent_stack_version' : null  'stack_name' : 'HDP'  'stack_version' : '2.0.6' }  'operatingSystems' : [ { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions/2.0.6/operatingSystems/centos5'  'OperatingSystems' : { 'os_type' : 'centos5'  'stack_name' : 'HDP'  'stack_version' : '2.0.6' }  'repositories' : [ ] }  { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions/2.0.6/operatingSystems/centos6'  'OperatingSystems' : { 'os_type' : 'centos6'  'stack_name' : 'HDP'  'stack_version' : '2.0.6' }  'repositories' : [ ] }  { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions/2.0.6/operatingSystems/oraclelinux5'  'OperatingSystems' : { 'os_type' : 'oraclelinux5'  'stack_name' : 'HDP'  'stack_version' : '2.0.6' }  'repositories' : [ ] }  { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions/2.0.6/operatingSystems/oraclelinux6'  'OperatingSystems' : { 'os_type' : 'oraclelinux6'  'stack_name' : 'HDP'  'stack_version' : '2.0.6' }  'repositories' : [ ] }  { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions/2.0.6/operatingSystems/redhat5'  'OperatingSystems' : { 'os_type' : 'redhat5'  'stack_name' : 'HDP'  'stack_version' : '2.0.6' }  'repositories' : [ ] }  { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions/2.0.6/operatingSystems/redhat6'  'OperatingSystems' : { 'os_type' : 'redhat6'  'stack_name' : 'HDP'  'stack_version' : '2.0.6' }  'repositories' : [ ] }  { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions/2.0.6/operatingSystems/sles11'  'OperatingSystems' : { 'os_type' : 'sles11'  'stack_name' : 'HDP'  'stack_version' : '2.0.6' }  'repositories' : [ ] }  { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions/2.0.6/operatingSystems/suse11'  'OperatingSystems' : { 'os_type' : 'suse11'  'stack_name' : 'HDP'  'stack_version' : '2.0.6' }  'repositories' : [ { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/stacks2/HDP/versions/2.0.6/operatingSystems/suse11/repositories/HDP-2.0.6'  'Repositories' : { 'base_url' : 'http://public-repo-1.hortonworks.com/HDP/suse11/2.x/updates/2.0.6.0'  'default_base_url' : 'http://public-repo-1.hortonworks.com/HDP/suse11/2.x/updates/2.0.6.0'  'mirrors_list' : null  'os_type' : 'suse11'  'repo_id' : 'HDP-2.0.6'  'repo_name' : 'HDP'  'stack_name' : 'HDP'  'stack_version' : '2.0.6' } } ] } ] } ]},0 ,0 
Provide add/remove/rename/duplicate actions in manage-config-groups dialog,Various config-group actions (add/remove/rename/duplicate) should be provided in the manage-config-groups dialog. Any of these should not rely on the Save button  but are immediately persisted via API.,0 ,0 
Do not store disks_info in DB. Store it as dynamic info in memory that can be used to show on the UI.,Currently  we store disks info in DB and this information is never updated after registration. As disks details can change (space availability changes  disks get mounted/unmounted  etc.) the persisted information is not useful.We should instead hold the details in memory and refresh it at certain intervals (e.g. once every 10 minutes) and then alert if space availability hits some lower limit.,0 ,0 
'Add service' if nothing to add,Disable and gray out the Add Services button if there aren't any more services to be added.Upon hover  show a tooltip saying 'No more services to be added'.Although we hide the 'Add Component' button when no more components are to be added  we don't actually like that and want to move towards 'disabling/graying out with hover tooltip' pattern.,0 ,0 
Remove  Rename actions enabled for 'Default' config group,In the Manager Configuration Groups dialog I selected the Default config-group  and the actions to remove and rename config-group are enabled. These ops are not allowed for Default config-group.,0 ,0 
Provide change config-group action on host configs,On a host's configs page  provide a Change action beside config-group to switch from one group to another  or to Default.,0 ,0 
Unable to close manage-config-groups dialog when only Default group present,I had only the Default config-group when I launched the manage config-groups dialog. When I clicked on Cancel or X  it would not close dialog with the following error:Uncaught TypeError: Cannot read property 'id' of null This was in method updateConfigGroupOnServicePage() at the first line belowselectedConfigGroup = managedConfigGroups.findProperty('id'  selectedConfigGroup.id); if(selectedConfigGroup){ mainServiceInfoConfigsController.set('selectedConfigGroup'  selectedConfigGroup); }else{ mainServiceInfoConfigsController.set('selectedConfigGroup'  managedConfigGroups.findProperty('isDefault'  true)); },0 ,0 
Services sidebar for host configs needs vertical gap,When you go to host configs page  there is no gap between the services sidebar and the tabs. This should be changed so that the config-group bar and services sidebar have the same gap from the tabs at top.,0 ,0 
Host configs page should properly order services,When App.supports.hostOverridesHost is enabled  and you visit the configs page for a host  the services are in some random order. They should be in the same order as the services page.Also  there is a small empty entry in the menu  which gives like a 5px extra space between some services. You can even hover on this empty entry and it will highlight.,0 ,0 
Error in saving host for newly created config group,After creating new Config Group in Manage Configuration Groups dialog try to add host to this group and save. Also sometimes '+' button to add hosts is disabled for newly created group.,0 ,0 
Clicking on Settings link navigates to login page for a non-admin user.,This happens because non-admin users are not authorized to make POST/PUT calls to any resource  including 'persist'.For now  let's hide 'Settings' if the user is a non-admin user.,0 ,0 
JS Error in 'Add Host Wizard' if we proceed with failed registered hosts,1. Add two hosts in Add Host Wizard.2. In Conform Hosts step  one registered successfully  the other failed.3. Proceed to next  JS error happened when deploy  wizard UI hang up.,0 ,0 
Add host fails after configuring NN HA with JavaScript error,,0 ,0 
Unittests for User resource an all it's attributes,Test resource User of resource management . Test all actions and all the attributes. Please make sure we mock to check both cases when user already exists and when it's not.Note here we should not call directly provider methods like action_create  but make resource management library do that for us  by calling env.run(). In other case test won't cover resources definitions  and other import logic,0 ,0 
Duplicate config-group action not duplicate configs,Override like 3 configs in a config group and save. Now go to the Manage Config Groups dialog and select this group and click on Duplicate action. A popup with name and description pops up and hitting OK creates the duplicated config group.Though this duplicated config group has the correct name/description  it does not have the duplicated configs (3 that we overrode). When doing the POST call  we should populate the desired_configs to be the exact same as the source config-group.,0 ,0 
ResourceManager Heap metrics is not correct on Ambari console,PROBLEM: The ResourceManager Heap metrics on Ambari web console doesn't show the correct value  not only the current heap usage doesn't reflect the correct usage  but also the total heap size doesn't match what we configure for the ResourceManager Heap size  even the total heap size number is changing constantly.,0 ,0 
UI incorrect behavior during upgrade,This issue was discovered while upgrading the cluster to hash 87adc8c2d29b20a30f01e54c12f67dcbbe34b32e of 1.4.2 branch. The logic inside configuration_controller.js function getConfigsByTags(tagObject) has a reference to undefined variable and js error was encountered. This happened when any of the service page was rendered and program flow from quick_view_link_view.js function didInsertElement() -&gt; setQuickLinks() -&gt; loadTags() -&gt; loadTagsSuccess(data) -&gt; getSecurityProperties() -&gt; configurationController.getConfigsByTags(tag),0 ,0 
Background operations popup window minimum size should be fixed when narrowing down the browser,,0 ,0 
Incorrect restart required tooltip view,When components and hosts required to restart we show refresh icon near the service name. On icon hover event we show tooltip with count of components and hosts.,0 ,0 
Background operations: two scrollbars  if width is lower then 1450px,Screenshot attached.,0 ,0 
Restart indicator flags not showing up for HDP 1.3.x stack services,When config-groups are used for HDP 1.3.x stack services  the stale_configs are always false.,0 ,0 
'HDFS Short-circuit read' config property is repeated,,0 ,0 
Modify messages from 'reassign master' to 'move master',,0 ,0 
Security Wizard: Service Configuration page is broken,Trying to enable security  the configurations page is blank.,0 ,0 
Add Host wizard stuck on configuration step,Cluster should have service(HDFS PIG SQOOP) which doesn't have any slave or client host-components.1. Run Add Host wizard2. Proceed to configuration stepResult: Wizard popup stuck in loading processJS error:Uncaught TypeError: Cannot call method 'get' of undefined app.js:10245(anonymous function) app.js:10245App.AddHostController.App.WizardController.extend.loadServiceConfigGroups app.js:10242(anonymous function) app.js:43659f.Callbacks.o vendor.js:95f.Callbacks.p.add vendor.js:95(anonymous function) app.js:43657f.Callbacks.o vendor.js:95f.Callbacks.p.fireWith vendor.js:95f.Callbacks.p.fire vendor.js:95(anonymous function),0 ,0 
Hovers stay after manage-config-groups dialog is closed,I opened the manage-config-groups dialog and hovered on one of the actions (remove host from config-group). Then I saved or cancelled to close the dialog. The hover still remains in the middle of page.I have seen this in other usages as well. We need to make sure that all hovers are closed when the focus is lost.,0 ,0 
Adding host to multiple groups at the same time fails,Steps:1. Create 2 config groups2. Rename 1 config group3. Add hosts to renamed config group4. Add host to other config group.Result:Save stops working. Error in the JS console.Error in JS console:Uncaught TypeError: Cannot call method 'sort' of undefined manage_config_groups_controller.js:460(anonymous function) manage_config_groups_controller.js:460(anonymous function) manage_config_groups_controller.js:458ComputedPropertyPrototype.get ember-latest.js:2949get ember-latest.js:1355getPath ember-latest.js:1477get ember-latest.js:1348Ember.Observable.Ember.Mixin.create.get ember-latest.js:7695App.ModalPopup.show.onPrimary item.js:251newFunc ember-latest.js:949ActionHelper.registeredActions.(anonymous function).handler ember-latest.js:19458(anonymous function) ember-latest.js:11250f.event.dispatch jquery-1.7.2.min.js:3h.handle.i,0 ,0 
Missing host message on cluster deploy,When execute any service check  host message become empty. Server return  unsupported on UI  command of task - 'SERVICE_CHECK'.,0 ,0 
JS error when switching config groups in Hive / Oozie service config pages,,0 ,0 
HBase Master alerts are confusing in multi-master environment,When multiple HBase Masters are set up  HBase service-level alert section shows multiples of the following: HBase Master process HBase Master Web UI HBase Master CPU utilizationThe label is exactly the same for all masters  so you can't distinguish which alert is for which master. Ambari should mirror what ambari does for NameNode alerts so that the user can tell them apart (append hostname in the alert label).,0 ,0 
hbase.zookeeper.quorum changing inconsistently on hosts after adding ZookeeperServer,Issue 1:Steps followed: 1. Install a 3-node cluster with Hbase and Zookeeper and 3 zookeeper servers. 2. After installation on each host the property hbase.zookeeper.quorum in /etc/hbase/conf/hbase-site.xml has:&lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt; &lt;value&gt;c6401.ambari.apache.org c6402.ambari.apache.org c6403.ambari.apache.org&lt;/value&gt;3. After adding a host with Hbase Region Server  and after that a ZookeeperServer to it  the property on the added c6404.ambari.apache.org host has the same value  as in 2. 4. After restarting HBase master on c6401 (which is proposed by UI)  the property value on c6401 becomes:  &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt; &lt;value&gt;c6401.ambari.apache.org&lt;/value&gt;. On other hosts it remains unchanged. 5. After restarting HbaseRegionServers on the rest of the hosts (not proposed by ui)  the property changes too  to the same value  as in 4. __________________________________________________________Issue 2:Property templeton.zookeeper.hosts in /etc/hcatalog/conf/webhcat-site.xmlPrior to adding a zookeeperServer on host c6404  config on WebHCat server lookes like:[root@c6402 vagrant]# cat /etc/hcatalog/conf/webhcat-site.xml |grep templeton.zookeeper.hosts -C 2 &lt;configuration&gt; &lt;property&gt; &lt;name&gt;templeton.zookeeper.hosts&lt;/name&gt; &lt;value&gt;c6401.ambari.apache.org:2181 c6402.ambari.apache.org:2181 c6403.ambari.apache.org:2181&lt;/value&gt; &lt;/property&gt;After adding a ZookeeperServer on c6404 and restarting WebHCatServer on c6402: [root@c6402 vagrant]# cat /etc/hcatalog/conf/webhcat-site.xml |grep templeton.zookeeper.hosts -C 2 &lt;/property&gt; &lt;property&gt; &lt;name&gt;templeton.zookeeper.hosts&lt;/name&gt; &lt;value&gt;c6401.ambari.apache.org&lt;/value&gt; &lt;/property&gt;__________________________________________________________Issue 3. On a 3-node cluster with HA-enbaled  property ha.zookeeper.quorum in /etc/hadoop/conf/core-site.xml  has the same value on all hosts:  &lt;name&gt;ha.zookeeper.quorum&lt;/name&gt; &lt;value&gt;c6401.ambari.apache.org:2181 c6402.ambari.apache.org:2181 c6403.ambari.apache.org:2181&lt;/value&gt;It doesn't change on either of the hosts after adding c6404 to the cluster  installing ZookeeperServer on it and restarting HDFS.,0 ,0 
Services mysteriously disappear after Stack upgrade,,0 ,0 
Background operations window  called from wizard doesn't react to 'Do not show this dialog...' flag,STR:Go through the Reassign NameNode wizard.On the last step click on the Start All Services link.Change the state of flag Do not show this dialog again when starting a background operation.Click OK.Click Start All Services link again.Result: State of flag was not changed.,0 ,0 
Config Groups: Background popup show up needs to be integrated when restarting components,1. Change config group for a service.2. Click 'Stop components' on service config page.3. Click 'Start components' on the same page.Actual results:Background Operations popup will always show up. (as attached)Expected results:Load the 'do not show this dialog..' flag first  then determine if show this popup.,0 ,0 
YARN and MapReduce2 configs is not displayed,In Services -&gt; Configs YARN and MapReduce2 configs is not displayed.,0 ,0 
Resource providers are set with wrong stack version.,AbstractProviderModule.updateClusterVersion sets the cluster version for the resource providers with the following ... PropertyHelper.MetricsVersion version = clusterVersion.startsWith('HDP-1') ? PropertyHelper.MetricsVersion.HDP1 : PropertyHelper.MetricsVersion.HDP2;So  the Cluster/version property set to 'HDPLocal-1.3.2' will incorrectly be detected as HDP2. This causes the property providers to use the wrong metric mapping files which causes many JMX properties not to be set properly.,0 ,0 
Manage config group links needed in save config-group confirmation,When any service config-group is saved  we have a confirmation popup saying save was successful. We should enhance that popup to have a button to Manage Config Groups dialog  along with appropriate message. When button is clicked  the popup should go away and the Manage Config Groups dialog should show.,0 ,0 
After making config changes w/o saving  prompt user if they try to navigate away,1) Browse to Services &gt; HDFS &gt; Configs2) Change some props3) Do not click save4) Browse away  to Summary or to another serviceUser would have lost config changes. We should prompt before allowing user to navigate away from Configs.'You have unsaved changes. Save changes or discard?'&#91;Discard&#93; &#91;Save&#93;,0 ,0 
Config-Group POST call should tolerate name reuse,Cluster wide we prohibit reuse of config-group name. However names can be reused across services. The API should be updated to tolerate POST/PUT of similar named config-groups.,0 ,0 
Long host names are inconvenient for viewing in background operations popup,Steps: Open background operations window and select any operation.Result: If the host name is too long  they are not placed on designated place.Solution:If the host name is too long  we show part of the string with '...' at the end.Also the string should keep in a single line all the time,0 ,0 
Add Service Wizard: Customize Services configs are not displayed.,In 'Customize services' step in 'Add Service Wizard' config group and configs are not displayed. See screenshot.,0 ,0 
Duplicate hosts after closing addServiceWizard,Install cluster with 2 hosts (with HDFS  ZooKeeper).Go to Add Service Wizard.Select some configurable service.Go to Step 4 (Customize services).Close wizard.Go to Hosts page.Result:each host appears two times.,0 ,0 
NameNode max heap is not showing in HDP 1.3.2 stack,Reason:We use in-consistent value to show Heap size for different components.And some of them are missing.Solution:Make sure all Heap size percentage value (including NN  RM  JT and HBase Master) use the same property.,0 ,0 
HiveSchema file for Hive should be hive-schema-0.12.0.oracle.sql,HiveSchema file for Hive should be hive-schema-0.12.0.oracle.sql,0 ,0 
Dashboard quick links polls desired_configs every 6s,On the dashboard  calls to /clusters/{clusterName}?fields=Clusters/desired_configs are made every 6s. We need to verify if this really is necessary. Initial investigation revealed calls from quick-links  where links were set based on security being enabled. But there is no need to poll every 6s for this.,0 ,0 
In installer  behavior of actions in manage config-groups dialog different from reconfigure,During reconfigure  in the Manage Config Groups dialog  the actions below the config-groups table (left table - Add/Remove/Duplicate/Rename) are immediate - you do not need to hit Save. Save is only for host membership changes. If host membership changes  the actions under left-table are disabled till Save. During install however  all actions are allowed till Save is hit. If you rename/duplicate and hit Cancel  all changes are lost - something which does not happen during reconfigure.The installer dialog should have similar behavior to reconfigure dialog.,0 ,0 
Refactor templates and popups,,0 ,0 
Minor manage-config-group dialog UI changes,Label on top of left hand config-group table should be removed Left hand table and right hand table should occupy 1/3 and 2/3 of the dialog.,0 ,0 
Rename config-group dialog should allow only description change also,We wanted to change just the config-group description  but were unable to change without changing the name. The rename config-group dialog should allow changing description only also.,0 ,0 
Need to show stale-config indicator on hosts page,We show the restart indicator for stale-configs on services and individual host. Since we already have that information on the client  we need to show that on the Hosts page table. We need a filter to select stale-config hosts  and also show beside each host the stale-config indicator.,0 ,0 
ambari-agent/server should start automatically upon reboot,ambari-agent and server are not set to start automatically  so if a machine reboots it becomes inaccessible.,0 ,0 
Add hosts  if using Local Repository  UI incorrectly says 'no',On review page of install wizard/add host wizard -List the repos with their OS-Say 'Repositories'  not 'Local Repository'-Not a yes or no,0 ,0 
Installer's host list doesn't show masters at top,Installer's host list should show masters at top,0 ,0 
HDFS/ZKFC relations in EmberData,After enabling HA go to hosts page.Open host's page for host that has ZKFC.ZKFC doesn't have service.Expect:ZKFC should have HDFS as service.,0 ,0 
Need tooltip showing error why local repo is bad,I selected HDP 2.0.8 stack and Centos5 base-url was bad. The reason was given in the response - but it is not shown anywhere in UI. On the red exclamation mark we need a tooltip showing the error message from server along with HTTP error code.,0 ,0 
TestHardware.test_fqdnDomainHostname() fails,The unit test failsFAIL: test_fqdnDomainHostname (TestHardware.TestHardware)----------------------------------------------------------------------Traceback (most recent call last): File '/home/dmitry/incubator-ambari/ambari-common/src/test/python/mock/mock.py'  line 1199  in patched return func(*args  **keywargs) File '/home/dmitry/incubator-ambari/ambari-agent/src/test/python/ambari_agent/TestHardware.py'  line 83  in test_fqdnDomainHostname self.assertEquals(result['hostname']  'ambari')AssertionError: 'dmitry-pc' != 'ambari',0 ,0 
Should not allow blank config group name,1) Create config group2) just enter a &lt;space&gt; for the name3) That enables the OK button to save4) You can save that config group w/o a name.is reproducible on installer (works fine after installation),0 ,0 
Manage Config Group link appears on host detail page (and cannot dismiss it once opened),,0 ,0 
HA wizard not accessible after upgrade,,0 ,0 
Stale config indicator not shown when reconfiguring WebHCat  Ganglia  Nagios  ZooKeeper,Steps: Create a config group for any of the mentioned services and add a host to the config group. Save the config group.Result:Restart indicators do not appear.,0 ,0 
Review page doesn't have info about Repositories,Load Repositories info in the same way as for add Host Wizard.,0 ,0 
Ability to restart a component,Add option to Actions menu for 'restart'. That should queue the stop and start tasks.We should assume 'RESTART' as a default command. The base/default implementation is to call STOP and then START.,0 ,0 
Service Config page shows a blank page after enabling security (JS error),UI don't respond after enabling security,0 ,0 
Fix UI Unit tests,,0 ,0 
YARN check execute fails on install,YARN check execute fails on install. See attached logs.IP Address on Hosts Page is shown as OS NOT SUPPORTED (w/o js errors  cluster installed using regular Nano-CentOS5.9 image type),0 ,0 
Fix versions of rpms in the stack to match the installed ones.,Fix versions of rpms in the stack to match the installed ones.,0 ,0 
Global configs are not sent to server,On the Deploy step Global Configs are not sent to server.So  Nagios and Ganglia (if installed via add service wizard) don't have any configs in service config page.,0 ,0 
Misalignment of 'Filter' combobox on installer when browser window is narrow,,0 ,0 
Minor UI cleanup - remove double-borders  reduce text,Remove double borders on alerts and host component page sections Remove some text to not wrap in 'delete host' dialog Remove 'Hosts' table header to clean-up config group dialog,0 ,0 
Significant lag between host status update and slave/master component start/stop,Steps: Go to any host with slave component (DataNode  for example). Click 'Stop' options for slave component.Result: status marker for slave component start blinking red  but status marker for host behaves strangely: sometimes it also start blinking red immediately/ sometimes changes status to not-blinking red only after slave component stopping will be ended.The same for slave component starting.,0 ,0 
Frontend: History server should be managed as separate component,For stack 1.x history server will be as separate master component. Add ability to choose host on which this component will be installed. Set value for 'mapreduce.history.server.http.address'  i.e. &lt;historyserverHost&gt;:&lt;historyServerPort&gt;.,0 ,0 
Empty content of review step in Add Host wizard,JS error: Uncaught TypeError: Cannot call method 'forEach' of undefined,0 ,0 
Mirroring page redesign,Redesign existing Mirroring page with datasets table according to new attached mockups.,0 ,0 
Padding for config override properties,,0 ,0 
When issuing Start/Stop of host components then predicate stale_config=true does not work,See the series of curl calls below.There are no components with stale configs but 4 components are being stopped. There are only 4 because Ambari only allows INSTALL call on already installed clients[root@c6401 vagrant]# curl -i -uadmin:admin -H 'X-Requested-By: ambari' http://c6401.ambari.apache.org:8080/api/v1/clusters/c1/host_components?HostRoles/stale_configs=true{ 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/clusters/c1/host_components?HostRoles/stale_configs=true'  'items' : [ ]}[root@c6401 vagrant]# curl -i -uadmin:admin -H 'X-Requested-By: ambari'-d '{'HostRoles': { 'state': 'INSTALLED'}}' -X PUT http://c6401.ambari.apache.org:8080/api/v1/clusters/c1/host_components?HostRoles/stale_configs=true{ 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/clusters/c1/requests/14'  'Requests' : { 'id' : 14  'status' : 'InProgress' }}[root@c6401 vagrant]# curl -i -uadmin:admin -H 'X-Requested-By: ambari' http://c6401.ambari.apache.org:8080/api/v1/clusters/c1/requests/14{ 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/clusters/c1/requests/14'  'Requests' : { 'aborted_task_count' : 0  'cluster_name' : 'c1'  'completed_task_count' : 0  'failed_task_count' : 0  'id' : 14  'progress_percent' : 9.0  'queued_task_count' : 4  'request_context' : ''  'request_status' : 'PENDING'  'task_count' : 4  'timed_out_task_count' : 0 }  'tasks' : [ { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/clusters/c1/requests/14/tasks/178'  'Tasks' : { 'cluster_name' : 'c1'  'id' : 178  'request_id' : 14 } }  { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/clusters/c1/requests/14/tasks/179'  'Tasks' : { 'cluster_name' : 'c1'  'id' : 179  'request_id' : 14 } }  { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/clusters/c1/requests/14/tasks/180'  'Tasks' : { 'cluster_name' : 'c1'  'id' : 180  'request_id' : 14 } }  { 'href' : 'http://c6401.ambari.apache.org:8080/api/v1/clusters/c1/requests/14/tasks/181'  'Tasks' : { 'cluster_name' : 'c1'  'id' : 181  'request_id' : 14 } } ]},0 ,0 
Starting/Stopping components based on restart indicator floods request history and execution queue,When starting/stopping components based on the Start/Stop Components buttons that show up after service reconfiguration  it creates one request per component (as shown in the Background Operations popup). This floods the request history and the user cannot see what has been done prior. From the user's standpoint  Start Components and Stop Components actions should each show up as one request.Also  this has major performance implications  since multiple requests cannot be processed in parallel by the server (unlike tasks within a single request).,0 ,1 
Storm: Update Dashboard / Services to support Storm,Define mock data and make this functional in App.testMode.E2E integration will be a separate task.,0 ,0 
Restart marker does not show up sometimes in the Hosts page,After reconfiguring  restart indicators do not show up on the Host pages sometimes.Clicking on an individual host shows the restart indicator in the Host Details page.,0 ,0 
Add env AMBARI_JVM_ARGS to ambari-server start,Useful if you want to set AMBARI_JVM_ARGS in the environment. For example: Setting http proxy that Ambari Serverexport AMBARI_JVM_ARGS='-Dhttp.proxyHost=the.proxy.host -Dhttp.proxyPort=1234'ambari-server start,0 ,0 
Status commands are not executed for new services,For new services (those  that are not hardcoded at LiveStatus.py)  status commands are not executed.,0 ,0 
Alerts  Restart  Maintenance elements in the Hosts filters,Move this 3 elements to the second line (under All  Healthy...).Also refactor their code-realization.,0 ,0 
Ambari server unit test failure,Results :Failed tests: testDoWork(org.apache.ambari.server.state.scheduler.BatchRequestJobTest): (..)Tests run: 1265  Failures: 1  Errors: 0  Skipped: 8,0 ,0 
Service tab: growing number of calls to update alerts,After routing by services on Service page number of calls to server(to get Alerts) grows.Also mock json with alerts need to be added.,0 ,0 
Request Schedule status not updated for Point in time execution request,API call:curl -u admin:admin -H 'X-Requested-By:ambari' -i -X POST -d '[{'RequestSchedule':{'batch':[{'requests':[{'order_id' : '1' 'type':'POST' 'uri':'/api/v1/clusters/c1/requests' 'RequestBodyInfo':{'RequestInfo':{'context':'Restart Nagios' 'command':'RESTART' 'service_name':'NAGIOS' 'component_name':'NAGIOS_SERVER' 'hosts':'c6401.ambari.apache.org'}}}]} {'batch_settings':{'batch_separation_in_seconds':120 'task_failure_tolerance':1}}]}}]' http://c6401.ambari.apache.org:8080/api/v1/clusters/c1/request_schedulesRequest Schedule:{href: 'http://c6401.ambari.apache.org:8080/api/v1/clusters/c1/request_schedules/23' RequestSchedule: {batch: {batch_requests: [{order_id: 1 request_type: 'POST' request_uri: '/api/v1/clusters/c1/requests' request_body: '{'RequestInfo':{'context':'Restart Nagios' 'command':'RESTART' 'service_name':'NAGIOS' 'component_name':'NAGIOS_SERVER' 'hosts':'c6401.ambari.apache.org'}}' request_status: 'InProgress' return_code: 202}] batch_settings: {batch_separation_in_seconds: 120 task_failure_tolerance_limit: 1}} cluster_name: 'c1' description: null id: 23 last_execution_status: 'InProgress' schedule: null status: 'SCHEDULED'}},0 ,0 
Storm: Install wizard. Add master components Storm UI Server  DRPC Server  LogViewer Server,Add new master components to Install Wizard -&gt; Assign Masters page.,0 ,0 
Storm: Add Storm UI Server  DRPC Server  LogViewer Server components config categories.,Add master components Storm UI Server  DRPC Server  Log Viewer Server. Create config categories for components. Replace exist configs according to categories.,0 ,0 
Service Restart All action cleanup,1. There is no need to send request to restart clients.2. When user clicks on Restart All actions  components start restarting immediately. But all other actions shows confirmation popup like 'Are you sure?' (Start  Stop  Run Service Check etc).,0 ,0 
Task timeout should be a configurable knob at the ambari-server,Task timeout is a configurable knob at the ambari-agent.timeout_seconds = 600This opens up the possibility of different timeout value at different agent instances as well as different value between the server and the agent. This can lead to state where server may have timed out the tasks but agent may not have. The other way is benign.This config can be moved to the server and server can hand it off to the agent when agent registers. This also makes it easier to manage the timeout value.,0 ,0 
Incorrect behavior of 'Save' button in 'Manage Configuration Groups' window,Steps: Go to 'Customize Services' page. Open 'Manage Configuration Groups' window for any service. Add new custom group and assign host to it. Save changes. Open 'Manage Configuration Groups' window again. Select custom group and remove assigned host.Result: 'Save' button is disabled  'Add hosts' also is disabled.Note: after selecting default group 'Save' button become active.Also if after all steps try to add hosts to custom group  'Save' button will not be active.,0 ,0 
Move 1.3.4 stack to 1.3.3 using the python libraries.,Move 1.3.4 stack to 1.3.3 using the pythin libraries.,0 ,0 
Rename 2.0.8 to 2.1.1 in the stack definition.,Rename 2.0.8 to 2.1.1 in the stack definition.,0 ,0 
Slaves API-calls,For Slaves (DataNodes  NodeManagers  RegionServers  or TaskTrackers): Start Stop Restart Decommission Recommission,0 ,0 
HostCleanup should also clean /tmp/hadoop-*,HostCleanup should also check the following directories (and clean):/tmp/hadoop-*For example  if the /tmp/hadoop-nagios directory is present  but it doesn't have the right ownership/perms for nagios user  the Hive Metastore Nagios alert will occur. I saw this after doing an install on an un-clean machine.Hive Metastore statusCRIT for about a minuteCRITICAL: Error accessing Hive Metastore status [Error creating temp dir in hadoop.tmp.dir /tmp/hadoop-nagios due to Permission denied]An easy way to reproduce this:1) Perform install2) Go to Nagios server machine3) Change perms on /tmp/hadoop-nagios so that the nagios user does not have access4) The Nagios alert will fire,0 ,0 
Add relocate resources scripts to the pom file,The relocate resources python script is not a part of the rpm package.,0 ,0 
Rolling restart failure tolerance should be percentage values,Currently when we make rolling restart API calls  the task_failure_tolerance value is given as count of hosts. Rather it should be percentage of total hosts.,0 ,0 
Action definitions should be provided as declarative resources - read from XML files,Currently  action definition are stored in database. This is not in-line with the declarative definition of stack and custom commands (as part of stack). The custom actions are essentially same as custom commands except they are defined at the level of clusters. So we should move the custom actions to XML formatted files that ambari-server can read when starting up. This means that when one needs to make any edit they will have to restart ambari-server. This requirement is OK as adding/modifying custom actions is not a frequently done operation.,0 ,0 
Alerts block shows spinner if Nagios not installed,When Nagios not installed Alerts block should show message that it's not installed instead of spinner.,0 ,0 
Hosts API-calls,For each host:P0: Start All Components Stop All ComponentsP1: Restart All Components,0 ,0 
Datanode data directory is not created correctly,dfs.datanode.data.dir must be handled as comma separated directories.,0 ,0 
ambari-server should use repo when downloading jdk 7,,0 ,0 
Misc code cleanup,,0 ,0 
Delete Config Group Host mapping broken due to error introduced by perf patch,Unit test: org.apache.ambari.server.state.ConfigGroupTest#testRemoveHostThis unit test is not a part of 1.4.3 branch  it was added later. (trunk)Exception thrown during ConfigGroupImpl.removeHost()2014-01-06 17:46:35 989 ERROR [main] configgroup.ConfigGroupImpl (ConfigGroupImpl.java:removeHost(274)) - Failed to delete config group host mapping  clusterName = foo  id = 1  hostname = h1java.lang.IllegalArgumentException: Object: org.apache.ambari.server.orm.cache.ConfigGroupHostMappingImpl@cc34948d is not a known entity type. at org.eclipse.persistence.internal.sessions.UnitOfWorkImpl.performRemove(UnitOfWorkImpl.java:3538) at org.eclipse.persistence.internal.jpa.EntityManagerImpl.remove(EntityManagerImpl.java:518) at org.apache.ambari.server.orm.dao.ConfigGroupHostMappingDAO.removeByPK(ConfigGroupHostMappingDAO.java:250) at com.google.inject.persist.jpa.JpaLocalTxnInterceptor.invoke(JpaLocalTxnInterceptor.java:58) at org.apache.ambari.server.state.configgroup.ConfigGroupImpl.removeHost(ConfigGroupImpl.java:272) at com.google.inject.persist.jpa.JpaLocalTxnInterceptor.invoke(JpaLocalTxnInterceptor.java:66) at org.apache.ambari.server.state.cluster.ClustersImpl.deleteConfigGroupHostMapping(ClustersImpl.java:640) at org.apache.ambari.server.state.cluster.ClustersImpl.unmapHostFromCluster(ClustersImpl.java:615) at org.apache.ambari.server.state.ConfigGroupTest.testRemoveHost(ConfigGroupTest.java:203),0 ,0 
mapreduce.task.io.sort.mb max value should not exceed 1024mb,https://issues.apache.org/jira/browse/MAPREDUCE-5028https://issues.apache.org/jira/browse/MAPREDUCE-2308,0 ,1 
Remove property fs.checkpoint.size during upgrade,Property fs.checkpoint.size is deprecated. The upgrade script should remove it. Users can add the replacement themselves - dfs.namenode.checkpoint.txns.,0 ,0 
Background operations dialog in weird state after exception,Background operations dialog goes into a weird state after hitting an exception with request_schedule information. It always expects request_schedule information to be present.,0 ,0 
HDFS start failed on 2.1.1 stack,STR: Deployed minimal cluster with HDFS and ZK. HDFS start failed. Added YARN+MR2  Nagios and Ganglia. Picture with HDFS was the same.Output:Fail: Execution of 'ulimit -c unlimited &amp;&amp; if [ 'ulimit -c' != 'unlimited' ]; then exit 77; fi &amp;&amp; export HADOOP_LIBEXEC_DIR=/usr/lib/hadoop/libexec &amp;&amp; /usr/lib/hadoop/sbin/hadoop-daemon.sh --config /etc/hadoop/conf start secondarynamenode' returned 1. -bash: line 0: ulimit: core file size: cannot modify limit: Operation not permittedFull folders with logs are attached.,0 ,0 
ORA-01795: maximum number of expressions in a list is 1000 for Oracle DB,PROBLEM:ORA-01795: maximum number of expressions in a list is 1000 in Ambari Server log. Customer recently upgraded to Ambari 1.4.2Error is:08:54:51 320 ERROR [qtp1280560314-2070] ReadHandler:84 - Caught a runtime exception executing a queryLocal Exception Stack: Exception [EclipseLink-4002] (Eclipse Persistence Services - 2.4.0.v20120608-r11652): org.eclipse.persistence.exceptions.DatabaseExceptionInternal Exception: java.sql.SQLSyntaxErrorException: ORA-01795: maximum number of expressions in a list is 1000Error Code: 1795Call: SELECT task_id  attempt_count  event  exitcode  host_name  last_attempt_time  request_id  role  role_command  stage_id  start_time  status  std_error  std_out FROM host_role_command WHERE (task_id IN (? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?)) ORDER BY task_id bind =&gt; [2551 parameters bound]Query: ReadAllQuery(referenceClass=HostRoleCommandEntity sql='SELECT task_id  attempt_count  event  exitcode  host_name  last_attempt_time  request_id  role  role_command  stage_id  start_time  status  std_error  std_out FROM host_role_command WHERE (task_id IN ?) ORDER BY task_id') at org.eclipse.persistence.exceptions.DatabaseException.sqlException(DatabaseException.java:333) at org.eclipse.persistence.internal.databaseaccess.DatabaseAccessor.basicExecuteCall(DatabaseAccessor.java:646) at org.eclipse.persistence.internal.databaseaccess.DatabaseAccessor.executeCall(DatabaseAccessor.java:537) at org.eclipse.persistence.internal.sessions.AbstractSession.basicExecuteCall(AbstractSession.java:1800)STEPS TO REPRODUCE: Over 1000 entries in the host_role_command and execution_command tables when oracle is used for Ambari backend databseACTUAL BEHAVIOR: Oracle throws the errorEXPECTED BEHAVIOR: There should be a limit to prevent this (possibly modify the syntax of the oracle query),0 ,0 
Add upgradestack support for MySQL,Similar to Oracle/Postgres we need to make sure that ambari-server upgradestack works for MySQL,0 ,0 
Ambari version info should be visible in UI,There is currently no easy way to find the version of Ambari that is in use from the Ambari Web interface. This info should be accessible via an 'about' link in Ambari Web,0 ,0 
health status yellow (lost heartbeat) not showing icon,See attached. Using 1.5.0.335On Hosts page. Other pages seem fine.,0 ,0 
Bulk Ops: Restart on Slaves should popup rolling restart dialog,When performing Restart on Slaves via Bulk Ops menu on the Hosts page  Restart should popup the rolling restart dialog  just like it does when Restarting Slaves under Service Actions.,0 ,0 
Host registering failure from primary/agent os checking on centos6,I am using Ambari (1.4.3.38) for hadoop cluster installation and management. All the cluster nodes are built on centos 6.0.During the ambari server installation  ambari-server recognized the primary/cluster os as redhat6 (see ambari.properties). During the ambari agent bootstrap/host register  ambari-agent regonized the agent os as centos linux6 (see log). From log files (ambari-server.log  ambari-agent.log)  I found the inconsistence caused the warning of ambari-agent bootstrapping and failure of host registering.I'm still not sure why this happen  but I guess it's caused by the differene of os checking methods among ambari server side code  ambari-agent bootstrap script (os_type_check.sh based on os release file) and registering script (Controller.py/Register.py based on os hardware profile) .I just share to see if anyone can fix the issue.BTW  for me  to solve the problem  I manually edited the script files to make it work temporarily:To avoid warning of agent bootstrapping  in os_type_check.sh  add current_os=$RH6 above the echo line or add res=0 after case statement;To make the node register work  in Controller.py  add data=data.replace('centos linux' 'redhat') before sending registering request;Thanks.,0 ,0 
Oozie Server installation fails when Falcon is selected,,0 ,0 
Add ability to delete individual DataNode  TaskTracker  NodeManager  and RegionServer from Host Details page,Note: We let the user delete Storm Supervisor already.,0 ,0 
Alert count badge and restart indicator issues,The alert badge shown in the left nav shows up a bit strange (too little padding on the right). Also  when the restart indicator appears  the padding for the alert badge fixes itself  but the restart indicator appears too close. See attached.,0 ,0 
OOS status for component on host detail page makes button too big,,0 ,0 
Refactor and Unit tests for host summary,,0 ,0 
BG operation pop-up: JS error encountered on clicking on host in progress state.,,0 ,0 
Falcon Client install task shows up as just 'install' rather than 'Falcon Client install',See attached.,0 ,0 
Jobs: implement the TEZ DAG page/panel,Need a graph implemented to show the Tez DAG for Hive queries,0 ,0 
Ambari should check that there is enough disk space during installation,Add a new category in 'Hosts Check' popup after registering hosts.So for '/' mountpoint  we check if the disk free space is larger than 2.0GB.And for '/usr/lib' or '/usr'  check the free space is larger than 1.0GB. Then show related warning message if any of them got space shortage.,0 ,0 
Various issues related to decommission support,Tracking few issues related to decommission support Even with HBase HA only one master should be used for decommission Alternatively  for HDFS/MR/YARN use all master host components Do not use 'default' method while using python based system resources Add support for command details and custom command names,0 ,0 
Upon restart of ambari-server  the service status on Dashboard page remain unchanged,After ambari-server restart  if FE remains at the Dashboard page  the service status (Yellow buttons) never gets updated even if the API indicates that the status are all Green/Red. In my case  never is 6 minutes.Upon refresh or moving to other tabs the view is promptly updated.,0 ,0 
Host Details > Actions pulldown likes to hide,Actions pull down on the Host Detail page likes to hide itself when it's open. This is a bit annoying.,0 ,0 
Remove --jce-policy from warning statement,We have removed option -c or --jce-policy. So the warning message should not use that option in the help statement.jce_download_fail_msg = ' Failed to download JCE Policy archive : {0}. ' / 'Please check that JCE Policy archive is available ' / 'at {1} . Also you may install JCE Policy archive manually using ' / '--jce-policy command line argument.'.format('{0}'  jce_url),0 ,0 
adding more master components styling is missing,,0 ,0 
Host names goes under text  icons,see attached,0 ,0 
Host details: clients list disappears,Go to host page with some clients installedRefresh itGot: clients are not displayed on the pageExpected: list of installed clients,0 ,0 
medkit-icons are shifted out of their places  in hosts table in Safari.,,0 ,0 
Exception on deploing step: java.sql.BatchUpdateException: ORA-00942,Exception trace:18:27:19 191 WARN [qtp1643608425-22] ServletHandler:514 - /api/v1/clusters/c1/servicesjavax.persistence.RollbackException: Exception [EclipseLink-4002] (Eclipse Persistence Services - 2.4.0.v20120608-r11652): org.eclipse.persistence.exceptions.DatabaseExceptionInternal Exception: java.sql.BatchUpdateException: ORA-00942: table or view does not existError Code: 942 at org.eclipse.persistence.internal.jpa.transaction.EntityTransactionImpl.commitInternal(EntityTransactionImpl.java:102) at org.eclipse.persistence.internal.jpa.transaction.EntityTransactionImpl.commit(EntityTransactionImpl.java:63) at com.google.inject.persist.jpa.JpaLocalTxnInterceptor.invoke(JpaLocalTxnInterceptor.java:87),0 ,0 
'SNN Process' alert displays after HA enabled successfully,STR:1. Install  setup and start Ambari server by default.2. Deploy Hadoop by default (stack 2.0.6  choose all services to install).3. Enable HA.4. Wait for at least 150 seconds.4. Go to HDFS Service/Hosts page page.Actual result:'Secondary NameNode Process' alert displayed.Expected result:There should not be 'Secondary NameNode' alert on page.,0 ,0 
The user is not always redirected to the login page when unauthenticated,1. Try to enable HA with fail on 9th step for Start All services2. Use link http://&lt;host&gt;:8080/#/main/admin/highAvailability/enable/step13. HA Wizard is shown without previously loaded Login Page (see url and js errors in attached screenshot)Expexted result:Login Page should be loaded firts.,0 ,0 
Restart All fails for Client only components,Restart for a service calls stop and start on all components. Currently there is no implementation for stopping a client component. This leads to error message: 'Stop not implemented for component',0 ,0 
Routes are incorrect after launching wizard,Steps to reproduce:1. Launch Add Service wizard2. Close wizard3. Go by link #/main/services/add/step1 (type it in address bar)The router goes to nonexistent page '#/main/services/add/summary'.,0 ,0 
Install Wizard: Assign Masters: some selects disabled,Step to reproduce.Go untill to Customize Services Page.Click to Choose Services menu link.Go to Assign Masters page.,0 ,0 
Bulk Ops: add Supervisor to Bulk Ops on Hosts page,Add Supervisor to Hosts page's Bulk Ops menu if Storm is installed.Decommission and Recommission should be disabled  as Supervisors do not support these operations.,0 ,0 
Customize Services page of Add Service Wizard offers to customize already installed Oozie,Steps to reproduce: Deploy cluster without Ooozie and some other customizable service. Go to the Add Service wizard. Add Oozie service. Fail starting Oozie server. Close add service wizard. Ensure that Oozie was added as service. Go again to Add Service Wizard and choose some customizable service. Go to Customize Services page.Result: Customize Services page proposes to customize Oozie  but it was already added to the cluster during installation.,0 ,0 
Write unnitests for HDFS install script on HDP1 and HDP2,,0 ,0 
Hosts table: sort order arrows should be close to the respective column label,The sort order arrows are right-justified within the column.This makes it look like the arrows apply to the column next to it.Instead  we should show the arrows right next to the respective column label.Like:Name (arrows) IP Address (arrows)Not:Name (arrows) IP Address,0 ,0 
Oozie tests fails,Oozie tests fail,0 ,0 
Actual configs not updated after restart of host component,Updated HDFS configs aren't applied after RESTART.Steps: On a 3 node cluster  create a ConfigGroup for datanode. Override heap size to 1025m instead of 1024m Restart DN.Result: The /var/lib/ambari-agent/data/config.json  has the correct values for the config type:'global': {'2': 'version1392171779044'  'tag': 'version1'} The API call still shows global as default version:http://hostname1:8080/api/v1/clusters/c1/hosts/hostname1/host_components/DATANODE Note:It works after agent is restarted.{global: {overrides: {2: 'version1392171779044'} default: 'version1'}The cause is that hooks aren't executed for the custom_command like RESTART. Since configs for HDFS are generated in hook.py  we must execute hook.py before custom commands or move config generation from hook.py.,0 ,0 
Add unittets for hooks in secured mode.,,1 ,0 
Falcon Server can not be restarted,,0 ,0 
Alerts for ATS Component,Impl alert for ATS server ATS process (running / not running)Note: this alert should be disabled/removed when ATS gets deleted (when Kerb is enabled).,0 ,0 
Value 'storm.zookeeper.servers' not changing after adding new ZK server,After adding new ZK server needs to change value of storm.zookeeper.servers property.,0 ,0 
Tez DAG UI not showing due to changed ATS responses,ATS has changed structure of http://server:8188:8188/ws/v1/apptimeline/HIVE_QUERY_ID/&lt;id&gt; where the entire query JSON structure is now represented as a string under 'otherinfo/query'. UI will need to deserialize this string back into JSON and continue.,0 ,0 
AmbariManagementControllerTest Test fails with unable to delete the last user.,AmbariManagementControllerTest Test fails with unable to delete the last user.Results :Tests in error: testDeleteUsers(org.apache.ambari.server.controller.AmbariManagementControllerTest): Could not remove user user1. System should have at least one user with administrator role. Tests run: 1404  Failures: 0  Errors: 1  Skipped: 7,0 ,0 
Security Wizard: History Server should be a different section for MR service.,Earlier History Server was not a different service component and was always co-hosted with JobTracker for HDP-1.x. So we had a same section for Job Tracker and History server in security wizard config page.After AMBARI-2617 and AMBARI-4207 fix  it's possible to have JobTracker and History Server on different host via Ambari web-ui. With this capability it's important to show Job History Server as a different section in Security Wizard MR service config page.,0 ,0 
Restart indicators work incorrectly after adding component,STR: Deploy cluster with DataNodes on 2 from 3 hosts. Change DataNode maximum Java heap size from 1024 to 1025. Check that Restart indicators appeared and 2 DataNodes require restart. Add DataNode on missing host. Change property DataNode maximum Java heap size back to 1024.Result: Those two DataNodes still require restart and added DataNode not.Gluster properties shouldn't be added unless GLUSTERFS is installed.,0 ,0 
Add services wizard throw JS exception,See attached. During Customize Services.I installed a cluster w/o Storm  and went to add Storm.,0 ,0 
/var/lib/hadoop-hdfs/ location does not has +x permission for others,The file defined by dfs.domain.socket.path must give +x permission for other user. &lt;property&gt; &lt;name&gt;dfs.domain.socket.path&lt;/name&gt; &lt;value&gt;/var/lib/hadoop-hdfs/dn_socket&lt;/value&gt; &lt;/property&gt;Currently  In ambari installed cluster  /var/lib/hadoop-hdfs does not give +x permission to other user[root@ambari-sec-1392876050-hdfs-re-8 ~]# stat /var/lib/hadoop-hdfs/ File: '/var/lib/hadoop-hdfs/' Size: 4096 Blocks: 8 IO Block: 4096 directoryDevice: 803h/2051d Inode: 1182008 Links: 3Access: (0750/drwxr-x---) Uid: ( 1005/ hdfs) Gid: ( 500/ hadoop)Access: 2014-02-18 18:10:35.000000000 -0800Modify: 2014-02-20 07:50:55.274766162 -0800Change: 2014-02-20 07:50:55.274766162 -0800Due to this Issue  hadoop commands are seeing below WARN messages. 2014-02-18 05:54:32 734|beaver.machine|INFO|RUNNING: /usr/bin/hdfs dfs -tail /user/hrt_qa/hdfsRegressionData/smallFiles/smallRDFile7552014-02-18 05:54:35 528|beaver.machine|INFO|14/02/18 05:54:35 WARN hdfs.BlockReaderLocal: error creating DomainSocket2014-02-18 05:54:35 528|beaver.machine|INFO|java.net.ConnectException: connect(2) error: Permission denied when trying to connect to '/var/lib/hadoop-hdfs/dn_socket'2014-02-18 05:54:35 528|beaver.machine|INFO|at org.apache.hadoop.net.unix.DomainSocket.connect0(Native Method)2014-02-18 05:54:35 529|beaver.machine|INFO|at org.apache.hadoop.net.unix.DomainSocket.connect(DomainSocket.java:250)2014-02-18 05:54:35 529|beaver.machine|INFO|at org.apache.hadoop.hdfs.DomainSocketFactory.createSocket(DomainSocketFactory.java:158)2014-02-18 05:54:35 529|beaver.machine|INFO|at org.apache.hadoop.hdfs.BlockReaderFactory.nextDomainPeer(BlockReaderFactory.java:691)2014-02-18 05:54:35 529|beaver.machine|INFO|at org.apache.hadoop.hdfs.BlockReaderFactory.createShortCircuitReplicaInfo(BlockReaderFactory.java:439)2014-02-18 05:54:35 529|beaver.machine|INFO|at org.apache.hadoop.hdfs.client.ShortCircuitCache.create(ShortCircuitCache.java:669)The expected Permissions on this location is as below.[root@ambari-sec-1392876050-yarn-10 ~]# stat /var/lib/hadoop-hdfs/ File: '/var/lib/hadoop-hdfs/' Size: 4096 Blocks: 8 IO Block: 4096 directoryDevice: 803h/2051d Inode: 1181767 Links: 3Access: (0751/drwxr-x--x) Uid: ( 1005/ hdfs) Gid: ( 500/ hadoop)Access: 2014-02-20 18:00:06.586040913 -0800Modify: 2014-02-20 07:06:28.267889888 -0800Change: 2014-02-20 17:59:56.629052410 -0800,0 ,0 
NameNode fails to start due to 'fs.defaultFS' being null,,0 ,0 
Skip Failing tests for now.,Skip Failing tests for now.,0 ,0 
Reconfiguring memory related properties of a service suffixes 'm' to memory related properties of other service.,,0 ,0 
Do not automatically put host component in Maintenance Mode upon decommissioning (and out of Maintenance Mode when recommissioning),We originally wanted to couple decom/recom with putting the host component in / out of maintenance mode.After experimenting  we decided to undo that. This is the JIRA for the Ambari BE changes.,0 ,0 
Hosts table UI cleanup,1) has too much padding (See attached.)2) the sorting carets should have more padding-left so there is a bit more space between the column label3) the checkboxes should have more left padding. They are not balanced.4) The checkboxes and status icons are not vert centered with the hostname text.5) The input field for searching the hostname column should take up more horizontal space. with all that blank  makes it look like there is a missing column.,0 ,0 
Allow Falcon to be configured with keytab/security and custom params,,0 ,0 
Do not show 'restart' op on non-admin user,1) As admin  change a config but do not perform the restarts2) Create a test user (non-admin)3) login as test user4) in host details page  operation to restart is shown. Should not be shown,0 ,0 
Navigation from Hosts page to HostDetailsPage breaks occasionally,STR: 1. Navigate to hosts page  wait for page loaded. 2. Click specific hosts link. 3. Wait for HostDetails page loaded. 4. Click Back. 5. Iterate. Actual result: sometimes the Hosts page hangs not resulting in presenting a HostDetails page. Speed of attached videos is 5 times faster than real.,0 ,1 
Incorrect behavior of HA wizard on second step,STR:1) Deploy cluster by default;2) Go to HA wizard3) Second wizard stepExpected result:1) In 'Additional NameNode' combobox should NOT be ability to choose host where NameNode component already installed.2) In 'JournalNode' comboboxes should NOT be ability to choose more than one JournalNode on one hostActual results:1) In 'Additional NameNode' combobox can be chosen host with already installed NameNode (see first screenshot)2) JournalNode components might be chosen to install for any host  including case when three JournalNode's might be installed on one host (see second screenshot).,0 ,0 
Update falcon install scripts to recent changes,Following features must be implemented: /apps/falcon directory on hdfs and owned by falcon user make falcon able to be runned from custom user change alerts text,0 ,0 
Ambari DDL for MySQL should not create ambarirca database,Ambari-DDL-MySQL-CREATE.sql includes 'create ambarirca' database.CREATE DATABASE ambarirca;USE ambarirca;1) At minimum  this DDL should not be creating an ambarirca database and instead mix in the RCA tables with core Ambari tables (that's how Oracle DDL does it &#8211; I think). Not ideal but better than creating an ambarirca database in this script (a user would be surprised to see this).2) Alternatively  we need to split out RCA DDL from the core Ambari. We can doc that if you plan to use HDP 1.3.x stack that you need to to setup an RCA database (since RCA is only applicable to those with HDP 1.3.x stack). If we go this route  for consistency  we would need to do the same for the oracle DDL.Note: Right now  looks like the oracle DDL just puts the RCA tables in the same database as ambari core tables (basically #1 above).,0 ,0 
Nagios alerts are not shown on SUSE,STR:1. Deploy cluster by default scenario w/o Storm and Falcon.2. Go to HDFS service page.3. Go to Nagios service page.4. Navigate to Nagios Web UI.5. Enter credentials nagiosadmin/passwordActual results: There are no alerts on service page. Web UI is unavailable due to ERROR 403.Screenshots attached.,0 ,0 
Avoid printing stacktrace for state machine exceptions,Log gets filled on install failure.13:28:08 856 WARN [qtp615964260-72] HeartBeatHandler:361 - State machine exceptionorg.apache.ambari.server.state.fsm.InvalidStateTransitionException: Invalid event: HOST_SVCCOMP_OP_SUCCEEDED at INSTALL_FAILED at org.apache.ambari.server.state.fsm.StateMachineFactory.doTransition(StateMachineFactory.java:297) at org.apache.ambari.server.state.fsm.StateMachineFactory.access$300(StateMachineFactory.java:39) at org.apache.ambari.server.state.fsm.StateMachineFactory$InternalStateMachine.doTransition(StateMachineFactory.java:440) at org.apache.ambari.server.state.svccomphost.ServiceComponentHostImpl.handleEvent(ServiceComponentHostImpl.java:730) at com.google.inject.persist.jpa.JpaLocalTxnInterceptor.invoke(JpaLocalTxnInterceptor.java:66),0 ,0 
License header is repeated in oozie-log4j.properties,# Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License  Version 2.0 (the 'License'); you may not use this file except in compliance with the License. You may obtain a copy of the License at##http://www.apache.org/licenses/LICENSE-2.0# Unless required by applicable law or agreed to in writing  software distributed under the License is distributed on an 'AS IS' BASIS  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND  either express or implied. See the License for the specific language governing permissions and limitations under the License.# http://www.apache.org/licenses/LICENSE-2.0# Unless required by applicable law or agreed to in writing  software distributed under the License is distributed on an 'AS IS' BASIS  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND  either express or implied. See the License for the specific language governing permissions and limitations under the License. See accompanying LICENSE file.#,0 ,0 
Service Check does not work,,0 ,0 
Slave component should include 'restart' command on host details page 'Actions',Slave components (such as DataNode  NodeManager  RegionServer  Supervisor  Ganglia Monitor) should include a 'Restart' command in their 'Actions' menu on the host details page.The Restart option should be shown and enabled when the component is started.,0 ,0 
Ganglia alerts after adding YARN+MR2,STR: Deploy cluster with HDFS+ZK  Nagios  Ganglia. Add YARN+MR2  Tez services.Result: Alerts Ganglia Monitor process for HistoryServer and Ganglia Monitor process for ResourceManager don't dissappear after restarting all services,0 ,0 
Change Hive alerts to move away from Hive metadata queries to port checks,1) remove 'Hive Metastore status' alert2) add 'Hive Metastore process' alert3) add 'HiveServer2 process' alert,0 ,0 
After configuring NNHA  nn process alerts don't work,1) Configure NN HA2) stack 2.0.6 (but check stack 2.1 as well)3) Two alerts show' check_tcp: Port must be a positive integer'NameNode process on c6401.ambari.apache.orgNameNode process on c6402.ambari.apache.org4) Looked at /etc/nagios/objects/hadoop-services.cfg5) Saw:define service { host_name c6401.ambari.apache.org use hadoop-service service_description NAMENODE::NameNode process on c6401.ambari.apache.org servicegroups HDFS check_command check_tcp_wrapper!//test!-w 1 -c 1 normal_check_interval 0.5 retry_check_interval 0.25 max_check_attempts 3}define service { host_name c6402.ambari.apache.org use hadoop-service service_description NAMENODE::NameNode process on c6402.ambari.apache.org servicegroups HDFS check_command check_tcp_wrapper!//test!-w 1 -c 1 normal_check_interval 0.5 retry_check_interval 0.25 max_check_attempts 3}Notice in the above //test is the name of my nameservice.Attaching screen shot of my config. So looks like it's grabbing port from the wrong prop.,0 ,0 
Jobs popup message clicking continues to stay on the same page,1. Click on an app on ATS/jobs page which is running 2. It pops up a window with message 'Tez DAG has no ID associated with name hrt_qa_20140228161212_a5713292-8213-43a3-b61e-06685799a5b3'3. Press OK and the page refreshes and pops up the same window again.4. This goes on forever until the user closes the browser or enters a different URLInstead  the page should be redirected back to &lt;ambari server URL&gt;/#/main/jobs,0 ,0 
During upgrade. migrate decommissioned DN hosts list to the new format,The details of how the notion of a decommissioned DN is stored has changed for 1.5.0. Add support to modify persisted data when Ambari is upgraded to 1.5.0.,0 ,0 
Reduce loading time of Host Warnings popup,Wizard-&gt;Confirm Hosts step:1. Refactor parsing of json response with hosts warnings.2. Reduce latency on opening Host Warnings popup.,0 ,1 
Lost heartbeat on host but ganglia shows a heartbeat lost,3 hosts  third-host has only Ganglia monitor and Datanode.I kill the third machine agent. Hosts page correctly shows heartbeat lost.On the services page  ganglia shows 'yellow'  even though the ganglia server host is fine.Ganglia service should considered started if Ganglia Server is started.,0 ,0 
Hive Service Check Failed during Install Wizard,Hive Service Check Failed during Install Wizard,0 ,0 
Secured: Start All Services task got stuck forever,Deployed 2-node cluster. Added 3rd node. Enabled security.After steps above on all 3 hosts tasks jammed and don't want to perform or fail for a very long time.VMs are alive  ambari-server and all ambari-agents are running.Finally got a reproduce using 2 commandscurl 'http://vm-0.vm:8080/api/v1/clusters/cc/services?params/run_smoke_test=false' -X PUT -H 'X-Requested-By: X-Requested-By' -u admin:admin --data '{'RequestInfo': {'context': 'Start All Services'}  'Body': {'ServiceInfo': {'state': 'STARTED'}}}' ; sleep 3; curl 'http://vm-0.vm:8080/api/v1/clusters/cc/hosts/vm-0.vm/host_components/APP_TIMELINE_SERVER' -X DELETE -H 'X-Requested-By: X-Requested-By' -u admin:adminThe way to reproduce is a bit different compared to an original description (I issue a DELETE request in 3 seconds after START_ALL_SERVICES request has been issued)  but the symptoms are the same: ServiceComponentHostNotFoundException exception is posted to log and operation is stuck on stage that contains 'App Timeline Server Start' command.,0 ,1 
2-way auth fails when using jdk7,Steps to reproduce:On the Ambari Server host  open /etc/ambari-server/conf/ambari.properties with a text editor.Add the following property:security.server.two_way_ssl = trueError messageINFO 2014-03-07 13:57:17 184 security.py:184 - Agent certificate not exists  sending sign requestINFO 2014-03-07 13:57:17 335 security.py:89 - SSL Connect being called.. connecting to the serverERROR 2014-03-07 13:57:17 414 security.py:76 - Two-way SSL authentication failed. Ensure that server and agent certificates were signed by the same CA and restart the agent. In order to receive a new agent certificate  remove existing certificate file from keys directory. As a workaround you can turn off two-way SSL authentication in server configuration(ambari.properties) Exiting..,0 ,0 
oozie-site.xml defaults need to be updated for 2.1 stack,oozie-site.xml needs the following two services added to the list of services:org.apache.oozie.service.XLogStreamingService (needed to display logs)org.apache.oozie.service.JobsConcurrencyService (needed to run Recovery Service - for example  this would handle jobs that are dangling and stuck in RUNNING state),0 ,0 
Start all services silently fails when a service is not startable,I clicked on Start All services button and nothing happened. Turns out that on the API call  the server throws a 500 exception that is silently lost. We should show in a dialog the error response from server. Similarly for Stop All action.PUT http://c6401:8080/api/v1/clusters/c1/services?params/run_smoke_test{'RequestInfo': {'context' :'_PARSE_.START.ALL_SERVICES'}  'Body': {'ServiceInfo': {'state': 'START{ 'status' : 500  'message' : 'org.apache.ambari.server.controller.spi.SystemException: An internal system exception occurred: Invalid transition for servicecomponenthost  clusterName=c1  clusterId=3  serviceName=OOZIE  componentName=OOZIE_SERVER  hostname=c6402.ambari.apache.org  currentState=INSTALL_FAILED  newDesiredState=STARTED'},0 ,0 
Security Wizard: enable Kerberos setup for Storm,1) Following jaas.conf file needs to be on all storm component hosts:Client { com.sun.security.auth.module.Krb5LoginModule required useKeyTab=true keyTab='$keytab' storeKey=true useTicketCache=false serviceName='zookeeper' principal='$principal';};2) In YAML  following java configurations should have jaas.conf options:nimbus.childopts: '-Djava.security.auth.login.config=/path/to/jaas.conf'ui.childopts: '-Djava.security.auth.login.config=/path/to/jaas.conf'supervisor.childopts: '-Djava.security.auth.login.config=/path/to/jaas.conf',0 ,0 
Retry failure after installation failure triggers start all services request,Steps to reproduce: Make Install all services request fail. Hit on Retry button. Make retry attempt to install all services fail.This will trigger start all services call and error pop-up will be displayed.Expected behavior: Start all services call should not be called.,0 ,0 
Maintenance Mode: maintenance icon changes on Host Details page,For host components whose service is in maintenance mode  the maintenance mode icon should be displayed to the right of the service name and we should display the host component health (green / red  etc) on the far left.When the host itself is in maintenance mode  we should not show any maintenance mode icon on the host component (unless the service is in maintenance mode). This allows the UI to distinguish which host components are in service-derived maintenance mode vs host-derived. Also  on this page  host-level operations apply to all but the host components in service-derived maintenance mode (regardless of the host maintenance mode)  so this display is more natural and easier to understand for the end user.,0 ,0 
hadoop-mapreduce.jobsummary.log is empty when specified custom YARN Log Dir,Reproduced with such preconditions:On Customize Services page specify 'YARN Log Dir Prefix' to some custom dir. After deploying  run MapReduce2 Service check and check that:hadoop-mapreduce.jobsummary.log is empty  but /var/log/hadoop-yarn/yarn/hadoop-mapreduce.jobsummary.log contains jobs records.,0 ,0 
Background Operations window does not appear after triggering Rolling Restart,STR: Deploy cluster. Check that flag Do not show the Background Operations dialog when starting an operation is set to false. Click Restart DataNodes in Actions menu of HDFS. Click 'Trigger Restart' in appeared modal window.Result: Background Operations was not appeared.,0 ,0 
Rolling Restart dialog shows incorrect message that slaves won't be restarted when service is in maintenance mode,The fix for this issue would be to display that the slaves whose host is in 'host' maintenance mode will be skipped.For example  we have 3 hosts (host1  host2  and host3) with NodeManager installed on each. Say host3 is in maintenance mode.Rolling Restart dialog should say '1 NodeManager in maintenance mode will not be restarted'.,0 ,0 
After Ambari is upgraded to 1.5.0  previous JAVA_HOME is overwritten to /usr/jdk64/jdk1.6.0_3,After upgrading Ambari from 1.2.5 to 1.5.0 and Stack from 1.3.2 to 2.0.10When starting HDFS service  Datanode and SNameNode on the agent host failed to start due to JAVA_HOME=cbin/java is missing. In ambari.properties  java.home=/usr/jdk64/jdk1.6.0_3 after upgrade.,0 ,0 
Hive CLI using Tez runtime does not start by throwing HDFS exception,In a cluster node we had set the below in /etc/hive/conf/hive-site.xml&lt;property&gt; &lt;name&gt;hive.jar.directory&lt;/name&gt; &lt;value&gt;hdfs:///apps/hive/install&lt;/value&gt;&lt;/property&gt;The HDFS folder has the following contents# hadoop fs -ls -R /apps/hive/drwxr-xr-x - hive hdfs 0 2014-03-19 17:10 /apps/hive/install-rwxr-xr-x 3 hive hdfs 14719276 2014-03-19 17:10 /apps/hive/install/hive-exec.jardrwxrwxrwx - hive hdfs 0 2014-03-19 17:08 /apps/hive/warehouseAs user ambari-qa I run the hive command to hit this exception$ hiveLogging initialized using configuration in file:/etc/hive/conf.dist/hive-log4j.propertiesException in thread 'main' java.lang.RuntimeException: org.apache.hadoop.security.AccessControlException: Permission denied: user=ambari-qa  access=WRITE  inode='/apps/hive/install':hive:hdfs:drwxr-xr-x at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkFsPermission(FSPermissionChecker.java:265) at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.check(FSPermissionChecker.java:251) at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.check(FSPermissionChecker.java:232) at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermission(FSPermissionChecker.java:176) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.checkPermission(FSNamesystem.java:5481) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.checkPermission(FSNamesystem.java:5463) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.checkAncestorAccess(FSNamesystem.java:5437) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startFileInternal(FSNamesystem.java:2265) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startFileInt(FSNamesystem.java:2218) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startFile(FSNamesystem.java:2171) at org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.create(NameNodeRpcServer.java:517) at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.create(ClientNamenodeProtocolServerSideTranslatorPB.java:354) at org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java) at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:585) at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:928) at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:2003) at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:1999) at java.security.AccessController.doPrivileged(Native Method) at javax.security.auth.Subject.doAs(Subject.java:415) at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1548) at org.apache.hadoop.ipc.Server$Handler.run(Server.java:1997) at org.apache.hadoop.hive.ql.session.SessionState.start(SessionState.java:345) at org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:682) at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:626) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:606) at org.apache.hadoop.util.RunJar.main(RunJar.java:212)Caused by: org.apache.hadoop.security.AccessControlException: Permission denied: user=ambari-qa  access=WRITE  inode='/apps/hive/install':hive:hdfs:drwxr-xr-x at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkFsPermission(FSPermissionChecker.java:265) at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.check(FSPermissionChecker.java:251) at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.check(FSPermissionChecker.java:232) at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermission(FSPermissionChecker.java:176) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.checkPermission(FSNamesystem.java:5481) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.checkPermission(FSNamesystem.java:5463) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.checkAncestorAccess(FSNamesystem.java:5437) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startFileInternal(FSNamesystem.java:2265) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startFileInt(FSNamesystem.java:2218) at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startFile(FSNamesystem.java:2171) at org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.create(NameNodeRpcServer.java:517) at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.create(ClientNamenodeProtocolServerSideTranslatorPB.java:354) at org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2.callBlockingMethod(ClientNamenodeProtocolProtos.java) at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:585) at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:928) at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:2003) at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:1999) at java.security.AccessController.doPrivileged(Native Method) at javax.security.auth.Subject.doAs(Subject.java:415) at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1548) at org.apache.hadoop.ipc.Server$Handler.run(Server.java:1997) at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57) at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) at java.lang.reflect.Constructor.newInstance(Constructor.java:526) at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106) at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:73) at org.apache.hadoop.hdfs.DFSOutputStream.newStreamForCreate(DFSOutputStream.java:1602) at org.apache.hadoop.hdfs.DFSClient.create(DFSClient.java:1461) at org.apache.hadoop.hdfs.DFSClient.create(DFSClient.java:1386) at org.apache.hadoop.hdfs.DistributedFileSystem$6.doCall(DistributedFileSystem.java:394) at org.apache.hadoop.hdfs.DistributedFileSystem$6.doCall(DistributedFileSystem.java:390) at org.apache.had,0 ,1 
The status of App Timeline Server affect the health status of YARN service.,When stopping ATS  YARN service indicator blinks red giving the idea that YARN is going down and become solid red after that. YARN service should not be indicated as STOPPED if ATS is down.,0 ,0 
hive-env.sh overwrites user value of HIVE_AUX_JARS_PATH,This line at the bottom of hive-env.sh disregards any user-provided values  masking them from the launch script.# Folder containing extra ibraries required for hive compilation/execution can be controlled by:export HIVE_AUX_JARS_PATH=/usr/lib/hcatalog/share/hcatalog/hcatalog-core.jarThis breaks this feature for users of both the environment export HIVE_AUX_JARS_PATH='my custom value' and the command line hive --auxpath 'my custom value' .,0 ,0 
Add component of clients in Ambari doesn't work in a secured cluster,The reason of bug is wrong query formation while triggering API to create clients on host.The data sent with the POST call to create client components on the host is:{'RequestInfo':{'context':'Install Clients'} 'Body':{'host_components':[{'HostRoles':{'component_name':'CLIENTS'}}]}}This is incorrect. There is no component with name 'CLIENTS'.,0 ,0 
Wizard Step7 JS error on load page (add service wizard),Add Nagios  Ganglia via Add Service WizardProceed to step 'Customize Services'JS-error appears about null-object:/app/controllers/wizard/step7_controller.js : loadServiceTagsSuccess()if (serviceConfigsDef.sites.indexOf(site) &gt; -1)Also  HDFS by default is selected as active tab  but one of the 'new' services (Nagios for example) should be selected.,0 ,0 
Mistake in title of operation 'Restart APP_TIMELINE_SERVER on ...,We should show displayName  not componentName,0 ,0 
Installer: 'Undo' button for repo BaseURL does not work,STR: during installer phase go to &lt;cluster&gt;:8080 /#/installer/step1 ; Change/delete any of BaseURL of repos ; Click 'Undo' buttonActual Results:Undo button does not work. Moreover  if we click Undo after any update of text in BaseURL  it leads to cleanup of it value atall.,0 ,0 
Ganglia Server goes to 'installed' state after double 'Ganglia rrdcached base directory' config changing,STR:1) Deploy cluster by default2) Go to Ganglia service page -&gt; Config tab 3) Change value 'Ganglia rrdcached base directory' (e.g. /var/lib/ganglia/rrd8)4) Restart Ganglia5) Change 'Ganglia rrdcached base directory' back to old value (by default - /var/lib/ganglia/rrds)6) Restart GangliaExpected result: Ganglia should be restarted successfullyCurrent result: Ganglia Server goes to 'installed' state and stuck thereError message from gmetad file:=============================Starting hdp-gmetad...=============================Base directory (-b) resolved via file system links!Please consult rrdcached '-b' documentation!Consider specifying the real directory (/var/lib/ganglia/rrd8)chgrp: cannot access '/var/run/ganglia/hdp/rrdcached.sock': No such file or directorychgrp: cannot access '/var/run/ganglia/hdp/rrdcached.limited.sock': No such file or directoryFailed to start /usr/bin/rrdcachedNot starting /usr/sbin/gmetad because starting /usr/bin/rrdcached failed.root 16990 0.0 0.0 108164 1560 ? S 03:19 0:00 /bin/bash --login -c service hdp-gmetad start &gt;&gt; /tmp/gmetad.log 2&gt;&amp;1 ; /bin/ps auwx | /bin/grep [g]metad &gt;&gt; /tmp/gmetad.log 2&gt;&amp;1,0 ,0 
Supervisor under supervision fails w/o ganglia server,JMXetricAgent instrumented JVM  see https://github.com/ganglia/jmxetricMar 28  2014 6:40:13 PM info.ganglia.jmxetric.JMXetricAgent premainSEVERE: Exception starting JMXetricAgentjava.net.UnknownHostException: {0}: Name or service not known at java.net.Inet6AddressImpl.lookupAllHostAddr(Native Method) at java.net.InetAddress$1.lookupAllHostAddr(InetAddress.java:901) at java.net.InetAddress.getAddressesFromNameService(InetAddress.java:1293) at java.net.InetAddress.getAllByName0(InetAddress.java:1246) at java.net.InetAddress.getAllByName(InetAddress.java:1162) at java.net.InetAddress.getAllByName(InetAddress.java:1098) at java.net.InetAddress.getByName(InetAddress.java:1048) at info.ganglia.gmetric4j.gmetric.AbstractProtocol.&lt;init&gt;(AbstractProtocol.java:29) at info.ganglia.gmetric4j.gmetric.Protocolv31x.&lt;init&gt;(Protocolv31x.java:34) at info.ganglia.gmetric4j.gmetric.GMetric.&lt;init&gt;(GMetric.java:108) at info.ganglia.jmxetric.XMLConfigurationService.configureGangliaFromXML(XMLConfigurationService.java:165) at info.ganglia.jmxetric.XMLConfigurationService.configure(XMLConfigurationService.java:67) at info.ganglia.jmxetric.JMXetricAgent.premain(JMXetricAgent.java:51) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:606) at sun.instrument.InstrumentationImpl.loadClassAndStartAgent(InstrumentationImpl.java:382) at sun.instrument.InstrumentationImpl.loadClassAndCallPremain(InstrumentationImpl.java:397)The reason here is this config send from ui:...childopts: '-javaagent:/usr/lib/storm/contrib/storm-jmxetric/lib/jmxetric-1.0.4.jar=host={0} ...'it can't find hostname {0}  however this works fine:...childopts: '-javaagent:/usr/lib/storm/contrib/storm-jmxetric/lib/jmxetric-1.0.4.jar=host= port...'So let's leave it as empty if no ganglia server is present,0 ,0 
supervisor.enable should be removed from Ambari's Storm Config section,Ambari exposes the supervisor.enable property and in some early builds defaults it to true which causes the supervisor's to not launch workers assigned to them. The supervisor's will start up  the assignments are there  but the supervisor's just ignore them. We need to remove the supervisor.enable from Ambari as it seems like a very dangerous switch that doesn't have broad applicability.,0 ,0 
Table of Confirm Hosts step is collapsed,Steps to reproduce:1. Run hosts registration2. Switch to Registering category3. Wait till all hosts become registeredResult: Table is collapsed.JS error occured: Uncaught Error: assertion failed: calling set on destroyed object,0 ,0 
Don't do server-client version match check if App.version have not been set on ambari-web,With the new server-client version match check introduced  it is a bit annoying when building ambari-web locally and testing on the server for e2e testing  as the server and client versions must match exactly or you cannot proceed. We'll disable the check if App.version == ''.,0 ,0 
Falcon fails to deploy,Looks like Falcon service definition on the stack has changed by AMBARI-5278.Currently  any new definition of globals require duplicating them in the UI code but that was not done  so this is breaking Falcon installation.,0 ,0 
Icon 'Asterisk' on 'Assign Masters'/-Slaves steps does not display with 8-bit depth,,0 ,0 
Print better logs for openssl issues on centos/rhel 6.5.,Print better logs for openssl issues on centos/rhel 6.5.,0 ,0 
Tez DAG Operator hover text not wrapping wide content,When a Hive Tez DAG operator has a plan with very wide content  the text is not wrapped and hence bleeds out of the hover box. An additional problem is that this causes the hover to lose focus and hence close - thereby user cannot even see the hover (opens &amp; closes almost instantly).,0 ,0 
Ambari YARN UI - Quick Link - JMX breaks if RM port is changed,If you change RM port from 8088 to 50030 for migration of 1.x to 2.x   JVM metrics and few others are missing which results in yarn service summary page having multiple fields with n/a value.Step1: Change property below yarn.resourcemanager.webapp.address = localhost:50030Step 2: Start the service Click on Dashboard JMX is issue  Quick links is issue. RM gets started successfully.,0 ,0 
Error with finding FK constraint,Steps: Install Ambari-1.3.2 with Oracle DB. Upgrade ambari to 1.5.0 Run 'ambari-server upgrade' command.Seems like check before execute doesn't work for Oracle. Since we ignore failures this is not block the upgrade.Exception:16:41:36 719 WARN [main] DBAccessorImpl:416 - Error executing query: ALTER TABLE clusterconfigmapping ADD CONSTRAINT FK_clustercfgmap_cluster_id FOREIGN KEY (cluster_id) REFERENCES clusters (cluster_id)java.sql.SQLSyntaxErrorException: ORA-02275: such a referential constraint already exists in the table at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:445) at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:396) at oracle.jdbc.driver.T4C8Oall.processError(T4C8Oall.java:879) at oracle.jdbc.driver.T4CTTIfun.receive(T4CTTIfun.java:450) at oracle.jdbc.driver.T4CTTIfun.doRPC(T4CTTIfun.java:192) at oracle.jdbc.driver.T4C8Oall.doOALL(T4C8Oall.java:531) at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:193) at oracle.jdbc.driver.T4CStatement.executeForRows(T4CStatement.java:1033) at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1329) at oracle.jdbc.driver.OracleStatement.executeInternal(OracleStatement.java:1909) at oracle.jdbc.driver.OracleStatement.execute(OracleStatement.java:1871) at oracle.jdbc.driver.OracleStatementWrapper.execute(OracleStatementWrapper.java:318) at org.apache.ambari.server.orm.DBAccessorImpl.executeQuery(DBAccessorImpl.java:413) at org.apache.ambari.server.orm.DBAccessorImpl.executeQuery(DBAccessorImpl.java:399) at org.apache.ambari.server.orm.DBAccessorImpl.addFKConstraint(DBAccessorImpl.java:262) at org.apache.ambari.server.upgrade.UpgradeCatalog150.executeDDLUpdates(UpgradeCatalog150.java:375) at org.apache.ambari.server.upgrade.AbstractUpgradeCatalog.upgradeSchema(AbstractUpgradeCatalog.java:177) at org.apache.ambari.server.upgrade.SchemaUpgradeHelper.executeUpgrade(SchemaUpgradeHelper.java:174) at org.apache.ambari.server.upgrade.SchemaUpgradeHelper.main(SchemaUpgradeHelper.java:234)16:41:36 720 WARN [main] DBAccessorImpl:264 - Add FK constraint failed  constraintName = FK_clustercfgmap_cluster_id  tableName = clusterconfigmapping  errorCode = 2275  message = ORA-02275: such a referential constraint already exists in the table,0 ,0 
unittest NagiosPropertyProviderTest fails,testNoNagiosServerCompoonent(org.apache.ambari.server.controller.nagios.NagiosPropertyProviderTest): Expected no alertstestNoNagiosService(org.apache.ambari.server.controller.nagios.NagiosPropertyProviderTest): Expected no alerts,0 ,0 
Automatic bootstrap failed on CentOS 6.5 (No module named common_functions),SSH bootstrap of agents failed on CentOS 6.5.==========================Copying OS type check script...==========================Could not create directory '/root/.ssh'.Warning: Permanently added 'c6502.ambari.apache.org 192.168.65.102' (RSA) to the list of known hosts.scp /usr/lib/python2.6/site-packages/ambari_server/os_check_type.pyhost=c6502.ambari.apache.org  exitcode=0==========================Running OS type check...==========================Traceback (most recent call last): File '/tmp/os_check_type1396641340.py'  line 22  in &lt;module&gt; from common_functions import OSCheckImportError: No module named common_functionsConnection to c6502.ambari.apache.org closed.SSH command execution finishedhost=c6502.ambari.apache.org  exitcode=1ERROR: Bootstrap of host c6502.ambari.apache.org fails because previous action finished with non-zero exit code (1)ERROR MESSAGE: tcgetattr: Invalid argumentConnection to c6502.ambari.apache.org closed.STDOUT: Traceback (most recent call last): File '/tmp/os_check_type1396641340.py'  line 22  in &lt;module&gt; from common_functions import OSCheckImportError: No module named common_functionsConnection to c6502.ambari.apache.org closed.,0 ,0 
Dashboard: dashboard actions do not work for non-admin users,For non-admin users action 'Switch to classic dashboard' returns JS error and 'Reset all widgets to default' action throws to Login page.,0 ,0 
Installer: 'Undo' button for repo BaseURL is unnecessarily present,STR:on Installer phase go to &lt;cluster&gt;:8080 /#/installer/step1Do not do any updates of 'Base Url' fieldcheck the 'Undo' button for 2.1 stack.Actual Result:Undo is present for all 3 Os reposExpected Result:Undo should be present only after any update of 'BaseURL' field----------Seems  functionally this does not affect us  but might be confusing for users.,0 ,0 
Schema Upgrade failed when upgrading to 1.5.1,While upgrade  schema upgrade fails.Example error output (Oracle):rg.apache.ambari.server.AmbariException: Current database store version is not compatible with current server version  serverVersion=1.5.1.96  schemaVersion=1.4.1.25 at org.apache.ambari.server.controller.AmbariServer.checkDBVersion(AmbariServer.java:479) at org.apache.ambari.server.controller.AmbariServer.run(AmbariServer.java:149) at org.apache.ambari.server.controller.AmbariServer.main(AmbariServer.java:528)and Postgres 11:39:27 364 ERROR [main] AmbariServer:531 - Failed to run the Ambari Serverorg.apache.ambari.server.AmbariException: Current database store version is not compatible with current server version  serverVersion=1.5.1.96  schemaVersion=1.5.0 at org.apache.ambari.server.controller.AmbariServer.checkDBVersion(AmbariServer.java:479) at org.apache.ambari.server.controller.AmbariServer.run(AmbariServer.java:149) at org.apache.ambari.server.controller.AmbariServer.main(AmbariServer.java:528),0 ,0 
Deploy stuck during generating tasks on Review page (not always reproduced),After the user clicks 'Deploy' in the Installer Wizard  sometimes an error is shown showing 'java.lang.IllegalArgumentException: Could not access base url'. This happens while the wizard tries to save the user-specified repo base URLs.Installer should not be performing validation during deploy  because it had already been done during Select Stacks.,0 ,0 
Remove classic dashboard view from Ambari,remove classic dashboard from Ambari  as it's not used any more and doesn't support new services,0 ,0 
Pig unit test class named wrong,Typo in unit test. File said class was Hcat rather than Pig,0 ,0 
Operation 'Supervisor start' failed during installation but all supervisors are alive,STR:1. Deploy Hadoop by default scenario with all services.2. Try to start Storm.Actual results: 'Start All Services' operation failed because of 'Supervisor start' failed. 'Start Storm' operation does not contain 'Supervisor start' popups  but all supervisors are STARTED after it have finished.,0 ,0 
OS type check for centos 6.5 can fail if the /etc/issue has CentOS Linux release 6.5,I tried default centos 6.5 it works fine. But if I change /etc/issues and /etc/redhat-release to say:CentOS Linux release 6.5 (Final)then the registration fails with:INFO 2014-04-09 14:39:22 501 security.py:51 - SSL connection established. Two-way SSL authentication is turned off on the server.ERROR 2014-04-09 14:39:22 563 Controller.py:100 - Cannot register host with not supported os type  hostname=c6501.ambari.apache.org  serverOsType=redhat6  agentOstype=centos linux6In the agent logs.By default centos 6.5 has:CentOS release 6.5 (Final)but sometimes can have:CentOS Linux release 6.5 (Final),0 ,0 
Add Host failed on upgraded cluster on Suse,This is due to upgrade. We need to change it manually after upgrade://Now we have (redhat  suse  debian  other_detected_by_python)vi /etc/ambari-server/conf/ambari.properties(server.os_type=sles11) --&gt;( server.os_type=suse11)+restart the serverShould upgrade automatically deal with this?old code: os_info = platform.linux_distribution( None  None  None  ['SuSE'  'redhat' ]  0 ) os_name = os_info[0].lower() if os_name == 'suse': os_name = 'sles' os_version = os_info[1].split('.'  1)[0] master_os_type = os_name + os_version write_property(OS_TYPE_PROPERTY  master_os_type),0 ,0 
When new host components are created thru API  some indication should be given that Nagios has to be restarted,Need to fix this on API side,0 ,0 
Ambari configuration for map join conversion and tez container size seems wrong,For hive:hive.auto.convert.join.noconditionaltask.size is set to 1000000000 This should be a fraction (1/3) of the container size.hive.tez.java.opts has '-Xmx1024m'This is different from both map and reduce sizes. Desired values are: map size if map size &gt; 2g else reduce sizemap size is set on the same cluster to ~500mbThe settings as the are will lead to many failed queries because the mapjoin conversion is to aggressive. If we don't change the container sizes based on cluster configs we will see wide spread problems with containers being killed or perf problems.,0 ,0 
Host Checks: alternatives check results are not surfaced in Host Check popup,Ambari Agent  as part of host checks  identifies conflicting 'alternatives' settings and reports back inside the 'last_agent_env' object.UI is not surfacing this in Host Checks popup.We should have a section called 'Alternatives Issues' and list out the alternatives names.For example: 'last_agent_env' : { 'stackFoldersAndFiles' : [ ... ]  'alternatives' : [ { 'name' : 'zookeeper-conf'  'target' : '/etc/zookeeper/conf.dist' }  { 'name' : 'hadoop-conf'  'target' : '/etc/hadoop/conf.dist' }  ]  'existingUsers' : [ .... ]  'existingRepos' : [ ... ]  ...In the above case  we want to highlight the fact that hadoop-conf and zookeeper-conf have conflicts.Alternatives Issues--------The following alternatives should be removedAlternativeshadoop-conf Exists on 3 hostszookeeper-conf Exists on 3 hosts,0 ,0 
Usability: Improve Stack Definition support for repositories,1) Remove HDP-UTILS from Ambari .repo  and move into the HDP Stack Definition (Ambari does not depend on HDP-UTILS so this causes confusion  makes it harder to doc local repo setup  and is unclear on failures if not setup correctly).2) Requires support for multiple repositories in a Stack Definition  and ability to specify multiple repositories from UI.,0 ,0 
Use SchemaTool in Hive for init metastore DB schema,When Ambari create the metastore database in MySQL it uses auto create feature. This does not create the transaction tables  so any ACID operations (including streaming ingest) will not work.,0 ,0 
Misleading hardcoded command in paragraph 2 on step 'Manual commands' of 'Move Master' wizard,STR:1. Deploy cluster with multiplied NN directory(in our case /grid/0/hadoop/hdfs/namenode  /grid/1/hadoop/hdfs/namenode).2. Start NN moving.3. Reach step 'Manual commands'.Actual results:Paragraph 1 contains information about all dirs we should move.Paragraph 2 contains message 'Login to the target host XXX and change permissons for the NameNode dirs by running:' and only one command with hardcoded NN dir:chown -R hdfs:hadoop /hadoop/hdfs/namenode/Screenshot attached.When there are multiple directories specified  we need to show the actual path (but replace commas with a space).In case of '/grid/0/hadoop/hdfs/namenode /grid/1/hadoop/hdfs/namenode' as in the attached image  we should display:chown -R hdfs:hadoop /grid/0/hadoop/hdfs/namenode /grid/1/hadoop/hdfs/namenode,0 ,0 
Move wizard and HA wizard gets stuck on any deploy step,Because of JS error (page refresh makes no effect).,0 ,0 
Unit tests for number_utils  string_utils  validator and misc files.,Create unit tests for following files:utils/misc.jsutils/number_utils.jsutils/string_utils.jsutils/validator.js,0 ,0 
Switch SQL standard authorization to be off by default.,For Ambari 1.5.1 SQL standard authorization was on by default.Users with certification suites are running into problems related to this feature (which were not bugs in the auth systems  rather they were additional requirements to using it). This needs to be turned off by default. The feature is controlled by:hive.security.authorization.enabledWe want the default value to be set to false in Ambari 1.6.0.,0 ,0 
Unit tests for steps 6 (with small refactor),,0 ,0 
Call for requests with 'page_size' always return 10 most recent,Problem:Call: /api/v1/clusters/cl1/requests?to=end&amp;page_size=20Actually result: return most recent 10 requestsExpected result: return most recent 20 requests.Call: /api/v1/clusters/cl1/requests?from=start&amp;page_size=3Actually result: return first 3 requests started from the first in most recent 10Expected result: return first 3 requests started from the very first('install services')In this case  we can never get history requests made before most recent 10.,0 ,0 
Checkbox 'client' without upper case letter,,0 ,0 
NameNode HA wizard: Review page appears blank,,0 ,0 
Navigating back from Host page to Heatmaps page is broken,STR: Go to Dashboard page. Switch to 'Heatmaps' tab. Click on first host. On host page click 'Back'.Actual result: Appeared 'Cluster Status and Metrics' tab.Expected result: Should appear 'Heatmaps' tab.,0 ,0 
Fix UI Unit tests,,0 ,0 
Restart option is enabled for components in 'Decommissioned' state but it should not,'Restart' option should not be enabled if a slave component is in 'decommissioned' state  but it is.STR:1) Go to 'Host details' page2) Make any slave component 'Decommissioned'Actual result: 'Restart' option is enabled (see screenshot)Expected result: 'Restart' option should be disabled.,0 ,0 
Turn Off Maintenance Mode for HDFS does not work (problems with ambari-agent),STR:Turn On Maintenance Mode for HDFSTurn Off Maintenance Mode for HDFSExpected result:Have not problems with ambari-agent.Actual result:Have problems with ambari-agent.,0 ,0 
Ambari version is unknown during installer via UI,During installer user does not see Ambari Version from UI (see screenshot)  but on monitoring phase it's available in the same Admin -&gt; About,0 ,0 
Usability UX: Default key actions for dialog boxes,PROBLEM: Default action for dialog boxes in AmbariUSE CASE: Ambari UI doesn't allow you to press enter and trigger default actions. When a default action is high lighted 'green button' you should be able to hit enter and have the action be triggered. In this case add hit enter should make okay button trigger. Also  pressing escape should cancel the dialog box.,0 ,0 
Yarn Nodemanager Metrics only update every few minutes,Yarn Nodemanager Metrics take far too long between updates.To demonstrate:Run Terasort or anything that runs mapreduce:hdfs dfs -mkdir -p benchmarks/terasorthadoop jar /usr/lib/hadoop-mapreduce/hadoop-mapreduce-examples.jar teragen -Dmapred.map.tasks=72 -Dmapred.reduce.tasks=36 1000000 benchmarks/terasort/inputhadoop jar /usr/lib/hadoop-mapreduce/hadoop-mapreduce-examples.jar terasort -Dmapred.map.tasks=72 -Dmapred.reduce.tasks=36 benchmarks/terasort/input benchmarks/terasort/outputhdfs dfs -rm -R -skipTrash benchmarks/terasortThen repeatedly probe the API at:https://&lt;server&gt;:8081/api/v1/clusters/c1/services/YARN/components/NODEMANAGER?fields=host_components/metrics/yarnIt usually takes 2-3 minutes to see the metrics update  very repeatable.,0 ,1 
Unit tests for object_utils  date  ui_effects  updater,Create unit tests for following files: utils/object.js utils/date_utils.js utils/ui_effects_utils.js utils/updater.js,0 ,0 
'Upgrading schema' failed during upgrading to 1.6.0,Postgres issue:new restart_required relies on eclipselink default type converters  we avoided this in pastorg.postgresql.util.PSQLException: ERROR: column 'restart_required' is of type boolean but expression is of type integer Hint: You will need to rewrite or cast the expression. Position: 57 at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2161) at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:1890) at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:255) at org.postgresql.jdbc2.AbstractJdbc2Statement.execute(AbstractJdbc2Statement.java:559) at org.postgresql.jdbc2.AbstractJdbc2Statement.executeWithFlags(AbstractJdbc2Statement.java:403) at org.postgresql.jdbc2.AbstractJdbc2Statement.executeUpdate(AbstractJdbc2Statement.java:331) at org.apache.ambari.server.orm.DBAccessorImpl.updateTable(DBAccessorImpl.java:447) at org.apache.ambari.server.orm.DBAccessorImpl.addColumn(DBAccessorImpl.java:371) at org.apache.ambari.server.upgrade.UpgradeCatalog160.executeDDLUpdates(UpgradeCatalog160.java:72) at org.apache.ambari.server.upgrade.AbstractUpgradeCatalog.upgradeSchema(AbstractUpgradeCatalog.java:177) at org.apache.ambari.server.upgrade.SchemaUpgradeHelper.executeUpgrade(SchemaUpgradeHelper.java:176) at org.apache.ambari.server.upgrade.SchemaUpgradeHelper.main(SchemaUpgradeHelper.java:225)MySQL issue:Inreresting MySQL feature  there should be no space between function name and parenthesis18:57:00 629 WARN [main] DBAccessorImpl:469 - Error executing query: insert into request(request_id  cluster_id  request_context  start_time  end_time  create_time) select distinct s.request_id  s.cluster_id  s.request_context  coalesce (cmd.start_time  -1)  coalesce (cmd.end_time  -1)  -1 from (select distinct request_id  cluster_id  request_context from stage ) s left join (select request_id  min(start_time) as start_time  max(end_time) as end_time from host_role_command group by request_id) cmd on s.request_id=cmd.request_idcom.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: FUNCTION ambari.coalesce does not exist at sun.reflect.GeneratedConstructorAccessor14.newInstance(Unknown Source) at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) at java.lang.reflect.Constructor.newInstance(Constructor.java:526) at com.mysql.jdbc.Util.handleNewInstance(Util.java:411) at com.mysql.jdbc.Util.getInstance(Util.java:386) at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:1054) at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:4237) at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:4169) at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:2617) at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:2778) at com.mysql.jdbc.ConnectionImpl.execSQL(ConnectionImpl.java:2828) at com.mysql.jdbc.ConnectionImpl.execSQL(ConnectionImpl.java:2777) at com.mysql.jdbc.StatementImpl.execute(StatementImpl.java:949) at com.mysql.jdbc.StatementImpl.execute(StatementImpl.java:795) at org.apache.ambari.server.orm.DBAccessorImpl.executeQuery(DBAccessorImpl.java:466) at org.apache.ambari.server.orm.DBAccessorImpl.executeQuery(DBAccessorImpl.java:452) at org.apache.ambari.server.upgrade.UpgradeCatalog150.executeDDLUpdates(UpgradeCatalog150.java:325) at org.apache.ambari.server.upgrade.AbstractUpgradeCatalog.upgradeSchema(AbstractUpgradeCatalog.java:177) at org.apache.ambari.server.upgrade.SchemaUpgradeHelper.executeUpgrade(SchemaUpgradeHelper.java:176) at org.apache.ambari.server.upgrade.SchemaUpgradeHelper.main(SchemaUpgradeHelper.java:225),0 ,0 
Explicitly disabling datanucleus l2 cache for hive,Ambari installations of hive currently do not set any datanucleus related properties. There is such a thing as a datanucleus l2 cache  that is pretty bad for hive in a distributed environment if it is set. (If there is a lone embedded hive instance  with no other codepaths to the db  then it's fine  but that never happens in a distributed environment.)By default  if no setting is present  datanucleus defaults the l2 cache to being on  so hive ups the ante by defaulting to turning it off by default if no other setting is configured.Now  in a war of 'defaults'  the hive default should win  but this is an area where we have had recurring support issues from clients that turn it on expecting improved performance. Thus  I'd like ambari installed hive-site.xml to explicitly have this config parameter turned off  with a comment asking users to not switch it on as it impacts hive negatively.The parameter in question is 'datanucleus.cache.level2.type'   and it's value should be 'none'. (Note that I've seen some older configs that seem to do things like turning datanucleus.cache.level2 = false and stuff like that  that is bogus config and does nothing and should not be assumed to be a catch-all enabler.)As a comment  I'd like the following comment 'Disables datanucleus l2 cache. This must be set to 'none' for hive to work properly' or something to that effect.,0 ,0 
Start Services command gets stuck for about 30 mins,On Security wizard Start Services command ZOOKEEPER_SERVER Start task scheduled on ambari-server host remained in QUEUED status for about 30 mins and other non-completed commands were in PENDING status. For this time interval no command was in IN_PROGRESS status.Later executing stop all services command on the same cluster also made ZOOKEEPER_SERVER Stop task scheduled on ambari-server host to remain in QUEUED status for around 20 mins.,0 ,0 
Add Services is disabled after upgrading the stack from HDP-2.0 to HDP-2.1,Prior to upgrade  launch Add Services wizard using Ambari 1.5.0 (crucial step) Upgrade stack to a stack with new services and Ambari to 1.5.1 Add Services button is disabled  even though there are services that have not been added to the cluster,0 ,0 
Jobs dont show up as links for a moment when page is visited,I had a couple of finished jobs showing the jobs page. Then I clicked on one job and went back to the jobs page. For a moment both jobs were not shown as links - though they are clickable. This is basically an appearance issue where the job doesnt look like a link for a moment.,0 ,0 
Views: do not let the user click on the Views icon in the top nav,When clicking on the Views icon in the top nav  the page content turns blank.We will show a view index page in a later release  but for now  let's just disable clicking on that icon.,0 ,0 
JobsDiagnostic|2.1.1: No job status and end time is shown for interrupted job,Enabled tez engine for hive;Executed select query;If while job is running I stop it by double pressign CTRL-C in hive shell then job will not have end time shown in jobs table and no failed icon (red X)  but in job details it will have status 'killed' and correct end time.If job is killed with yarn application -kill it will have correct end time and failed icon displayed in jobs table  but in job details it will not have neither status nor end time.,0 ,0 
Alternatives issues has error message (missing translation),Build 1.6.0-151Missing translation: installer.step3.hostWarningsPopup.alternatives.emptyinstaller.step3.hostWarningsPopup.alternatives.empty,0 ,0 
Zookeeper smoke test failed after being triggered after deleting a host  containing ZookeeperServer,1. Stopped all host components on a host ( to be deleted) with ZookeeperServer. 2. Deleted a host from cluster. 3. Ran Zookeeper Service Check.Actual result: failed. Expected: ok.,0 ,0 
Unit tests for utils/config.js part 1,Update unit tests for utils/config.js.,0 ,0 
Views list not loading in Ambari Web,In build 1.6.0-159  the views call is being made but it's not listing the views in the dropdown.This was due to the API change and Ambari Web hasn't adjusted yet to this introduction of /versions/.,0 ,0 
Disable security fails occasionally,There is a possibility that 'Start all Services' command will fail on Disable Security wizard if App.Service DS model was not populated on the load of 'Disable security page' (timing issue). We need to make sure that the Service model has populated before the 'Disable Security page' is rendered.,1 ,0 
pig.properties should set pig.location.check.strict to false,pig.properties should set pig.location.check.strict to false,0 ,0 
All Services Fail To Deploy Due To Agent Parsing Exception,When deploying a brand new cluster  all services fail to install due to a parsing exception thrown from the Ambari Agents.File '/usr/lib/python2.6/site-packages/ambari_agent/CustomServiceOrchestrator.py'  line 113  in runCommandjson_path = self.dump_command_to_json(command)File '/usr/lib/python2.6/site-packages/ambari_agent/CustomServiceOrchestrator.py'  line 209  in dump_command_to_jsoncommand'clusterHostInfo' = manifestGenerator.decompressClusterHostInfo(command'clusterHostInfo')File '/usr/lib/python2.6/site-packages/ambari_agent/manifestGenerator.py'  line 116  in decompressClusterHostInfoindexes = convertRangeToList(v)File '/usr/lib/python2.6/site-packages/ambari_agent/manifestGenerator.py'  line 57  in convertRangeToListraise AgentException.AgentException('Broken data in given range  expected - ''m-n'' or ''m''  got : ' + str(r))AgentException: 'Broken data in given range  expected - m-n or m  got : -1窶儺he command being sent is{hs_host=[2]  namenode_host=[1]  snamenode_host=[2]  zookeeper_hosts=[0-2]  ganglia_server_host=[1]  nm_hosts=[0]  ganglia_monitor_hosts=[0-2]  all_hosts=[c6403.ambari.apache.org  c6401.ambari.apache.org  c6402.ambari.apache.org]  rm_host=[2]  app_timeline_server_hosts=[2]  slave_hosts=[0]  ambari_server_host=[-1]  nagios_server_host=[1]  all_ping_ports=[8670:0-2]}Notice the ambari-server-host which was added in that commit; it窶冱 value is 窶・1窶・which would not parse correctly in manifestGenerator.pyI suspect Git e667dc7c9870864ff537374c819b7c1d1dd88e98 caused this problem.Steps to reproduce:1) Provision 3 c64 hosts2) Wipe your server database and re-create it with the embedded PSQL script3) Attempt to provision a cluster with various services.All services will fail to deploy b/c of the above exception. This was working without issues before the above suspect commit.,0 ,0 
Adding Oozie failed at service check,This happens because HDFS and YARN/MapReduce requires to be restarted for Oozie smoke test to pass successfullyAs a fix to this issue: Don't run smoke test on 'Install  Start and Test' page of the add service wizard. Review page should ask user to restart all stale services.,0 ,0 
Space Error in container-executor.cfg,There is a space between 'banned.user' and '=' which make configuration here is ignored by container-executor  so some default banned users works to include hdfs. Space should be deleted between 'banned.user' and '='yarn.nodemanager.local-dirs=/grid/0/hadoop/yarn/local /grid/1/hadoop/yarn/localyarn.nodemanager.log-dirs=/grid/0/hadoop/yarn/log /grid/1/hadoop/yarn/logyarn.nodemanager.linux-container-executor.group=hadoopbanned.users = hdfs yarn mapred binmin.user.id=1000It should be banned.users=hdfs yarn mapred bin,0 ,0 
HDP deployment failed in CentOS5,Fail: Execution of 'mkdir -p /tmp/HDP-artifacts/ ; curl --noproxy hadoop -kf --retry 10 http://hadoop:8080/resources//jdk-7u45-linux-x64.tar.gz -o /tmp/HDP-artifacts//jdk-7u45-linux-x64.tar.gz' returned 2. curl: option --noproxy: is unknownversion of curl that is available at Centos 5 and SLES 11 SP1 seems to have no support for '--noproxy' option.But such workaround works:no_proxy=i.ua curl http://www.i.ua -iI'm going to replace all '--noproxy' invocations with usage of $no_proxy env variable.,0 ,0 
File View Cleanup,A few items that need to be rectified for the File view submission:1. Modify code to abide by Ambari Coding Standards2. JavaDoc Interfaces and Methods.https://cwiki.apache.org/confluence/display/AMBARI/Coding+Guidelines+for+Ambari.,0 ,0 
Ambari upgrade to Ambari-1.6.0 from Ambari-1.5.1 logs PSQLException,Following upgrade documentation at http://docs.hortonworks.com/HDPDocuments/Ambari-1.5.1.0/bk_upgrading_Ambari/content/ambari-chap7_2x.html On executing ambari-server upgrade  PSQLException is logged inambari-server.log:21:36:20 498 INFO [main] SchemaUpgradeHelper:211 - Upgrading schema to target version = 1.6.021:36:20 528 INFO [main] SchemaUpgradeHelper:220 - Upgrading schema from source version = 1.5.1.11021:36:20 530 INFO [main] SchemaUpgradeHelper:141 - Upgrade path: [{ org.apache.ambari.server.upgrade.UpgradeCatalog160$$EnhancerByGuice$$ff8a4f66: sourceVersion = null  targetVersion = 1.6.0 }]21:36:20 530 INFO [main] SchemaUpgradeHelper:171 - Executing DDL upgrade...21:36:20 533 INFO [main] DBAccessorImpl:463 - Executing query: ALTER SCHEMA ambari OWNER TO 'ambari';21:36:20 534 INFO [main] DBAccessorImpl:463 - Executing query: ALTER ROLE 'ambari' SET search_path to 'ambari';21:36:20 598 INFO [main] DBAccessorImpl:463 - Executing query: CREATE TABLE hostgroup_configuration (blueprint_name VARCHAR(255) NOT NULL  hostgroup_name VARCHAR(255) NOT NULL  type_name VARCHAR(255) NOT NULL  config_data BYTEA NOT NULL  PRIMARY KEY (blueprint_name  hostgroup_name  type_name))21:36:20 962 INFO [main] DBAccessorImpl:463 - Executing query: CREATE TABLE viewentity (id BIGINT NOT NULL  view_name VARCHAR(255) NOT NULL  view_instance_name VARCHAR(255) NOT NULL  class_name VARCHAR(255) NOT NULL  id_property VARCHAR(255)  PRIMARY KEY (id))21:36:21 010 INFO [main] DBAccessorImpl:463 - Executing query: ALTER TABLE hostcomponentdesiredstate ADD restart_required BOOLEAN21:36:21 078 INFO [main] DBAccessorImpl:463 - Executing query: ALTER TABLE hostgroup_configuration ADD CONSTRAINT FK_hg_config_blueprint_name FOREIGN KEY (blueprint_name) REFERENCES hostgroup (blueprint_name)21:36:21 084 WARN [main] DBAccessorImpl:469 - Error executing query: ALTER TABLE hostgroup_configuration ADD CONSTRAINT FK_hg_config_blueprint_name FOREIGN KEY (blueprint_name) REFERENCES hostgroup (blueprint_name)org.postgresql.util.PSQLException: ERROR: there is no unique constraint matching given keys for referenced table 'hostgroup' at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2161) at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:1890) at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:255) at org.postgresql.jdbc2.AbstractJdbc2Statement.execute(AbstractJdbc2Statement.java:559) at org.postgresql.jdbc2.AbstractJdbc2Statement.executeWithFlags(AbstractJdbc2Statement.java:403) at org.postgresql.jdbc2.AbstractJdbc2Statement.execute(AbstractJdbc2Statement.java:395) at org.apache.ambari.server.orm.DBAccessorImpl.executeQuery(DBAccessorImpl.java:466) at org.apache.ambari.server.orm.DBAccessorImpl.executeQuery(DBAccessorImpl.java:452) at org.apache.ambari.server.orm.DBAccessorImpl.addFKConstraint(DBAccessorImpl.java:337) at org.apache.ambari.server.orm.DBAccessorImpl.addFKConstraint(DBAccessorImpl.java:321) at org.apache.ambari.server.upgrade.UpgradeCatalog160.executeDDLUpdates(UpgradeCatalog160.java:85) at org.apache.ambari.server.upgrade.AbstractUpgradeCatalog.upgradeSchema(AbstractUpgradeCatalog.java:250) at org.apache.ambari.server.upgrade.SchemaUpgradeHelper.executeUpgrade(SchemaUpgradeHelper.java:176) at org.apache.ambari.server.upgrade.SchemaUpgradeHelper.main(SchemaUpgradeHelper.java:225)21:36:21 089 WARN [main] DBAccessorImpl:339 - Add FK constraint failed  constraintName = FK_hg_config_blueprint_name  tableName = hostgroup_configurationorg.postgresql.util.PSQLException: ERROR: there is no unique constraint matching given keys for referenced table 'hostgroup' at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2161) at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:1890) at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:255) at org.postgresql.jdbc2.AbstractJdbc2Statement.execute(AbstractJdbc2Statement.java:559) at org.postgresql.jdbc2.AbstractJdbc2Statement.executeWithFlags(AbstractJdbc2Statement.java:403) at org.postgresql.jdbc2.AbstractJdbc2Statement.execute(AbstractJdbc2Statement.java:395) at org.apache.ambari.server.orm.DBAccessorImpl.executeQuery(DBAccessorImpl.java:466) at org.apache.ambari.server.orm.DBAccessorImpl.executeQuery(DBAccessorImpl.java:452) at org.apache.ambari.server.orm.DBAccessorImpl.addFKConstraint(DBAccessorImpl.java:337) at org.apache.ambari.server.orm.DBAccessorImpl.addFKConstraint(DBAccessorImpl.java:321) at org.apache.ambari.server.upgrade.UpgradeCatalog160.executeDDLUpdates(UpgradeCatalog160.java:85) at org.apache.ambari.server.upgrade.AbstractUpgradeCatalog.upgradeSchema(AbstractUpgradeCatalog.java:250) at org.apache.ambari.server.upgrade.SchemaUpgradeHelper.executeUpgrade(SchemaUpgradeHelper.java:176) at org.apache.ambari.server.upgrade.SchemaUpgradeHelper.main(SchemaUpgradeHelper.java:225),0 ,0 
Storm fails to start after disabling security,nimbus.childopts  ui.childopts and supervisor.childopts points to sasl configuration files after the security is disabled. web-ui should remove -Djava.security.auth.login.config parameter from these properties while disabling security.,0 ,0 
2000-node cluster testing: during install phase of cluster deployment  install tasks were stuck in PENDING state,ActionScheduler is stucked when adding tasks to ActionQueue on large clusters (&gt;1000 nodes),0 ,1 
In some upgrade scenarios  Ambari Web's persist key-value store state causes the UI to act unpredictably,During Ambari upgrade  automatically clear the persist state to prevent potential issues with Ambari Web not working properly (this was observed a number of times on upgraded clusters). Currently  we make the following call to get out of the inconsistent state so that Ambari Web works properly:curl -i -u admin:admin -H 'X-Requested-By: ambari' -X POST -d '{ 'CLUSTER_CURRENT_STATUS': '{/'clusterState/':/'CLUSTER_STARTED_5/'}' }' http://localhost:8080/api/v1/persistWe need to do something equivalent during upgrade.,0 ,0 
Recommission a DN fails when https is enabled in Ambari server,After https is enable in Ambari server  Recommission a DN will fails with the following error message found in the Ambari-server log:WARN &#91;qtp1103265648-610&#93; nio:651 - javax.net.ssl.SSLException: Received fatal alert: certificate_unknown 00:32:05 458 INFO &#91;ExecutionScheduler_Worker-1&#93; JobRunShell:207 - Job LinearExecutionJobs.BatchRequestJob-2-1 threw a JobExecutionException: org.quartz.JobExecutionException: org.apache.ambari.server.AmbariException: Exception occurred while performing request &#91;See nested exception: org.apache.ambari.server.AmbariException: Exception occurred while performing request&#93; at org.apache.ambari.server.scheduler.AbstractLinearExecutionJob.execute(AbstractLinearExecutionJob.java:94) at org.quartz.core.JobRunShell.run(JobRunShell.java:202) at org.quartz.simpl.SimpleThreadPool$WorkerThread.run(SimpleThreadPool.java:573) Caused by: org.apache.ambari.server.AmbariException: Exception occurred while performing request at org.apache.ambari.server.scheduler.ExecutionScheduleManager.executeBatchRequest(ExecutionScheduleManager.java:479) at org.apache.ambari.server.state.scheduler.BatchRequestJob.doWork(BatchRequestJob.java:77) at org.apache.ambari.server.scheduler.AbstractLinearExecutionJob.execute(AbstractLinearExecutionJob.java:88) ... 2 more Caused by: com.sun.jersey.api.client.ClientHandlerException: javax.net.ssl.SSLHandshakeException: java.security.cert.CertificateException: No name matching localhost found at com.sun.jersey.client.urlconnection.URLConnectionClientHandler.handle(URLConnectionClientHandler.java:149) at com.sun.jersey.api.client.filter.CsrfProtectionFilter.handle(CsrfProtectionFilter.java:97) at org.apache.ambari.server.security.authorization.internal.InternalTokenClientFilter.handle(InternalTokenClientFilter.java:39) at com.sun.jersey.api.client.Client.handle(Client.java:648) at com.sun.jersey.api.client.WebResource.handle(WebResource.java:670) at com.sun.jersey.api.client.WebResource.method(WebResource.java:311) at org.apache.ambari.server.scheduler.ExecutionScheduleManager.performApiRequest(ExecutionScheduleManager.java:619) at org.apache.ambari.server.scheduler.ExecutionScheduleManager.executeBatchRequest(ExecutionScheduleManager.java:469) ... 4 more Caused by: javax.net.ssl.SSLHandshakeException: java.security.cert.CertificateException: No name matching localhost found at sun.security.ssl.Alerts.getSSLException(Alerts.java:192) at sun.security.ssl.SSLSocketImpl.fatal(SSLSocketImpl.java:1884) at sun.security.ssl.Handshaker.fatalSE(Handshaker.java:276) at sun.security.ssl.Handshaker.fatalSE(Handshaker.java:270) at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1341) at sun.security.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:153) at sun.security.ssl.Handshaker.processLoop(Handshaker.java:868) at sun.security.ssl.Handshaker.process_record(Handshaker.java:804) at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:1016) at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1312) at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1339) at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1323) at sun.net.www.protocol.https.HttpsClient.afterConnect(HttpsClient.java:563) at sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(AbstractDelegateHttpsURLConnection.java:185) at sun.net.www.protocol.http.HttpURLConnection.getOutputStream(HttpURLConnection.java:1091) at sun.net.www.protocol.https.HttpsURLConnectionImpl.getOutputStream(HttpsURLConnectionImpl.java:250),0 ,0 
View: Files UI clean-up and adjustments,,0 ,0 
Pig fails to install through blueprint,During installation through blueprint pig install fails with next exception:Traceback (most recent call last): File '/var/lib/ambari-agent/cache/stacks/HDP/2.0.6/services/PIG/package/scripts/pig_client.py'  line 41  in &lt;module&gt; PigClient().execute() File '/usr/lib/python2.6/site-packages/resource_management/libraries/script/script.py'  line 112  in execute method(env) File '/var/lib/ambari-agent/cache/stacks/HDP/2.0.6/services/PIG/package/scripts/pig_client.py'  line 30  in install self.configure(env) File '/var/lib/ambari-agent/cache/stacks/HDP/2.0.6/services/PIG/package/scripts/pig_client.py'  line 35  in configure pig() File '/var/lib/ambari-agent/cache/stacks/HDP/2.0.6/services/PIG/package/scripts/pig.py'  line 40  in pig properties=params.pig_properties) File '/usr/lib/python2.6/site-packages/resource_management/core/base.py'  line 148  in __init__ self.env.run() File '/usr/lib/python2.6/site-packages/resource_management/core/environment.py'  line 149  in run self.run_action(resource  action) File '/usr/lib/python2.6/site-packages/resource_management/core/environment.py'  line 115  in run_action provider_action() File '/usr/lib/python2.6/site-packages/resource_management/libraries/providers/properties_file.py'  line 48  in action_create mode = self.resource.mode File '/usr/lib/python2.6/site-packages/resource_management/core/base.py'  line 148  in __init__ self.env.run() File '/usr/lib/python2.6/site-packages/resource_management/core/environment.py'  line 149  in run self.run_action(resource  action) File '/usr/lib/python2.6/site-packages/resource_management/core/environment.py'  line 115  in run_action provider_action() File '/usr/lib/python2.6/site-packages/resource_management/core/providers/system.py'  line 96  in action_create content = self._get_content() File '/usr/lib/python2.6/site-packages/resource_management/core/providers/system.py'  line 136  in _get_content return content() File '/usr/lib/python2.6/site-packages/resource_management/core/source.py'  line 47  in __call__ return self.get_content() File '/usr/lib/python2.6/site-packages/resource_management/core/source.py'  line 126  in get_content rendered = self.template.render(self.context) File '/usr/lib/python2.6/site-packages/jinja2/environment.py'  line 891  in render return self.environment.handle_exception(exc_info  True) File '&lt;template&gt;'  line 2  in top-level template code File '/usr/lib/python2.6/site-packages/jinja2/filters.py'  line 176  in do_dictsort return sorted(value.items()  key=sort_func)AttributeError: 'unicode' object has no attribute 'items',0 ,0 
Global properties are not being surfaced on service config page,Post install  Global properties are not being surfaced on service config page.,0 ,0 
Populate actions drop down of Slider App details page,Slider App details page should have an actions dropdown with the following actions Freeze: show when status == RUNNING Thaw: show when status == FROZEN Flex: show when status != FINISHED Destroy: show when status == FROZENExcept for Thaw  all actions will show a confirmation dialog. Hitting OK will make the call. Destroy should call DELETE on the app endpoint Freeze and Thaw should call PUT on app endpoint app state being set to FROZEN or RUNNING.,0 ,0 
Implement app_types endpoint to provide app definitions,Slider Apps View should provide /api/v1/app_types endpoint to provide definitions of various app_types supported by this Slider Apps View. Only apps in this type can be created through UI.,0 ,0 
New slider app wizard should show app-types from /apptypes endpoint,Currently the new slider app wizard shows hardcoded app-types. We should instead show only those app-types which are returned by http://c6401:8080/api/v1/views/SLIDER/versions/1.0.0/instances/SLIDER_1/apptypes?fields=* endpoint.{ 'href' : 'http://c6401:8080/api/v1/views/SLIDER/versions/1.0.0/instances/SLIDER_1/apptypes?fields=*'  'items' : [ { 'href' : 'http://c6401:8080/api/v1/views/SLIDER/versions/1.0.0/instances/SLIDER_1/apptypes/ACCUMULO'  'id' : 'ACCUMULO'  'instance_name' : 'SLIDER_1'  'typeComponents' : [ { 'id' : 'ACCUMULO_MASTER'  'name' : 'ACCUMULO_MASTER'  'category' : 'MASTER'  'displayName' : 'ACCUMULO_MASTER'  'priority' : 1  'instanceCount' : 0  'maxInstanceCount' : 0  'yarnMemory' : 1024  'yarnCpuCores' : 1 }  { 'id' : 'ACCUMULO_MONITOR'  'name' : 'ACCUMULO_MONITOR'  'category' : 'MASTER'  'displayName' : 'ACCUMULO_MONITOR'  'priority' : 3  'instanceCount' : 0  'maxInstanceCount' : 0  'yarnMemory' : 1024  'yarnCpuCores' : 1 }  { 'id' : 'ACCUMULO_GC'  'name' : 'ACCUMULO_GC'  'category' : 'MASTER'  'displayName' : 'ACCUMULO_GC'  'priority' : 4  'instanceCount' : 0  'maxInstanceCount' : 0  'yarnMemory' : 1024  'yarnCpuCores' : 1 }  { 'id' : 'ACCUMULO_TRACER'  'name' : 'ACCUMULO_TRACER'  'category' : 'MASTER'  'displayName' : 'ACCUMULO_TRACER'  'priority' : 5  'instanceCount' : 0  'maxInstanceCount' : 0  'yarnMemory' : 1024  'yarnCpuCores' : 1 }  { 'id' : 'ACCUMULO_TSERVER'  'name' : 'ACCUMULO_TSERVER'  'category' : 'SLAVE'  'displayName' : 'ACCUMULO_TSERVER'  'priority' : 2  'instanceCount' : 0  'maxInstanceCount' : 0  'yarnMemory' : 1024  'yarnCpuCores' : 1 }  { 'id' : 'ACCUMULO_CLIENT'  'name' : 'ACCUMULO_CLIENT'  'category' : 'CLIENT'  'displayName' : 'ACCUMULO_CLIENT'  'priority' : 0  'instanceCount' : 0  'maxInstanceCount' : 0  'yarnMemory' : 1024  'yarnCpuCores' : 1 } ]  'typeDescription' : 'The Apache Accumulo sorted  distributed key/value store is a robust /n scalable  high performance data storage system that features cell-based/n access control and customizable server-side processing. It is based on/n Google's BigTable design and is built on top of Apache Hadoop /n Zookeeper  and Thrift./n Requirements:/n 1. Ensure parent dir for path (accumulo-site/instance.dfs.dir) is accessible to the App owner.'  'typeName' : 'ACCUMULO'  'typePackageFileName' : 'accumulo_v151.zip'  'typeVersion' : '1.5.1'  'version' : '1.0.0'  'view_name' : 'SLIDER'  'typeConfigs' : { 'agent.conf' : '/slider/agent/conf/agent.ini'  'application.def' : '/slider/accumulo_v151.zip'  'config_types' : 'accumulo-site'  'java_home' : '/usr/jdk64/jdk1.7.0_45'  'package_list' : 'files/accumulo-1.5.1-bin.tar.gz'  'site.accumulo-site.gc.port.client' : '0'  'site.accumulo-site.general.classpaths' : '$ACCUMULO_HOME/lib/accumulo-server.jar /n$ACCUMULO_HOME/lib/accumulo-core.jar /n$ACCUMULO_HOME/lib/accumulo-start.jar /n$ACCUMULO_HOME/lib/accumulo-fate.jar /n$ACCUMULO_HOME/lib/accumulo-proxy.jar /n$ACCUMULO_HOME/lib/[^.].*.jar /n$ZOOKEEPER_HOME/zookeeper[^.].*.jar /n$HADOOP_CONF_DIR /n$HADOOP_PREFIX/[^.].*.jar /n$HADOOP_PREFIX/lib/[^.].*.jar /n$HADOOP_PREFIX/share/hadoop/common/.*.jar /n$HADOOP_PREFIX/share/hadoop/common/lib/.*.jar /n$HADOOP_PREFIX/share/hadoop/hdfs/.*.jar /n$HADOOP_PREFIX/share/hadoop/mapreduce/.*.jar /n$HADOOP_PREFIX/share/hadoop/yarn/.*.jar /n/usr/lib/hadoop/.*.jar /n/usr/lib/hadoop/lib/.*.jar /n/usr/lib/hadoop-hdfs/.*.jar /n/usr/lib/hadoop-mapreduce/.*.jar /n/usr/lib/hadoop-yarn/.*.jar '  'site.accumulo-site.instance.dfs.dir' : '/apps/accumulo/data'  'site.accumulo-site.instance.secret' : 'DEFAULT'  'site.accumulo-site.instance.zookeeper.host' : '${ZK_HOST}'  'site.accumulo-site.master.port.client' : '0'  'site.accumulo-site.monitor.port.client' : '${ACCUMULO_MONITOR.ALLOCATED_PORT}'  'site.accumulo-site.monitor.port.log4j' : '0'  'site.accumulo-site.trace.port.client' : '0'  'site.accumulo-site.trace.token.property.password' : 'secret'  'site.accumulo-site.trace.user' : 'root'  'site.accumulo-site.tserver.cache.data.size' : '7M'  'site.accumulo-site.tserver.cache.index.size' : '20M'  'site.accumulo-site.tserver.memory.maps.max' : '80M'  'site.accumulo-site.tserver.port.client' : '0'  'site.accumulo-site.tserver.sort.buffer.size' : '50M'  'site.accumulo-site.tserver.walog.max.size' : '100M'  'site.global.accumulo_instance_name' : 'instancename'  'site.global.accumulo_root_password' : 'secret'  'site.global.app_install_dir' : '${AGENT_WORK_ROOT}/app/install'  'site.global.app_log_dir' : '${AGENT_LOG_ROOT}/app/log'  'site.global.app_pid_dir' : '${AGENT_WORK_ROOT}/app/run'  'site.global.app_root' : '${AGENT_WORK_ROOT}/app/install/accumulo-1.5.1'  'site.global.app_user' : 'yarn'  'site.global.gc_heapsize' : '64m'  'site.global.hadoop_conf_dir' : '/etc/hadoop/conf'  'site.global.hadoop_prefix' : '/usr/lib/hadoop'  'site.global.master_heapsize' : '128m'  'site.global.monitor_heapsize' : '64m'  'site.global.other_heapsize' : '128m'  'site.global.security_enabled' : 'false'  'site.global.tserver_heapsize' : '128m'  'site.global.user_group' : 'hadoop'  'site.global.zookeeper_home' : '/usr/lib/zookeeper' } }  { 'href' : 'http://c6401:8080/api/v1/views/SLIDER/versions/1.0.0/instances/SLIDER_1/apptypes/HBASE'  'id' : 'HBASE'  'instance_name' : 'SLIDER_1'  'typeComponents' : [ { 'id' : 'HBASE_MASTER'  'name' : 'HBASE_MASTER'  'category' : 'MASTER'  'displayName' : 'HBASE_MASTER'  'priority' : 1  'instanceCount' : 1  'maxInstanceCount' : 2  'yarnMemory' : 1024  'yarnCpuCores' : 1 }  { 'id' : 'HBASE_REGIONSERVER'  'name' : 'HBASE_REGIONSERVER'  'category' : 'SLAVE'  'displayName' : 'HBASE_REGIONSERVER'  'priority' : 2  'instanceCount' : 1  'maxInstanceCount' : 0  'yarnMemory' : 1024  'yarnCpuCores' : 1 }  { 'id' : 'HBASE_CLIENT'  'name' : 'HBASE_CLIENT'  'category' : 'CLIENT'  'displayName' : 'HBASE_CLIENT'  'priority' : 0  'instanceCount' : 0  'maxInstanceCount' : 0  'yarnMemory' : 1024  'yarnCpuCores' : 1 } ]  'typeDescription' : 'Apache HBase is the Hadoop database  a distributed  scalable  big data store./n Requirements:/n 1. Ensure parent dir for path (hbase-site/hbase.rootdir) is accessible to the App owner./n 2. Ensure ZK root (hbase-site/zookeeper.znode.parent) is unique for the App instance.'  'typeName' : 'HBASE'  'typePackageFileName' : 'hbase_v096 (1).zip'  'typeVersion' : '0.96.0.2.1.1'  'version' : '1.0.0'  'view_name' : 'SLIDER'  'typeConfigs' : { 'agent.conf' : '/slider/agent/conf/agent.ini'  'application.def' : '/slider/hbase_v096.zip'  'config_types' : 'core-site hdfs-site hbase-site'  'java_home' : '/usr/jdk64/jdk1.7.0_45'  'package_list' : 'files/hbase-0.96.1-hadoop2-bin.tar.gz'  'site.core-site.fs.defaultFS' : '${NN_URI}'  'site.global.app_install_dir' : '${AGENT_WORK_ROOT}/app/install'  'site.global.app_log_dir' : '${AGENT_LOG_ROOT}/app/log'  'site.global.app_pid_dir' : '${AGENT_WORK_ROOT}/app/run'  'site.global.app_root' : '${AGENT_WORK_ROOT}/app/install/hbase-0.96.1-hadoop2'  'site.global.app_user' : 'yarn'  'site.global.ganglia_server_host' : '${NN_HOST}'  'site.global.ganglia_server_id' : 'Application1'  'site.global.ganglia_server_port' : '8667'  'site.global.hbase_master_heapsize' : '1024m'  'site.global.hbase_regionserver_heapsize' : '1024m'  'site.global.security_enabled' : 'false'  'site.global.user_group' : 'hadoop'  'site.hbase-site.hbase.client.keyvalue.maxsize' : '10485760'  'site.hbase-site.hbase.client.scanner.caching' : '100'  'site.hbase-site.hbase.cluster.distributed' : 'true'  'site.hbase-site.hbase.defaults.for.version.skip' : 'true'  'site.hbase-site.hbase.hregion.majorcompaction' : '86400000'  'site.hbase-site.hbase.hregion.max.filesize' : '10737418240'  'site.hbase-site.hbase.hregion.memstore.block.multiplier' : '2'  'site.hbase-site.hbase.hregion.memstore.flush.size' : '134217728'  'site.hbase-site.hbase.hregion.memstore.mslab.enabled' : 'true'  'site.hbase-site.hbase.hstore.blockingStoreFiles' : '10'  'site.hbase-site.hbase.hstore.compactionThreshold' : '3'  'site.hbase-site.hbase.hstore.flush.retries.number' : '120'  'site.hbase-site.hbase.local.dir' : '${hbase.tmp.dir}/local'  'site.hbase-site.hbase.master.info.port' : '${HBASE_MASTER.ALLOCATED_PORT}'  'site.hbase-site.hbase.regionserver.global.memstore.lowerLimit' : '0.38'  'site.hbase-site.hbase.regionserver.global.memstore.upperLimit' : '0.4'  'site.hbase-site.hbase.regionserver.handler.count' : '60'  'site.hbase-site.hbase.regionserver.info.port' : '0'  'site.hbase-site.hbase.regionserver.port' : '0'  'site.hbase-site.hbase.rootdir' : '${NN_URI}/apps/hbase/data'  'site.hbase-site.hbase.security.authentication' : 'simple'  'site.hbase-site.hbase.security.authorization' : 'false'  'site.hbase-site.hbase.stagingdir' : '${NN_URI}/apps/hbase/staging'  'site.hbase-site.hbase.superuser' : 'yarn'  'site.hbase-site.hbase.tmp.dir' : '${AGENT_WORK_ROOT}/work/app/tmp'  'site.hbase-site.hbase.zookeeper.property.clientPort' : '2181'  'site.hbase-site.hbase.zookeeper.quorum' : '${ZK_HOST}'  'site.hbase-site.hbase.zookeeper.useMulti' : 'true'  'site.hbase-site.hfile.block.cache.size' : '0.40'  'site.hbase-site.zookeeper.session.timeout' : '30000'  'site.hbase-site.zookeeper.znode.parent' : '/hbase-unsecure'  'site.hdfs-site.dfs.namenode.http-address' : '${NN_HOST}:50070'  'site.hdfs-site.dfs.namenode.https-address' : '${NN_HOST}:50470' } }  { 'href' : 'http://c6401:8080/api/v1/views/SLIDER/versions/1.0.0/instances/SLIDER_1/apptypes/STORM'  'id' : 'STORM'  'instance_name' : 'SLIDER_1'  'typeComponents' : [ { 'id' : 'NIMBUS'  'name' : 'NIMBUS'  'category' : 'MASTER'  'displayName' : 'NIMBUS'  'priority' : 1  'instanceCount' : 0  'maxInstanceCount' : 0  'yarnMemory' : 1024  'yarnCpuCores' : 1 }  { 'id' : 'STORM_REST_API'  'name' : 'STORM_REST_API'  'category' : 'MASTER'  'displayName' : 'STORM_REST_API'  'priority' : 2  'instanceCount' : 0  'maxInstanceCount' : 0  'yarnMemory' : 1024  'yarnCpuCores' : 1 }  { 'id' : 'SUPERVISOR'  'name' : 'SUPERVISOR'  'category' : 'SLAVE'  'displayName' : 'SUPERVISOR'  'priority' : 5  'instanceCount' : 0  'maxInstanceCount' : 0  'yarnMemory' : 1024  'yarnCpuCores' : 1 }  { 'id' : 'STORM_UI_SERVER'  'name' : 'STORM_UI_SERVER'  'category' : 'MASTER'  'displayName' : 'STORM_UI_SERVER'  'priority' : 3  'instanceCount' : 0  'maxInstanceCount' : 0  'yarnMemory' : 1024  'yarnCpuCores' : 1 }  { 'id' : 'DRPC_SERVER'  'name' : 'DRPC_SERVER'  'category' : 'MASTER'  'displayName' : 'DRPC_SERVER'  'priority' : 4  'instanceCount' : 0  'maxInstanceCount' : 0  'yarnMemory' : 1024  'yarnCpuCores' : 1 } ]  'typeDescription' : 'Apache Hadoop Stream processing framework'  'typeName' : 'STORM'  'typePackageFileName' : 'storm_v091.zip'  'typeVersion' : '0.9.1.2.1'  'version' : '1.0.0'  'view_name' : 'SLIDER'  'typeConfigs' : { 'agent.conf' : '/slider/agent/conf/agent.ini'  'application.def' : '/slider/storm_v091.zip'  'config_types' : 'storm-site'  'java_home' : '/usr/jdk64/jdk1.7.0_45'  'package_list' : 'files/apache-storm-0.9.1.2.1.1.0-237.tar.gz'  'site.global.app_root' : '${AGENT_WORK_ROOT}/app/install/apache-storm-0.9.1.2.1.1.0-237'  'site.global.app_user' : 'yarn'  'site.global.ganglia_server_host' : '${NN_HOST}'  'site.global.ganglia_server_id' : 'Application2'  'site.global.rest_api_admin_port' : '${STORM_REST_API.ALLOCATED_PORT}'  'site.global.rest_api_port' : '${STORM_REST_API.ALLOCATED_PORT}'  'site.global.security_enabled' : 'false'  'site.global.user_group' : 'hadoop'  'site.storm-site.dev.zookeeper.path' : '${AGENT_WORK_ROOT}/app/tmp/dev-storm-zookeeper'  'site.storm-site.drpc.childopts' : '-Xmx768m'  'site.storm-site.drpc.invocations.port' : '${DRPC_SERVER.ALLOCATED_PORT}'  'site.storm-site.drpc.port' : '${DRPC_SERVER.ALLOCATED_PORT}'  'site.storm-site.drpc.queue.size' : '128'  'site.storm-site.drpc.request.timeout.secs' : '600'  'site.storm-site.drpc.worker.threads' : '64'  'site.storm-site.java.library.path' : '/usr/local/lib:/opt/local/lib:/usr/lib'  'site.storm-site.logviewer.appender.name' : 'A1'  'site.storm-site.logviewer.childopts' : '-Xmx128m'  'site.storm-site.logviewer.port' : '${SUPERVISOR.ALLOCATED_PORT}'  'site.storm-site.nimbus.childopts' : '-Xmx1024m -Djava.security.auth.login.config=/etc/storm/storm_jaas.conf -javaagent:${AGENT_WORK_ROOT}/app/install/apache-storm-0.9.1.2.1.1.0-237/contrib/storm-jmxetric/lib/jmxetric-1.0.4.jar=host={0} port=8669 wireformat31x=true mode=multicast config=${AGENT_WORK_ROOT}/app/install/apache-storm-0.9.1.2.1.1.0-237/contrib/storm-jmxetric/conf/jmxetric-conf.xml process=Nimbus_JVM'  'site.storm-site.nimbus.cleanup.inbox.freq.secs' : '600'  'site.storm-site.nimbus.file.copy.expiration.secs' : '600'  'site.storm-site.nimbus.host' : '${NIMBUS_HOST}'  'site.storm-site.nimbus.inbox.jar.expiration.secs' : '3600'  'site.storm-site.nimbus.monitor.freq.secs' : '10'  'site.storm-site.nimbus.reassign' : 'true'  'site.storm-site.nimbus.supervisor.timeout.secs' : '60'  'site.storm-site.nimbus.task.launch.secs' : '120'  'site.storm-site.nimbus.task.timeout.secs' : '30'  'site.storm-site.nimbus.thrift.max_buffer_size' : '1048576'  'site.storm-site.nimbus.thrift.port' : '${NIMBUS.ALLOCATED_PORT}'  'site.storm-site.nimbus.topology.validator' : 'backtype.storm.nimbus.DefaultTopologyValidator'  'site.storm-site.storm.cluster.mode' : 'distributed'  'site.storm-site.storm.local.dir' : '${AGENT_WORK_ROOT}/app/tmp/storm'  'site.storm-site.storm.local.mode.zmq' : 'false'  'site.storm-site.storm.messaging.netty.buffer_size' : '5242880'  'site.storm-site.storm.messaging.netty.client_worker_threads' : '1'  'site.storm-site.storm.messaging.netty.max_retries' : '30'  'site.storm-site.storm.messaging.netty.max_wait_ms' : '1000'  'site.storm-site.storm.messaging.netty.min_wait_ms' : '100'  'site.storm-site.storm.messaging.netty.server_worker_threads' : '1'  'site.storm-site.storm.messaging.transport' : 'backtype.storm.messaging.netty.Context'  'site.storm-site.storm.thrift.transport' : 'backtype.storm.security.auth.SimpleTransportPlugin'  'site.storm-site.storm.zookeeper.connection.timeout' : '15000'  'site.storm-site.storm.zookeeper.port' : '2181'  'site.storm-site.storm.zookeeper.retry.interval' : '1000'  'site.storm-site.storm.zookeeper.retry.intervalceiling.millis' : '30000'  'site.storm-site.storm.zookeeper.retry.times' : '5'  'site.storm-site.storm.zookeeper.root' : '/storm'  'site.storm-site.storm.zookeeper.servers' : '['${ZK_HOST}']'  'site.storm-site.storm.zookeeper.session.timeout' : '20000'  'site.storm-site.supervisor.childopts' : '-Xmx256m -Djava.security.auth.login.config=/etc/storm/storm_jaas.conf -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.port=${SUPERVISOR.ALLOCATED_PORT} -javaagent:${AGENT_WORK_ROOT}/app/install/apache-storm-0.9.1.2.1.1.0-237/contrib/storm-jmxetric/lib/jmxetric-1.0.4.jar=host={0} port=8669 wireformat31x=true mode=multicast config=${AGENT_WORK_ROOT}/app/install/apache-storm-0.9.1.2.1.1.0-237/contrib/storm-jmxetric/conf/jmxetric-conf.xml process=Supervisor_JVM'  'site.storm-site.supervisor.enable' : 'true'  'site.storm-site.supervisor.heartbeat.frequency.secs' : '5'  'site.storm-site.supervisor.monitor.frequency.secs' : '3'  'site.storm-site.supervisor.slots.ports' : '[${SUPERVISOR.ALLOCATED_PORT}  ${SUPERVISOR.ALLOCATED_PORT}]'  'site.storm-site.supervisor.worker.start.timeout.secs' : '120'  'site.storm-site.supervisor.worker.timeout.secs' : '30'  'site.storm-site.task.heartbeat.frequency.secs' : '3'  'site.storm-site.task.refresh.poll.secs' : '10'  'site.storm-site.topology.acker.executors' : 'null'  'site.storm-site.topology.builtin.metrics.bucket.size.secs' : '60'  'site.storm-site.topology.debug' : 'false'  'site.storm-site.topology.disruptor.wait.strategy' : 'com.lmax.disruptor.BlockingWaitStrategy'  'site.storm-site.topology.enable.message.timeouts' : 'true'  'site.storm-site.topology.error.throttle.interval.secs' : '10'  'site.storm-site.topology.executor.receive.buffer.size' : '1024'  'site.storm-site.topology.executor.send.buffer.size' : '1024'  'site.storm-site.topology.fall.back.on.java.serialization' : 'true'  'site.storm-site.topology.kryo.factory' : 'backtype.storm.serialization.DefaultKryoFactory'  'site.storm-site.topology.max.error.report.per.interval' : '5'  'site.storm-site.topology.max.spout.pending' : 'null'  'site.storm-site.topology.max.task.parallelism' : 'null'  'site.storm-site.topology.message.timeout.secs' : '30'  'site.storm-site.topology.optimize' : 'true'  'site.storm-site.topology.receiver.buffer.size' : '8'  'site.storm-site.topology.skip.missing.kryo.registrations' : 'false'  'site.storm-site.topology.sleep.spout.wait.strategy.time.ms' : '1'  'site.storm-site.topology.spout.wait.strategy' : 'backtype.storm.spout.SleepSpoutWaitStrategy'  'site.storm-site.topology.state.synchronization.timeout.secs' : '60'  'site.storm-site.topology.stats.sample.rate' : '0.05'  'site.storm-site.topology.tick.tuple.freq.secs' : 'null'  'site.storm-site.topology.transfer.buffer.size' : '1024'  'site.storm-site.topology.trident.batch.emit.interval.millis' : '500'  'site.storm-site.topology.tuple.serializer' : 'backtype.storm.serialization.types.ListDelegateSerializer'  'site.storm-site.topology.worker.childopts' : 'null'  'site.storm-site.topology.worker.shared.thread.pool.size' : '4'  'site.storm-site.topology.workers' : '1'  'site.storm-site.transactional.zookeeper.port' : 'null'  'site.storm-site.transactional.zookeeper.root' : '/transactional'  'site.storm-site.transactional.zookeeper.servers' : 'null'  'site.storm-site.ui.port' : '${STORM_UI_SERVER.ALLOCATED_PORT}'  'site.storm-site.worker.childopts' : '-Xmx768m -javaagent:${AGENT_WORK_ROOT}/app/install/apache-storm-0.9.1.2.1.1.0-237/contrib/storm-jmxetric/lib/jmxetric-1.0.4.jar=host={0} port=8669 wireformat31x=true mode=multicast config=${AGENT_WORK_ROOT}/app/install/apache-storm-0.9.1.2.1.1.0-237/contrib/storm-jmxetric/conf/jmxetric-conf.xml process=Worker_%ID%_JVM'  'site.storm-site.worker.heartbeat.frequency.secs' : '1'  'site.storm-site.zmq.hwm' : '0'  'site.storm-site.zmq.linger.millis' : '5000'  'site.storm-site.zmq.threads' : '1' } } ]},0 ,0 
Suppress any debug and info messages from package managers in setupAgent.py,During bootstrapping of agents  installation retrieve versions of available packages from system package manager. After some test was founded that in different situations package managers can produce specific info/debug output which can be reason of wrong parsing of output.Example:Zypper command:se2mon1400652583-9:/etc/zypp/repos.d # zypper search -s --match-exact ambari-agent Building repository 'Hortonworks Data Platform Utils Version - HDP-UTILS-1.1.0.16' cache &#91;done&#93;Building repository 'Hortonworks Data Platform Utils Version - HDP-UTILS-1.1.0.17' cache &#91;done&#93;Building repository 'Hosted (SLES_11)' cache &#91;done&#93;Building repository 'ambari-1.6.0 - Updates' cache &#91;done&#93;Building repository 'Ambari 1.x' cache &#91;done&#93;Building repository 'PostgreSQL and related packages (SLE_11_SP3)' cache &#91;done&#93;Loading repository data...Reading installed packages...S | Name | Type | Version | Arch | Repository -----------------------------------+---------------------- ambari-agent  package  1.6.0-46  x86_64  ambari-1.6.0 - Updates ambari-agent  package  1.2.0.1-1  x86_64  Ambari 1.xParsed as: Building repository 'ambari-1.6.0 We should suppress any debug/info output in setupAgent.py to avoid any unexpected situation.,0 ,0 
View: Files UI clean-up and adjustments (PART 2),As a part of this ticket 1) Remove rename icon from infront of the file and make it a different column.2) reorder the icon bar in the sequence Download  Move  Rename and Delete,0 ,0 
Predicates don't work on fields with float values,API should be able to process filter with predicates(&lt; &gt; =) for fields with float values; For example field: metrics/load/load_one.Currently the Greater than predicate will fail for values in between 0.0 and 1.0,0 ,0 
Some HBase properties are empty  but required to be filled,This HBase properties are empty after install via blueprint: hbase.coprocessor.region.classes hbase.coprocessor.master.classesBut they required to be filled.After enabling security they became filled.,0 ,0 
Slider apps table does not remove entry when app is removed,Lets say I have a running app. I freeze it and then destroy it. The app goes away from the /apps response. However the UI still continues to show it. I think the mapper is not removing deleted entries from the model.Mapper should remove entries not being sent by /apps.,0 ,0 
Maintenance state and status commands perf improvements.,getEffectiveState should not fetch map of all hosts every time Status commands should not be sent until component is installed,0 ,0 
Ambari should generate config files in sorted order,Ambari should generate config files sorted by key. It would make doing compares between files much easier.,0 ,0 
DB connection check error if jdk_name does not exist.,We can get such situation when user using custom java.,0 ,0 
Bootstrap API call says bootstrap is running even though all agents have installed and registered,UI keeps showing that the agents are being installed  because the bootstrap API GET call keeps returning that hostsStatus/status is RUNNINGI suspected time.sleep(1) instruction. If restart takes too long time  situation  when ambari-agent.log has not been created yet is possible. So  tail command returned not 0 retcode and exit from procedure. But in logs I cant see any non-zero retcodes. Thus  too short logs could be explaned by this issue.,0 ,0 
Add support for auth proxy,When using a proxy for internet access  add support to set properties for proxy user and password.窶・Dhttp.proxyUser=someUserName -Dhttp.proxyPassword=somePassword窶・,0 ,0 
Storm UI in Ambari quick link fails when Storm UI server is not co-hosted with nimbus host,quick link for Storm UI was linked with nimbus server. it should use Storm UI server host.,0 ,0 
metrics hostname is not correct for storm,Some of the storm configs have extra 'localhost' appended to the host name.'nimbus.childopts' : '-Xmx1024m -Djava.security.auth.login.config=/etc/storm/conf/storm_jaas.conf -javaagent:/usr/lib/storm/contrib/storm-jmxetric/lib/jmxetric-1.0.4.jar=host=c6401.ambari.apache.orglocalhost port=8649 wireformat31x=true mode=multicast config=/usr/lib/storm/contrib/storm-jmxetric/conf/jmxetric-conf.xml process=Nimbus_JVM''supervisor.childopts' : '-Xmx256m -Djava.security.auth.login.config=/etc/storm/conf/storm_jaas.conf -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.port=56431 -javaagent:/usr/lib/storm/contrib/storm-jmxetric/lib/jmxetric-1.0.4.jar=host=c6401.ambari.apache.orglocalhost port=8650 wireformat31x=true mode=multicast config=/usr/lib/storm/contrib/storm-jmxetric/conf/jmxetric-conf.xml process=Supervisor_JVM''worker.childopts' : '-Xmx768m -javaagent:/usr/lib/storm/contrib/storm-jmxetric/lib/jmxetric-1.0.4.jar=host=c6401.ambari.apache.orglocalhost port=8650 wireformat31x=true mode=multicast config=/usr/lib/storm/contrib/storm-jmxetric/conf/jmxetric-conf.xml process=Worker_%ID%_JVM',0 ,0 
HDFS alert hangs for a long time after enabling Maintenance mode,STR: Stop HDFS with started Nagios service. Turn on Maintenance mode for HDFS.Result: All alerts dissapear  except 'HDFS capacity utilization' - it hangs for a long time (in my case it was smthng about 10-11 minutes),0 ,1 
Services -> Configs page for Yarn  HIVE  MapReduce services is not displayed,Config page for services that use App.YARNDefaultsProvider is not displayed.Following JS error thrown:Uncaught TypeError: Cannot call method 'forEach' of null yarn_defaults_provider.js:291,0 ,0 
Issues with jdbc properties,remove dots in --help params description and in warningscopy fails if jdbc selected by --jdbc-driver is already in resourceshide other points of ambari-server setup if jdbc options are passed and server is running,0 ,0 
Master components are missing,Master components info is missing in service summary.,0 ,0 
Ambari Agent script should check for running processes before starting,PROBLEM: If the Ambari Agent installation fails for whatever reason then a process of ambari-agent is left running. This results in the ambari-agent status to show as it not running. If you then start another ambari-agent it dies because the port is already in use.If the script could check the PID file and check for a running process then it would resolve this issue.BUSINESS IMPACT: Not a huge business impact as the workaround is to kill the running ambari-agent processWorkaround: Kill running ambari-agent process before startingANALYSIS: I cannot reproduce this issue in house and the SE who raised it can not reproduce on demand.,0 ,1 
Add Host wizard get stuck on Confirm Hosts step,,0 ,0 
Agent Custom Command Output Coerces Integers to Floats,When posting a command such as{ 'RequestInfo': { 'action': 'check_host'  'context': 'Check host'  'parameters': { 'check_execute_list': 'host_resolution_check'  'hosts': 'c6401.ambari.apache.org  c6402.ambari.apache.org  c6403.ambari.apache.org  foobar'  'threshold': '20' } }  'Requests/resource_filters': [ { 'hosts': 'c6401.ambari.apache.org c6402.ambari.apache.org' } ]The returned result from the custom action has some integer values coerced into floats: 'structured_out' : { 'host_resolution_check' : { 'exit_code' : '0'  'failed_count' : 0.0  'failures' : [ ]  'message' : 'All hosts resolved to an IP address.'  'success_count' : 4.0 }The structured_output written out to disk does NOT have the float values:{'host_resolution_check': {'failures': []  'message': 'All hosts resolved to an IP address.'  'failed_count': 0  'success_count': 4  'exit_code': '0'}} Therefore this is a problem with the framework and not the command.,0 ,0 
Add refreshQueues custom command to YARN service,Call refreshqueues from the REST API (replace resource.manager.host and YourClusterName). And be sure to include header 'X-Requested-By' : 'ambari' and set authentication.POST/api/v1/clusters/YourClusterName/requests/{ 'RequestInfo' : { 'command' : 'REFRESHQUEUES'  'context' : 'Refresh YARN Capacity Scheduler' }  'Requests/resource_filters': [{ 'service_name' : 'YARN'  'component_name' : 'RESOURCEMANAGER'  'hosts' : 'resource.manager.host' }]},0 ,0 
'ambari-server start command' hangs if was executed via ssh command,Problem:Ambari Server command 'ssh root@vmhost ambari-server start' hangs on message 'Ambari Server 'start' completed successfully.'. Same command executed successfully on the local console  as a result this behavior can be reproduced only via remote execution of commands.How to reproduce: Deploy server Stop server locally Start server from another host using ssh command,0 ,0 
Hosts Components filter on Service summary page doesn't work,When user clicks on some component filter on Service summary page  it opens hosts page  but filter is not applied.,0 ,0 
Multiple ATS appear on YARN summary page,STR1. Go to add Service Wizard.2. Select some new services and proceed to deploy.3. Close Wizard (Esc-button).4. Wait a little bit (maybe page-refresh needed).5. Go to YARN summary.6. New 'none' components will appear periodically.See screenshot.,0 ,0 
Customize the Hadoop metrics sink to write to MySQL store,The SqlServerSink should support pushing metrics to MySQL store.This Jira addresses changes needed to support sink to a MySQL store.,0 ,0 
Filter by alerts fails on Hosts table,Steps to reproduce:1. Go to Hosts page2. Choose filter AlertsResult:Hosts are not filtered by alerts.The request with filter by alerts has incorrect url data.,0 ,0 
Nagios install fails on SLES due to php5-json not available,Using SLES 11 SP3 quick-start image on EC2. Doesn't look like php5-json is available  but php53-json is available.WORKAROUND:I modified NAGIOS/metainfo.xml and this worked. &lt;package&gt; &lt;name&gt;php5*-json&lt;/name&gt; &lt;/package&gt;,0 ,0 
issues with dialog keypresses,1) on 'manage config groups' pressing return does something even though return is not valid (i.e. can't save)2) Once you press return in #1  then you have to press esc twice to close the dialog3) once you open the nested dialog (to add a group)  esc closes the parent  then esc again  closes the nested dialog4) once you open the nested dialog  also notice it doesn't start focus on the name field  you have to click to get that focus.,0 ,0 
Ambari Groovy client enhancements,Ambari REST client (Groovy) enhancements -refactor - simplified unit tests taking leverage groovy's metaclass capabilities-more REST calls implemented-api compatibility with version 1.6.0,0 ,0 
Bulk operations confirmation popup,Hosts page  'Actions' menu (dropdown)Each action shows confirmation popup with list of affected hosts.For big cluster this may be 2000+ hosts.If there are more than 3 hosts  then show 'host1  host2  host3  and X more hosts show all',0 ,0 
Step3. Hosts checks requests,Proceed to step3  wait while registration is complete.Host checks requests are set every second.UI should set next request only when previous is completed.,0 ,0 
It's not possible to input 'Enter' on 'Target hosts' textarea on 2nd step of Installer wizard',It's not possible to input 'Enter' on 'Target hosts' textarea.,0 ,0 
Ambari Dashboard page  click NameNode link returns wrong page,STR:1. go to dashboard page2. click NameNode link inside HDFS Links widget.instead of go to NameNode host detail page  it returns an empty page,0 ,0 
JS error on POST config group request (step7 installer),Go to installer step7Click override for some propertySelect 'New Config Group'Click 'OK'JS-error appears - 404 error. Missing clusterName in request URL.,0 ,0 
Behavior change: host filtering no longer handles startsWith matches,If I have a host that has IP 10.0.2.15  in Ambari 1.6.0 if I start to filter by IP (by typing 10.0....)  the hosts that match 'startsWith' stay displayed.In Ambari 1.6.1  now it only does exact match  so once I start typing  all hosts disappear until I finally type the whole thing in for exact match.Hosts/ip.matches(10),0 ,0 
Installer wizard: ambari web-client issues invalid requests after switching stacks,Steps To Reproduce Select 2.X stack and go ahead to 'Select Services' page Navigate back to 'Select Stack' page and select 1.x stack Go ahead to step-8 'Review' page. On clicking next  API call to create components for HDFS service fails with UI displaying an error message.Invalid Request: Unsupported or invalid component in stack  clusterName=cc  serviceName=HDFS  componentName=JOURNALNODE  stackInfo=HDP-1.3,0 ,0 
Incorrect value for started_count of Datanode component,STR:  Installed a 3-node cluster for HDP 1.3 stack HDFS+MapReduce+Nagios+Ganglia+zooKeeper installed with slave components installed on all 3 hosts. Enable security with no kerberos setup On expected failure of security wizard  Disable security. After successfully disabling security  Following API returns incorrect number for started_count of Datanode. It says 0 but Datanode is actually running on all hostshttp://server:8080/api/v1/clusters/c1/components/?ServiceComponentInfo/category.in(SLAVE CLIENT)&amp;fields=ServiceComponentInfo/service_name ServiceComponentInfo/installed_count ServiceComponentInfo/started_count ServiceComponentInfo/total_count&amp;minimal_response=trueReason:During wrong kerberos setup DN processes fail to start  but leave stale pid file owned by root. Next one DN start command starts DN process  but can not override pid file. So the server considers DN as stopped. If we start DN once more  commands fail soon after start (due to lock file at data dir owned by already running DN). Agent reports to server that DN is not running  so server displays a correct information from his point of view.,0 ,0 
Unsuitable height of dropdown menu on metrics page,STR:Delete all widgets from dashboard.Go to Metrics-&gt;Add menu.Result: Appeared inappropriate dropdown: bad_metrics.png,0 ,0 
Decommissioned running DataNode has 'delete' menu item in action pulldown,Delete operation is not allowed for a hostComponent if it is in STARTED state.Currently delete menu item is shown when a hostComponent is flagged decommissioned and in STARTED state. Performing delete operation in this condition returns API 500 server error. If the hostComponent is brought in INSTALLED state with the decommissioned flag and then delete operation is performed then it happens as expectedDelete menu item should be shown When hostComponent is in INSTALLED state and should be grayed when it is in STARTED state. ambari-web client should not consider decommission status of a hostComponent while validating the required condition to enable/disable 'delete' menu item.,0 ,0 
ListBoxes with hostnames on 'Select Hosts' page of 'Enable NameNode HA Wizard' do not work,On the second step of HA 'Enable NameNode HA Wizard' do not work listboxes with hostnames. Real additional components position does not depend from values in listboxes (see screenshots).It is possible to choose any host in any listbox  which is incorrect.,0 ,0 
Fix sub-resource names in /stacks API,The /stacks api uses sub-resource names such as stackServices and serviceComponents instead of services and components which are the names of the resources specified in the URL. These incorrect resource names would need to be used in any queries for stack resources.For example:To get stack service named HDFS the URL would be:api/v1/stacks/HDP/versions/2.1/services/HDFSBut  if we wanted to do a query of for HDFS services across all versions:api/v1/stacks/HDP/versions?stackServices/StackServices/service_name=HDFSInstead this should be:api/v1/stacks/HDP/versions?services/StackServices/service_name=HDFSFix all sub-resource names that are returned and fix sub-resource names used in queries and partial response.,0 ,0 
Unable to assign host in HA wizard,STR:1. Open HA wizard2. Proceed to Select Host step3. Try to select host for any master componentResult:nothing changing  js error emerge.,0 ,0 
BGO popup: Incorrect number of tasks in category,Tasks with 'aborted' status are not included in any 'Aborted' category.,0 ,0 
Installer Wizard Step 7-8: namenode_heapsize property incorrect value.,On the Step 7 namenode_heapsize value is empty and on deploy even if its value filled it saved as 'm' which cause error on NameNode startup.Part of object passed for configuration saving:namenode_heapsize: 'm'namenode_opt_maxnewsize: '200m'namenode_opt_newsize: '200m'nodemanager_heapsize: '1024',0 ,0 
Nagios 'Restart all components' button does not work,On service page for Nagios  under 'Service actions' menu  'Restart all' operation does not work correctly. There is dialog window after pressing  but after confirmation there is not any activity. In API there is not any new request.Note: described situation relates only for Nagios. Other services make restart correctly (including generating new requests in API).,0 ,0 
Default add host sequence triggers many unseen before cluster-wide operations,I've added 1 host through the add host wizardon deploy step all hosts were present. and install operations were performed on all of them.,0 ,0 
Ambari Server reset show wrong commands for DB manipulation,When performing ambari-server reset with external DB  ambari-server does nothing but outputs commands for resetting it manually.But:1. Commands are wrong  at least on Suse:su -postgres --command=psql -f /var/lib/ambari-server/resources/Ambari-DDL-Postgres-DROP.sql -v username=''ambari'' -v password=''bigdata''su: invalid option -- 'o'Try 'su --help' for more information.2. This commands should take in account that external DB can be located on the another host.3. Maybe the best option would be to give user ability to reset automatically  for example via command line switch like ambari-server reset -a,0 ,0 
host checks 'Show Report' link is missing from dialog,On 'Confirm Hosts' step &gt; Hosts Check popup window  the 'Show Reports' link is missing even if the host check warnings existed.Reason:The newly added hosts checks (jdk  disk  repo and hostNameResolution) dont trigger the ''show reports' link to show up.,0 ,0 
Security issue - private key password show in logs,During generating private key and certificates using openssl password of key shown in logs:11:21:30 735 INFO [main] ShellCommandUtil:44 - Command openssl genrsa -des3 -passout pass:**** -out /var/lib/ambari-server/keys/ca.key 4096 was finished with exit code: 0 - the operation was completely successfully.11:21:30 750 INFO [main] ShellCommandUtil:44 - Command openssl req -passin pass:**** -new -key /var/lib/ambari-server/keys/ca.key -out /var/lib/ambari-server/keys/ca.csr -batch was finished with exit code: 0 - the operation was completely successfully.11:21:30 766 INFO [main] ShellCommandUtil:44 - Command open**** ca -create_serial -out /var/lib/ambari-server/keys/ca.crt -days 365 -keyfile /var/lib/ambari-server/keys/ca.key -key vgGAzzSaCPkI3F7UU7qZZY6CahDUTSnY7B9a8TH0YiGDB10LdJ -selfsign -extensions jdk7_ca -config /var/lib/ambari-server/keys/ca.config -batch -infiles /var/lib/ambari-server/keys/ca.csr was finished with exit code: 0 - the operation was completely successfully.11:21:30 773 INFO [main] ShellCommandUtil:44 - Command openssl pkcs12 -export -in /var/lib/ambari-server/keys/ca.crt -inkey /var/lib/ambari-server/keys/ca.key -certfile /var/lib/ambari-server/keys/ca.crt -out /var/lib/ambari-server/keys/keystore.p12 -password pass:**** -passin pass:**** see '-key vgGAzzSaCPkI3F7UU7qZZY6CahDUTSnY7B9a8TH0YiGDB10LdJ',1 ,0 
Hosts page: there is no indication that filtering/sorting/paging is happening or not (confusing),In 1.6.1  filtering/sorting/paging on the Hosts page has been converted from client-side to server-side in order to address scalability issues.As a result of that  the responsiveness of UI is dependent upon how quickly the server can respond to filtering/sorting/paging calls (and also depends on the network). While UI is waiting for the new table content to come from the server  there should be some indication that work is in progress. For example  we can put an overlay on the table with a spinner (gray out the table with a spinner on top - kind of like when switching filters on JIRA's Agile Board).,0 ,0 
Restart icon is present after Service Actions->Restart all button click.,STR:Change property for some service (Hive as example)Save changesClick Service Actions-&gt;Restart all buttonActual result:Service Actions-&gt;Restart all button does not work (do nothing). Restart passed  but restart icon still present.Expected result:Service Actions-&gt;Restart all button works. Restart passed  restart icon is not present after action.,0 ,0 
Add host stops all services,STR Install cluster Add hostActual resultAfter adding host all components on all hosts are stoppedExpected resultAll components on all hosts are started,0 ,0 
Have spinners instead of charts at Dashboard and Service tabs on IE 11,STR:1) Deploy cluster with defualt settings.2) Navigate on Dashboard pageExpected result:All charts are present.Actual result:Have spinners instead some charts.,0 ,0 
Get sql metrics logic should be reviewed,,0 ,0 
Add Services fails with a server error under some conditions,Upon clicking on 'Deploy' from Review page in Add Services Wizard  sometimes the UI shows a server error saying 'Resource Already Exists'.It looks like the UI is trying to add client components on hosts that already have them.I've seen it for HDFS_CLIENT  MAPREDUCE2_CLIENT  etc.  when trying to add Oozie (for sure)  Storm (I think)  and possibly others.,0 ,0 
step 6 pagination is slow,,0 ,1 
Repoinfo.xml should use family tag rather than type tag,That is a bit confusing we should change that  since we changed the way itworks &lt;os type='redhat6'&gt;should be &lt;os family='redhat6'&gt;,0 ,0 
Manage Config Groups: if Ganglia is not installed config group popup doesn't appear,We take some data from Ganglia metrics for hosts and if Ganglia is not installed browser throw js error which blocks popup initializing.,0 ,0 
Prompt to put Service in Maintenance Mode when doing Rolling Restart / Service Stop,When initiating Rolling Restart / Service Stop  they would like an option (via a checkbox  for example) to put the service in maintenance mode (if it is not already in MM) to avoid getting a lot of alerts.,0 ,0 
Python client caches curl flags between requests causing problems,Currently if you use the python client  if you issue a DELETE request followed by a GET request  that GET request becomes a DELETE request. You can imagine why that's undesirable.The problem is that we set the CUSTOMREQUEST field on the DELETE  but we don't unset it on the next GET. pycurl sees it still set and assumes we're still doing a DELETE.,0 ,0 
UI freezes for more than 2 seconds  every 15 seconds  on 2K-node cluster,It seems that we call App.componentConfigMapper every 15 seconds.This mapper takes more than 2 seconds to run. While the mapper is running  the entire UI is frozen.,0 ,1 
Custom Command execution takes too long,It takes significant amount of time to populate clusterHostInfo for every Execution Cmd on a 2000 node cluster.org.apache.ambari.server.utils.StageUtils.getClusterHostInfo(Map  Cluster),0 ,0 
JMXPropertyProvider makes call to endpoint without checking support for properties,Causes CPU usage go upto 1500 % and UI becomes unusable.1000's of Exception:00:01:50 666 ERROR [pool-1-thread-17] JMXPropertyProvider:539 - Caught exception getting JMX metrics : Connection refusedAll JMX endpoints called for any JMX metric.,0 ,1 
Bulk Ops only targets a maximum of 'page size' hosts,It seems that the max number of target hosts for a bulk operation is capped by the current 'page size' on the Hosts page.For example  on the 2K cluster with 2K DataNodes: Go to Hosts page Click on Actions. Either going to Filtered Hosts (2005) or All Hosts (2005)  select 'DataNodes &gt; Stop' A confirmation popup tells me that 50 DataNodes are about to be stopped. This should have been ~ 2000 DataNodes instead. 50 is the current page size on the Hosts page that I set.Another scenario: Set page size to 50. Select 100 hosts using 'check all'  'next page'  then 'check all' Go to 'Actions &gt; Selected Hosts &gt; DataNodes &gt; Stop'. Again  it tries to perform actions on only 50 DataNodes.,0 ,0 
Choosing bulk hosts to decommission on 120 node cluster on the hosts page just spins.,Steps to reproduce1. Filter by DataNodes2. Increase the page size to 503. Select all 50 and decommision datanodes.This ends up with a spinner .This might be a blocker. Attaching snapshot.,0 ,0 
Rolling Restart: 'only start stale' checkbox not worked functionally,Rolling restart page  there is a ' Only restart NodeManagers with stale configs' checkbox  nothing happened no matter if that one was checked or not. 1. On service(HDFS or YARN) actions &gt; restart all DN (NM). All DN(NM) will be restart no matter if the ' Only restart NodeManagers with stale configs' option checked.,0 ,0 
Bulk Decommission: Background Operation Popup content looks broken,header in task details popup looks broken when we run decommission for many Datanodes.,0 ,0 
Add service wizard removes any new property added to core-site and global after cluster installation,,0 ,0 
Hosts page. Incorrect total number of hosts after filtering by installed component,STR1. Go to hosts page2. Filter by Components. Check DATANODE3. At Bottom right corner I see Show 10 | 1-10 of 10,0 ,0 
filtering by selected hosts resets pagination,1. page size 102. select all 10 hosts on first page3. go to page 2  select 2 hosts (total 12 selection)4. click on '12 host selected' and it goes to page 1  1-10 of 12 hosts (correct)5. click to go to page 2 (to see the 2 hosts selected) but it resets to page 1  1-10 of 103,0 ,0 
After changing property and clicking save button in MapReduce Config Page  no comfirmation popup,STR1. Go to MapReduce Config Page2. Change JobTracker new generation size with a new value3. Clike Save buttonResult no confirmation popup  and save button turns grey  when switching pages the save button in the warning popup is not working neither.,0 ,0 
Unable to restart all host-components on 110 node cluster,On a 110 node cluster I went to the hosts page and went into All Hosts &gt; Hosts &gt; Restart All Components. Following that I got an error dialog (image attached) and the below exceptions in the log21:03:20 017 ERROR [qtp1391464722-1188] AmbariJpaLocalTxnInterceptor:114 - [DETAILED ERROR] Rollback reason:Local Exception Stack:Exception [EclipseLink-4002] (Eclipse Persistence Services - 2.4.0.v20120608-r11652): org.eclipse.persistence.exceptions.DatabaseExceptionInternal Exception: java.sql.BatchUpdateException: Batch entry 0 INSERT INTO requestoperationlevel (operation_level_id  cluster_name  host_component_name  host_name  level_name  request_id  service_name) VALUES (2  'Horton'  NULL  'horton-1.c.pramod-thangali.internal horton-10.c.pramod-thangali.internal horton-100.c.pramod-thangali.internal horton-101.c.pramod-thangali.internal horton-103.c.pramod-thangali.internal horton-104.c.pramod-thangali.internal horton-105.c.pramod-thangali.internal horton-106.c.pramod-thangali.internal horton-107.c.pramod-thangali.internal horton-108.c.pramod-thangali.internal horton-109.c.pramod-thangali.internal horton-11.c.pramod-thangali.internal horton-12.c.pramod-thangali.internal horton-13.c.pramod-thangali.internal horton-14.c.pramod-thangali.internal horton-15.c.pramod-thangali.internal horton-16.c.pramod-thangali.internal horton-17.c.pramod-thangali.internal horton-18.c.pramod-thangali.internal horton-19.c.pramod-thangali.internal horton-2.c.pramod-thangali.internal horton-20.c.pramod-thangali.internal horton-21.c.pramod-thangali.internal horton-22.c.pramod-thangali.internal horton-23.c.pramod-thangali.internal horton-24.c.pramod-thangali.internal horton-25.c.pramod-thangali.internal horton-26.c.pramod-thangali.internal horton-27.c.pramod-thangali.internal horton-28.c.pramod-thangali.internal horton-29.c.pramod-thangali.internal horton-3.c.pramod-thangali.internal horton-30.c.pramod-thangali.internal horton-31.c.pramod-thangali.internal horton-32.c.pramod-thangali.internal horton-33.c.pramod-thangali.internal horton-34.c.pramod-thangali.internal horton-35.c.pramod-thangali.internal horton-36.c.pramod-thangali.internal horton-37.c.pramod-thangali.internal horton-38.c.pramod-thangali.internal horton-39.c.pramod-thangali.internal horton-4.c.pramod-thangali.internal horton-40.c.pramod-thangali.internal horton-41.c.pramod-thangali.internal horton-42.c.pramod-thangali.internal horton-43.c.pramod-thangali.internal horton-44.c.pramod-thangali.internal horton-45.c.pramod-thangali.internal horton-46.c.pramod-thangali.internal horton-47.c.pramod-thangali.internal horton-48.c.pramod-thangali.internal horton-49.c.pramod-thangali.internal horton-5.c.pramod-thangali.internal horton-50.c.pramod-thangali.internal horton-51.c.pramod-thangali.internal horton-52.c.pramod-thangali.internal horton-53.c.pramod-thangali.internal horton-54.c.pramod-thangali.internal horton-55.c.pramod-thangali.internal horton-56.c.pramod-thangali.internal horton-57.c.pramod-thangali.internal horton-58.c.pramod-thangali.internal horton-59.c.pramod-thangali.internal horton-6.c.pramod-thangali.internal horton-60.c.pramod-thangali.internal horton-61.c.pramod-thangali.internal horton-62.c.pramod-thangali.internal horton-63.c.pramod-thangali.internal horton-64.c.pramod-thangali.internal horton-65.c.pramod-thangali.internal horton-66.c.pramod-thangali.internal horton-67.c.pramod-thangali.internal horton-68.c.pramod-thangali.internal horton-69.c.pramod-thangali.internal horton-7.c.pramod-thangali.internal horton-70.c.pramod-thangali.internal horton-71.c.pramod-thangali.internal horton-72.c.pramod-thangali.internal horton-73.c.pramod-thangali.internal horton-74.c.pramod-thangali.internal horton-75.c.pramod-thangali.internal horton-76.c.pramod-thangali.internal horton-77.c.pramod-thangali.internal horton-78.c.pramod-thangali.internal horton-79.c.pramod-thangali.internal horton-8.c.pramod-thangali.internal horton-80.c.pramod-thangali.internal horton-81.c.pramod-thangali.internal horton-82.c.pramod-thangali.internal horton-83.c.pramod-thangali.internal horton-84.c.pramod-thangali.internal horton-85.c.pramod-thangali.internal horton-86.c.pramod-thangali.internal horton-87.c.pramod-thangali.internal horton-88.c.pramod-thangali.internal horton-9.c.pramod-thangali.internal horton-90.c.pramod-thangali.internal horton-91.c.pramod-thangali.internal horton-92.c.pramod-thangali.internal horton-93.c.pramod-thangali.internal horton-94.c.pramod-thangali.internal horton-95.c.pramod-thangali.internal horton-96.c.pramod-thangali.internal horton-97.c.pramod-thangali.internal horton-98.c.pramod-thangali.internal horton-99.c.pramod-thangali.internal horton-master-1.c.pramod-thangali.internal horton-master-2.c.pramod-thangali.internal horton-master-3.c.pramod-thangali.internal'  'Host'  25  NULL) was aborted. Call getNextException to see the cause.Error Code: 0Call: INSERT INTO requestoperationlevel (operation_level_id  cluster_name  host_component_name  host_name  level_name  request_id  service_name) VALUES (?  ?  ?  ?  ?  ?  ?) bind =&gt; [7 parameters bound]Query: InsertObjectQuery(org.apache.ambari.server.orm.entities.RequestResourceFilterEntity@2c6ae575) at org.eclipse.persistence.exceptions.DatabaseException.sqlException(DatabaseException.java:333) at org.eclipse.persistence.internal.databaseaccess.DatabaseAccessor.processExceptionForCommError(DatabaseAccessor.java:1501) at org.eclipse.persistence.internal.databaseaccess.DatabaseAccessor.executeJDK12BatchStatement(DatabaseAccessor.java:875) at org.eclipse.persistence.internal.databaseaccess.ParameterizedSQLBatchWritingMechanism.executeBatchedStatements(ParameterizedSQLBatchWritingMechanism.java:145) at org.eclipse.persistence.internal.databaseaccess.ParameterizedSQLBatchWritingMechanism.appendCall(ParameterizedSQLBatchWritingMechanism.java:88) at org.eclipse.persistence.internal.databaseaccess.DatabaseAccessor.basicExecuteCall(DatabaseAccessor.java:571) at org.eclipse.persistence.internal.databaseaccess.DatabaseAccessor.executeCall(DatabaseAccessor.java:537) at org.eclipse.persistence.internal.sessions.AbstractSession.basicExecuteCall(AbstractSession.java:1800) at org.eclipse.persistence.sessions.server.ClientSession.executeCall(ClientSession.java:286) at org.eclipse.persistence.internal.queries.DatasourceCallQueryMechanism.executeCall(DatasourceCallQueryMechanism.java:207) at org.eclipse.persistence.internal.queries.DatasourceCallQueryMechanism.executeCall(DatasourceCallQueryMechanism.java:193) at org.eclipse.persistence.internal.queries.DatasourceCallQueryMechanism.insertObject(DatasourceCallQueryMechanism.java:342) at org.eclipse.persistence.internal.queries.StatementQueryMechanism.insertObject(StatementQueryMechanism.java:162) at org.eclipse.persistence.internal.queries.StatementQueryMechanism.insertObject(StatementQueryMechanism.java:177) at org.eclipse.persistence.internal.queries.DatabaseQueryMechanism.insertObjectForWrite(DatabaseQueryMechanism.java:471) at org.eclipse.persistence.queries.InsertObjectQuery.executeCommit(InsertObjectQuery.java:80) at org.eclipse.persistence.queries.InsertObjectQuery.executeCommitWithChangeSet(InsertObjectQuery.java:90) at org.eclipse.persistence.internal.queries.DatabaseQueryMechanism.executeWriteWithChangeSet(DatabaseQueryMechanism.java:286) at org.eclipse.persistence.queries.WriteObjectQuery.executeDatabaseQuery(WriteObjectQuery.java:58) at org.eclipse.persistence.queries.DatabaseQuery.execute(DatabaseQuery.java:852) at org.eclipse.persistence.queries.DatabaseQuery.executeInUnitOfWork(DatabaseQuery.java:751) at org.eclipse.persistence.queries.ObjectLevelModifyQuery.executeInUnitOfWorkObjectLevelModifyQuery(ObjectLevelModifyQuery.java:108) at org.eclipse.persistence.queries.ObjectLevelModifyQuery.executeInUnitOfWork(ObjectLevelModifyQuery.java:85) at org.eclipse.persistence.internal.sessions.UnitOfWorkImpl.internalExecuteQuery(UnitOfWorkImpl.java:2875) at org.eclipse.persistence.internal.sessions.AbstractSession.executeQuery(AbstractSession.java:1602) at org.eclipse.persistence.internal.sessions.AbstractSession.executeQuery(AbstractSession.java:1584) at org.eclipse.persistence.internal.sessions.AbstractSession.executeQuery(AbstractSession.java:1535) at org.eclipse.persistence.internal.sessions.CommitManager.commitNewObjectsForClassWithChangeSet(CommitManager.java:224) at org.eclipse.persistence.internal.sessions.CommitManager.commitAllObjectsForClassWithChangeSet(CommitManager.java:191) at org.eclipse.persistence.internal.sessions.CommitManager.commitAllObjectsWithChangeSet(CommitManager.java:136) at org.eclipse.persistence.internal.sessions.AbstractSession.writeAllObjectsWithChangeSet(AbstractSession.java:3914) at org.eclipse.persistence.internal.sessions.UnitOfWorkImpl.commitToDatabase(UnitOfWorkImpl.java:1419) at org.eclipse.persistence.internal.sessions.RepeatableWriteUnitOfWork.commitToDatabase(RepeatableWriteUnitOfWork.java:634) at org.eclipse.persistence.internal.sessions.UnitOfWorkImpl.commitToDatabaseWithChangeSet(UnitOfWorkImpl.java:1509) at org.eclipse.persistence.internal.sessions.RepeatableWriteUnitOfWork.commitRootUnitOfWork(RepeatableWriteUnitOfWork.java:266) at org.eclipse.persistence.internal.sessions.UnitOfWorkImpl.commitAndResume(UnitOfWorkImpl.java:1147) at org.eclipse.persistence.internal.jpa.transaction.EntityTransactionImpl.commitInternal(EntityTransactionImpl.java:84) at org.eclipse.persistence.internal.jpa.transaction.EntityTransactionImpl.commit(EntityTransactionImpl.java:63) at org.apache.ambari.server.orm.AmbariJpaLocalTxnInterceptor.invoke(AmbariJpaLocalTxnInterceptor.java:91) at com.google.inject.internal.InterceptorStackCallback$InterceptedMethodInvocation.proceed(InterceptorStackCallback.java:72) at com.google.inject.internal.InterceptorStackCallback.intercept(InterceptorStackCallback.java:52) at org.apache.ambari.server.actionmanager.ActionDBAccessorImpl$$EnhancerByGuice$$ddd0d231.persistActions(&lt;generated&gt;) at org.apache.ambari.server.actionmanager.ActionManager.sendActions(ActionManager.java:95) at org.apache.ambari.server.actionmanager.ActionManager.sendActions(ActionManager.java:84) at org.apache.ambari.server.controller.AmbariManagementControllerImpl.createAction(AmbariManagementControllerImpl.java:2583) at org.apache.ambari.server.controller.internal.RequestResourceProvider$1.invoke(RequestResourceProvider.java:124) at org.apache.ambari.server.controller.internal.RequestResourceProvider$1.invoke(RequestResourceProvider.java:121) at org.apache.ambari.server.controller.internal.AbstractResourceProvider.createResources(AbstractResourceProvider.java:237) at org.apache.ambari.server.controller.internal.RequestResourceProvider.createResources(RequestResourceProvider.java:121) at org.apache.ambari.server.controller.internal.ClusterControllerImpl.createResources(ClusterControllerImpl.java:274) at org.apache.ambari.server.api.services.persistence.PersistenceManagerImpl.create(PersistenceManagerImpl.java:75) at org.apache.ambari.server.api.handlers.CreateHandler.persist(CreateHandler.java:36) at org.apache.ambari.server.api.handlers.BaseManagementHandler.handleRequest(BaseManagementHandler.java:72) at org.apache.ambari.server.api.services.BaseRequest.process(BaseRequest.java:135) at org.apache.ambari.server.api.services.BaseService.handleRequest(BaseService.java:103) at org.apache.ambari.server.api.services.BaseService.handleRequest(BaseService.java:72) at org.apache.ambari.server.api.services.RequestService.createRequests(RequestService.java:119) at sun.reflect.GeneratedMethodAccessor113.invoke(Unknown Source),0 ,0 
Hosts page : mysterious 'selected hosts' keep coming back,See attached video.Somehow  there are always 10 hosts selected. After explicitly hitting 'clear selection'  page refresh somehow reverts back to 10 hosts being selected.,0 ,1 
hostname wrapping with icon asterisks on assign slaves,see attached.,0 ,0 
Excessive requests are sending on hosts page,When we open hosts page  we can see  that we have excessive requests as spinner appears two times one after another.,0 ,0 
In Host Detailed Page  decommissioned NM is labeled as STOPPED,In Yarn Service page  NodeManagers Status: 3 active / 0 lost / 0 unhealthy / 0 rebooted / 1 decommissionedIn Host Detailed Page of that decommissioned NM  the state of the NM is labeled as 'stopped'  which is not consistent comparing to Service page.API call:'href' : 'http://172.18.145.115:8080/api/v1/clusters/cl1/hosts/us3mon1404188570-3.cs1cloud.internal/host_components/NODEMANAGER'  'HostRoles' : { 'cluster_name' : 'cl1'  'component_name' : 'NODEMANAGER'  'desired_admin_state' : 'DECOMMISSIONED'  'desired_stack_id' : 'HDP-2.1'  'desired_state' : 'STARTED'  'host_name' : 'us3mon1404188570-3.cs1cloud.internal'  'maintenance_state' : 'OFF'  'service_name' : 'YARN'  'stack_id' : 'HDP-2.1'  'stale_configs' : false  'state' : 'INSTALLED' As a result  user cannot start the NodeManger as it is considered to be decommissioned by ResourceManger.,0 ,0 
Many services failed to start when using custom user names and groups,On Customize services page set next values for users and groups:Name: ValueProxy group for Hive WebHCat Oozie and Falcon: custom-usersgrHDFS User: custom-hdfsMapReduce User: custom-mapredYARN User: custom-yarnHBase User: custom-hbaseHive User: custom-hiveHCat User: custom-hcatWebHCat User: custom-hcatOozie User: custom-oozieFalcon User: custom-falconStorm User: custom-stormZooKeeper User: custom-zookeeperGanglia User: custom-nobodyNagios User: custom-nagiosNagios Group: custom-nagiosgrSmoke Test User: ambari-qaTez User: custom-tezHadoop Group: custom-hadoopgrSkip group modifications during install: falseAfter deploy many services fail to start:MapReduce  Hbase  Hive  WebHcat  Falcon  OozieSame error for all:Call From ins1404365245-9.cs1cloud.internal/172.18.145.154 to localhost:8020 failed on connection exception: java.net.ConnectException: Connection refused; For more details see: http://wiki.apache.org/hadoop/ConnectionRefused,0 ,0 
Move Wizard: get stuck if wizard is running second time for the same component without page refresh,STR:1. Run Move Wizard for some master component.2. Do not click Complete button after all operation will be finished. Close wizard (confirm closing).3. Without page refresh open wizard for the same master component and try it to reassign to another host (ex. back to the previous host).Wizard will get stuck  as source host for master component will be calculated incorrectly.This issue is related to host components mapper. After first running of move wizard in the model there were 2 masters one with host before moving and the new one. Old host component was deleted on server but UI model still contains it. And it brakes algorithm of calculating source host on assign master step.,0 ,1 
Move Wizard: assign master step next button is not disabled  when host input has error,When Move Wizard is running on cluster with a large number of hosts  assign master step has input to enter hostname instead of select dropdown. If this dropdown is empty  it shows an error. But if in the same time target host was selected correctly the next button is enabled.,0 ,0 
Postgres create script generates errors for clusterconfig,Manually running the postgres create sql script encountered errors.Errors: psql:Ambari-DDL-Postgres-CREATE.sql:22: ERROR: column 'config_attributes' specified more than once psql:Ambari-DDL-Postgres-CREATE.sql:103: ERROR: relation 'clusterconfig' does not exist psql:Ambari-DDL-Postgres-CREATE.sql:126: ERROR: relation 'clusterconfig' does not existRepro Steps:1. Spin up a CentOS 6.4 VM vagrant up c6401 vagrant ssh c6401 sudo su - wget http://public-repo-1.hortonworks.com/ambari/centos6/1.x/updates/1.6.0/ambari.repo cp ambari.repo /etc/yum.repos.d yum install ambari-server -y2. Setup a postgres database vi /etc/yum.repos.d/CentOS-Base.repo edit the &#91;base&#93; and &#91;updates&#93; sections by adding the following line without quotes  'exclude=postgresql*' yum localinstall http://yum.postgresql.org/9.3/redhat/rhel-6-x86_64/pgdg-centos93-9.3-1.noarch.rpm yum install postgresql-server cd /etc/yum.repos.d/ service postgresql initdb chkconfig postgresql on service postgresql start3. Run the script cp /vagrant/Ambari-DDL-Postgres-CREATE.sql /var/lib/ambari-server/resources/ (assuming you have the latest file from trunk) cp /var/lib/ambari-server/resources/Ambari-DDL-Postgres-CREATE.sql /var/lib/pgsql/ su - postgres psql Follow step #1 at http://docs.hortonworks.com/HDPDocuments/Ambari-1.6.0.0/bk_ambari_reference/content/nndb-using-ambari-postgresql.html where $AMBARIDATABASE is ambari  $AMBARIUSER is postgres  and $AMBARISCHEMA is ambari. /i Ambari-DDL-Postgres-CREATE.sql;Then verify the errors. When done  issue /q on the psql command line to exit.,0 ,0 
Config pages load slowly on 2k-node cluster for some services,On the 2k-node cluster  service config pages load slowly (though the load time has improved significantly from before).The load time depends on the service.Here are some sample load times:HDFS: 5sYARN: 17sMR2: 16sTEZ: 10sHBASE: 3sHIVE: 13sWEBHCAT: 3sFALCON: 3sSTORM: 17sOOZIE: 11sGANGLIA: 1sNAGIOS: 1sZOOKEEPER: 2sPIG: 2sSQOOP: n/a (no config page),0 ,1 
Link to ExtJS license in 'Choose Services' page has moved,Step 4 of the Ambari installer has a broken link.When 'Choosing Services'  the link for the 'ExtJS' library license under the 'Oozie' service has moved from http://www.sencha.com/products/extjs/license/It should be updated to the URL below since it covers that Ext JS is available under GPL v3 license:http://www.sencha.com/legal/open-source-faq/,0 ,0 
Filter state does not clear in Background Operation popup and causes a lot of confusion,In the Background Operations popup  the filter state persists at the Host and Task levels  even after closing the popup (the filter should be cleared once the user goes back up one level or closes the popup).This causes a lot of confusion because the user will expect these filters to be cleared but instead cannot see the hosts and tasks that they are expecting.,0 ,0 
Unable to move NameNode,STR: Enabled NNHA.Active NameNode is on suse1101 hostStandby NameNode is on suse1102 host Stopped SNN. Opened move NN wizardResult: Next button is active when I choose existing topology (suse1101 and suse1102)Next button is inactive when I choose custom topology (suse1103 and suse1101)UPD: Reproduced also on non-HA cluster.,0 ,0 
JS error occurs periodically when Job Details page is opened,'Uncaught TypeError: Cannot read property 'properties' of undefined'at /ambari-web/app/views/common/quick_view_link_view.js:246,0 ,1 
Add Services Wizard can corrupt config files unpredictably,Testing using the 1.6.1 RC bits (branch-1.6.1  hash=ffb702b252a8b979529864ec5579465a122060b5) revealed that Add Services can corrupt config files in an unpredictable manner.We have seen: adding Pig resulted in core-site dropping all existing properties except for 'hadoop.proxyuser.falcon.hosts and hadoop.proxyuser.falcon.groups' add Storm resulted in core-site retaining all existing properties but dropping hadoop.proxyuser.* settings for all services except Falcon adding Storm dropped a number of existing properties in yarn-site (and NodeManagers can no longer restart after that)The bottomline here is that behavior seems pretty random (adding the same service on different clusters results in different behavior).Also  when adding a service  certain configs (like hdfs-site) were not cloned while most other configs (like yarn-site  mapred-site) get cloned even if no property changes are made regardless of which service is added.Update: changes to hdfs-site during Add Services Wizard never persists.,0 ,0 
AddHost Wizard: error for existing host is not present,STR: Click AddHost Type existing host Click 'Register and Confirm' buttonActual result: There present only message about 'SSH Private Key is required'Excpected Result: SHould be also present message like 'These hosts are already exists'.---------------------------------Note: the excpected message only present if we type/select ss key and will click 'Register and Confirm',0 ,0 
JS errors on Jobs page if ATS is stopped,If ATS stopped  Jobs page continuously produces following js errors:NetworkError: 400 Bad Request - http://172.18.145.185:8080/proxy?url=http://us1mon1402550931-re-5.cs1cloud.internal:8188/ws/v1/timeline/HIVE_QUERY_ID?fields=events primaryfilters otherinfo&amp;secondaryFilter=tez:true&amp;limit=11&amp;_=1402578530622'proxy?...8530622'NetworkError: 400 Bad Request - http://172.18.145.185:8080/proxy?url=http://us1mon1402550931-re-5.cs1cloud.internal:8188/ws/v1/timeline/HIVE_QUERY_ID?limit=1&amp;secondaryFilter=tez:true&amp;_=1402578531674'proxy?...8531674'NetworkError: 400 Bad Request - http://172.18.145.185:8080/proxy?url=http://us1mon1402550931-re-5.cs1cloud.internal:8188/ws/v1/timeline/HIVE_QUERY_ID?limit=1&amp;secondaryFilter=tez:true&amp;_=1402578537654',0 ,0 
Default config group name contains 'undefined' instead of service name in Manage Config Groups popup,,0 ,0 
Unable to proceed from step 4 of installer if YARN-dependent services are selected but YARN isn't (HDP 2.0),STROn step 4 of Install Wizard  select any of the services dependent on YARN (Piq  Oozie  Hive) but don't select YARN itself. Press 'Next' button.Expected resultPopup with the info about YARN dependence appears.Actual resultNothing happens. JS error occurs:Uncaught TypeError: Cannot read property 'get' of undefinedatapp/controllers/wizard/step4_controller.js:180,0 ,0 
Incorrect errors count for YARN on step 7 of Install Wizard (HDP 2.0),'Customize Services' step indicates that 8 YARN properties need revision but no one is highlighted as incorrect.,0 ,0 
Hostname case sensitivity,Hostname CaSe SeNsiTiVity causes hostnames don't match error.'in the install wizard  the hostnames MUST be lower case in the user input  otherwise the 'hostnames don't match' during the install and it fails. Ambari should tolower() both hosts before comparing.'Effected Install/Add Host Wizard.,0 ,0 
Unable to install cluster after coming back to step 1 and selecting different stack version,STRProceed to step 7 of Install Wizard. Return to step 1 and choose a different stack version. Go forward.ResultUnable to proceed from step 3. JS error occurs:Uncaught Error: &lt;DS.StateManager:ember26192&gt; could not respond to event didChangeData in state rootState.loaded.updated.uncommitted.WorkaroundTo log out and log in again before perforfing installation with different stack version.,0 ,0 
Ambari support on CentOS7 /RHEL7 - I,Background : Centos7 is very different from centos6.5 and currently Ambari &amp; HDP are not supported on Centos7Supporting Ambari on CentOS7/RHEL7 has multiple elements :1)mvn build of Ambari should be successful. document required steps in wiki.2)Ambari server &amp; agent should be modified to support centos7/redhat7. following changes are necessary :2.1)/usr/lib/python2.6 symbolic link .2.2)code changes to add redhat7 as a new OS family.3)HDP centos7 rpms + new repo to be made available to deploy different services on centos7/redhat7 .Currently centos7 is not supported by the Ambari/HDP build team.This JIRA captures 2.2),0 ,0 
Create main page with table of jobs,,0 ,0 
Add ZKFC component to summary page (when NNHA enabled),Add ZKFC component on summary page. Each Zkfc should under related Namenode  with a smaller size.,0 ,0 
FE allows add host on host that is in UNKNOWN state (agent was stopped),added a host to a cluster (manually installed and started an agent)http://c6403.ambari.apache.org:8080/api/v1/hosts/c6401.ambari.apache.org{ 'href' : 'http://c6403.ambari.apache.org:8080/api/v1/hosts/c6401.ambari.apache.org'  'Hosts' : { 'host_health_report' : ''  'host_name' : 'c6401.ambari.apache.org'  'host_state' : 'HEALTHY'  'host_status' : 'HEALTHY' }}After the agent is stopped for the host{ 'href' : 'http://c6403.ambari.apache.org:8080/api/v1/hosts/c6401.ambari.apache.org'  'Hosts' : { 'host_health_report' : ''  'host_name' : 'c6401.ambari.apache.org'  'host_state' : 'HEARTBEAT_LOST'  'host_status' : 'UNKNOWN' }}At this point I can perform AddHost and start the wizard. But AddHost will eventually fail - although now I see it just waiting.We need some form of error indication when host is not lost.,0 ,0 
Service pluggability: New added services in the stack has Add Property link in log-4j and env categories,,0 ,0 
Fast user can skip 'Customize Services' step (add service wizard) while configs are not loaded,STR Install cluster Go to Add Service Wizard Proceed to step 'Customize services' While configs are loading click 'Next'.If user tried to install services with configs that should be provided manually using UI (like Nagios)  he will get JS-error on next step.,0 ,0 
'all/none' links affect already installed services on 'Select Services' step,,0 ,0 
Linked Ganglia charts from Host Details page don't show any graphs (except on NameNode host),The UI links to Ganglia Web to display the graphs for a specific host as http://&lt;ganglia-host&gt;/ganglia/mobile_helper.php?show_host_metrics=1&amp;h=&lt;target-fqdn&gt;&amp;c=HDPNameNode&amp;r=hour&amp;cs=&amp;ce=Note that c=HDPNameNode is static.I believe this worked before as the NameNode gmond was repeated on all the hosts (we should not have and this has been fixed but now it's causing this issue).For this ticket  let's change the call the UI makes from 'HDPNameNode' to 'HDPSlaves' and verify that host-level Ganglia links work for all hosts on a multi-node cluster (including hosts with clients only).,0 ,0 
Deleted hosts come back to life after ambari-server restart,When attempting to delete a host through the UI  and then re-add it  the re-add operation fails because a record already exists in the clusterhostmapping table.This can be reproduced as follows (host names will change of course) 1. Create a cluster and add a host so that it is populated in the clusterhostmapping table.2. Make sure the agent is running.3. On the server  run ambari-server restart  and immediately run the following repeatedly in another terminal window before the restart finishes  curl --write-out %{http_code} --show-error -u admin:admin -H 'X-Requested-By:1' -i -X DELETE http://c6404.ambari.apache.org:8080/api/v1/clusters/dev/hosts/c6407.ambari.apache.orgHTTP/1.1 200 OKSet-Cookie: AMBARISESSIONID=z91px2l41uc6dwjv52zl2mcu;Path=/Expires: Thu  01 Jan 1970 00:00:00 GMTContent-Type: text/plainContent-Length: 0Server: Jetty(7.6.7.v20120910)4. Quickly verify that the host name is removed from the clusterhostmapping table.5. On the agent  run ambari-agent restart  and repeatedly requery the clusterhostmapping table  until the record is reinserted (should take no more than 30 seconds to appear).6. Run the curl command to attempt to re-add the host  and receive the error message curl --write-out %{http_code} --show-error -u admin:admin -H 'X-Requested-By:1' -i POST http://c6404.ambari.apache.org:8080/api/v1/clusters/dev/hosts/c6407.ambari.apache.orgHTTP/1.1 500 Exception [EclipseLink-4002] (Eclipse Persistence Services - 2.4.0.v20120608-r11652): org.eclipse.persistence.exceptions.DatabaseException Internal Exception: java.sql.BatchUpdateException: Batch entry 0 INSERT INTO ClusterHostMapping (cluster_id  host_name) VALUES (2  'c6407.ambari.apache.org') was aborted. Call getNextException to see the cause. Error Code: 0 Call: INSERT INTO ClusterHostMapping (cluster_id  host_name) VALUES (?  ?) bind =&gt; [2 parameters bound]Set-Cookie: AMBARISESSIONID=1je1wahcml82f11gjrserxgdyl;Path=/Content-Type: text/plain;charset=ISO-8859-1Content-Length: 530Server: Jetty(7.6.7.v20120910){ 'status': 500  'message': 'Exception [EclipseLink-4002] (Eclipse Persistence Services - 2.4.0.v20120608-r11652): org.eclipse.persistence.exceptions.DatabaseException/nInternal Exception: java.sql.BatchUpdateException: Batch entry 0 INSERT INTO ClusterHostMapping (cluster_id  host_name) VALUES (2  /u0027c6407.ambari.apache.org/u0027) was aborted. Call getNextException to see the cause./nError Code: 0/nCall: INSERT INTO ClusterHostMapping (cluster_id  host_name) VALUES (?  ?)/n/tbind /u003d/u003e [2 parameters bound]'At this point  here is the state of the tables.select * from clusterhostmapping where host_name = 'c6407.ambari.apache.org'; cluster_id | host_name------------+------------------------- 2 | c6407.ambari.apache.orgselect * from hoststate where host_name = 'c6407.ambari.apache.org'; agent_version | available_mem | current_state | health_status | host_name | time_in_state | maintenance_state---------------------+---------------+---------------+----------------------------------------------+-------------------------+---------------+------------------- {'version':'1.6.0'} | 250232 | INIT | {'healthStatus':'HEALTHY' 'healthReport':''} | c6407.ambari.apache.org | 1405718796141 | {'2':'ON'}I then deleted both records  restarted the server  and was then able to add the host successfully.This is a bug in the persistence layer.,0 ,0 
Views: exception on server restart after creating view instance,1) installed the files view (built from source)2) I created an instance of the viewPOSThttp://c6401.ambari.apache.org:8080/api/v1/views/FILES/versions/0.1.0/instances/MyFiles[ {'ViewInstanceInfo' : { 'properties' : { 'dataworker.defaultFs' : 'webhdfs://c6401.ambari.apache.org:50070'  'dataworker.username' : 'ambari-qa' } }} ]3) I restart ambari-server and get this exception  so ambari-server can't start up. If I delete the view jar and restart  then I can get ambari-server to start.00:41:59 433 INFO [main] Server:266 - jetty-7.6.7.v2012091000:41:59 914 WARN [main] WebAppContext:489 - Failed startup of context o.e.j.w.WebAppContext{/views/FILES/0.1.0/MyFiles file:/var/lib/ambari-server/resources/views/work/FILES%7B0.1.0%7D/} /var/lib/ambari-server/resources/views/work/FILES{0.1.0}java.util.zip.ZipException: invalid entry size (expected 12027 but got 11985 bytes) at java.util.zip.ZipInputStream.readEnd(ZipInputStream.java:403) at java.util.zip.ZipInputStream.read(ZipInputStream.java:195),0 ,0 
Management Console: UI Layout  Basic Routing and Create User Management Page (with mock data),,0 ,0 
Install wizard should have ability to load default 'final' configs  and save them,In Ambari if a stack service has configs with final=true  then during install wizard these configs should have the final-checkbox checked. Also  if the user changes these checkboxes  the values should be stored in the properties_attributes of configs when Deploy is hit.,0 ,0 
Ambari-DDL-Postgres-CREATE.sql fix for CLUSTER.OPERATE,,0 ,0 
BlueprintResourceProviderTest fails on exception message assertion,testDecidePopulationStrategy_unsupportedSchema(org.apache.ambari.server.controller.internal.BlueprintResourceProviderTest) Time elapsed: 0.02 sec &lt;&lt;&lt; FAILURE!java.lang.AssertionError:Expected: (exception with message a string containing 'Configuration definition schema is not supported' and an instance of java.lang.IllegalArgumentException) got: &lt;java.lang.IllegalArgumentException: 'Configuration format provided in Blueprint is not supported'&gt;,0 ,0 
Fix unit tests that are broken after AMBARI-6533,Unit tests are broken after commit f3aab68ec417d8e2c39c216962e1e1d47d56d401The root cause is the properties in InMemoryDefaultTestModule.java.,0 ,0 
HDP-1.3 stack shows HUE in select services page,HUE is defined in HDP-1.3.2 stack with configuration sites but there is no agent scripts defining configure/stop/start/status functions for the service.HUE is not supported to work with Ambari. In that case we should not expose HUE via stack definition API as supported service of HDP-1.x stack.,0 ,0 
Cannot start ambari-server due to empty metainfo table,Trying to deploy latest trunk build ambari-server-1.7.0-70 and hit the following when running ambari-server startambari-server.log01:30:53 074 INFO [main] AmbariServer:157 - ********* Meta Info initialized **********01:30:53 086 INFO [main] ClustersImpl:103 - Initializing the ClustersImpl01:30:53 679 INFO [main] AmbariManagementControllerImpl:230 - Initializing the AmbariManagementControllerImpl01:30:53 894 INFO [main] AmbariServer:487 - Checking DB store version01:30:53 894 WARN [main] AmbariServer:502 - Current database store version is not compatible with current server version  serverVersion=null  schemaVersion=null01:30:53 895 ERROR [main] AmbariServer:592 - Failed to run the Ambari Serverorg.apache.ambari.server.AmbariException: Current database store version is not compatible with current server version  serverVersion=null  schemaVersion=null at org.apache.ambari.server.controller.AmbariServer.checkDBVersion(AmbariServer.java:503) at org.apache.ambari.server.controller.AmbariServer.run(AmbariServer.java:164) at org.apache.ambari.server.controller.AmbariServer.main(AmbariServer.java:589)The metainfo table is empty with no values indicating version of Ambari installed.,0 ,0 
Add Service wizard: Retry installation functionality does not work,API triggered on clicking Retry button results in failure with 400 status code,0 ,1 
Config categories aren't displayed on 'Configure Services' step of Secrity Wizard,See the screenshot attached.JS error Uncaught TypeError: Cannot read property 'filterProperty' of undefined at ambari-web/app/views/common/configs/services_config.js:338,0 ,0 
Memory leaks during tabs switching on 'Customize Services' page,Steps:Go to 'Customize services page'.Switch to other tab many a time (50 switches = about 100MB).Result: firefox browser gets 1.2 GB in memory.,0 ,0 
Oozie service can not be started on Ambari server with external Postgres,STR: Install single node cluster with Postgres 9 server as Ambari and Oozie DB (Stack - 2.0). Postgres server should be on dedicated host; Start all services.Actual result: Oozie server will not start.Error message for Oozie:2014-07-23 08:42:57 947 - Error while executing command 'start':Traceback (most recent call last): File '/usr/lib/python2.6/site-packages/resource_management/libraries/script/script.py'  line 111  in execute method(env) File '/var/lib/ambari-agent/cache/stacks/HDP/2.0.6/services/OOZIE/package/scripts/oozie_server.py'  line 43  in start oozie_service(action='start') File '/var/lib/ambari-agent/cache/stacks/HDP/2.0.6/services/OOZIE/package/scripts/oozie_service.py'  line 43  in oozie_service Execute( db_connection_check_command  tries=5  try_sleep=10) File '/usr/lib/python2.6/site-packages/resource_management/core/base.py'  line 148  in __init__ self.env.run() File '/usr/lib/python2.6/site-packages/resource_management/core/environment.py'  line 149  in run self.run_action(resource  action) File '/usr/lib/python2.6/site-packages/resource_management/core/environment.py'  line 115  in run_action provider_action() File '/usr/lib/python2.6/site-packages/resource_management/core/providers/system.py'  line 239  in action_run raise exFail: Execution of '/usr/jdk64/jdk1.7.0_45/bin/java -cp /usr/lib/ambari-agent/DBConnectionVerification.jar:/usr/lib/oozie/libserver/postgresql-9.0-801.jdbc4.jar org.apache.ambari.server.DBConnectionVerification jdbc:postgresql://&lt;host&gt;:5432/ooziedb oozieuser [PROTECTED] org.postgresql.Driver' returned 1. ERROR: Unable to connect to the DB. Please check DB connection properties.java.lang.ClassNotFoundException: org.postgresql.Driver,0 ,0 
Unit test failures on jenkins for Ambari 1.7.0 related to alerts.,Tests run locally and pass 100% consistently.These test results are fishy; they randomly fail on different OS deployments. Even the simple logic ones fail. There are only 5 alert targets ever created  yet there are 9 returned sometimes. I'm wondering if this is because we tried to load some data in the @BeforeClass instead of @Before - maybe there's a weird Guice/JUnit race condition going on.I can't say I can fix this with confidence since I can't reproduce it. I'm going to move some things to @Before and hope it helps.java.lang.AssertionError: expected:&lt;5&gt; but was:&lt;9&gt; at org.junit.Assert.fail(Assert.java:93) at org.junit.Assert.failNotEquals(Assert.java:647) at org.junit.Assert.assertEquals(Assert.java:128) at org.junit.Assert.assertEquals(Assert.java:472) at org.junit.Assert.assertEquals(Assert.java:456) at org.apache.ambari.server.orm.dao.AlertDispatchDAOTest.testFindAllTargets(AlertDispatchDAOTest.java:117),0 ,0 
Oozie fails for stack 2.0 and 2.1,,0 ,0 
'Refresh configs' action doesn't work for Flume,STR: Deployed cluster with Flume  without Flume Agents. Added Flume agent on each host. Configured 7 agents  assigned to different hosts. Changed config of one Flume agent. Clicked 'Refresh configs' action.Result: Nothing happened.,0 ,0 
Capacity Scheduler config cannot be saved,STR: Go to YARN &gt; Config Under 'Scheduler' section  modify 'Capacity Scheduler' configs. Hit Save. The page reloads. The modifications are reverted back.,0 ,0 
RM HA wizard is experimental but shouldn't be,Installed 1.7.0 build and RM HA is not available unless I go enable #experimental.Should not be experimental. RM HA is available with HDP 2.1+ Stack (but not with HDP 2.0.* stack).,0 ,0 
Once RM HA is config'd  none of the RM summary info or RM dashboard widgets show data,Configure RM HA. None of the summary info shows in Services &gt; YARN &gt; Summary All of the RM Dashboard widgets show N/A,0 ,0 
On HDFS config page edit boxes with memory size values have incorrect behavior.,Go to HDFS config page.Change Name Node java heap size.Save configs.'Successful' message appears  but on config page edit boxes have wrong values.After clicking 'OK' fields get right value again.Same issue reproduced on Nano but it looks like there it fails to save configs.,0 ,0 
'Select Host' page on Resource Manager HA Enabling wizard does not save selected values after next/back steps,STR:1) Deploy cluster2) Go to Enable Resourse Manager Enable HA wizard3) Go to 'Select Host' page4) Select some different from default value in combobox 'Additional Resourse manager'5) Click 'Next' and go to 'Review' page6) Click 'Back' and again go to 'Select Host' page.Actual result: value in 'Additional Resourse Manager' is default againExpected result: value in 'Additional Resourse Manager' is the same with choosen previously.,0 ,1 
Flume service should be in STARTED state when no agents configured,When installing Flume service by default if we dont configure any agents  we end up with Flume being the only service shown in a red STOPPED state. For the case where there are no agents  this should be set to STARTED.,0 ,0 
HostNames and Slaves broken in two lines on Assign Slaves step,On Assign Slaves step  elements in the table got broken in two lines.see attached.,0 ,0 
Resource Manager HA: after enabling RM HA  UI does not display standby and active Resource Managers on Summary tab,STR:1) Deploy 3-node cluster2) Enable RM HA3) Go to YARN Service page  Summary tabResult: There are not Resource Managers on Summary tab4) Select config tab and after that return back to Summary tabResult: Summary tab is as expected,0 ,0 
Add security configs on Add service wizard,add service wizard doesn't add secure cinfigs,0 ,0 
Wizard: Adding Master component does not create and install the master host component,STR: On 3-node cluster  Go to Assign Masters page. Add another HBase Master. (Note: HBase Master and ZK server are only addable components.) Go forward to the review page. Review page will show correct information that 2 HBase master are selected for installation Eventually on deploying the cluster installation  HBase Master is only created and installed on the host that was a default selection on Assign Master page,0 ,0 
Cleanup of Cluster > Admin tab,1. Remove 'Users' and 'Access' category from 'Admin' tab on the main menu.2. Rename 'Clusters' --&gt; 'Repositories'3. Rename 'misc' --&gt; 'Service Accounts',0 ,0 
Ambari installation webhcat templeton.hive.properties set thrift host name to be localhost,PROBLEM:default installation of Ambari sets webhcat-site.xmltempleton.hive.properties=hive.metastore.local=false  hive.metastore.uris=thrift://localhost:9933  hive.metastore.sasl.enabled=falsethe proper value should be the FQDN of the thrift host name  plus hive.metastore.execute.setugi=truefor example:hive.metastore.local=false  hive.metastore.uris=thrift://this.fqdn.com:9933  hive.metastore.sasl.enabled=false hive.metastore.execute.setugi=true,0 ,0 
Need ResourceManager UI Quicklinks for active / standby,Similar to NN HA.,0 ,0 
FileConfigureTest can't pass in Windows box,Because of the File.separator is different between the unix and windows system. So the test can't pass in windows box.I just attached a patch for it. Please have a look at it  I tested it in windows box.,0,0
Throw Useful Exception on No TypeConverter Available,When there is no type converter available an NPE is thrown that requires tracing through sources to find root of problem,0,0
Most recent snapshot requires ActiveMQ,This may be moot given the projects' relationship  but it's a recently introduced side effect. Before the most recent snapshot  I was able to use Camel without any ActiveMQ jar's floating around so long as I never tried to use any 'activemq:queue:foo' URI's. Now with the most recent snapshot  the first time I do something that uses AnnotationTypeCoverterLoader  ActiveMQConverter gets loaded  and then causes a NoClassDefFoundError for ActiveMQDestination.,0,0
JMSXGroupID is not copied across ActiveMQ endpoints,See thread: http://www.nabble.com/MethodName-in-header-is-ignored-by-beanRef%28%29-tf4285009s22882.html#a12198390,0,0
enable polling via the http component,,0,0
XPath namespaces configuration not possible through xml,Xpath xml element offers no way to define namespace mappings.,0,0
URL link broken in org.apache.camel.Processor API doc,'Message Transformer' link is broken.,0,0
org.apache.camel.processor.UnitOfWorkWithAsyncFlowTest failure,Running org.apache.camel.processor.UnitOfWorkWithAsyncFlowTestTests run: 3  Failures: 1  Errors: 0  Skipped: 0  Time elapsed: 20.345 sec &lt;&lt;&lt; FAILURE!This prevents developer from building camel under Linux platform. Thanks!,0,0
New converter : Node -> Source,Currently  there is no converter from Node -&gt; Source.It is required when using Camel's splitter() functionality inside ServiceMix:from('jbi:service:urn:eu:java:smx:fleetintegrator:camel') .splitter(xpath('/traces/trace')) .to('jbi:endpoint:urn:eu:java:smx:fleetintegrator:jms:mq');,0,0
exception clause doesn't proceed with pipeline,Problem is very similar to CAMEL-191 but this time with exception clause.As exceptions are not cleared pipeline doesn't proceed.,0,0
the 1.2.0 release didnt' seem to include the javadocs or doc directory (or manual)!,I wondered if this was due to your machine Hiram having some dodgy maven plugin around or something?,0,0
Headers lost after XSLT processing,After xslt processing the message headers are lost. See attached unit test  this test fails since revision 590680.http://svn.apache.org/viewvc?view=rev&amp;revision=590680,0,0
Fix performance counters,,0,0
Upgrade geronimo-specs version to 1.1,from 1.0,0,0
Add getter method for routeCollection property in RouteBuilder class,I need to stop a RouteBuilder. A solution for this issue could be access to routeCollection property in RouteBuilder class.,0,0
cxf camel transport should support to register itself to the cxf bus automatically,when cxf bus init  all tranports module on the classpath should register itself to the bus automatically.cxf machenism for this is just add a spring bean to describe the transport id and transport factory class mapping per as below&lt;beans xmlns='http://www.springframework.org/schema/beans' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:foo='http://cxf.apache.org/configuration/foo' xsi:schemaLocation=' http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd'&gt; &lt;bean class='org.apache.camel.component.cxf.transport.CamelTransportFactory' lazy-init='true'&gt; &lt;property name='bus' ref='cxf'/&gt; &lt;property name='transportIds'&gt; &lt;list&gt; &lt;value&gt;http://cxf.apache.org/transports/camel&lt;/value&gt; &lt;/list&gt; &lt;/property&gt; &lt;/bean&gt;&lt;/beans&gt;,0,0
[Spring integration] TheadType is missing in org/apache/camel/model/jaxb.index,TheadType is missing in org/apache/camel/model/jaxb.index =&gt; JAXB don't know how to unmarshall thread.Bug description found in Camel Users forum : http://www.nabble.com/Processor-thread-pool-td13212513s22882.html,0,0
[Spring integration] Bad urls in META-INF/spring.schemas,http/://activemq.apache.org/camel/schema/spring/camel-spring-1.1.xsd becomes http/://activemq.apache.org/camel/schema/spring/camel-spring-1.1.0.xsdhttp/://activemq.apache.org/camel/schema/spring/camel-spring-1.2.xsd becomes http/://activemq.apache.org/camel/schema/spring/camel-spring-1.2.0.xsdThere's no camel-spring-1.1.xsd and camel-spring-1.2.xsd under http://activemq.apache.org/camel/schema/spring/,0,0
DeadLetterChannel - logging improvements when exchange handled by dead letter,The submitted patch have these improvements to the logger in deadletterchannel for delivery attempts outputs exchange id so we can correlate the lines in the log files. now also logs when the exchange could not be delivered and was handled by the failure processer (usually a deadletterchannel) minor issues with existing debug logging when sleeping (now also output millis) to be in line with other similar log lines in CamelI have not outputted the exchange itself (exchange.toString()) when the delivery could not be delivered successfully since there could be sensitive data in the exchange (e.g. an invoice input message) that we do not want to be logged in our log.But I think the logging of the exchange id is a good improvement and that they are aligned in the same position in the logline so it's easier to grep/find in the logs when you investigate and incident.,0,0
NullPointerException in CXF routes when there is an endpoint between router and service CXF endpoints,When an endpoint is added between a cxf router and a cxf service endpoint the message exchange is interrupted by a NullPointerException.Example code:----JAVA-BEGIN---------------------------------------------------------//This code worksfrom(StringUtils.join(cxfRouterURI)).to(StringUtils.join(cxfServiceURI)); // This code crashes (same problem with seda and log endpoints)String anyEndpoint = 'activemq:someQueue';----JAVA-END---------------------------------------------------------from(StringUtils.join(cxfRouterURI)).to(anyEndpoint).to(StringUtils.join(cxfServiceURI)); ----EXCEPTION-BEGIN-----------------------------------09/01/2008 18:32:40 org.apache.cxf.phase.PhaseInterceptorChain doInterceptINFO: Interceptor has thrown exception  unwinding noworg.apache.cxf.interceptor.Fault at org.apache.camel.component.cxf.interceptors.RawMessageContentRedirectInterceptor.handleMessage(RawMessageContentRedirectInterceptor.java:43) at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:207) at org.apache.camel.component.cxf.invoker.CxfClient.invokeWithMessageStream(CxfClient.java:137) at org.apache.camel.component.cxf.invoker.CxfClient.dispatch(CxfClient.java:89) at org.apache.camel.component.cxf.CxfProducer.process(CxfProducer.java:202) at org.apache.camel.component.cxf.CxfProducer.process(CxfProducer.java:152) at org.apache.camel.impl.converter.AsyncProcessorTypeConverter$ProcessorToAsynProcessorBridge.process(AsyncProcessorTypeConverter.java:44) at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:73) at org.apache.camel.processor.DeadLetterChannel.process(DeadLetterChannel.java:143) at org.apache.camel.processor.DeadLetterChannel.process(DeadLetterChannel.java:87) at org.apache.camel.processor.Pipeline.process(Pipeline.java:101) at org.apache.camel.processor.Pipeline.process(Pipeline.java:85) at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:40) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:44) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:68) at org.apache.camel.component.cxf.CamelInvoker.invoke(CamelInvoker.java:71) at org.apache.camel.component.cxf.interceptors.AbstractInvokerInterceptor.handleMessage(AbstractInvokerInterceptor.java:65) at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:207) at org.apache.camel.component.cxf.CxfMessageObserver.onMessage(CxfMessageObserver.java:83) at org.apache.cxf.transport.http_jetty.JettyHTTPDestination.serviceRequest(JettyHTTPDestination.java:284) at org.apache.cxf.transport.http_jetty.JettyHTTPDestination.doService(JettyHTTPDestination.java:240) at org.apache.cxf.transport.http_jetty.JettyHTTPHandler.handle(JettyHTTPHandler.java:54) at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:712) at org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:211) at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:139) at org.mortbay.jetty.Server.handle(Server.java:313) at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:506) at org.mortbay.jetty.HttpConnection$RequestHandler.content(HttpConnection.java:844) at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:726) at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:211) at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:381) at org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:396) at org.mortbay.thread.BoundedThreadPool$PoolThread.run(BoundedThreadPool.java:442)Caused by: java.lang.NullPointerException at org.apache.commons.io.IOUtils.copyLarge(IOUtils.java:1025) at org.apache.commons.io.IOUtils.copy(IOUtils.java:999) at org.apache.camel.component.cxf.interceptors.RawMessageContentRedirectInterceptor.handleMessage(RawMessageContentRedirectInterceptor.java:39) ... 32 more ----EXCEPTION-END-----------------------------------Known workaround:Change the code like this:----JAVA-BEGIN--------------------------------------------------------- String anyEndpoint = 'activemq:someQueue'; from(StringUtils.join(cxfRouterURI)).process(new Processor(){ public void process(Exchange exchange) throws Exception { exchange.setOut(exchange.getIn()); } }).to(anyEndpoint).to(StringUtils.join(cxfServiceURI));----JAVA-END---------------------------------------------------------,0,0
support to set the aggregation stragey of multicastProcessor,I have a use case   the router configuration could like this from('direct:a').multicast().to('direct:x'  'direct:y'  'direct:z');  from('direct:x').process(new AppendingProcessor('x')).to('direct:aggregater'); from('direct:y').process(new AppendingProcessor('y')).to('direct:aggregater'); from('direct:z').process(new AppendingProcessor('z')).to('direct:aggregater'); from('direct:aggregater').aggregator(header('cheese')  new BodyAggregatingStrategy()). completedPredicate(header('aggregated').isEqualTo(3)).to('mock:result');Now I send the message to endpoint 'direct:a' and I want to get the final result of the processors.And this requirement is much like the CAMEL-260.,0,0
MulticastRecipientList - recipient list that uses multicast processor,Probably it would be useful to have recipientList that in InOut mode doesn't work as a pipeline. I faced that problem  however InOnly is ok. It seems in InOut it reminds of RoutingSlip. Optionally we could use MulticastProcessor to process 'recipients'. If you think it makes sense  attached patch enhances camel-core with such feature.,0,0
Remove tangle between impl and impl.converter,Currently impl and impl.converter reference each other. If possible such cycles should be avoided.When I looked into it I found that impl.converter references only a single class CachingInjector. No other class in camel-core seems to use this class. So my suggestion is to move CachingInjector to impl.converter. So the cycle i removed. As far as I can see this should cause no ther issues.,0,0
Multithreaded HTTP invocations doesn't work,Description of the bug:http://www.nabble.com/Multithreaded-http-endpoint-to13646722s22882.html#a13646722,0,0
DefaultParameterMappingStrategy doesn't load its defaults,This is preventing BeanProcessor from using bean methods with a Message parameter  or bean methods not named 'process' that have an Exchange as their parameter. For example  to map to a Message the it tries using the ParameterExpression bodyAs(Message.class) instead of inmessageExpression().,0,0
spring-2.5.1.jar is twice in the camel distro,I downloaded the latest snapshot apache-camel-1.3-20080210.022044-67.zip fromhttp://people.apache.org/repo/m2-snapshot-repository/org/apache/camel/apache-camel/1.3-SNAPSHOT/The .zip file contains spring-2.5.1.jar twice/camel/lib/camel/lib/optionalIs Spring both mandatory and optional?And btw it includes an old version of commons-logging-1.0.4.jar. v1.1 of commons logging is out.,0,0
bad content length header value in http response,By default HttpBinding class copies all request header attributes from the request to the response including 'Content-Length'. So the consequence is that the response is declaring the same size as the request which can lead to serious truncation problems! the workaround is simply to add the line:out.removeHeader('Content-Length'); in the writeResponse method of the httpbinding class allowing jetty to set the right value.,0,0
Mail component is missing some configuration possibilities,It should be possible to configure the behaviour of the mail component. see thread: http://www.nabble.com/Problem-with-Camel-Mail-Component-in-Route-td15497818s12049.html#a15497818,0,0
Mina TCP does not support InOut pattern,See this thread:http://www.nabble.com/camel-mina-TCP-InOut-exchange-td15530602s22882.htmlThis builder does not support InOut when a client send a textline to localhost:8888.The client never receives a response.url = 'mina:tcp://localhost:8888?textline=true';from(uri).process(new Processor() { public void process(Exchange e) { String in = e.getIn().getBody(String.class); // append newline at end to denote end of data for textline codec e.getOut().setBody('Hello ' + in + '/n'); } });Attached is a patch that fixes this by introducing a new parameter to the URL for fluent builder sync=true (ie is there a better name?)Using this url instead and the patch then Camel will send a response back to the client:mina:tcp://localhost:8888?textline=true&amp;sync=true,0,0
Synchronous mode should handle exceptions being thrown from MINA,Camel MINA in synchronous mode (InOut exchange pattern) does not handle exception thrown from MINA. Currently MINA intercepts this and logs the exception at WARN level.We should override the proper method in Mina and handle it so the end user can deal with it.Also it has been raisen on the forum that it does not propogate header and other properties. This should be raised in another ticket.In the weekend I will work on a patch for Camel to fix this problem.,0,0
camel-mina: allowing the lazy creation of a connection,In the current implementation with a mina component producer if the server is not up when we start Camel it fails. This is because the mina session creation is in the doStart method which is called when Camel starts.A simple solution is to optionally allow to lazily create the session just before sending the exchange in the Producer's process method.,0,0
camel-cxf component can't deal with the exception message in MESSAGE dataFormat,From: Willem JiangTo: camel-user@activemq.apache.orgSubject: Re: camel-cxf throwing a faultDate: Wed  05 Mar 2008 16:26:41 +0800Reply-To: camel-user@activemq.apache.orgHi Marc It looks like camel-cxf component's issue which can't deal with the exception message in MESSAGE dataFormat.Could you fill a JIRA for it ? I will fix it later this week.As usual  you just need throw the exception from the processor   CXF will try to marshal it into a soap fault.Regards WillemMarc Giger wrote:&gt; Hi &gt;&gt; I'm trying to get the following camel route working where the&gt; dataformat is MESSAGE.&gt;&gt; &lt;from uri='cxf:bean:routerEndpoint?dataFormat=MESSAGE'/&gt; &gt; &lt;process ref='decryptProcessor'/&gt; &gt; &lt;choice&gt;&gt; &lt;when&gt; &gt; &lt;methodCall bean='endpointSelector' method='matches'/&gt;&gt; &lt;to uri='cxf:bean:serviceEndpoint?dataFormat=MESSAGE'/&gt; &gt; &lt;/when&gt;&gt; &lt;otherwise&gt; &gt; &lt;to uri='cxf:bean:localEndpoint?dataFormat=MESSAGE'/&gt; &gt; &lt;/otherwise&gt;&gt; &lt;/choice&gt; &gt;&gt; if the endpointSelector bean returns true the request is redirected to&gt; a remote webservice.&gt; otherwise the request is forwarded to a local cxf service (with&gt; local-transport)&gt;&gt; Now  if I invoke the routerEndpoint and somewhere in the pipeline&gt; happens an exception (in my case in the decryptProcessor)  I get the&gt; following Exception in the outFault chain:&gt;&gt; Mar 4  2008 10:48:35 PM org.apache.cxf.phase.PhaseInterceptorChain&gt; doIntercept INFO: Interceptor has thrown exception  unwinding now&gt; org.apache.cxf.interceptor.Fault&gt; at&gt; org.apache.camel.component.cxf.interceptors.RawMessageContentRedirectInterceptor.handleMessage(RawMessageContentRedirectInterceptor.java:43)&gt; at&gt; org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:208)&gt; at&gt; org.apache.cxf.interceptor.OutgoingChainInterceptor.handleMessage(OutgoingChainInterceptor.java:74)&gt; at&gt; org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:208)&gt; at&gt; org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:77)&gt; at&gt; org.apache.cxf.transport.servlet.ServletDestination.doMessage(ServletDestination.java:79)&gt; at&gt; org.apache.cxf.transport.servlet.ServletController.invokeDestination(ServletController.java:264)&gt; at&gt; org.apache.cxf.transport.servlet.ServletController.invoke(ServletController.java:160)&gt; at&gt; org.apache.cxf.transport.servlet.AbstractCXFServlet.invoke(AbstractCXFServlet.java:170)&gt; at&gt; org.apache.cxf.transport.servlet.AbstractCXFServlet.doPost(AbstractCXFServlet.java:148)&gt; at javax.servlet.http.HttpServlet.service(HttpServlet.java:727) at&gt; javax.servlet.http.HttpServlet.service(HttpServlet.java:820) at&gt; org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:487)&gt; at&gt; org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:362)&gt; at&gt; org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)&gt; at&gt; org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181)&gt; at&gt; org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:712)&gt; at&gt; org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:405)&gt; at&gt; org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:211)&gt; at&gt; org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114)&gt; at&gt; org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:139)&gt; at org.mortbay.jetty.Server.handle(Server.java:313) at&gt; org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:506)&gt; at&gt; org.mortbay.jetty.HttpConnection$RequestHandler.content(HttpConnection.java:844)&gt; at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:644) at&gt; org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:211) at&gt; org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:381) at&gt; org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:396)&gt; at&gt; org.mortbay.thread.BoundedThreadPool$PoolThread.run(BoundedThreadPool.java:442)&gt; Caused by: java.lang.NullPointerException at&gt; org.apache.commons.io.IOUtils.copyLarge(IOUtils.java:1025) at&gt; org.apache.commons.io.IOUtils.copy(IOUtils.java:999) at&gt; org.apache.camel.component.cxf.interceptors.RawMessageContentRedirectInterceptor.handleMessage(RawMessageContentRedirectInterceptor.java:39) ...&gt; 28 more&gt;&gt; This is because the InputStream is null in&gt; RawMessageContentRedirectInterceptor:&gt;&gt; public void handleMessage(Message message) throws Fault {&gt;&gt; InputStream is = message.getContent(InputStream.class);&gt; OutputStream os = message.getContent(OutputStream.class);&gt; &gt; try { &gt; IOUtils.copy(is  os);&gt; is.close();&gt; os.flush();&gt; } catch (Exception e) {&gt; throw new Fault(e);&gt; }&gt; }&gt;&gt; How can I return a custom soap-fault in a processor/filter?&gt;&gt; Thanks &gt;&gt; Marc&gt;&gt;,0,0
SftpConsumer is not connecting and retrieving remote files,SftpConsumer does not connect to server due to patch for CAMEL-251. The SftpConsumer also checks remote file modification timestamp against last poll timestamp but incorrectly converts seconds to milliseconds using integer math so the resulting conversion is always negative and will never retrieve file. I will attach the fixes to this issue.,0,0
Mina Producer should have configurable timeout,Currently the camel mina producer (MinaProducer) defaults to have a 10 sec timeout.This is currently not possible to configured eg from the URL parameters etc.Also we should documented on the wiki that 10 sec. is default.,0,0
HttpBinding.writeResponse doesn't set the response status code (i.e. it's always 200),When writing out an Http response  the HttpBinding should check for the existing of the header HttpProducer.HTTP_RESPONSE_CODE and set it in the response if it's there. This allows requests made via the http component to be output with the correct status code info. If also allows processors in the flow to control the status code by setting the header themselves.,0,0
camel-mina improvements,This ticket holds reference to the various camel-mina improvments and bugfixes lately.,0,0
Support for a full customized soap-fault incl. fault-code and detail,Don't wrap a Fault in a Fault.,0,0
Parallel processing route,Adding the support of this user story CXF Consumer -&gt; Route ---&gt; parallelly send messages and recieve responses---&gt; aggregate response --&gt; further process ----&gt; returnHere is more information about this story &#91;1&#93;http://www.nabble.com/Parallel-processing-route-td15642110.html#a15642110,0,1
Improve logging for camel-mina,Currently camel-mina does not log using similar log classnames for a MinaProducer and MinaConsumer. This can be a bit misleading in the log files.MinaConsumer uses an anonymous inner class to do the IoHandler where as MinaProducer does not. This renders the loglines such asMinaConsumer$1 - XXXMinaProducer$RecieveHandler - XXXMinaConsumer should use a non anonymous inner classes so logging is the same:MinaConsumer$RecieveHandler - XXXMinaProducer$ResponseHandler - XXX,0,0
MinaProducer waits for MINA worker thread to timeout when stopping JVM from standalone client,I was working on a camel-mina-example sample that starts a MinaProducer to send data to a TCP server. When my sample terminates the JVM it waits 60 seconds until the MINA worker threads times out (default 60 sec).As a workaround using System.exit(0) will terminate my client JVM immediately. And running my client as a JUnit tests will also in fact terminate the JVM immediately.The code below demonstrates this: Running as JUnit runs within a few seconds. Run it as a standard java main app and it terminates after 60+ secondsThe code is a test I am working on for the patch to fix it. (I got it fixed but I want a better unit test)public class MinaProducerTest extends ContextTestSupport { public static void main(String[] args) throws Exception { MinaProducerTest test = new MinaProducerTest(); test.producerRunningFromMain(); } private void producerRunningFromMain() throws Exception { long start = System.currentTimeMillis(); System.out.println('+++ start +++'); context = new DefaultCamelContext(); context.addRoutes(createRouteBuilder()); context.start(); testProducer(); context.stop(); System.out.println('+++ stop +++'); long end = System.currentTimeMillis(); assertTrue('Should stop within 5 seconds'  end - start &lt; 5000); // TODO: add shutdown hook to verify that its stopped before 5 seconds  or mocks  } private static final String uri = 'mina:tcp://localhost:6321?textline=true'; protected RouteBuilder createRouteBuilder() { return new RouteBuilder() { public void configure() { from(uri).to('mock:result'); } }; } public void testProducer() throws Exception { MockEndpoint mock = getMockEndpoint('mock:result'); mock.expectedBodiesReceived('Hello World'); Endpoint endpoint = context.getEndpoint(uri); Producer producer = endpoint.createProducer(); Exchange exchange = endpoint.createExchange(); exchange.getIn().setBody('Hello World'); producer.start(); producer.process(exchange); producer.stop(); assertMockEndpointsSatisifed(); } // TODO: Test using mocks requires many codelines to mock all the producer  endpoints etc.},0,1
Javadoc warnings,Get the javadoc warnings reported by the javadoc generator fixed.,0,0
Exception handling of the ErrorHandlerSupport class,When you configure your route builder and say you want to configure two exceptions lets say: NullPointer and Exception. Now say the bean you call as your end point throws a NullPointer  wouldn't you think the NullPointer policy would handle that exception? Well I'm seeing sometimes it does and sometimes it doesn't due to the map not keeping the exceptions in any particular order. Is there anyway this could be changed to a LinkedHashMap or a List?Issue with class: org.apache.camel.processor.ErrorHandlerSupport,0,0
Improve FTP component wiki documentation,The wiki documentation for FTP usage could be improved with: java code examples (snippets in unit test classes) that you need the convertTo(String.class) for ASCII file transfer The FTP component is an extension of the File component so it inherits behaviour  features and options from file. State precise witch options a FTPProducer and FTPConsuer can use. Consuming using FTP there are special header key/values for the remote filename etc. that could be of interest for the end users (Maybe for the producer as well),0,0
splitter() should have the same parallel processing functionality that multicast() has,Ability to havefrom('direct:parallel').splitter(body().tokenize(' ')  true).to('mock:result');where true parameter to splitter should behave like in multicast() &#8212; processing is done in separate threads for each 'part'.,0,1
Improve File component wiki,I have added two missings options and then I discovered a few more missing so I am created this ticket so we get this done.The File Component has several options we haven't documented on the wiki yet.Also its javadoc should be improved.And we should provide some better java samples on the wiki.,0,0
Upgraded to OpenJPA 1.0.2,OpenJPA in release 1.0 and onwards requires a change in the ant build in the pom.xmlIt now requires a persistance.xml file to use.,0,0
Invalid jar in binary distribution,The apache-camel jar in the binary distribution misses a lot of files  including class and schema files (12k in size compared to the 1.9M released jar).,0,0
Camel should raise an exception if parsing of xslt file fails,Consider a Camel route that involves an xslt component. When Camel sets up the route  the XsltBuilder ignores any errors coming from the xerces xml parser and continues constructing the route even though the xslt transformer is not initialized. Later when the route is executed Camel correctly checks if the transformer is initialized and raises an error if not:java.lang.IllegalArgumentException: No transformer configured!However in case of a parse error in the xslt file  the whole route becomes unusable and the setup routine that constructs the route should fail with an appropriate error message. A sanity check needs to be added in methodorg.apache.camel.builder.xml.XsltBuilder.setTransformerSource(javax.xml.transform.Source).,0,0
file endpoint with noop=true does not detect old files moved into a directory,,0,0
camel-core does not compile on HP-UX,camel-core/src/main/java/org/apache/camel/model/ProcessorType.java:&#91;871 12&#93; inconvertible types found : org.apache.camel.model.ProcessorType&lt;Type&gt; required: org.apache.camel.model.InterceptTypecamel-core/src/main/java/org/apache/camel/model/ProcessorType.java:&#91;872 39&#93; inconvertible types found : org.apache.camel.model.ProcessorType&lt;Type&gt; required: org.apache.camel.model.InterceptTypecamel-core/src/main/java/org/apache/camel/model/ProcessorType.java:&#91;884 12&#93; inconvertible types found : org.apache.camel.model.ProcessorType&lt;Type&gt; required: org.apache.camel.model.InterceptTypecamel-core/src/main/java/org/apache/camel/model/ProcessorType.java:&#91;885 38&#93; inconvertible types found : org.apache.camel.model.ProcessorType&lt;Type&gt; required: org.apache.camel.model.InterceptType,0,0
make it easier to create Endpoint instances nicely via Spring XML,right now its a bit tricky creating Endpoint instances in a spring XML using the &lt;bean&gt;&lt;property&gt; mechanism.It'd be nice to be able to configure them more easily as...&lt;bean id='foo' class='org.apache.camel.component.file.FileEndpoint'&gt; &lt;property name='foo' value='bar'/&gt; ...type stuff and have folks Spring IDE's smart complete stuff etc,0,0
JMX Connector is not closed by InstrumentationAgentImpl.doStop(),,0,1
Document - File component when its using file or directory names,Yes I think we need to document it much better how Camel handles this file/folder stuff when its consuming files producing filesIt's a bit confusing when Camel uses the unique message id for filename instead of the path from the URI.,0,0
Javadoc - improve summaries etc,The javadoc could use to be polished for eg. summaries statis the Apache license instead of a short brief summary what the class/package does etc.It's all the javadoc also for the components.,0,0
IntrumentationProcessor does properly record processing time,The InstrumentationLifeCycleStrategy inserts an InstrumentationProcessor interceptor at the end of a route which is intercepted after the processing has been done. The InstrumentationProcessor does not actually record the time spent on the route. It is fixed by inserting InstrumentationProcessor at the beginning of the route and wrapping all the outputs.There two MBeans (ManagedRoute and PerformanceCounter) registered for each route eventhough ManagedRoute already extends PerformanceCounter. We probably only need to expose one MBean. The ManagedRoute MBean shows performance attributes and operations (since it extends PerformanceCoutner) but these performance related stuffs don't really work. This is fixed by registering only the ManagedRoute MBean and making the performance related attributes and operations functional.This patch supports exposing all processors within a route as PerformanceCounter MBeans so that users are possible to monitor performance at the processor's level.With this patch  the org.apache.camel.spi package no longer depends CamelNamingStrategy of the org.apache.camel.management.management package. It follows the suggestion mentioned in https://issues.apache.org/activemq/browse/CAMEL-264.Another update is to following the JMX spec convention of including a 'type' property in the ObjectName (replacing the current 'groups' property). This patch also simplify the ManagedRoute's ObjectName a bit by removing builder and group properties. If for some reasons  they need to be in the ObjectName  please add them back.,0,0
camel-cxf component not propagating context data,For POJO data formats the CxfProducer currently invokes the following method to invoke on a target serverresult = client.invoke(operation  parameters.toArray());This fails to setup the Request and Response contexts for the out (request) message and in (response) message. It should instead be copying the relevant data from the consumer and invoking the following operation on the Client interfaceObject[] invoke(BindingOperationInfo oi  Object[] params  Map&lt;String  Object&gt; context) throws Exception;Likewise the PAYLOAD and MESSAGE data formats are not setting up their contexts before they call the dispatch operation. In fact there is comments in the current codebase... // invoke the message prepare the context Map&lt;String  Object&gt; context = new HashMap&lt;String  Object&gt;(); Map&lt;String  Object&gt; requestContext = new HashMap&lt;String  Object&gt;(); Map&lt;String  Object&gt; responseContext = new HashMap&lt;String  Object&gt;(); // TODO Get the requestContext from the CamelExchange context.put(CxfClient.REQUEST_CONTEXT  requestContext); context.put(CxfClient.RESPONSE_CONTEXT  responseContext);The fix should also include a fix for all three data format types,0,0
XsltBuilder synchronizes on process method making performance bad on XSLTs,In heavy load environment XSLT transformations have very bad performance.I propose to use javax.xml.transform.Templates object to produce separate Transformers for every execution.,0,1
The spi package should not depend on the processor package,I have found one other problem in RouteContext. The method intercept uses the class Interceptor from processor. I think Interceptor should be an interface that should reside in spi or camel. So we could avoid referencing the processor package from spi.When I look into the current Interceptor implementation I think the two main methods that need to be in the interface are process and proceed. Process can be inherited from Processor but proceed is only declared in the implementation class DelegateProcessor. So I think the clean way to handle this would be to create an interface DelegateProcessor and a spearate DefaultDelegateProcessor.public interface DelegateProcessor extends Processor { /** * Proceed with the underlying delegated processor */ public abstract void proceed(Exchange exchange) throws Exception; }and an interface Interceptorpublic interface Interceptor extends DelegateProcessor { public abstract void process(Exchange exchange) throws Exception; public abstract Processor getInterceptorLogic(); public abstract void setInterceptorLogic(Processor interceptorLogic); }When we put these to spi and use them instead of the implementations where possible the spi would not depend on processor anymore.,0,0
NPE from came:run with below route codes,With the following route: from('timer://tutorial?fixedRate=true&amp;period=10') .setBody( constant('&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;greetMe&gt;Hello World&lt;/greetMe&gt;')) .setHeader('CBR1'  constant('No')).choice().when( header('CBR1').isEqualTo('Yes')).setHeader( 'CreditcardValidation'  constant('Yes')).to( 'log:CBRBean?level=INFO').to('log:XSLT for provider1?level=INFO') .when(header('CBR1').isEqualTo('No')).setHeader( 'CreditcardValidation'  constant('No')).to( 'log:XSLT for provider2?level=INFO').end().choice() .when(header('CreditcardValidation').isEqualTo('Yes')) .to('log:CCVBean?level=INFO').to('log:XSLT for consumer1?level=INFO').when( header('CreditcardValidation').isEqualTo('No')) .to('log:XSLT for consumer2?level=INFO').otherwise() .to('log:test?level=INFO').end();running mvn camel:run I get the following stack trace:java.lang.NullPointerException at org.apache.camel.view.NodeData.&lt;init&gt;(NodeData.java:136) at org.apache.camel.view.GraphGeneratorSupport.getNodeData(GraphGeneratorSupport.java:142) at org.apache.camel.view.RouteDotGenerator.printNode(RouteDotGenerator.java:101) at org.apache.camel.view.RouteDotGenerator.printNode(RouteDotGenerator.java:123) at org.apache.camel.view.RouteDotGenerator.printRoute(RouteDotGenerator.java:87) at org.apache.camel.view.RouteDotGenerator.printRoutes(RouteDotGenerator.java:64) at org.apache.camel.view.RouteDotGenerator.printRoutes(RouteDotGenerator.java:48) at org.apache.camel.view.RouteDotGenerator.generateFile(RouteDotGenerator.java:169) at org.apache.camel.view.GraphGeneratorSupport.generateFile(GraphGeneratorSupport.java:103) at org.apache.camel.view.GraphGeneratorSupport.drawRoutes(GraphGeneratorSupport.java:81) at org.apache.camel.spring.Main.generateDot(Main.java:392) at org.apache.camel.spring.Main.postProcessContext(Main.java:374) at org.apache.camel.spring.Main.doStart(Main.java:333) at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:47) at org.apache.camel.spring.Main.run(Main.java:123) at org.apache.camel.spring.Main.run(Main.java:114) at org.apache.camel.spring.Main.main(Main.java:106) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:585) at org.apache.camel.maven.RunMojo$1.run(RunMojo.java:333) at java.lang.Thread.run(Thread.java:613)the error seems related to the maven camel plugin failing generating the dot file for the route.,0,0
File component - noop does not lock the file during processing,The noop=true option does not lock the file during processing as it states in its class javadoc. The parameter is false. It should be true instead. public NoOpFileProcessStrategy() { super(false); },0,0
camel-spring is dependent on spring-aop,&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-aop&lt;/artifactId&gt; &lt;version&gt;${spring-version}&lt;/version&gt; &lt;/dependency&gt;is needed in pom.xml for camel-spring as its needed to let camel-spring component work out-of-the-box. Without it the camel-example-spring does not work and blows up with a ClassNotFoundException when you use camel:run,0,0
Multicast default excecutor do not create the enough thread for parallel processing,When I added the loan broker example CAMEL-556  I found there is no performance improvement when using the parallelly mulitcast.After digging into to code  I found we should create the enough thread for the parallel processing.,0,1
CamelTemplate should clear endpoint cache when stopping,Only the producer cache is stopped and cleared // start and stop in camel template protected void doStart() throws Exception { producerCache.start(); } protected void doStop() throws Exception { producerCache.stop(); } // stop in producer cache protected void doStop() throws Exception { ServiceHelper.stopServices(producers.values()); producers.clear(); },0,0
JMX Instrumentation - PerformanceCounter - total processed,William Tam  this one is for you The total processed time is not exposed to as a managed attribute. And it should be changed from double to long.,0,0
[patch] Make sure streams get closed,a couple places streams are opened and are not closed. patch fixes this.,0,1
Missing compile step in example readmes,I noticed that some examples that are run via mvn exec:java require that the example be compiled first. I've updated the readmes to include this step...,0,0
[patch] postpone creating browsing strategy until and only if its needed,code creates queue browsing strategy even if not needed. patch pushes creation down to relevant branch.,0,0
Change the JMX default connetor's URL to avoid the confilict with the ActiveMQ or ServiceMix JMX default connector,Since the Camel default JMX connector's URL is same with ActiveMQ and ServiceMix default JMX Connector URL  we need to change it to avoid the conflict.,0,0
Headers should be modifiable using velocity templates,See context at:http://www.nabble.com/Exchange-headers-in-velocity-td17916457s22882.html,0,0
ResequencerType.createProcessor could throw NPE as stream config does not get initialized.,java.lang.NullPointerException at org.apache.camel.model.ResequencerType.createStreamResequencer(ResequencerType.java:198) at org.apache.camel.model.ResequencerType.createProcessor(ResequencerType.java:163) at org.apache.camel.model.ProcessorType.createOutputsProcessor(ProcessorType.java:1584) at org.apache.camel.model.ProcessorType.createOutputsProcessor(ProcessorType.java:93) at org.apache.camel.model.InterceptorRef.createProcessor(InterceptorRef.java:61) at org.apache.camel.model.ProcessorType.makeProcessor(ProcessorType.java:1471) at org.apache.camel.model.ProcessorType.addRoutes(ProcessorType.java:97) at org.apache.camel.model.RouteType.addRoutes(RouteType.java:210) at org.apache.camel.model.RouteType.addRoutes(RouteType.java:80) at org.apache.camel.impl.DefaultCamelContext.startRouteDefinitions(DefaultCamelContext.java:462) at org.apache.camel.impl.DefaultCamelContext.doStart(DefaultCamelContext.java:454) at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:47) at org.apache.camel.ContextTestSupport.startCamelContext(ContextTestSupport.java:108) at org.apache.camel.ContextTestSupport.setUp(ContextTestSupport.java:81) at org.apache.camel.processor.ResequencerTest.setUp(ResequencerTest.java:48) at junit.framework.TestCase.runBare(TestCase.java:128) at junit.framework.TestResult$1.protect(TestResult.java:106) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.framework.TestResult.run(TestResult.java:109) at junit.framework.TestCase.run(TestCase.java:120) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:130) at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196),0,0
File component - file rename pattern to support patterns such as date time etc.,A very common use case is to copy received messages into files stored in a backup folder with sub folders named with the date pattern etc.,0,0
JMX Instrumentation - PerformanceCounter - last processed timestamp when failed,I thought about another real life use case we have at work once in a while.a) when was the last time the integration worked?b) when was the last time the integration was invoked?We do have option a covered now with lastExchangeCompletionTime.However I would like another timestamp for lastExchangeTime that is just a record the last time it was processed (even if it failed).PS: At work we do have to grep through logfiles in our legacy EIP platform.,0,0
DeadLetterChannel default redelivery policy eclipsed expected transactional behaviour in a transacted route,Camel routes get a DLC processor with a redelivery policy  which defaults to redeliverying a message to a destination processor up to 6 times. In case of a transacted route it is preferable that DLC's delivery policy be reset to a single attempt  so that a fan-out transacted route would not hold tx locks on destinations for too long. The DLC's default redelivery policy has also made transactional tests not really testing tx behavior of Camel Components backed runtimes (jms brokers  etc)  rather DLC would catch the exception and try to redeliver the message to destination processor and not letting the components to rollback native transactions initiated by components backed runtimes (jms  db)The attached patch installs a property into Camel Exchange that indicates weather a route is transacted. This is done in org.apache.camel.spring.spi.TransactionInterceptor.javaDLC then checks if the flow is transacted and sets its redelivery policy to 1With this change JMS transactions are actually rolled back and messages are put back into the queue and then consumed again  verifying that brokers support transactions and can redeliver messages into Camel routes that were previously rolled back.,0,1
ResolverUtil can't resolve converter annotations in WebSphere 6.1,I have a simple hello world file based ESB that scans a folder for files  invoke a POJO and store the output as a file in another folder.Deployed as a WAR file in WebSphere it seems as if Camel 1.4-SNAPSHOT can not load the converters needed to converter to String to InputStream for the FileProducer when it is about to store the file.The logging output where the ResolverUtil can't find the annotated converters in camel jar itself[06-25 13:31:23] DEBUG ResolverUtil [Thread: 1 org.apache.camel.component.file.FileComponent@7ade7ade]: Searching for annotations of org.apache.camel.Converter in packages: [org.apache.camel.spring.converter  org.apache.camel.converter][06-25 13:31:23] DEBUG ResolverUtil [Thread: 1 org.apache.camel.component.file.FileComponent@7ade7ade]: Found: []And the stacktrace:org.apache.camel.InvalidPayloadException: No in body available of type: java.io.InputStream but has value: This is important work/temp/camel/in/README.txtDone by me. of type: java.lang.String on: Message: This is important work/temp/camel/in/README.txtDone by me. on the exchange: Exchange[Message: This is important work/temp/camel/in/README.txtDone by me.] at org.apache.camel.util.ExchangeHelper.getMandatoryInBody(ExchangeHelper.java:127) at org.apache.camel.component.file.FileProducer.process(FileProducer.java:67) at org.apache.camel.component.file.FileProducer.process(FileProducer.java:55) at org.apache.camel.impl.converter.AsyncProcessorTypeConverter$ProcessorToAsyncProcessorBridge.process(AsyncProcessorTypeConverter.java:43) at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:75) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:57) at org.apache.camel.processor.DeadLetterChannel.process(DeadLetterChannel.java:146),0,0
jms aggregation does not work,I found this issue when I test Camel 1.4.0 RC2 kit  I just add a test case to show the error.https://svn.apache.org/repos/asf/activemq/camel/trunk/components/camel-jms/src/test/java/org/apache/camel/component/jms/AggregratedJmsRouteTest.javaYou can reproduce the error if you remove the x character from xtestJmsMulticastAndAggregration() method.BTW the test case works with the Camel 1.4.0 RC1.,0,0
camel-cxf example build.xml is out of date,Need to update the build.xml of example-camel-cxf to support run the examples of camel transport and web service provider API.,0,0
Bean method lost when sending a message from one JMS queue to another,I noticed a problem in JmsBinding.java. If Camel has read a JMS message from a queue and that message has a bean method specified in the header ('org.apache.camel.MethodName')  the method header will removed if that message is written to another queue. Here's the offending code:  protected boolean shouldOutputHeader(org.apache.camel.Message camelMessage  String headerName   Object headerValue) { return headerValue != null &amp;&amp; !getIgnoreJmsHeaders().contains(headerName) &amp;&amp; ObjectHelper.isJavaIdentifier(headerName); } 'org.apache.camel.MethodName' fails the check isJavaIdentifier and is excluded from the headers written to the new message. I'm not sure the purpose of this check  but this might be an unintended side effect. The call chain is something like this: JmsProducer.process JmsBinding.makeJmsMessage JmsBinding.appendJmsProperties JmsBinding.shouldOutputHeader Update: Experimenting later with WebLogic's JMS  I noticed that WebLogic (9.2) does not allow this header name. Maybe this was the original motivation for this check. In order to be compatible with WebLogic  perhaps the method header name should changed to something like 'CamelMethod'. I believe this would correct both problems.,0,0
Component documentation - needs overhaul  check for missing options  add more samples java/spring  etc,Our extensive list of components needs to be checked for its state of current documentation standard in the wiki.The should be checked for options headers they use/set pitfalls samples both java and spring XML see also etcAnd whats the difference / relation to similar component (the http ones  the sql ones etc.),0,0
create a TransactionErrorHandler so you can easily  use a transaction & rollback on a route - with redeliveryDelay to just fail the route if it can't be processed,,0,0
Transactional Client - Setting Spring Policy is a bit cumbersome in the XML,Currently you have to setup the transaction demarcation in the spring xml file as: &lt;bean id='PROPAGATION_REQUIRED' class='org.apache.camel.spring.spi.SpringTransactionPolicy'&gt; &lt;constructor-arg&gt; &lt;bean class='org.springframework.transaction.support.TransactionTemplate'&gt; &lt;property name='transactionManager' ref='jmsTransactionManager'/&gt; &lt;/bean&gt; &lt;/constructor-arg&gt; &lt;/bean&gt;to be able to use the policy from XML directly in the tag: &lt;camel:policy ref='PROPAGATION_REQUIRED'/&gt;We should support a neater syntax without the nested bean and constructor args.,0,0
Upgrade Geronimo specs to 1.1.1 when available,We should upgrade to the 1.1.1 version of the different Geronimo specs jar &#8211; they include the necessary OSGi metadata.,0,0
CXF - Feedback from Eduard on problems with CXF over JMS,See user forum:http://www.nabble.com/Fwd%3A-Using-Apache-Camel-as-Transport-for-Apache-CXF-with-SOAP-over-JMS-td18314917s22882.html,0,0
process method of should check ExchnagePAttern before setting out,,0,0
ProducerTemplate doenst honor exchange pattern when it extracts the result,The code the extracts the result that is returned when you use the sendXXX  requestXXX methods on the producer template doens't honor the exchange pattern. protected Object extractResultBody(E result) { Object answer = null; if (result != null) { Message out = result.getOut(false); if (out != null) { answer = out.getBody(); } else { answer = result.getIn().getBody(); } } return answer; }It defaults to preferring out messages all the time. But in some circumstances the out body could be set to null but the real response is in the in body.Setting the exchange pattern to InOnly doesn't honor this.Maybe this ticket is a symptom of the MEP problem that we have in Camel. See the discussion on the dev forum.,0,0
transform() doesnt propogate headers,The new transform() DSL doesn't propogate headers so you can not do: from('direct:four') .transform().constant('London') .to('mock:result');And expect that any headers on the exchange at direct:four is received after the transform,0,0
JMX Instrumentation - Nodeid can be null,The processors that is registered in JMX can have null in their id. So the JMX path is processor -&gt; null -&gt; 0.Either we should replace null with unknown as we do for endpoints. Or try to fix that the id is generated.,0,0
CXF - Easier use for end-user to retreive POJO data,I am working on a web app example that uses CXF to expose a webservice.During the process I thought that getting my POJO object (InputReportIncident) was a bit clumsy as I had to do; MessageContentsList list = exchange.getIn().getBody(MessageContentsList.class); InputReportIncident in = (InputReportIncident) list.get(0);So I have created a patch that improves the getBody to be more end-user friendly.You can now do  as you always do in Camel: InputReportIncident in = exchange.getIn().getBody(InputReportIncident.class);Just cast it to what you expect and want to work with.InputReportIncident is a POJO object generated by the CXF wsdl2java generator.Willem could you take a look? Maybe I have misunderstood the CXF and there is a easier way already. But I don't like the need to get the List and then get (0) to get my POJO.Sending the response is already supported nicely: // the response OutputReportIncident out = new OutputReportIncident(); out.setCode('Bye Claus'); exchange.getOut().setBody(out);,0,0
FileProducer - consumes file instead of producing!,The strange code in the FileProducer that if the exchange is out capable it will poll the file instead bites us big time.James must have had a beer and a fancy moment when he created the code. Something with a dynamic receipentlist where the endpoints should be polled from a file but the expression uses a Producer when the endpoints is created. For the file it should consume instead but it doesn't. Any basically it should consume instead.It also bites us when we send an InOut exchange to the FileProducer it will not produce the file but consume it and there is no file so nothing happens.This codepublic class FileBackupTest extends ContextTestSupport { public void testMailGeneration() throws Exception { MockEndpoint mock = getMockEndpoint('mock:result'); mock.expectedMessageCount(1); template.requestBody('seda:mails'  'Hello World'); mock.assertIsSatisfied(); } protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { public void configure() throws Exception { from('seda:mails') .to('file:target/mails') .to('mock:result'); } }; }Would not create a file in target/mails folder as we are using template.request that is an InOut MEP.I will fix it by removing the strange consumer code in the FileProducer and change the fancy dynamic recepientlist test (SimulatorTest)  to not use file based endpoints.It could be a blocker for the 1.4 release and we should consider creating a new RC!,0,0
Change default DeadLetterChannel strategy in Camel,The current DLC strategy in Camel is to retry 6 times with 1 sec delay. If still failed it will be moved to a log WARN.This default behavior is not feasible for most end-users  in fact none. We should have a better default strategy in Camel.Also we should force end-users to setup a strategy from the start.And we should improve this in the documentation so end-users is aware of this.,0,0
Log component should use ExchangeFormatter for formatting log output,Currently log component only logs the payload. We have a nice ExchangeFormatter that can format an exchange with all kind of options.The options could be enabled on the log component so you can customize your logging. Also there should be a multiline option to the exchange formatter so it can log all the stuff on multi lines if for instance there are many options  they get very long.,0,0
CXF - wrapper/unwrapper - camel-cxf should be smarter,Willem knows what this is. See chat log on the july-15-2008.Basically getBody() should be smart in what kind of situation you are using CXF.,0,0
Exception on using WS-Addressing with Apache Camel as Transport,Not sure if this is a bug in CXF or Camel. Please see attached sample project.--------------------------------------------------INFO: Interceptor has thrown exception  unwinding noworg.apache.cxf.binding.soap.SoapFault: A header representing a Message Addressing Property is not valid and the message cannot be processed at org.apache.cxf.ws.addressing.MAPAggregator.mediate(MAPAggregator.java:375) at org.apache.cxf.ws.addressing.MAPAggregator.handleMessage(MAPAggregator.java:159) at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:221) at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:78) at org.apache.camel.component.cxf.transport.CamelDestination.incoming(CamelDestination.java:148) at org.apache.camel.component.cxf.transport.CamelDestination$ConsumerProcessor.process(CamelDestination.java:172) at org.apache.camel.impl.converter.AsyncProcessorTypeConverter$ProcessorToAsyncProcessorBridge.process(AsyncProcessorTypeConverter.java:43) at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:59) at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:75) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:57) at org.apache.camel.processor.DeadLetterChannel.process(DeadLetterChannel.java:155) at org.apache.camel.processor.DeadLetterChannel.process(DeadLetterChannel.java:91) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:57) at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:39) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:41) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:66) at org.apache.camel.component.jms.EndpointMessageListener.onMessage(EndpointMessageListener.java:68) at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:531) at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:466) at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:435) at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:322) at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:260) at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:944) at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:875) at java.lang.Thread.run(Thread.java:595),0,0
Propagated CXF header's value should not include quotes,CAMEL-686 fixed the issue of not propagating transport headers (e.g. SOAPAction) but it looks like we added quotes around the value (i.e. getCustomer becomes 'getCustomer'). I updated the CustomerServicesTest to illustrate the problem. Also  I cleaned up the client/server-application.xml.,0,0
JMX Instrumentation - check for already registered before registering,Camel does not check for already registered mbeans. There can be shared endpoints in the camel routes etc.We used to have an instance count and everything but at the end a jms endpoint such as 'activemq:topic:orders' can be reused in several routes and we should in fact only register it once.,0,1
When getContext().addInterceptorStrategy(new Tracer());  is added in a RouteBuilder class  then the timer component does not work,When getContext().addInterceptorStrategy(new Tracer());is added in a RouteBuilder Class  then the timer component does not start.e.g. public class RouteBuilder extends RouteBuilder { getContext().addInterceptorStrategy(new Tracer()); public void configure() { from('timer://export') .to('bean:myBean'); }},0,0
After the downloading process  the layout of the remote file system doesn't match the local's one,When downloading a directory with a complex layout (mutli level directory)  the downloaded files do not reflect the local onemore info here http://www.nabble.com/FTP-component%3A-Possible-bug-td18540318s22882.html,0,0
Camel transport should set the content type property into the camel message header,Eduard Hildebrandt logged a JIRA&#91;1&#93; in CXF  it is actually a camel transport issue.https://issues.apache.org/jira/browse/CXF-1703,0,0
CamelConduit's should check the TargetReference when create its instance,CAMEL-726 shows a ws-address error when using Camel transport for CXF.After running the code   I found there is no To address tag generated in the soap header. It was caused by the CamelConduit can set right targe reference.,0,0
xpath expression with $header and the header doesnt exist on the in message results in NPE,Using the $headerkey shorthand for xpath expression throws a NPE if the headerkey doesn't exists on the in message.We should try to find a better workaround for key doesn't exists. The NPE is thrown by SUN in their xpath engine.Check nabble:http://www.nabble.com/Camel-XPath-and-no-variables-found-in-MessageVariableResolver---What-should-Camel-do--td18603960s22882.html,0,0
AMQP Tests are disabled,The AMQP tests are currently disabled. Adding an older version of MINA (than Camel uses) &amp; commons lang to the classpath got the tests passing except for ObjectMessage type test.Sending a TextMessage and BytesMessage work fine so I'm opening up a separate JIRA for the ObjectMessage issue.,0,0
CamelContext's setErrorHandler is not effect when the jmx agent is disabled,The example applications from Camel 1.4 source distribution work correctly on my machine. After comparing the sample Spring XML configuration and my Spring configuration  I noticed there is no jmxAgent element in the sample XML where my configuration has this element. The problem I noticed was that when the disabled attribute of the jmxAgent element is set to true  the redelivery policy does not work. http://www.nabble.com/DeadLetterChannel-Configuration-Camel-1.4-td18622356s22882.html#a18622356,0,0
InstrumentationProcessor should catch Throwable,The InstrumentationProcessor currently only catches exception and sets it in the exception. Runtime errors and throwables can be thrown all the way out of the DeadLetterChannel's process method  out of the reach of exception policy.,0,0
Pipeline with thread() processor also redelivers following the default policy independently from the preset  errorhadling,When using the thread processor in a simple pipeline  the exchange will be redelivered 6 times (default policy) along with the preset errorhandler settings. The code below will re-deliver 6 times to the default DeadLetterChannel and once to the log:errorTester. errorHandler(deadLetterChannel('log:errorTester?level=ERROR').maximumRedeliveries(1)); from('seda:whatEver') .thread(2) .process(new Processor() { public void process(Exchange exchange) throws Exception { System.out.println('### Exchg : ' + exchange.getExchangeId()); throw new Exception('Kaboom 2!'); } });,0,1
MinaConsumerTest failure,The test fails with the following error:junit.framework.ComparisonFailure: expected:&lt;&#91;Bye World&#93;&gt; but was:&lt;[]&gt; at junit.framework.Assert.assertEquals(Assert.java:81) at junit.framework.Assert.assertEquals(Assert.java:87) at org.apache.camel.component.mina.MinaConsumerTest.testSendTextlineSyncText(MinaConsumerTest.java:28)...One test sends sync the text 'World' and the should receive 'Bye World' in response.2008-08-08 01:35:25 589 DEBUG MinaProducer - Message received: Bye World 2008-08-08 01:35:25 589 DEBUG MinaProducer - Message received: 2008-08-08 01:35:25 589 DEBUG MinaProducer - Message received: Bye 2008-08-08 01:35:25 589 DEBUG MinaProducer - Message received: There are actually not one  but two messages received which causes the reply to be overridden by the second message. The problem is with the test itself that actually returns 'Bye ' + body + '/n'! Because the test uses the 'textline' mina codec  the encoder actually adds another '/n'. With the textline codec there's one message per line  so the extra /n makes it two lines and hence the extra message. The decoder at the other end suppresses the LineDelimiter (/n)  so the extra message is actually an empty string.Removing the extra /n in the message fixes the test  but the notes above should be considered when camel-mina is used with the textline codec.,0,0
HttpProducer premature out message creation,I believe there is incorrect flow in the HttpProducer which can subvert error handling in the route:in Camel 1.4.0 in HttpProducer on line 76 a 'blank' out message is set on the exchange:Message out = exchange.getOut(true); try { int responseCode = httpClient.executeMethod(method);...1. If an IO error occurs on connect  the out message will be passed to the error handling code and if the originating endpoint was a JmsMessage it will cause an NPE when JmsMessage.getMessageId() is called. It also obscures the offending message I believe.2. A similar situation will happen if the HTTP service returned an error code; the out message will contain a reply message even though the processing resulted in an error (e.g. HTTP Status 500) 3. Also  shouldn't this code test whether the exchange expects an 'out' altogether  and if not  perhaps  put just put the return HTTP status into the 'in' message header.--Bill,0,0
delayer pattern doesn't work in Spring DSL,You can't configure the delayer pattern properly in the Spring DSL currently. I will be attaching a patch for this shortly.,0,0
support to set the loadBalancerStrategy before the outputs,Current Camel only support the set the LoadBalancer Strategy after the outputs like this &lt;camelContext id='camel' xmlns='http://activemq.apache.org/camel/schema/spring'&gt; &lt;route&gt; &lt;from uri='direct:start'/&gt; &lt;loadBalance&gt; &lt;to uri='mock:x'/&gt; &lt;to uri='mock:y'/&gt; &lt;to uri='mock:z'/&gt; &lt;roundRobin/&gt; &lt;/loadBalance&gt; &lt;/route&gt; &lt;/camelContext&gt;It should be much better with the below configuration file&lt;camelContext id='camel' xmlns='http://activemq.apache.org/camel/schema/spring'&gt; &lt;route&gt; &lt;from uri='direct:start'/&gt; &lt;loadBalance&gt; &lt;roundRobin/&gt; &lt;to uri='mock:x'/&gt; &lt;to uri='mock:y'/&gt; &lt;to uri='mock:z'/&gt; &lt;/loadBalance&gt; &lt;/route&gt; &lt;/camelContext&gt;,0,0
Should preserve the exchange type in the routing slip,Currently  the routing slip will create a new InOut exchange for each target based on the target endpoint type. This means that someone calling from a jbi endpoint (or other endpoint with custom exchange) into the routing slip will have their exchange type changed (to mostly likely DefaultExchange). I will be including a patch to fix this issue shortly.,0,0
File component - write to temp file and rename to real name startegy,When producing files an idea is to write to a temp file that has a name pattern that will be skipped by consumers (such as starting with a dot) and then after the write rename the file to the correct name.Then the consumers wont need to use exotic locking to get exclusive read access to the file. Works on all file systems.There is a nabble discussion on this issue somewhere.,0,0
Trailing slash missing in SftpConsumer,When this route  &lt;camel:route&gt; &lt;camel:from uri='sftp://someuser@hostname/path/to/directory/?password=secret&amp;amp;directory=true&amp;amp;binary=true&amp;amp;consumer.useFixedDelay=false&amp;amp;consumer.setNames=true&amp;amp;consumer.recursive=false' /&gt; &lt;camel:to uri='file:///C:/camel/output/' /&gt; &lt;/camel:route&gt;is configured the files in the remote directory are download  but subsequent calls of the method 'pollDir' result in this exception:[ Thread: 1 RemoteFileComponent] SftpConsumer WARN Caught SftpException:2: No such file[ Thread: 1 RemoteFileComponent] SftpConsumer WARN Doing nothing for now  need to determine an appropriate action[ Thread: 1 RemoteFileComponent] ScheduledPollConsumer WARN An exception occured while polling: Endpoint[sftp://someuser@hostname/path/to/directory/?password=secret&amp;amp;directory=true&amp;amp;binary=true&amp;amp;consumer.useFixedDelay=false&amp;amp;consumer.setNames=true&amp;amp;consumer.recursive=false]: No such file 2: No such fileAs you can see the slash is definitely in the configured route. If I check for the missing slash and add it to the dir variable (line 115 in SftpConsumer) then the consumer works: if(!dir.startsWith('/')) { dir = '/' + dir; }Didn't have the time to have a closer look. The root cause of the missing slash is somewhere else.,0,0
Type Converter - if not possible to convert LOG a WARN,An end-user had a route that didn't work and had trouble figure out the problem. Could be the fact that the type converted failed for some reason and no trace in his log.We should add some DEBUG logging to the type converter stuff what it does  especially in cases where it cant convert.http://www.nabble.com/Marshaling-jdbc-output-with-xstream-td19065283s22882.htmlNotice we have another ticket about type converters should fail instead of returning null etc.,0,0
mina should be exchange pattern agnostic,Currently the camel-mina component silently ignores exchanges that is not out capable even though its configured for sync=true (InOut)What it does now is setting the sync option itself depending on the exchange type.,0,0
Current mina component can't tansfer the exchange fault message body,I just found MinaTransferExchangeOptionTest don't show how to set fault message and the fault message is not a part of MinaPayloadHolder.You can't set the exception on the exchange in the processor   sine the camel DeadLetterChannel will try to redeliver the message.So we just need to support put the exception which need to send back to the camel client into the fault message body.,0,0
splitter() should support batch for processing large files,See nabble:http://www.nabble.com/Splitter-for-big-files-td19272583s22882.htmlSomekind of batch(size) parameter to the splitter() DSL so we can process the exchanges in batches instead of all in one go.,0,0
Access HttpRequest Params from exchange.in.header,Currently  you can only get the http request parameters by using a getHttpRequest() on the HttpExchange and thus you need java code and can't do it from the Spring XML configuration using simple expression language. e.g. if the request is http://localhost:8080/test?x=1  then the following route should result in 1 being returned in the body of the html response:&lt;route&gt; &lt;from uri='jetty:http://localhost:8080/test' /&gt; &lt;setBody&gt; &lt;simple&gt;&lt;html&gt;&lt;body&gt;${in.header.x}&lt;/body&gt;&lt;/html&gt;&lt;/simple&gt; &lt;/setBody&gt; &lt;to uri='mock:end'/&gt;&lt;/route&gt;,0,0
camel-mina - codec options should fail if not possible to find i registry,If you configure the codec option on camel-mina and you eg make a spelling mistake camel will default to Mina default protocol if not found. We should throw an exception instead so end user knows about this and can fix his spelling mistake.,0,0
SftpEndpoint ignores custom ssh port,SftpEndpoint ignores custom ssh port. It works only if server runs on port 22.,1,0
element should not require contextPath attribute,In the Java DSL  you can say from('foo').marshal().jaxb().to('bar')In XML I think it would look like this:&lt;from uri='...' /&gt;&lt;marshal&gt; &lt;jaxb /&gt;&lt;/marshal&gt;&lt;to uri='...' /&gt;The problem is that you can't use the &lt;jaxb /&gt; element without the contextPath attribute  which the XSD says is required.,0,0
The should throw the exception if there is some thing wrong with  type attribute,If you specify an invalided class name in the convertBodyTo@type  you will get a NPE error  but no detail log information for the type attribute.We need to throw the exception for user to locate the error.,0,0
JmsProducer - option requestTimeout isn't configured properly,When sending a JMS message to a destination using camel-jms (JMSProducer) I can't get it to use my requestTimeout option in the endpoint configuration. It always default to 20000.template.requestBody('activemq:queue:slow?requestTimeout=1000'  'Hello World');This doesn't work as expected with a timeout of only 1 sec.,0,1
camel-cxf component is not passing request context through correctly,CxfProducer.process() is not setting up the request context correctly during createCxfMessage  so later in that method propagateContext has no request data to propagate. Also  we need the exchange properties to be added to the request context  so that non-camel components can pass properties into the cxf request context.I have coded a fix for this  along with a unit test of course. I'll attach the patch to this JIRA.,0,0
file component consumer.regexPattern does not work as expected (matching is applied not only to file  but also to directory),file component consumer.regexPattern does not work as expectedexample : from('file://d:/the_input_dir?consumer.regexPattern=.*/.xml$'.to(whatever)(should match only files  that has extention .xml)the result of the above regexPattern is  that no file will be proccessed  regardless if an existing filename matches the pattern.FileConsumer.pollFileOrDirectory() applies the regexPattern on the starting directory (the_input_dir) which will not match.,0,0
Remove deps on persistence-api jar  non compliant with the spec,I mentioned a while ago a warning I couldn't explain in eclipse related to the use of @UniqueConstraint in camel-jpa.It turned out to be due to the fact that camel-jpa has a dependency on persistence api  but used for testing openjpa that has a dependency on geronimo-jpa_3.0_spec. So camel-jpa pulls in two different implementation of the same spec. So far so good. It also turns out that the definition of the @UniqueConstraint annotation is different in the two jars  the persistence-api (and the camel-jpa code as implemented) being non spec compliant. I found other inconsistencies in the persistence-api impl and it seems to be based on an older version of the spec.(More precisely persistence api annotates the @interface UniqueConstraint with @Target({TYPE}) whereas the spec and the geronimo impl use: @Target({}))My recommendation is to replace the dependency on persistence-api with the geronimo version. I will commit a change for this in the next hour or so  but leave this issue open. If anybody has any objections please shout and I will revert the change.,0,0
tracer - option to disable interceptors,Currently the tracer also outputs interceptors such as delegation to the DLC that is wrapped in the pipeline.Would be nice with an option to enable/disable this (disabled by default) so all the interceptors isn't logged and confuses end-users.,0,0
Manage non-singleton endpoints in the CamelContext,So that we can manages JMS endpoint for instance  that are not singletons.,0,0
camel-spring/rest does not build on HP-UX,I'm getting the following error from camel-spring on the HP-UX platform. I should be able to reuse a fix I made to a similar problem in CAMEL-939&#91;18:53:50&#93;: &#91;ERROR&#93; FATAL ERROR&#91;18:53:50&#93;: &#91;INFO&#93; ------------------------------------------------------------------------&#91;18:53:50&#93;: &#91;INFO&#93; com/sun/mirror/apt/AnnotationProcessorFactory&#91;18:53:50&#93;: &#91;INFO&#93; ------------------------------------------------------------------------&#91;18:53:50&#93;: &#91;INFO&#93; Trace&#91;18:53:50&#93;: java.lang.NoClassDefFoundError: com/sun/mirror/apt/AnnotationProcessorFactory&#91;18:53:50&#93;: at com.sun.tools.jxc.maven2.SchemaGenMojo.execute(SchemaGenMojo.java:143)&#91;18:53:50&#93;: at org.apache.maven.plugin.DefaultPluginManager.executeMojo(DefaultPluginManager.java:451),0,0
Inconsistency in recipient list documentation?,The mail thread at http://tinyurl.com/47bqre seems to contradict the documentation at http://activemq.apache.org/camel/recipient-list.html &#8211; not sure if this is a doc issue  or a camel behavioural issue.,0,0
JMS InOut operations should default to non transacted even if the JMS component or endpoint defaults to transacted; as typically RPCs over JMS are not transacted,currently there is no automatic transaction commit inside the send of the request when doing InOut with JMS; so the transaction won't commit if the component/endpoint is transacted - then the message won't reach the request and things will time out.This will be confusing to users.So if things are transacted; lets default to using non-transacted for InOut - and force a new property  transactedInOut to allow that to be transacted if folks really want that (which they usually won't I'd have thought).,0,0
loggingErrorHandler should default to ERROR and LoggingErrorHandlerBuilder should operate as a builder,Please see attached patch which changes the default level created by the LoggingErrorHandlerBuilder to ERROR instead of INFO.Also some of the methods on this builder to not return 'this'. This breaks the chain when attempting to use the builder resulting in:LoggingErrorHandlerBuilder errorBuilder = loggingErrorHandler('my.logger.name');errorBuilder.setLevel(LoggingLevel.ERROR);errorHandler(errorBuilder);instead of:errorHandler(loggingErrorHandler('mylogger.name').level(LoggingLevel.ERROR));I have added on builder methods for 'level' and for 'log'. I have left the properties that currently exist as following the pattern on DeadLetterChannelBuilder the builder method names should not include 'set'. Whoever applies the patch may wish to remove the getters and setters  depending how they feel this will affect existing users.,0,0
CamelContext.setRoutes() documentation is misleading,The javaDoc for CamelContext.setRoutes() states:'Sets the routes for this context  replacing any current routes'Yet when used  and the context started  startRouteDefinitions() is used first  causing any existing routes created through the definitions (such as those from RouteBuilders) to be re-created and started before the new routes provided to setRoutes() are started.,0,0
createConnector attribute for CamelJMXAgentType should default to 'true',,0,0
TypeConverter Exception is thrown in the latest build of camel,I have upgraded to the latest of Camel and when I attempt to use the content based router pattern - its now throwing an error.The contents of the Message passed is a StringSource object and from debugging camel - the BodyType is a StringSource but it is attempting to convert from a StreamCache to a StringSource. I will try and put a testcase together but if anyone has any ideas of its cause in the meantime ?The error it throws it below.thanks  Edell.No type converter available to convert from type: class org.apache.servicemix.camel.JbiMessage to the required type: org.w3c.dom.Document with value JbiMessage: org.apache.servicemix.jbi.runtime.impl.NormalizedMessageImpl@1d03b5borg.apache.camel.NoTypeConversionAvailableException: No type converter available to convert from type: class org.apache.servicemix.camel.JbiMessage to the required type: org.w3c.dom.Document with value JbiMessage: org.apache.servicemix.jbi.runtime.impl.NormalizedMessageImpl@1d03b5b at org.apache.camel.impl.converter.DefaultTypeConverter.convertTo(DefaultTypeConverter.java:117) at org.apache.camel.impl.converter.DefaultTypeConverter.convertTo(DefaultTypeConverter.java:65) at org.apache.camel.impl.MessageSupport.getBody(MessageSupport.java:69) at org.apache.camel.impl.MessageSupport.getBody(MessageSupport.java:51) at org.apache.camel.builder.xml.XPathBuilder.getDocument(XPathBuilder.java:528) at org.apache.camel.builder.xml.XPathBuilder.evaluateAs(XPathBuilder.java:420) at org.apache.camel.builder.xml.XPathBuilder.matches(XPathBuilder.java:98) at org.apache.camel.builder.xml.XPathBuilder.matches(XPathBuilder.java:63) at org.apache.camel.processor.ChoiceProcessor.process(ChoiceProcessor.java:47) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:75) at org.apache.camel.processor.DeadLetterChannel.process(DeadLetterChannel.java:174) at org.apache.camel.processor.DeadLetterChannel.process(DeadLetterChannel.java:96) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:63) at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:47) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:41) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:66) at org.apache.servicemix.camel.CamelProviderEndpoint.handleActiveProviderExchange(CamelProviderEndpoint.java:115) at org.apache.servicemix.camel.CamelProviderEndpoint.process(CamelProviderEndpoint.java:73) at org.apache.servicemix.common.AsyncBaseLifeCycle.doProcess(AsyncBaseLifeCycle.java:600) at org.apache.servicemix.common.AsyncBaseLifeCycle.processExchange(AsyncBaseLifeCycle.java:554) at org.apache.servicemix.common.AsyncBaseLifeCycle.processExchangeInTx(AsyncBaseLifeCycle.java:456) at org.apache.servicemix.common.AsyncBaseLifeCycle$2.run(AsyncBaseLifeCycle.java:341) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:650) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:675) at java.lang.Thread.run(Thread.java:595),0,0
camel-mail - type converter to InputStream,camel-mail need a type converter to InputStream Currently we have type converters to StringSee nabble:http://www.nabble.com/Process-Mail-Attachment-InvalidPayloadException-Camel-1.4.0-td19937573s22882.html,0,0
FileLanguage - to support constant expressions,Currently the simple language does not support constant expressions  that actually is useable in the file component that uses simple language to set file namesSo if an end-user want to produce a file with a fixed name  then its not possibleexpression=MyBigFile.txt Is not possible.But this is:expression=MyBigFile-${header.foo}.txt is as there is a ${} placeholder and then the simple language can evaluate it.,0,0
BeanInfo - should consider overridden methods when selecting method from operations list,See nabble:http://www.nabble.com/BeanInfo.chooseMethodWithMatchingBody-throws-an-AmbiguousMethodCallException-when-there%27s-no-ambiguity-td19959124s22882.html,0,0
bean binding - annotation to get the exception from exchange,If you are doing error handling using POJO beans to do some error handling code and using bean binding annoations to get the stuff from the exchange  we are missing an annotation to get the caused exceptionSuch as a @Exception or @Fault if that is a better nameSee nabble:http://www.nabble.com/Error-Handler-and-OutHeaders-td19970966s22882.htmljstrachan using @Exception or @Fault or whatever on a bean method call to pull out the Exchange's fault/exception right? 14:02 jstrachan if so definitely!,0,0
Maven goal camel:dot should use overridden  when specified,Maven goal camel:dot should use overridden &lt;mainClass/&gt; when used as in pom.xml: &lt;build&gt; &lt;plugins&gt; &lt;!-- Allows the routes to be run via 'mvn camel:run' --&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.camel&lt;/groupId&gt; &lt;artifactId&gt;camel-maven-plugin&lt;/artifactId&gt; &lt;version&gt;${pom.version}&lt;/version&gt; &lt;!-- optional  default value: org.apache.camel.spring.Main --&gt; &lt;configuration&gt; &lt;mainClass&gt;mypackage.boot.camel.CamelStartup&lt;/mainClass&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;,0,0
Component spring 'event' is not auto registered by Camel. Add a Event file in the folder META-INF/services/org/apache/camel/compoment of camel-spring,Component spring 'event' is not auto registered by Camel. Add a Event file in the folder META-INF/services/org/apache/camel/compoment of camel-spring.,0,0
Http producer should be smarter to select correct GET or POST method,The code in HttpProducer should be smarter to select the correct method to use.Algorithm:1) if the method is provided in a header2) GET if a querystring is provided in a header3) GET if endpoint is configured with a query string4) POST if there is data to send5) GET fallback to getAlso the HttpOperationFailedException is missing a message  so you get the error code and description in the stack-trace,0,0
Quartz support should allow stateful jobs,See http://www.nabble.com/Clustered-Quartz-td20068086s22882.htmlCurrently Quartz only has CamelJob which implements Quartz's Job interface. There is no option to use an implemenation of StatefulJob. This causes problems when you may want to use a JDBC JobStore and have Quartz running on multiple machines  as you may end up with multiple jobs running together. StatefulJob in effect allows for a blocking singleton style job on one machine.Attached is a patch which adds a new URI parameter named 'stateful'  which defaults to false. When set to true it uses StatefulCamelJob.One significant change to the QuartzComponent is that a reference to the CamelContext is now stored in the Quartz Scheduler. This idea is taken from Spring's SchedulerFactoryBean which stores a reference to a Spring ApplicationContext. This is needed as when using stateful jobs the URI of the Endpoint is stored instead of a reference to the endpoint. This is to allow for the use of JDBC JobStore as the URI can be serialised and shared beteen participating schedulers.Current Faults:Still has no notion of volatilityDifference in operation between CamelJob and StatefulCamelJob is not strictly needed. It may be less confusing if both versions simply store the URI instead of an endpoint reference.You need to use stateful if you want to use clustering at all due to the reason above. This is mixing together clustering support and blocking functionality.In Camel 2 we may want to try rewriting this Component as it is becoming a little messy. It would be nice to try and harness the power of Spring's SchedulerFactoryBean.,0,0
camel http Uri from the message header,Imagine a use case when the target systems  where http messages have to be sent to  are maintained in a database. In that case the http uri is cannot be set in the camelcontext but it should come from the header of the message.So the http client should check first if there is an uri in the header and if not than use the one given in the camelcontext (like for querystring).,0,0
camel:dot - pipeline is drawn as a multicast,And it has a few other areas as well that could be polished.,0,0
Add ability to configure log level on exceptions from DLC retry mechanism,Right now  when Camel tries to redeliver an message a number of times (using the DLC)  the exceptions are logged as ERROR. Sometimes though  these retries may be considered part of normal operation. I'm going to put in DSL options to configure this log level. Something like this will be possible:onException(AException.class).maximumRedeliveries(5) .retriesExhaustedLogLevel(LoggingLevel.DEBUG) .retryAttemptedLogLevel(LoggingLevel.DEBUG) .process(new MyExceptionProcessor('I got an Exception.'));,0,0
Add support to tracer for logging out messages,,0,0
Passive mode,There should be an option to enable passive mode in the ftp endpoint. If not  when deploying the camel rules on a host with a firewall the default active mode is useless.,0,0
spring integration xsd change breaks component,Thread is here http://www.nabble.com/-HEADS-UP--camel-spring-integration-issue-td20331450s22882.html,0,0
XQuery creates an empty out message that makes it impossible to chain more processors behind it,When using XQuery the getOut() function is called on the message so if it is not used at a place where the out is filled an empty out message will be created. With this xquery cannot be used for example in setBody  setHeader... and anywhere where the out is not filled.An example where this causes real trouble:&lt;choice&gt; &lt;when&gt; &lt;xquery&gt;...&lt;/xquery&gt; &lt;to uri='direct:follow' /&gt; &lt;/when&gt;&lt;/choice&gt;...&lt;from uri='direct:follow'&gt;&lt;to ...&gt;&lt;to ...&gt;In the patch the out property in the xquery context is filled only if it is not null. With it all of my pipelines seem to work well for me.,0,0
PipelineConcurrentTest.java fails randomly,The test fails with an IllegalStateException: Queue full. I believe the reason for this is that there are 10000 messages sent  but the default queue size is 1000. On a fast machine  the queue fills up before the consumer gets a chance to pop the messages from the queue.,0,0
org.apache.camel.Message - hasAttachments is buggy,I must use if (exchange.getIn().getAttachments().size() &gt; 0) {Instead of if (exchange.getIn().hasAttachments()) {As the latter always returns false. Or at least returns false even though the size is &gt; 0,0,0
.unmarshal(new JaxbDataFormat('com.foo.bar')) returning JAXBElement,using .unmarshal(new JaxbDataFormat('com.foo.bar') is returning a JAXBElement instead of the desired object that was generated by xjc.,0,0
Remove specialized Exchange and make DefaultExchange final to pave the road for optimization by reducing exchange copies,The code in DefaultEndpoint.createExchange(Exchange exchange)  calls on getExchangeType() to figure out if a new copy of Exchange needs be created. The code relies though on the generic argument of the Endpoint type to figure out the actual Exchange type. With the generics removed part of CAMEL-872  getExchangeType() always returns null  forcing a copy every time.There is no real need to extend Exchange  so the proposal for this to make the Exchange final and move the component specific bits  if any  in the Message.,0,1
Can't get the soap header when the camel-cxf endpoint working in the PAYLOAD data fromat,When I added a unit test to show how to get the SOAP header from a PAYLOAD camel-cxf endpoint   I found the soap header stuff is not working.,0,0
ThroughputLogger incorrectly reports duration 0,from the apache-camel-load test:2008-11-14 15:27:01 114 &#91;mponent@1296d1d&#93; INFO aset:myDataSet?produceDelay=10 - Sent: 600 messages so far. Last group took: 0 millis which is: 85.106 messages per second. average: 80.128The ThroughputLogger used by DataSet resets the duration before reporting it.,0,0
jetty endpoints ignore host specified in URI and expose an endpoint on all interfaces,http://www.nabble.com/Jetty-and-Mina%3A-how-to-bind-to-%22anylocal%22-AKA-%22wildcard%22-address--tp20475674s22882p20494645.html,1,0
camel-jetty - Exchange failures should not be returned as 200,The code below: protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { public void configure() throws Exception { errorHandler(noErrorHandler()); from('jetty:http://localhost:8080/myapp/myservice').process(new MyBookService()); } }; } public class MyBookService implements Processor { public void process(Exchange exchange) throws Exception { throw new IllegalArgumentException('Damm'); } }Will return http response code 200. We should let end users easily set what response code they want and in case of route failures we should probably return 500 and return the stracktrace in the body,0,0
Delayer not working as expected.,The delayer expression is not evaluated in my route builder:from(waitQueueName).delayer(header(HEADER_EXECUTION_TIME)).bean(routerBean).recipientList(header(HEADER_TARGET_ROUTE));While the recipientList expression is working the header expression is always ignored. I stepped through the code and saw that in DelayerType.createAbsoluteTimeDelayExpression() 'expr.getLanguage()' is always null: private Expression createAbsoluteTimeDelayExpression(RouteContext routeContext) { ExpressionType expr = getExpression(); if (expr != null) { if (ObjectHelper.isNotNullAndNonEmpty(expr.getLanguage())) { return expr.createExpression(routeContext); } } return null; }I have seen that this was changed in 1.5.0 (http://issues.apache.org/activemq/browse/CAMEL-811).,0,0
Spring DSL - redeliveryPolicy element should have ref attribute,I'd like to be able to create reusable RedeliveryPolicy's in Spring and refer to them in Camel's Spring DSL. This is to achieve two goals: I can use the Spring PropertyPlaceholderConfigurer to enable us to tune timeouts and redelivery in production - we cannot do that with Camel's Spring DSL; I can have several routes sharing the same RedeliveryPolicy (but possibly with different exceptions).There doesn't seem to be a way to share RedeliveyPolicy's between onException elements  meaning it needs to be duplicated (at least not that I could find in the docco)For example  I'd like to do something like this: &lt;bean id='redeliveryPolicy' class='org.apache.camel.processor.RedeliveryPolicy'&gt; &lt;property name='...' value=${property.placeholder}/&gt; &lt;/bean&gt; &lt;camelContext&gt; &lt;route&gt; &lt;from uri='somewhere'/&gt; &lt;onException&gt; &lt;exception&gt;ExceptionA&lt;/exception&gt; &lt;redeliveryPolicy ref='redeliveryPolicy'/&gt; &lt;to uri='deadLetter'/&gt; &lt;/onException&gt; &lt;to uri='unreliableEndpoint'/&gt; &lt;/route&gt; &lt;route&gt; &lt;from uri='xyz'/&gt; &lt;onException&gt; &lt;exception&gt;ExceptionA&lt;/exception&gt; &lt;redeliveryPolicy ref='differentRedeliveryPolicy'/&gt; &lt;to uri='differentDeadLetter'/&gt; &lt;/onException&gt; &lt;to uri='unreliableEndpoint'/&gt; &lt;/route&gt; &lt;route&gt; &lt;from uri='somewhereElse'/&gt; &lt;onException&gt; &lt;exception&gt;ExceptionB&lt;/exception&gt; &lt;redeliveryPolicy ref='redeliveryPolicy'/&gt; &lt;to uri='deadLetter'/&gt; &lt;/onException&gt; &lt;to uri='anotherUnreliableEndpoint'/&gt; &lt;/route&gt; &lt;/camelContext&gt;Thanks!,0,0
camel-http - does not remove httpClient.xxx URI options,When using the options to configure httpClient using URI option  they should be removed from the uri that is left over to the HTTPProducer.http://someserver?httpClient.soTimeOut=5000should remove the httpClient.xxx so it'shttp://someserver,0,0
ParallelProcessing and executor flags are ignored in Multicast processor,The parallelProcessing and executor arguments are ignored in the constructor of MulticastProcessor. Here is a call that MulticastType makesorg.apache.camel.model.MulticastType.java return new MulticastProcessor(list  aggregationStrategy  isParallelProcessing()  threadPoolExecutor);MulticastProcessor ignores parallelProcessing and executor arguments and invokes a chain constructor with '.. false  null ..'org.apache.camel.processor.MulticastProcessor.java public MulticastProcessor(Collection&lt;Processor&gt; processors  AggregationStrategy aggregationStrategy  boolean parallelProcessing  ThreadPoolExecutor executor) { this(processors  aggregationStrategy  false  null  false); } public MulticastProcessor(Collection&lt;Processor&gt; processors  AggregationStrategy aggregationStrategy  boolean parallelProcessing  ThreadPoolExecutor executor  boolean streaming) { notNull(processors  'processors'); this.processors = processors; this.aggregationStrategy = aggregationStrategy; this.isParallelProcessing = parallelProcessing; if (isParallelProcessing) { if (executor != null) { this.executor = executor; } else { // setup default Executor this.executor = new ThreadPoolExecutor(processors.size()  processors.size()  0  TimeUnit.MILLISECONDS  new ArrayBlockingQueue&lt;Runnable&gt;(processors.size())); } } this.streaming = streaming; }Attached a patch but have not tested it. Also need a unit test for this.,0,1
Camel should propagate exception cause in InOnly scenarios,In the case an exception is handled by the DeadLetterChannel  Camel will currently set the exception to null and add an exchange property containing the exception. We should also add this as a message header so that it will be propagated to external services  like a JBI service.,0,0
CxfExchange does not copy unit of work and thus its null and thus NPE is thrown,William could you check this error reported by end userSee nabble:http://www.nabble.com/UnitOfWork-td20829434s22882.html,0,0
camel-mina adds two versions of slf4j on the classpath,One version comes from camel-mina (version 1.5.5) and one from mina-core (version 1.4.3). This causes problems as seen when trying to use camel-mina at runtime or in my case deploying to ServiceMix. This is the error I getorg.apache.xbean.kernel.ServiceRegistrationException: java.lang.NoSuchFieldError: name at org.apache.xbean.kernel.standard.ServiceManagerRegistry.registerService(ServiceManagerRegistry.java:424) at org.apache.xbean.kernel.standard.StandardKernel.registerService(StandardKernel.java:220) at org.apache.xbean.server.spring.loader.SpringLoader.load(SpringLoader.java:152) at org.apache.servicemix.common.xbean.AbstractXBeanDeployer.deploy(AbstractXBeanDeployer.java:83) at org.apache.servicemix.camel.CamelSpringDeployer.deploy(CamelSpringDeployer.java:83) at org.apache.servicemix.common.BaseServiceUnitManager.doDeploy(BaseServiceUnitManager.java:88) at org.apache.servicemix.common.BaseServiceUnitManager.deploy(BaseServiceUnitManager.java:69) at org.apache.servicemix.jbi.framework.DeploymentService.deployServiceAssembly(DeploymentService.java:508) at org.apache.servicemix.jbi.framework.AutoDeploymentService.checkPendingSAs(AutoDeploymentService.java:482) at org.apache.servicemix.jbi.framework.AutoDeploymentService.checkPendingComponents(AutoDeploymentService.java:535) at org.apache.servicemix.jbi.framework.AutoDeploymentService.updateSharedLibrary(AutoDeploymentService.java:317) at org.apache.servicemix.jbi.framework.AutoDeploymentService.updateArchive(AutoDeploymentService.java:254) at org.apache.servicemix.jbi.framework.AutoDeploymentService.monitorDirectory(AutoDeploymentService.java:667) at org.apache.servicemix.jbi.framework.AutoDeploymentService.access$800(AutoDeploymentService.java:62) at org.apache.servicemix.jbi.framework.AutoDeploymentService$1.run(AutoDeploymentService.java:631) at java.util.TimerThread.mainLoop(Timer.java:512) at java.util.TimerThread.run(Timer.java:462)Caused by: java.lang.NoSuchFieldError: name at org.slf4j.impl.SimpleLogger.&lt;init&gt;(SimpleLogger.java:83) at org.slf4j.impl.SimpleLoggerFactory.getLogger(SimpleLoggerFactory.java:67) at org.slf4j.LoggerFactory.getLogger(LoggerFactory.java:103) at org.apache.mina.util.NamePreservingRunnable.&lt;init&gt;(NamePreservingRunnable.java:32) at org.apache.mina.transport.socket.nio.SocketAcceptor.startupWorker(SocketAcceptor.java:165) at org.apache.mina.transport.socket.nio.SocketAcceptor.bind(SocketAcceptor.java:141) at org.apache.camel.component.mina.MinaConsumer.doStart(MinaConsumer.java:60) at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:47) at org.apache.camel.impl.DefaultCamelContext.addService(DefaultCamelContext.java:421) at org.apache.camel.impl.DefaultCamelContext.startRoutes(DefaultCamelContext.java:659) at org.apache.camel.impl.DefaultCamelContext.doStart(DefaultCamelContext.java:632) at org.apache.camel.spring.SpringCamelContext.maybeDoStart(SpringCamelContext.java:167) at org.apache.camel.spring.SpringCamelContext.doStart(SpringCamelContext.java:162) at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:47) at org.apache.camel.spring.SpringCamelContext.maybeStart(SpringCamelContext.java:97) at org.apache.camel.spring.SpringCamelContext.onApplicationEvent(SpringCamelContext.java:116) at org.springframework.context.event.SimpleApplicationEventMulticaster$1.run(SimpleApplicationEventMulticaster.java:77) at org.springframework.core.task.SyncTaskExecutor.execute(SyncTaskExecutor.java:49) at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:75) at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:246) at org.springframework.context.support.AbstractApplicationContext.finishRefresh(AbstractApplicationContext.java:617) at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:355) at org.apache.xbean.server.spring.configuration.SpringConfiguration.&lt;init&gt;(SpringConfiguration.java:63) at org.apache.xbean.server.spring.configuration.SpringConfigurationServiceFactory.createService(SpringConfigurationServiceFactory.java:106) at org.apache.xbean.kernel.standard.ServiceManager.start(ServiceManager.java:420) at org.apache.xbean.kernel.standard.ServiceManager.initialize(ServiceManager.java:200) at org.apache.xbean.kernel.standard.RegistryFutureTask$RegisterCallable.call(RegistryFutureTask.java:110) at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:269) at java.util.concurrent.FutureTask.run(FutureTask.java:123) at org.apache.xbean.kernel.standard.ServiceManagerRegistry.registerService(ServiceManagerRegistry.java:409),0,0
The Mina VM protocol is not recognising codec and other options,Use of the vm protocol appears to ignore any codec options. There could be other options that are missed also.Using the same URI but for tcp works fine.,0,0
camel-velocity - log4j is needed at runtime,See nabble:http://www.nabble.com/velocity%3A-Couldn%27t-find-class-org.apache.velocity.runtime.log.SimpleLog4JLogSystem-td21036449s22882.htmlJon do you mind taking a look at this  you are are good at maven pom's,0,0
File component - exclusive read lock strategy using renaming,See CAMEL-760But an end user has problem with this  the read lock can not be granted and a IOException is thrown.We should support the same strategy as the FTP consumer does with a try to rename the file.Also we should allow some nice URI options to select the strategy nio locks renaming,0,0
MockEndpoint - sleep for empty test doesnt work,See nabble:http://www.nabble.com/MockEndpoint---sleep-for-empty-tests-is-flawed--td21067367s22882.html,0,0
Throttler appears to 'throttle' per thread instead of throttling across multiple threads,,0,1
@EndpointInject can not lookup bean if endpoint is defined directly as a consumer (from),I was messing with camel-spring and routes using spring DSLI had this part of unit test code @EndpointInject(name = 'myFileEndpoint') protected Endpoint inputFile;To lookup an endppoint with the given name myFileEndpointBut if I define it directly then it cannot be found &lt;route&gt; &lt;from id='myFileEndpoint' uri='file://target/antpathmatcher?consumer.recursive=true&amp;amp;filter=#myFilter'/&gt; &lt;to uri='mock:result'/&gt; &lt;/route&gt;So I have to define it as a loose endpoint as: &lt;endpoint id='myFileEndpoint' uri='file://target/antpathmatcher?consumer.recursive=true&amp;amp;filter=#myFilter'/&gt; &lt;route&gt; &lt;from ref='myFileEndpoint'/&gt; &lt;to uri='mock:result'/&gt; &lt;/route&gt;,0,0
ConcurrentModificationException when stop the camel-osgi bundle,ERROR: Error stopping mvn:org.apache.camel/camel-osgi/1.5.0 (org.osgi.framework.BundleException: Activator stop error.)java.util.ConcurrentModificationException at java.util.HashMap$HashIterator.nextEntry(HashMap.java:841) at java.util.HashMap$ValueIterator.next(HashMap.java:871) at org.apache.camel.osgi.Activator.mayBeRemoveComponentFor(Activator.java:85) at org.apache.camel.osgi.Activator.stop(Activator.java:120) at org.apache.felix.framework.util.SecureAction.stopActivator(SecureAction.java:613) at org.apache.felix.framework.Felix._stopBundle(Felix.java:1995) at org.apache.felix.framework.Felix.stopBundle(Felix.java:1952) at org.apache.felix.framework.Felix.setFrameworkStartLevel(Felix.java:1151) at org.apache.felix.framework.StartLevelImpl.run(StartLevelImpl.java:267) at java.lang.Thread.run(Thread.java:595),0,0
camel-xmpp to work with google chat,See blog entryhttp://www.andrejkoelewijn.com/wp/2008/12/30/using-google-talk-from-java-example/There is a solution that works with plain java. Could be used to identify what needs to be fixed in Camel to get it working with Google chat as well.Notice I haven't verified if it doesn't already work with google chat. Just created this ticket to not forget it.,0,0
camel-restlet security extension,Now we have basic http auth. Quick shot is adding digest as it is supported by Restlet  but I have something more in mind. As I'm using token based auth and for me http auth is not suitable (pushing credentials back and forth all the time etc). How about a pattern where from one endpoint you can consume a ticket/token/sessionId and you can use it as a header to authenticate? As now the realm is to keep login and pass and it could be something like a bean that can validate the token. Of course that data would not be static so it is more about a callback (eg. getTokens()) than a static map/list. And finally as we have the uri we can resolve an 'operation' and do authorization (so uri+method is the target). I mean in my project I have processor that does stuff like that and it would be cool to have all those things in one place in consumer (and provide only data and have skeletal logic under the hood).Now the question is if my idea makes sense and if so what are your suggestions on how to implement that w/o reinventing the wheel (and not using ACEGI )Btw  Claus  William - logs about attaching/detaching restlets are at info level and it's kind of spamming if there are say 20 endpoints... Maybe it should be at debug?,1,0
Improve JMS header name endocing/decoding strategy,We have a scenario where we need to perform the following style of integration:HTTP -&gt; JMS -&gt; HTTPThe final HTTP endpoint needs to receive the headers as they were in the original HTTP request. However  I am finding that the HTTP headers that contain a hyphen (such as Content-Type  Content-Length etc) are being omitted when the messages go onto the queue. JmsBinding has two static methods to perform some basic header manipulation to 'encode' and 'decode' headers that are not valid Java identifiers. However  the strategy employed does not handle hyphens or other illegal characters  only periods. Secondly  as static methods they cannot be overridden by my own extension of JmsBinding. And finally  JmsHeaderFilterStrategy has a static link back to these methods in JmsBinding so that makes it hard to replace.To me  it would be more appropriate that HeaderFilterStrategy implementations should actually contain the code to Advise if a header needs to be encoded/decoded  which it already does  but in addition; Actually perform that encoding/decoding in it's own implementation-specific wayThis affects 1.5.0 but it's also in the trunk like this.I have a workaround which is a little messy but it works Thanks Jason,0,0
Pipeline could change the MEP unintended,When exchanges is processed from pipeline they result is copyed as input to the next exchange. However during this copy Camel could potentially change the MEP to InOut. It should respect the original MEP.The flaw is in ExchangeHelper#copyResultsFixing this also forces end users to use the correct send/request method on ProducerTemplate. Now Camel will keep the MEP.So if you are using send then its inOnly and then you the there is no result. Use request for InOut MEP's.This breaks a few of our own unit testing that was using the wrong method.,0,0
Tracer - allow configuration of fixed size of leading breadcrum or let it be variable sized,The TraceFormatter fixes the breadcrum to 65 chars. If you output the exchange id and its based on the computer name it can be long  and thus cut important parts such as the destination.Allow it to be wider and add option to configure the length or let it be variable.breadcrumLength = 65. Setting it to 0 will let it be flexible. Maybe bump the 65 to 80 to let it be bigger from the start.,0,0
file consumer - support expression for setting the folder/file to consume,Would be nice to support the file language to set dynamic patterns for the starting folder/file to consume.See nabble:http://www.nabble.com/Mega-mega-%28VFS%29-file-handler-to21346374s22882.html,0,0
SFTP : Polling - Cannot list directory Error,http://www.nabble.com/SFTP-%3A-Polling---Cannot-list-directory-to21413159s22882.html,0,0
camel-cxf: URI option for serviceClass does not support lookup in registry,Having an endpoint such as: String cxfEndpoint = 'cxf://http://localhost:8080/part-five/webservices/incident' + '?serviceClass=org.apache.camel.example.reportincident.ReportIncidentEndpoint' + '&amp;wsdlURL=report_incident.wsdl';The serviceClass option currently only supports defining a FQN for the class. I think we need to support Registry lookup as well using the # notation. So you can do: String cxfEndpoint = 'cxf://http://localhost:8080/part-five/webservices/incident' + '?serviceClass=#reportService' + '&amp;wsdlURL=report_incident.wsdl';And then have it defined in Spring XML:&lt;bean id='reportService' class='...'&gt;The # notation is already supported if you use the cxf Spring XML configuration. We need this in the Java DSL as well.Sorry if it already exists. But I got a hint from a Camel end user that it didn't,0,0
Starting Camel using Main from camel:run or Main.class - countdown latch is hanging,The countdown latch in MainSupport is not completed when Main is stopping.Then we have a hanging thread. Can bee seen using ctrl + /,0,0
Can only interact with servicemix-http if logging is at DEBUG,Given the following camel DSL:from('activemq:queue.testJms.in')  .to('jbi:service:urn:oms:testHttp?mep=in-out')  .to('activemq:queue.testJms.out'); and the following xbean.xml for the smx (3.3) SU:&lt;http:endpoint  service='oms:testHttp'  endpoint='testHttp'  role='provider'  locationURI='http://localhost:8080/testP1'&gt; &lt;/http:endpoint&gt; then Camel operates correctly (or at least as desired) only if DEBUG logging is enabled in the org.apache.servicemix.http package. This seems to be because a DOMSource is returned (which Camel can convert). If the log level is reduced (say to WARN) then a StreamSource object is returned instead which Camel appears unable to convert. This results in stack traces such as:ERROR - DeadLetterChannel - Failed delivery for exchangeId: ID-davisond-laptop/53380-1232099798317/0-0. On delivery attempt: 0 caught: org.apache.camel.RuntimeCamelException: javax.xml.transform.TransformerException: java.io.IOException: Attempted read on closed stream. org.apache.camel.RuntimeCamelException: javax.xml.transform.TransformerException: java.io.IOException: Attempted read on closed stream.  at org.apache.camel.util.ObjectHelper.invokeMethod(ObjectHelper.java:441)  at org.apache.camel.impl.converter.InstanceMethodTypeConverter.convertTo(InstanceMethodTypeCo+nverter.java:57),0,0
Jetty HTTP SelectChannelConnector is not closed when CamelContext is stopped,When the camel-jetty component is shut down  it leaves Jetty SelectChannelConnector instances active.,0,1
Apache camel example reportincident dependency removed from pom.xml,Hi Someone has removed the following dependency from the camel pom.xml file : &lt;dependency&gt; &lt;groupId&gt;org.apache.camel&lt;/groupId&gt; &lt;artifactId&gt;camel-example-reportincident&lt;/artifactId&gt; &lt;version&gt;${project.version}&lt;/version&gt; &lt;/dependency&gt;,0,0
SQL component doesn't handle wrong number of parameters,NPE thrown when null body sent to to SQL endpoint. When to many parameters are set then exception is thrown but nothing wrong happens when to less parameters are set.It should be possible to set null as a body as there might be parameterless statement to execute. There should be consistent Exception thrown when wrong number of parameters is set.,0,0
camel-ftp : uri set on endpoint has stripped all parameters  that is wrong as they should be there as well,See nabblehttp://www.nabble.com/Camel-Remote-File-Producer---Recipient-List-Password-Issue-td21678952s22882.htmlThe bug is introduced with CAMEL-941,0,0
Seda component should configure its executor,Currently SEDA endpoint processes only using 1 thread so it is impossible to easily configure few concurrent processings on 1 seda endpoint. I believe SEDA endpoint could be configured with some executor and/or thread number that we would like to use to process given flows.,0,0
Two more NullPointerExceptions when context classloader is null,When I applied the CAMEL-1301 fix (thanks Claus) I hit two more NullPointerExceptions caused by code that assumes that the context classloader will never be null.Here's the relevant part of one stack trace:java.lang.NullPointerException at org.apache.camel.impl.converter.AnnotationTypeConverterLoader.findPackages(AnnotationTypeConverterLoader.java:97) at org.apache.camel.impl.converter.AnnotationTypeConverterLoader.findPackageNames(AnnotationTypeConverterLoader.java:91)And the other:java.lang.NullPointerException at org.apache.camel.util.ResolverUtil.getResources(ResolverUtil.java:402) at org.apache.camel.util.ResolverUtil.find(ResolverUtil.java:313) at org.apache.camel.util.ResolverUtil.find(ResolverUtil.java:290)A patch is attached.,0,0
The xpath expression evaluations should rest the cached stream,&lt;route&gt; &lt;from uri='jetty:http://localhost:8084/services/simpleService'/&gt; &lt;choice&gt; &lt;when&gt; &lt;xpath&gt;/sim:GetCapabilitiesRequest&lt;/xpath&gt; &lt;/when&gt; &lt;when&gt; &lt;xpath&gt;/sim:GetMetadataRequest&lt;/xpath&gt; &lt;/when&gt; &lt;/choice&gt;&lt;/route&gt;A messages that matches the first when statement (I tested with both the route above and a version where I swapped the two xpath statements to make sure it was not dependent on the actual message) throws no errors and a call that matches the second when statement throws the Premature end of file error.,0,0
Add regexReplaceAll to builder support,... so we can do things likefrom('direct:start').setBody(regexReplaceAll(body()  'Foo'  'Bar'))...which essentially is equivalent to sed 's/Foo/Bar/g' on the body.,0,0
EndpointMessageListener should respect ExchangePattern,In all current releases  org.apache.camel.component.jms.EndpointMessageListener.onMessage() has the following logic (line 90 in 1.6.0 code):// send the replyif (rce == null &amp;&amp; body != null &amp;&amp; !disableReplyTo) { sendReply(replyDestination  message  exchange  body);}This logic should also respect ExchangePattern of the exchange  so I propose a change to:// send the replyif (rce == null &amp;&amp; body != null &amp;&amp; exchange.isOutCapable()) { sendReply(replyDestination  message  exchange  body);}This change allows a processing pattern where the route may change the ExchangePattern using methods like RouteBuilder.inOnly() to switch the MEP at will so that the reply is send at a later time (true asynchronous exchange). This processing pattern is particularly useful for integrating long running services. For example // Java DSLfrom('activemq:my_queue?exchangePattern=InOnly').to('predict_weather://?reply_later=true');// orfrom('activemq:my_queue2').inOnly().to('predict_weather://?reply_later=true');The flaw of the current logic makes it impossible to do true asynchronous exchange  because 1) it does not respect the ExchangePattern; 2) if property 'disableReplyTo' is used  the 'org.apache.camel.jms.replyDestination' property will not be set (see method createExchange in the same file)  thus downstream cannot find the reply destination.The proposed change can also deprecate the disableReplyTo property and put the MEP concept into good use.,0,1
@Header should have a value default so you do not have to set the name attribute,Doing this bean binding: public List&lt;String&gt; route(@XPath('/customer/id') String customerId  @Header('Location') String location  Document body) {The @Header does not have a default value  so you have to do this to get it to work: public List&lt;String&gt; route(@XPath('/customer/id') String customerId  @Header(name = 'Location') String location  Document body) {So we should support you do not have to set the name attribute.,0,0
ExchangeHelper should respect ExchangePattern.InOptionalOut,The utility method org.apache.camel.util.ExchangeHelper.copyResults() is use by many core classes. However  this method does not properly support MEP InOptionalOut.Assuming in an InOptionalOut exchange  having no out message means just that &#8211; no out message should be sent  then the following lines in this method// Message out = source.getOut(false); if (out != null) { result.getOut(true).copyFrom(out); } else { // no results so lets copy the last inputshould be changed to:// Message out = source.getOut(false); if (out != null) { result.getOut(true).copyFrom(out); } else if (result.getPattern() == ExchangePattern.InOptionalOut) { result.setOut(null); } else { // no results so lets copy the last input,1,1
JaxbDataFormat is not thread-safe,JaxbDataFormat reuses the Marshaller/Unmarshaller instances.However  according to the https://jaxb.dev.java.net/faq/index.html#threadSafety  Marshaller/Unmarshaller instances are NOT thread safe  so you can't use them from separate threads at the same time.Due to this we are getting exceptions from the JAXB implementation (like ClassCastException or 'org.xml.sax.SAXException: FWK005 parse may not be called while parsing.'). Everything works nice with our custom JaxbDataFormat that creates new Unmarshaller/Marshaller instance on every request.Also  lazy-creating instances (like JAXBContext) in getter methods is not thread-safe as well (because explicit synchronization is required).,0,0
Camel-quartz - improve setting of cron expression to be more cron like,See nabble:http://www.nabble.com/Re%3A-Camel-quartz-td22247508.html,0,0
File component - better support for absolute path,See nabble:http://www.nabble.com/File%3A-using-absolute-file-paths-with-moveExpressions-td22253199.html,0,0
CamelContext - Add ClassResolver to be used when you need to load a class instead of ObjectHelper.loadClass to work in OSGi environments,Add the skeleton and let Willem add the stuff in camel-osgi,0,0
Can not load the QueueBrowserStrategy in OSGI environment,Here is the mail thread which discusses about it.http://www.nabble.com/Classloading-and-OSGI-to22303475.html#a22303475,0,0
JMSMessage vanishes attachments,When using this kind of route&lt;from uri='activemq:queue:test'/&gt;&lt;camel:process ref='mailProcessor' /&gt;&lt;to uri='smtp://localhost:25?to=user@localhost' /&gt;and trying to enrich the message in the mailProcessor withexchange.getIn().addAttachment('attachement.txt'  new DataHandler('Hello world'  'text/plain'));The received mail doesn't contains any attachment.If the input 'from' is a 'direct' instead of activemq  it works fine.Inspecting source code  MessageSupport.copyFrom(Message that) doesgetAttachments().putAll(that.getAttachments());but the child class JmsMessage doesn't.,0,0
StreamCache causes to many type converters not possible,Since StreamCache is default turned on it cause to many convters attempt that fails in MessageSupport.No type converter available to convert from type: java.lang.Integer to the required type: org.apache.camel.StreamCache with value 1It hurts performance to much. See nabble:http://www.nabble.com/Performance-and-MessageSupport.getBody-%281.6.0%29-td22291841s22882.html,0,1
Bean component - improve method selection logic for overloaded methods,If end users have overloaded methods with different types as method parameter Camel should try to find the method with exact type match from the payload.See nabble:http://www.nabble.com/Is-it-possible-to-overload-a-bean-method--td22338316s22882.html,0,0
unmarshaling of data always send the last occurence of the stream,The unmarshaling method of BindyDataFormat (CSV or Key Value Pair) does not create a new model object for each new line of the stream readed,0,0
Unable to resolve scripting languages in OSGi environment,The OsgiLanguageResolver.java created since CAMEL-1221 does not resolve scripting languages by using the default resolver declared in camel-script. The DefaultLanguageResolver  however in the non-osgi context  handles it properly.This leads to NullPointerException while launching a route in an OSGi container using a scripting language  e.g. javascript.Exception in thread 'SpringOsgiExtenderThread-2' java.lang.NullPointerException at org.apache.camel.model.language.ExpressionType.createPredicate(ExpressionType.java:145) at org.apache.camel.model.ExpressionNode.createFilterProcessor(ExpressionNode.java:95) at org.apache.camel.model.WhenType.createProcessor(WhenType.java:57) at org.apache.camel.model.ChoiceType.createProcessor(ChoiceType.java:73)...,0,0
IdempotentConsumer - should only add to repository after processing  so we know the processing was a success,Just as the file component does with its build in support for idempotent. It should add to it last  eg after processing.See nabble:http://www.nabble.com/Problem-with-IdempotentConsumer-td22467720s22882.html,0,0
A request route with a topic node incurs a 20 second wait and refers to the wrong MEP.,If a route contains a node that publishes to a topic  the route is incorrectly suspended for a default 20 seconds at the topic node. Further  JmsProducer.java checks the MEP of the original request Exchange and not the endpoint of the topic.For example  say I have a route built like this:from('activemq:queue:request'). to('generate_news'). to('activemq:topic:news'). to('do_something_else');The original request is expecting a reply. However  after the 'news' is pumped into the news topic  there is a default 20 second wait (requestTimeout). This wait always results in the exception: 'The OUT message was not received within: 20000 millis on the exchange...' After reading the JmsProducer code  I changed the route to the following:from('activemq:queue:request'). to('generate_news'). to('activemq:topic:news?exchangePattern=InOnly'). to('do_something_else');This reveals the root of the bug  which is in the first few lines of method org.apache.camel.component.jms.JmsProducer.process(Exchange):// public void process(final Exchange exchange) { final org.apache.camel.Message in = exchange.getIn(); if (exchange.getPattern().isOutCapable()) {The above if statement checks the MEP of the original request's Exchange and not the new endpoint of the news topic. This makes the above '?exchangePattern=InOnly' configuration useless  because the original request MEP is InOut. The result is that after that 20 second time-out  the temporary queue for the original request has expired  so the whole request failed. Note that the next node 'do_something_else' is never reached due to the time-out exception.,0,1
JMX instrumentation - will add DeadLetterChannel even if you have defined to use NoErrorHandler,See nabble:http://www.nabble.com/StreamCaching-in-Camel-1.6-td22305654s22882.htmlI will add an unit test that demonstrates this:org.apache.camel.processor.ChoiceNoErrorHandlerTestThe route should at all time not contain any error handler at all  regardless wether JMX is enabled or not.,0,0
Added a Spring configuration in the camel-example-reportincident,We should provide the Spring configuration which equals to the Java DSL route rule in camel-example-reportincident  as some user prefer to use Spring.,0,0
JMS - Sending a message with jmsTemplate102=true fails,See nabble:http://www.nabble.com/Apache-Camel-2.0-M1-java.lang.ClassCastException%3A-org.apache.camel.component.jms.JmsConfiguration%24CamelJmsTeemplate102-td22665483s22882.htmlThe ClassCastException is because of the old JMS API is used.Camel should test whether the template is 1.1 or 1.0.2 and cast to correct type.,0,0
Allow parementer append for jms bindings with no endpoint,See test failures in https://issues.apache.org/activemq/browse/AMQ-2182,0,0
JmsPollingConsumer - receive does not work,The timeout values to set on Spring JmsTemplate is wrong. We should uses the provided constants on JmsTemplate for this /** * Timeout value indicating that a receive operation should * check if a message is immediately available without blocking. */ public static final long RECEIVE_TIMEOUT_NO_WAIT = -1; /** * Timeout value indicating a blocking receive without timeout. */ public static final long RECEIVE_TIMEOUT_INDEFINITE_WAIT = 0;Is the correct values. Looks like the values was reverted in the camel-jms code,0,0
Bean component should propagate headers,When doing a route an you invoke a bean that sets a response on the OUT body it does not propagate the headers from the IN body.,0,0
javax.xml.transform.Source and StreamSource wrapped should be easier to route with JMS,See SM-1826What end users need to do is to use .convertBodyTo(String.class) before sending to a JMS queue with Camel when the payload is XML based  eg the javax.xml.transform.Source class that can be wrapped in a StreamCache as well.It should be able to route out of the box by converting to byte[] in the JMS producer,0,0
HTTP_URI and HTTP_PATH message headers not concatenated when sending messages to http endpoint,When a message is sent to an http endpoint  the path specified in the HTTP_PATH header is ignored.In the HttpProducer.createMethod() of the camel-http component  the URI is taken from the HTTP_URI header or the endpoint  but the HTTP_PATH header is not concatenated. See also the discussion on the mailing list: http://www.nabble.com/Setting-a-path-in-message-header-with-Camel-http-2.0M1-td22781504.html,1,0
deploy the CamelContext with velocity endpoint into the Servicemix 4.0 will get the  NoClassDefFoundError,&#91;trace&#93; ******************************************************************* &#91;debug&#93; Starting Apache Velocity v1.5 (compiled: 2007-02-22 08:52:29) &#91;trace&#93; RuntimeInstance initializing. &#91;debug&#93; Default Properties File: org/apache/velocity/runtime/defaults/velocity.properties &#91;debug&#93; Trying to use logger class org.apache.velocity.runtime.log.Log4JLogChute &#91;debug&#93; Couldn't find class org.apache.velocity.runtime.log.Log4JLogChute or necessary supporting classes in classpath.org/apache/log4j/Layoutjava.lang.NoClassDefFoundError: org/apache/log4j/Layout at java.lang.Class.forName0(Native Method) at java.lang.Class.forName(Class.java:164) at org.apache.velocity.util.ClassUtils.getClass(ClassUtils.java:76) at org.apache.velocity.util.ClassUtils.getNewInstance(ClassUtils.java:95) at org.apache.velocity.runtime.log.LogManager.createLogChute(LogManager.java:147)We can get around this issue by replacing the org.apache.velocity.runtime.log.Log4JLogChute withorg.apache.velocity.runtime.log.Log4JLogChute  and also need to update the Servicemix Velocity bundle to 1.6.,0,0
Recursively scan multipart nodes of an email for attachments - not just top level nodes,The current code will only scan the top level of a multipart message. This misses any attachments that are under another node.All unit tests still run for me after applying this patch.,0,0
Allow sending multipart/alternative MIME messages with both a plain-text and text/html body  and allow sending images inline,To send a multipart/alternative email you have to follow a pretty specific course.This adds a property (which is poorly named in this patch) to the MailConfiguration that names the header that contains the plaintext version of the email  and adds a property where you can embed images inline. If an attachment has a filename starting with 'cid:' then this will add the 'Content-ID' header to that multipart body - which will allow the email client to put the image in the appropriate place when it is viewed. (i.e. the html email has something like &lt;image src='cid:0001' /&gt; and the attachment is named 'cid:0001' - when it sees an inline attachment with 'Content-ID: 0001' it will put it in the right spot),0,0
http component - allow failed responses to be returned on the exchange instead of HttpOperationsFailedException,It can be a bit cumbersome to eg handled 404 error codes if it gets thrown back as an exception. Sometimes you want to handle any response from the http producer in the exchange itself.,0,0
Upgrade camel-http to use httpclient 4.0,Upgrading httpclient from 3.1 to 4.0 requires changes in the camel-http code as the API has change quite a lot.,0,0
Apply removeHeader also to the underying JMS message delegate,In case of a JMS message  header information is redundantly stored in org.apache.camel.component.jms.JmsMessage (here Camel-Message) and in its javax.jms.Message jmsMessage delegate (here JMS-Message). Currently you cannot remove effectively any header from the Camel-Message instance as in the next processing step those removed headers resurrect from the underlying JMS-Message.Please provide any means to remove or or at least mask out those headers from the underlying JMS-Message.,1,0
ErrorHandler to be wrapped at every node incl children,,0,0
Converting from stream/reader to string changes line breaks other than '/n',The IOConverter#toString(Reader/Stream) copies the input data line by line. A line is considered to be terminated by any one of a line feed ('/n')  a carriage return ('/r')  or a carriage return followed immediately by a linefeed. Unfortunately  the lines are always concatenated with '/n'  so that HL7 messages (which use '/r') become unusable after conversion.Also see http://www.nabble.com/HL7-messages-become-unusable-after-convertBodyTo%28String.class%29-td23219748.html,0,0
ClassCastException when using camel-cxf and camel-jms in the InOut same flow,As per thread on FUSE forum http://fusesource.com/forums/thread.jspa?threadID=834&amp;tstart=0:[[I have a camel route that listens on a CXFEndpoint (for MESSAGE data as DOMSource) and routes the message to a JMS queue. Something like:&lt;route&gt;&lt;from uri='cxf:bean:passportRequestWS?dataFormat=MESSAGE'/&gt;&lt;to uri='soapProcessor'/&gt;&lt;convertBodyTo type='java.lang.String'/&gt;&lt;to uri='activemq:queue:blah'/&gt;&lt;convertBodyTo type='javax.xml.transform.dom.DOMSource'/&gt;&lt;/route&gt;My understanding is that the JMS producer will realize that the exchange is InOut  create a temporary queue for the response  and then wait for the response to arrive on the temporary queue before sending the original CXFExchange on along the pipeline. Indeed  this is what I observe! However  I?ve discovered a little nasty.When the JMSProducer gets in the incoming message  it sets the Out message of the original CXFExchange to a JmsMessage. Then  the pipeline processor calls exchange.getOut on the CXFExchange and BANG! we get a class-cast exception. Turns out that the CXFExchange.getOut() method always casts the message to a CxfMessage. Ouch. Surely this means then that camel-cxf can?t talk to any producer that does not produce a CXFMessage - very limiting.]]The response on the form from davsclaus was:[[Well spotted.If just the damn Exchange was final so we had one implementation of it. But I guess we have to thank Java generics for that so the first API had generics for per component.Could you create a ticket in JIRA for this?As a workaround you can add a processor where you have full access to the Exchange so you can set a CxfMessage as the payload.]],0,0
SFTP GenericFileProducer.createFileName produces OS normalized file name  that doesn't work with SFTP,The use of File.separator and FileUtil.normalizePath in GenericFileProducer.createFileName produce a OS normalized file name  that doesn't work with SFTPe.g. outboundout_20090501_091940_ACC.txt which will not work produce a file called outboundout_20090501_091940_ACC.txtThe proper name should be outbound/out_20090501_091940_ACC.txt,0,0
camel-cxf producer loses the content-type,camel-cxf doesn't put the Protocol-Header into the camel message header  so we lost the content-type message.Here is the mail thread for the discussion.http://www.nabble.com/camel-cxf-content-type-response-header-tt23370337.html,0,0
Clean up  the CamelTransportConstants.CONTENT_TYPE,Here is the mail thread about it.http://www.nabble.com/Re%3A-svn-commit%3A-r772054---in--camel-trunk-components-camel-cxf-src%3A--main-java-org-apache-camel-component-cxf-CxfHeaderFilterStrategy.java--test-java-org-apache-camel-component-cxf-CxfRawMessageRouterTest.java-tt23412367.html,0,0
Warning 'Disabling JMSReplyTo as this Exchange is not OUT capable' on false positives in JBossAS5,see: http://www.nabble.com/Disabling-JMSReplyTo-as-this-Exchange-is-not-OUT-capable-td23524909s22882.html,0,0
Race condition in IdempotentConsumer,A possible possible race condition exists in the IdempotentConsumer implementation:The code first checks in the MessageIdRepository if the message was already processed. If not then it processes the message andafterwards adds the id to the repository. (See also http://issues.apache.org/activemq/browse/CAMEL-1451). There is no lockingbetween the check with 'contains' and the insert with 'add'. So if multiple threads/instances try this in parallel for the same id  thenit might happen that more than one finds the id not yet contained in the repository and the same message is processed multipletimes.I enclose an extended version of IdempotentConsumerTest which illustrates the problem.It is important to note that even if the test demonstrates the issue with an MemoryIdempotentRepository a solution should alsoaddress the case of a database based respository in a clustered environment. So this might imply that some locking mechanism on thedatabase is required.,0,0
Clean up the CamelNamespaceHandler,Since we use the JAXB to parse the Routes definitions so we can get ride of the unnecessary bean parser registry code.,0,0
CAMEL-HTTP should copy system proxy settings,By standard  Java uses some properties for configuring proxies. Details are on http://java.sun.com/javase/6/docs/technotes/guides/net/proxies.html but in short the properties http.proxyHost and http.proxyPort are used for setting a global HTTP proxy.CAMEL-HTTP doesn't reuse this. I guess many would expect it to.,0,0
Enrich DSL - Add fluent builder for using default aggregation strategy,The fluent builder is missing the enrich(uri) method that uses the default agg strategy. That is to copy the result from the resource as input.This is also very useable.In Spring DSL this is already possible as you do not have to provide the strategyRef attribute.,0,0
JMS-Headers are ignored in Producer,Camel jms producer ignores some JMSHeaders. For example the header JMSPriority is ignored - due to the comment in the code  because it is set by the producer. But it should not only be set by the produer due to the received message  it should also be possible to set a priority using the JMSPriority header on the consumer. (See also the option preserveMessageQos on the jms endpoint - if every JMSHeader is ignored by the producer it is impossible to set Qos-Properties on the message.)The reason for the bug is in org.apache.camel.component.jms.JmsBinding#appendJmsProperty. The follwoing JMS message headers are useful for sending messages and therefore should be copied to the jms message: JMSDestination JMSDeliveryMode JMSExpiration JMSPriority JMSMessageID JMSTimestamp,0,0
Java DSL for multicast  split  aggregate does not use block explicit,When using one of the EIP that uses a nested route for sub processing  typically EIPs that does some sort of aggregation such as multicast (for aggregating a response) split aggregateAnd maybe a few othersThey should use pushBlock so the end() DSL to indicate end of sub route works correctly in Java DSL.,0,0
DefaultErrorHandler - add support for redelivery,The new default error handler does currently not support redelivery. The error handling codebase has stabilized and we should allow this error handler to leverage the redelivery features we have in DeadLetterChannel.,1,0
Simple language support for AND / OR to concat multiple expressions fails if string constants are enclosed in single quotation marks,The current implementation for CAMEL-1637 fails if the string constants in the two expressions are enclosed in single quotation marks as given in the following example ${in.header.foo} == 'abc' and ${in.header.bar} == '123'This is due to an issue with the GROUP_PATTERN regular expression in SimpleLanguageSupport.java. The matching pattern in between the single quotes is greedy and thus does not match correctly.,0,0
Remove cycle between model and util,Currently util and model reference each other what makes them difficult to understand separately. When you look closely at the references you see that model only needs one class ProcessorDefinitionHelper. As this class only needs other classes from model I think it should belong to model. As this class is only needed from model I think it does not need to be public. So it is also clear that the class does not belong to the camel model classes users should access.,0,0
bean component should thrown NoTypeConverterException when bean parameter binding cannot convert to method signature type,See nabble:http://www.nabble.com/Error-not-raised-by-Camel-if-the-%40Header-type-define-in-a-bean-is-not--correct-td24051086s22882.html,0,0
Better logging at startup if Camel uses camel-osgi or not,We should at least once at INFO level log whether OSGi was detected or not.And in the camel-osgi we should have more DEBUG / TRACE logging as well.,0,0
camel-example-etl - bug in sample about type converter,,0,0
camel-cxf defaultHeaderFilterStrategy doesn't filter the Camel releates headers,Here is the mailing thread&#91;1&#93; which discuss this issue.&#91;1&#93; http://www.nabble.com/-camel-cxf--Stripping-headers-td24143323.html,0,0
ScheduledPollConsumer - Should not throw polled exception on stop,See CAMEL-501And nabble:http://www.nabble.com/Bug-in-ScheduledPollingConsumer--td24151070s22882.htmlIf an exception occured during a poll Camel will handle it by a ExceptionHandler you can set on the DefaultConsumer. The default impl will log it at WARN level.But the ScheduledPollingConsumer will remember this and when it does a doStop in case of shutdown or the likes it will throw the first exception occurred during a poll.This will indicate in an ERROR when doing a shtudown and its not really related as the poll error could have happened like 3 months ago.We should not do this. But only handle the poll exception when it occurred. End users can configure their own ExceptionHandler if they want to do something differently than logging.,0,0
Validator component to use SaxSource internally,ValidatingProcessor uses DOMSource internally while SaxSource could perform better.,0,0
SpringCamelContext will get into endless loop of calling start method if the route service calling the ApplicationContext refresh method in it's initial method,Here is the mail thread which discusses this issue.http://www.nabble.com/StackOverFlow-error-with-Camel-1.6.1-tp24172060p24172060.html,0,1
Failover load balancer - should prepare exchange before failover,When the failover load balancer does a fail over it only clears the exception.When you use dead letter channel or default error handler with redeliveries enabled they will have such information.This should also be cleared before failover. So we have a clean and fresh start.,0,0
Unable to read post params from request,If consuming messsages from jetty endpoint there is no way to read post parameters from HttpServletRequest. In example getting HttpServletRequest from body :HttpServletRequest req = exchange.getIn().getBody(HttpServletRequest.class);req.getParameterMap() returns allways empty mapThe problem is that jetty Request.extractParameters() method is trying to read post parameters from Request.getInputStream(). But unfortunately someone strips the input stream before and req.getInputStream() returns allways 0 bytesThe workaround for me is to extend DefaultHttpBinding as described in: http://camel.apache.org/jetty.htmlMyHttpBinding .javapublic class MyHttpBinding extends DefaultHttpBinding { public void readRequest(HttpServletRequest request  HttpMessage message) { request.getParameterMap(); super.readRequest(request message); }}calling request.getParameterMap() will cache parameters inside jetty Request and it's possible to query params later  without having inputStream,0,0
Camel builds should not use platform specific encoding,The builds on my Mac use the platform specific encoding thus leading to the following warngin:[WARNING] Using platform encoding (MacRoman actually) to copy filtered resources  i.e. build is platform dependent!We should use the &lt;project.build.sourceEncoding&gt; property to specify a project specific encoding (UTF-8).,0,0
License for One-JAR classes not included in camel-example-spring one-jar artifact. Also apache legal files missing,The license for the com/simontuffs/onejar files is at http://one-jar.sourceforge.net/index.php?page=documents&amp;file=license.When I build camel-example-spring neither this license nor the apache license nor apache notice file is in the one-jar.jar artifact.I'd suggest disabling the one-jar plugin until someone can figure out how to include these files.,1,0
Upgrade maven build to use apache 6 pom and related features.,Geronimo recently has had some problems due to unversioned snapshots of camel. Since nexus automatically cleans up old snapshots it's preferred to use unique timestamped snapshots when publishing to apache nexus.There are some other nice standard featrues of the apache 6 pom and related work such as automatic source archive creation. I'm attaching a patch that updates to apache 6 pom and cleans up a few other things.Since the build fails for me before the changes I can't be very sure that these changes break nothing.,0,0
camel-file - consumer  starting directory should validate that its configured properly eg not containing dynamic expressions etc,You cannot use ${ } in the start path of file/ftp consumers. Use the fileName option for that. We should validate and thrown an exception about this so end users notices this immediately and can fix it.,0,0
camel-jms - allow a header like JMSDestination to override the destination to send to,We cannot use JMSDestination as it would not work when you do a route from(jms A) to (jms B) as it will go into round about as when received from jms A the header will contain JMSDestination = queue:A and thus Camel will send it back to itself.So we should a different nameCamelJmsDestination,0,1
camel-irc parsing of channel name and parameters is incorrect,If you try and pass some parameters to camel-irc it turns out that camel joins a different IRC channel than expected  for example a URI like:irc://camel-con@irc.codehaus.org:6667/#camel-test?nickname=camel-concauses camel to join #camel-test?nickname=camel-con and not #camel-test with a nickname of camel-con. Will attach a patch that addresses this and updates the unit test.,0,0
CustomerServicesWsAddressingTest hangs sometimes,Sometimes I get the following error&#91;23:59:55&#93;: Running org.apache.camel.itest.customerrelations.CustomerServicesWsAddressingTest&#91;00:00:06&#93;: Exception in thread 'DefaultMessageListenerContainer-4' java.lang.NullPointerException&#91;00:00:06&#93;: at java.lang.String.indexOf(String.java:1564)&#91;00:00:06&#93;: at java.lang.String.indexOf(String.java:1546)&#91;00:00:06&#93;: at org.springframework.jms.support.JmsUtils.buildExceptionMessage(JmsUtils.java:255)&#91;00:00:06&#93;: at org.springframework.jms.listener.DefaultMessageListenerContainer.handleListenerSetupFailure(DefaultMessageListenerContainer.java:745)&#91;00:00:06&#93;: at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:897)&#91;00:00:06&#93;: at java.lang.Thread.run(Thread.java:595)... which then causes a hang. Its a known issue in spring-jms 2.5.6 (http://jira.springframework.org/browse/SPR-5470). Happens when we try to do a shutdown of the context. Reverting back to 2.5.5 fixes this issue  but we probably don't want to do that,0,1
camel-jms - wrong defaults causes message listener to use new thread when receiving a message,JmsConfiguratiuon have a bad defaultmaxMessagesPerTask=1It should be -1 as we do not want to strict the DefaultMessageListenerContainer to only handle 1 message per thread.,0,1
EventDrivenConsumer - Wait starting them until all other processors / routes have been started,We should wait starting the input to the CamelContext until all child processors and other services have been started.Then at the end we should open the gates by starting all the input consumers.That should also help unit testing on slower boxes where these consumers might start a bit early and the remaining work starting the other processors is slow and thus the consumer is too fast.,0,0
FTP component - add option to specify retry login attempts,When ftp component attempts login it does that once. We should add option to configure how many attempts should be done before giving up.For instance try 3 times with 1 sec apart.,0,0
file component - markerFile read lock - do not use nio FileLock,In some situations in OSGi platforms the file lock can be kept and then you need to shutdown the JVM to clear the JDK FileLock.So better to not use them as we can just create the file and Camel will still back off reading the file as it can see the lock file exists.,0,0
Cleanup unnecessary copy related methods in Exchange,There are currently 4 apis related to copying exchanges that overlap for the most part  are confusing and unnecessary. The consensus is to replace: Exchange newInstance(); Exchange copy(); Exchange newCopy(boolean handoverOnCompletion); void copyFrom(Exchange source);with: Exchange copy(); Exchange copy(boolean handoverOnCompletion);newInstance() does not bring much value copyFrom() is semantically equivalent to copy()newCopy() will be just renamed to copy(boolean) See nabble thread:http://www.nabble.com/-DISCUSS--Exchange-copy-api-cleanup-td24400340.html,0,0
jaxb prettyPrint does not work,Here is the mail thread with discuss about it. http://www.nabble.com/JAXB-pretty-print-marshaling-td24449564.html,0,0
camel-ftp - Recover from lost connection issue,See nabblehttp://www.nabble.com/FTP-Component-Network-Failure-Recovery-Problem-td24517828.html,0,0
camel-web can't process the endpoint with '://' schema  like /endpoints/mock://results,After improving the endpoint URI schema on http://issues.apache.org/activemq/browse/CAMEL-1756  camel-web's endpoint request URL is changed from http://localhost:8080/endpoints/mock:results into http://localhost:8080/endpoints/mock://results while '//' is a separator for URL  so camel-web will use only the 'mock:' to get the expected endpoint  which will throw an exception:org.apache.camel.ResolveEndpointFailedException: Failed to resolve endpoint: mock: due to: Expected scheme-specific part at index 5: mock: at org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:367) at org.apache.camel.web.resources.EndpointsResource.getEndpoint(EndpointsResource.java:75) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:585) at com.sun.jersey.server.impl.uri.rules.SubLocatorRule.invokeSubLocator(SubLocatorRule.java:135) at com.sun.jersey.server.impl.uri.rules.SubLocatorRule.accept(SubLocatorRule.java:89) at com.sun.jersey.server.impl.uri.rules.RightHandPathRule.accept(RightHandPathRule.java:111) at com.sun.jersey.server.impl.uri.rules.SubLocatorRule.accept(SubLocatorRule.java:105) at com.sun.jersey.server.impl.uri.rules.RightHandPathRule.accept(RightHandPathRule.java:111) at com.sun.jersey.server.impl.uri.rules.ResourceClassRule.accept(ResourceClassRule.java:71) at com.sun.jersey.server.impl.uri.rules.RightHandPathRule.accept(RightHandPathRule.java:111) at com.sun.jersey.server.impl.uri.rules.RootResourceClassesRule.accept(RootResourceClassesRule.java:63) at com.sun.jersey.server.impl.application.WebApplicationImpl._handleRequest(WebApplicationImpl.java:654) at com.sun.jersey.server.impl.application.WebApplicationImpl.handleRequest(WebApplicationImpl.java:612) at com.sun.jersey.server.impl.application.WebApplicationImpl.handleRequest(WebApplicationImpl.java:603) at com.sun.jersey.spi.container.servlet.WebComponent.service(WebComponent.java:309) at com.sun.jersey.spi.container.servlet.ServletContainer.service(ServletContainer.java:425) at com.sun.jersey.spi.container.servlet.ServletContainer.doFilter(ServletContainer.java:737) at com.sun.jersey.spi.container.servlet.ServletContainer.doFilter(ServletContainer.java:689) at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1148) at com.opensymphony.module.sitemesh.filter.PageFilter.parsePage(PageFilter.java:119) at com.opensymphony.module.sitemesh.filter.PageFilter.doFilter(PageFilter.java:55) at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1148) at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:387) at org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216) at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181) at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:765) at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:417) at org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114) at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152) at org.mortbay.jetty.Server.handle(Server.java:324) at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:535) at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:865) at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:539) at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:212) at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404) at org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:409) at org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:520)Caused by: java.net.URISyntaxException: Expected scheme-specific part at index 5: mock: at java.net.URI$Parser.fail(URI.java:2816) at java.net.URI$Parser.failExpecting(URI.java:2822) at java.net.URI$Parser.parse(URI.java:3025) at java.net.URI.&lt;init&gt;(URI.java:578) at org.apache.camel.util.URISupport.normalizeUri(URISupport.java:354) at org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:365) ... 39 more,0,0
CachedOutputStream not cleaning up tmp files when using file based caching,A recent feature of Camel's CachedOutputStream is to serialize any messages over 64k to disk. In some cases the *tmp message files are not being cleaned up.,0,0
Route JMX attributes not being updated,Some routes are not getting instrumented using JMX and we get the following WARN for those on startup;InstrumentationLifecycleStrategy: Route has not been instrumented for endpoint: ...It turns out that its only those routes that have an onException handler as the first processor in the route  e.g.&lt;route id='per-msg-route' errorHandlerRef='RouteErrorHandler'&gt; &lt;from uri='jms:MSG_IN'/&gt; &lt;onException&gt; &lt;exception&gt;can.retry.Exception&lt;/exception&gt; &lt;redeliveryPolicy ref='UnlimitedRedeliveryPolicyConfig'/&gt; &lt;handled&gt;&lt;constant&gt;true&lt;/constant&gt;&lt;/handled&gt; &lt;/onException&gt; &lt;bean ref='Formatter' method='formatInput'/&gt;...8&lt;... More info and proposed fix at http://www.nabble.com/Routes-JMX-attributes-not-updated-in-2.0-M2-td24631265.html#a24639433,0,0
Provide a flag to avoid mapping a JMS message to it's actual type,CAMEL-1853 adds the ability to use a custom Spring MessageConverter to map an incoming (or outgoing) JMS Message  and also makes it easier to do a pass through route where Camel does not try and deserialize a serialized object message. This improvement is to add a simple flag that achieves a similar effect but without having to supply a MessageConverter implementation.,0,0
camel-cxf bundle doesn't specify any Import-Package version,The camel-cxf component is currently generated against CXF version 2.2.2.As a result  the camel-cxf module as well as the camel-cxf bundle require CXF 2.2. More importantly  that bundle does not work correctly with CXF 2.0 (note that this is an expected behavior  CXF has had API changes with its 2.2 version).Now  the trouble is that the camel-cxf JAR's MANIFEST has an Import-Package on org.apache.cxf.* components without specifying any version! As a result  when it looks for CXF and both CXF 2.0 and 2.2 are present on the platform  it sometimes chooses the wrong one.To solve this issue  version specifiers should be added to the Import-Package declarations of the camel-cxf bundle. I guess an import on version 2.2 would be enough (we don't need to specify 2.2.2 explicitely).CheersS. Ali Tokmenhttp://ali.tokmen.com/,0,0
NPE thrown when DEBUG logging on,Stack trace;org.apache.camel.language.bean.RuntimeBeanExpressionException: Failed to invoke method: doSplit on MySplitter due to: java.lang.NullPointerException at org.apache.camel.language.bean.BeanExpression.evaluate(BeanExpression.java:82) at org.apache.camel.language.bean.BeanExpression.evaluate(BeanExpression.java:87) at org.apache.camel.processor.Splitter.createProcessorExchangePairs(Splitter.java:72)...Caused by: java.lang.NullPointerException at org.apache.camel.util.MessageHelper.extractBodyForLogging(MessageHelper.java:129) at org.apache.camel.impl.DefaultMessage.toString(DefaultMessage.java:38) at java.lang.String.valueOf(String.java:2827) at java.lang.StringBuilder.append(StringBuilder.java:115) at java.util.AbstractCollection.toString(AbstractCollection.java:422) at java.lang.String.valueOf(String.java:2827) at java.lang.StringBuilder.append(StringBuilder.java:115) at org.apache.camel.component.bean.BeanProcessor.process(BeanProcessor.java:139)Steps to reproduce;1. Create simple route with splitter pattern; e.g.&lt;route&gt; &lt;from uri='jms:IN_QUEUE'/&gt; &lt;split&gt;&lt;method bean='MySplitter' method='doSplit'/&gt; &lt;to uri='log:route.log'/&gt; &lt;/split&gt;&lt;/route&gt;2. Set DEBUG logging on for org.apache.camel classes  e.g.log4j.logger.org.apache.camel=DEBUG3. Fire message into route - message fails with NPE inside Camel,0,0
JmsKeyFormatStrategy not used consistently and JmsMessage.getHeader() not returning correct value,On entry to a route from a JMS endpoint configured with PassthroughJmsKeyFormatStrategy the headers with underscores (_) are passed through correctly.However  when any header value in the message is then changed  the original headers are added back into the message using the DefaultJmsKeyFormatStrategy. For example  sending a JMS message with headers;HEADER_1=VALUE_1HEADER_2=VALUE_1we do see just these two headers in the message received into the route.However  if we then set a header value in the route  say HEADER_1=VALUE_2  we now see the headers;HEADER.1=VALUE_1HEADER.2=VALUE_1HEADER_1=VALUE_2HEADER_2=VALUE_1For some reason in the set header process the original message headers and values get added into the message after being passed through the DefaultJmsKeyFormatStrategy. This has the implication of unnecessary duplication of the headers.Also  when a message header is accessed using the getHeader(key) method it also goes through the DefaultJmsKeyFormatStrategy to decode the key that is passed. In the example above  if after we have updated 'HEADER_1' to 'VALUE_2'  we do;message.getHeader('HEADER_1') this goes through the DefaultJmsKeyFormatStrategy and actually gets executed as message.getHeader('HEADER.1') which returns VALUE_1 (wrong!).Note: if instead we lookup the header through message.getHeaders() which returns the all headers in a Map  we can correctly access the 'HEADER_1' key. (Why is getHeader(key) even going through the KeyFormatStrategy anyway if setHeader() isn't?),0,0
camel-mail - Add option to ignore unsupported charset and fallback to platform default instead,See nabble:http://www.nabble.com/Camel-Mail-issue-with-unsupported-charset-td24755585.html,0,0
camel-jms - DefaultJmsKeyFormatStrategy should replace . with _DOT_ to avoid conflicting with end user using _,If an end user sends a JMS property asMY_KEYThen it should be preserved when Camel route it  so the receiver side using Camel as well will see it as: MY_KEY and not MY.KEY.The code should be: String answer = key.replace('.'  '_DOT_'); answer = answer.replace('_DOT_'  '.');,0,0
template   consumerTemplate  service  proxy can't be set with right camel context if there are more than one camel context in the spring application context,Current camel support to define a producer template OUTSIDE a camel context  I think it works well just like the autowire function which is provided in Spring.If there more than two Camel context in the Spring Application context   the user should specify the camel context which the template should use.But I have a concern that even we put the template INSIDE the camel context  the template will not be set with a right version of camel context  since we use a CamelPostProcessor to inject CamelContext.So I did a quick test on the current Camel code and found there is a bug if there are more one CamelContext &#8211; CamelPostProcessor will inject the last create camel context into the CamelContextAware object. Since it is not easy to add the camelContext referece id into the template element attribute  we'd better just support to parser these elements inside the camel context.,0,0
Bean component - invokes onMessage from javax.jms.MessageListener even though a specific method name have been provided,This is only an issue when your bean implements javax.jms.MessageListener and then specify a specific method to use  then Camel will still prefer to use the onMessage method.,0,0
camel-irc consumer only listens to messages on a channel and ignores direct messages,While camel-irc listens to events on a channel very nicely  if you send a camel-irc consumer a message directly it ignores it.,0,0
XMPP producer and consumer don't share the same connection and Chat objects,It's actually not possible to produce and consume messages from the same XMPP endpoint  i.e. something like:from('xmpp://irc.jabber.org...').to('direct:out');from('direct:in').to('xmpp://irc.jabber.org...');typically what I see happen is that the consumer will work until the XMPP producer sends a message  at that point the consumer stops receiving messages. What's happening is that producers and consumers created from the endpoint also create their own connection object and then also create their own Chat object. The attached patch ties the XMPP connection to the endpoint  making a producer or consumer share this connection. If a consumer creates the Chat first the producer will look it up and connect to the existing Chat. If the producer creates the Chat then the consumer will attach itself as a listener to this Chat.I notice that the tests are turned off as they require a local Jabber server instance to run. Is it worth creating some accounts on jabber.org to run the test with? Currently I've been testing this patch using my own Google talk accounts  this is all working towards an IRC to Jabber bridge that I might submit later on as a more complicated demo...,0,0
camel-file - Consume and pollEnrich another file should work transparent,See nabblehttp://www.nabble.com/Problem-with-FileConsumer-and-pollEnrich-td24795192.html,0,0
Xmpp consumer stops consuming after some time,Noticed after creating some more complicated routes that my xmpp consumers would stop receiving messages. This patch sorts that out  I also improved some of the logging in the producer and consumer classes and tweaked the XmppRouteChatTest to work properly.,0,0
Unit test failures on Windows in 2.0.0 release,3 failures in camel-core that do not seem to occur on linux and mac.Failure Details testCannotDeleteFile junit.framework.AssertionFailedError: Should have thrown an exceptionorg.apache.camel.component.file.strategy.GenericFileDeleteProcessStrategyTest:125 testCacheStreamToFileAndNotCloseStream junit.framework.AssertionFailedError: we should have no temp file expected:&lt;1&gt; but was:&lt;0&gt;org.apache.camel.converter.stream.CachedOutputStreamTest:117 testRouteIsCorrectAtRuntime junit.framework.AssertionFailedError: expected:&lt;4&gt; but was:&lt;1&gt;org.apache.camel.processor.ChoiceWithEndTest:39,0,0
HTTP component throwing IllegalArgumentException in M3 release while bridging between jetty and http,The CamelHttpUri header is not set to the right value while routing between jetty and http components. Because of which the construction of the HttpMethod in the http component fails and throws up an IllegalArgumentException.Detailed discussion regarding this issue can be found in this following thread.http://www.nabble.com/HTTP-component-throwing-IllegalArgumentException-in-M3-release.-tt25057133.html#a25057133,0,0
XmppBinding will add non-serializeable header values to the outgoing xmpp message,I started using velocity in my project which seems to add some headers to the message exchange  the values of which are apparently not serialize-able. As a result when a message in my route gets to the camel-xmpp component it fails in XmppBinding with an IllegalArgumentException as the binding tries to add the bad header. This patch that by not inserting any headers into the xmpp message that don't have serialize-able values.,0,0
Unit test failure in Windows for StreamCache. Temp file is not deleted,The temporary file is not deleted. I think the file is still open in some other stream. The problem is I have no idea how to find this place. Like in issue CAMEL-1924 this only happens on windows as on unix you can delete a file even if there are open streams.testStreamCacheToFileShouldBeDeletedInCaseOfException java.lang.AssertionError: There should be no files expected:&lt;1&gt; but was:&lt;0&gt;org.apache.camel.component.jetty.HttpStreamCacheFileTest:71,0,0
Revamped IRC component event adapter logging,Currently only the camel-irc producer installs an event listener on the IRC connection to log incoming messages from the IRC server. This patch revamps the logging so that the component installs an event adapter to do logging before the connection is even established so it's easier to debug various issues that could be occurring with the connection to the IRC server.,0,0
ServiceSupport - incorrect state after restart,This hampers restart of services by example the overhauled JMX in CAMEL-1933.When a service was restarted it had the following incorrect state: started = true starting = false stopped = true stopping = falseThe stopped should have been changed to false as its started.,0,0
Add server name to logging event adapter,When connected to multiple IRC servers it's a bit difficult to figure out what server incoming log messages from the event adapter are from. This patch adds the IRC server responsible for a given log message from the event adapter.,0,0
camel-jms consumer endpoint should allow properties such as maxConcurrentConsumers and concurrentConsumers to be managed via JMX,,0,0
Exchange - getIn and getOut with expected type parameter,It would be nice with a getIn(type) method so you can avoid ugly type cast and let Camel do type casting instead.CxfMessage cxf = exchange.getIn(CxfMessage.class);And the same for a getOut as well.,0,0
camel-irc should handle onReply callbacks,Currently it's not possible to receive the response from commands like WHO as irclib invokes onReply when it gets a response from the IRC server  which the IrcConsumer doesn't implement. This patch adds that and also turns on debug logging for the IRC component in the tests.,0,0
Graceful shutdown problem,While running camel-example-spring-jms in 2.0M3  I've noticed that GracefulShutdownService can't stop Camel. It calls Main.getInstance().stop();but this call blocks and never returns. With enabled debug logging for org.springframework.jms  console outputs&#91;aultMessageListenerContainer-1&#93; efaultMessageListenerContainer DEBUG Waiting for shutdown of message listener invokers&#91;aultMessageListenerContainer-1&#93; efaultMessageListenerContainer DEBUG Still waiting for shutdown of 1 message listener invokersRelated forum thread:http://www.nabble.com/Garceful-shutdown-bug-in-2.0M3--td25113519.htmlDado,0,0
Restarting JmsConsumer should pickup configuration changes,You should be able to using JMX to manage JMS endpoints and change configuration such as number of concurrent consumers.Then when restarting the jms consumers they should pickup any configuration changes done on the jms endpoint.,0,0
Better OSGi metadata to allow deploying multiple camel versions in the same OSGi framework,,0,0
Spring DSL - errorHandlerRef should only be support on camel context or route,It just makes it to confusing you can set it on a processor definition in the middle of a route.Only these 2 xml tags should support it camelContext route,0,0
camel-jpa exports the org.apache.camel.processor.interceptor which leads to a split package,The package is already exported by camel-core  so the class in this package needs to be moved to another package.,0,0
NPE when the bundle is camel-osgi bundle is inactive,The stack trace. java.lang.NullPointerException atorg.apache.camel.osgi.OsgiFactoryFinder.getResource(OsgiFactoryFinder.java:85) atorg.apache.camel.osgi.OsgiFactoryFinder.findClass(OsgiFactoryFinder.java:51) atorg.apache.camel.component.file.GenericFileEndpoint.createGenericFileStrategy(GenericFileEndpoint.java:130) atorg.apache.camel.component.file.GenericFileEndpoint.getGenericFileProcessStrategy(GenericFileEndpoint.java:114) atorg.apache.camel.component.file.GenericFileConsumer.processExchange(GenericFileConsumer.java:162) atorg.apache.camel.component.file.GenericFileConsumer.processBatch(GenericFileConsumer.java:120) atorg.apache.camel.component.file.GenericFileConsumer.poll(GenericFileConsumer.java:93) atorg.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:98) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) atjava.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:317) at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:150) atjava.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:98) atjava.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:181) atjava.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:205) atjava.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) atjava.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:619)Here is the mail thread&#91;1&#93; which discusses about this issue.&#91;1&#93;http://www.nabble.com/Error-using-camel-file-with-windows-tt25475829.html#a25486384,0,0
DataSet - Add initial delay with a default of 1 sec,To avoid data set consumers starting spitting out messages before other routes have properly started.,0,0
XmppMessages don't get converted to strings,This has been bugging me for awhile  when you have a route using XMPP you get instances of XmppMessage in your route rather than just a string containing the body of the XmppMessage. Tracked that down and took out the work arounds I had previously put in my contributed xmpp tests.,0,0
Improper configuration of MINA connector and acceptor instances; Better producer,A sample scenario where both MINA producer(s) and consumer(s) are used in the same route (e.g. some kind of dispatching or proxying):from('mina:tcp://localhost:8888?lazySessionCreation=true&amp;sync=true') .to('mina:tcp://localhost:7777?lazySessionCreation=true&amp;sync=true');from('mina:tcp://localhost:7777?lazySessionCreation=true&amp;sync=true') .process(/prepare answer/);Due to improper configuration of MINA acceptor and connector instances in MinaComponent#createSocketEndpoint()  no more than 15 incoming threads can be served at port 8888 &#8211; the producer becomes unable to open an outgoing session. This is actually an issue of MINA  not of Camel &#8211; a test application written using 'raw' MINA shows the same behaviour.A solution is to apply configuration rules described  e.g.  at http://mina.apache.org/configuring-thread-model.html  as done in the attached patch.Moreover  the standard Camel-MINA producer is not thread-safe &#8211; actually a well-known point. A second attached file contains a thread pool-based reentrant version  which can be efficiently used for TCP endpoints with both parameters 'lazySessionCreation' and 'sync' set to true.,0,0
Camel Bean component should not remember the last called method name if the bean's method name is not explicitly specified.,Here is the mail thread which discuses this issue. http://www.nabble.com/Bean-endpoint-in-a-route-is-holding-reference-to-the-last-used-methodName-and-does-not-invoke-Camel%27s-Bean-binding-tp25838095p25838095.html,0,0
DeadLetterChannel - Should pre check the endpointUri is valid and report failure on startup,If you misconfigure the DLC endpoint URI it will get created on demand and if case of a problem its logged. We should pre check this on route startup so we know the DLC queue works.,0,0
Redundant interceptions when using interceptSendToEndpoint,See http://www.nabble.com/Issue-with-interceptSendToEndpoint-to25859201s22882.html,0,0
Dynamic Recipient List - Comma is always delimiter even if custom specified,See nabblehttp://www.nabble.com/Dynamic-RecipientList-delimeter-issue-td25917854.html,0,0
camel-mail - extracting mails with headers using multi values inserts duplicates,Sending a message with headers that contains 2 values such a String[] with 2 values will result on the other side when consuming that mail message to contain a header with 2 entries. There should only be 1 entry with the 2 values.,0,0
camel-jpa - JpaProducer should mandate body instead of creating a new empty instance,If you send an empty body to a JpaProducer it will create a new empty instance of that type which then gets inserted.Camel should thrown an exception indicate a body is missing,0,0
http polling consumer does not support timeout,When using the consumer template to receive from a remote http service using camel-http the method receive(5000) that uses a 5 sec timeout does not work as expected.Camel does not use the 5000 value.,0,0
velocity endpoint should not remember the last used template uri,If there are two velocity endpoint linked with the pipeline  you will find the last velocity will not effect anymore.,0,0
CamelContext should support autoStartup,We now have option autoStartup on routes. Lets also have this on the camel context itself so it replaces the shouldStartContext option that is a bit confusing. &lt;camelContext id='myCamel' xmlns='http://camel.apache.org/schema/spring' autoStartup='false'&gt; &lt;route&gt; &lt;from uri='direct:start'/&gt; &lt;to uri='mock:result'/&gt; &lt;/route&gt; &lt;/camelContext&gt;For example the code above will not start Camel on startup. You can then later start camel manually by SpringCamelContext camel = (SpringCamelContext) ac.getBean('myCamel'); camel.start();And then all runs.This also means that we will remove the option shouldStartContext! so if you use this option you must migrate to the autoStartup instead.,0,0
Support Issue: Routing a TextMessage from a  to a JMS queue,I did not find any example or documentation for using the &lt;camel:proxy&gt; with a simple send(String textMessage) method and a route sending the textMessage String as body to a JMS queue (for example).The thing is that &lt;camel:proxy&gt; creates a messages with body of type BeanInvocation. I would expect that Camel provides some builtin transformer/converter to change the body to the String argument  so that the message on the queue is of type TextMessage.Did I miss something?,0,0
@Bean - Add method to the annotation so you can configure the method name,Its a bit more trivial for end users to know how to set bean name and method if having two attributes.Otherwise they have to know about you can use dot to separate the ben name for the method name.,0,0
camel-jms - Sending Object message should fail if payload cannot be converted to serializable,If not a null message is created and send.See nabble:http://old.nabble.com/JPA%3A-Could-not-pass-Object-from-jpa-to-jms-to26160124.html,0,0
The converter's MandatoryConvert method doesn't throw the exception when the value is null,,0,0
Some methods of SftpOperations create streams that are never closed,Where SftpOperations creates streams for storing or retrieving files via ChannelSftp  these streams are not always closed. For example  the retrieveFileToStreamInBody method creates an OutputStream object  but never closes it.,0,1
Type converter - Should respect Future ExecutionException as not failed to convert but some other error,,0,0
RSS Component - parameter filtering not working,I have tried to sort RRS feeds or to split the entries as described in the documentation. The problem is that the parameters that are to be consumed by Camel are passed through to the endpoint  who does not understand the parameters.Here is my code: from('rss:' + feedLocation+ '?sortEntries=true&amp;feedHeader=true').marshal().rss()...where feedLocation = 'http://www.iafrica.com/pls/cms/grapevine.xml'It results in:java.io.FileNotFoundException: http://www.iafrica.com/pls/cms/grapevine.xml?feedHeader=true&amp;sortEntries=true at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1311) at java.net.URL.openStream(URL.java:1010) at org.apache.camel.component.rss.RssUtils.createFeed(RssUtils.java:32) at org.apache.camel.component.rss.RssEntryPollingConsumer.createFeed(RssEntryPollingConsumer.java:54) at org.apache.camel.component.feed.FeedEntryPollingConsumer.poll(FeedEntryPollingConsumer.java:42) at org.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:99) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:317) at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:150) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:98) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:181) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:205) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:637),0,0
Workaround for UnsupportedEncodingException,Reference this discussion: http://old.nabble.com/Camel-Mail-issue-with-unsupported-charset-td24755585.htmlCamel-mail fails to process a message with an unsupported charset in the Content-Type. It throws an exception and can never get past that message...subsequent messages in the inbox never get processed.Claus and I came up with a fix  where we make a copy of the MimeMessage object and modify the Content-Type header  stripping the unrecognized charset.,0,0
FTP Component issue with tempPrefix or tempFileName,using FTP component to push files via FTP I am facing issues pushing a file on subfolder when using tempPrefix or tempFileName. route sample: from('direct:start').to('ftp://username@ipaddress?password=mypass&amp;fileName=./camel/test/message.txt&amp;tempFileName=${file:name.noext}.tmp');no errors are raised if the final destination file doesn't exists  if it exists following error is raised: Exception in thread 'main' org.apache.camel.CamelExecutionException: Exception occurred during execution on the exchange: Exchange&#91;Message: Message content&#93;  at org.apache.camel.util.ObjectHelper.wrapCamelExecutionException(ObjectHelper.java:1055)  at org.apache.camel.util.ExchangeHelper.extractResultBody(ExchangeHelper.java:446)  at org.apache.camel.impl.DefaultProducerTemplate.extractResultBody(DefaultProducerTemplate.java:431)  at org.apache.camel.impl.DefaultProducerTemplate.extractResultBody(DefaultProducerTemplate.java:427)  at org.apache.camel.impl.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:112)  at org.apache.camel.impl.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:117)  at com.opta.camel.test.FTPTester.main(FTPTester.java:30) Caused by: java.lang.NullPointerException  at org.apache.camel.component.file.remote.FtpOperations.existsFile(FtpOperations.java:372) at org.apache.camel.component.file.GenericFileProducer.processExchange(GenericFileProducer.java:92)  at org.apache.camel.component.file.remote.RemoteFileProducer.process(RemoteFileProducer.java:52)  at org.apache.camel.processor.SendProcessor$1.doInProducer(SendProcessor.java:86)  at org.apache.camel.processor.SendProcessor$1.doInProducer(SendProcessor.java:84)  at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:146)  at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:83)  at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67)  at org.apache.camel.processor.DelegateProcessor.processNext(DelegateProcessor.java:53)  at org.apache.camel.processor.DelegateProcessor.proceed(DelegateProcessor.java:82)  at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:85)  at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67)  at org.apache.camel.processor.RedeliveryErrorHandler.processExchange(RedeliveryErrorHandler.java:232)  at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:162)  at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:91)  at org.apache.camel.processor.DefaultErrorHandler.process(DefaultErrorHandler.java:49)  at org.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:201)  at org.apache.camel.processor.UnitOfWorkProcessor.processNext(UnitOfWorkProcessor.java:54)  at org.apache.camel.processor.DelegateProcessor.process(DelegateProcessor.java:48)  at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67)  at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:45)  at org.apache.camel.impl.ProducerCache$1.doInProducer(ProducerCache.java:179)  at org.apache.camel.impl.ProducerCache$1.doInProducer(ProducerCache.java:161)  at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:146)  at org.apache.camel.impl.ProducerCache.sendExchange(ProducerCache.java:160)  at org.apache.camel.impl.ProducerCache.send(ProducerCache.java:98)  at org.apache.camel.impl.DefaultProducerTemplate.send(DefaultProducerTemplate.java:97)  at org.apache.camel.impl.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:110)  ... 2 more,1,0
ActivityMonitorEngine uses ?1 parameters in JPAQL  which don't work with (at least) the hibernate JPA provider.,Trying to just replace my RouteBuilder with a ProcessBuilder to start moving towards using BAM. I converted everything over to JPA  to make bam happy  but then found that it still explodes  (Full stack trace below)Line 80 of ActivityMonitorEngine has this JPAQL  List&lt;ActivityState&gt; list = template.find('select x from ' + ActivityState.class.getName() + ' x where x.timeOverdue &lt; ?1'  timeNow);The ?1 named/numbered parameter seems to not be supported by hibernate's JPA provider.I can't find much of any documentation on this  could this just be made a normal positional? I can't even try out the BAM module without this 2009-11-11 01:33:53 815 ERROR &#91;org.apache.camel.bam.processor.ActivityMonitorEngine:ActivityMonitorEngine&#93; - &lt;Caught: org.springframework.dao.InvalidDataAccessApiUsageException: org.hibernate.QueryParameterException: could not locate named parameter &#91;1&#93;; nested exception is java.lang.IllegalArgumentException: org.hibernate.QueryParameterException: could not locate named parameter &#91;1&#93;&gt;org.springframework.dao.InvalidDataAccessApiUsageException: org.hibernate.QueryParameterException: could not locate named parameter &#91;1&#93;; nested exception is java.lang.IllegalArgumentException: org.hibernate.QueryParameterException: could not locate named parameter &#91;1&#93; at org.springframework.orm.jpa.EntityManagerFactoryUtils.convertJpaAccessExceptionIfPossible(EntityManagerFactoryUtils.java:271) at org.springframework.orm.jpa.vendor.HibernateJpaDialect.translateExceptionIfPossible(HibernateJpaDialect.java:97) at org.springframework.dao.support.DataAccessUtils.translateIfNecessary(DataAccessUtils.java:212) at org.springframework.orm.jpa.JpaAccessor.translateIfNecessary(JpaAccessor.java:152) at org.springframework.orm.jpa.JpaTemplate.execute(JpaTemplate.java:189) at org.springframework.orm.jpa.JpaTemplate.executeFind(JpaTemplate.java:151) at org.springframework.orm.jpa.JpaTemplate.find(JpaTemplate.java:311) at org.apache.camel.bam.processor.ActivityMonitorEngine$1.doInTransactionWithoutResult(ActivityMonitorEngine.java:80) at org.springframework.transaction.support.TransactionCallbackWithoutResult.doInTransaction(TransactionCallbackWithoutResult.java:33) at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:128) at org.apache.camel.bam.processor.ActivityMonitorEngine.run(ActivityMonitorEngine.java:77) at java.lang.Thread.run(Thread.java:619)Caused by: java.lang.IllegalArgumentException: org.hibernate.QueryParameterException: could not locate named parameter &#91;1&#93; at org.hibernate.ejb.QueryImpl.setParameter(QueryImpl.java:206) at org.hibernate.ejb.QueryImpl.setParameter(QueryImpl.java:261) at org.springframework.orm.jpa.JpaTemplate$9.doInJpa(JpaTemplate.java:316) at org.springframework.orm.jpa.JpaTemplate.execute(JpaTemplate.java:184) ... 7 moreCaused by: org.hibernate.QueryParameterException: could not locate named parameter &#91;1&#93; at org.hibernate.engine.query.ParameterMetadata.getNamedParameterDescriptor(ParameterMetadata.java:99) at org.hibernate.engine.query.ParameterMetadata.getNamedParameterExpectedType(ParameterMetadata.java:105) at org.hibernate.impl.AbstractQueryImpl.determineType(AbstractQueryImpl.java:437) at org.hibernate.impl.AbstractQueryImpl.setParameter(AbstractQueryImpl.java:407) at org.hibernate.ejb.QueryImpl.setParameter(QueryImpl.java:201) ... 10 moreLine 80,0,0
ftp uploads can fail: File operation failed:  Connection closed without indication.. Code: 421,Looks like something that was fixed for CAMEL-444 didn't make it into 2.0?On 2.0.0  this is not a warning  this is a fatal.SEVERE: Exception occured during execution on the exchange: Exchange&#91;Message: XXXXXX&#93;org.apache.camel.CamelExecutionException: Exception occured during execution on the exchange: Exchange&#91;Message: XXXXX&#93; at org.apache.camel.util.ObjectHelper.wrapCamelExecutionException(ObjectHelper.java:1027) at org.apache.camel.util.ExchangeHelper.extractResultBody(ExchangeHelper.java:479) at org.apache.camel.impl.DefaultProducerTemplate.extractResultBody(DefaultProducerTemplate.java:431) at org.apache.camel.impl.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:106) at org.apache.camel.impl.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:122) at org.apache.camel.impl.DefaultProducerTemplate.requestBody(DefaultProducerTemplate.java:266) at... into my code here...Caused by: org.apache.camel.component.file.GenericFileOperationFailedException: File operation failed: Connection closed without indication.. Code: 421 at org.apache.camel.component.file.remote.FtpOperations.disconnect(FtpOperations.java:167) at org.apache.camel.component.file.remote.RemoteFileProducer.disconnect(RemoteFileProducer.java:77) at org.apache.camel.component.file.remote.RemoteFileProducer.handleFailedWrite(RemoteFileProducer.java:66) at org.apache.camel.component.file.GenericFileProducer.processExchange(GenericFileProducer.java:104) at org.apache.camel.component.file.remote.RemoteFileProducer.process(RemoteFileProducer.java:52) at org.apache.camel.processor.SendProcessor$1.doInProducer(SendProcessor.java:81) at org.apache.camel.processor.SendProcessor$1.doInProducer(SendProcessor.java:79) at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:141) at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:78) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:61) at org.apache.camel.processor.RedeliveryErrorHandler.processExchange(RedeliveryErrorHandler.java:186) at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:155) at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:88) at org.apache.camel.processor.DefaultErrorHandler.process(DefaultErrorHandler.java:49) at org.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:148) at org.apache.camel.processor.Pipeline.process(Pipeline.java:74) at org.apache.camel.processor.UnitOfWorkProcessor.processNext(UnitOfWorkProcessor.java:54) at org.apache.camel.processor.DelegateProcessor.process(DelegateProcessor.java:48) at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:45) at org.apache.camel.impl.ProducerCache$1.doInProducer(ProducerCache.java:170) at org.apache.camel.impl.ProducerCache$1.doInProducer(ProducerCache.java:156) at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:141) at org.apache.camel.impl.ProducerCache.sendExchange(ProducerCache.java:155) at org.apache.camel.impl.ProducerCache.send(ProducerCache.java:111) at org.apache.camel.impl.DefaultProducerTemplate.send(DefaultProducerTemplate.java:101) at org.apache.camel.impl.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:105) ... 37 moreCaused by: org.apache.commons.net.ftp.FTPConnectionClosedException: Connection closed without indication. at org.apache.commons.net.ftp.FTP.__getReply(FTP.java:297)This is 'not what I want' and there doesn't seem to be any keep alive or other option on the ftp2 component.,0,0
Logger logs INFO level messages at DEBUG level,The Camel logger logs INFO level messages at the DEBUG level. CAMEL-1048 fixed the problem in one of two cases (logging without an exception)  but it is still broken for logging with an exception. Patch to fix this is attached.,0,0
UnitOfWorkProcessor - Should wrap more EIPs such as Aggregator  Splitter  RecipientList on their child routes,This ensures these exchanges have an UoW when they are routed  which allows for synchronization tasks to run on completion,0,0
Remove dependency on spring core in PatternBasedPackageScanFilter,The dependency scan is using Springs ANT path matcher but the java code is in camel-core.We should moved that code to camel-spring so camel does not have any dep on spring code at all. (except for JMX annotations  which you is optional to use at runtime),0,0
TryProcessor - Do not use local copy Exchange in doCatch,There is no need to use a local copy when processing in doCatch.See nabblehttp://old.nabble.com/To-Roman---About-TryProcessor-to26377903s22882.html,0,0
camel-cxf - Empty body causes http error 500 even for GET when using cxfbean,CxfSoapBinding has a bug that it mandates a body to exist. But when you send a GET then there is of course no body.The code below fixed this in the method getCxfInMessage // body can be empty in case of GET etc. InputStream body = message.getBody(InputStream.class); if (body != null) { answer.setContent(InputStream.class  body); } else if (message.getBody() != null) { // fallback and set the body as what it is answer.setContent(Object.class  body); }Willem Tam can you review if that is okay? Maybe the code can be more finer to check the HTTP method and in cases of GET etc. it allows no body.I will commit my fix to get the unit tests passing.,0,0
JcrProducer node creation throws javax.jcr.PathNotFoundException when using exchange ID as node name,To reproduce  use the camel-jcr component without specifying a node name in the message properties. JcrProducer will attempt to use the exchange ID as the node name  but in ServiceMix 4  this ID contains path separator characters  which results in a PathNotFound exception when the producer attempts to create the node. IMHO  the producer should attempt to create parent nodes as needed when the value of either the exchange ID or the property named JcrConstants.JCR_NODE_NAME contain path separators.,0,0
Improvment in example archtypes,Made changes to improve application context xml to improve schema usage. Also replaced log4j.properties fles with log4j.xml files.,0,0
RestletProducer should support native async request/response semantics,RestletProducer should support native async request/response semantics like the recent changes made to the camel-jetty producer.,0,0
camel-cxf - CxfProducer should check parameters more strictly to ensure we have the number of parameters required,The method getParams in CxfProducer does not check for correct number of parameters and that we have data when its mandatory.,0,0
RedeliveryPolicy - Setting delay > maxDelay should should also set max value,See nabblehttp://old.nabble.com/maximumRedeliveryDelay-applies-even-if-you-are-not-using-exponential-back-off-to26415728.html,0,0
When the 'from' endpoint is improperly set  it can be very hard to work out why/where,I have static routes configured using the java DSL  but use bean properties on my route builder to provide custom endpoints for different environments  like so... from(sourceUriProperty) .to('bean:fileParser') .beanRef('conanCore'  'updateOperationFailure') ;If you forget to set the from URI property  the exception you get at application startup just says: 'java.lang.IllegalArgumentException: Either 'uri' or 'ref' must be specified on: org.apache.camel.impl.DefaultRouteContext@d6a3d1' (Full stack trace below..... but probably not really important... note that it never once mentions any of my own classes)It would be nice if throw could be somewhere like in: RouteDefinition.java public List&lt;RouteContext&gt; addRoutes(CamelContext context  Collection&lt;Route&gt; routes) throws Exception { // other parts snipped... for (FromDefinition fromType : inputs) { // Throwing here would be nice  fromType.description already has 'no uri or ref!' so it already knows it's broken. RouteContext routeContext = addRoutes(routes  fromType); answer.add(routeContext); }}The RouteDefinition at that stage already contains things like: {{this = {org.apache.camel.model.RouteDefinition@5751}'Route[[From&#91;no uri or ref supplied!&#93;] -&gt; [To&#91;bean:fileParser&#93;  Bean&#91;ref:conanCore method: updateOperationFailure&#93;]]'}}So if we can explode there  you can clearly see what route you've screwed up.Caused by: org.apache.camel.RuntimeCamelException: java.lang.IllegalArgumentException: Either 'uri' or 'ref' must be specified on: org.apache.camel.impl.DefaultRouteContext@d6a3d1 at org.apache.camel.util.ObjectHelper.wrapRuntimeCamelException(ObjectHelper.java:1011) at org.apache.camel.spring.SpringCamelContext.onApplicationEvent(SpringCamelContext.java:121) at org.apache.camel.spring.CamelContextFactoryBean.onApplicationEvent(CamelContextFactoryBean.java:469) at org.springframework.context.event.SimpleApplicationEventMulticaster$1.run(SimpleApplicationEventMulticaster.java:78) at org.springframework.core.task.SyncTaskExecutor.execute(SyncTaskExecutor.java:49) at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:76) at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:274) at org.springframework.context.support.AbstractApplicationContext.finishRefresh(AbstractApplicationContext.java:736) at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:383) at org.springframework.test.context.support.AbstractGenericContextLoader.loadContext(AbstractGenericContextLoader.java:84) at org.springframework.test.context.support.AbstractGenericContextLoader.loadContext(AbstractGenericContextLoader.java:42) at org.springframework.test.context.TestContext.loadApplicationContext(TestContext.java:173) at org.springframework.test.context.TestContext.getApplicationContext(TestContext.java:197) ... 18 moreCaused by: java.lang.IllegalArgumentException: Either 'uri' or 'ref' must be specified on: org.apache.camel.impl.DefaultRouteContext@d6a3d1 at org.apache.camel.impl.DefaultRouteContext.resolveEndpoint(DefaultRouteContext.java:117) at org.apache.camel.model.FromDefinition.resolveEndpoint(FromDefinition.java:72) at org.apache.camel.impl.DefaultRouteContext.getEndpoint(DefaultRouteContext.java:74) at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:432) at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:126) at org.apache.camel.impl.DefaultCamelContext.startRoute(DefaultCamelContext.java:569) at org.apache.camel.impl.DefaultCamelContext.startRouteDefinitions(DefaultCamelContext.java:924) at org.apache.camel.impl.DefaultCamelContext.doStart(DefaultCamelContext.java:901) at org.apache.camel.spring.SpringCamelContext.maybeDoStart(SpringCamelContext.java:165) at org.apache.camel.spring.SpringCamelContext.doStart(SpringCamelContext.java:160) at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:52) at org.apache.camel.impl.DefaultCamelContext.start(DefaultCamelContext.java:816) at org.apache.camel.spring.SpringCamelContext.maybeStart(SpringCamelContext.java:99) at org.apache.camel.spring.SpringCamelContext.onApplicationEvent(SpringCamelContext.java:119) ... 29 more,0,0
CaseInsensitiveMap should be serializable,CaseInsensitiveMap should be fully serializableSee nabblehttp://old.nabble.com/DataSet-header-%7BCamelDataSetIndex%3D0%7D-causes-failure-to26487985.html,0,0
camel-jdbc - Allow properties to be set on Statement such as fetchSize  maxRows etc,Just like the SQL component offers a template. to set any property on the Spring JdbcTemplate we should do the same for this component for its Statement class.,0,0
camel-bean - Classes enhanced by CGLIB should skip cglib methods,See nabblehttp://old.nabble.com/AmbiguousMethodCallException-on-transactional-spring-bean-to26496269.html,0,0
Mock component - expectedBodiesReceived(List) does not work as expected,Java chooses the varargs methods always instead of the List method.,0,0
Exception during mail connection requires folder to be reset,I think that this problem may still be around with 2.1-SNAPSHOT:http://fusesource.com/forums/thread.jspa?threadID=746&amp;tstart=0I noticed that I had a pop3 server outage and then subsequently had a similar problem i.e. IllegalStateException  folder not open.Here's when the outage started.2009-11-26 11:57:55 316 [: MailComponent] WARN ultPollingConsumerPollStrategy - Consumer Consumer[pop3://...] could not poll endpoint: pop3://... caused by: Connect failedjavax.mail.MessagingException: Connect failed; nested exception is: java.net.NoRouteToHostException: No route to host at com.sun.mail.pop3.POP3Store.protocolConnect(POP3Store.java:161) at javax.mail.Service.connect(Service.java:288) at org.apache.camel.component.mail.MailConsumer.ensureIsConnected(MailConsumer.java:241) at org.apache.camel.component.mail.MailConsumer.poll(MailConsumer.java:79) at org.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:108) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:317) at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:150) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:98) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:181) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:205) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:619)Caused by: java.net.NoRouteToHostException: No route to host at java.net.PlainSocketImpl.socketConnect(Native Method) at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:333) at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:195) at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:182) at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366) at java.net.Socket.connect(Socket.java:519) at java.net.Socket.connect(Socket.java:469) at com.sun.mail.util.SocketFetcher.createSocket(SocketFetcher.java:233) at com.sun.mail.util.SocketFetcher.getSocket(SocketFetcher.java:189) at com.sun.mail.pop3.Protocol.&lt;init&gt;(Protocol.java:94) at com.sun.mail.pop3.POP3Store.getPort(POP3Store.java:214) at com.sun.mail.pop3.POP3Store.protocolConnect(POP3Store.java:157) ... 13 moreThis went on for about a minute or so and there was no more in the log file until several hours later - in fact when an email appeared in the INBOX. I know this because my personal email account was copied on the email and so I have the timestamp.I then get the following message every time I poll the server and have to re-start my application to get over it:2009-11-26 19:19:57 293 [: MailComponent] ERROR MailConsumer - Folder not openjava.lang.IllegalStateException: Folder not open at javax.mail.Folder.getMessages(Folder.java:938) at javax.mail.Folder.search(Folder.java:1226) at org.apache.camel.component.mail.MailConsumer.poll(MailConsumer.java:107) at org.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:108) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:317) at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:150) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:98) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:181) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:205) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:619)I took a look at MailConsumer.java and note the following code:236 if (!connected) {237 if (LOG.isDebugEnabled()) {238 LOG.debug('Connecting to MailStore: ' + endpoint.getConfiguration().getMailStoreLogInformation());239 }240 store = sender.getSession().getStore(config.getProtocol());241 store.connect(config.getHost()  config.getPort()  config.getUsername()  config.getPassword());242 }If you're not connected then how is it possible to have a folder? Following this logic my recommendation is to insert the following at line 242:241 store.connect(config.getHost()  config.getPort()  config.getUsername()  config.getPassword()); folder = null;242 },0,0
file producer - NIO transferTo 2gb bug in jdk,It appears that the JDK have a limitation that transferTo with large files.http://72.5.124.102/thread.jspa?threadID=5205184&amp;messageID=9822064See nabblehttp://old.nabble.com/camel-casts-exception-when-there-is-nothing-to-fetch-from-the-ftp-endpoint-to26541447.htmlThe code should be in a loop and transfer in chunks.,0,0
Improper ordering of MINA filters,When we want to use SSL on the consumer side  MINA's SSLFilter must be inserted as the very first filter into the chain (or  at least  as the second one after an ExecutorFilter)  but it is currently not possible  because MinaComponent#createSocketEndpoint() always inserts a ProtocolCodecFilter at the very beginning by calling configureCodecFactory().A proposed workaround is to introduce an additional URL parameter noDefaultCodec which prohibits the installation of the default protocol codec filter. The protocol codec must be then configured manually  e.g. using Spring:&lt;bean id='sslFilter' class='org.apache.mina.filter.SSLFilter'&gt; &lt;constructor-arg&gt; &lt;bean class='javax.net.ssl.SSLContext' factory-method='getDefault' /&gt; &lt;/constructor-arg&gt;&lt;/bean&gt;&lt;bean id='codecFilter' class='org.apache.mina.filter.codec.ProtocolCodecFilter'&gt; &lt;constructor-arg ref='hl7codec' /&gt;&lt;/bean&gt;&lt;bean id='hl7codec' class='org.apache.camel.component.hl7.HL7MLLPCodec' /&gt;&lt;bean id='minaFilters' class='java.util.ArrayList'&gt; &lt;constructor-arg&gt; &lt;list value-type='org.apache.mina.common.IoFilter'&gt; &lt;ref bean='sslFilter' /&gt;  &lt;ref bean='codecFilter' /&gt;  &lt;/list&gt; &lt;/constructor-arg&gt;&lt;/bean&gt;After that  the consumer endpoint URL can look likefrom('mina:tcp://0.0.0.0:8888?sync=true&amp;lazySessionCreation=true&amp;noDefaultCodec=true&amp;filters=#minaFilters').I am not sure whether this approach is optimal  therefore I call it 'workaround' and not 'solution'. The corresponding patch is attached.,0,0
Ridiculously long release time due to the javadoc plugin,,0,1
Routing slip does not stop when Exchange is failed,,0,0
camel-example-etl throw error when running it.,Here is the stack trace.[ Camel thread 0: JpaComponent] JuelExpression DEBUG Noimpl class for juel ExpressionFactory defined in'META-INF/services/org/apache/camel/component/el'org.apache.camel.NoFactoryAvailableException: Could not find factory classfor resource: META-INF/services/org/apache/camel/component/juel atorg.apache.camel.impl.DefaultFactoryFinder.doFindFactoryProperties(DefaultFactoryFinder.java:135) atorg.apache.camel.impl.DefaultFactoryFinder.findClass(DefaultFactoryFinder.java:77) atorg.apache.camel.language.juel.JuelExpression.getExpressionFactory(JuelExpression.java:81) atorg.apache.camel.language.juel.JuelExpression.evaluate(JuelExpression.java:70) atorg.apache.camel.builder.ProcessorBuilder$4.process(ProcessorBuilder.java:94) atorg.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67) atorg.apache.camel.processor.DelegateProcessor.processNext(DelegateProcessor.java:53) atorg.apache.camel.processor.DelegateProcessor.proceed(DelegateProcessor.java:82) atorg.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:93) atorg.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67) atorg.apache.camel.processor.RedeliveryErrorHandler.processExchange(RedeliveryErrorHandler.java:223) atorg.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:153) atorg.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:91) atorg.apache.camel.processor.DefaultErrorHandler.process(DefaultErrorHandler.java:49) atorg.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:206) at org.apache.camel.processor.Pipeline.process(Pipeline.java:74) atorg.apache.camel.processor.UnitOfWorkProcessor.processNext(UnitOfWorkProcessor.java:54) atorg.apache.camel.processor.DelegateProcessor.process(DelegateProcessor.java:48) atorg.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67) atorg.apache.camel.component.jpa.JpaConsumer.processBatch(JpaConsumer.java:133) atorg.apache.camel.component.jpa.JpaConsumer$1.doInJpa(JpaConsumer.java:86) atorg.apache.camel.component.jpa.JpaTemplateTransactionStrategy$1$1.doInJpa(JpaTemplateTransactionStrategy.java:81) atorg.springframework.orm.jpa.JpaTemplate.execute(JpaTemplate.java:184) atorg.springframework.orm.jpa.JpaTemplate.execute(JpaTemplate.java:147) atorg.apache.camel.component.jpa.JpaTemplateTransactionStrategy$1.doInTransaction(JpaTemplateTransactionStrategy.java:79) atorg.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:128) atorg.apache.camel.component.jpa.JpaTemplateTransactionStrategy.execute(JpaTemplateTransactionStrategy.java:77) atorg.apache.camel.component.jpa.JpaConsumer.poll(JpaConsumer.java:70) atorg.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:108) atjava.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) atjava.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:317) at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:150) atjava.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:98) atjava.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:181) atjava.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:205) atjava.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) atjava.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:619),0,0
doCatch() - Without any exception given should report that as a problem,Code like this .doTry() .to('mock:b') .throwException(new IllegalArgumentException('Damn')) .doCatch() .to('mock:catch') .end();Should report a failure in the route as doCatch must have at least 1 exception as parameter.It should correctly be .doCatch(Exception.class)We could also consider using Excpetion.class as default but in Java you must also provide the exception to catch and thus its more intuitive if its 100% like Java,0,0
seda component - Support no timeout for task to complete using timeout 0 or negative,See nabblehttp://old.nabble.com/SEDA-Timeout-ts26724664.html,0,0
RejectedExecutionException after restarting camel context,User reported over the #camel channel the following exception trying to send a message after the context was stopped and restarted 'Failed to create Producer for endpoint:'. Thats the exception I'm gettingReason: java.util.concurrent.RejectedExecutionExceptionException in thread 'core' org.apache.camel.FailedToCreateProducerException: Failed to create Producer for endpoint: Endpoint[activemq://queue:request.lavaOrderProducer.powerTraderServer]. Reason: java.util.concurrent.RejectedExecutionException at org.apache.camel.component.jms.JmsProducer.testAndSetRequestor(JmsProducer.java:116) at org.apache.camel.component.jms.JmsProducer.processInOut(JmsProducer.java:175) at org.apache.camel.component.jms.JmsProducer.process(JmsProducer.java:147) at org.apache.camel.impl.ProducerCache$1.doInProducer(ProducerCache.java:179) at org.apache.camel.impl.ProducerCache$1.doInProducer(ProducerCache.java:161) at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:146) at org.apache.camel.impl.ProducerCache.sendExchange(ProducerCache.java:160) at org.apache.camel.impl.ProducerCache.send(ProducerCache.java:98) at org.apache.camel.impl.DefaultProducerTemplate.send(DefaultProducerTemplate.java:97) at com.wjb.producer.lavaData.dispatcher.ServerRequestDispatcher.requestSymbolSectorArray(ServerRequestDispatcher.java:122) at com.wjb.producer.core.LavaDataManager.initialize(LavaDataManager.java:64) at com.wjb.producer.core.ProducerCore.run(ProducerCore.java:98) at java.lang.Thread.run(Thread.java:619)Caused by: java.util.concurrent.RejectedExecutionException at java.util.concurrent.ThreadPoolExecutor$AbortPolicy.rejectedExecution(ThreadPoolExecutor.java:1760) at java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:767) at java.util.concurrent.ScheduledThreadPoolExecutor.delayedExecute(ScheduledThreadPoolExecutor.java:216) at java.util.concurrent.ScheduledThreadPoolExecutor.schedule(ScheduledThreadPoolExecutor.java:366) at org.apache.camel.util.DefaultTimeoutMap.schedulePoll(DefaultTimeoutMap.java:156) at org.apache.camel.util.DefaultTimeoutMap.&lt;init&gt;(DefaultTimeoutMap.java:52) at org.apache.camel.component.jms.requestor.Requestor.&lt;init&gt;(Requestor.java:68) at org.apache.camel.component.jms.JmsProducer.testAndSetRequestor(JmsProducer.java:107)The following unit tests seems to reproduce the problem:ublic final class StartStopTest { private final GenericApplicationContext applicationContext = new GenericApplicationContext(); private final int testCount = 3; @Test public void test() throws Exception { //Initialize final File propertiesFile = new File(Constants.RESOURCE_DIRECTORY_NAME  Constants.PROPERTIES_FILE_NAME); PropertyConfigurator.configure(propertiesFile.getPath()); final File applicationContextFile = new File(Constants.RESOURCE_DIRECTORY_NAME  Constants.CONTEXT_FILE_NAME); final Resource applicationContextResource = new FileSystemResource(applicationContextFile); final AbstractBeanDefinitionReader beanDefinitionReader = new XmlBeanDefinitionReader(this.applicationContext); beanDefinitionReader.loadBeanDefinitions(applicationContextResource); this.applicationContext.refresh(); //Begin Testing for (int i = 0; i &lt; this.testCount; i++) { this.startSendStop(); Thread.sleep(3000); } } private void startSendStop() throws Exception { final SpringCamelContext springCamelContext = (SpringCamelContext)this.applicationContext.getBean(Constants.CAMEL_CONTEXT_NAME); final ProducerTemplate producerTemplate; final Endpoint serverRequestQueue; springCamelContext.start(); producerTemplate = springCamelContext.createProducerTemplate(); serverRequestQueue = springCamelContext.getEndpoint('serverRequestQueue'); final Exchange exchange = producerTemplate.send(serverRequestQueue  new Processor() { public void process(final Exchange exchange) throws Exception { exchange.setPattern(ExchangePattern.InOut); exchange.getIn().setHeader(ServerJmsServices.REQUEST  ServerJmsServices.GET_SYMBOL_INFO); exchange.getIn().setBody(''); } }); final String responseString = (String)exchange.getOut().getBody(); Assert.assertTrue(responseString.length() &gt; 0); springCamelContext.stop(); }}&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;beans xmlns='http://www.springframework.org/schema/beans'  xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:camel='http://camel.apache.org/schema/spring' xsi:schemaLocation='http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd'&gt; &lt;!-- ActiveMQ component for Camel to use --&gt; &lt;bean id='activemq' class='org.apache.activemq.camel.component.ActiveMQComponent' &gt; &lt;property name='connectionFactory'&gt; &lt;bean class='org.apache.activemq.ActiveMQConnectionFactory'&gt; &lt;property name='brokerURL' value='tcp://192.168.5.10:61616?daemon=true' /&gt; &lt;/bean&gt; &lt;/property&gt; &lt;/bean&gt; &lt;!-- Camel Context --&gt; &lt;camelContext id='camelContext' xmlns='http://camel.apache.org/schema/spring' autoStartup='false'&gt;  &lt;camel:endpoint id='serverRequestQueue' uri='activemq:queue:request.lavaOrderProducer.powerTraderServer' /&gt; &lt;/camelContext&gt;&lt;/beans&gt;,0,0
ExceptionHandler - Let it be able to log additional information such as a custom message or current exchange,This will output better exceptions in the logs when using the default exception handler which just logs it.The ExceptionHandler is used in consumers (polling  event driven) which cant send the exception back to a client and thus must handle it somehowand best shot is to log it  but you can plugin your own handler if you like,0,0
GroupedExchange in Aggregator is not working correctly,See nabblehttp://old.nabble.com/Help%21-org.apache.camel.impl.GroupedExchange-does-not-exist-in-the-latest-download-ts26841584.html,0,0
StrictHostKeyChecking Url Option,Camel users will appreciate a new url option that sets JSch Session StrictHostKeyChecking to 'no' . Preferably  this new option will work just like URI Options knownHosts. This improvement will facilitate bypass sftp/ssh key authentication.,0,0
UnitOfWork - Must be done in finally to ensure even when java.lang.Error is thrown fore reliable shutdown,This helps to keep in flight registry up-to-date even when java.lang.Error is thrown  such as when people use JUnit assertions.,0,0
camel-bindy dataformat KeyValue DSL can't work,When you set the bindy dataformat with below DSL   you will get the error that camel can't find the DataFormat.   public void configure() { from('direct:start').marshal() .bindy(BindyType.KeyValue  'org.apache.camel.dataformat.bindy.model.fix.simple') .to('mock:result'); },0,0
camel-cache - Missing some classes in .jar,See nabblehttp://old.nabble.com/Camel-Cache%3A-Processors-not-released--ts26908653.html,0,0
JDBC component doesn't preserve headers,JDBC component doesn't preserve any of the headers that are sent into it,0,0
The NP check of the remote service is wrong in CamelServiceExporter,We should check the export service instead of the camelContext.&#8212; components/camel-spring/src/main/java/org/apache/camel/spring/remoting/CamelServiceExporter.jav(revision 895109)+++ components/camel-spring/src/main/java/org/apache/camel/spring/remoting/CamelServiceExporter.jav(working copy)@@ -83 7 +83 7 @@ } Endpoint endpoint = CamelContextHelper.getMandatoryEndpoint(camelContext  uri); notNull(camelContext  'service');+ notNull(getService()  'service'); Object proxy = getProxyForService(); consumer = endpoint.createConsumer(new BeanProcessor(proxy  camelContext));,0,0
The  in Spring XML should support using serviceRef to lookup a reference for an endpoint,Even though people can use the ref component  but that is hardly technique.So you can do using serviceRef to refer to the endpoint &lt;!-- create a proxy that will route to the direct:start endpoint when invoked --&gt; &lt;proxy id='myProxySender' serviceInterface='org.apache.camel.spring.config.MyProxySender' serviceRef='cool'/&gt; &lt;!-- define the endpoint we want to proxy --&gt; &lt;endpoint id='cool' uri='direct:start'/&gt;,0,0
package will log WARN that you should use packageScan instead. We should keep both options so remove the WARN,&#91;2010-01-06 11:32:35.494&#93; server-dm-7 org.apache.camel.spring.CamelContextFactoryBean.unknown W Using a packages element to specify packages to search has been deprecated. Please use a packageScan element instead.,0,0
MailConsumer should log exception in processRollback,The MailConsumer logs in the rollback case the exchange (line 162 in revision 893983) but the exchange contains (usually ?) an exception which is not logged.In my case the exception is thrown from a custom Expression which splits a mail message.Only a rollback warning which contains the headers of the mail message is logged which makes finding the actual cause difficult.,0,0
EventNotifier - Make it easy to ignore unwanted event categories,The current EventNotifier is a bit sparse. It should have a bunch of ignoreXXX events to filter by category. In case you do not want certain types etc.Also it can be used to configure it to only report failures which is interesting if you want to alert that to a monitoring system.,0,0
camel-jdbc - Add option to select between JDBC 4 or 3 column label / name semantics,JDBC drivers is often a pain when it comes to compliance.If you use SQL SELECT with aliases then you may have issues with camel-jdbc as it retrieves the column name use ResultSetMetaData which behaves different according to the JDBC spec.See more at:http://fusesource.com/forums/thread.jspa?messageID=5623&amp;#5623Introduce a new option useJDBC4ColumnNameAndLabelSemantics where you can configure which option to use. Will by default use JDBC 4,0,0
Keep the lastModified timestamp when writing a file,&gt;&gt; I do the following:&gt;&gt;&gt; 'ftp://tata@.../ftp.input?&amp;recursive=true&amp;binary=true&amp;consumer.delay=1000')&gt; .to('file://M:/FTP.INPUT/');&gt;&gt; I would like to have my file in transfered and keeping their&gt; lastModifiedTime. I wonder if a flag is available for that ? Another&gt; solution would be to get it from the Message and do it programmatically.&gt;... &#91;show rest of quote&#93;HiGood idea. Notice that the timestamp from the FTP library is often not100% accurate down to the seconds.Could you create a ticket in JIRA for this feature request?http://issues.apache.org/activemq/browse/CAMEL,0,0
Remove sample caches from Camel Cache component,Camel Cache has sample caches created by the component via its ehCache settings.These should not be created in order to avoid unnecessary taking up of ports by the sample caches.,0,1
Bean Expression for Non Registry beans can't reference an instance,The documentation at the bottom of this page: http://camel.apache.org/bean-language.html says that I can use the bean expression DSL to work with beans that are not in the registry in two different ways (2.0-M2+). Specify Class/method and Camel will create a new instance of the bean and call the method. Specify instance/method and Camel will use the the specified instance and call the method.In fact  the doc shows examples of both:Method 1) from('activemq:topic:OrdersTopic'). filter().expression(bean(MyBean.class  'isGoldCustomer')). to('activemq:BigSpendersQueue');Method 2) private MyBean my; from('activemq:topic:OrdersTopic'). filter().expression(bean(my  'isGoldCustomer')). to('activemq:BigSpendersQueue');I am unable to do the latter (#2) as the methods are not defined. I'm using Camel 2.1.0 but I've tried 2.0.0 as well. So either the doc is wrong or the methods are missing/not visible. My code specifically is:private Object list;...from (getErrorEndpoint()) .recipientList(list  'getRecipients');Yes  there are easy ways to avoid this. But I prefer not to have to create more XML and/or specify a Class name here.Finally  is there a good reason '.recipientList()' isn't overloaded to take an Endpoint[] instead of only an Expression? The @RecipientList annotation seems to anticipate this form but there doesn't seem to be a good way to plug the @RecipientList annotated bean into the route definition. Even if the bean is in the registry it looks as if you still have to supply the method name anyway despite that its already annotated (unless you also annotate with @Handler which might be undesirable). Ideally  I could have...Object list = new Object() { @RecipientList public Collection&lt;Endpoint&gt; getRecipents(Object body) {... }}...from (endpoint).recipientList(&lt;any instance annotated with @RecipientList&gt;)or even// Look for method 'errors' then look for annotation @RecipientList('errors')from (endpoint).recipientList( bean  'errors' )Is this making any sense? (I'm still very wet behind the ears),0,0
Let ExpressionClause be reusable by other builders which are not route based,Allows you to use all the expressions from ExpressionClause which has many  on other builders which are not tied to the route models.For example at mock  notify builder and elsewhere,0,0
camel-bean - CGLIB proxied classed having trouble using annotated bean bindings,Header value (and body) is not bound in pojo method:Route definiton: camel:route trace='true' id='RapNotificationRoute'&gt; &lt;camel:from uri='oracleQueue:queue:FURTHERELEMENTS_TEST?jmsMessageType=Text'/&gt; &lt;camel:transacted ref='PROPAGATION_REQUIRED'/&gt; &lt;camel:wireTap uri='seda:audit'/&gt; &lt;camel:to uri='mock:result'/&gt; &lt;/camel:route&gt; &lt;camel:route id='AuditRoute'&gt; &lt;camel:from uri='seda:audit'/&gt; &lt;camel:bean ref='auditMessageDAO' method='audit'/&gt; &lt;/camel:route&gt;auditMessageDAO interface: public void audit(@Body String body  @Header(value='JMSMessageID' String jmsMessageId)Trace from log when running: &#91;Camel thread 0: seda://audit&#93; 20 jan. 2010 - 12:22:09 858 INFO org.apache.camel.processor.interceptor.Tracer[42a5443b-0a62-4477-885f-c6f6c40274b1 &gt;&gt;&gt; (AuditRoute) from(seda://audit) --&gt; ref:auditMessageDAO method: audit &lt;&lt;&lt; Pattern:InOnly  Headers:{JMSDestination=PLAYLISTE.FURTHERELEMENTS_TEST  JMS_OracleDelay=0  JMSDeliveryMode=2  JMSRedelivered=true  JMS_OracleTimestamp=1263986526156  JMSType=null  JMSCorrelationID=null  JMSXRecvTimestamp=1263986529858  JMSXState=0  JMSXDeliveryCount=2  JMSMessageID=ID:7D97CBE346B7CAA2E040650A0A103AC2  JMSTimestamp=1263986526156  JMSPriority=1  JMSXGroupID=null  JMS_OracleDeliveryMode=2  JMSXUserID=playliste  JMSExpiration=0  JMSReplyTo=null}  BodyType:byte[]  Body:&lt;?xml version='1.0' encoding='UTF-8' standalone='yes'?&gt;&lt;Publication&gt;hidden&lt;/Publication&gt;]The exchange gets send (Evenen when using Oracle AQ)  to the seda:audit endpoint and the auditMessageDAO gets called. Body is bound to correct payload but the header element JMSMessageID is null. If i change the parameter to include @Headers Map the parameter is still null.Current workaround is to use the Message  or Exchange as parameter  but then my pojo will have dependencies on Camel - ok for now.See thread : http://old.nabble.com/wiretap-getting-header-value-ts27238444.html for further details.,0,0
Remove some dependencies,While checking the dependencies of camel-cxf I found that some dependencies are at least not necessary to compile the project.I have attached a patch with the removed dependencies. The dependencies are:camel-springcxf-rt-transports-http-jetty,0,0
DefaultTypeConverterRegistry - Let it load upfront,This allows it to pre load all type converters on startup instead on demand. This also removes the need for synchronization at runtime as the converters are loaded up front.,0,1
file component - Using fileName option should better detect constant vs dynamic name,eg using fileName=header.txt makes Camel think its header with the name txt you want to use.,0,0
DefaultCamelContext starts route services out of order,org.apache.camel.impl.DefaultCamelContext uses HashMap to hold route servicesIn start() method it uses routeServices.values() to list route services.It does not work for Esper.Camel-extra Esper demo example for Esper  http://code.google.com/p/camel-extra/wiki/EsperDemo  creates 3 routes:1: Route[[From&#91;activemq:EventStreamQueue&#93;] -&gt; [To&#91;esper://feed&#93;]]2: Route[[From&#91;esper://feed?eql=insert into TicksPerSecond select feed  count(*) as cnt from com.iona.ps.demos.MarketDataEvent.win:time_batch(1 sec) group by feed&#93;] -&gt; [To&#91;esper://feed&#93;]]3: Route[[From&#91;esper://feed?eql=select feed  avg(cnt) from TicksPerSecond.win:time(10 sec) group by feed + having cnt &lt; avg(cnt) * 0.75&#93;] -&gt; [To&#91;esper://feed&#93;  process&#91;com.iona.ps.demos.MyRouteBuilder$1@1274069&#93;]]3-rd route depends on 2-nd route  it uses TicksPerSecond event type that gets created in route 2.DefaultCamelContext starts 3-rd route before 2-nd route  as a result Esper fails to resolve event type:com.espertech.esper.epl.expression.ExprValidationException: Failed to resolve event type: Event type or class named 'TicksPerSecond' was not found at com.espertech.esper.epl.spec.FilterStreamSpecRaw.resolveType(FilterStreamSpecRaw.java:189) at com.espertech.esper.epl.spec.FilterStreamSpecRaw.compile(FilterStreamSpecRaw.java:99) at com.espertech.esper.core.StatementLifecycleSvcImpl.compile(StatementLifecycleSvcImpl.java:956) at com.espertech.esper.core.StatementLifecycleSvcImpl.createStopped(StatementLifecycleSvcImpl.java:195) ... As a workaround  it is possible to change startup order by assigning custom ids to routes  so routeServices HashMap would return values in different order. Please  be advise that 3-rd route's From URI: 'esper://feed?eql=select feed  avg(cnt) from TicksPerSecond.win:time(10 sec) group by feed + having cnt &lt; avg(cnt) * 0.75' is modified original From URI from svn:'esper://feed?eql=select feed  avg(cnt) as avgCnt  cnt as feedCnt from TicksPerSecond.win:time(10 sec) group by feed + having cnt &lt; avg(avgCnt) * 0.75' It was done to resolve Esper compiling issue with avgCnt and feedCnt and has no impact on this reported Camel issue .,0,0
Mock component - expected header and property should output the name that fails,So you know the name of the header which failed. Currently it just say: Header of message bla bla,0,0
BeanProcessor - Should differentiate between void and method returning null values,When invoking a bean method it should better detect whether the bean is a void or has a return type.And if it returns null it should be regarded as a valid response and set as body.See nabblehttp://old.nabble.com/filtering-messages-ts27403559.html,0,0
cxfbean should  propagate CONTENT_TYPE for other camel component to use,There is no 'content-type' header return from the below route &lt;route&gt; &lt;from uri='jetty:http://localhost:9006/employeesBase?matchOnUriPrefix=true'/&gt; &lt;to uri='cxfbean:EmployeesPOJO'/&gt; &lt;/route&gt;,0,0
HttpHeaderFilterStrategy dosn't filters out 'Cache-Control'  'Connection'  'Pragma'  'Trailer'  'Transfer-Encoding'  'Upgrade'  'Via' and 'Warning' in method applyFilterToCamelHeaders,HttpHeaderFilterStrategy uses the HTTP headers with upper case characters on the beginning (e. g. 'Transfer-Encoding' instead of 'transfer-encoding').,0,0
WARNING log of JmsTemporaryTopicEndpoint   JmsTemporaryQueueEndpoint don't have the ManagedResource annotation,Here is the mail thread which discusses about this issue.http://old.nabble.com/Attemp-to-send-message-to-activemq-temporary-queue-using-producerTemplate%3A-InvalidMetadataException-tp27520096p27520096.html,0,0
HttpHeaderFilterStrategy should filter the HTTP 'Date' header when applyFilterToCamelHeaders is called,See rfc2616.,0,0
seda endpoint - Let it be easily to configure size option to use an unbounded queue,Instead of having 1000 as the default size we should let it be unbounded by default and let people set a size if they really want that,0,0
Camel Velocity: change the case of all fields properties Header,Using the velocity component doesn't respect the case matching of all fields of the header.For example: the exchange of properties CorrelationID change the case matching  after using velocity component  it puts the property in lowercase correlationid.,0,0
Camel Freemarker: change the case of all fields properties Header,Using the Freemarker component doesn't respect the case matching of all fields of the header.For example: the exchange of properties CorrelationID change the case matching  after using Freemarker component  it puts the property in lowercase correlationid.,0,0
NotifyBuilder - add reset method,Add a reset() method,0,0
DefaultCamelContext throws NPE in start() for route with no destination,Not easy to track down when you have a lot of routes. This might be new with the introduction of StartupRouteHolder (I think that was introduced in 2.1  right?)public class TriggerNPETest extends CamelTestSupport { @Override protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { public void configure() { // This will generate an NPE on DefaultCamelContext.start() (line 973) // If this is an invalid route a proper message should be given far before  // this and/or NPE should be tested on line 973 from('direct:psd.nowhere'); } }; } @Test public void testme() throws Exception { Thread.sleep(10000); }}java.lang.NullPointerException at org.apache.camel.impl.DefaultCamelContext.start(DefaultCamelContext.java:973) at org.apache.camel.test.junit4.CamelTestSupport.startCamelContext(CamelTestSupport.java:145) at org.apache.camel.test.junit4.CamelTestSupport.setUp(CamelTestSupport.java:98) // now start the inputs for all the route services as we have prepared Camel // yeah open the floods so messages can start flow into Camel for (Map.Entry&lt;Integer  StartupRouteHolder&gt; entry : inputs.entrySet()) { Integer order = entry.getKey(); Route route = entry.getValue().getRoute(); // &lt;&lt;&lt;------- Right here.,0,0
PollingConsumerPollStrategy - Should support boolean on begin to support skipping polling,See nabblehttp://old.nabble.com/File-Consumer-with-dynamic-list-of-files-to-poll-ts27683938.htmlAnd wiki pagehttp://camel.apache.org/polling-consumer.html,0,0
karaf features.xml  should use servicemix commons-pool bundle,as commons-pool/commons-pool/1.5.4 osgi manifest header isn't correct  which shouldn't import org.apache.commons.pool package.SMX4-491&#91;1&#93; create servicemix wrapper bundle to fix this issue  so the karaf features.xml should use servicemix wrapper bundle&#91;1&#93;https://issues.apache.org/activemq/browse/SMX4-491,0,0
SedaConsumer - Add check to limit the concurrentConsumer to < 1000 to prevent mistypes,If you enter concurrentConsumers=99999999 then Camel creates a lot of threads for concurrent consumers on the SEDA queue.We should validate the size is a reasonable value  at least &lt; 1000. Maybe limit to &lt; 500,0,1
should use servicemix jaxws 2.1 spec bundle but not the geronimo one,otherwise will see the exception like javax.xml.ws.spi.FactoryFinder$ConfigurationError: Provider org.apache.axis2.jaxws.spi.Provider not foundat javax.xml.ws.spi.FactoryFinder$2.run(FactoryFinder.java:135)at javax.xml.ws.spi.FactoryFinder.doPrivileged(FactoryFinder.java:264)at javax.xml.ws.spi.FactoryFinder.newInstance(FactoryFinder.java:122)at javax.xml.ws.spi.FactoryFinder.access$200(FactoryFinder.java:42)at javax.xml.ws.spi.FactoryFinder$3.run(FactoryFinder.java:255)at javax.xml.ws.spi.FactoryFinder.doPrivileged(FactoryFinder.java:264)at javax.xml.ws.spi.FactoryFinder.find(FactoryFinder.java:165)at javax.xml.ws.spi.Provider.provider(Provider.java:39)at javax.xml.ws.Service.&lt;init&gt;(Service.java:36),0,0
ConsumerTemplate don't support the jms uri with selector,This unit test can shows the issue that selector option don't work for ConsumerTemplate@Test public void testConsumerTemplate() throws Exception { template.sendBodyAndHeader('activemq:queue:consumer'  'Message1'  'SIZE_NUMBER'  1505); template.sendBodyAndHeader('activemq:queue:consumer'  'Message3'  'SIZE_NUMBER'  1300); template.sendBodyAndHeader('activemq:queue:consumer'  'Message2'  'SIZE_NUMBER'  1600); // process every exchange which is ready. If no exchange is left break // the loop while (true) { Exchange ex = consumer.receiveNoWait('activemq:queue:consumer?selector=SIZE_NUMBER&lt;1500'); if (ex != null) { Message message = ex.getIn(); int size = message.getHeader('SIZE_NUMBER'  int.class); assertTrue('The message header SIZE_NUMBER should be less than 1500'  size &lt; 1500); assertEquals('The message body is wrong'  'Message3'  message.getBody()); } else { break; } } }And here is mail thread which discusses about it.,0,0
Batch Resequencer issues with JMSPriority,My project uses ActiveMQ and we have a requirement to support priority queues for one or more of our configured queues. One of the suggestions under the ActiveMQ FAQ is to use a Resequencer  so I followed the link and applied the &lt;resequence&gt; element to my XML-based route. While testing this functionality we uncovered a couple issues that seem like they should be addressed in a future release of camel-core. The JMSPriority header is not a unique field and internally the Resequencer class uses java.util.Set to collect messages into a batch. This means that a given batch cannot contain multiple messages with the same JMSPriority. For example  if I use the default batch config and submit five messages with JMSPriority=6 to the queue within a second  only one of those message is delivered to the configured endpoint. According to the JMS API  priority has ten values where 0 is the lowest and 9 is the highest. This means that messages with higher priorities should be processed before messages with lower priorities. When I configure my resequencer with &lt;header&gt;JMSPriority&lt;/header&gt;  however  it by default orders the messages within the batch in ascending order which means that messages with lower priorities are processed first.If there are any known workarounds to these issues please document them  because the current Resequencer documentation that uses JMSPriority as an example is misleading.,0,0
async route not working with Mina,here is my route: from('mina:tcp://localhost:6202?textline=true&amp;sync=true').process(new Processor() { public void process(Exchange exchange) throws Exception { String body = exchange.getIn().getBody(String.class); Thread.sleep(5000); exchange.getOut().setBody('Bye 1' + body); } }); from('file:///test/test/response') .convertBodyTo(String.class)//.threads(1) .toAsync('mina:tcp://localhost:6202?sync=true&amp;textline=true' 10) .to('log:+++ reply++++'); here is the output  you can see all reply logs have a same message body and async process is releasing all threads at the first response  this is probably Mina component bug in the context of aync route.2010-03-11 10:21:16 405 &#91;Camel thread 11: FileComponent&#93; FileConsumer DEBUG Total 3 files to consume2010-03-11 10:21:16 405 &#91;Camel thread 11: FileComponent&#93; FileConsumer DEBUG About to process file: GenericFile&#91;C:/test/test/response/Copy (2) of New Text Document (3).txt&#93; using exchange: Exchange[GenericFileMessage with file: GenericFile&#91;C:/test/test/response/Copy (2) of New Text Document (3).txt&#93;]2010-03-11 10:21:16 452 &#91;Camel thread 11: FileComponent&#93; DefaultManagementAgent DEBUG Registered MBean with objectname: org.apache.camel:context=tamlft0spj1/cameltest type=producers name=MinaProducer(0x2e6c66)2010-03-11 10:21:16 452 &#91;Camel thread 11: FileComponent&#93; MinaProducer DEBUG Starting producer: Producer&#91;mina://tcp://localhost:6202?sync=true&amp;textline=true&#93;2010-03-11 10:21:16 452 &#91;Camel thread 11: FileComponent&#93; ProducerCache DEBUG Adding to producer service pool with key: Endpoint&#91;mina://tcp://localhost:6202?sync=true&amp;textline=true&#93; for producer: Producer&#91;mina://tcp://localhost:6202?sync=true&amp;textline=true&#93;2010-03-11 10:21:16 452 &#91;2: SendAsyncProcessor-Producer&#93; MinaProducer DEBUG Creating connector to address: localhost/127.0.0.1:6202 using connector: org.apache.mina.transport.socket.nio.SocketConnector@16cefa8 timeout: 30000 millis.2010-03-11 10:21:16 452 &#91;Camel thread 11: FileComponent&#93; FileConsumer DEBUG About to process file: GenericFile&#91;C:/test/test/response/Copy of New Text Document (3).txt&#93; using exchange: Exchange[GenericFileMessage with file: GenericFile&#91;C:/test/test/response/Copy of New Text Document (3).txt&#93;]2010-03-11 10:21:16 467 &#91;3: SendAsyncProcessor-Producer&#93; MinaProducer DEBUG Creating connector to address: localhost/127.0.0.1:6202 using connector: org.apache.mina.transport.socket.nio.SocketConnector@16cefa8 timeout: 30000 millis.2010-03-11 10:21:16 467 &#91;Camel thread 11: FileComponent&#93; FileConsumer DEBUG About to process file: GenericFile&#91;C:/test/test/response/New Text Document (3).txt&#93; using exchange: Exchange[GenericFileMessage with file: GenericFile&#91;C:/test/test/response/New Text Document (3).txt&#93;]2010-03-11 10:21:16 467 &#91;4: SendAsyncProcessor-Producer&#93; MinaProducer DEBUG Creating connector to address: localhost/127.0.0.1:6202 using connector: org.apache.mina.transport.socket.nio.SocketConnector@16cefa8 timeout: 30000 millis.2010-03-11 10:21:16 499 &#91;SocketConnectorIoProcessor-0.1&#93; ExecutorFilter DEBUG Launching thread for localhost/127.0.0.1:62022010-03-11 10:21:16 499 [ SocketAcceptorIoProcessor-0.0] ExecutorFilter DEBUG Launching thread for /127.0.0.1:33622010-03-11 10:21:16 499 [ SocketAcceptorIoProcessor-0.1] ExecutorFilter DEBUG Launching thread for /127.0.0.1:33632010-03-11 10:21:16 499 &#91;SocketConnectorIoProcessor-0.0&#93; ExecutorFilter DEBUG Launching thread for localhost/127.0.0.1:62022010-03-11 10:21:16 499 [ SocketAcceptorIoProcessor-0.2] ExecutorFilter DEBUG Launching thread for /127.0.0.1:33742010-03-11 10:21:16 499 &#91;SocketConnectorIoProcessor-0.2&#93; ExecutorFilter DEBUG Launching thread for localhost/127.0.0.1:62022010-03-11 10:21:16 514 &#91;amel thread 22: MinaThreadPool&#93; ExecutorFilter DEBUG Exiting since queue is empty for /127.0.0.1:33632010-03-11 10:21:16 514 &#91;amel thread 24: MinaThreadPool&#93; ExecutorFilter DEBUG Exiting since queue is empty for /127.0.0.1:33622010-03-11 10:21:16 514 &#91;amel thread 23: MinaThreadPool&#93; ExecutorFilter DEBUG Exiting since queue is empty for localhost/127.0.0.1:62022010-03-11 10:21:16 514 &#91;2: SendAsyncProcessor-Producer&#93; MinaProducer DEBUG Writing body : hello22010-03-11 10:21:16 514 &#91;3: SendAsyncProcessor-Producer&#93; MinaProducer DEBUG Writing body : hello32010-03-11 10:21:16 514 &#91;amel thread 26: MinaThreadPool&#93; ExecutorFilter DEBUG Exiting since queue is empty for /127.0.0.1:33742010-03-11 10:21:16 514 &#91;amel thread 25: MinaThreadPool&#93; ExecutorFilter DEBUG Exiting since queue is empty for localhost/127.0.0.1:62022010-03-11 10:21:16 514 &#91;amel thread 27: MinaThreadPool&#93; ExecutorFilter DEBUG Exiting since queue is empty for localhost/127.0.0.1:62022010-03-11 10:21:16 514 &#91;4: SendAsyncProcessor-Producer&#93; MinaProducer DEBUG Writing body : hello12010-03-11 10:21:16 514 &#91;SocketConnectorIoProcessor-0.2&#93; ExecutorFilter DEBUG Launching thread for localhost/127.0.0.1:62022010-03-11 10:21:16 514 &#91;3: SendAsyncProcessor-Producer&#93; MinaProducer DEBUG Waiting for response2010-03-11 10:21:16 530 &#91;2: SendAsyncProcessor-Producer&#93; MinaProducer DEBUG Waiting for response2010-03-11 10:21:16 530 &#91;4: SendAsyncProcessor-Producer&#93; MinaProducer DEBUG Waiting for response2010-03-11 10:21:16 530 [ SocketAcceptorIoProcessor-0.2] ExecutorFilter DEBUG Launching thread for /127.0.0.1:33742010-03-11 10:21:16 530 &#91;amel thread 27: MinaThreadPool&#93; ExecutorFilter DEBUG Exiting since queue is empty for localhost/127.0.0.1:62022010-03-11 10:21:16 530 &#91;amel thread 26: MinaThreadPool&#93; MinaConsumer DEBUG Received body: hello22010-03-11 10:21:21 530 &#91;amel thread 26: MinaThreadPool&#93; MinaConsumer DEBUG Writing body: Bye 1hello22010-03-11 10:21:21 530 &#91;SocketConnectorIoProcessor-0.2&#93; ExecutorFilter DEBUG Launching thread for localhost/127.0.0.1:62022010-03-11 10:21:21 530 &#91;amel thread 27: MinaThreadPool&#93; MinaProducer DEBUG Message received: Bye 1hello22010-03-11 10:21:21 530 &#91;amel thread 27: MinaThreadPool&#93; ExecutorFilter DEBUG Exiting since queue is empty for localhost/127.0.0.1:62022010-03-11 10:21:21 530 &#91;amel thread 26: MinaThreadPool&#93; MinaConsumer DEBUG Received body: hello32010-03-11 10:21:21 530 &#91;:6202?sync=true&amp;textline=true&#93;] SendProcessor DEBUG Async reply received now routing the Exchange: Exchange&#91;Message: Bye 1hello2&#93;2010-03-11 10:21:21 530 &#91;:6202?sync=true&amp;textline=true&#93;] SendProcessor DEBUG Async reply received now routing the Exchange: Exchange&#91;Message: Bye 1hello2&#93;2010-03-11 10:21:21 530 &#91;:6202?sync=true&amp;textline=true&#93;] SendProcessor DEBUG Async reply received now routing the Exchange: Exchange&#91;Message: Bye 1hello2&#93;2010-03-11 10:21:21 546 &#91;:6202?sync=true&amp;textline=true&#93;] DefaultManagementAgent DEBUG Registered MBean with objectname: org.apache.camel:context=tamlft0spj1/cameltest type=producers name=Producer(0x16321e6)2010-03-11 10:21:21 546 &#91;:6202?sync=true&amp;textline=true&#93;] ProcessorEndpoint$1 DEBUG Starting producer: Producer&#91;log://+++ reply++++&#93;2010-03-11 10:21:21 546 &#91;:6202?sync=true&amp;textline=true&#93;] ProducerCache DEBUG Adding to producer cache with key: Endpoint&#91;log://+++ reply++++&#93; for producer: Producer&#91;log://+++ reply++++&#93;2010-03-11 10:21:21 546 &#91;:6202?sync=true&amp;textline=true&#93;] +++ reply++++ INFO Exchange&#91;BodyType:String  Body:Bye 1hello2&#93;2010-03-11 10:21:21 546 &#91;:6202?sync=true&amp;textline=true&#93;] GenericFileOnCompletion DEBUG Done processing file: GenericFile&#91;C:/test/test/response/Copy (2) of New Text Document (3).txt&#93; using exchange: Exchange&#91;Message: Bye 1hello2&#93;2010-03-11 10:21:21 546 &#91;:6202?sync=true&amp;textline=true&#93;] +++ reply++++ INFO Exchange&#91;BodyType:String  Body:Bye 1hello2&#93;2010-03-11 10:21:21 546 &#91;:6202?sync=true&amp;textline=true&#93;] GenericFileOnCompletion DEBUG Done processing file: GenericFile&#91;C:/test/test/response/Copy of New Text Document (3).txt&#93; using exchange: Exchange&#91;Message: Bye 1hello2&#93;2010-03-11 10:21:21 546 &#91;:6202?sync=true&amp;textline=true&#93;] FileUtil DEBUG Tried 1 to delete file: C:/test/test/response/Copy (2) of New Text Document (3).txt.camelLock with result: true2010-03-11 10:21:21 561 &#91;:6202?sync=true&amp;textline=true&#93;] +++ reply++++ INFO Exchange&#91;BodyType:String  Body:Bye 1hello2&#93;2010-03-11 10:21:21 561 &#91;:6202?sync=true&amp;textline=true&#93;] GenericFileOnCompletion DEBUG Done processing file: GenericFile&#91;C:/test/test/response/New Text Document (3).txt&#93; using exchange: Exchange&#91;Message: Bye 1hello2&#93;2010-03-11 10:21:21 561 &#91;:6202?sync=true&amp;textline=true&#93;] FileUtil DEBUG Tried 1 to delete file: C:/test/test/response/Copy of New Text Document (3).txt.camelLock with result: true2010-03-11 10:21:21 561 &#91;:6202?sync=true&amp;textline=true&#93;] nericFileRenameProcessStrategy DEBUG Renaming file: GenericFile&#91;C:/test/test/response/Copy (2) of New Text Document (3).txt&#93; to: GenericFile&#91;C:/test/test/response/.camel/Copy (2) of New Text Document (3).txt&#93;2010-03-11 10:21:21 561 &#91;:6202?sync=true&amp;textline=true&#93;] FileUtil DEBUG Tried 1 to delete file: C:/test/test/response/New Text Document (3).txt.camelLock with result: true2010-03-11 10:21:21 561 &#91;:6202?sync=true&amp;textline=true&#93;] nericFileRenameProcessStrategy DEBUG Renaming file: GenericFile&#91;C:/test/test/response/Copy of New Text Document (3).txt&#93; to: GenericFile&#91;C:/test/test/response/.camel/Copy of New Text Document (3).txt&#93;2010-03-11 10:21:21 561 &#91;:6202?sync=true&amp;textline=true&#93;] nericFileRenameProcessStrategy DEBUG Renaming file: GenericFile&#91;C:/test/test/response/New Text Document (3).txt&#93; to: GenericFile&#91;C:/test/test/response/.camel/New Text Document (3).txt&#93;2010-03-11 10:21:21 561 &#91;:6202?sync=true&amp;textline=true&#93;] FileUtil DEBUG Tried 1 to rename file: C:/test/test/response/Copy (2) of New Text Document (3).txt to: C:/test/test/response/.camel/Copy (2) of New Text Document (3).txt with result: true2010-03-11 10:21:21 561 &#91;:6202?sync=true&amp;textline=true&#93;] FileUtil DEBUG Tried 1 to rename file: C:/test/test/response/Copy of New Text Document (3).txt to: C:/test/test/response/.camel/Copy of New Text Document (3).txt with result: true2010-03-11 10:21:21 577 &#91;:6202?sync=true&amp;textline=true&#93;] FileUtil DEBUG Tried 1 to rename file: C:/test/test/response/New Text Document (3).txt to: C:/test/test/response/.camel/New Text Document (3).txt with result: true2010-03-11 10:21:26 530 &#91;amel thread 26: MinaThreadPool&#93; MinaConsumer DEBUG Writing body: Bye 1hello32010-03-11 10:21:26 530 &#91;amel thread 26: MinaThreadPool&#93; MinaConsumer DEBUG Received body: hello12010-03-11 10:21:26 530 &#91;SocketConnectorIoProcessor-0.2&#93; ExecutorFilter DEBUG Launching thread for localhost/127.0.0.1:62022010-03-11 10:21:26 530 &#91;amel thread 27: MinaThreadPool&#93; MinaProducer DEBUG Message received: Bye 1hello32010-03-11 10:21:26 530 &#91;amel thread 27: MinaThreadPool&#93; ExecutorFilter DEBUG Exiting since queue is empty for localhost/127.0.0.1:62022010-03-11 10:21:31 531 &#91;amel thread 26: MinaThreadPool&#93; MinaConsumer DEBUG Writing body: Bye 1hello12010-03-11 10:21:31 531 &#91;SocketConnectorIoProcessor-0.2&#93; ExecutorFilter DEBUG Launching thread for localhost/127.0.0.1:62022010-03-11 10:21:31 531 &#91;amel thread 26: MinaThreadPool&#93; ExecutorFilter DEBUG Exiting since queue is empty for /127.0.0.1:33742010-03-11 10:21:31 531 &#91;amel thread 27: MinaThreadPool&#93; MinaProducer DEBUG Message received: Bye 1hello12010-03-11 10:21:31 531 &#91;amel thread 27: MinaThreadPool&#93; ExecutorFilter DEBUG Exiting since queue is empty for localhost/127.0.0.1:6202,0,0
IndexOutOfBoundsException occur in UnsafeUriCharactersEncoder.class,Here is the mail thread for the detail discussion.,0,0
camel-http component should set Transfer-Encoding as chunked header for response message when checkChunked is true,so that the client side which send request will know this is a chunked message.It's important when the response http headers is more than 4096 and we want to use chunked response message,0,0
Allow recipientList to be used inside a CBR using Java DSL,RecipientList is now offering fluent builders for parallel support.We should allow it to work in CBR with having end() being able to return the Type it came from  eg ChoiceDefinition.See nabblehttp://old.nabble.com/RecipientList-%2B-Choice-no-longer-work-together-in-Camel-2.2.0--ts27983922.html,0,0
CXFRS Routing in 2.2.0 does not behave like in 2.0.0,CXFRS Routing in Camel 2.0.0 works well with these endPoints:&lt;cxf:rsServer id='restRouter' address='/restRouter/'  serviceClass='com.project.service.impl.ServiceManagerImpl' /&gt; &lt;cxf:rsClient id='restEndpoint' address='http://localhost:8080/services/rest' serviceClass='com.project.service.impl.ServiceManagerImpl' /&gt;In Camel 2.2.0  Routing fails with error causing the CXF Client to invoke a 404 not found Rest Service which is 'http://localhost:8080/services/rest/restRouter/Path'.The address of cxf:rsClient is being appended by the cxf:rsServer's address,0,0
Graceful shutdown - Add option to shutdown routes in reverse order as they were started,As its more intuitive this way.And it should be the new default in 2.3 onwards. The old behavior can be enabled by turning off the shutdownRoutesInReverseOrder option.,0,0
support get operation for cache,Please support get operation on cache component.here is the discussion.http://old.nabble.com/read-from-cache-component-ts28071593.html,0,0
Make use of testing mocks of the the GAE SDK,Replace existing GAE service mocks with those coming with the GAE SDK.,0,0
Invocation of hasNext() on org.apache.camel.util.ObjectHelper.createIterator(...).new Iterator() {...} return different results,public boolean hasNext() { // empty string should not be regarded as having next return ++idx == 0 &amp;&amp; ObjectHelper.isNotEmpty(s); } public String next() { return s; }This is incorrect. Should be: public boolean hasNext() { // empty string should not be regarded as having next return idx+1 == 0 &amp;&amp; ObjectHelper.isNotEmpty(s); } public String next() { idx++; return s; },0,0
Aggregator - Completion by batch consumer should trigger completion for the batch group if multiple correlation keys was used,Yeah its really an odd use case if you use multiple correlation keys for the same batch consumer  but its still possible to do.,0,0
IOException: Bad file descriptor and FileNotFoundException,When I try to stream BINARY (pdf) file using camel-http I get the java.io.IOException: Bad file descriptorThe pdf isn't recieved succesfully by reciever (0kb)This seems to be caused by a bug in java (on linux systems)  closing inputstream twice causes problems. It seemed to me this is exactly what is happening  see also link:http://256.com/gray/docs/misc/java_bad_file_descriptor_close_bug.shtmlI fixed this by (checking out apache camel-core and camel-http 2.2.0):In FileInputStreamCache.java:In method close() wrapped getInputStream().close() in if:if (stream != null &amp;&amp; stream instanceof FileInputStream &amp;&amp; ((FileInputStream) stream).getChannel().isOpen()) {getInputStream().close() ;}In method reset() also:if (stream != null &amp;&amp; stream instanceof FileInputStream &amp;&amp; ((FileInputStream) stream).getChannel().isOpen()) {getInputStream().close() ;}Second I needed to fix a filenotfoundexception  the tempfile created by camel was deleted to early.I changed CachedOutputStream.java Reimplemented constructor:public CachedOutputStream(Exchange exchange) { String hold = exchange.getContext().getProperties().get(THRESHOLD); String dir = exchange.getContext().getProperties().get(TEMP_DIR); if (hold != null) { this.threshold = exchange.getContext().getTypeConverter().convertTo(Long.class  hold); } if (dir != null) { this.outputDir = exchange.getContext().getTypeConverter().convertTo(File.class  dir); } // add on completion so we can cleanup after the exchange is done such // as deleting temporary files exchange.addOnCompletion(new SynchronizationAdapter() { @Override public void onDone(Exchange exchange) { try { // close the stream and FileInputStreamCache // close(); // for (FileInputStreamCache cache : fileInputStreamCaches) // { // cache.close(); // } // cleanup temporary file if (tempFile != null) { System.err.println('####################################################'); System.err.println('DISABLED tempFile.delete:89'); System.err.println('####################################################'); // boolean deleted = tempFile.delete(); // if (!deleted) { // LOG.warn('Cannot delete temporary cache file: ' + // tempFile); // } else if (LOG.isTraceEnabled()) { // LOG.trace('Deleted temporary cache file: ' + // tempFile); // } tempFile = null; } } catch (Exception e) { LOG.warn('Error deleting temporary cache file: ' + tempFile  e); } } @Override public String toString() { return 'OnCompletion[CachedOutputStream]'; } }); }Reimplemented close():public void close() throws IOException { System.err.println('####################################################'); System.err.println('outputStream.close:119 -&gt; delete tempFile'); System.err.println('####################################################'); new Exception().printStackTrace(); currentStream.close(); boolean deleted = tempFile.delete(); if (!deleted) { LOG.warn('Cannot delete temporary cache file: ' + tempFile); } else if (LOG.isTraceEnabled()) { LOG.trace('Deleted temporary cache file: ' + tempFile); } },0,0
Inconsistency between IntrospectionSupport.getProperties() and IntrospectionSupport.getProperty(),IntrospectionSupport.getProperties() and IntrospectionSupport.getProperty() work in an inconsistency way:ExampleBean bean = new ExampleBean();Date date = new Date(0);bean.setDate(date);assertSame(date  IntrospectionSupport.getProperty(bean  'date')); // succeedMap&lt;String  Object&gt; map = new HashMap&lt;String  Object&gt;();IntrospectionSupport.getProperties(bean  map  null);assertSame(date  map.get('date')); // fails,0,0
Aggregator - Add option to specify if completionInterval to have interval based completion,This allows for example the stock quote example to use 5 sec interval to trigger completions to spit out current quotes every 5th seconds.,0,0
DefaultPackageScanClassResolver can't read entries in an eclipse rcp app because it can't handle bundleresource - protocol,scenario:I have an eclipse rcp based app and use the apache camel libs within my plugin  i.e. the libs are one classpath of the plugin. I use a route using camel-mail to process some mailqueues.CamelContext context = new DefaultCamelContext();context.addRoutes(new RouteBuilder() { public void configure() { from('imaps://mailserver?username=user&amp;password=password&amp;consumer.delay=5000&amp;delete=false&amp;unseen=true') .to('log: new mail'); }}); context.start();When I start my app all seems to be ok. But in my log I get a lot of error messages regarding the loading of converters. If I ask my context to find a converter f.i. to converty to byte[] form inputstream (as I did see in another mail example reagding attachments) I get null because the context can't find one.I debugged deeper into the camel code and it seems that the DefaultPackageScanClassResolver can't load from urls starting with bundleresource like 'bundleresource://109.fwk32380043:4/org/apache/camel/component/file/'using camel-osgi didn't worked because all camel libs are loaded as inner libs of my single plugin and not as plugins. (loading as plugins didn't worked but thats another problem/bug)LOG Messages:2010-04-21 11:15:34 829 DEBUG org.apache.camel.impl.converter.DefaultTypeConverter loadTypeConverters - Loading type converters ...2010-04-21 11:15:34 829 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver findAnnotated - Searching for annotations of org.apache.camel.Converter in packages: &#91;org.apache.camel.component.file  org.apache.camel.component.bean  org.apache.camel.converter  org.apache.camel.component.mail  org.apache.camel.component.spring.integration.converter&#93;2010-04-21 11:15:34 829 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver getClassLoaders - The thread context class loader: org.eclipse.core.runtime.internal.adaptor.ContextFinder@1a76eff is used to load the class2010-04-21 11:15:34 829 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver find - Searching for: annotated with @Converter in package: org/apache/camel/component/file using classloader: org.eclipse.core.runtime.internal.adaptor.ContextFinder2010-04-21 11:15:39 954 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver getResources - Getting resource URL for package: org/apache/camel/component/file with classloader: org.eclipse.core.runtime.internal.adaptor.ContextFinder@1a76eff2010-04-21 11:16:44 970 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver find - URL from classloader: bundleresource://109.fwk32380043:4/org/apache/camel/component/file/2010-04-21 11:17:01 642 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver find - Decoded urlPath: /org/apache/camel/component/file/ with protocol: bundleresource2010-04-21 11:23:59 814 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver find - isLocalFileSystem: false2010-04-21 11:24:00 470 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver find - Scanning for classes in &#91;/org/apache/camel/component/file/&#93; matching criteria: annotated with @Converter2010-04-21 11:24:16 079 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver find - Loading from jar using http/https: /org/apache/camel/component/file/2010-04-21 11:24:26 626 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver find - Cannot read entries in url: bundleresource://109.fwk32380043:4/org/apache/camel/component/file/java.net.MalformedURLException: no protocol: /org/apache/camel/component/file/ at java.net.URL.&lt;init&gt;(URL.java:567) at java.net.URL.&lt;init&gt;(URL.java:464) at java.net.URL.&lt;init&gt;(URL.java:413) at org.apache.camel.impl.DefaultPackageScanClassResolver.find(DefaultPackageScanClassResolver.java:264) at org.apache.camel.impl.DefaultPackageScanClassResolver.find(DefaultPackageScanClassResolver.java:180) at org.apache.camel.impl.DefaultPackageScanClassResolver.findAnnotated(DefaultPackageScanClassResolver.java:100) at org.apache.camel.impl.converter.AnnotationTypeConverterLoader.load(AnnotationTypeConverterLoader.java:63) at org.apache.camel.impl.converter.DefaultTypeConverter.loadTypeConverters(DefaultTypeConverter.java:361) at org.apache.camel.impl.converter.DefaultTypeConverter.doStart(DefaultTypeConverter.java:384) at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:53) at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:49) at org.apache.camel.impl.DefaultCamelContext.startServices(DefaultCamelContext.java:1174) at org.apache.camel.impl.DefaultCamelContext.addService(DefaultCamelContext.java:644) at org.apache.camel.impl.DefaultCamelContext.getTypeConverter(DefaultCamelContext.java:691) at org.apache.camel.util.CamelContextHelper.convertTo(CamelContextHelper.java:68),0,0
XPath - Add type converters from the pesky XPath types to String  InputStream etc.,See nabblehttp://old.nabble.com/XPath-Splitter-Problem-ts28325959.htmlThen its easier for Camel end users as they wont have as many problems with the bad XPath result types for NODESET and whatnot.,0,0
Smpp component schedule delivery time should default to null,In testing this component  I ran into a problem where the calculated SCHEDULE_DELIVERY_TIME in SmppBinding ends up off for my time zone  so all my SMS messages are delivered an hour later. I'm not quite sure why I'm seeing this problem  it almost appears that TimeZone is not properly adjusting the raw offset for DST.However  in reading the SMS v3.4 spec  there's no reason to attempt to define a default delivery time of 'now'  because transmitting null indicates the message is to be delivered immediately.Therefore  it seems like SmppBinding should be updated not to attempt to set a default date of 'now'. This solved my problem  and avoids any potential date miscalculations for the overwhelming majority of cases where people want the message delivered immediately.P.S. There is no camel-smpp Component defined in Jira.,0,0
HttpEntityConverter should not create a InputStreamEntity by using the GZIPHelper.toGZIPInputStream(),GZIPHelper.toGZIPInputStream() is used for uncompress the zip date and not for compress the data.,0,0
camel-spring - Spring 3.0.x - Add depends-on in the namespace handler to make it easy for end users to use Spring and Camel without considering ordering of their beans,Spring 3.0.x behaves differently when discovering bean dependencies. For example if you have a &lt;routeBuilder ref='xxx'/&gt; in &lt;camelContext/&gt; than the xxx bean will not by default be dependent on the &lt;camelContext/&gt;. This causes Spring maybe to create the xxx before the camelContext. And you most likely want CamelContext to be created beforehand  so IoC allows you to inject CamelContext into that xxx or whatnot.See nabblehttp://old.nabble.com/Spring-3.0-and-Camel-2.2---Route-configure%28%29-called-before-Spring-beans-injected-ts28415437.htmlWe do already have logic for this in the namespace handler  but we need to add it to more places to have it working for all kind of camel types.,0,0
cxfbean component should ignore the wsdlLocation in the POJO,cxfbean component should ignore the wsdlLocation in the annotation in the POJO when starting the service. It should be using the JAXWS bean to create the service. Came across this bug when I (mistakenly) set the wsdlLocation to the http one published by the service  which of course wasn't up yet and I got the exception below. Fix for this coming soon.For Googlers out there  this ticket may fix this error message you may be getting:Caused by: org.apache.camel.ResolveEndpointFailedException: Failed to resolve endpoint: cxfbean://jaxwsBean due to: Failed to create service. at org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:437) at org.apache.camel.util.CamelContextHelper.getMandatoryEndpoint(CamelContextHelper.java:46) at org.apache.camel.model.RouteDefinition.resolveEndpoint(RouteDefinition.java:154) at org.apache.camel.impl.DefaultRouteContext.resolveEndpoint(DefaultRouteContext.java:109) at org.apache.camel.impl.DefaultRouteContext.resolveEndpoint(DefaultRouteContext.java:115) at org.apache.camel.model.SendDefinition.resolveEndpoint(SendDefinition.java:63) at org.apache.camel.model.SendDefinition.createProcessor(SendDefinition.java:57) at org.apache.camel.model.ToDefinition.createProcessor(ToDefinition.java:87) at org.apache.camel.model.ProcessorDefinition.makeProcessor(ProcessorDefinition.java:286) at org.apache.camel.model.ProcessorDefinition.addRoutes(ProcessorDefinition.java:114) at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:640) ... 32 moreCaused by: org.apache.cxf.service.factory.ServiceConstructionException: Failed to create service. at org.apache.cxf.wsdl11.WSDLServiceFactory.&lt;init&gt;(WSDLServiceFactory.java:93) at org.apache.cxf.service.factory.ReflectionServiceFactoryBean.buildServiceFromWSDL(ReflectionServiceFactoryBean.java:396) at org.apache.cxf.service.factory.ReflectionServiceFactoryBean.initializeServiceModel(ReflectionServiceFactoryBean.java:521) at org.apache.cxf.service.factory.ReflectionServiceFactoryBean.create(ReflectionServiceFactoryBean.java:271) at org.apache.cxf.jaxws.support.JaxWsServiceFactoryBean.create(JaxWsServiceFactoryBean.java:177) at org.apache.cxf.frontend.AbstractWSDLBasedEndpointFactory.createEndpoint(AbstractWSDLBasedEndpointFactory.java:100) at org.apache.cxf.frontend.ServerFactoryBean.create(ServerFactoryBean.java:105) at org.apache.cxf.jaxws.JaxWsServerFactoryBean.create(JaxWsServerFactoryBean.java:167) at org.apache.camel.component.cxf.cxfbean.CxfBeanEndpoint.createServer(CxfBeanEndpoint.java:104) at org.apache.camel.component.cxf.cxfbean.CxfBeanEndpoint.init(CxfBeanEndpoint.java:86) at org.apache.camel.component.cxf.cxfbean.CxfBeanComponent.createEndpoint(CxfBeanComponent.java:48) at org.apache.camel.impl.DefaultComponent.createEndpoint(DefaultComponent.java:78) at org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:416) ... 42 moreCaused by: javax.wsdl.WSDLException: WSDLException: faultCode=PARSER_ERROR: java.lang.IllegalArgumentException: InputSource must have a ByteStream or CharacterStream at org.apache.cxf.wsdl11.WSDLManagerImpl.loadDefinition(WSDLManagerImpl.java:226) at org.apache.cxf.wsdl11.WSDLManagerImpl.getDefinition(WSDLManagerImpl.java:179) at org.apache.cxf.wsdl11.WSDLServiceFactory.&lt;init&gt;(WSDLServiceFactory.java:91) ... 54 moreCaused by: java.lang.IllegalArgumentException: InputSource must have a ByteStream or CharacterStream at org.apache.cxf.staxutils.StaxUtils.createXMLStreamReader(StaxUtils.java:983) at org.apache.cxf.wsdl11.WSDLManagerImpl.loadDefinition(WSDLManagerImpl.java:217) ... 56 more,0,0
RoutingSlip - Let it be expression based,Currently the Routing Slip EIP is a bit inflexible as it mandates the attached slip has been created beforehand.It would be nice if you could let it be expression based to generate the initial attached slip.Then end users can use a bean to generate the slip.This requires a change in the DSL which is not backwards compatible.But it makes the EIP in line with Recipient List and others which is expression based.,0,0
File name lost when it starts with the same characters as the relative directory on the endpoint,When polling file from a directory using a relative file URI  the file name gets lost when it starts with the same characters as the directory name.E.g. a directory 'orders' containing 'orders-1719.xml' and 'orders-1819.xml'from('file:orders').process(new Processor() { public void process(Exchange exchange) { // there's no file name on the message here (exchange.getIn().getHeader(Exchange.FILE_NAME) returns null) }});,0,0
Incomplete cleanup of jmx mbeans after context stop,There is a fair amount of cleanup on context stop  but it is incomplete. Most of it has to do with JMX and if one creates and starts a new CamelContext she may end up with managed objects pointing nowhere or have duplicates or other minor side-effects. One of the nasty side effects is that we are pretty much forced to use '&lt;forkMode&gt;pertest&lt;/forkMode&gt;' in our surefire plugin configuration  ensuring a clean slate for every test.For long running apps in which you may have multiple CamelContext running at various times during the lifetime of the application we must properly cleanup when stopping the context. I have a series of patches fixing that which I hope to finish before 2.3. Once we're comfortable and tested with multiple jdk implementations and versions  I'd change the forkMode to 'once'. In my local copy this reduces the test time in core from 40+ mins to under 15 mins. Since interactions between tests is still possible and might lead us on a wild-goose we could add another profile that uses the safer yet time consuming 'pertest' forkMode.,0,1
Camel-bindy should be able to process fix length records,Camel-bindy should be able to process fix length records which has no separators:A sample line could looks like: 47111234567890654321098765432199999999999999994711 is the companyId1234567890 is the cardProgram6543210987654321 is the accountNumber9999999999999999 is the cardNumberCreated a POJO with the Camel bindy annotations:@CsvRecord(separator = '')public class CSVRecord implements Serializable { @DataField(pos = 1  length = 4) private String companyId; @DataField(pos = 2  length = 10) private String cardProgram; @DataField(pos = 3  length = 16) private String accountNumber; @DataField(pos = 4  length = 16) private String cardNumber; // getter and setter} See nabble for details.,0,0
SendProcessor - When a route is started it should be able to warmup the Producer,In case you want to have Camel etc. to fail on startup in case a Producer cannot start  for example it needs a remote connection which fails.The producer would normally be created on-the-fly  eg a message needs to be send to it.,0,0
HttpProducer should not sending the Http headers with low case,Here is the mail thread which discusses about it.http://old.nabble.com/camel-http-converts-headers-to-lower-case-tp28620717p28620717.html,0,0
AggregationStrategy returning null causes NPE,When the AggregationStrategy's aggregate method returns null  the AggregateProcessor throws an NPE. While this is a result of user error  I think it would be easy to provide a more useful error indicating what the true problem is. This is the (not very helpful) error the user sees:ERROR | Caused by: [org.apache.camel.RuntimeCamelException - java.lang.NullPointerException]org.apache.camel.RuntimeCamelException: java.lang.NullPointerException at org.apache.camel.util.ObjectHelper.wrapRuntimeCamelException(ObjectHelper.java:1117) at org.apache.camel.component.jms.EndpointMessageListener.onMessage(EndpointMessageListener.java:104) at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:543) at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:482) at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:451) at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:323) at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:261) at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:982) at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:974) at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:876) at java.lang.Thread.run(Thread.java:619)Caused by: java.lang.NullPointerException at org.apache.camel.processor.aggregate.AggregateProcessor.doAggregation(AggregateProcessor.java:227) at org.apache.camel.processor.aggregate.AggregateProcessor.process(AggregateProcessor.java:182) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67) at org.apache.camel.processor.DelegateProcessor.processNext(DelegateProcessor.java:53) at org.apache.camel.processor.DelegateProcessor.proceed(DelegateProcessor.java:82) at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:97) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67) at org.apache.camel.processor.RedeliveryErrorHandler.processExchange(RedeliveryErrorHandler.java:185) at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:151) at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:89) at org.apache.camel.processor.DefaultErrorHandler.process(DefaultErrorHandler.java:49) at org.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:228) at org.apache.camel.processor.UnitOfWorkProcessor.processNext(UnitOfWorkProcessor.java:70) at org.apache.camel.processor.DelegateProcessor.process(DelegateProcessor.java:48) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67) at org.apache.camel.component.jms.EndpointMessageListener.onMessage(EndpointMessageListener.java:84) ... 9 more,0,0
camel-cxf feature doesn't include all cxf needs bundles,Current camel-cxf features doesn't include wss4j  saaj-imple  opensaml  fastinfoset bundle.We need to add these bundle into camel-cxf features.,0,0
VM endpoints with same name do not communicate if args don't match,If you send to a VM endpoint from one route and consume from the same endpoint in another route  but include an argument on only one of the routes  Camel sees them as two different routes. Therefore  the messages are never consumed. For example:&lt;camelContext id='sendNotifyContext' xmlns='http://camel.apache.org/schema/spring' errorHandlerRef='errorHandler'&gt; &lt;route id='sendToNotify'&gt; &lt;from uri='...' /&gt; .... &lt;to uri='vm:myNotify' /&gt; &lt;/route&gt;&lt;/camelContext&gt;&lt;camelContext id='receiveNotifyContext' xmlns='http://camel.apache.org/schema/spring' errorHandlerRef='errorHandler'&gt; &lt;route id='receiveNotify'&gt; &lt;from uri='vm:myNotify?size=2500' /&gt; .... &lt;to uri='...' /&gt; &lt;/route&gt;&lt;/camelContext&gt;The producer appears to send to vm:myNotify while the consumer is listening to a separate endpoint named vm:myNotify?size=2500  so the messages build up and are never received.,0,0
MailBinding can't handle the subject header with NO_ASCII code rightly.,Here is the mail thread which discusses about it.,0,0
OnCompletion - Let it be executed last so the internal on completions can be executed beforehand,See nabblehttp://old.nabble.com/Problems-shutting-down-route-onCompletion-ts28707903.htmlThis requires some sort of marker / API changes or whatever to let Camel knows that its a OnCompletion synchronization so it should be executed last.We may need to add a priority option or the likes.,0,0
Bindy - No @Section causes a null key being generated which causes a NumberFormatException,See nabblehttp://old.nabble.com/Bindy-CSV-not-Marshaling-ts28719942.html,0,0
Escaped characters in http4 URLs do not work,There is a bug in http4 HttpProducer that is unescaping URL query and path components too early. Patch fix attached.,0,0
ManagementAgent should expose getter/setters for the JMX settings so you can set it easily from Java,Today you have to use a JVM system propertyYou can set the service URL path by system property.-Dorg.apache.camel.jmx.serviceUrlPath=&lt;path&gt;This should be possible to set from Java like this also:context.getManagementStrategy().getManagementAgent().setServiceUrlPath('foo ....');,0,0
Aggregation raises NullPointerException if last file in batch is not to be aggregated.,When trying to aggregate files from a directory  it seems that camel-core raises a NullPointerException if the last file of the batch is a single file. That is it doesn't match the correlationExpression with any other files and therefore should just pass through. If such a file is the first file or in the middle of the files (alphabetically) this issue is not present.See:http://old.nabble.com/Aggregator-problem-with-files-(Camel-2.3)-td28778641.html#a28780522,0,0
Graceful shutdown - Add option to shutdown manually added/started routes,If you for example add routes later at runtime  then those where not enlisted on startup and thus not part of the process to be stopped.Those routes added manually should be part of this so they are also shutdown. There should be an option to control this behavior so you can turn it off  in the odd cases you dont want that.,0,0
It is impossible to put # sign in SQL statement in camel-sql,SqlProducer implementation turns all # characters into ? making it impossible to have # in the SQL statement.,0,0
camel-castor relies on specific  out of date version of Castor,camel-castor specifies a non-flexible version dependency on Castor 1.2.0. Ideally should be changed to [1.2.0 2.0) to allow later versions of Castor to be deployed. Castor 1.2 was released in Feb 2008  1.3 was first released in Feb 2009,0,0
camel-ftp - SFTP in fileExists should handle exception being thrown with id code stating no such file,See nabblehttp://camel.465427.n5.nabble.com/camel-ftp-cannot-create-directory-using-sftp-tp479092p479092.html,0,0
Deadlock in org.apache.camel.util.DefaultTimeoutMap,After running a camel route with a camel Aggregator for a while  I get a deadlock in org.apache.camel.util.DefaultTimeoutMap. A full processdump is attached to this bug.I have also tried to recreate this as failing testcase  but without any luck so far.,0,1
Support for Binary Files in HttpProducer,Presently  the HTTP Component doesn't support transferring binary files. The attached patch adds support. Tested successfully using a file -&gt; http route with a PUT.,0,0
CsvDataFromat delimiter should also be configurable in the XML/Spring DSL,The org.apache.camel.model.dataformat.CsvDataFormat doesn't support any attributes or nested elements in the XML DSL. So  currently it is not possible for the XML/Spring DSL to change the token delimiter as it is possible in the Java DSL.See Nabble,0,0
Thread Name Syntax - Do not output endpoint parameters to be less verbose,By default thread names from consumers have the endpoint uri in the name  but those can become longCamel Thread 1 - ftp://sms01@localhost:2121/autreq/err?delay=5000&amp;filter=%23conaxRequestFilter&amp;move=.processed&amp;passiveMode=true&amp;password=sms01]So we should change {$name} to be just the endpoint without all the parameters. Eg clip after the first ? so it becomesCamel Thread 1 - ftp://sms01@localhost:2121/autreq/err]So we should change it to be ${name} the new short handed syntax ${fullName} as now with everything,0,0
No consumers available on 'direct://xyz' endpoint,The following warning in log4j log shows up with no predictable reason:2010-06-24 14:07:01 090 WARN &#91;DefaultMessageListenerContainer-7:DirectProducer.java:42&#93; No consumers available on endpoint: Endpoint&#91;direct://UserCancelJobRequest&#93; to process: Exchange[JmsMessage: RunnerBase{locationToRunId='DV02YcABTE43HTRPATEGCBFk0m0'  jobrun_id=1234  requestOrigId='null'  secretKey='null'  replyToQueueOrTopic='null'  corrolationId='null'  requestCreationTime=Thu Jun 24 14:07:01 PDT 2010}]The endpoint &#91;direct://UserCancelJobRequest&#93; could be a number of different endpoints in our application and all of them are of 'direct:' type. When this happens  all messages that run through that endpoint will fail  and it will never recover unless the application is restarted.Also  if I restart the application and use that route immediately  that warning will not occur and the request will finish successfully. It seems to happen to routes that have not been used for a while after startup.When this happens  I can find the exact Camel endpoint/route/processor in JConsole  and nothing seems to be wrong. How can a 'direct:' endpoint runs out of consumer? Isn't the thread that product this warning THE thread to process the message?We recently upgraded from 5.2 to 5.3.2 and this starts to show up randomly. It is a show stopper!--Michael,0,1
convertBodyTo should handle null bodies,If the body is null and you use convertBodyTo you will get a no type converter exception due body is null. Instead it should accept the null body and continue routing.,0,0
Redelivery policy's retryUntil option should be renamed as retryWhile,The semantics of retryUntil are a bit counter-intuitive. I would naturally expect retryUntil(predicate) to mean retry until predicate is true  but it actually means retry until predicate is false. If you change the name of the option to retryWhile  you would get the natural interpretation retry while predicate is true.,0,0
URIs for viewing a route as a language clashes with any other possible sub resource for routes (such as status),rather than: {id}/{lang}we should use something like {id}/lang/{lang}so that it doesn't gobble up: {id}/status or {id}/somethingElse,0,0
remove ugly warnings running tests since upgrading to jetty 7,lets zap these...[ main] log WARN java.lang.ClassNotFoundException: org.eclipse.jetty.jsp.JettyLog,0,0
update camel-http and camel-cxf features to use Commons Codec 1.4,The latest version of Commons Codec is available as an OSGi bundle  so it would be nice to update the features file for Camel 2.3 to use that version:&lt;bundle&gt;mvn:commons-codec/commons-codec/1.4&lt;/bundle&gt;I've been installing 1.4 by hand and removing the org.apache.servicemix.bundles.commons-codec/1.3_2 without any ill effects on camel-http.,0,0
Oracle AQ does not support the JMSReplyTo property and therefore throws a 'JMS-102: Feature not supported' exception when the JMS provider tries to get it.,Oracle AQ does not support the JMSReplyTo property and therefore throws a 'JMS-102: Feature not supported' exception when the JMS provider tries to get it.,0,0
more eager validation of routes,it seems you can dynamically create invalid routes which don't fail fast if there are errors.e.g.from('seda:foo').beanRef('doesNotExist'  'noMethodCalledThis')its only if a message is sent to 'seda:foo' that the whole thing barfs. We should maybe check that the to can be validated first before allowing the consumer to startup? If nothing else failing faster and earlier helps users spot errors sooner,0,0
Use  forkMode=once for the surefire plugin to significantly speed up tests,We need to reduce the testing time in Camel since we got so many tests now. For this to work wee need to make sure there are no side effects outside of a test (which is not always simple).Side effects usually stem from using static fields in classes shared across multiple tests (such as caches of Exchanges  or whatnot)  which should be avoided.,0,0
Injecting Properties into the PropertiesComponent with Spring,The component is quite nice - however a good improvement would be allowing properties to be injected through Spring.Currently there are two ways to do this using Spring.1) Declare a bean with an id of properties:&lt;bean id='properties' class='org.apache.camel.component.properties.PropertiesComponent'&gt; &lt;property name='location' value='classpath:com/mycompany/myprop.properties'/&gt;&lt;/bean&gt;This would be improved if we could simply say:&lt;bean id='properties' class='org.apache.camel.component.properties.PropertiesComponent'&gt; &lt;property name='location' ref='myPropertiesBean'/&gt;&lt;/bean&gt;This would allow properties to be declared in Spring using &lt;util:properties/&gt;. The same properties grouping could be injected into Camel as is injected into other beans.2) Inline within the camelContext defined in Spring:&lt;camelContext ...&gt; &lt;propertyPlaceholder id='properties' location='com/mycompany/myprop.properties'/&gt;&lt;/camelContext&gt;Similarly it would be nice to say:&lt;camelContext ...&gt; &lt;propertyPlaceholder id='properties' ref='myPropertiesBean' /&gt;&lt;/camelContext&gt;I noticed CAMEL-2791 is out there to access JVM system properties - it would be good to not have to load as a system property to access them in Camel.,0,0
Broken failure reporting via DefaultProucerTemplate.asyncCallback and Synchronization.onFailure,The recent change in ProducerCache.sendProducerCache.java public void send(Endpoint endpoint  Exchange exchange) { try { sendExchange(endpoint  null  null  exchange); // RECENT CHANGE HERE: // ensure that CamelExecutionException is always thrown if (exchange.getException() != null) { exchange.setException(wrapCamelExecutionException(exchange  exchange.getException())); } } catch (Exception e) { throw wrapCamelExecutionException(exchange  e); } }that throws a CamelExecutionException if exchange.getException is not null  makes it impossible for DefaultProducerTemplate.asyncCallback to report failures (other than fault messages) asynchronously via Synchronization.onFailureDefaultProducerTemplate.java public Future&lt;Exchange&gt; asyncCallback(final Endpoint endpoint  final Exchange exchange  final Synchronization onCompletion) { Callable&lt;Exchange&gt; task = new Callable&lt;Exchange&gt;() { public Exchange call() throws Exception { // FIXME: exception is thrown in Camel 2.4 where a normal return with answer.getException != null was done in Camel 2.3 Exchange answer = send(endpoint  exchange); if (answer.isFailed()) { onCompletion.onFailure(answer); } else { // ... } return answer; } }; // ... }This was working in Camel 2.3 (but unfortunately there wasn't any test case for it). I attached a patch for DefaultProducerTemplateAsyncTest that demonstrates the problem. I didn't commit a fix yet because I'm unsure at the moment about the best way to fix that. Of course I tried a naive fix in the DefaultProducerTemplate.asyncCallback methods which causes the test (in the patch) to pass but I'd like to hear other opinions before I continue.,0,0
StreamProducer does not close stream in camel-stream,Since the stream could be System.out or System.err  the producer does not close the stream ever. It should close all streams with the noted exceptions.,0,1
org.apache.camel.component.test package is imported in camel-spring component - generates error on OSGI platform,[ 86] [Installed ] [ ] [ 60] camel-spring (2.5.0.SNAPSHOT)karaf@root&gt; start 86Error executing command: Unresolved constraint in bundle org.apache.camel.camel-spring [86]: Unable to resolve 86.0: missing requirement [86.0] package; (&amp;(package=org.apache.camel.component.test)(version&gt;=2.5.0)(!(version&gt;=2.5.1))) - [86.0] package; (&amp;(package=org.apache.camel.component.test)(version&gt;=2.5.0)(!(version&gt;=2.5.1)))karaf@root&gt; headers 86camel-spring (86)-----------------Bnd-LastModified = 1278946400750Build-Jdk = 1.6.0_20Built-By = CharlesmBundle-Activator = org.apache.camel.osgi.ActivatorBundle-Description = Camel Spring supportBundle-DocURL = http://www.apache.org/Bundle-License = http://www.apache.org/licenses/LICENSE-2.0.txtBundle-ManifestVersion = 2Bundle-Name = camel-springBundle-SymbolicName = org.apache.camel.camel-springBundle-Vendor = The Apache Software FoundationBundle-Version = 2.5.0.SNAPSHOTCreated-By = Apache Maven Bundle PluginExport-Package = org.apache.camel.spring.spi;uses:='org.springframework.context org.apache.camel.spi org.springframework.beans.factory org.apache.camel org.springframework.beans.factory.config org.apache.camel.builder org.springframework.transaction org.apache.commons.logging org.apache.camel.processor.exceptionpolicy org.apache.camel.processor org.apache.camel.util org.apache.camel.model org.springframework.transaction.support';version='2.5.0.SNAPSHOT' org.apache.camel.spring.util;uses:='org.apache.camel org.springframework.context org.apache.camel.util org.apache.commons.logging org.springframework.beans.factory org.springframework.util';version='2.5.0.SNAPSHOT' org.apache.camel.spring.remoting;uses:='org.apache.camel.util org.springframework.remoting.support org.apache.camel.component.bean org.apache.camel org.springframework.beans org.springframework.context org.apache.camel.spi org.apache.camel.spring.util org.springframework.beans.factory';version='2.5.0.SNAPSHOT' org.apache.camel.spring;uses:='org.apache.camel.impl org.apache.camel.util org.apache.commons.logging org.apache.camel org.springframework.beans org.springframework.context org.springframework.util org.springframework.beans.factory.config org.apache.camel.spring.util javax.xml.bind.annotation org.springframework.beans.factory org.apache.camel.builder org.apache.camel.model.dataformat org.springframework.context.event org.apache.camel.model.config org.apache.camel.model org.apache.camel.spi org.apache.camel.spring.spi org.apache.camel.view org.springframework.context.support org.apache.camel.spring.handler javax.xml.bind org.apache.camel.component.bean org.apache.camel.component.event org.springframework.transaction org.springframework.transaction.support';version='2.5.0.SNAPSHOT' org.apache.camel.spring.handler;uses:='org.springframework.beans.factory.support org.springframework.core org.springframework.util org.springframework.beans.factory.xml org.w3c.dom org.springframework.beans org.springframework.beans.factory.config org.springframework.beans.factory.parsing org.apache.camel.model.dataformat org.apache.camel.model.config org.apache.camel.util org.apache.camel.model org.apache.camel.spring javax.xml.bind org.springframework.beans.factory org.apache.camel.view org.apache.commons.logging org.apache.camel.model.loadbalancer org.apache.camel.builder.xml org.apache.camel.spring.remoting org.apache.camel.spi org.apache.camel org.apache.camel.model.language org.apache.camel.processor';version='2.5.0.SNAPSHOT' org.apache.camel.osgi;uses:='org.osgi.framework org.apache.camel.impl org.springframework.osgi.context org.apache.commons.logging javax.xml.bind.annotation org.springframework.context org.apache.camel.spring org.apache.camel.model org.apache.camel.model.loadbalancer org.apache.camel org.apache.camel.model.language org.springframework.beans.factory.xml org.apache.camel.model.dataformat org.apache.camel.spring.handler org.apache.camel.model.config org.apache.camel.spi';version='2.5.0.SNAPSHOT' org.apache.camel.component;uses:='org.apache.camel.impl org.apache.commons.logging org.springframework.core.io org.apache.camel org.apache.camel.converter org.apache.camel.spi';version='2.5.0.SNAPSHOT' org.apache.camel.component.event;uses:='org.apache.camel org.springframework.context org.apache.camel.impl org.springframework.beans org.apache.camel.util org.apache.camel.processor.loadbalancer';version='2.5.0.SNAPSHOT' org.apache.camel.component.test;uses:='org.apache.camel.impl org.apache.camel.util org.apache.camel org.apache.commons.logging org.apache.camel.component.mock';version='2.5.0.SNAPSHOT' org.apache.camel.component.validator;uses:='javax.xml.transform org.springframework.core.io javax.xml.transform.stream org.apache.camel.processor.validation org.apache.camel.impl org.apache.camel.component org.apache.commons.logging org.apache.camel';version='2.5.0.SNAPSHOT' org.apache.camel.component.xslt;uses:='org.apache.camel.impl org.apache.camel.component org.apache.commons.logging org.apache.camel org.springframework.core.io org.apache.camel.builder.xml org.apache.camel.util javax.xml.transform org.apache.camel.converter.jaxp org.apache.camel.spi';version='2.5.0.SNAPSHOT'Ignore-Package = org.apache.camel.spring.remoting org.apache.camel.component org.apache.camel.component.validator org.apache.camel.component.xslt org.apache.camel.spring.spi org.apache.camel.spring org.apache.camel.osgi org.apache.camel.spring.handler org.apache.camel.component.event org.apache.camel.spring.utilImplementation-Title = Camel :: SpringImplementation-Vendor = The Apache Software FoundationImplementation-Vendor-Id = org.apache.camelImplementation-Version = 2.5-SNAPSHOTImport-Package = javax.xml.bind javax.xml.bind.annotation javax.xml.bind.annotation.adapters javax.xml.transform javax.xml.transform.stream org.apache.camel;version='[2.5.0 2.5.1)' org.apache.camel.builder;version='[2.5.0 2.5.1)' org.apache.camel.builder.xml;version='[2.5.0 2.5.1)' org.apache.camel.component.bean;version='[2.5.0 2.5.1)' org.apache.camel.component.mock;version='[2.5.0 2.5.1)' org.apache.camel.component.properties;version='[2.5.0 2.5.1)' org.apache.camel.component.test;version='[2.5.0 2.5.1)' org.apache.camel.converter;version='[2.5.0 2.5.1)' org.apache.camel.converter.jaxp;version='[2.5.0 2.5.1)' org.apache.camel.impl;version='[2.5.0 2.5.1)' org.apache.camel.impl.converter;version='[2.5.0 2.5.1)' org.apache.camel.management;version='[2.5.0 2.5.1)' org.apache.camel.model;version='[2.5.0 2.5.1)' org.apache.camel.model.config;version='[2.5.0 2.5.1)' org.apache.camel.model.dataformat;version='[2.5.0 2.5.1)' org.apache.camel.model.language;version='[2.5.0 2.5.1)' org.apache.camel.model.loadbalancer;version='[2.5.0 2.5.1)' org.apache.camel.processor;version='[2.5.0 2.5.1)' org.apache.camel.processor.exceptionpolicy;version='[2.5.0 2.5.1)' org.apache.camel.processor.interceptor;version='[2.5.0 2.5.1)' org.apache.camel.processor.loadbalancer;version='[2.5.0 2.5.1)' org.apache.camel.processor.validation;version='[2.5.0 2.5.1)' org.apache.camel.spi;version='[2.5.0 2.5.1)' org.apache.camel.util;version='[2.5.0 2.5.1)' org.apache.camel.view;version='[2.5.0 2.5.1)' org.apache.commons.logging org.osgi.framework;version='[1.3 2)' org.osgi.util.tracker;version='[1.3 2)' org.springframework.beans;version='[2.5 4)' org.springframework.beans.factory;version='[2.5 4)' org.springframework.beans.factory.config;version='[2.5 4)' org.springframework.beans.factory.parsing;version='[2.5 4)' org.springframework.beans.factory.support;version='[2.5 4)' org.springframework.beans.factory.xml;version='[2.5 4)' org.springframework.context;version='[2.5 4)' org.springframework.context.event;version='[2.5 4)' org.springframework.context.support;version='[2.5 4)' org.springframework.core;version='[2.5 4)' org.springframework.core.io;version='[2.5 4)' org.springframework.osgi.context;version='[1.2 2)' org.springframework.remoting.support;version='[2.5 4)' org.springframework.transaction;version='[2.5 4)' org.springframework.transaction.support;version='[2.5 4)' org.springframework.util;version='[2.5 4)' org.w3c.domManifest-Version = 1.0Specification-Title = Camel :: SpringSpecification-Vendor = The Apache Software FoundationSpecification-Version = 2.5-SNAPSHOTTool = Bnd-0.0.357,0,0
java.util.ConcurrentModificationException in Method org.apache.camel.util.CaseInsensitiveMap.putAll(),Every now and then I'm facing the ConcurrentModificationException. It very hard to reproduce. This is my stack trace:Failed delivery for exchangeId: ba969718-9044-4261-bc57-ca10aafb0a03. Exhausted after delivery attempt: 1 caught: java.util.ConcurrentModificationExceptionjava.util.ConcurrentModificationException: null at java.util.HashMap$HashIterator.nextEntry(HashMap.java:793) &#91;na:1.6.0_20&#93; at java.util.HashMap$KeyIterator.next(HashMap.java:828) &#91;na:1.6.0_20&#93; at org.apache.camel.util.CaseInsensitiveMap.putAll(CaseInsensitiveMap.java:86) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.impl.MessageSupport.copyFrom(MessageSupport.java:142) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.impl.DefaultMessage.copyFrom(DefaultMessage.java:52) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.util.ExchangeHelper.copyResults(ExchangeHelper.java:199) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.processor.Pipeline.process(Pipeline.java:114) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.processor.DelegateProcessor.processNext(DelegateProcessor.java:53) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.processor.ChoiceProcessor.process(ChoiceProcessor.java:51) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.processor.DelegateProcessor.processNext(DelegateProcessor.java:53) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.processor.DelegateProcessor.proceed(DelegateProcessor.java:82) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:97) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.processor.RedeliveryErrorHandler.processExchange(RedeliveryErrorHandler.java:185) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:151) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:89) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.processor.DefaultErrorHandler.process(DefaultErrorHandler.java:49) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:228) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.processor.Pipeline.process(Pipeline.java:75) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.processor.UnitOfWorkProcessor.processNext(UnitOfWorkProcessor.java:70) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.processor.DelegateProcessor.process(DelegateProcessor.java:48) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:67) &#91;camel-core-2.3.0.jar:2.3.0&#93; at org.apache.camel.component.http.CamelServlet.service(CamelServlet.java:71) &#91;camel-http-2.3.0.jar:2.3.0&#93; at javax.servlet.http.HttpServlet.service(HttpServlet.java:831) &#91;javaee.jar:9.1&#93;...Looks like CaseInsensitiveMap isn't enough thread save. But I have no idea what other thread is modifies the map. Most of the time everything is ok.,0,0
Upgrade to JCR 2.x,camel-jcr is based on 1.x. We should upgrade to 2.x which takes a bit of pain due API changes and the likes.,0,0
Upgrade to HawtDB 1.2,,0,0
When polling consumers is shutdown  do less verbose logging for rollback strategies,To avoid logs having stacktraces or the likes which was caused by shutting down the application.See nabblehttp://camel.465427.n5.nabble.com/Camel-2-4-Shutdown-Exception-tp1479154p1479154.html,0,0
JmsProducer should support non blocking routing engine,The JMS component is the most complex  and we left out improvements on purpose as we wanted 2.4 out before.Now its time to let the JmsProducer in request/reply mode leverage async processing so threads are not blocked while waiting for reply.,0,1
onException not working correctly when using routeContext,When using a routeContext  the last (in the xml-file) defined route-scoped &lt;onException&gt; configuration is shared by the other routes in the context.http://camel.465427.n5.nabble.com/possible-onException-bug-when-using-routeContext-td1616244.html#a1616244,0,0
java.net.SocketException: Too many open files with Apache Camel(Netty TCP) 2.4.0.,I've got a unit test that works fine with Apache Camel 2.3.0  but as soon as I upgraded to 2.4.0 it consistently started to fail.It performs a number of concurrent requests using this url:netty:tcp://localhost:2048?sync=trueIn both the client and server side of the unit test.There's also a sister test which does the same thing with Netty directly and that works in isolation  so it would appear something has been broken in the transition to 2.4.0. Previously this code was also using a beta version of Netty  but even updating that specific dependency has made no difference.,0,0
FtpComponent: If login fails and disconnect=true another connection is opened.,In a route such as below a second connection to the ftp server is opened if the login fails.&lt;route&gt;  &lt;from uri='ftp:localhost/inbox/?username=usr&amp;password=pwd&amp;disconnect=true&amp;consumer.delay=60s&amp;maximumReconnectAttempts=0' /&gt;  &lt;to uri='file:test_data' /&gt; &lt;/route&gt; Further description: http://camel.465427.n5.nabble.com/FTP-Try-login-once-and-disconnect-if-failure-td1692660.html#a1692660,1,0
camel-jpa doesn't use EntityManager.merge(entity) in the right way,The EntityManager.merge(entity) method returns the merged entity. The exchange in message body should be updated with the merged entity (what camel-jpa currently not do).I running into this problem  because after saving an entity in the database  the id field was still null. So  we don't know  which entity in the database is the corresponding to this entity... Have a look in the process method of JpaProducer and the Java doc from the EntityManager.Christian,0,0
DefaultHttpBinding's populateRequestParameters should be more flexible when checking the content type on POST,Line 126 in DefaultHttpBinding checks if the request's method is POST and the content type is 'application/x-www-form-urlencoded'. This unfortunately fails to populate the request parameters of a POST request where the content type includes the charset  e.g. 'application/x-www-form-urlencoded; charset=UTF-8'. Could the equals be changed to startsWith?,0,0
IllegalStateException in CamelContinuationServlet under heavy load,Reason is a race between continuation.suspend() and continuation.resume(). It can occur that continuation.resume() is executed before continuation.suspend() leading to an IllegalStateException thrown by Jetty:java.lang.IllegalStateException: DISPATCHED initial at org.eclipse.jetty.server.AsyncContinuation.dispatch(AsyncContinuation.java:364) at org.eclipse.jetty.server.AsyncContinuation.resume(AsyncContinuation.java:769) at org.apache.camel.component.jetty.CamelContinuationServlet$1.done(CamelContinuationServlet.java:85) at org.apache.camel.management.InstrumentationProcessor$1.done(InstrumentationProcessor.java:78) at org.apache.camel.processor.UnitOfWorkProcessor$1.done(UnitOfWorkProcessor.java:104) at org.apache.camel.processor.DefaultChannel$1.done(DefaultChannel.java:262) at org.apache.camel.processor.RedeliveryErrorHandler$1.done(RedeliveryErrorHandler.java:302) at org.apache.camel.management.InstrumentationProcessor$1.done(InstrumentationProcessor.java:78) at org.apache.camel.management.InstrumentationProcessor$1.done(InstrumentationProcessor.java:78)This is the case when an async completion callback is faster than the thread that is concurrently executing the if (continuation.isInitial()) block. I'll commit a fix soon that also follows the recommendations in http://wiki.eclipse.org/Jetty/Feature/Continuations to always call continuation.suspend() before registering the continuation with a callback handler.,0,0
Add removeEndpoints to CamelContext,It should support uri patterns so you can remove all endpoints using wild cards etc.removeEndpoints('activemq:queue:foo*')removeEndpoints('ftp:*'),0,0
Enable the deletion of routes via REST in camel-web,The camel-web allows a user to deploy and manipulate routes.It seems currently impossible to delete routes through camel-web.A delete operation on the route to be deleted would complete the REST interface: http://en.wikipedia.org/wiki/Representational_State_Transfer#RESTful_web_servicese.g.:RouteResource.java@Delete public void removeRoute() { getCamelContext().removeRouteDefinition(this.name); },0,0
Adding routes straight from XML should have Camel prepare the RouteDefintion as its done like in camel-spring,camel-spring does some preparation on the XML routes before they are added to CamelContext.When end users loads the XML routes themself using JAXB and add it straight to CamelContext  we should let camel-core prepare the routes as well.,0,0
Velocity - Let it be able to load resources from both classpath and file system out of the box,See this blog entryhttp://www.thedwick.com/blog/2010/08/how-to-include-other-velocity-templates-from-apache-camel/We should pre configure Velocity to use both type of resource loaders.,0,0
provide an optional interface Endpoints can provide to generate a simple String ID which can be used within the class loader to make JMX / REST APIs simpler to avoid having to encode large URIs,rather than taking the URI and encoding it  it would be nice if endpoints could just generate their own unique ID on construction (then we don't have lifecycle issues of keeping track of endpoints coming and going and maintaining a parallel map of Endpoint -&gt; ID etc).We could use the same ID when registering endpoints with JMX etc,0,1
Flatpack component : unable to set the delimiter parameter in spring config file,It's not possible to set the delimiter parameter in spring configuration file or I don't find the way to do it !For example : &lt;route id='routeA'&gt; &lt;from uri='file:src/test/resources/csv?move=done/&amp;fileName=testfileRouteA.csv' /&gt; &lt;to uri='flatpack:delim:META-INF/Delimited.pzmap.xml?delimiter=;' /&gt;&lt;/route&gt;I get the following error :Exception in thread 'main' org.apache.camel.RuntimeCamelException: org.apache.camel.FailedToCreateRouteException: Failed to create route routeA at: &gt;&gt;&gt; To&#91;flatpack:delim:META-INF/Delimited.pzmap.xml?ignoreFirstRecord=false&amp;splitRows=true&amp;delimiter=;&#93; &lt;&lt;&lt; in route: Route[[From[file:src/test/resources/csv?move=done/&amp;fileName=... because of Failed to resolve endpoint: flatpack://delim:META-INF/Delimited.pzmap.xml?delimiter=%3B&amp;ignoreFirstRecord=false&amp;splitRows=true due to: Could not find a suitable setter for property: delimiter as there isn't a setter method with same type: java.lang.String nor type conversion possible: No type converter available to convert from type: java.lang.String to the required type: char with value ; at org.apache.camel.util.ObjectHelper.wrapRuntimeCamelException(ObjectHelper.java:1126) at org.apache.camel.spring.SpringCamelContext.onApplicationEvent(SpringCamelContext.java:103) at org.apache.camel.spring.CamelContextFactoryBean.onApplicationEvent(CamelContextFactoryBean.java:231) at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:97) at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:303) at org.springframework.context.support.AbstractApplicationContext.finishRefresh(AbstractApplicationContext.java:911) at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:428) at org.springframework.context.support.ClassPathXmlApplicationContext.&lt;init&gt;(ClassPathXmlApplicationContext.java:139) at org.springframework.context.support.ClassPathXmlApplicationContext.&lt;init&gt;(ClassPathXmlApplicationContext.java:93) at org.apache.camel.spring.Main.createDefaultApplicationContext(Main.java:219) at org.apache.camel.spring.Main.doStart(Main.java:173) at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:56) at org.apache.camel.impl.MainSupport.run(MainSupport.java:114) at org.apache.camel.impl.MainSupport.run(MainSupport.java:291) at org.apache.camel.spring.Main.main(Main.java:97)If it's a bug  to solve it  it's just necessary to change the class org.apache.camel.component.flatpack.DelimitedEndpoint as below : change the flied definition like this (and getter/setter to): private String delimiter = ' '; private String textQualifier = '/''; and the the method createParser like this : public Parser createParser(Exchange exchange) throws InvalidPayloadException  IOException Unknown macro: { Reader bodyReader = ExchangeHelper.getMandatoryInBody(exchange  Reader.class); Resource resource = getResource(); if (delimiter == null || delimiter.equals(&quot;&quot;)) delimiter = &quot; &quot;; if (textQualifier == null || textQualifier.equals(&quot;&quot;)) textQualifier = &quot;&quot;&quot;; if (resource == null) { return getParserFactory().newDelimitedParser(bodyReader  delimiter.charAt(0)  textQualifier.charAt(0)); } else { return getParserFactory().newDelimitedParser(new InputStreamReader(resource.getInputStream())  bodyReader  delimiter.charAt(0)  textQualifier.charAt(0)  ignoreFirstRecord); } },0,0
JettyHttpComponent.doStop() shuts down all servers in the VM  not just those associated with the component,We are running several bundles in Karaf with separate Camel contexts  each of which uses the camel-jetty component to expose services over HTTP. Each bundle has an assigned port and may listen on multiple URIs. We noticed that when we updated or shut down one of these bundles  all of the Jetty servers in the other bundles would stop listening on their respective ports.The problem is that the map of ConnectorRef objects in JettyHttpComponent is static  and therefore shared across the entire VM. Changing this from static to an instance variable fixed the issue for us.,1,0
Archetype for creating component should have better sample component,The current sample is based on Direct component which is a bad sample as its a very special component.We should do a HelloWorldComponent the producer will just print the message body to system out the consumer is scheduled and triggers every 5th second with a dummy exchange,0,0
RouteBuilderRef should work out of the box with Spring 3 and dependency injection,Spring 3 changed internally how dependency resolution works. Its now worse as we have to play tricks in the Camel namespace handler to tell Camel the various pieces you can ref  should depend on Camel. Otherwise the dependency resolution in Spring is not working properly.This used to work like a charm in Spring 2.5.6.,0,0
Out of Heap memory issues with Camel-File processing large files,Camel-File component throws heap memory issue when processing csv file which is about 45MB with 218k Lines. http://camel.465427.n5.nabble.com/Java-heap-space-issue-with-reading-large-CSV-file-tt2638903.html#a2638903,1,0
Simple language - Allow unlimited usage of and or operators in expression,The simple language currently only allows using and or or operators once in the expression. We should allow unlimited usages of those.,0,0
Cache Component needs to check for null values during GET operations,EhCache often has a bit of lag time when invalidating expired cache elements  first setting the Element value to null and then removing the key. If you are hitting a cache rapidly one often will run across a key that is present in the cache that still has a null element entry.The logic for successfully key retrieval just needs to be slightly tweaked to check for null values.,0,0
netty timeout exception,eventhough message was received by netty procuder  it thows a timeout exception after 30 secs. here is the route and log. as this is a basic functionality I think this is critical priority. from('netty:tcp://localhost:6205?textline=true&amp;sync=true').process(new Processor() { int i=0; public void process(Exchange exchange) throws Exception { String body = exchange.getIn().getBody(String.class); Thread.sleep(5000); exchange.getOut().setBody('Bye 1' + body); // if(i++%2==1) throw new IOException('custom exception'); } }); from('file:///test/test/response') .convertBodyTo(String.class) .threads(1) .to(ExchangePattern.InOut 'netty:tcp://localhost:6205?textline=true&amp;sync=true') .to('log:+++ reply++++');2010-08-25 11:33:29 963 &#91;1 - file:///test/test/response&#93; FileConsumer DEBUG Total 1 files to consume2010-08-25 11:33:29 963 &#91;1 - file:///test/test/response&#93; FileConsumer DEBUG About to process file: GenericFile&#91;C:/test/test/response/hello1.txt&#93; using exchange: Exchange[GenericFileMessage with file: GenericFile&#91;C:/test/test/response/hello1.txt&#93;]2010-08-25 11:33:31 510 [ Camel Thread 6 - Threads] SendProcessor DEBUG &gt;&gt;&gt;&gt; Endpoint&#91;tcp://localhost:6205&#93; Exchange&#91;GenericFileMessage with body: hello1&#93;2010-08-25 11:33:31 682 [ Camel Thread 6 - Threads] NettyProducer DEBUG Creating connector to address: localhost:62052010-08-25 11:33:31 682 [ Camel Thread 6 - Threads] NettyProducer DEBUG Writing body: hello12010-08-25 11:33:31 697 [ New I/O client worker #1-1] NettyProducer DEBUG Operation complete org.jboss.netty.channel.DefaultChannelFuture@944dbd2010-08-25 11:33:31 697 [ New I/O server worker #1-1] ServerChannelHandler DEBUG Incoming message: hello12010-08-25 11:33:36 697 [ New I/O server worker #1-1] ServerChannelHandler DEBUG Writing body: Bye 1hello12010-08-25 11:33:36 697 [ New I/O client worker #1-1] ClientChannelHandler DEBUG Message received: Bye 1hello12010-08-25 11:33:36 697 [ New I/O client worker #1-1] SendProcessor DEBUG &gt;&gt;&gt;&gt; Endpoint&#91;log://+++ reply++++&#93; Exchange&#91;GenericFileMessage with body: Bye 1hello1&#93;2010-08-25 11:33:36 713 [ New I/O client worker #1-1] +++ reply++++ INFO Exchange&#91;ExchangePattern:InOut  BodyType:String  Body:Bye 1hello1&#93;2010-08-25 11:33:36 713 [ New I/O client worker #1-1] GenericFileOnCompletion DEBUG Done processing file: GenericFile&#91;C:/test/test/response/hello1.txt&#93; using exchange: Exchange&#91;GenericFileMessage with body: Bye 1hello1&#93;2010-08-25 11:33:36 713 [ New I/O client worker #1-1] FileUtil DEBUG Tried 1 to delete file: C:/test/test/response/hello1.txt.camelLock with result: true2010-08-25 11:33:36 713 [ New I/O client worker #1-1] nericFileRenameProcessStrategy DEBUG Renaming file: GenericFile&#91;C:/test/test/response/hello1.txt&#93; to: GenericFile&#91;C:/test/test/response/.camel/hello1.txt&#93;2010-08-25 11:33:36 713 [ New I/O client worker #1-1] FileUtil DEBUG Tried 1 to rename file: C:/test/test/response/hello1.txt to: C:/test/test/response/.camel/hello1.txt with result: true2010-08-25 11:34:06 886 [ Hashed wheel timer #1] DefaultErrorHandler DEBUG Failed delivery for exchangeId: f5eb372d-a214-4418-a60f-62c0557768d2. On delivery attempt: 0 caught: org.apache.camel.ExchangeTimedOutException: The OUT message was not received within: 30000 millis. Exchange&#91;GenericFileMessage with body: Bye 1hello1&#93;2010-08-25 11:34:06 886 [ Hashed wheel timer #1] DefaultErrorHandler ERROR Failed delivery for exchangeId: f5eb372d-a214-4418-a60f-62c0557768d2. Exhausted after delivery attempt: 1 caught: org.apache.camel.ExchangeTimedOutException: The OUT message was not received within: 30000 millis. Exchange&#91;GenericFileMessage with body: Bye 1hello1&#93;org.apache.camel.ExchangeTimedOutException: The OUT message was not received within: 30000 millis. Exchange&#91;GenericFileMessage with body: Bye 1hello1&#93;,0,0
BeanConveter didn't try to covert the bean invocation argument rightly,Here is the mail thread about it.http://camel.465427.n5.nabble.com/Bug-in-the-BeanConverter-class-td2653552.html#a2653552,0,0
QuartzEndpoint does not set the job name properly,Looks like the job.name argument is not se properly on the endpoint and defaults to the uri path.Another nastier issue (for which I should have probably created a separate issue) is that the uri gets messed up if it does not have the double slashes after the scheme (as in 'quartz:&lt;uri&gt;' vs 'quartz://&lt;uri&gt;') and the @cron argument contains '?'. The workaround (arguably) is to start the uri with 'quartz://...'.See nabble thread. Many thanks to SK for reporting this.,0,0
@QueryParam doesn't work for CxfBeans,Charle report an issue&#91;1&#93;  after tracing the code I found the DefaultCxfBeanBinding doesn't put the http query string into the cxf message.So the @QueryParam will not take effect on the resource beans.&#91;1&#93;http://camel.465427.n5.nabble.com/camel-cxfbean-JAX-Rs-QueryParam-td2827252.html#a2827252,0,0
hawtdb - Should work in OSGi,The decode method in ObjectCodec should wrap the causes stacktrace in the wrapped IOException.For example OSGi frameworks may be pesky and we want to be able to see whatever stacktrace it may thrown on you. public T decode(DataInput dataIn) throws IOException { int size = dataIn.readInt(); byte[] data = new byte[size]; dataIn.readFully(data); ByteArrayInputStream bytesIn = new ByteArrayInputStream(data); ObjectInputStream objectIn = new ObjectInputStream(bytesIn); try { return (T) objectIn.readObject(); } catch (ClassNotFoundException e) { throw new IOException(e.getMessage()); } }For being JDK 1.5 compatible you need to do it like public static IOException createIOException(String message  Throwable cause) { IOException answer = new IOException(message); answer.initCause(cause); return answer; },0,0
Splitter EIP - The sub exchanges should not contains on completions from original Exchange,See nabblehttp://camel.465427.n5.nabble.com/Camel-calling-commit-too-early-when-using-split-seda-file-endpoint-tp2830894p2830894.html,0,0
Performance/scalability issue for converter lookup,In a simple HTTP-&gt;HTTP proxy scenario (whith a Jetty or a servlet endpoint  that does not matter) I observe a very severe performance regression between Camel 2.2.0 (as in servicemix 4.2) and camel 2.4.0 running on a apache karaf 2.0.0 OSGi stack. On the same hardware I get a throughput of 3500 messages per second with Camel 2.2.0  but only 210 messages per second on Camel 2.4.0 (both servlet-&gt;HTTP). If I replace the http endpoint with a log endpoint the throughput will be about 1500 messages per second in both cases.I have done some profiling for this: The active CPU times as shown in the profiler remain approximately the same for both versions  however if I monitor wait times  I get very long wait times for org.apache.camel.impl.DefaultMessage.getHeader(java.lang.String java.lang.Class) calls. If I break this down I see the java.beans.PropertyEditorManager.findEditor(java.lang.Class) call in org.apache.camel.impl.converter.PropertyEditorTypeConverter.convertTo(java.lang.Class java.lang.Object). The findEditor() method is synchronized and initializes some class loading which takes some time.Why is it necessary to instantiate the type converter for each message?,0,1
polling of feeds in FeedEntryPollingConsumer is broken.,The FeedEntryPollingConsumer class implements the poll() method for the 'splitEntries' mode of the RssEndpoint is broken.You can think of two ways that polling feeds could work:1) A feed is created  then one item is processed  then the delay  then process another item. This way the feed is kept between calls to poll().2) A feed is created  then all the items are processed  the feed is cleared  and then the delay.But the way it presently works:A feed is created  one items is processed  and the feed is cleared  then the delay  and again the feed is created and the next item is cleared.This is clearly wrong. Feed entries can be missed  because the index of the next item to process is stored over polls but the list isn't. Also this creates a big network overhead when polling very active feeds such as twitter search...This is easy to fix. In the below code:public void poll() throws Exception { Object feed = createFeed(); populateList(feed); while (hasNextEntry()) { Object entry = list.get(entryIndex--); boolean valid = true; if (entryFilter != null) { valid = entryFilter.isValidEntry(endpoint  feed  entry); } if (valid) { Exchange exchange = endpoint.createExchange(feed  entry); getProcessor().process(exchange); // return and wait for the next poll to continue from last time (this consumer is stateful) return; } }The return (at line 56 of org.apache.camel.component.feed.FeedEntryPollingConsumer) should be deleted.,0,1
Using $ in endpoint uri causes thread name parser to fail,See nabblehttp://camel.465427.n5.nabble.com/How-to-specify-route-to-folder-with-in-actual-name-tp2839895p2839895.html,0,0
Support user-defined shutdown timeout for CamelTestSupport,Would be nice if CamelTestSupport could allow user to define the Shutdown timeout of CamelContext.We at Neociclo are finding difficult to debug through JUnit tests because of the hard-coded 10s timeout.public void setUp() ... { ... context = createCamelContext(); assertValidContext(context); // reduce default shutdown timeout to avoid waiting for 300 seconds&#8211; context.getShutdownStrategy().setTimeout(10);++ context.getShutdownStrategy().setTimeout(getShutdownTimeout()); ...}+ protected int getShutdownTimeout() {+ return 10;+ },0,0
cxfbean creates another instance of the class instead of directly using the referenced bean,... this makes it impossible to inject properties to the @WebService class&lt;camelContext&gt; &lt;route&gt; &lt;from uri='....' /&gt; &lt;to uri='cxfbean:handler' /&gt; &lt;/route&gt;&lt;/camelContext&gt;&lt;bean id='handler' class='a.b.c.Handler'&gt; &lt;property name='prop1' value='5' /&gt;&lt;/bean&gt;when 'handler' is created by Spring  its 'prop1' is set to '5'when the cxfbean:handler is triggered  the 'prop1' is null  because CXF created another instance of Handler instead of using the one created by Spring,0,0
Use ActiveMQUuidGenerator as the default uuid generator as its faster than the JDK UUID generator,The Java UUID is too slow. Switching back to AMQ based will improve performance.We should just have to switch to use the JDK UUID for the camel-gae component as it cannot use the AMQ based.,0,1
Context-sensitive setting of default UuidGenerator,Use JavaUuidGenerator in GAE environment  otherwise use ActiveMQUuidGenerator as default UuidGenerator.,0,0
Route autoStartup configurable through Property,Using Camel 2.4 I want to make the usage of a certain route configurable through properties. &lt;camelContext id='camel' trace='true' xmlns='http://camel.apache.org/schema/spring'&gt; &lt;route id='configurable_1' autoStartup='{{startup_1}}'&gt; &lt;from uri='direct:start_1'/&gt; &lt;to uri='mock:end_1'/&gt; &lt;/route&gt; &lt;route id='configurable_2' autoStartup='{{startup_2}}'&gt; &lt;from uri='direct:start_2'/&gt; &lt;to uri='mock:end_2'/&gt; &lt;/route&gt;&lt;/camelContext&gt;But if I do use the PropertyPlaceholder on the CamelContext like below it works. &lt;camelContext id='camel' trace='true' autoStartup='{{startup_context}}'So is this a bug or should this work this way?,0,0
OsgiDefaultCamelContext.getTypeConverterRegistry() returns null,The showed up when using dozer as shown in http://camel.apache.org/dozer-type-conversion.html  whose DozerTypeConverterLoader tries to get the type converter registry using: {{{TypeConverterRegistry registry = camelContext.getTypeConverterRegistry();}}}Plausible error:OsgiDefaultCamelContext.java @Override protected TypeConverter createTypeConverter() { return new OsgiTypeConverter(bundleContext  getInjector()); }DefaultCamelContext.javapublic TypeConverterRegistry getTypeConverterRegistry() { if (typeConverterRegistry == null) { // init type converter as its lazy if (typeConverter == null) { getTypeConverter(); } // type converter is usually the default one that also is the registry if (typeConverter instanceof DefaultTypeConverter) { typeConverterRegistry = (DefaultTypeConverter) typeConverter; } } return typeConverterRegistry; }Error:getTypeConverter() returns an OsgiTypeConverter OsgiTypeConverter does not inherit from DefaultTypeConverter  thus the instanceof returns false=&gt; null is returnedSolution:Lots of different ways to do this  and it's getting late here. In this case  maybe it's OsgiDefaultCamelContext's responsibility to also override getTypeConverterRegistry with something along the lines of:@Overridepublic TypeConverterRegistry getTypeConverterRegistry() { if (typeConverterRegistry == null) { // init type converter as its lazy if (typeConverter == null) { getTypeConverter(); } // type converter is usually the default one that also is the registry if (typeConverter instanceof OsgiDefaultTypeConverter) { typeConverterRegistry = ((OsgiDefaultTypeConverter) typeConverter).getRegistry(); } } return typeConverterRegistry; }We've employed an (ugly) workaround in a local version of DozerTypeConverterLoader.java: TypeConverter typeConverter = camelContext.getTypeConverter(); DefaultTypeConverter registry = null; if (typeConverter instanceof DefaultTypeConverter) { registry = (DefaultTypeConverter)typeConverter; } else if (typeConverter instanceof OsgiTypeConverter) { OsgiTypeConverter osgiTypeConverter = (OsgiTypeConverter)typeConverter; registry = osgiTypeConverter.getRegistry(); },0,0
camel-ftp: fileExist=Fail not honored when producer works in FTP root path,when using a route with ftp producer such as : &lt;to uri='ftp://user@host/?fileExist=Fail&amp;fileName=test&amp;password=mypass' /&gt;The route will not correctly fail if the fileName already exists.It will work in any sub-directory: &lt;to uri='ftp://user@host/mydir?fileExist=Fail&amp;fileName=test&amp;password=mypass' /&gt;The root cause of the bug is an incorrect test in org.apache.camel.util.FileUtil.onlyPath() in component camel-core.This method returns null when the parameter string is '/'. It should return '/'.The attached patch fixes the issue.,0,0
Aggregator EIP - Add option to ignore timeout completed,See nabblehttp://camel.465427.n5.nabble.com/Aggregator-Howto-remove-from-persistency-tp2852702p2852702.html&gt; I was thinking about something like a removeOnTimeout (default=false of&gt; course) that would use the existing completionTimeout attribute but change&gt; its behavior to remove the aggregated message instead of publishing it.&gt; &#8211;Yeah I can kinda see an use case for this. You are using the timeoutas a last resort to just say hey we could not aggregate this in letssay 4 hours.So lets just ignore the message.Having an option on the aggregate to just auto discard those messageon timeout would help there to avoid the CBR and checking yourself.Just wondering if this is a use case others use? Its still kindadangerous to discard messages.,0,0
Add alternative start token for simple language to avoid clash with Spring PropertyPlaceholder,When using Spring property placeholders it will scan for ${ } tokens  which is the same set the Camel Simple language uses.This makes it harder to configure file endpoints where the file name is a simple expression because Spring interferes.So by introducing the $simple{ as alternative start token  we can avoid the clash.,0,0
camel-ftp - Setting password and username using UserInfo on uri does not work,You should be able to set ftp endpoint uri as:'ftp://scott@localhost:' + getPort() + '/deletefile?password=tiger&amp;binary=false&amp;delete=true'And when using password and username in the userinfo part of the uri:'ftp://tiger:scott@localhost:' + getPort() + '/deletefile?binary=false&amp;delete=true'The latter didn't work,0,0
Confusing IllegalArgumentException when address attribute isn't specified on CXF endpoint.,If you create CXF endpoint  like this  without the address attribute   &lt;cxf:cxfEndpoint id='greeting' wsdlURL='greeting.wsdl' serviceClass='tutorial.hanbo.webservice.Greeting' &gt; &lt;/cxf:cxfEndpoint&gt; ... then you get a really confusing error when you deploy the endpoint in ServiceMix: the error is Caused by: java.lang.IllegalArgumentException: endpointUri is not specified and org.apache.camel.component.cxf.CxfSpringEndpoint does not implement createEndpointUri() to create a default value at org.apache.camel.impl.DefaultEndpoint.getEndpointUri(DefaultEndpoint.java:83) at org.apache.camel.management.DefaultManagementLifecycleStrategy.onEndpointAdd(DefaultManagementLifecycleStrategy.java:205) at org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:386) We find that if you explicitly set the address then the problem goes away (see below) &lt;cxf:cxfEndpoint id='greeting' wsdlURL='greeting.wsdl' address='http://localhost:9000/GreeterContext/SOAPMessageService' serviceClass='tutorial.hanbo.webservice.Greeting' &gt; &lt;/cxf:cxfEndpoint&gt; On camel-cxf web page  the 'address' attribute is not mentioned anywhere in the table of URI properties  so you might be lead to believe that it's not necessary.,0,0
Concurrent consumers on seda endpoint can cause content routing to mismatch,When consuming concurrently from a seda endpoint  when the route contains a content router based on the header  it will randomly route through the wrong choice.In my specific case  I was consuming from an activemq queue  which would receive messages with a header that would then determine which route it would follow. It would randomly send messages down the wrong path. When I turned on tracing  it would behave itself. It also behaved itself when I limited it to only a single consumer. I was  however  able to duplicate it with the unit test below. Due to the concurrency issue  the test can occasionally pass  but run it a couple times and it should fail. It'll either receive 2 messages when it should have only gotten 1  or it will get no messages when it should have gotten 1.ConcurrencyTest.javaimport org.apache.camel.EndpointInject;import org.apache.camel.Produce;import org.apache.camel.ProducerTemplate;import org.apache.camel.builder.RouteBuilder;import org.apache.camel.component.mock.MockEndpoint;import org.apache.camel.test.CamelTestSupport;public class ConcurrencyTest extends CamelTestSupport { @EndpointInject(uri = 'mock:result') protected MockEndpoint resultEndpoint; @EndpointInject(uri = 'mock:otherResult') protected MockEndpoint otherResultEndpoint; @Produce(uri = 'seda:start') protected ProducerTemplate template; public void testSendMatchingMessage() throws Exception { String expectedBody = '&lt;matched/&gt;'; resultEndpoint.expectedBodiesReceived(expectedBody); otherResultEndpoint.expectedBodiesReceived(expectedBody); template.sendBodyAndHeader(expectedBody  'myDirection'  'send'); template.sendBodyAndHeader(expectedBody  'myDirection'  'received'); resultEndpoint.assertIsSatisfied(); } @Override protected RouteBuilder createRouteBuilder() { return new RouteBuilder() { public void configure() { from('seda:start?concurrentConsumers=10')// from('seda:start?concurrentConsumers=1') .choice() .when(header('myDirection').isEqualTo('send')).to('mock:result') .when(header('myDirection').isEqualTo('received')).to('mock:otherResult'); } }; }},1,0
request/reply over JMS using temporary queues - if connection lost the temporary queue is not re-created which causes the producer to not work anymore,To recreate the problem you need a route with a jms inout endpoint that is configured to use a temporary destination for replies. Till now I was only able to show the problem with tibco ems. Start broker Start the jms consumer that replies to the request Start the route Send a request/reoply exchange (should work) Stop the broker Wait long enough for the client to do a full reconnect (I used connectionFactory.setReconnAttemptCount(1) on the client so I do not have to wait so long) Start the broker -&gt; The jms component will do a full new connect Send a request/reoply exchange -&gt; Now a InvalidDestination Exception happensThe client route will not work anymore until a restart as it creates the temporary destination only once and it is invalid now.,0,0
The CxfConsumer's getContinuation method might throw NPE,HelloWhen trying the latest CAMEL 2.5.0 SNAPSHOT  I got a NPE:java.lang.NullPointerException at org.apache.camel.component.cxf.CxfConsumer$1.getContinuation(CxfConsumer.java:129) at org.apache.camel.component.cxf.CxfConsumer$1.invoke(CxfConsumer.java:65) at org.apache.cxf.interceptor.ServiceInvokerInterceptor$1.run(ServiceInvokerInterceptor.java:58) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)...,0,0
Add Exchange creation time to the exchange as property,Sometimes it would be really nice to access the exchange creation time from a processor. This can be of use for many tasks  like statistics etc.,0,0
Threads - Should allow using 0 in core pool size,See nabblehttp://camel.465427.n5.nabble.com/ThreadPoolExecutor-configuration-tp3207845p3207845.html,0,0
Route definitions should use boxed types and lazy evaluate defaults in the getter,When you output a route definition as XML then all the boolean types and whatnot get outputted using their default values.For example inheritErrorHandler=true.This reduces the XML and keeps it much smaller.,0,0
GenericFileProducer.writeFile method creates instance of un-used InputStream,org.apache.camel.component.file.GenericFileProducerMethod: writeFileThis method has the following statement:InputStream payload = exchange.getIn().getBody(InputStream.class);This internally results in calling a TypeConverter to convert an object into InputStream type. However this InputStream has not been used and is eventually closed in the finally block. In the same method calling method storeFile on FileOperations (boolean success = operations.storeFile(fileName  exchange) also opens an InputStream on the same message.,0,0
JMX MBeans not registered for initiators,registering the Initiator before it has been started will not register the sessions mbeans with JMX. So the acceptors are ther  but no initiators.,0,0
XmppEndPoint - setting login to false when creating an account results in no action,XmppEndPoint myXmppEndPoint = new XmppEndPoint();(...)myXmppEndPoint.setCreateAccount(true);myXmppEndPoint .setLogin(false);(...)This will result in 'no action' in xmpp server  if setLogin true the account is created and the user stays online.I believe it's because of the logic used in createConnection() method of XmppEndPoint that could be changed to:if (!connection.isAuthenticated()) { if (user != null) { if (LOG.isDebugEnabled()) { LOG.debug('Logging in to XMPP as user: ' + user + ' on connection: ' + getConnectionMessage(connection)); } if (password == null) { LOG.warn('No password configured for user: ' + user + ' on connection: ' + getConnectionMessage(connection)); } if (createAccount) { AccountManager accountManager = new AccountManager(connection); accountManager.createAccount(user  password); } if(login){ if (resource != null) { connection.login(user  password  resource); } else { connection.login(user  password); } } } else { if (LOG.isDebugEnabled()) { LOG.debug('Logging in anonymously to XMPP on connection: ' + getConnectionMessage(connection)); } connection.loginAnonymously(); },0,0
RetryWhile is missing on the errorHandler DSL,You can only use retryWhile on the onException. It should be possible from errorHandler as well.,0,0
Let LazyLoadingTypeConverter load the converters from camel-core on startup,When using lazy loading type converter and Spring XML you will trigger the type converters to be loaded on startup due XML configuration needs to convert from String -&gt; other types etc.So we should let Camel always load the type converters from camel-core as they are essential. Then the package scanning converters can be loaded on demand later.,0,0
support the Ordered Interceptor Strategy configured in spring,Now spring support user to configure their own Interceptor Strategy  but it cannot specifiy the wrap order of the interceptor strategy.So we need to support a feature to let the user define the interceptor's order:user can choice to implement the org.apache.camel.util.Ordered interface for the customed interceptor strategy ;if the interceptor strategy does support a Ordered interface  the camel context will loaded the interceptor-strategies and wrapper the process by the order;For example if I write two interceptor-strategy(A   B)  if A's order is 0  and B's order is 1. the camel will always wrapper the processor as {A{B{Processor}}.,0,0
CaseInsensitiveMap concurrency issue,&#91;10/25/2010 -:- 03:27:22 PM&#93; &lt;tarjei&gt; cibsen: I get a few of these errors on a route using SEDA queues:&#91;10/25/2010 -:- 03:27:43 PM&#93; &lt;tarjei&gt; Caused by: &#91;java.util.ConcurrentModificationException - null&#93;&#91;10/25/2010 -:- 03:27:44 PM&#93; &lt;tarjei&gt; java.util.ConcurrentModificationException&#91;10/25/2010 -:- 03:27:44 PM&#93; &lt;tarjei&gt; at java.util.HashMap$HashIterator.nextEntry(HashMap.java:810)&#91;10/25/2010 -:- 03:27:44 PM&#93; &lt;tarjei&gt; at java.util.HashMap$EntryIterator.next(HashMap.java:851)&#91;10/25/2010 -:- 03:27:44 PM&#93; &lt;tarjei&gt; at java.util.HashMap$EntryIterator.next(HashMap.java:849)&#91;10/25/2010 -:- 03:27:46 PM&#93; &lt;tarjei&gt; at org.apache.camel.util.CaseInsensitiveMap.entrySet(CaseInsensitiveMap.java:120)&#91;10/25/2010 -:- 03:27:49 PM&#93; &lt;tarjei&gt; at org.apache.camel.util.CaseInsensitiveMap.putAll(CaseInsensitiveMap.java:86)&#91;10/25/2010 -:- 03:27:51 PM&#93; &lt;tarjei&gt; at org.apache.camel.impl.MessageSupport.copyFrom(MessageSupport.java:142)&#91;10/25/2010 -:- 03:27:54 PM&#93; &lt;tarjei&gt; at org.apache.camel.impl.DefaultMessage.copyFrom(DefaultMessage.java:52)&#91;10/25/2010 -:- 03:27:56 PM&#93; &lt;tarjei&gt; at org.apache.camel.util.ExchangeHelper.copyResults(ExchangeHelper.java:215)&#91;10/25/2010 -:- 03:27:59 PM&#93; &lt;tarjei&gt; at org.apache.camel.processor.Pipeline.process(Pipeline.java:128)&#91;10/25/2010 -:- 03:28:01 PM&#93; &lt;tarjei&gt; at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:99)&#91;10/25/2010 -:- 03:28:05 PM&#93; &lt;tarjei&gt; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:70)&#91;10/25/2010 -:- 03:28:08 PM&#93; &lt;tarjei&gt; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;10/25/2010 -:- 03:28:11 PM&#93; &lt;tarjei&gt; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;10/25/2010 -:- 03:28:14 PM&#93; &lt;tarjei&gt; at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:68)&#91;10/25/2010 -:- 03:28:17 PM&#93; &lt;tarjei&gt; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:70)&#91;10/25/2010 -:- 03:28:20 PM&#93; &lt;tarjei&gt; at org.apache.camel.component.seda.SedaConsumer.sendToConsumers(SedaConsumer.java:170)&#91;10/25/2010 -:- 03:28:23 PM&#93; &lt;tarjei&gt; at org.apache.camel.component.seda.SedaConsumer.run(SedaConsumer.java:112)&#91;10/25/2010 -:- 03:28:25 PM&#93; &lt;tarjei&gt; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&#91;10/25/2010 -:- 03:28:28 PM&#93; &lt;tarjei&gt; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&#91;10/25/2010 -:- 03:28:31 PM&#93; &lt;tarjei&gt; at java.lang.Thread.run(Thread.java:636)&#91;10/25/2010 -:- 03:28:34 PM&#93; &lt;tarjei&gt; It seems to me to be an error completely within Camel so I thought I'd report it.&#91;10/25/2010 -:- 03:30:26 PM&#93; &lt;tarjei&gt; I got the error about 10/30 times having run about 5m messages through the different routes running in that jvm&#91;10/25/2010 -:- 03:51:36 PM&#93; &lt;cibsen&gt; and do your prod server have more cpu cores?&#91;10/25/2010 -:- 03:51:42 PM&#93; &lt;cibsen&gt; ibm  sun jdk?&#91;10/25/2010 -:- 03:51:51 PM&#93; &lt;tarjei&gt; Yes - 4. This is openjdk&#91;10/25/2010 -:- 03:51:54 PM&#93; &lt;tarjei&gt; both places&#91;10/25/2010 -:- 03:52:03 PM&#93; &lt;cibsen&gt; what os?&#91;10/25/2010 -:- 03:52:22 PM&#93; &lt;tarjei&gt; Centos 5&#91;10/25/2010 -:- 03:52:36 PM&#93; &lt;cibsen&gt; yeah kinda figured when you said openjdk&#91;10/25/2010 -:- 03:53:06 PM&#93; &lt;tarjei&gt; 1.6.0-17,0,0
Multicast with pipeline may cause wrong aggregated exchange,This is a problem when using 2 set of nested pipeline and doing a transform as the first processor in that pipeline from('direct:start').multicast(new SumAggregateBean()) .pipeline().transform(bean(IncreaseOne.class)).bean(new IncreaseTwo()).to('log:foo').end() .pipeline().transform(bean(IncreaseOne.class)).bean(new IncreaseTwo()).to('log:bar').end() .end() .to('mock:result');,0,0
Let custom Processor be managed in JMX when implementing ManagementAware,See nabblehttp://camel.465427.n5.nabble.com/manage-Camel-Processor-using-JMX-tp3235454p3235454.html,0,0
Multiple Endpoints with the Same Port in Restlet Component,It should be possible to have several endpoints using the same port  the more it takes to rely on a HTTP server external to the component.,0,0
Add exception.stacktrace to Simple language,So you can output the stracktrace. It should grab the stacktrace and print it to a String as output.,0,0
Stepwise change of directory unfit for production (ftp/ftps/sftp),In Camel 2.5  the logic for changing directory for ftp/ftps/sftp has changed in order to fix the problems discussed in the following thread: http://camel.465427.n5.nabble.com/How-to-change-directory-while-using-sftp-component-td2806817.html#a2807611In Camel 2.5 changing of the remote directory is now done in a stepwise manner. This is a strategy not fit for production since it assumes that the logged in ftp/ftps/sftp user has access to all intermediate directories all the way down to its home directory. This is rarely the case.Also  when testing ftp/sftp on Serv-U  a Windows based ftp/ftps/sftp server  it turns out that it reports the current directory in a 'Windows way'  e g /C:/temp/servu/user/sample/file2sftp. The topmost folder is not '/' but '/C:'. This also breaks the new stepwise way of changing directory since it always tries to change to '/' if an absolute path is used.I propose to introduce a configuration property to enable/disable stepwise changing of directories where disabling it should be the default. I will upload a patch shortly.,0,0
cxfEndpoint of camel-cxf doesn't support  the shcemaLocation element,Here is the mail thread&#91;1&#93; which discusses about it.&#91;1&#93;http://camel.465427.n5.nabble.com/camel-cxf-exception-when-parsing-cxf-schemaLocation-element-td3253254.html#a3253254,0,0
NPE occurs without @Entity annotation,Here is code from the org.apache.camel.component.jpa.JpaConsumer classprotected String getEntityName(Class&lt;?&gt; clazz) { Entity entity = clazz.getAnnotation(Entity.class); // Check if the property name has been defined for Entity annotation if (!entity.name().equals('')) { // line 307 return entity.name(); } else { return null; }}When trying to consume entities from jpa endpoint exception occursjava.lang.NullPointerException at org.apache.camel.component.jpa.JpaConsumer.getEntityName(JpaConsumer.java:307) at org.apache.camel.component.jpa.JpaConsumer.createQueryFactory(JpaConsumer.java:287) at org.apache.camel.component.jpa.JpaConsumer.getQueryFactory(JpaConsumer.java:196) at org.apache.camel.component.jpa.JpaConsumer$1.doInJpa(JpaConsumer.java:83) at org.apache.camel.component.jpa.JpaTemplateTransactionStrategy$1$1.doInJpa(JpaTemplateTransactionStrategy.java:82) at org.springframework.orm.jpa.JpaTemplate.execute(JpaTemplate.java:183) at org.springframework.orm.jpa.JpaTemplate.execute(JpaTemplate.java:146) at org.apache.camel.component.jpa.JpaTemplateTransactionStrategy$1.doInTransaction(JpaTemplateTransactionStrategy.java:80) at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:130) at org.apache.camel.component.jpa.JpaTemplateTransactionStrategy.execute(JpaTemplateTransactionStrategy.java:78) at org.apache.camel.component.jpa.JpaConsumer.poll(JpaConsumer.java:79) at org.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:98) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:317) at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:150) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:98) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:181) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:205) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:619)This is because there is no @Entity annotation and persistence is configured by means of orm.xml.To fix the problem change line 307 toif (entity != null &amp;&amp; !entity.name().equals('')),0,0
Quartz component has minor issues with old versions of Quartz,HelloI have run into two issues using camel-quartz with old versions of Quartz (Quartz 1.6 and 1.7):1. With Quartz 1.6  at shutdown  I get a message:2010-11-12 02:41:22 965 DefaultShutdownStrategy.shutdownNow Error occurred while shutting down route: Consumer[quartz://importAnnuaireAgentsTimer?cron=0+30+2+*+*+%3F]. This exception will be ignored.java.lang.NoSuchMethodError: org.quartz.SchedulerMetaData.isJobStoreClustered()Z at org.apache.camel.component.quartz.QuartzComponent.isClustered(QuartzComponent.java:278) at org.apache.camel.component.quartz.QuartzComponent.removeJob(QuartzComponent.java:238) at org.apache.camel.component.quartz.QuartzEndpoint.removeTrigger(QuartzEndpoint.java:84) at org.apache.camel.component.quartz.QuartzEndpoint.consumerStopped(QuartzEndpoint.java:221) at org.apache.camel.component.quartz.QuartzConsumer.doStop(QuartzConsumer.java:44) at org.apache.camel.impl.ServiceSupport.stop(ServiceSupport.java:98) at org.apache.camel.impl.ServiceSupport.stop(ServiceSupport.java:122) at org.apache.camel.util.ServiceHelper.stopService(ServiceHelper.java:99) at org.apache.camel.impl.DefaultShutdownStrategy.shutdownNow(DefaultShutdownStrategy.java:235) at org.apache.camel.impl.DefaultShutdownStrategy$ShutdownTask.run(DefaultShutdownStrategy.java:386) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303) at java.util.concurrent.FutureTask.run(FutureTask.java:138) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:619)2. Starting of a delayed timer fails. I think warning the user would be a better idea.Patch is attached (it basically catches the NoSuchMethodError exceptions and acts accordingly),0,0
CxfRsInvoker produces NullpointerException when no ContinuationProvider is set in the InMessage,In my usage of CXF-RS with Camel through the camel-cxf component I ran into a NullpointerException  the specific case is described in some detail on StackOverflow: http://stackoverflow.com/questions/4198461/why-do-i-get-a-nullpointerexception-when-invoking-the-cxf-rs-endpoint-of-a-camel Specifically I run into a NullpointerException:Caused by: java.lang.NullPointerException at org.apache.camel.component.cxf.jaxrs.CxfRsInvoker.getContinuation(CxfRsInvoker.java:63) at org.apache.camel.component.cxf.jaxrs.CxfRsInvoker.performInvocation(CxfRsInvoker.java:52) at org.apache.cxf.service.invoker.AbstractInvoker.invoke(AbstractInvoker.java:89) ... 33 moreI was assuming I was misconfiguring something but didn't find any alternative way so I started digging in the camel-cxf source code.I found that such a 'getContinuation' method also exists for the org.apache.camel.component.cxf.CxfConsumer as well as for the CxfRsInvoker (where it was failing for me). However in the case of the CxfConsumer there is a guard on the ContinuationProvider so that if it is null  then null is returned:return provider == null ? null : provider.getContinuation();CxfRsInvoker does not have this guard  but it does have code to deal with a 'null' Continuation at the calling site (line 52  in performInvocation). Therefore I assumed this was a bug and patched the guard into the CxfRsInvoker as well.My program now seems to work correctly. I assume this is a bug.For completeness sake  this is what getContinuation now looks like for me: private Continuation getContinuation(Exchange cxfExchange) { ContinuationProvider provider = (ContinuationProvider)cxfExchange.getInMessage().get(ContinuationProvider.class.getName()); return provider == null ? null : provider.getContinuation(); },0,0
camel-irc component silently fails on nick collision,When the camel-irc component connects to an irc server and there's a nick collision it silently fails. Also note there is no camel-irc component in Jira.,0,0
Hard coded locale in Bindy DatePatternFormat,As reported by a user from the community (http://camel.465427.n5.nabble.com/Bindy-Dateformat-Parsing-exception-td3276981.html)  the locale of SimpeDateFormat in bindy's DatePatternFormat class is hard coded to FRANCE.,0,0
Add option on FTP component so you can set which path separator char to use (eg windows vs unix),For example if you use a windows platform and want to upload files to a remote linux FTP server  and the FTP server don't understand path separators using either / or / char,0,0
spring-integration - Should have better configuration validation,See nabblehttp://camel.465427.n5.nabble.com/Integration-camel-and-spring-integration-tp3284105p3284105.html,0,0
PackageHelper - issue with version numbers which contains non decimal,See more herehttp://fusesource.com/forums/thread.jspa?threadID=2447&amp;tstart=0,0,0
Tidying up strategy for managing resources in JMX,The management strategy should be1) use ManagementAware if implemented on bean2) use @ManagedResource if provided on bean3) otherwise use defaultConsider using fallback from 1-&gt;2 which is the current behavior. If we change this we will break backwards compatibility.But in essence we should had Camel fail if (1) cannot be registered  and not just fallback to use (2) as it does today.,0,0
Use ServiceMix guice bundle,In order to avoid to go on the googlecode maven repository  I provided a ServiceMix OSGi bundle for guice.This bundle could be used by Camel in the Karaf features descriptor.,0,0
InterceptSendToEndpoint should check for if stop DSL has been used,See nabblehttp://camel.465427.n5.nabble.com/InterceptSendToEndpoint-Http-Component-tp3296620p3296620.html,1,0
DefaultTimeoutMap should force scheduler in contructor,See nabblehttp://camel.465427.n5.nabble.com/Do-I-have-to-give-a-ScheduledExecutorService-instance-when-initializing-DefualtTimeoutMap-tp3298252p3298252.html,0,0
CamelContext is started twice when using camel-blueprint,For example if you run the testRouteWithAllComponents test in CamelBlueprintTest in tests/camel-itest-osgi you will see a lot of logging. But notice[RMI TCP Connection(1)-10.0.1.2] INFO org.apache.camel.core.osgi.OsgiDefaultCamelContext - Apache Camel 2.6-SNAPSHOT (CamelContext: 67-camel-2) is starting[RMI TCP Connection(1)-10.0.1.2] INFO org.apache.camel.core.osgi.OsgiDefaultCamelContext - Apache Camel 2.6-SNAPSHOT (CamelContext: 67-camel-2) started in 0.147 secondsThen blueprint does something[Blueprint Extender: 3] INFO org.apache.camel.blueprint.BlueprintCamelContext - Apache Camel 2.6-SNAPSHOT (CamelContext: 4-camel-5) is starting[Blueprint Extender: 3] INFO org.apache.camel.blueprint.BlueprintCamelContext - Apache Camel 2.6-SNAPSHOT (CamelContext: 4-camel-5) started in 0.071 secondsAnd likewise both CamelContext's is shutdown when the test completes. There are logging events for that as well.Pay attention to the name of the 1st CamelContext 67-camel-2. This is the correct name as its based on the bundle id  our end user Camel application is given. This ensures that the CamelContext from his application has a name which is unique and refers to the bundle id as well.Now if you look at the 2nd CamelContext being started its given another name 4-camel-5. That id is most likely using a shared bundle id with a low number. For example camel-blueprint or camel-core bundle  or something like that. In essence camel-blueprint should only create one CamelContext and it should use the 67-camel-2 as the name of the CamelContext (eg. include the bundle id of the end user application).,0,0
InterceptSendToEndpoint has issues with interception http endpoints which has multiple parameters,See nabblehttp://camel.465427.n5.nabble.com/interceptSendToEndpoint-with-dynamic-endpoint-tp3301978p3301978.htmlThe issue is when any endpoints have parameters which may be re-ordered when the endpoint is normalized.,0,0
DataFormat - Support for CamelContextAware injection and start/stop callbacks with Service,This allows custom DataFormat to do any initialization logic in start and stop methods from Service.Also they will get access to CamelContext by implementing CamelContextAware,0,0
Bindy should support clipping fields if they exceed maximum length allowed when using fixed length,Adding a new option to bindy annotation /** * Indicates to clip data in the field if it exceeds the allowed length when using fixed length. */ boolean clip() default false;Then if enabled it will clip the data so it can fit the length.Also now Camel throws an exception if the data is too long and you have clip set as false.,0,0
Camel-XMPP Consumer doesn't pass XMPP headers,XMPP Consumer should pass XMPP headers as message headers  just like XMPP Producer accepts message headers as XMPP headers.,0,0
NotifyBuilder - Should throw exception if it hasn't been created and matches is invoked,This helps use of NotifyBuilder as matches doesn't operate until you have created the notifier.,0,0
Some of JpaTraceEventMessage's attributes require @Lob annotation,JpaTraceEventMessage has a bunch of String attributes defined. Applying no annotations on String attributes of an @Entity result in generated database columns with a constrained length (e.g.  using EclipseLink and MySQL  a String attribute of an @Entity is mapped to a VARCHAR(255) field).Several values of JpaTraceEventMessage are probably carrying values larger than 255 characters. Using JPAs @Lob annotation tackles this problem by generating (C)LOB fields. The attached patch defines the @Lob annotation on attributes which are expected to carry such large values.,0,0
BindyCsvDataFormat broken for pipe delimited files,Attempting to unmarshall a pipe delimited CSV file into a POJO using Bindy causese the first and last character the the line processed to be dropped. It appears that the BindyCsvDataFormat class removes the first and the last character from the line read from the CSV if the seperator is &gt; 1 characters in length (see below or line 162-165 in BindyCsvDataFormat). For pipe delimited files  you need to specify | as the seperator  as | is not evaluated correctly as a java regex by the split fuction. This leads to the first and last character for the line being parsed being dropped. From the comments it appears a 'fix' was added to remove the first and last character of the line when the seperator contains quotes or double quotes. Making this determination using the length of the seperator  rather than evaluating using a regex seems to be a poor solution that breaks other CSV delimiters.See Attached for an code example.,0,0
ConcurrentModificationException in DefaultCamelContext.removeRouteDefinitions(),I get the following exception in DefaultCamelContext.removeRouteDefinitions(). We are removing route definitions from multiple threads. I see synchronization in various other methods  but not this one. Caused by: java.util.ConcurrentModificationException at java.util.AbstractList$Itr.checkForComodification(AbstractList.java:372) at java.util.AbstractList$Itr.next(AbstractList.java:343) at java.util.AbstractCollection.removeAll(AbstractCollection.java:336) at org.apache.camel.impl.DefaultCamelContext.removeRouteDefinitions(DefaultCamelContext.java:588),0,0
Additional TypeConverters,Add TypeConverters to scala.xml.Elem from String  DOM Document  and DOM Node.,0,0
scala - xpath not working together with choice/when,When using the Scala DSL  xpath expressions inside when() do not work as expected. As an example: 'direct:a' ==&gt; { choice { when (xpath('//hello')) to ('mock:english') when (xpath('//hallo')) { to ('mock:dutch') to ('mock:german') } otherwise to ('mock:french') } }// Send messages'direct:a' ! ('&lt;hello/&gt;'  '&lt;hallo/&gt;'  '&lt;hellos/&gt;')Here we should receive 1 message in each of the mocks. For whatever reason  all 3 messages go to mock:english. Similar routes work as expected with the Java DSL.,0,0
classpath problem with camel:dot and provided dependencies,camel:dot in is failing with a class not found exception when the application context instantiates a class in a jar with provided scope.If in your maven project you have: &lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;servlet-api&lt;/artifactId&gt; &lt;version&gt;2.5&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt;and in your application context there is  for example  a subclass of ServletContextListener  mvn camel:dot fails with:...Caused by: java.lang.ClassNotFoundException:javax.servlet.ServletContextListener at java.net.URLClassLoader$1.run(URLClassLoader.java:217) at java.security.AccessController.doPrivileged(Native Method) at java.net.URLClassLoader.findClass(URLClassLoader.java:205) at java.lang.ClassLoader.loadClass(ClassLoader.java:321) at java.lang.ClassLoader.loadClass(ClassLoader.java:266) ... 92 moreIf you change it to: &lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;servlet-api&lt;/artifactId&gt; &lt;version&gt;2.5&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt; &lt;/dependency&gt;then camel-maven-plugin correctly generates the output. The fact isthat the servlet-api jar must not be included in the final war.I don't know the correct way to fix this. One option would be to add the includePluginDependencies option in the plugin and add the provided jars as runtime dependencies of the plugin.The other  very easy to implement  option would be to change the requiresDependencyResolution from runtime to test.The third option would be to make the requiresDependencyResolution configurable.Attached is a patch for the 2nd option (lazy me).,0,0
Aggregation fails to call onComplete for exchanges if the aggregation is after a bean or process.,When creating a route that contains an aggregation  if that aggregation is preceded by a bean or process  it will fail to call AggregateOnCompletion.onComplete(). I've attached a unit test that can show you the behavior. Trace level loggging will need to be enabled to see the difference. With the call to the bean  it won't show the following log entry:TRACE org.apache.camel.processor.aggregate.AggregateProcessor - Aggregated exchange onComplete: Exchange[Message: ab]If you remove the bean call  it'll start calling onComplete() again.What I've noticed is that if this call is not made  it ends up in a memory leak since the inProgressCompleteExchanges HashSet in AggregateProcessor never has any exchange ID's removed.,0,1
PollingConsumerPollStrategy - Add information to commit how many messages was polled,See nabblehttp://camel.465427.n5.nabble.com/how-to-find-out-if-a-ftp-file-consumer-has-finished-reading-all-files-available-tp3337532p3337532.htmlHaving the number of messages polled allows end users to react accordingly. For example if there is 0 then they can do something special.,0,0
Jt400DataQueueConsumer incorrectly implements timeout semantics (jt400 component),Jt400DataQueueConsumer implementation of receive(long) passes the timeout argument directly to com.ibm.as400.access.DataQueue.read(int)  not performing unit conversion. However  Jt400DataQueueConsumer.receive(long) accepts milliseconds  whereas DataQueue.read(int) accepts seconds as the time unit.Also  invoking Jt400DataQueueConsumer.receive() results in a call to DataQueue.read()  which is not a blocking call; on the contrary  it will not wait for entries.Code snippet below.Jt400DataQueueConsumer.java DataQueue queue = endpoint.getDataQueue(); try { DataQueueEntry entry; if (timeout &gt;= 0) { entry = queue.read((int)timeout); } else { entry = queue.read(); }Note that the submitted patch floors the timeout value when converting to seconds  but different rounding might be desired  which should be specified in the class documentation.,0,0
camel-jms - Improve logic waiting for ReplyTo destination to be computed when doing request/reply,When you use request/reply over JMS a JMSReplyTo destination must be computed which happens async by the MessageListenerContainer which is to listen for the replies.The currently logic uses some low-level thread wait/notify scheme.We should change that to use the concurrency API using a countdown latch. That's much better.,0,0
Aggregator - The completionFromBatchConsumer option dont aggregate the last incoming exchange,See nabblehttp://camel.465427.n5.nabble.com/Last-Aggregated-Exchange-lost-Aggregator-with-a-Batch-Consumer-and-persistent-AggregationRepository-tp3346214p3346214.html,0,0
Detect uncaught exceptions in UoWProcessor to ensure UoW is done even for those uncaught exceptions,The Camel routing engines will handle this in 99.9% of the cases  but when you shutdown a Spring AC then Spring may stop beans in whatever order and this can cause those beans to fail operating during a graceful shutdown. And in worst case exceptions is thrown in situations where they are not normally done.To cater for that and other situations the UoWProcessor should detect this and act accordingly.This ensure the in flight registry will be tracked and we are not stuck with a missing inflight message  causing Camel to wait for the 300 sec timeout to shutdown.For example just try hitting ctrl + c in that camel-example-management and you can see such an example.,0,0
BindyFixedLengthDataFormat does a trim on Fixed Length record,BindyFixedLengthDataFormat does a trim on Fixed Length record  although Fixed Length recordare strictly positional in nature and may contain lot of fillers with empty spaces  doing a trim causes Bindy to fail the message length validation and exception is thrown on message length // Read the line String line = scanner.nextLine().trim(); Should be changed to // Read the line String line = scanner.nextLine(); Or a conditional option should be provided in FixedLengthRecord annotation whether or not to trim the entire record,0,0
When Camel loads properties Camel should remove spaces (trim) from the end of the line.,If Camel reads a property from a properties-file that has a space at the end of a line like:some.property = theValue &lt;---Camel will resolve 'theValue ' and then crash at route creation. Should be 'theValue'.,0,0
Update archetypes to use new descriptor format,Camel archetypes use the old descriptor format and give the following output:[INFO] ********************* End of debug info from resources from generated POM ***********************[INFO] project created from Old (1.x) Archetype in dir: /w1/apache/camel/projects/camel-xxxWe need to update to use the archetype-metadata.xml descriptor,0,0
camel-snmp - Should mask password in the endpoint class,See nabblehttp://camel.465427.n5.nabble.com/password-shown-in-plain-text-in-the-log-file-while-starting-amp-stopping-context-td3347883.htmlThe password should be masked which can be done by overriding toString and mask it in the output.,1,0
In some places we use ObjectHelper.loadClass() instead of ClassResolver.resolveClass(),see Nabble,0,0
Concurrent writes to the same file has race condition,See nabblehttp://camel.465427.n5.nabble.com/Using-Splitter-and-file-producer-with-option-fileExist-Append-failed-tp3353618p3353618.htmlWe need to synchronize on the file name to avoid concurrent writes to the same file.,0,0
JMS spec and JPA spec JARs should not be compile scoped by provided,See nabblehttp://camel.465427.n5.nabble.com/dependency-compile-scope-to-geronimo-XYZ-VERSION-spec-in-camel-jpa-amp-camel-jms-td3356320.html#a3356541,0,0
FTP rename fails,(This is related to the user group discussion http://camel.465427.n5.nabble.com/Problem-renaming-existing-file-in-FTP-td3307670.html)When using a tmpPrefix when uploading  the rename from the tmp-file to the destination file fails  if the destination file is already present  even though the option fileExist=Override is used.We have the problem on just a few destination servers which all seems to be windows machines.I have fetched the 2.4 branch of camel-ftp to find out why it does not work  since the unit test you refer to in your previous post do excercise the problem.It appears that the cause of the problem is  that the FtpOperations.existsFile fails to return true  which then causes the code not to enter the part where it deletes the exisiting file.The reason for the FtpOperations.existsFile to return false  is  that the list of existing files has the directoryname prepended  e.g. I'm trying to upload Test.REN to folder test/rename  and in the code 'if (existing.equals(onlyName))' existing=test/rename/Test.REN and onlyName=Test.REN - which returns false - but causes the later rename to fail as the target folder did contain the Test.REN. My guess is that it is server dependent whether the returned list of names in the directory include the directory name or not?To fix this I have added the following line of code before the if-statementexisting = FileUtil.stripPath(FileUtil.normalizePath(existing));So it will strip the path part of the file name before comparing it to onlyName.,0,0
ServiceHelper - Avoid started/stopping service if already started/stopped,We should optimize ServiceHelper to detect if the service is already started/stopped (if it extends ServiceSupport  as then it provides state).Also DefaultEndpoint should extends ServiceSupport to provide state so we know if the endpoint is started/stopped.This avoid double starting or stopping services which is not needed.And some custom components may not work well if they are started twice  just because Camel handles it lifecycle and invokes start multiple times.Also refine the logging in ServiceHelper from TRACE to DEBUG level so its easier to spot the lifecycle.,0,1
Include test directories in the archetypes,A reader of Camel in Action pointed out that typically folks write unit tests for their projects so we should of course add the test directories (empty or not) to the archetypes (http://www.manning-sandbox.com/thread.jspa?threadID=41702&amp;tstart=0). I agree but of course this is not possible with the current archetype descriptor we are using. Will do this once CAMEL-3611 is complete.,0,0
camel-josql doesnot export org.apache.camel.language.sql.*,,0,0
Inconsistent filename value when move attribute is used with File component,Unless I miss a point  when I use the following endpoint  the file:name value is incorrect and is equal to file:absolute.path&lt;endpoint id='fileEndpoint' uri='file:${queue.input.folder}?recursive=true&amp;include=.*/.dat&amp;move=${queue.done.folder}/$simple{file:name}&amp;moveFailed=${queue.failed.folder}/$simple{file:name}' /&gt;${queue.input.folder}  ${queue.done.folder} and ${queue.failed.folder} are absolute paths resolved by Spring.In fact  Camel tries to move the file to ${queue.done.folder}/${queue.input.folder}/$simple{file:name}I've also tried using $simple{header.CamelFileName} instead of $simple{file:name} and it gives the same result.For now  I've found a workaround using a processor which put the CamelFileName header value into a 'destFile' property &lt;endpoint id='fileEndpoint' uri='file:${queue.input.folder}?recursive=true&amp;include=.*/.dat&amp;move=${queue.done.folder}/$simple{property.destFile}&amp;moveFailed=${queue.failed.folder}/$simple{property.destFile}' /&gt;,0,0
camel-smpp should unbind from SMSC before disconnecting,See Nabble,0,0
Force disable Quartz UpdateChecker,This is really terrible that Terracotta added a 'malware' kinda feature in Quartz that automatic checks if there is a new version of Quartz. WTF that doesn't work nice in enterprises  where they want to be in control of their communication.We should force disabling this.See more details here:http://forums.terracotta.org/forums/posts/list/3395.page#19058https://jira.terracotta.org/jira/browse/QTZ-29,0,0
Mistake in camel-eventAdmin feature,The Camel Karaf feature camel-eventAdmin is not correct.The features is described as follow:&lt;feature name='camel-eventAdmin' version='2.6.0'&gt; &lt;feature version='2.6.0'&gt;camel-core&lt;/feature&gt; &lt;bundle&gt;mvn:org.apache.camel/camel-eventAdmin/2.6.0&lt;/bundle&gt;&lt;/feature&gt;but the camel-eventAdmin artifact correct name is camel-eventadmin:http://repo2.maven.org/maven2/org/apache/camel/camel-eventadmin/2.6.0/camel-eventadmin-2.6.0.jarThis typo mistake provides:Downloading: http://repo1.maven.org/maven2/org/apache/camel/camel-eventAdmin/2.6.0/camel-eventAdmin-2.6.0.jar&#91;INFO&#93; Unable to find resource 'org.apache.camel:camel-eventAdmin:jar:2.6.0' in repository central (http://repo1.maven.org/maven2)&#91;INFO&#93; ------------------------------------------------------------------------&#91;ERROR&#93; BUILD FAILURE&#91;INFO&#93; ------------------------------------------------------------------------&#91;INFO&#93; Can't resolve bundle org.apache.camel:camel-eventAdmin:jar:2.6.0&#91;INFO&#93; ------------------------------------------------------------------------I'm gonna submit a patch to fix that.,0,0
Upgrade maven-bundle-plugin to version 1.3.4,According to Guillaume Nodet we should try to upgrade to the 1.3.4 version of the maven bundle plugin as it simplyfies several osgi related definitions.I will do a full build before committing but as far as I know we do not test in osgi so we need some testing in osgi too. Perhaps Willem can run some servicemix tests.,0,0
camel-core-xml - Add getter/sett for endpoints,We have listed @XmlElement(name = 'endpoint'  required = false) private List&lt;CamelEndpointFactoryBean&gt; endpoints;in the camel-spring  but we dont have getter/setter.We should enforce this by adding getter/setter in camel-core-xml which we have for most of the stuff.,0,0
Fix the Sonar Blocker: Performance - Maps and sets of URLs can be performance hogs,The Camel Sonar Pilot lists 4 blocker for Camel &#91;1&#93;. All in org.apache.camel.impl.converter.AnnotationTypeConverterLoader because it use the URL.equals() and URL.hashCode() methods.You can find the explanation in &#91;2&#93; why this is not a good idea. I would like to change it url.toURI()? Any doubt?&#91;1&#93; http://sonar.apache.org/drilldown/violations/org.apache.camel:camel?priority=BLOCKER#&#91;2&#93; http://michaelscharf.blogspot.com/2006/11/javaneturlequals-and-hashcode-make.html,0,1
SMSC initiated unbind spawns exponential amounts of reconnect threads,It took me a bit of time to put my finger on this problem.When an unbind PDU is sent from the SMSC side to a camel-smpp endpoint  a cascading amount reconnect threads are spawned by the reconnect code. I can reliably re-produce this problem having a simple smpp consumer to a SMSC / simulator and issuing an unbind from the SMSC / simulator.Here are some logs (I have added additional debug messages to the SmppConsumer to show the object references and state of the SmppSession objects):,,
BinaryPredicate - Dont store state to ensure thread safety,We should introduce a new matches method which is used by mock's when they report failure messages. The new method should return the failure message which ensures we dont have to store state on the binary predicate instance.,0,0
Make Content-Type HTTP Header Optional,As per section 7.2.1 of RFC 2616  any HTTP/1.1 message containing an entity-body SHOULD (not MUST) include a Content- Type header field defining the media type of that body.The populateExchangeFromRestletRequest method of the DefaultRestletBinding class  unlike others in the same class  needs to be changed:if (request.getEntity().getMediaType().equals(MediaType.APPLICATION_WWW_FORM)) { ...} else { inMessage.setBody(request.getEntity().getStream());},0,0
Make it easier to derive from the Camel model,In order to facilitate the building of derivations of Camel  some methods in builder and model need to use accessors for member variables  and types to allow for sub types,0,0
Java DSL - Allow load balancer to be used inside CBR,We should allow to use the load balancer inside the CBR  in eg the when predicate.See nabblehttp://camel.465427.n5.nabble.com/DISCUSS-Java-DSL-caveat-with-the-Content-Based-Router-td3389083.html,0,1
Endpoints may be shutdown twice as they are tracked in two lists in CamelContext,Endpoint is a Service which means they are listed in both a endpoint and service list. They should only be listed in the endpoint list.This avoids issues with endpoints may be shutdown twice when Camel shutdown.See nabblehttp://camel.465427.n5.nabble.com/QuartzComponent-do-not-delete-quartz-worker-threads-when-shutdown-Camel-tp3393728p3393728.html,0,0
Tidy up AST model to proper support output or not,We should tidy up the model  so they clearly indicate if outputs supported no outputseg when an EIP supports output  they can be nested/added to it  eg in XML its like&lt;split&gt; &lt;output 1&gt; &lt;output 2&gt;&lt;/split&gt;But some EIPs indicate they support output  but they dont. For example &lt;to&gt; should not support output as it doesn't make sense.We should introduce a isOutputSupported on the ProcessorDefinition and then check each EIP.This will cause changes to the XSD in that regard EIPs which really didn't support output (eg it was hacked that way in Java code) but the XSD would allow outputs  eg&lt;to uri='xxx'&gt; &lt;output 1&gt; &lt;output 2&gt;&lt;/to&gt;Now this would not be possible and you would have to do&lt;to uri='xxx'/&gt;&lt;output 1&gt;&lt;output 2&gt;This will in fact reduce the XSD and make it more concise when outputs is supported or not.,0,0
interceptFrom and from(Endpoint) don't work together,When using interceptFrom(String) together with from(Endpoint)  the below Exception occurs during the routes building process. Looking at RoutesDefinition.java:217 reveals  that the FromDefintion just created has no URI. That causes the comparison to all the interceptFroms' URIs to fail. As far as I can tell  the way to fix this would be to add setUri(myEndpoint.getEndpointUri()) in the constructor FromDefinition(Endpoint endpoint).Below the stack trace  there is a unit test that demonstrates the issue. Until it if fixed  it can be easily circumvented by adding the commented-out line  and then change to from('myEndpoint').org.apache.camel.ResolveEndpointFailedException: Failed to resolve endpoint: null due to: null at org.apache.camel.util.EndpointHelper.matchEndpoint(EndpointHelper.java:109) at org.apache.camel.model.RoutesDefinition.route(RoutesDefinition.java:217) at org.apache.camel.model.RoutesDefinition.from(RoutesDefinition.java:167) at org.apache.camel.builder.RouteBuilder.from(RouteBuilder.java:101) at dk.mobilethink.adc2.endpoint.UnsetUriTest$1.configure(UnsetUriTest.java:18) at org.apache.camel.builder.RouteBuilder.checkInitialized(RouteBuilder.java:318) at org.apache.camel.builder.RouteBuilder.configureRoutes(RouteBuilder.java:273) at org.apache.camel.builder.RouteBuilder.addRoutesToCamelContext(RouteBuilder.java:259) at org.apache.camel.impl.DefaultCamelContext.addRoutes(DefaultCamelContext.java:612) at org.apache.camel.test.CamelTestSupport.setUp(CamelTestSupport.java:111) at junit.framework.TestCase.runBare(TestCase.java:132) at org.apache.camel.test.TestSupport.runBare(TestSupport.java:65) at junit.framework.TestResult$1.protect(TestResult.java:110) at junit.framework.TestResult.runProtected(TestResult.java:128) at junit.framework.TestResult.run(TestResult.java:113) at junit.framework.TestCase.run(TestCase.java:124) at junit.framework.TestSuite.runTest(TestSuite.java:232) at junit.framework.TestSuite.run(TestSuite.java:227) at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:83) at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:49) at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)Caused by: java.lang.NullPointerException at org.apache.camel.util.UnsafeUriCharactersEncoder.encode(UnsafeUriCharactersEncoder.java:56) at org.apache.camel.util.URISupport.normalizeUri(URISupport.java:162) at org.apache.camel.util.EndpointHelper.matchEndpoint(EndpointHelper.java:107) ... 24 morepackage dk.mobilethink.adc2.endpoint;import org.apache.camel.Endpoint;import org.apache.camel.builder.RouteBuilder;import org.apache.camel.test.CamelTestSupport;public class UnsetUriTest extends CamelTestSupport { @Override protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { public void configure() throws Exception { interceptFrom('URI1').to('irrelevantURI'); Endpoint myEndpoint = getContext().getComponent('direct').createEndpoint('ignoredURI'); // getContext().addEndpoint('myEndpoint'  myEndpoint); from(myEndpoint) .inOnly('log:foo'); } }; } public void testNothing() { }},0,0
OnException - The order they are defined in the RouteBuilder / XML should be preserved when you have multiple of the same exception type,When you have 2+ of onException(MyExcpetion.class) then the order may get reversed  in the logic which prepares the routes. The logic should cater for clashes and ensure orders is preserved.This currently only occurs for XML based routes. The Java DSL works.,0,0
camel-jms: testConnectionOnStartup does not test connection for producers,I have a camel context which configures jms producers  but no jms consumers. With this configuration  the 'testConnectionOnStartup' jms option did not test the connection when I started the camel context. I have discovered that (with the current implementation) the 'testConnectionOnStartup' option only applies to consumers. I see that it is implemented in JmsConsumer.doStart() -&gt; JmsConsumer.testConnectionOnStartup(). It would be useful if this option could also applied to producers.As a workaround  I configured a dummy route and a dummy jms consumer.,0,0
Sending to http endpoint may double encoding parameters,See nabbleThe workaround is to use either HTTP_URI or HTTP_QUERY as a header with the parameters. Then they are not double encoded.Also the HTTP_URI should be placeholder resolved  so we can use port or the likes to inject the port number dynamic.,0,0
Camel properties component - Add support for using jvm system/env in location,For example you may want to say {{location=${karaf.hom}/etc/myprop.properties}}.eg where karaf.home is a jvm system property.Take a look at simple as we may want to be able to lookup environment variable also.,0,0
ThreadPoolProfile - Use string types so its much easier to use property placeholders,In the XML DSL you can use threadPoolProfile to define profiles for thread pools. People may want to use property placeholders for min/max values etc. Using xs:string is thus much easier to do that. We do that for some of the others such as &lt;jmxAgent&gt;,0,0
JAXB marshaling broken in 2.6.0,This used to work in 2.5.0 but in 2.6.0 it throws:Caused by: javax.xml.bind.JAXBException: class com.ask.ugc.camel.Jask3061$Foo nor any of its super class is known to this context. at com.sun.xml.bind.v2.runtime.JAXBContextImpl.getBeanInfo(JAXBContextImpl.java:594) at com.sun.xml.bind.v2.runtime.XMLSerializer.childAsRoot(XMLSerializer.java:482) at com.sun.xml.bind.v2.runtime.MarshallerImpl.write(MarshallerImpl.java:315) at com.sun.xml.bind.v2.runtime.MarshallerImpl.marshal(MarshallerImpl.java:244) at javax.xml.bind.helpers.AbstractMarshallerImpl.marshal(AbstractMarshallerImpl.java:75) at org.apache.camel.converter.jaxb.JaxbDataFormat.marshal(JaxbDataFormat.java:117) at org.apache.camel.converter.jaxb.JaxbDataFormat.marshal(JaxbDataFormat.java:96)...@ContextConfiguration( locations = 'foo.bar.JaxbBug$ContextConfig'  loader = JavaConfigContextLoader.class)public class JaxbBug extends AbstractTestNGSpringContextTests { @EndpointInject(uri = 'mock:end') protected MockEndpoint mockEndpoint; @Produce(uri = 'direct:test') protected ProducerTemplate producer; @Test @DirtiesContext public void testJaxbMarshalling() throws InterruptedException { mockEndpoint.expectedMessageCount(1); producer.sendBody(new Foo()); mockEndpoint.assertIsSatisfied(); } @Configuration public static class ContextConfig extends SingleRouteCamelConfiguration { @Bean public RouteBuilder route() { return new RouteBuilder() { @Override public void configure() throws Exception { JaxbDataFormat jaxb = new JaxbDataFormat(JAXBContext.newInstance(Foo.class)); from('direct:test').marshal(jaxb).to('mock:end'); } }; } } @XmlRootElement public static class Foo { String bar; public String getBar() { return bar; } public void setBar(String bar) { this.bar = bar; } }},0,0
IgnoreInvalidEndpoint should log invalid endpoints at DEBUG level,Currently its logged at INFO level with full stacktrace. If end user enabled this option we should only log it at DEBUG level to avoid spamming production logs.See nabblehttp://camel.465427.n5.nabble.com/camel-recipientList-with-ignoreInvalidEndpoints-true-tp3404103p3404103.html,0,0
Add comments on the CamelContextTestSupport class to tell user to start the camel context manually when the test doesn't use the RouteBuilder,Current CamelContextTestSupport class will not start the camelcontext if the isUseRouteBuilder() return false.If the component that is used by template needs to be started  your test method will get the NPE or some strange error.And you can these load when shutting down the camel context.Mar 1  2011 4:31:29 PM org.apache.camel.test.junit4.CamelTestSupport tearDownINFO: Testing done: com.fusesource.example.camel.cxf.jms.HelloWorldClient@e49d67cMar 1  2011 4:31:29 PM org.apache.camel.impl.DefaultCamelContext doStopINFO: Apache Camel 2.6.0-fuse-00-00 (CamelContext:camel-1) is shutting downMar 1  2011 4:31:29 PM org.apache.camel.impl.DefaultCamelContext createManagementStrategyINFO: JMX is disabled. Using DefaultManagementStrategy.Mar 1  2011 4:31:29 PM org.apache.camel.impl.DefaultShutdownStrategy doShutdownINFO: Starting to graceful shutdown 0 routes (timeout 10 seconds)Mar 1  2011 4:31:29 PM org.apache.camel.impl.DefaultShutdownStrategy doShutdownINFO: Graceful shutdown of 0 routes completed in 0 secondsMar 1  2011 4:31:29 PM org.apache.camel.impl.DefaultCamelContext doStopINFO: Uptime: not startedMar 1  2011 4:31:29 PM org.apache.camel.impl.DefaultCamelContext doStopINFO: Apache Camel 2.6.0-fuse-00-00 (CamelContext: camel-1) is shutdown in 0.023 seconds,0,0
Let log  log eip and mock producer be async processor,We should prefer to use the async processor for the Camel EIPs and components when possible. This avoids the tiny overhead of having a sync to async adapter (implemented using a converter).,0,0
sftp producer runs in exception fileName does not contain any path information,When the fileName uri option does not contain any folder information  ie: 'fileName=filename.txt' the producer runs in exceptionThe exception is thrown when the producer calls ls method of jsch ChannelSftp passing an empty string as directory parameter in org.apache.camel.component.file.remote.SftpOperations.existsFile line 704sample URI: sftp://user@hostname:22?disconnect=true&amp;eagerDeleteTargetFile=false%3Bstepwise%3Dfalse&amp;fileName=SYSTEM01&amp;password=******&amp;soTimeout=30000&amp;tempFileName=%24%7Bfile%3Aname.noext%7D.tmpStack trace:[2011-03-03 14:40:40 827][RecipientList (thread #4)][ERROR][org.apache.camel.processor.DefaultErrorHandler][] Failed delivery for exchangeId: ID-******-33331-1299163043684-0-10. Exhausted after delivery attempt: 1 caught: org.apache.camel.component.file.GenericFileOperationFailedExcept on: org.apache.camel.component.file.GenericFileOperationFailedException: at org.apache.camel.component.file.remote.SftpOperations.existsFile(SftpOperations.java:727) at org.apache.camel.component.file.GenericFileProducer.processExchange(GenericFileProducer.java:130) at org.apache.camel.component.file.remote.RemoteFileProducer.process(RemoteFileProducer.java:50) at org.apache.camel.impl.converter.AsyncProcessorTypeConverter$ProcessorToAsyncProcessorBridge.process(AsyncProcessorTypeConverter.java:50) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77) at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:299) at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:208) at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:109) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:103) at org.apache.camel.processor.MulticastProcessor.doProcessParallel(MulticastProcessor.java:716) at org.apache.camel.processor.MulticastProcessor.access$100(MulticastProcessor.java:78) at org.apache.camel.processor.MulticastProcessor$1.call(MulticastProcessor.java:282) at org.apache.camel.processor.MulticastProcessor$1.call(MulticastProcessor.java:274) at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303) at java.util.concurrent.FutureTask.run(FutureTask.java:138) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303) at java.util.concurrent.FutureTask.run(FutureTask.java:138) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:619) Caused by: 4: at com.jcraft.jsch.ChannelSftp.ls(ChannelSftp.java:1353) at org.apache.camel.component.file.remote.SftpOperations.existsFile(SftpOperations.java:704) ... 20 more Caused by: java.lang.StringIndexOutOfBoundsException: String index out of range: 0 at java.lang.String.charAt(String.java:686) at com.jcraft.jsch.ChannelSftp.remoteAbsolutePath(ChannelSftp.java:2367) at com.jcraft.jsch.ChannelSftp.ls(ChannelSftp.java:1185) ... 21 more,0,0
Add an example which use CXF bean binding and the OSGI HTTP Service (e.g. PAX Web with jetty),Please see Nabble for details.,0,0
After switching to slf4j  we can get rid of the 'isTraceEnabled'  'isDebugEnabled' and 'isInfoEnabled' statements,we can get rid of the 'isTraceEnabled'  'isDebugEnabled' and 'isInfoEnabled' statements with slf4j and uselogger.debug('Temperature set to {}. Old temperature was {}.'  t  oldT);insteadchristian-muellers-macbook-pro:camel cmueller$ egrep -r 'isTraceEnabled|isDebugEnabled|isInfoEnabled]' . | wc -l 1485,0,0
Mail component issue with starttls option,The problem occurs when I read from a pop3 endpoint and send to an smtp endpoint in the same camel context with the mail.pop3.starttls.enable=true and mail.smtp.starttls.enable=true options.Required Java options for starttls are set:-Djavax.net.ssl.trustStore=D:/test/xxx.jks-Djavax.net.ssl.trustStorePassword=yyyWhen I only configure one of either route  everything works fine. When I configure both  I get the following exception:AUTH LOGINC: STAT530 Must issue STARTTLS command firstSTARTTLSS: +OK 0 0C: NOOP220 begin TLS negotiationS: +OKC: RSETS: +OKC: QUITAUTH LOGINS: +OK POP3 server closing connection503 wrong state for AUTH command2011-03-03 10:08:36 797 &#91;foo&#93; ERROR DefaultErrorHandler - Failed delivery for exchangeId: ID-E6500-ahi-61446-1299143304838-0-2. Exhausted after delivery attempt: 1 caught: org.springframework.mail.MailAuthenticationException: Authentication failed; nested exception is javax.mail.AuthenticationFailedException: 503 wrong state for AUTH commandorg.springframework.mail.MailAuthenticationException: Authentication failed; nested exception is javax.mail.AuthenticationFailedException: 503 wrong state for AUTH command at org.springframework.mail.javamail.JavaMailSenderImpl.doSend(JavaMailSenderImpl.java:392)&#91;org.springframework.context.support-3.0.5.RELEASE.jar:3.0.5.RELEASE&#93; at org.springframework.mail.javamail.JavaMailSenderImpl.send(JavaMailSenderImpl.java:340)&#91;org.springframework.context.support-3.0.5.RELEASE.jar:3.0.5.RELEASE&#93; at org.springframework.mail.javamail.JavaMailSenderImpl.send(JavaMailSenderImpl.java:355)&#91;org.springframework.context.support-3.0.5.RELEASE.jar:3.0.5.RELEASE&#93; at org.springframework.mail.javamail.JavaMailSenderImpl.send(JavaMailSenderImpl.java:344)&#91;org.springframework.context.support-3.0.5.RELEASE.jar:3.0.5.RELEASE&#93; at org.apache.camel.component.mail.MailProducer.process(MailProducer.java:44)&#91;camel-mail-2.6.0.jar:2.6.0&#93; at org.apache.camel.impl.converter.AsyncProcessorTypeConverter$ProcessorToAsyncProcessorBridge.process(AsyncProcessorTypeConverter.java:50)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:70)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.SendProcessor$2.doInAsyncProducer(SendProcessor.java:104)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.impl.ProducerCache.doInAsyncProducer(ProducerCache.java:272)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:98)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:70)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:68)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:70)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:99)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:70)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:299)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:208)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:269)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:70)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.Pipeline.process(Pipeline.java:125)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.Pipeline.process(Pipeline.java:80)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:102)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:70)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.RoutePolicyProcessor.process(RoutePolicyProcessor.java:75)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:70)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:68)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:91)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:85)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.component.timer.TimerConsumer.sendTimerExchange(TimerConsumer.java:104)&#91;camel-core-2.6.0.jar:2.6.0&#93; at org.apache.camel.component.timer.TimerConsumer$1.run(TimerConsumer.java:49)&#91;camel-core-2.6.0.jar:2.6.0&#93; at java.util.TimerThread.mainLoop(Unknown Source)&#91;:1.5.0_22&#93; at java.util.TimerThread.run(Unknown Source)&#91;:1.5.0_22&#93;The problem seems to be in org.apache.camel.component.mail.MailConfiguration.createJavaMailSender() where it uses the same mail session for both connection; see Session.getDefaultInstance below if (session != null) { answer.setSession(session); } else { // use our authenticator that does no live user interaction but returns the already configured username and password Session session; try { session = Session.getDefaultInstance(answer.getJavaMailProperties()  getAuthenticator()); } catch (Throwable t) { // fallback as default instance may not be allowed on some systems session = Session.getInstance(answer.getJavaMailProperties()  getAuthenticator()); } answer.setSession(session); }This is because getDefaultInstance creates a Session object the first time it is called. Then it caches that Session and returns it for all subsequent calls. It also ignores the new and different properties for the second route.See also http://camel.465427.n5.nabble.com/Mail-component-with-starttls-td3409505.html,0,0
HttpProducer drops authentification parameters.,Hi  I run into the following problem with Camel 2.6.0:An HTML file contain an URI lists of files to be downloaded from a web server to the local file system.The HTML file is parsed via a Java Bean Splitter. The Java Bean Splitter produces a Set of URI strings.These files should be downloaded from a web server to the local file system. The files are protected with BASIC authentification.The extraction and the splitting of the download URIs works quite well with the Java Bean Splitter.The Java Bean Splitter produces URI like: http4://download.acme.com/file_1.txt?username=foo&amp;password=baaHere's the setup:&lt;route&gt; &lt;from uri='file:///tmp/files_to_retrieve/' /&gt; &lt;method bean='prepareDownLoadUri' method='parseIndexHtml' /&gt; &lt;setHeader headerName='CamelHttpMethod'&gt; &lt;constant&gt;GET&lt;/constant&gt; &lt;/setHeader&gt; &lt;setHeader headerName='CamelHttpUri'&gt; &lt;simple&gt;${body}&lt;/simple&gt; &lt;/setHeader&gt; &lt;to uri='http4://download.acme.com/' /&gt; &lt;to uri='bean:saveFileProcessor' /&gt;&lt;/route&gt;&lt;bean id='prepareDownLoadUri' class='com.acme.PrepareDownLoadUri' /&gt;&lt;bean id='saveFileProcessor' class='com.acme.SaveFileProcessor' /&gt;The injection of the URIs from the Splitter into the HttpProducer  works quite well. I debugged into the HttpProducer and it seems  that the HttpProducer does not provide the unterlying http client (in this case Apache HttpClient 4) with the authentification settings from the URI.At first  the queryString is extracted from the Exchange-Header (if provided)HttpProducer.createMethod()  line 273String url = HttpHelper.createURL(exchange  getEndpoint());The url string contains the URI produces by the splitter including the authentification parameters: http4://download.acme.com/file_1.txt?username=foo&amp;password=baaThen the HttpProducer assembles a new URI for the requests. The new URI is assembled from parts of the string url (line 273) and other parameters from the Exchange Header: HttpProducer.createMethod()  lines 285-300 // is a query string provided in the endpoint URI or in a header (header overrules endpoint) String queryString = exchange.getIn().getHeader(Exchange.HTTP_QUERY  String.class); if (queryString == null) { queryString = getEndpoint().getHttpUri().getRawQuery(); } StringBuilder builder = new StringBuilder(uri.getScheme()).append('://').append(uri.getHost()); if (uri.getPort() != -1) { builder.append(':').append(uri.getPort()); } if (uri.getPath() != null) { builder.append(uri.getRawPath()); } if (queryString != null) { builder.append('?'); builder.append(queryString); } HttpRequestBase httpRequest = methodToUse.createMethod(builder.toString());The problem is  in the assembling of the new URI  the authentification parameters are dropped. One possible solution could be:  check for authentification parameters in the url (line 273) and extract them. build the credentials  AuthScheme and provide it to the underlying http client.thanks in advance ben,1,0
option to force sending original JMS message,When using mapJmsMessage=false you would think that Camel would send along the original JMS message. However  if you touch the Camel Message headers (get or set) this effectively disables the mapJmsMessage option. I came across this issue when using the failover loadbalancer. We should add an option to force Camel to send along the orginal JMS message.,0,0
HTTP Producer seems to send an empty body request on redelivery when the original request fails due to a connection timeout,Camel HTTP Producer is throwing an exception when it encounters a connection timeout. However instead of preserving the original message it is treating it processing the exception output. When connected to a redelivery meachanism  this results in an exception message being sent as input to the HTTP Consumer. The older versions of Camel behaved differently on read timeout. In Camel 1.x  in a read timeout  the Exception is thrown and the input message to the producer is passed through the pipeline. Now there is a difference: An exception is thrown and the output of the HTTP Producer is passed through the pipeline. Need to study why and what changed since Camel 1.x and ensure that the above does not happen.For more details  please check out the following nabble entryhttp://camel.465427.n5.nabble.com/Http-route-returning-with-200-but-also-getting-read-timed-out-td3741631.html#a3897410Cheers Ashwin...,0,0
org.apache.camel.component.file.strategy.MarkerFileExclusiveReadLockStrategy is not thread-safe,MarkerFileExclusiveReadLockStrategy is not thread-safe. When I run a File endpoint with more than one thread the MarkerFileExclusiveReadLockStrategy only deletes the last file to start being processed. The MarkerFileExclusiveReadLockStrategy uses global variables: private File lock; private String lockFileName; and gives them values on the acquireExclusiveReadLock method. When another thread calls the releaseExclusiveReadLock method it uses the global variables to delete the locked file. That means that if another thread came and called the acquireExclusiveReadLock it would have changed the values on the global variables. If lock and lockFileName are not global variables the problem seems to disappear and I can a multithreaded File endpoint and not locked file is left undeleted.,0,0
Try to copy file when rename fails,I have a setup where I use file component to move files after being processed ou when processing fails.As I have no troubles neither on my development workstation neither on local directory on my linux environnement. It fails when the monitored directory is a NFS mounted directory pointing to a Windows 2008 Server shared directory.While it's not a camel bug  the generated logs are just useless because we can't get the reason of failure.Investigating the source code tells me that the File.renameTo method is used (with the three times try hack for Windows   so I can't get any further information on the reason.Could you implement a fallback strategy like copy the file and delete the original one ? (should it be made optional)To workaround this  I currently do the move operations manually by invoking the FileUtils.moveTo(...) from commons-io (which implements exactly the fallback method I described on renameTo failure).But  I have side effects as I'm forced to use the noop attribute.(in fact  it doesn't explain why the rename fails  but it works  and should it be a failure I'll get an explicit error message).,0,0
Polish the aws component,,1,0
Web Console: NPE when browsing routes with no description,When some of the routes does not have a description NPE will be thrown  because of the code${i.getDescription.getText}To prevent it  just use${i.getDescriptionText},0,0
maven eclipse goal failure,The error is:[ERROR] BUILD ERROR[INFO] ------------------------------------------------------------------------[INFO] Request to merge when 'filtering' is not identical. Original=resource src/main/resources: output=target/classes  include=[]  exclude=[**/*.java]  test=false  filtering=false  merging with=resource src/main/resources: output=target/classes  include=[**/archetype-metadata.xml]  exclude=[**/*.java]  test=false  filtering=trueand it seems to be resolved in the upcoming maven-eclipse-plugin:2.9.0 (see MECLIPSE-576). An update to the new release of the plugin  once available  should resolve this.,0,0
The camel-cometd component does not support a custom SecurityPolicy or Extension as described on http://cometd.org/documentation/howtos/authentication,The camel-cometd component does not support a custom SecurityPolicy or Extension as described on http://cometd.org/documentation/howtos/authenticationA simple solution is to add setters for SecurityPolicy and Extension to the component. If these attributes are set then also set them on the underlying AbstractBayeux class.About the patch:The existing unit test is based on an interactive scenario that involves human intervention. A similar test is made that uses an extension and another one is made that needs authentication. To provide feedback on a failed authentication a cometd listener is used. The version of the cometd-dojo extension used does not support listeners so this dojo extension has also been upgraded to 1.1.4.,1,0
BeanInfo not reset when new bean looked up,In camel-bean  when a bean is looked-up and it is not the same bean as the previous one beanInfo has to be reset.This is done in getBean() method of org.apache.camel.component.bean.RegistryBean but the test is placed after setting bean=value so beanInfo is never reset :if (value != bean) {  bean = value;  processor = null;  if (!ObjectHelper.equal(ObjectHelper.type(bean)  ObjectHelper.type(value))) { beanInfo = null; },0,0
Allow cometd component to send message headers with the message,Currently the cometd component ignores message headers. ======Code snippet from CometdConsumer.java: Message message = new DefaultMessage(); message.setBody(data); Exchange exchange = endpoint.createExchange(); exchange.setIn(message);======Exchange message headers should be maintained (perhaps with a flag?).,0,0
camel-jms default cache level should be CACHE_NONE when transaction is enabled,I lost a huge amount of time chasing the problem as the default value just screw the whole transaction (the session is created outside the transaction and cached  so usually not enlisted in the tx).,0,0
SmppProducer sends incorrect data_coding parameter,The dataCoding parameter on the SMPP uri allows for a value of 0 4  or 8. Our aggregator expects the data_coding parameter on the SMPP request from the SmppProducer to be 0=SMSC Default Alphabet. However  when 0  4  or 8 is specified for the dataCoding parameter  the actual value sent on the smpp request is 1  5  or 9. It appears the MessageClass.Class1 on the GeneralDataCoding object in SmppProducer is masking an additional 1 to the byte value.It seems the dataCoding parameter should allow you to specify the actual value that is needed as defined by the SMPP Protocol specification.,0,0
OSGi - No possibility to enable ehcache clustering as: ehcache.xml is ignored and there is no possibility to set cacheManagerFactory described camel-cache docs,This bug is caused by more than one problem as:1. camel-cache bundle provides ehcache.xml config which is ignored so then default ehcache-failsafe.xml is taken by ehcache bundle.2. according to camel-cache docs there is a way to set cacheManagerFactory but it seems to be not implemented asa) default CacheManagerFactory instance is created when when CacheComponent is instantiated.b) setter method: public void setCacheManagerFactory(CacheManagerFactory cacheManagerFactory) is used just nowhere.c) there is no suitable filed in class CacheConfigurationAll above problems cause camel-cache to be not able to work in java- clustered world as default failsafe config. is really failsafe- w/o clustering.,0,0
camel-cache - Should use Camel style constant keys,The CacheConstant use all upper cases and they are not using the Camel style which we should use.It should be'CamelCacheAdd' instead of 'ADD'and so forth.This also ensures those headers is not propagated over remote transports as they should not.In fact we should consider removing those headers in the camel-cache code as they are just input parameters to control the operation.,0,0
camel-web - Cannot browse endpoints if messages was consumed from jms queue,You get a NPE if you brows the endpoint.Caused by: java.lang.NullPointerException at org.apache.camel.web.resources.$scalate$ExchangeResource_index_ssp$$anonfun$$scalate$render$2.apply(ExchangeResource.index.ssp.scala:46) at org.apache.camel.web.resources.$scalate$ExchangeResource_index_ssp$$anonfun$$scalate$render$2.apply(ExchangeResource.index.ssp.scala:40) at scala.collection.Iterator$class.foreach(Iterator.scala:631),0,0
camel-xmpp - Should stop and clean session  so hot-deploy works,See this stacktrace14:10:55 806 | ERROR | ExtenderThread-8 | ContextLoaderListener | 72 - org.springframework.osgi.extender - 1.2.0 | Application context refresh failed (OsgiBundleXmlApplicationContext(bundle=qbus-camel-osgi  config=osgibundle:/META-INF/spring/*.xml))org.apache.camel.FailedToCreateProducerException: Failed to create Producer for endpoint: Endpoint[xmpp://articleRoute@localhost?password=******&amp;room=mechatron%40conference.mw-pc]. Reason: java.lang.NullPointerException at org.apache.camel.impl.ProducerCache.doGetProducer(ProducerCache.java:362)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ProducerCache.acquireProducer(ProducerCache.java:93)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ProducerCache.startProducer(ProducerCache.java:124)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.processor.SendProcessor.doStart(SendProcessor.java:146)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:65)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:52)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:60)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.util.ServiceHelper.startServices(ServiceHelper.java:74)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.processor.DelegateAsyncProcessor.doStart(DelegateAsyncProcessor.java:77)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:65)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:52)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:60)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.util.ServiceHelper.startServices(ServiceHelper.java:74)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.processor.DelegateAsyncProcessor.doStart(DelegateAsyncProcessor.java:77)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.processor.interceptor.TraceInterceptor.doStart(TraceInterceptor.java:429)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:65)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:52)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:60)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.util.ServiceHelper.startServices(ServiceHelper.java:74)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.processor.RedeliveryErrorHandler.doStart(RedeliveryErrorHandler.java:847)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:65)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:52)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:60)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.util.ServiceHelper.startServices(ServiceHelper.java:74)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.processor.DefaultChannel.doStart(DefaultChannel.java:146)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:65)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:52)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:60)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.util.ServiceHelper.startServices(ServiceHelper.java:86)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.processor.MulticastProcessor.doStart(MulticastProcessor.java:893)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:65)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:52)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:60)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.util.ServiceHelper.startServices(ServiceHelper.java:74)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.processor.DelegateAsyncProcessor.doStart(DelegateAsyncProcessor.java:77)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:65)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:52)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:60)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.util.ServiceHelper.startServices(ServiceHelper.java:74)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.processor.DelegateAsyncProcessor.doStart(DelegateAsyncProcessor.java:77)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:65)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:52)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:60)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.RouteService.startChildService(RouteService.java:250)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.RouteService.warmUp(RouteService.java:146)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.DefaultCamelContext.doWarmUpRoutes(DefaultCamelContext.java:1800)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.DefaultCamelContext.safelyStartRouteServices(DefaultCamelContext.java:1726)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.DefaultCamelContext.doStartOrResumeRoutes(DefaultCamelContext.java:1528)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.DefaultCamelContext.doStartCamel(DefaultCamelContext.java:1420)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.DefaultCamelContext.doStart(DefaultCamelContext.java:1321)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.spring.SpringCamelContext.doStart(SpringCamelContext.java:164)[75:org.apache.camel.camel-spring:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:65)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:52)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.DefaultCamelContext.start(DefaultCamelContext.java:1299)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.spring.SpringCamelContext.maybeStart(SpringCamelContext.java:203)[75:org.apache.camel.camel-spring:2.6.0.fuse-01-09] at org.apache.camel.spring.SpringCamelContext.onApplicationEvent(SpringCamelContext.java:101)[75:org.apache.camel.camel-spring:2.6.0.fuse-01-09] at org.apache.camel.spring.CamelContextFactoryBean.onApplicationEvent(CamelContextFactoryBean.java:238)[75:org.apache.camel.camel-spring:2.6.0.fuse-01-09] at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:97)[61:org.springframework.context:3.0.5.RELEASE] at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:303)[61:org.springframework.context:3.0.5.RELEASE] at org.springframework.context.support.AbstractApplicationContext.finishRefresh(AbstractApplicationContext.java:911)[61:org.springframework.context:3.0.5.RELEASE] at org.springframework.osgi.context.support.AbstractOsgiBundleApplicationContext.finishRefresh(AbstractOsgiBundleApplicationContext.java:235)[71:org.springframework.osgi.core:1.2.0] at org.springframework.osgi.context.support.AbstractDelegatedExecutionApplicationContext$4.run(AbstractDelegatedExecutionApplicationContext.java:358)[71:org.springframework.osgi.core:1.2.0] at org.springframework.osgi.util.internal.PrivilegedUtils.executeWithCustomTCCL(PrivilegedUtils.java:85)[71:org.springframework.osgi.core:1.2.0] at org.springframework.osgi.context.support.AbstractDelegatedExecutionApplicationContext.completeRefresh(AbstractDelegatedExecutionApplicationContext.java:320)[71:org.springframework.osgi.core:1.2.0] at org.springframework.osgi.extender.internal.dependencies.startup.DependencyWaiterApplicationContextExecutor$CompleteRefreshTask.run(DependencyWaiterApplicationContextExecutor.java:136)[72:org.springframework.osgi.extender:1.2.0] at java.lang.Thread.run(Thread.java:619)[:1.6.0_14]Caused by: java.lang.NullPointerException at org.jivesoftware.smackx.muc.MultiUserChat$1.connectionCreated(MultiUserChat.java:84)[247:org.apache.servicemix.bundles.smack:3.1.0.2] at org.jivesoftware.smack.XMPPConnection.initConnection(XMPPConnection.java:957)[247:org.apache.servicemix.bundles.smack:3.1.0.2] at org.jivesoftware.smack.XMPPConnection.connectUsingConfiguration(XMPPConnection.java:904)[247:org.apache.servicemix.bundles.smack:3.1.0.2] at org.jivesoftware.smack.XMPPConnection.connect(XMPPConnection.java:1415)[247:org.apache.servicemix.bundles.smack:3.1.0.2] at org.apache.camel.component.xmpp.XmppEndpoint.createConnection(XmppEndpoint.java:140)[248:org.apache.camel.camel-xmpp:2.6.0.fuse-01-09] at org.apache.camel.component.xmpp.XmppGroupChatProducer.doStart(XmppGroupChatProducer.java:76)[248:org.apache.camel.camel-xmpp:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:65)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:52)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:60)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] at org.apache.camel.impl.ProducerCache.doGetProducer(ProducerCache.java:360)[68:org.apache.camel.camel-core:2.6.0.fuse-01-09] ... 65 more,0,0
Avoiding to process the bean which value is null in CamelBeanPostProcessor,When user use the FactoryBean to return a null object within Spring 2.x  the CamelBeanPostProcessor will throw a NPE exception.Although this issue can't be reproduced within Spring 3.x  we should consider to put the NP check in the CamelBeanPostProcessor as an enhancement.,0,0
camel-cache exception message: CamelCacheOperation not specified in the message header [CamelCacheKey],Caused by: net.sf.ehcache.CacheException: CamelCacheOperation not specified in the message header &#91;CamelCacheKey&#93;Sound like a mistake? Or maybe my English is so bad? as this message doesn't make sense for me...Simply it should be:Caused by: net.sf.ehcache.CacheException: CamelCacheOperation header not specified in message,0,0
Prevent 'FolderNotOpen' exception when closing out an email exchange,When an email exchange is complete it should set either the SEEN or DELETED flags in the folder on the email server. But if the folder isn't open  either because of automatic closing or timeout  attempting to set the flag results in a FolderNotOpen exception. The attached version of MailConsumer includes a check in processCommit() that opens the folder if it's not open at exchange completion.,0,0
Consumer URI parameters ignored after Route Restart,The URI parameters for a consumer appear to be ignored or disappear when the route where this consumer defined gets restarted.One example could be JPA query passed in the URI and is used to filter the results from the consumer.The attached test case shows this.Look at the Readme.txt  camel-context.xml  and JPARouteRestartTest class for more information.Also  took a stab at fixing the problem and provided a patch with a possible solution. I ran the unit tests after that change and all passed.,0,0
CxfPayloadConverter may start failing to convert a CxfPayload to a Node,There is an issue with CxfPayloadConverter that can lead to a failure in converting the CxfPayload into something which is actually convertible. This problem happens when you try to convert a CxfPayload instance that has an empty body list into a Node instance. This returns null and subsequently registers this type mapping key (CxfPayload-&gt;Node) in org.apache.camel.impl.converter.BaseTypeConverterRegistry's conversion-misses table. Because of this  a subsequent conversion using a CxfPayload instance with an non empty body list will permanently fail.I am attaching a modified CxfPayloadConversionTest that includes testCxfPayloadToNode that illustrates this problem. Currently  the last assertion of this test is failing when this issue is present.I think we can fix this problem by returning Void.TYPE instead of a null for this case.In this way  the conversion is regarded as a success and there will be no entry in the conversion-misses table.So  I am also attaching the modiefied CxfPayloadConverter class that can handle this test case.,0,0
JdbcAggregationRepository count (*) is not working with MySQL 5.0,The JdbcAggregationRepository makes a  'SELECT COUNT (*) FROM....' SQL request at line 131 in the source code. This appears to be incorrect with MySQL because theire is a space between COUNT and (. By replacing the request with  'SELECT COUNT(*) FROM....' (without the white space) the bug is corrected for MySQL (I think it should be tested with other database without the space). This request can be tested with Mysql Query Browser (the returned error is the same as the one encountered when we execute the JdbcAggregationRepository with Camel). The exception returned is the following:  ERROR DefaultErrorHandler - Failed delivery for exchangeId: ID:COE-WRKST2-1749-1304443569312-2:2:1:88:1. Exhausted after delivery attempt: 1 caught: org.springframework.jdbc.BadSqlGrammarException: PreparedStatementCallback; bad SQL grammar [SELECT COUNT (*) FROM aggregation_repo_0 WHERE id = ?]; nested exception is com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '*) FROM aggregation_repo_0 WHERE id = '92'' at line 1org.springframework.jdbc.BadSqlGrammarException: PreparedStatementCallback; bad SQL grammar [SELECT COUNT (*) FROM aggregation_repo_0 WHERE id = ?]; nested exception is com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '*) FROM aggregation_repo_0 WHERE id = '92'' at line 1 at org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator.doTranslate(SQLErrorCodeSQLExceptionTranslator.java:233) at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:72) at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:602) at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:636) at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:665) at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:673) at org.springframework.jdbc.core.JdbcTemplate.queryForObject(JdbcTemplate.java:728) at org.springframework.jdbc.core.JdbcTemplate.queryForObject(JdbcTemplate.java:744) at org.springframework.jdbc.core.JdbcTemplate.queryForInt(JdbcTemplate.java:775) at org.apache.camel.processor.aggregate.jdbc.JdbcAggregationRepository$1.doInTransaction(JdbcAggregationRepository.java:131) at org.apache.camel.processor.aggregate.jdbc.JdbcAggregationRepository$1.doInTransaction(JdbcAggregationRepository.java:114) at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:130) at org.apache.camel.processor.aggregate.jdbc.JdbcAggregationRepository.add(JdbcAggregationRepository.java:114) at org.apache.camel.processor.aggregate.AggregateProcessor.doAggregation(AggregateProcessor.java:251) at org.apache.camel.processor.aggregate.AggregateProcessor.process(AggregateProcessor.java:189) at org.apache.camel.impl.converter.AsyncProcessorTypeConverter$ProcessorToAsyncProcessorBridge.process(AsyncProcessorTypeConverter.java:50) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:68) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89) at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:99) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77) at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:299) at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:208) at org.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:269) at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:109) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:68) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:103) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:85) at org.apache.camel.component.jms.EndpointMessageListener.onMessage(EndpointMessageListener.java:84) at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:560) at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:498) at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:467) at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325) at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263) at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1058) at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1050) at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:947) at java.lang.Thread.run(Thread.java:662)Caused by: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '*) FROM aggregation_repo_0 WHERE id = '92'' at line 1 at sun.reflect.GeneratedConstructorAccessor83.newInstance(Unknown Source) at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27) at java.lang.reflect.Constructor.newInstance(Constructor.java:513) at com.mysql.jdbc.Util.handleNewInstance(Util.java:409) at com.mysql.jdbc.Util.getInstance(Util.java:384) at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:1054) at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:3566) at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:3498) at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1959) at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:2113) at com.mysql.jdbc.ConnectionImpl.execSQL(ConnectionImpl.java:2568) at com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:2113) at com.mysql.jdbc.PreparedStatement.executeQuery(PreparedStatement.java:2275) at org.apache.commons.dbcp.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:96) at org.apache.commons.dbcp.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:96) at org.springframework.jdbc.core.JdbcTemplate$1.doInPreparedStatement(JdbcTemplate.java:643) at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:586) ... 42 more,0,0
AnnotationTypeConverterLoader fails for folders containing spaces,This problem appears when jar dependencies with type converters have path containing space characters.In my case  the camel-mail-2.7.1.jar jar is located in my local maven repository.I get this error during my project startup: [...]Caused by: java.net.URISyntaxException: Illegal character in opaque part at index 22: jar:file:/D:/Documents and Settings/501915291/.m2/repository/org/apache/camel/camel-mail/2.7.1/camel-mail-2.7.1.jar!/META-INF/services/org/apache/camel/TypeConverter at java.net.URI$Parser.fail(URI.java:2809) at java.net.URI$Parser.checkChars(URI.java:2982) at java.net.URI$Parser.parse(URI.java:3019) at java.net.URI.&lt;init&gt;(URI.java:578) at java.net.URL.toURI(URL.java:918) at org.apache.camel.impl.converter.AnnotationTypeConverterLoader.findPackages(AnnotationTypeConverterLoader.java:118) at org.apache.camel.impl.converter.AnnotationTypeConverterLoader.findPackageNames(AnnotationTypeConverterLoader.java:108) at org.apache.camel.impl.converter.AnnotationTypeConverterLoader.load(AnnotationTypeConverterLoader.java:69) ... 63 moreFIX:findPackages method in AnnotationTypeConverterLoader shouldn't use URIs to store already visited jars.,0,0
Sending a message to log endpoint should not convert payload to StreamCache,We should not automatic try to convert the payload to a StreamCache if you send a message to a log endpoint. StreamCache newBody = message.getBody(StreamCache.class); if (newBody != null) { message.setBody(newBody); }Only if people have explicit enabled stream cache we can safely log it.Otherwise we should not output streams in the log.We should use the extractBodyForLogging from MessageHelper instead which cater for this.,1,0
Route cannot be started within web-console  if autoStartup='false' is set in camel.xml,When a route has autoStartup='false' set in the camel.xml  it cannot be started anymore in the web- console.In the logfile  an entry is generated  similar to this:'Cannot start route route2 as its configured with autoStartup=false | org.apache.camel.spring.SpringCamelContext | qtp7446303-52'If a route does not have autoStartup='false'  it can be stopped and started normally (as before with ActiveMQ 5.4.2 / Camel 2.4.0)Reproduce steps: Configure a route with '&lt;route autoStartup='false'&gt;' Start the ActiveMQ Service Navigate to 'http://server.domain.tld:8161/camel/routes try to start the route with the button 'Start' check the logfile 'activemq.log',0,0
Script arguments,As I said here : http://fusesource.com/forums/thread.jspa?threadID=2946&amp;tstart=0  the ScriptEngine class (http://download.oracle.com/javase/6/docs/api/javax/script/ScriptEngine.html) provides a put method which enable to add a Java object into the created script  thanks to the JSR-223. But Camel does not provide a 'bridge' to this method.So I propose to pass the arguments via the header map of the message.Indeed  on client side  I created a Map&lt;String  Object&gt; which contains the future scripts arguments. Then I put this map into the header.Next on the camel-script component  I check a particular key (a public static final attribute that I added) and if the value returned is a Map  I try to add the Map's objects with the engine.put(String  Object) method.,0,0
camel-soap - Add support for multiple parameters,camel-soap is limited to only work with one parameter.There is some code that throws an exception stating multiple parameters is not supported.We should add support for that.See nabblehttp://camel.465427.n5.nabble.com/Multiple-parameters-in-CXF-service-method-tp4386208p4386208.html,0,0
Dumping route to XML created by Java DSL using an expression may not output the actual used expression,See this unit testManagedCamelContextDumpRoutesAsXmlTestThe route in Java DSL from('seda:bar').routeId('myOtherRoute') .filter().header('bar') .to('mock:bar') .end();And the output in XML &lt;route group='org.apache.camel.management.ManagedCamelContextDumpRoutesAsXmlTest$1' id='myOtherRoute'&gt; &lt;from uri='seda:bar'/&gt; &lt;filter id='filter1'&gt; &lt;expressionDefinition/&gt; &lt;to uri='mock:bar' id='to2'/&gt; &lt;/filter&gt; &lt;/route&gt;The same example created by Spring XML  outputs the XML correct,0,0
Add send body operations to managed CamelContext so you can pass in headers as well,Currently we only support sendBody / requestBody on ManagedCamelContext. We should add operations that includes a map of headers. Then we supports sending a message that has headers as well.Also the existing operations should accept a java.lang.Object as body instead of a fixed String.,0,0
Spring-WS producer doesn't propagate headers,The Spring-WS producer only sets the body of the exchange  headers aren't propagated.See Nabble: http://camel.465427.n5.nabble.com/spring-ws-component-not-propagating-in-headers-to-out-message-td4393731.html,0,0
Updated Hazelcast to version 1.9.3,Updated Hazelcast to version 1.9.3. This offers some major bugfixes in Hazelcast and new functionality in the camel camponent (e.g. list inserting by index).,0,0
Java DSL - New means to explicitly end try/catch blocks,We are facing a problem with split() in combination with doTry/doCatch().Could you add a method 'endDoTry()' to the ProcessorDefinition? My use case is this: @Override public void configure() throws Exception { from('timer://myTimer?period=10000) .log('begin') .setBody(constant('x y z')) .doTry() .log('processing') .split(body()) .log('split') .end() .endDoTry() // would need some way like this to get back to the TryDefinition .doCatch(Exception.class) .log('Exception') .end(); }I tested this by adding endDoTry() to the ProcessorDefinition  and it works just fine. public TryDefinition endDoTry() { return (TryDefinition) this; }An endDoCatch in the TryDefinition would be great too. Is it possible that these endXXX() methods get added to 2.6.0  not just 2.7.0 or trunk?See also: http://camel.465427.n5.nabble.com/Route-with-choice-and-split-td4375184.html,0,0
Camel FTP component fails to process multiple files at once from a specified folder,Camel FTP component fails to process multiple files at once from a specified folder (let's assume the folder is /in).When the consumer connects to a ftp account and finds a list of  let's say  3 files  it will try to retrieve them in parallel but this is not handled properly.As you can see from the below FTP server log  this is what Camel FTP does: it changes the current directory to /in retrieves the file it changes the current directory to / the second (probably) thread changes the directory to /in retreives the second file the first (probably) thread sends a delete command but it sends it as if it were in the root folder but it is actually in the /in folder the FTP gives an error that the file doesn't exist somehow the FTP Component blocks itself on the first file...See my comments in the following log starting with *****(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; 257 '/' is current directory.(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; CWD in(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; 250 CWD successful. '/in' is current directory.(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; PASV(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; 227 Entering Passive Mode (192 168 0 25 228 206)(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; RETR WS_1001_1.xml(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; 150 Connection accepted(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; SSL connection for data connection established(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; 226 Transfer OK(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; CWD /(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; 250 CWD successful. '/' is current directory.(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; PWD(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; 257 '/' is current directory.(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; CWD in(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; 250 CWD successful. '/in' is current directory.(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; PASV(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; 227 Entering Passive Mode (192 168 0 25 228 207)(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; RETR WS_1001_2.xml(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; 150 Connection accepted(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; DELE in/WS_1001_1.xml ***** The location is already /in  should be DELE WS_1001_1.xml(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; 550 File not found(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; PASV(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; 227 Entering Passive Mode (192 168 0 25 228 208)(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; NLST in(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; 550 Directory not found(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; PWD(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; 257 '/in' is current directory.(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; CWD in ***** Current directory is already /in(002386)5/20/2011 17:07:03 PM - sftp-test (192.168.0.194)&gt; 550 CWD failed. '/in/in': directory not found.For the whole FTP server logs go here: http://pastie.org/private/kknnkxpbyzqmai7gsm8z5gFor the Servicemix/Camel(Trace) log: http://pastie.org/private/eulookxiepan3nkjyu41aA workaround that seems to work is to use the maxMessagesPerPoll=1 option.,0,0
cxf:rsServer requires class instead of interface in the serviceClass attribute,Here are part of the conversation from the mailing list:1.Hi there I'm using apache-servicemix-4.3.1-fuse-01-09 and I need to consume RESTful requests.Here is the documentation I have used: http://camel.apache.org/cxfrs.htmlHere is my configuration file&lt;beans xmlns='http://www.springframework.org/schema/beans' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:jaxrs='http://cxf.apache.org/jaxrs' xmlns:cxf='http://camel.apache.org/schema/cxf' xsi:schemaLocation=' http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/camel-cxf.xsd '&gt; &lt;import resource='classpath:META-INF/cxf/cxf.xml' /&gt; &lt;import resource='classpath:META-INF/cxf/cxf-extension-jaxrs-binding.xml' /&gt; &lt;import resource='classpath:META-INF/cxf/cxf-extension-http.xml' /&gt; &lt;import resource='classpath:META-INF/cxf/osgi/cxf-extension-osgi.xml' /&gt; &lt;cxf:rsServer id='myServer' address='/' serviceClass='org.test.MyService' /&gt; &lt;camelContext id='camel' xmlns='http://camel.apache.org/schema/spring'&gt; &lt;route&gt; &lt;from uri='cxfrs://bean:myServer?exchangePattern=InOut'/&gt; &lt;transform&gt; &lt;constant&gt;Hello World!!!&lt;/constant&gt; &lt;/transform&gt; &lt;/route&gt; &lt;/camelContext&gt;&lt;/beans&gt;Here is implementation of org.test.MyService@Path('/service')@Produces('application/json')public class MyService { @POST @Path('/resource') public Response add(@QueryParam('res') String res) { return Response.ok(new Status('The Resource has been processed')).build(); }}I'm wondering why we have to specify the serviceClass attribute and why this attribute should point at the real class. I'm asking because the response of such a service will always be 'Hello World!!!' and implementation of MyService.add method does not matter in that case.2.Hi Ben You are right  the serviceClass is just used to build up the JAXRS service module. And Camel CXF RS Consumer doesn't all serviceClass instance at the end  it just route the request to the camel route.3. Hi Willem  BenThanks for the information.I tried to use the interface instead of class in the serviceClass attribute and I didn't succeed because of an exception that told that the class is required.Here is the exception:Caused by: java.lang.RuntimeException: Resource class interface org.test.MyService has no valid constructor at org.apache.cxf.jaxrs.lifecycle.PerRequestResourceProvider.&lt;init&gt;(PerRequestResourceProvider.java:45) at org.apache.cxf.jaxrs.JAXRSServerFactoryBean.updateClassResourceProviders(JAXRSServerFactoryBean.java:338) at org.apache.cxf.jaxrs.JAXRSServerFactoryBean.create(JAXRSServerFactoryBean.java:119) ... 26 moreI think that using an interface would be better in that case.,0,0
Replace the NoCacheStorage Class,The NoCacheStorage class can safely be replaced by FreeMarker's NullCacheStorage class (created per my suggestion based on our needs in Camel) introduced in 2.3.16.,0,0
ConcurrentModificationException at DefaultCamelContext.getRouteDefinition(),Similar to CAMEL-3493 there is also a race in getRouteDefinition()java.util.ConcurrentModificationException at java.util.AbstractList$Itr.checkForComodification(AbstractList.java:372)[:1.6.0_21] at java.util.AbstractList$Itr.next(AbstractList.java:343)[:1.6.0_21] at org.apache.camel.impl.DefaultCamelContext.getRouteDefinition(DefaultCamelContext.java:1098)[cih-core-1.0.jar:1.0] at com.tieto.cih.core.main.GatewayRouteSetup.startGatewayRoutes(GatewayRouteSetup.java:86)[cih-core-1.0.jar:1.0] at com.tieto.cih.core.main.GatewayRouteSetup.process(GatewayRouteSetup.java:73)[cih-core-1.0.jar:1.0]As route count could be quite large  it would be nice to have them stored in synchronized map or something like that instead of list.,0,0
Issue using errorBuilderRef with the xml dsl,While fixing issues around the errorHandler I noticed that &lt;onException&gt; definitions defined in the camel context are ignored if a route specifies its own errorHandlerRef. The reason is that we set the onException definition on the default error handler. I have a fix for that  but I discovered a different issue (I think) for which I would like to discuss the solution.When we have an onException definition that looks kinda like this:&lt;onException&gt; &lt;exception&gt; java.lang.IllegalArgumentException&lt;/exception&gt; &lt;to uri='mock:illegalArgumentException'/&gt;&lt;/onException&gt;... something happens  the IAE exception is caught  we do something  but in that process another exception is thrown. Currently  that would be caught by the default error handler  which may not be what we want.What error handler (if any) should handle exceptions thrown while in onException?The onException mechanism is somewhat similar to a try/catch. I don't think the exceptions thrown while handling onException should be handled by the same error handler configured for the route  or even the context scoped one. The processing should be very simple  predictable and immutable. Since the default 'CamelDefaultErrorHandlerBuilder' can be replaced  it is not imho a solution and we need one global one that does as little as possible (the problem would be agreeing what that is: no redeliveries  logging or not  etc).Thoughts?,0,0
Loop EIP - Add copy option to let it start next loop with a copy of the original exchange,The Loop EIP will use pipes and filters. So if you loop 3 times  then on the 2nd and 3rd time its the output from the previous processing that is being used.We should add an option so people can use a copy of the original exchange instead  so its the same copy being looped on each iteration.The wiki documentation should be updated to describe the difference in these two modes.See nabblehttp://camel.465427.n5.nabble.com/Loop-usage-tp4432628p4432628.html,0,0
ChoiceProcessor : unable to find the mBeans processor,Using the jconsole  we are not able to locate some processors after a ChoiceProcessor.For example :from('direct:start').to('mock:test1').id('mock1').choice().when(predicate).to('mock:test2').id('test2').otherwise().to('mock:test3').id('test3').end().to('mock:outOfChoice').id('outOfChoice');The processors mock1 and outOfChoice are well found but not the processors test2 and test3.,0,0
javax.script dependency in camel-core,The OSGi imports for camel-core ends up with a non-optional dependency on javax.script due to it being used in the Activator. However  the karaf feature for camel-core doesn't have a dependency on org.apache.servicemix.specs.scripting-api-1.0 .One of two things should be done:1) mark javax.script as optional. This MAY require some updates to the Activator to work when it's not available.2) Update the karaf features file to add:&lt;bundle dependency='true'&gt;mvn:org.apache.servicemix.specs/org.apache.servicemix.specs.scripting-api-1.0/${servicemix-specs-version}&lt;/bundle&gt;,0,0
continued(true) doesn't work when is invoked for the second time in the Camel flow,When Camel flow contains error handling as continued(true)  it is not invoked when the error occurs for the second time (even in different onException).What is more the exception is not handled even by global onException and Camel flow is interruped.,0,0
Test failures in camel-hdfs on windows as Streams are not closed correctly,On windows some hdfs tests fail as the streams are not correctly being closed. The first stacktrace looks like below. This is a bit misleading as in fact the problem is that not all exchanges could be processed. The reason is that the file component can´t rename the file as it is still open. This is because an inputStream is opened for the file but never closed.junit.framework.AssertionFailedError: expected:&lt;40&gt; but was:&lt;12&gt; at junit.framework.Assert.fail(Assert.java:47) at junit.framework.Assert.failNotEquals(Assert.java:283) at junit.framework.Assert.assertEquals(Assert.java:64) at junit.framework.Assert.assertEquals(Assert.java:195) at junit.framework.Assert.assertEquals(Assert.java:201) at org.apache.camel.component.hdfs.HdfsProducerFileWriteTest.testSimpleWriteFile(HdfsProducerFileWriteTest.java:72) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41) at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20) at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31) at org.junit.rules.TestWatchman$1.evaluate(TestWatchman.java:48) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50) at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193) at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52) at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191) at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42) at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31) at org.junit.runners.ParentRunner.run(ParentRunner.java:236) at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:49) at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197),0,1
Create camel-quartz2 component to support Quartz 2.1.x,Quartz 2.0.1 has been released. We should upgrade the camel-quartz to use that version.There is an OSGi bundle in the works  to be pushed to central repo:http://repo2.maven.org/maven2/org/apache/servicemix/bundles/org.apache.servicemix.bundles.quartz/Also there is a SMX tickethttps://issues.apache.org/jira/browse/SMXCOMP-884,0,0
FileIdempotentRepository fileStore does not get loaded on bootrapping  therefore files are processed again,I am using JVM based initialization of Camel using Spring.I use the documented Camel initialization procedure of main.setApplicationContext('my-spring-camel-config.xml');main.start()I also use the documented FileIdempotentRepository that points to a FileStore.However  when Camel initializes this filestore is not loaded up. Hence  the LRU cache contained within this is empty.As a result  all my files are FTPed again from the remote server.This happens everytime I start my JVM resulting in expensive FTP of files.,0,1
XML DSL having attributes that is a Class type should be a String type instead and use ClassResolver to lookup the class,In the XML DSL  some of the EIPs etc. have an attribute where you can configure a Class&lt;?&gt; type. For example &lt;xpath&gt; has a resultType attribute. The XSD type is a xs:string.The problem is JAXB can only convert the xs:string to a Class&lt;?&gt; if the class can be loaded by JAXB/JDK. This may not work to well with custom types in OSGi / JBoss etc. Instead we should use ClassResolver from CamelContext to lookup those classes  as it works in OSGI/blueprint/JBoss etc.,0,0
In doTry .. doCatch .. doFinally the FAILURE_ENDPOINT details should be available as well in case an exception was thrown,In doCatch you have access to the caught exception using the exchange property CAUGHT_EXCEPTION. But we should also make FAILURE_ENDPOINT available as well. This information is present when you use onException / errorHandler. So we should make this consistent  and be avail in doCatch / doFinally as well.,0,0
Error using multiple error handlers and onException (java.lang.IllegalStateException: SendProcessor has not been started),When we use more than one errorHandler in our routes and onException  we face test failures with the following exception:java.lang.IllegalStateException: SendProcessor has not been started: sendTo(Endpoint&#91;mock://custom&#93;) at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:94)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:99)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:299)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:208)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:269)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.processor.RedeliveryErrorHandler.deliverToFailureProcessor(RedeliveryErrorHandler.java:621)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:242)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:208)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:269)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:109)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:68)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.component.seda.SedaConsumer.sendToConsumers(SedaConsumer.java:189)&#91;camel-core-2.7.2.jar:2.7.2&#93; at org.apache.camel.component.seda.SedaConsumer.run(SedaConsumer.java:121)&#91;camel-core-2.7.2.jar:2.7.2&#93; at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&#91;:1.6.0_20&#93; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&#91;:1.6.0_20&#93;,0,0
Refactorings in camel-cxf,There are some dependency cycles between packages in camel-cxf. Also some classes could need a bit internal cleanup. I open this ticket so my different commits around this can be seen in context.,0,0
SpringWebserviceConsumer should check if there is an Exception connected to the exchange and throw that one if it exists so that the default Errorhandling in spring-ws can take place,If an Exception is thrown in the camel flow then that exception is not propagated to spring-web-services.Example: &lt;camel:from uri='spring-ws:rootqname:{foo.com}BarRequest?endpointMapping=#endpointMapping'/&gt; &lt;camel:to uri='bean:exceptionThrower?method=throwException'/&gt;This would result in an empty response from spring web-services with a status code of 202 (accepted).If the check was made on the Exchange to see if there was an Exception thrown then that one could be rethrown and the Exception-handling in spring web services could do its magic.In SpringWebserviceConsumer add this to the invoke method: if(exchange.getException() != null){ throw exchange.getException(); },0,0
camel-sql - JDBC aggregation repository - Should use ClassResolver from Camel to load classes,The ClassLoadingAwareObjectInputStream should use the classResolver from CamelContext  which ensures better class loading on various platforms and OSGi etc.,0,1
JMX API to create/delete endpoint,we can create endpoints on the fly via the camel-web REST API; or by just sending a message to a new endpoint URI or consuming from a URI. But there is currently no JMX way to do so which is a bit of an omission.Something like...createEndpoint(String uri);would be a nice addition to the MBeans API on a ManagedCamelContext. Maybe a removeEndpoint(String uri) too would be handy.,0,0
Improve pom.xml for camel-jibx - use maven-jibx-plugin,I have a patch attached that updates the pom.xml in the camel-jibx component.1. The maven-jibx-plugin has fixed http://jira.codehaus.org/browse/JIBX-3552. Using a profile to allow a user to skip the unit tests using -Dmaven.test.skip=true. The plugin will run even if unit tests are skipped  so using a profile to correct that.,0,0
ThrottlingInflightRoutePolicy can deadlock,Using ThrottlingInflightRoutePolicy can deadlock a route in some situations. The unit test pasted in below shows one such situation.What happens is that the bottom route processes its first exchange  then suspends. Since it is suspended it will not take the next exchange from the seda queue  and so it will never check whether it should re-enable the route.Perhaps it will work by putting the check to re-enable the route in the onExchangeBegin method  if that is called even when the route is suspended?import org.apache.camel.Exchange;import org.apache.camel.Produce;import org.apache.camel.ProducerTemplate;import org.apache.camel.builder.RouteBuilder;import org.apache.camel.component.mock.MockEndpoint;import org.apache.camel.impl.DefaultInflightRepository;import org.apache.camel.impl.ThrottlingInflightRoutePolicy;import org.apache.camel.impl.ThrottlingInflightRoutePolicy.ThrottlingScope;import org.apache.camel.test.CamelTestSupport;public class ThrottleTest extends CamelTestSupport { @Produce(uri = 'direct:input') protected ProducerTemplate input; protected MockEndpoint resultEndpoint; @Override protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { public void configure() { resultEndpoint = new MockEndpoint('mock:result'); resultEndpoint.setCamelContext(getContext()); getContext().setInflightRepository(new DefaultInflightRepository() { @Override public void add(Exchange exchange) { super.add(exchange); System.out.println(' add ' + this.size()); } @Override public void remove(Exchange exchange) { super.remove(exchange); System.out.println(' remove ' + this.size()); } }); ThrottlingInflightRoutePolicy throttler = new ThrottlingInflightRoutePolicy(); throttler.setMaxInflightExchanges(1); throttler.setScope(ThrottlingScope.Context); from('direct:input') .inOnly('seda:hey'  'seda:hey'  'seda:hey'  'seda:hey'  'seda:hey') .delay(1000) .inOnly('log:inputDone'); from('seda:hey') .routePolicy(throttler) .inOut('log:outputDone') .to(resultEndpoint); } }; } public void testThatAllExchangesAreReceived() throws Exception { input.sendBody('hello'); resultEndpoint.expectedMessageCount(5); resultEndpoint.assertIsSatisfied(); }},0,1
MockEndpoint.expectedHeaderReceived checks only one header,The method MockEndpoint.expectedHeaderReceived sets one header key and one header value to check. Subsequent calls to the same method overwrites the key and value. As a (non-expert) user of the MockEndpoint  I would expect this method to work somewhat along the lines of Map.put  so that multiple headers can be expected. Alternatively  replace it with MockEndpoint.expectedHeadersReceived(Map&lt;String  Object&gt; headers) or something like that.MockEndpoint.expectedPropertyReceived has the same issue.The unit test below demonstrates the bug. Have fun import java.util.HashMap;import org.apache.camel.Produce;import org.apache.camel.ProducerTemplate;import org.apache.camel.builder.RouteBuilder;import org.apache.camel.component.mock.MockEndpoint;import org.apache.camel.test.CamelTestSupport;public class MockEndpointTest extends CamelTestSupport { @Produce(uri = 'direct:input') protected ProducerTemplate input; protected MockEndpoint resultEndpoint; @Override protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { public void configure() { resultEndpoint = new MockEndpoint('mock:result'); resultEndpoint.setCamelContext(getContext()); from('direct:input') .inOnly('log:output?showHeaders=true') .to(resultEndpoint); } }; } public void testStuff() throws Exception { HashMap&lt;String  Object&gt; headers = new HashMap&lt;String  Object&gt;();// headers.put('h1'  'hello'); headers.put('h2'  'world'); resultEndpoint.expectedHeaderReceived('h1'  'hello'); resultEndpoint.expectedHeaderReceived('h2'  'world'); input.sendBodyAndHeaders(null  headers); resultEndpoint.expectedMessageCount(1); resultEndpoint.assertIsNotSatisfied(); }},0,0
LoanBroker example have some issues when it is deployed into osgi container like ServiceMix,When you deploy the camel-example-loanbroker bundle into OSGi container  the osgi container only load the WebService route because there are some confliction of the bean ids.,0,0
Label of marshal and unmarshal processors do not appear in trace output,My route is defined as following: from(mqIn) .routeId(Helper.getRouteId(this.getClass().getName())) .errorHandler(deadLetterChannel('log:DEAD').maximumRedeliveries(1).retryAttemptedLogLevel(LoggingLevel.WARN)) .onException(EAIException.class).maximumRedeliveries(0).handled(true).to('bean:AuditBO?method=handleException').end() //.transacted('PROPAGATION_REQUIRES_NEW') .setHeader('UBS_ID' new AuditId()) .wireTap('seda:auditNew') .unmarshal('SwiftDataFormat') .setHeader('MT'  getMT) .setHeader('SWIFTAddress'  getSwiftAddress) .to(mqOut);The tracing output is the following[ main] Tracer INFO ID-w01b2bc3-3197-1309192772128-0-2 &gt;&gt;&gt; (wmswift.in.IcgToCore) wireTap(seda://auditNew) --&gt; &lt;&lt;&lt; Pattern:InOnly  Headers:{UBS_ID=5932bc56-2f7e-45cf-a2b4-ef851ff661d7}  BodyType:String  ...[ main] Tracer INFO ID-w01b2bc3-3197-1309192772128-0-2 &gt;&gt;&gt; (wmswift.in.IcgToCore) --&gt; setHeader&#91;MT&#93; &lt;&lt;&lt; Pattern:InOnly  Headers:{UBS_ID=5932bc56-2f7e-45cf-a2b4-ef851ff661d7}  BodyType:com.ubs.eai.wmswift.SwiftDataMessage  Body:com.ubs.eai.wmswift.SwiftDataMessage@91b9b0[ main] Tracer INFO ID-w01b2bc3-3197-1309192772128-0-2 &gt;&gt;&gt; (wmswift.in.IcgToCore) setHeader&#91;MT&#93; --&gt; setHeader&#91;SWIFTAddress&#93; &lt;&lt;&lt; Pattern:InOnly  Headers:{MT=502  UBS_ID=5932bc56-2f7e-45cf-a2b4-ef851ff661d7}  BodyType:com.ubs.eai.wmswift.SwiftDataMessage  Body:com.ubs.eai.wmswift.SwiftDataMessage@91b9b0[ main] Tracer INFO ID-w01b2bc3-3197-1309192772128-0-2 &gt;&gt;&gt; (wmswift.in.IcgToCore) setHeader&#91;SWIFTAddress&#93; --&gt; direct://core &lt;&lt;&lt; Pattern:InOnly  Headers:{SWIFTAddress=ZYAMCHZ0XXXX  MT=502  UBS_ID=5932bc56-2f7e-45cf-a2b4-ef851ff661d7}  BodyType:com.ubs.eai.wmswift.SwiftDataMessage  Body:com.ubs.eai.wmswift.SwiftDataMessage@91b9b0[ main] Tracer INFO ID-w01b2bc3-3197-1309192772128-0-2 &gt;&gt;&gt; (wmswift.core.CoreToMQ) direct://core --&gt; &lt;&lt;&lt; Pattern:InOnly  Headers:{SWIFTAddress=ZYAMCHZ0XXXX  MT=502  UBS_ID=5932bc56-2f7e-45cf-a2b4-ef851ff661d7}  BodyType:com.ubs.eai.wmswift.SwiftDataMessage  Body:com.ubs.eai.wmswift.SwiftDataMessage@91b9b0[ main] Tracer INFO ID-w01b2bc3-3197-1309192772128-0-2 &gt;&gt;&gt; (wmswift.core.CoreToMQ) --&gt; choice &lt;&lt;&lt; Pattern:InOnly  Headers:{MT=502  UBS_ID=5932bc56-2f7e-45cf-a2b4-ef851ff661d7  SWIFTAddress=ZYAMCHZ0XXXX}  The bug I found is the missing label of the unmarshal processor.,0,0
Add getRouteId() to TraceEventMessage,It would be good to find the routeId from the TraceEventMessage  in the case that the trace information is sent to a route.In my example  extracts from XML: &lt;bean id='CamelTracer' class='org.apache.camel.processor.interceptor.Tracer'&gt; &lt;property name='destination' ref='traced'/&gt; &lt;property name='logLevel' value='OFF'/&gt; &lt;/bean&gt; &lt;endpoint id='traced' uri='seda:auditrace?waitForTaskToComplete=Never'/&gt;And my route is: @EndpointInject(ref='traced') Endpoint traced;  @Override public void configure() throws Exception { from(traced) .routeId('util.AuditTrace') .noTracing() .to('bean:AuditBO?method=trace'); }An instance object of TraceEventMessage is sent down this route and there is no getRouteId() defined. This would make the TraceEventMessage even more helpful.,0,0
Groovy language - classNotFoundException in OSGi environment,The problem is in the following method of the GroovyLanguage@SuppressWarnings('unchecked')protected Class&lt;Script&gt; parseExpression(String expression) { return new GroovyClassLoader().parseClass(expression);}It uses the default constructor to create GroovyClassLoader  which uses Thread context classloader  which may not be equal to the classloader of the bundle where the camel context is defined.Caused by: java.lang.NoClassDefFoundError: groovy/lang/Script at java.lang.ClassLoader.defineClass1(Native Method)&#91;:1.6.0_24&#93; at java.lang.ClassLoader.defineClassCond(ClassLoader.java:632)&#91;:1.6.0_24&#93; at java.lang.ClassLoader.defineClass(ClassLoader.java:616)&#91;:1.6.0_24&#93; at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:141)&#91;:1.6.0_24&#93; at groovy.lang.GroovyClassLoader.access$300(GroovyClassLoader.java:55) at groovy.lang.GroovyClassLoader$ClassCollector.createClass(GroovyClassLoader.java:519) at groovy.lang.GroovyClassLoader$ClassCollector.onClassNode(GroovyClassLoader.java:536) at groovy.lang.GroovyClassLoader$ClassCollector.call(GroovyClassLoader.java:540) at org.codehaus.groovy.control.CompilationUnit$11.call(CompilationUnit.java:747) at org.codehaus.groovy.control.CompilationUnit.applyToPrimaryClassNodes(CompilationUnit.java:932) at org.codehaus.groovy.control.CompilationUnit.doPhaseOperation(CompilationUnit.java:509) at org.codehaus.groovy.control.CompilationUnit.processPhaseOperations(CompilationUnit.java:487) at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:464) at groovy.lang.GroovyClassLoader.doParseClass(GroovyClassLoader.java:306) at groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:287) at groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:267) at groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:214) at groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:224) at org.apache.camel.language.groovy.GroovyLanguage.parseExpression(GroovyLanguage.java:44) at org.apache.camel.language.groovy.GroovyLanguage.createExpression(GroovyLanguage.java:38) at org.apache.camel.language.groovy.GroovyLanguage.createExpression(GroovyLanguage.java:27) at org.apache.camel.component.language.LanguageProducer.process(LanguageProducer.java:41)&#91;68:org.apache.camel.camel-core:2.6.0.fuse-01-09&#93; at org.apache.camel.impl.converter.AsyncProcessorTypeConverter$ProcessorToAsyncProcessorBridge.process(AsyncProcessorTypeConverter.java:50)&#91;68:org.apache.camel.camel-core:2.6.0.fuse-01-09&#93; ... 92 moreCaused by: java.lang.ClassNotFoundException: groovy.lang.Script at java.net.URLClassLoader$1.run(URLClassLoader.java:202)&#91;:1.6.0_24&#93; at java.security.AccessController.doPrivileged(Native Method)&#91;:1.6.0_24&#93; at java.net.URLClassLoader.findClass(URLClassLoader.java:190)&#91;:1.6.0_24&#93; at java.lang.ClassLoader.loadClass(ClassLoader.java:307)&#91;:1.6.0_24&#93; at groovy.lang.GroovyClassLoader.loadClass(GroovyClassLoader.java:696)&#91;134:groovy-all:1.7.5&#93; at groovy.lang.GroovyClassLoader$InnerLoader.loadClass(GroovyClassLoader.java:449) at groovy.lang.GroovyClassLoader.loadClass(GroovyClassLoader.java:793)&#91;134:groovy-all:1.7.5&#93; at java.lang.ClassLoader.loadClass(ClassLoader.java:248)&#91;:1.6.0_24&#93; ... 115 more,0,0
Nullpointer in camel-mail when body is null,When trying to send a mail with an empty body (null) then we get the following NullPointer exception.We should instead either complain about the null body or send the mail with an empty body.13:27:27 010 | INFO | tp1062262230-101 | ache.camel.processor.CamelLogger 87 | 55 - org.apache.camel.camel-core - 2.7.1 | Exchange[ExchangePattern:InOut  BodyType:org.apache.cxf.message.MessageContentsList  Body:&#91;com.ier.ebo_servicerequest.ServiceRequestType@10e07658&#93;]13:27:27 013 | ERROR | tp1062262230-101 | ache.camel.processor.CamelLogger 232 | 55 - org.apache.camel.camel-core - 2.7.1 | Failed delivery for exchangeId: ID-MacBook-Pro-de-bahaaldine-local-51035-1309771358240-2-6. Exhausted after delivery attempt: 1 caught: org.springframework.mail.MailPreparationException: Could not prepare mail; nested exception is java.lang.NullPointerExceptionorg.springframework.mail.MailPreparationException: Could not prepare mail; nested exception is java.lang.NullPointerException at org.springframework.mail.javamail.JavaMailSenderImpl.send(JavaMailSenderImpl.java:367)&#91;49:org.springframework.context.support:3.0.5.RELEASE&#93; at org.springframework.mail.javamail.JavaMailSenderImpl.send(JavaMailSenderImpl.java:344)&#91;49:org.springframework.context.support:3.0.5.RELEASE&#93; at org.apache.camel.component.mail.MailProducer.process(MailProducer.java:44)&#91;281:org.apache.camel.camel-mail:2.7.1&#93; at org.apache.camel.impl.converter.AsyncProcessorTypeConverter$ProcessorToAsyncProcessorBridge.process(AsyncProcessorTypeConverter.java:50)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.SendProcessor$2.doInAsyncProducer(SendProcessor.java:104)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.impl.ProducerCache.doInAsyncProducer(ProducerCache.java:272)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:98)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:68)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:99)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:299)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:208)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:269)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.Pipeline.process(Pipeline.java:125)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.Pipeline.process(Pipeline.java:80)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:139)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:68)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:61)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:299)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:208)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:109)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.MulticastProcessor.doProcessSequential(MulticastProcessor.java:582)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.MulticastProcessor.doProcessSequential(MulticastProcessor.java:511)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.MulticastProcessor.process(MulticastProcessor.java:211)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.RecipientList.sendToRecipientList(RecipientList.java:134)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.RecipientList.process(RecipientList.java:102)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:68)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:99)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:269)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:109)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:68)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:103)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:85)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.component.cxf.CxfConsumer$1.syncInvoke(CxfConsumer.java:135)&#91;125:org.apache.camel.camel-cxf:2.7.1&#93; at org.apache.camel.component.cxf.CxfConsumer$1.invoke(CxfConsumer.java:77)&#91;125:org.apache.camel.camel-cxf:2.7.1&#93; at org.apache.cxf.interceptor.ServiceInvokerInterceptor$1.run(ServiceInvokerInterceptor.java:58)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)&#91;:1.6.0_24&#93; at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&#91;:1.6.0_24&#93; at java.util.concurrent.FutureTask.run(FutureTask.java:138)&#91;:1.6.0_24&#93; at org.apache.cxf.workqueue.SynchronousExecutor.execute(SynchronousExecutor.java:37)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.interceptor.ServiceInvokerInterceptor.handleMessage(ServiceInvokerInterceptor.java:106)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:263)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:118)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:208)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.transport.servlet.ServletController.invokeDestination(ServletController.java:223)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.transport.servlet.ServletController.invoke(ServletController.java:205)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.transport.servlet.CXFNonSpringServlet.invoke(CXFNonSpringServlet.java:113)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.transport.servlet.AbstractHTTPServlet.handleRequest(AbstractHTTPServlet.java:184)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.transport.servlet.AbstractHTTPServlet.doPost(AbstractHTTPServlet.java:107)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at javax.servlet.http.HttpServlet.service(HttpServlet.java:713)&#91;72:org.apache.geronimo.specs.geronimo-servlet_2.5_spec:1.1.2&#93; at org.apache.cxf.transport.servlet.AbstractHTTPServlet.service(AbstractHTTPServlet.java:163)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:534)&#91;79:org.eclipse.jetty.servlet:7.3.1.v20110307&#93; at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:476)&#91;79:org.eclipse.jetty.servlet:7.3.1.v20110307&#93; at org.ops4j.pax.web.service.jetty.internal.HttpServiceServletHandler.doHandle(HttpServiceServletHandler.java:70)&#91;84:org.ops4j.pax.web.pax-web-jetty:1.0.1&#93; at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:119)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:517)&#91;78:org.eclipse.jetty.security:7.3.1.v20110307&#93; at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:226)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:934)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.ops4j.pax.web.service.jetty.internal.HttpServiceContext.doHandle(HttpServiceContext.java:116)&#91;84:org.ops4j.pax.web.pax-web-jetty:1.0.1&#93; at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:404)&#91;79:org.eclipse.jetty.servlet:7.3.1.v20110307&#93; at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:184)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:869)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:117)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.ops4j.pax.web.service.jetty.internal.JettyServerHandlerCollection.handle(JettyServerHandlerCollection.java:72)&#91;84:org.ops4j.pax.web.pax-web-jetty:1.0.1&#93; at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.server.Server.handle(Server.java:346)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.server.HttpConnection.handleRequest(HttpConnection.java:581)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.server.HttpConnection$RequestHandler.content(HttpConnection.java:1057)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:807)&#91;75:org.eclipse.jetty.http:7.3.1.v20110307&#93; at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:220)&#91;75:org.eclipse.jetty.http:7.3.1.v20110307&#93; at org.eclipse.jetty.server.HttpConnection.handle(HttpConnection.java:411)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:526)&#91;74:org.eclipse.jetty.io:7.3.1.v20110307&#93; at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:41)&#91;74:org.eclipse.jetty.io:7.3.1.v20110307&#93; at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:528)&#91;73:org.eclipse.jetty.util:7.3.1.v20110307&#93; at java.lang.Thread.run(Thread.java:680)&#91;:1.6.0_24&#93;Caused by: java.lang.NullPointerException at javax.mail.util.ByteArrayDataSource.&lt;init&gt;(ByteArrayDataSource.java:137)&#91;69:javax.mail:1.4.3&#93; at org.apache.camel.component.mail.MailBinding.populateContentOnMimeMessage(MailBinding.java:205)&#91;281:org.apache.camel.camel-mail:2.7.1&#93; at org.apache.camel.component.mail.MailBinding.populateMailMessage(MailBinding.java:114)&#91;281:org.apache.camel.camel-mail:2.7.1&#93; at org.apache.camel.component.mail.MailProducer$1.prepare(MailProducer.java:46)&#91;281:org.apache.camel.camel-mail:2.7.1&#93; at org.springframework.mail.javamail.JavaMailSenderImpl.send(JavaMailSenderImpl.java:352)&#91;49:org.springframework.context.support:3.0.5.RELEASE&#93; ... 98 more13:27:27 023 | WARN | tp1062262230-101 | ache.cxf.common.logging.LogUtils 371 | - - | Interceptor for {http://www.ier.com/WS_ServiceRequest}WSServiceRequestService#{http://www.ier.com/WS_ServiceRequest}createServiceRequest has thrown exception  unwinding noworg.apache.cxf.interceptor.Fault: Could not prepare mail; nested exception is java.lang.NullPointerException at org.apache.camel.component.cxf.CxfConsumer$1.checkFailure(CxfConsumer.java:218)&#91;125:org.apache.camel.camel-cxf:2.7.1&#93; at org.apache.camel.component.cxf.CxfConsumer$1.setResponseBack(CxfConsumer.java:195)&#91;125:org.apache.camel.camel-cxf:2.7.1&#93; at org.apache.camel.component.cxf.CxfConsumer$1.syncInvoke(CxfConsumer.java:142)&#91;125:org.apache.camel.camel-cxf:2.7.1&#93; at org.apache.camel.component.cxf.CxfConsumer$1.invoke(CxfConsumer.java:77)&#91;125:org.apache.camel.camel-cxf:2.7.1&#93; at org.apache.cxf.interceptor.ServiceInvokerInterceptor$1.run(ServiceInvokerInterceptor.java:58)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)&#91;:1.6.0_24&#93; at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&#91;:1.6.0_24&#93; at java.util.concurrent.FutureTask.run(FutureTask.java:138)&#91;:1.6.0_24&#93; at org.apache.cxf.workqueue.SynchronousExecutor.execute(SynchronousExecutor.java:37)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.interceptor.ServiceInvokerInterceptor.handleMessage(ServiceInvokerInterceptor.java:106)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:263)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:118)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:208)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.transport.servlet.ServletController.invokeDestination(ServletController.java:223)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.transport.servlet.ServletController.invoke(ServletController.java:205)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.transport.servlet.CXFNonSpringServlet.invoke(CXFNonSpringServlet.java:113)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.transport.servlet.AbstractHTTPServlet.handleRequest(AbstractHTTPServlet.java:184)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.apache.cxf.transport.servlet.AbstractHTTPServlet.doPost(AbstractHTTPServlet.java:107)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at javax.servlet.http.HttpServlet.service(HttpServlet.java:713)&#91;72:org.apache.geronimo.specs.geronimo-servlet_2.5_spec:1.1.2&#93; at org.apache.cxf.transport.servlet.AbstractHTTPServlet.service(AbstractHTTPServlet.java:163)&#91;124:org.apache.cxf.bundle:2.4.0&#93; at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:534)&#91;79:org.eclipse.jetty.servlet:7.3.1.v20110307&#93; at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:476)&#91;79:org.eclipse.jetty.servlet:7.3.1.v20110307&#93; at org.ops4j.pax.web.service.jetty.internal.HttpServiceServletHandler.doHandle(HttpServiceServletHandler.java:70)&#91;84:org.ops4j.pax.web.pax-web-jetty:1.0.1&#93; at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:119)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:517)&#91;78:org.eclipse.jetty.security:7.3.1.v20110307&#93; at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:226)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:934)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.ops4j.pax.web.service.jetty.internal.HttpServiceContext.doHandle(HttpServiceContext.java:116)&#91;84:org.ops4j.pax.web.pax-web-jetty:1.0.1&#93; at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:404)&#91;79:org.eclipse.jetty.servlet:7.3.1.v20110307&#93; at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:184)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:869)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:117)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.ops4j.pax.web.service.jetty.internal.JettyServerHandlerCollection.handle(JettyServerHandlerCollection.java:72)&#91;84:org.ops4j.pax.web.pax-web-jetty:1.0.1&#93; at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.server.Server.handle(Server.java:346)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.server.HttpConnection.handleRequest(HttpConnection.java:581)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.server.HttpConnection$RequestHandler.content(HttpConnection.java:1057)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:807)&#91;75:org.eclipse.jetty.http:7.3.1.v20110307&#93; at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:220)&#91;75:org.eclipse.jetty.http:7.3.1.v20110307&#93; at org.eclipse.jetty.server.HttpConnection.handle(HttpConnection.java:411)&#91;77:org.eclipse.jetty.server:7.3.1.v20110307&#93; at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:526)&#91;74:org.eclipse.jetty.io:7.3.1.v20110307&#93; at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:41)&#91;74:org.eclipse.jetty.io:7.3.1.v20110307&#93; at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:528)&#91;73:org.eclipse.jetty.util:7.3.1.v20110307&#93; at java.lang.Thread.run(Thread.java:680)&#91;:1.6.0_24&#93;Caused by: org.springframework.mail.MailPreparationException: Could not prepare mail; nested exception is java.lang.NullPointerException at org.springframework.mail.javamail.JavaMailSenderImpl.send(JavaMailSenderImpl.java:367)&#91;49:org.springframework.context.support:3.0.5.RELEASE&#93; at org.springframework.mail.javamail.JavaMailSenderImpl.send(JavaMailSenderImpl.java:344)&#91;49:org.springframework.context.support:3.0.5.RELEASE&#93; at org.apache.camel.component.mail.MailProducer.process(MailProducer.java:44)&#91;281:org.apache.camel.camel-mail:2.7.1&#93; at org.apache.camel.impl.converter.AsyncProcessorTypeConverter$ProcessorToAsyncProcessorBridge.process(AsyncProcessorTypeConverter.java:50)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.SendProcessor$2.doInAsyncProducer(SendProcessor.java:104)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.impl.ProducerCache.doInAsyncProducer(ProducerCache.java:272)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:98)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:68)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:99)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:299)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:208)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:269)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.Pipeline.process(Pipeline.java:125)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.Pipeline.process(Pipeline.java:80)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:139)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:68)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:61)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:299)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:208)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:109)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.MulticastProcessor.doProcessSequential(MulticastProcessor.java:582)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.MulticastProcessor.doProcessSequential(MulticastProcessor.java:511)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.MulticastProcessor.process(MulticastProcessor.java:211)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.RecipientList.sendToRecipientList(RecipientList.java:134)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.RecipientList.process(RecipientList.java:102)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:68)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:99)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:269)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:109)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:77)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:68)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:103)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:85)&#91;55:org.apache.camel.camel-core:2.7.1&#93; at org.apache.camel.component.cxf.CxfConsumer$1.syncInvoke(CxfConsumer.java:135)&#91;125:org.apache.camel.camel-cxf:2.7.1&#93; ... 41 moreCaused by: java.lang.NullPointerException at javax.mail.util.ByteArrayDataSource.&lt;init&gt;(ByteArrayDataSource.java:137)&#91;69:javax.mail:1.4.3&#93; at org.apache.camel.component.mail.MailBinding.populateContentOnMimeMessage(MailBinding.java:205)&#91;281:org.apache.camel.camel-mail:2.7.1&#93; at org.apache.camel.component.mail.MailBinding.populateMailMessage(MailBinding.java:114)&#91;281:org.apache.camel.camel-mail:2.7.1&#93; at org.apache.camel.component.mail.MailProducer$1.prepare(MailProducer.java:46)&#91;281:org.apache.camel.camel-mail:2.7.1&#93; at org.springframework.mail.javamail.JavaMailSenderImpl.send(JavaMailSenderImpl.java:352)&#91;49:org.springframework.context.support:3.0.5.RELEASE&#93; ... 98 more,0,0
Using adviceWith 2 times or more in Java DSL with a context scoped onException causing the 1st advised route to not work as expected,See nabblehttp://camel.465427.n5.nabble.com/intercept-using-adviceWith-tp4520468p4520468.html,0,0
A name should be specified in the karaf features-file,When doing a features:list in karaf  the repository for camel is listed as repo-0  which looks ugly to me. It would be better if it were given a name on the form camel-${pom.version}  similar to the names used by other projects such as Karaf and ActiveMQ.,0,0
Add Lazy Connection to XMPP,We are trying to use XMPP as an endpoint but we have a serious problem.If the XMPP server is inaccessible  we cannot start Camel - it just issues a FailedToCreateProducerException exception and shuts itself down.Given we are running Camel from an ActiveMQ instance this prevents critical infrastructure from being restarted when our XMPP server is offline.,0,0
Added wrap method for template  consumer and context in org.apache.camel.test.junit4.CamelContextSupport,User complain about the change of CAMEL-3960 causes some issue when using the CamelTestSupport in scala.A simple solution is add some wrap method to get the value protected static member.Here is the mail thread&#91;1&#93; of it.&#91;1&#93;http://camel.465427.n5.nabble.com/CamelTestSupport-template-variable-missing-changed-in-2-8-0-td4587700.html,0,0
avoid runtime package scanning to discover TypeConverters,Package scanning to discover classes annotated with @Converter is slow. Plus on many containers (especially commercial JEE containers) its not even possible; since ClassLoader.getResource() doesn't often return file system based URIs you can easily convert to a java.io.File so you can list files in a directory.Finding known resources/classes in class loaders generally works; scanning packages is generally more problematic - as well as being slow.So it would be better if Camel could use a text file per jar containing all the fully qualified class names of the converters to use. Then no package scanning is required. Or rather we only need to use package scanning if a text file contains packages (rather than fully qualified classes). i.e. do the package scanning at build time (when you have full access to the file system  rather than at runtime when you generally don't have access to the files - and expanding jars to look inside them is awfully slow.In addition it'd be great if we added a maven plugin - or Java compiler AnnotationProcessor we can use with the compile step - to generate the META-INF/services/org/apache/camel/TypeConverter file automatically as part of the build. Then users don't even have to think about it; they just add @Converter to a class and the plugin generates the text file as part of the build.  using fully qualified class names - so no package scanning required at runtime - and much faster startup times too,0,1
When performing lookup in registry and having expected type as parameter  then report better failure if ClassCastException,When Camel lookup in the registry  it may lookup in different runtime registries  such as OSGi blueprint. If an explicit type has been provided as a parameter you will get a ClassCastException if the type does not match. But you cannot see which types was a stake. So we should provide a better exception.Caused by: java.lang.ClassCastException at java.lang.Class.cast(Class.java:2990)&#91;:1.6.0_24&#93; at org.apache.camel.blueprint.BlueprintContainerRegistry.lookup(BlueprintContainerRegistry.java:43) at org.apache.camel.impl.CompositeRegistry.lookup(CompositeRegistry.java:47) at org.apache.camel.impl.PropertyPlaceholderDelegateRegistry.lookup(PropertyPlaceholderDelegateRegistry.java:54) ... 42 more,0,0
Archetypes fail to build in offline mode,If build tooling/archetypes with the --offline Maven argument you may see an error like&#91;ERROR&#93; Unresolveable build extension: Error resolving version for plugin 'org.apache.maven.archetype:archetype-packaging'Seems the version for archetype-packaging in the dependencyManagement section defined in the parent pom is not propagating down to build extension... when Maven is not in offline mode it can simply grab the latest version from the metadata at central. I'm committing a simple fix shortly.,0,0
TraceInterceptor does not work correctly for AsyncProcessing,TraceEventHandlers are not called correctly when a node is processed asynchronously.From org.apache.camel.processor.interceptor.TraceInterceptor: try { // special for interceptor where we need to keep booking how far we have routed in the intercepted processors if (node.getParent() instanceof InterceptDefinition &amp;&amp; exchange.getUnitOfWork() != null) { TracedRouteNodes traced = exchange.getUnitOfWork().getTracedRouteNodes(); traceIntercept((InterceptDefinition) node.getParent()  traced  exchange); } // process the exchange try { sync = super.process(exchange  callback); } catch (Throwable e) { exchange.setException(e); } } finally { // after (trace out) if (shouldLog &amp;&amp; tracer.isTraceOutExchanges()) { logExchange(exchange); traceExchangeOut(exchange  traceState); } }As it is this results in traceExchangeOut being called before the callback  which is wrong.The call to super.process needs to wrap the callback to call traceExchangeOut (and the finally block shouldn't run if the process is asynch).This isn't a regression  but the change to make more routes asynchronous makes it more noticeable.,0,0
camel-ftp - Using tempFileName option should use the separator option to allow control of path separators in the generated file name,See nabblehttp://camel.465427.n5.nabble.com/FTP-temp-file-not-being-created-correctly-on-Windows-Camel-2-7-2-tp4591581p4591581.html,0,0
Missing setter or constructor-argument for elementNameStrategyRef in SoapJaxbDataFormat,Because the variable 'elementNameStrategyRef' in org.apache.camel.dataformat.soap.SoapJaxbDataFormat can't be set  it is always null. Therefore declaring the data format with spring-dsl leads to an automatic fallback to the default strategy 'TypeNameStrategy' in org.apache.camel.dataformat.soap.SoapJaxbDataFormat.checkElementNameStrategy(Exchange exchange). This further leads to wrong results when marshalling.So the following declararion does not work correctly:... &lt;bean id='myStrategy' class='org.apache.camel.dataformat.soap.name.ServiceInterfaceStrategy'&gt; &lt;constructor-arg value='my.package.MyServiceInterface'/&gt; &lt;constructor-arg value='true'/&gt; &lt;/bean&gt;... &lt;camelContext xmlns='http://camel.apache.org/schema/spring'&gt;... &lt;dataFormats&gt; &lt;soapjaxb id='mySoap'  contextPath='my.package'  elementNameStrategyRef='myStrategy'/&gt; &lt;/dataFormats&gt;... &lt;route&gt; &lt;from uri='cxf:/MyService?serviceClass=my.package.MyServiceInterface' /&gt;... &lt;convertBodyTo type='my.package.MyType'/&gt; &lt;marshal ref='mySoap'/&gt;...,0,0
Expose setDeliveryMode property in org.apache.camel.component.jms.JmsComponent,It would be beneficial if org.apache.camel.component.jms.JmsComponent would allow to specify JMS deliveryMode explicitly. Currently  from what I can tell  there is only boolean deliveryPersistent property which is not enough if JMS provider supports additional non-standard delivery modes. Example is Tibco EMS RELIABLE_DELIVERY mode.,0,0
Properties component - Cached locations may add duplicates,See nabblehttp://camel.465427.n5.nabble.com/LRUCache-memory-leak-when-using-camel-properties-file-tp4621357p4621357.htmlThe internal cache should be a soft cache and we should use a key holder to ensure equals/hashCode,0,1
The routeContext stack of DefaultUnitOfWork should be thread safe,Here is the stack tracejava.util.EmptyStackException at java.util.Stack.peek(Stack.java:85) at java.util.Stack.pop(Stack.java:67) at org.apache.camel.impl.DefaultUnitOfWork.popRouteContext(DefaultUnitOfWork.java:226) at org.apache.camel.processor.DefaultChannel$1.done(DefaultChannel.java:260) at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:330) at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:208) at org.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:256) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:70) at org.apache.camel.processor.Pipeline.process(Pipeline.java:143) at org.apache.camel.processor.Pipeline.process(Pipeline.java:78) at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:113) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:91) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:85) at org.apache.camel.processor.aggregate.AggregateProcessor$1.run(AggregateProcessor.java:397) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303) at java.util.concurrent.FutureTask.run(FutureTask.java:138) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:619)You can find more information in this mail thread&#91;1&#93;&#91;1&#93;http://camel.465427.n5.nabble.com/EmptyStackException-in-DefaultUnitOfWork-popRouteContext-td4630106.html,0,0
Camel-AWS: Add support for adding CacheControl and ContentDisposition metadata support when uploading file,Add support for setting the CacheControl and ContentDisposition metadata information for the object.Proposed Implementation:1) Add two new headers: CamelAwsS3CacheControl and CamcelAwsS3ContentDisposition. 2) Add corresponding enumerations in S3Constants3) Set the corresponding data into PutObjectRequest in S3Producer.,0,0
Connection to sftp server occasionally don't want to come back,Problem appear if somebody kill logged on user on sftp server while you are connected with consumer.Camel is not able to reconnect on next poll even if it says that it will do this.RemoteFileConsumer is not connected but it thinks that it is still logged in.I think 'loggedIn' flag should be down after each disconnecting action like in attached patch.2011-07-24 22:35:14 848 WARN &#91;RemoteFilePollingConsumerPollStrategy:37&#93; Trying to recover by disconnecting from remote server forcing a re-connect at next poll: sftp://test@host 2011-07-24 22:35:14 849 WARN &#91;RemoteFilePollingConsumerPollStrategy:52&#93; Consumer Consumer&#91;sftp://test@host/test?delay=60000&amp;delete=true&amp;localWorkDirectory=%2Fvar%2Ftest%2Ftemp&amp;password=xxxx&amp;throwExceptionOnConnectFailed=true&#93; could not poll endpoint: sftp://test@host/test?delay=60000&amp;delete=true&amp;localWorkDirectory=%2Fvar%2Ftest%2Ftemp&amp;password=xxxx&amp;throwExceptionOnConnectFailed=true caused by: Cannot change directory to: test org.apache.camel.component.file.GenericFileOperationFailedException: Cannot change directory to: test at org.apache.camel.component.file.remote.SftpOperations.doChangeDirectory(SftpOperations.java:408) at org.apache.camel.component.file.remote.SftpOperations.changeCurrentDirectory(SftpOperations.java:393) at org.apache.camel.component.file.remote.SftpConsumer.doPollDirectory(SftpConsumer.java:77) at org.apache.camel.component.file.remote.SftpConsumer.pollDirectory(SftpConsumer.java:49) at org.apache.camel.component.file.GenericFileConsumer.poll(GenericFileConsumer.java:83) at org.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:97) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:317) at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:150) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:98) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:180) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:204) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:662)Caused by: 4:  at com.jcraft.jsch.ChannelSftp.cd(ChannelSftp.java:285) at org.apache.camel.component.file.remote.SftpOperations.doChangeDirectory(SftpOperations.java:406) ... 14 moreCaused by: java.io.IOException: Pipe closed at java.io.PipedInputStream.read(PipedInputStream.java:291) at java.io.PipedInputStream.read(PipedInputStream.java:361) at com.jcraft.jsch.ChannelSftp.fill(ChannelSftp.java:2333) at com.jcraft.jsch.ChannelSftp.header(ChannelSftp.java:2359) at com.jcraft.jsch.ChannelSftp._realpath(ChannelSftp.java:1819) at com.jcraft.jsch.ChannelSftp.cd(ChannelSftp.java:268) ... 15 more,0,0
camel-jdbc should provide a option not set the autoCommit flag,When the jdbc connection is work as XA resource  the connection autoCommit flag doesn't support to be reset.So we should provide an option in the camel-jdbc endpont not to set the autoCommit flag on the connection.,0,0
MDCUnitOfWork behaviour incorrect with nested routes,MDCUnitOfWork.clear() removes any content set by MDCUnitOfWork from MDC.If there are two separate exchange running at the same time in the same thread  as happens when a ProduceTemplate is used from Java  this is incorrect because the MDC of the parent is cleared after the child completes.Conceptually the MDC should be a stack  but MDC only accepts strings so the simplest thing to do is for MDCUnitOfWork to replace the previous values in clear().,0,0
Camel archetypes and examples should enable JMX for ActiveMQ,The camel-activemq archetype setup an embedded AMQ broker which has JMX disabled.We should check all our examples and archetypes that JMX is enabled for AMQ when its embedded.As it may confuse end users that they can see Camel in JMX  but not AMQ.,0,0
dump as xml fails if message body is already xml,MessageHelper.dumpAsXml has a problem if the message body is already xml.,0,0
camel-aws won't build offline,If you build camel-aws in Maven's offline mode (-o)  you may get the following error:No versions available for org.codehaus.jackson:jackson-core-asl:jar:[1.4 ) within specified rangeThis will occur even if you have the libs locally. This is happening because Maven cannot download the remote metadata to get a list of versions for jackson-core-asl. Specifying a hard version for this (not a range) gets around the issue. Committing a fix shortly.,0,0
@Bean method name is ignored,Since 2.8.0 Exchange.BEAN_METHOD_NAME is always used instead of @Bean method name (see BeanInfo.createInvocation(Object pojo  Exchange exchange)). As a consequence  the wrong method is choosen when I use a beanref invokation on a method that uses @Bean parameter binding.I built a simple test case as a zip file containing an Eclipse Helios maven project (see attachment). The test fails with camel 2.8.0 and succeeds with 2.7.3 and earlier (at least until 2.6.0).regards Vincent MATHON,0,0
Camel CXF Endpoint creates incomplete WSDL,The dynamically created WSDL for a cxf:cxfEndpoint declaration is malformed when using a complex type as parameter.Please see as well the discussion here.http://camel.465427.n5.nabble.com/Camel-CXF-Endpoint-creating-incomplete-WSDL-td4642433.htmlUse attached test project to run mvn test with version 2.8.0 and 2.7.2  this should show the error.,0,0
Add errorHandler option for DMLC to camel-jms,In Spring 3 a org.springframework.util.ErrorHandler can be used to react to unhandled exceptions (unlike JMSExceptions handled by an javax.jms.ExceptionListenerSee http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/jms/listener/AbstractMessageListenerContainer.html#setErrorHandler(org.springframework.util.ErrorHandler)I'm going to add an option for this to camel-jms shortly.,0,0
xslt component - Cannot load xslt file from file system,See nabblehttp://camel.465427.n5.nabble.com/Custom-URIResolver-for-Camel-tp4665485p4665485.htmlThe Spring IO resource is a bit pants  as you ask for it to give an input stream  and then it fails doing that for a plain file url.Instead it gives you an URL connection  and you get a unknown host exception.,0,0
Camel Bindy Parser One to Many KvP Unmarshall Issue,Bindy KvP unmarshall issue. While unmarshalling FIX messages  camel-bindy causing inconsistencies if the incoming fix messages are defined to map using 'OneToMany' annotations.In a given route for eg: BindyKeyValuePairDataFormat kvpBindyDataFormat = new BindyKeyValuePairDataFormat('org.apache.camel.dataformat.bindy.model.fix.complex.onetomany'); public void configure() { from(URI_DIRECT_START).unmarshal(kvpBindyDataFormat).to(URI_MOCK_RESULT); }kvpBindyDataFormat is single instance for multiple threads and with in 'BindyKeyValuePairFactory' class instance varialbe below is shared across multiple threads causing data inconsistencies.private Map&lt;String  List&lt;Object&gt;&gt; lists = new HashMap&lt;String  List&lt;Object&gt;&gt;(); Values from previous thread/messages are retained in the current thread causing issues.For eg in the test case: public class BindyComplexOneToManyKeyValuePairUnMarshallTest extends CommonBindyTest if we send another message with no repeating groups are sent.String message2 = '8=FIX 4.19=2034=135=049=INVMGR56=BRKR' + '1=BE.CHM.00111=CHM0001-0158=this is a camel - bindy test'  + '10=220';The output message has repeating group data from message processed in earlier thread are pouplated causing data inconsistencies.Please suggest the fix considering multi-threading scenario. I am willing to volunteer for the fix.Regards Surya,0,0
Example feature: wrong spring version,Featureapache-camel-2.8.0.zip/apache-camel-2.8.0/examples/camel-example-etl/src/main/resources/features.xml contains &lt;bundle&gt;mvn:org.springframework/spring-jdbc/2.5.6.SEC01&lt;/bundle&gt; &lt;bundle&gt;mvn:org.springframework/spring-orm/2.5.6.SEC01&lt;/bundle&gt; Exception during 'hibernate-feauture' feature installation:12:23:21 337 | INFO | l Console Thread | araf.shell.console.jline.Console 258 | 36 - org.apache.karaf.shell.console - 2.2.1 | Exception caught while executing command java.lang.Exception: Could not start bundle mvn:org.springframework/spring-jdbc/2.5.6.SEC01 in feature(s) hibernate-feauture-0.0.0: The bundle 'org.springframework.jdbc_2.5.6.SEC01 &#91;332&#93;' could not be resolved. Reason: Missing Constraint: Import-Package: org.springframework.dao; version='&#91;2.5.6.SEC01 2.5.6.SEC01&#93;' at org.apache.karaf.features.internal.FeaturesServiceImpl.installFeatures(FeaturesServiceImpl.java:353)&#91;38:org.apache.karaf.features.core:2.2.1&#93;...Caused by: org.osgi.framework.BundleException: The bundle 'org.springframework.jdbc_2.5.6.SEC01 &#91;332&#93;' could not be resolved. Reason: Missing Constraint: Import-Package: org.springframework.dao; version='&#91;2.5.6.SEC01 2.5.6.SEC01&#93;' at org.eclipse.osgi.framework.internal.core.AbstractBundle.getResolverError(AbstractBundle.java:1317)&#91;osgi-3.6.0.v20100517.jar:&#93; at org.eclipse.osgi.framework.internal.core.AbstractBundle.getResolutionFailureException(AbstractBundle.java:1301)&#91;osgi-3.6.0.v20100517.jar:&#93; at org.eclipse.osgi.framework.internal.core.BundleHost.startWorker(BundleHost.java:319)&#91;osgi-3.6.0.v20100517.jar:&#93; at org.eclipse.osgi.framework.internal.core.AbstractBundle.start(AbstractBundle.java:284)&#91;osgi-3.6.0.v20100517.jar:&#93; at org.eclipse.osgi.framework.internal.core.AbstractBundle.start(AbstractBundle.java:276)&#91;osgi-3.6.0.v20100517.jar:&#93; at org.apache.karaf.features.internal.FeaturesServiceImpl.installFeatures(FeaturesServiceImpl.java:350)&#91;38:org.apache.karaf.features.core:2.2.1&#93; ... 15 moreSolution:Change version for bundles org.springframework/spring-jdbc and org.springframework/spring-orm to 3.0.5.RELEASE instead 2.5.6.SEC01.,0,0
Wrong exception uri when an HTTP error code is returned,When a REST service returns an HTTP error code (e.g. 404)  the URI property of the exception is incorrect.The URI is the URI of the origin endpoint of the route.It should be instead the URI of the endpoint that threw the exception.For instance  in the following route :&lt;route id='restproxy'&gt; &lt;from uri='restlet:http://localhost:9080/oe/ws/offre/{id}'/&gt; &lt;doTry&gt; &lt;to uri='restlet:http://bla.dot.com:8080/oe/ws/offre/{id}'/&gt; &lt;doCatch&gt; &lt;exception&gt;org.apache.camel.CamelException&lt;/exception&gt; &lt;log message='URI=${exception.uri}'/&gt; &lt;/doCatch&gt; &lt;/doTry&gt;&lt;/route&gt;The logged URI is 'restlet:http://localhost:9080/oe/ws/offre/{id}' but should be instead the real URI used  e.g. 'restlet:http://bla.dot.com:8080/oe/ws/offre/1'.This bug might be fixed by the following code change in class org.apache.camel.component.restlet.RestletProducer  method populateRestletProducerException() : String uri = exchange.getFromEndpoint().getEndpointUri(); + String uri = response.getRequest().getResourceRef(),0,0
Validator component - Should be able to validate from a File payload,The validator component should be able to validate a message which is from a java.io.File.What is needed is a couple of type converters to ensure this.,0,0
Add String->TimeZone converter so that time zone can be specified for camel-quartz,It is possible to specify a time zone for Quartz  however  in order for that to work Camel needs a String to TimeZone type converter since Quartz requires a TimeZone.Attached is a patch containing a type converter that works. By setting the type converter explicitly on the context like this context.getTypeConverterRegistry().addTypeConverter(TimeZone.class  String.class  new String2TimeZoneConverter());it is possible to create an endpoint URI looking like this:quartz://groupName/timerName?cron=&lt;cronExpression&gt;&amp;trigger.timeZone=Europe/StockholmHowever  it would be really useful if this type converter could be included in camel-core. This has been discussed on the camel user list:http://camel.465427.n5.nabble.com/How-to-specify-a-time-zone-for-camel-quartz-td4700077.html,0,0
Impossible to use placeholders in endpointName and serviceName attributes of cxf:cxfEndpoint,Here is how endpointName and serviceName are declared in XSD.&lt;xsd:attribute name='endpointName' type='xsd:QName' /&gt; &lt;xsd:attribute name='serviceName' type='xsd:QName' /&gt; So the xml parser fails to parse the following element&lt;cxf:cxfEndpoint id='service' address='${http.service.endpoint.path}' wsdlURL='${http.service.wsdl.path}' serviceName='${http.service.serviceName}' endpointName='${http.service.portName}'&gt;&lt;/cxf:cxfEndpoint&gt;,0,0
Ftp consumer using done file should cater for if stepwise has been enabled  and thus the done file path is to be calculated differently,The workaround is to use ${file:onlyname} or not using stepwise.,0,0
Using transacted in Java DSL without Spring XML setting up TX manager should report better error when not able to find a TX manager in the registry,See nabblehttp://camel.465427.n5.nabble.com/Transaction-configuration-in-Java-DSL-tp4711625p4711625.htmlYou will see an error likeException in thread 'main' org.apache.camel.FailedToCreateRouteException: Failed to create route route1 at: &gt;&gt;&gt; Policy&#91;ref:null&#93; &lt;&lt;&lt; We should improve that and report a more details error.,0,0
faster way of testing for file existence,when storing a file the ftp component checks if the file exists in the endpoint  this is done by listing the content of the destination folder and looping through all files listed. the list operation takes a long time when the destination folder contains hundreds of files. instead of listing for all files the component can simply list for the file it is interested on  this way the number of files contained in destination folder won't affect the time it takes the producer to process the exchange. I currently have a case where delivering to an endpoint is taking more than a minute because of this issue. Both ftp and sftp libraries used supports listing for a single file so the changes would be the following: FtpOperations.javapublic boolean existsFile(String name) throws GenericFileOperationFailedException { String[] names = client.listNames(name); if (names == null) { return false; } return (names.lenght &gt;= 1); } SftpOperations.javapublic boolean existsFile(String name) throws GenericFileOperationFailedException { Vector files = channel.ls(name); if (names == null) { return false; } return (names.size &gt;= 1); },0,1
Move org.apache.camel.Main to org.apache.camel.main.Main,I am currently looking into the dependencies betwen packages in camel-core. The packages org.apache.camel and org.apache.camel.spi form the camel api.So I am trying to make them not depend on other packages from camel-core. One problem there is the starter class Main. It needs access to impl packages as it needs to start camel. So it should not live in org.apache.camel.I propose to move it to org.apache.camel.main. To not break anything right now I will create a deprecated class Main in org.apache.camel that extends the moved Main. We can remove the deprecated version in camel 3.0,0,0
Refactoring of management code to remove cycles and clearly separate between API and impl,Currently the management code (org.apache.camel.management.*) contains a mix of implementation code and APIs. This leads to cycle in the management code as well as to bigger cycles involving all of camel-core.So I propose to do several changes: move interfaces and annotations that form the API to camel.spi.management. As these are probably not used by external components or user code no compatibility classes are created create new package camel.suppport for classes that implement API or SPI classes and are expected to be extended by many impl classes. classes in support may only access the camel API and SPI Move EventNotifierSupport and ServiceSupport to this package. Create deprecate dummys in the old locations to avoid breaking older code Move DefaultEventFactory from management to management.eventI will post a patch shortly for review,0,0
Camel test - Debugger should be explicit enabled if end user want to leverage it,The debugger adds a little overhead and silently enables tracer as well. We should have the end user to explicit enable the debugger if he need to use it from his unit tests.,0,0
Bug in parsing of JPA uri,According to http://camel.apache.org/jpa.html entityName is optional.When configuring with the following uri (e.g. w/o entityName):&lt;camel:endpoint id='jpaEndpoint' uri='jpa:?persistenceUnit=journalPersistenceUnit&amp;usePersist=true' /&gt;the following warning will be displayed2011-08-21 18:57:11 381 &#91;main&#93;[][][][][][][] WARN org.apache.camel.util.ObjectHelper - Cannot find class: persistenceUnitjournalPersistenceUnitusePersisttruepersistenceUnitjournalPersistenceUnitusePersisttruedue to the incorrect if test in the JpaComponent:// lets interpret the next string as a class if (path != null) { // provide the class loader of this component to work in OSGi environments as camel-jpa must be able // to resolve the entity classes Class&lt;?&gt; type = getCamelContext().getClassResolver().resolveClass(path  JpaComponent.class.getClassLoader()); if (type != null) { endpoint.setEntityType(type); } }path is not null  but it is the rest of the string and not the entityname. e.g it should not start with ? if it is an entityname - else it is the options.,0,0
Freemarker - Loading template from file system fails,This only affects Camel 2.9.,0,0
Camel-netty option 'encoder' and 'decoder' does not work,Contrary to the documentation  the 'encoder' and 'decoder' option is unusable as it's value is taken as-is instead of resolving the references using the registry.This bug was introduced in the revision 960621 as part of CAMEL-2907.Patch can be found at https://github.com/szabolcsberecz/camel/commit/b3bcc8dd284575c931048ea410c44577474e25dd,0,0
It's hardly possible to use all expression of the Simple language to create file names in the file component,Sometimes it can be necessary to use custom headers to create a file name.For example  I declare my file endpoint in the following manner:&lt;route id='fileReader'&gt; &lt;from uri='file://rootFolder?move=.backup&amp;amp;moveFailed=.error/${header.CustomHeader}' /&gt; &lt;to uri='file://out'/&gt;&lt;/route&gt;The header 'CustomHeader' cannot be read because of the following snippets of code in the org.apache.camel.component.file.GenericFile/** * Bind this GenericFile to an Exchange */public void bindToExchange(Exchange exchange) { exchange.setProperty(FileComponent.FILE_EXCHANGE_FILE  this); GenericFileMessage&lt;T&gt; in = new GenericFileMessage&lt;T&gt;(this); exchange.setIn(in); populateHeaders(in);}/** * Populates the {@link GenericFileMessage} relevant headers * * @param message the message to populate with headers */public void populateHeaders(GenericFileMessage&lt;T&gt; message) { if (message != null) { message.setHeader(Exchange.FILE_NAME_ONLY  getFileNameOnly()); message.setHeader(Exchange.FILE_NAME  getFileName()); message.setHeader('CamelFileAbsolute'  isAbsolute()); message.setHeader('CamelFileAbsolutePath'  getAbsoluteFilePath()); if (isAbsolute()) { message.setHeader(Exchange.FILE_PATH  getAbsoluteFilePath()); } else { // we must normalize path according to protocol if we build our own paths String path = normalizePathToProtocol(getEndpointPath() + File.separator + getRelativeFilePath()); message.setHeader(Exchange.FILE_PATH  path); } message.setHeader('CamelFileRelativePath'  getRelativeFilePath()); message.setHeader(Exchange.FILE_PARENT  getParent()); if (getFileLength() &gt;= 0) { message.setHeader('CamelFileLength'  getFileLength()); } if (getLastModified() &gt; 0) { message.setHeader(Exchange.FILE_LAST_MODIFIED  new Date(getLastModified())); } }}As you can see a new 'in' message is created and not all the headers from the original message are copied to it.,0,0
The debugger doesn't work in the CamelSpringTestSupport with route defined in XML,The debugger doesn't work in the CamelSpringTestSupport with route defined in XML. This issue is related to CAMEL-4368 (closed and I cannot re-open).I've created a patch with 2 new tests that show the problem and a solution (check the doSetup() method in the tests). However I think this could be improved by moving the SpringCamelContext.setNoStart(true); to CamelSpringTestSupport).,0,0
add support to set the cipher used for SFTP,Right now a user has to manually configure a JSch instance to set the cipher used. We should have an option for that.,1,0
Exeptions cannot be propagated to the parent route when using LogEIP,Here is unit test that demonstrates the problem.For the unit test pass successfully it's necessary to delete LogEIP from the route.package org.apache.camel.impl;import org.apache.camel.Exchange;import org.apache.camel.Processor;import org.apache.camel.builder.RouteBuilder;import org.apache.camel.test.junit4.CamelTestSupport;import org.junit.Test;public class PropagateExceptionTest extends CamelTestSupport { @Test public void failure() throws Exception { getMockEndpoint('mock:handleFailure').whenAnyExchangeReceived(new Processor() { @Override public void process(Exchange exchange) throws Exception { throw new RuntimeException('TEST EXCEPTION'); } }); getMockEndpoint('mock:exceptionFailure').expectedMessageCount(1); sendBody('direct:startFailure'  'Hello World'); assertMockEndpointsSatisfied(); } @Test public void success() throws Exception { getMockEndpoint('mock:handleSuccess').whenAnyExchangeReceived(new Processor() { @Override public void process(Exchange exchange) throws Exception { throw new RuntimeException('TEST EXCEPTION'); } }); getMockEndpoint('mock:exceptionSuccess').expectedMessageCount(1); sendBody('direct:startSuccess'  'Hello World'); assertMockEndpointsSatisfied(); } @Override protected RouteBuilder[] createRouteBuilders() throws Exception { return new RouteBuilder[] { new RouteBuilder() { public void configure() throws Exception { from('direct:startFailure') .onException(Throwable.class) .to('mock:exceptionFailure') .end() .to('direct:handleFailure') .to('mock:resultFailure'); from('direct:handleFailure') .errorHandler(noErrorHandler()) .log('FAULTY LOG') .to('mock:handleFailure'); } }  new RouteBuilder() { public void configure() throws Exception { from('direct:startSuccess') .onException(Throwable.class) .to('mock:exceptionSuccess') .end() .to('direct:handleSuccess') .to('mock:resultSuccess'); from('direct:handleSuccess') .errorHandler(noErrorHandler()) .to('mock:handleSuccess'); } } }; }},0,0
Fix OSGi-exports of camel-soap,The OSGi exports of camel-soap is not correct. If I run exports in karaf I get the following output.  karaf@localhost&gt; exports 135 ID Packages 135 org.apache.camel.dataformat.soap; version='0.0.0' 135 org.apache.camel.dataformat.soap.name; version='0.0.0' 135 org.xmlsoap.schemas.soap.envelope; version='2.8.1.SNAPSHOT' I think org.apache.camel.dataformat.soap and org.apache.camel.dataformat.soap.name should be exported with version='2.8.1.SNAPSHOT' ???? (The same issue is on trunk).,0,0
The URI of the ServletEndpoint exposed to the JMX is not accurate,As an example a ServletEndpoint with the URI 'servlet:///test?matchOnUriPrefix=true&amp;servletName=test' is exposed as '/test' on the JMX-MBeanServer! For details see:http://camel.465427.n5.nabble.com/backslashes-on-Endpoint-URI-by-JConsole-td4757427.html,0,0
CamelLogger should not be a Processor and a log class at the same time and it should not have ServiceSupport,CamelLogger currently does too many things.1. It is a log class that stores a log level and a slf4j logger. It suppports some methods for logging with the set level2. It is a processor for logging exchanges3. It extends ServiceSupport even though it has no services (is apparently needed fro ThroughputLoggerSo what I propose is: Leave the current class as is but mark as @Deprecated Introduce a new CamelLogger that only supports 1. Introduce a CamelLogProcessor in processor that only supports 2. Make ThroughputLogger not extend CamelLogger but instead delegate to the new CamelLogger,0,1
camel-hazelcast should allow the user to provide an existing instance to the component,The camel-hazelcast component currently is using Hazelcast default instance. It should allow the user to specify an existing HazelcastInstance and fall back to the default instance if none is provided. Finally  in the case that the component is using the default instance it should shut it down when the component is stopped.,0,1
Error in camel-restlet feature definition,The current contents of the camel-features.xml file reads:&lt;feature name='camel-restlet' version='2.7.1-fuse-00-43' resolver='(obr)'&gt; &lt;feature version='2.7.1-fuse-00-43'&gt;camel-core&lt;/feature&gt; &lt;bundle dependency='true'&gt;mvn:org.apache.camel/camel-restlet/2.7.1-fuse-00-43&lt;/bundle&gt; &lt;bundle&gt;mvn:http://maven.restlet.org!org.restlet.jse/org.restlet/2.0.5&lt;/bundle&gt;&lt;/feature&gt;It actually should read http://fernandoribeiro.eti.br/2011/09/12/bug-in-fuse-4-4/ (Thanks to Fernando Ribeiro for the heads up!),0,0
camel-csv - Make it consistent what unmarshal returns as object  so its the same for 1 or more rows,See nabblehttp://camel.465427.n5.nabble.com/unmarshal-CsvDataFormat-different-behavior-for-one-or-multiples-lines-tp4778814p4778814.htmlThe camel-csv should always return the same List&lt;List&gt;&gt; regardless if there is 0  1 or 2+ rows returned. That makes it consistent and easier for end users who need to work with this data.,0,0
Wrong slash in FTP component for doneFile,I tried to use the doneFile with FTP component.When I used it to my FTP on my windows machine everything goes fine.When I tried to act the same with a FTP host on a Linux machine  I got an issue.I sniff the packet to see what goes wrong and I see this :the doneFile DELE public/Test/in/myFile.txt the file to processDELE public/Test/in/myFile.xmlAfter a Quick look on the code:org.apache.camel.component.file.GenericFileEndpoint line 682 String answer = pattern; if (ObjectHelper.isNotEmpty(path) &amp;&amp; ObjectHelper.isNotEmpty(pattern)) { // done file must always be in same directory as the real file name answer = path + File.separator + pattern; } if (getConfiguration().needToNormalize()) { // must normalize path to cater for Windows and other OS answer = FileUtil.normalizePath(answer); }We use the 'File.Separator' but in this case  it should get a kind of 'FTP.Separator' or the FTP component should return true to the needToNormalize method and change the narmalizePath method to manage this case.,0,0
camel-bindy - Marshaling using CSV will insert wrong char separator if using an escaped separator char such as a pipe,When using bindy in CSV format with a separator in the model as '|' to denote a pipe character  then it does not work consistent for marshal and unmarshal. In marshal it will insert / as separator  but it should use | instead.See nabblehttp://camel.465427.n5.nabble.com/bindy-different-behavior-between-marshal-and-unmarshal-with-pipe-separator-tp4798488p4798488.html,0,0
NullPointerException when unmarshalling using serialization data format,Spring configuration: &lt;!-- A custom CamelContext --&gt; &lt;camel:camelContext id='camel'&gt; &lt;!-- JSON data format marshalling --&gt; &lt;camel:dataFormats&gt; &lt;camel:serialization id='serialization'/&gt; &lt;/camel:dataFormats&gt; &lt;!-- RawOffer input route --&gt; &lt;camel:route&gt; &lt;camel:from uri='kestrel://etl01f/feeds'/&gt; &lt;camel:unmarshal ref='serialization'/&gt; &lt;camel:to uri='bean:shard?method=consume'/&gt; &lt;/camel:route&gt; &lt;/camel:camelContext&gt;Exception:run: [java] log4j:WARN No appenders could be found for logger (org.springframework.context.support.ClassPathXmlApplicationContext). [java] log4j:WARN Please initialize the log4j system properly. [java] log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info. [java] 13:28:07.587 [main] INFO o.a.c.s.h.CamelNamespaceHandler - OSGi environment not detected. [java] 13:28:09.028 [main] INFO o.a.camel.spring.SpringCamelContext - Apache Camel 2.8.0 (CamelContext: camel) is starting [java] 13:28:09.028 [main] INFO o.a.camel.spring.SpringCamelContext - JMX enabled. Using ManagedManagementStrategy. [java] 13:28:09.415 [main] INFO o.a.c.i.c.AnnotationTypeConverterLoader - Found 3 packages with 14 @Converter classes to load [java] 13:28:09.489 [main] INFO o.a.c.i.c.DefaultTypeConverter - Loaded 153 core type converters (total 153 type converters) [java] 13:28:09.528 [main] INFO o.a.c.i.c.DefaultTypeConverter - Loaded additional 0 type converters (total 153 type converters) in 0.003 seconds [java] 13:28:09.730 [main] INFO o.a.c.c.kestrel.KestrelComponent - Creating endpoint for queue 'feeds' on etl01f  parameters={} [java] 13:28:09.967 [main] INFO o.a.c.c.kestrel.KestrelComponent - Creating MemcachedClient for etl01f/feeds [java] 2011-09-14 13:28:10.073 INFO net.spy.memcached.MemcachedConnection: Added {QA sa=etl01f/95.108.229.218:22133  #Rops=0  #Wops=0  #iq=0  topRop=null  topWop=null  toWrite=0  interested=0} to connect queue [java] 2011-09-14 13:28:10.084 INFO net.spy.memcached.MemcachedConnection: Connection state changed for sun.nio.ch.SelectionKeyImpl@711b50a1 [java] 13:28:10.293 [main] INFO o.a.c.c.kestrel.KestrelConsumer - Starting consumer for kestrel://etl01f/feeds [java] 13:28:10.302 [main] INFO o.a.camel.spring.SpringCamelContext - Route: route1 started and consuming from: Endpoint[kestrel://etl01f/feeds] [java] 13:28:10.318 [main] INFO o.a.camel.spring.SpringCamelContext - Total 1 routes  of which 1 is started. [java] 13:28:10.318 [main] INFO o.a.camel.spring.SpringCamelContext - Apache Camel 2.8.0 (CamelContext: camel) started in 1.291 seconds [java] 13:28:12.858 [Camel (camel) thread #0 - Poller-kestrel://etl01f/feeds] ERROR o.a.c.processor.DefaultErrorHandler - Failed delivery for exchangeId: ID-incubos-osx-local-51787-1315992488896-0-1. Exhausted after delivery attempt: 1 caught: java.lang.NullPointerException [java] java.lang.NullPointerException: null [java] at org.apache.camel.impl.SerializationDataFormat.unmarshal(SerializationDataFormat.java:57) ~[camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.processor.UnmarshalProcessor.process(UnmarshalProcessor.java:56) ~[camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.impl.converter.AsyncProcessorTypeConverter$ProcessorToAsyncProcessorBridge.process(AsyncProcessorTypeConverter.java:50) ~[camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:78) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:69) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:78) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:99) ~[camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:78) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:318) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:209) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.processor.DefaultChannel.process(DefaultChannel.java:305) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:78) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.processor.Pipeline.process(Pipeline.java:116) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.processor.Pipeline.process(Pipeline.java:79) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:102) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:78) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:98) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:89) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:69) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:104) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:85) [camel-core-2.8.0.jar:2.8.0] [java] at org.apache.camel.component.kestrel.KestrelConsumer$Poller.run(KestrelConsumer.java:230) [camel-kestrel-2.8.0.jar:2.8.0] [java] at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) [na:1.6.0_26] [java] at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303) [na:1.6.0_26] [java] at java.util.concurrent.FutureTask.run(FutureTask.java:138) [na:1.6.0_26] [java] at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) [na:1.6.0_26] [java] at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) [na:1.6.0_26] [java] at java.lang.Thread.run(Thread.java:680) [na:1.6.0_26]It seems that ExchangeHelper.convertToType() method returned null because camelContext.getTypeConverter() returned null.,0,0
Resolve cycle between language.simple and language.simple.ast,Currently we have a big dpendency cycle between language.simple and language.simple.ast.As simple creates the ast this dependency is necessary. In the other direction ast needs types and exceptions that are inside simple.So I propose to nove these classes into a package simple.types. As I think these types and exceptions are not used outside the camel-core I will not create compatibility measures.,0,0
Unable to use cxf:binding configuration for the endpoint,Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'service': Error setting property values; nested exception is org.springframework.beans.NotWritablePropertyException: Invalid property 'bindingConfig' of bean class [org.apache.camel.component.cxf.CxfSpringEndpoint]: Bean property 'bindingConfig' is not writable or has an invalid setter method. Does the parameter type of the setter match the return type of the getter? at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1361) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1086) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:517) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456) at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:291) at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222) at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:288) at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:190) at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:580) at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:895) at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:425) at org.springframework.test.context.support.AbstractGenericContextLoader.loadContext(AbstractGenericContextLoader.java:84) at org.springframework.test.context.support.AbstractGenericContextLoader.loadContext(AbstractGenericContextLoader.java:1) at org.springframework.test.context.TestContext.loadApplicationContext(TestContext.java:280) at org.springframework.test.context.TestContext.getApplicationContext(TestContext.java:304) ... 30 moreCaused by: org.springframework.beans.NotWritablePropertyException: Invalid property 'bindingConfig' of bean class [org.apache.camel.component.cxf.CxfSpringEndpoint]: Bean property 'bindingConfig' is not writable or has an invalid setter method. Does the parameter type of the setter match the return type of the getter? at org.springframework.beans.BeanWrapperImpl.setPropertyValue(BeanWrapperImpl.java:1024) at org.springframework.beans.BeanWrapperImpl.setPropertyValue(BeanWrapperImpl.java:900) at org.springframework.beans.AbstractPropertyAccessor.setPropertyValues(AbstractPropertyAccessor.java:76) at org.springframework.beans.AbstractPropertyAccessor.setPropertyValues(AbstractPropertyAccessor.java:58) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1358) ... 44 more,0,0
file: consumer does not create directory,According to http://camel.apache.org/file2.html autoCreate is true by default and should for a consumer create the directory.autoCreate true Automatically create missing directories in the file's pathname. For the file consumer  that means creating the starting directory. For the file producer  it means the directory the files should be written to. This does not happen and thus a route startup would fail.,0,0
Because local PrintService objects on Windows have a name which is not their UNC path  the PrinterProducer can never find them.,In org.apache.camel.component.printer.PrinterProducer  the line:setPrinter('////' + config.getHostname() + '' + config.getPrintername());reconstructs a UNC path which is expected to match the name of a PrintService on the system. For local printers on Windows  the name of the PrintService is simply the name of the printer without the host and any backslashes  so the PrinterProducer is never able to find them.So when config.getHostname() is 'localhost'  at least on Windows  the line should be simply:setPrinter(config.getPrintername())so that we'd have code like:if ('localhost'.equalsIgnoreCase(config.getHostname())) { setPrinter(config.getPrintername());} else { setPrinter('////' + config.getHostname() + '//' + config.getPrintername());}This can only work if issue CAMEL-4477 about the error in parseURI() in PrinterConfiguration is also fixed.,0,0
Exceptions are not propagated to the parent route when endpoint cannot be resolved in the RoutingSlip EIP,Here is the unit test to reproduce the issuepackage org.test;import org.apache.camel.builder.RouteBuilder;import org.apache.camel.component.mock.MockEndpoint;import org.apache.camel.test.junit4.CamelTestSupport;import org.junit.Test;public class RecipientListTest extends CamelTestSupport { public static class Router { public String findEndpoint() { return 'unresolved://endpoint'; } } @Test public void recipientList() throws Exception { MockEndpoint endpoint = getMockEndpoint('mock://error'); endpoint.expectedMessageCount(1); sendBody('direct://parent'  'Hello World!'); assertMockEndpointsSatisfied(); } @Override protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { @Override public void configure() throws Exception { from('direct://parent') .onException(Throwable.class) .to('mock://error') .end() .to('direct://child'); from('direct://child') .errorHandler(noErrorHandler()) .routingSlip(bean(Router.class)); } }; }},0,0
Be able to check classtype through simple language,See http://camel.465427.n5.nabble.com/How-do-I-access-the-message-class-name-from-Simple-td4842269.html for the full context.In short be able to access Object.getClass() for usage in Camel's simple language.,0,0
Add a Tracer that uses JMX Notifications and provides full details of Camel Messages,We should create a base for Camel Trace toolings so these can trace the full message content.The trace event should contain: all Exchange Data including properties all Message Data including headersThere should be a setting to truncate the message body as it can be quite long and often in tracing not all details are needed.One question is if this tracing should be combined with the current Notifications or should be a separate thing.,0,0
Recipient List cannot vary destination by changing property in an expression,This is probably due to producers being cached based on unresolved endpoint URI  rather than the resolved endpoint URI. Haven't tested this theory out though.See message on user list http://markmail.org/message/sdysp6sspq5lomf4,0,0
The SFTP component: the keyboard-interactive auth method support,As it was discussed in this topic http://camel.465427.n5.nabble.com/The-SFTP-component-the-keyboard-interactive-auth-method-support-td4853523.htmlThe SFTP component may be slightly improved to support the keyboard-interactive auth method and the compression Preamble:It appeared that our sftp share we get files from doesn't support the ssh password auth method and we're not allowed to put the public key to there. So the only ssh auth method we can use is the keyboard-interactive. Unfortunately the SFTP camel component doesn't support this.However this can be easily fixed simply by providing the Jsch session with both the com.jcraft.jsch.UserInfo and com.jcraft.jsch.UIKeyboardInteractive interfaces. The UIKeyboardInteractive has the only one promptKeyboardInteractive method which returns String[] containing the password entered by user interactively. In our case I simply return a password.The implementation example is attached.Also it's sometime required to set the ssh compression to be able to process longsize files. The compression fix is also implemented in the attached file. Compression requires the zlib jar to be in the pom.This was tested with the 0.1.44-1 version of the jsch and the 1.0.7 version of the jzlib.,1,0
Spring-WS should populate Camel Header with the SOAP Header,Currently the Camel-Spring-WS component does not support the setting of SOAP Headers and has issues getting them. The current issue getting the SOAP Headers when receiving a message is that the resulting header key includes the namespace.Change the component so that a Camel header 'CamelSpringWebserviceSoapHeader' can be populated with an intended SOAP Header for a request  and that this Header is also populated from the SOAP Header on a response.,0,0
Unable to convert jms textmessage to bytemessage,When receiving a jms textmessage and just forward it to a another queue as a jms bytemessage the original textmessage is sendt without being converted to a jms bytemessage. JmsBinding.makeJmsMessage seems to use the exchange headers to determine of a new jms message should be created or the original send.Exchange headers seems to be populated if you do routing or set a dummy header.See http://camel.465427.n5.nabble.com/Convert-jms-message-from-textmessage-to-bytemessage-tc4895362.html/preben,0,0
Can't find splitter bean in registry using multiple camel contexts with 'vm' endpoint,The splitter component can use a bean with a 'split method'. It seems that this 'split bean' is handled as expression and resolved lately using Camel Context from current exchange.If I send an exchange using a separate CamelContext ('client')&lt;camelContext id='client' xmlns='http://camel.apache.org/schema/spring'&gt;&lt;/camelContext&gt;to a route defined in another CamelContext ('server') using in-memory transport like 'direct' or 'vm'&lt;camelContext id='server' xmlns='http://camel.apache.org/schema/spring'&gt; &lt;route id='route02' trace='false' streamCache='false'&gt; &lt;from uri='vm:route02'/&gt; &lt;split&gt; &lt;method bean ='stringLineSplitter' method='split'/&gt; &lt;log message='before sending: ${body}'/&gt; &lt;inOut uri ='vm:route04'/&gt; &lt;log message='after sending'/&gt; &lt;/split&gt; &lt;to uri='mock:route02'/&gt; &lt;/route&gt;&lt;/camelContext&gt;the test fails with 'Cannot find class: stringLineSplitter' (Camel 2.8.0). 'org.apache.camel.NoSuchBeanException - No bean could be found in the registry for: stringLineSplitter' (Camel 2.9-SNAPSHOT)If I understood Camel right it failsbecause it tries to resolve this bean based on client Camel Contextwhich is still set at the current exchange send from 'client' to 'server' but itdoesn't contain the bean.If I send an exchange using same 'client' CamelContext to another route in'server' CamelContext involving 'external' components like 'jms' (ActiveMQ)&lt;camelContext id='server' xmlns='http://camel.apache.org/schema/spring'&gt; &lt;route id='route03' trace='false' streamCache='false'&gt; &lt;from uri='jms:queue:route03'/&gt; &lt;split&gt; &lt;method bean ='stringLineSplitter' method='split'/&gt; &lt;log message='before sending: ${body}'/&gt; &lt;inOut uri ='vm:route04'/&gt; &lt;log message='after sending'/&gt; &lt;/split&gt; &lt;to uri='mock:route03'/&gt; &lt;/route&gt;&lt;/camelContext&gt;the test passed successfully. It seems that 'jms' component creates anew exchange using 'server' CamelContext.,0,0
NotifyBuilder wereSentTo condition fires too eagerly,Problem is:NotifyBuilder notify = new NotifyBuilder(context)  .whenDone(2).wereSentTo('mock:bar');The wereSentTo condition will fire after first message gets to endpoint 'mock:bar'  so either needs to take preceding whenDone into account  or wereSentTo needs to have a count condition added to it's method signature.See nabble trail for full details:http://camel.465427.n5.nabble.com/NotifyBuilder-condition-fails-to-match-on-an-out-activemq-endpoint-tp4689038p4867857.html,0,0
Support nested directories with multiple segment files in the HDFS endpoint consumer,A common pattern in HDFS is for multiple segment files underneath a given directory  representing the fragments of data. Lots of tools understand to automatically merge these segment files (ie hadoop fs -getmerge  pig script loaders). This patch does the same for the HDFS consumer  using a temporary local directory for the merging.Additionally  tools like pig and oozie understand to look for a _SUCCESS file in one of these directories containing segments. This file indicates that the segments have been completely written. This patch additionally skips the directory if a _SUCCESS file is not present.,0,0
NettyProducer creating new connection on every message,Using a NettyProducer without the disconnect=true configuration is causing the route to block after 10 messages on the to('netty://tcp....') call.It appears that a new socket connection is created for every message  and then after 10 connections no new connection is allowed (must be a default thread pool limit?).Using the disconnect=true option fixes the problem as a socket is connected  message sent  then disconnected. But this does not seem viable for implementations where that overhead is undesirable or where more than one response is expected on a channel.&#8211;This is a small Unit Test that shows the problem (http://camel.465427.n5.nabble.com/Camel-Netty-Producer-creating-new-connection-on-every-message-td4844805.html#none) package netty; import java.util.Arrays; import java.util.Collection; import java.util.concurrent.TimeUnit; import java.util.concurrent.atomic.AtomicBoolean; import java.util.concurrent.atomic.AtomicInteger; import junit.framework.TestCase; import org.apache.camel.CamelContext; import org.apache.camel.Exchange; import org.apache.camel.ExchangePattern; import org.apache.camel.Processor; import org.apache.camel.builder.RouteBuilder; import org.apache.camel.impl.DefaultCamelContext; import org.junit.Before; import org.junit.BeforeClass; import org.junit.Test; import org.junit.runner.RunWith; import org.junit.runners.Parameterized; import org.junit.runners.Parameterized.Parameters; import org.slf4j.Logger; import org.slf4j.LoggerFactory; @RunWith(Parameterized.class) public class NettyTest extends TestCase {  private final static Logger logger = LoggerFactory.getLogger(NettyTest.class);  private final static CamelContext serverContext = new DefaultCamelContext();  private final CamelContext clientContext = new DefaultCamelContext();  private final AtomicInteger responseCounter = new AtomicInteger(0);  private final AtomicBoolean passedTen = new AtomicBoolean(false);  private Boolean disconnectClient;  public NettyTest(Boolean disconnectClient)  { this.disconnectClient = disconnectClient; }  @Parameters  public static Collection&lt;Object[]&gt; configs()  {  return Arrays.asList(new Object[][] { { true }  { false } });  }  @BeforeClass  public static void createServer() throws Exception  {  serverContext.addRoutes(new RouteBuilder()  {  @Override  public void configure() throws Exception  {  from('netty:tcp://localhost:9000?sync=true&amp;disconnectOnNoReply=false&amp;allowDefaultCodec=true&amp;tcpNoDelay=true&amp;reuseAddress=true&amp;keepAlive=false')  .setExchangePattern(ExchangePattern.InOut)  .process(new Processor() {  @Override  public void process(Exchange exchange) throws Exception  {  Object body = exchange.getIn().getBody();  logger.info('Request received : Value = {}'  body);  }  })  .transform(constant(3)).stop();  }  });  serverContext.start();  }  @Before  public void createClient() throws Exception  {  clientContext.addRoutes(new RouteBuilder()  {  @Override  public void configure() throws Exception  {  // Generate an Echo message and ensure a Response is sent  from('timer://echoTimer?delay=1s&amp;fixedRate=true&amp;period=1s')  .setExchangePattern(ExchangePattern.InOut)  .transform()  .constant(2)  .to(ExchangePattern.InOut  'netty:tcp://localhost:9000?allowDefaultCodec=true&amp;tcpNoDelay=true&amp;reuseAddress=true&amp;keepAlive=false&amp;sync=true&amp;disconnect=' + disconnectClient.toString())  .process(new Processor()  {  @Override  public void process(Exchange exchange) throws Exception  {  Object body = exchange.getIn().getBody();  logger.info('Response number {} : Value = {}'   responseCounter.incrementAndGet()  body);  if (responseCounter.get() &gt; 10) { passedTen.set(true); }  }  }).stop();  }  });  }  @Test  public void test() throws Exception  {  clientContext.getShutdownStrategy().setTimeout(1);  clientContext.start();  logger.info('Disconnect = {}'  this.disconnectClient);  Thread.sleep(TimeUnit.SECONDS.toMillis(15));  clientContext.stop();  assertTrue('More than 10 responses have been received'  passedTen.get());  } },0,1
Need to specify the sl4j-api version in the camel maven archetypes,There are some third part dependencies will introduce other version of sl4j-api as CAMEL-4545 shows  we need to specify the sl4j-api in the pom.xml resource.,0,0
camel-file component does not close a file when it's used with camel-xslt,Here are the steps to reproduce: Create the directory target/in. Put the file 'file.xml' into the directory target/in. Note: the end tag in this file is not closed properly. Run the test. The test should fail. The file 'file.xml' remains in the target/in but it should not.FileLockedTest.javapackage org.apache.camel;import org.apache.camel.builder.RouteBuilder;import org.apache.camel.component.mock.MockEndpoint;import org.apache.camel.test.junit4.CamelTestSupport;import org.junit.Test;public class FileLockedTest extends CamelTestSupport { @Test public void testFileLocked() throws Exception { MockEndpoint result = getMockEndpoint('mock:result'); result.setAssertPeriod(10000); result.expectedMessageCount(1); result.assertIsSatisfied(); } @Override protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { @Override public void configure() throws Exception { from('file:target/in?delay=100&amp;moveFailed=.error') .onException(Throwable.class) .to('mock:result') .end() .to('xslt:FileLockedTest.xsl'); } }; }}FileLockedTest.xsl&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;xsl:stylesheet xmlns:xsl='http://www.w3.org/1999/XSL/Transform' xmlns='http://schemas.computershare.ru/codex/2011/08/' version='1.0'&gt; &lt;xsl:output method='xml' encoding='UTF-8' omit-xml-declaration='yes' /&gt; &lt;xsl:preserve-space elements='*'/&gt; &lt;xsl:template match='/'&gt; &lt;xsl:apply-templates /&gt; &lt;/xsl:template&gt; &lt;xsl:template match='@* | node()'&gt; &lt;xsl:copy&gt; &lt;xsl:apply-templates select='@* | node()' /&gt; &lt;/xsl:copy&gt; &lt;/xsl:template&gt;&lt;/xsl:stylesheet&gt;file.xml; Note: the end tag is not closed properly&lt;root&gt;&lt;/root,0,1
SLF4JLog does not work with JdbcDriver for Quickfix/J,I discovered that to use SLF4J log  JdbcDriver cannot be present in the Quickfix/J config file. Otherwise  the default LogFactory - ScreenLogFactory will be used. We need JdbcDriver setting as it is used for persisting FIX messages into database for FIX session management.After debugging the code  I found out that this could be fixed by swapping those two lines in QuickfixjEngine.java298: isJdbcLog(settings  impliedLogFactories);299: isSL4JLog(settings  impliedLogFactories);Can we please have this fixed for the next release?,0,0
Add option on XSLT to allow StAX,With the new StAX converters you may convert to a StAXSource which is not supported by the XSLT transformer  and you get this exceptionCaused by: org.apache.xml.dtm.DTMException: Not supported: javax.xml.transform.stax.StAXSource@14d556e at org.apache.xml.dtm.ref.DTMManagerDefault.getDTM(DTMManagerDefault.java:477) at org.apache.xalan.transformer.TransformerImpl.transform(TransformerImpl.java:699) at org.apache.xalan.transformer.TransformerImpl.transform(TransformerImpl.java:1273) at org.apache.xalan.transformer.TransformerImpl.transform(TransformerImpl.java:1251) at org.apache.camel.builder.xml.XsltBuilder.process(XsltBuilder.java:107)We should add option on XSLT component to explicit enable StAX if the end user wants it.,0,0
XQuery component does not work with StAXSource out of the box,The new STaXSource type converters cause camel-saxon to fail unit tests as reported by CI serversCaused by: net.sf.saxon.trans.XPathException: Unknown source class at net.sf.saxon.Configuration.buildDocument(Configuration.java:2892) at net.sf.saxon.query.StaticQueryContext.buildDocument(StaticQueryContext.java:211) at org.apache.camel.component.xquery.XQueryBuilder.createDynamicContext(XQueryBuilder.java:474)We should implement the same optimized logic as we did today in XSLT to convert to Source if StAX is allowed  as well to avoid leaking resources we need to ensure if InputStream is in use  we should ensure it gets closed.,0,1
XPath will lock File input in case of an exception during xpath evaluation,We have a similar issue with XPath  as we had with XSLT and XQuery.If the message is a java.io.File and an exception occurs during evaluation  then that file is locked on Windows platforms.We need to close the FileInputStream to unlock the file  and allow Windows to access the file.,0,0
Add default for transactionName in camel-jms,Say you have a simple transacted route like:from('activemq:queue:foo') .transacted() .to(...);on new messages you get logs like:DEBUG JmsTransactionManager - Creating new transaction with name [null]: PROPAGATION_REQUIRED ISOLATION_DEFAULTwhich isn't very helpful. It would be good to actual give the TX a name with some context. Thinking of something like the following would be better:DEBUG JmsTransactionManager - Creating new transaction with name [JmsConsumer[foo]]: PROPAGATION_REQUIRED ISOLATION_DEFAULT,0,0
Improve URISupport.sanitizeUri and apply it in additional places,In this issue  I propose that URISupport.sanitizeUri method sanitizes the password token in URIs that contain it (i.e.  URIs in the form scheme://user:password@host). JT400 component URIs directly benefit from this improvement.Additionally  I suggest that this method be invoked in additional sensitive places (in much the same way as DefaultEndpoint.toString()).Proposed patch attached.,1,0
Add support for PGP data format in Java and XML DSLs,The new PGP data format from CAMEL-4549requires to create it from Java code.We should add some syntax sugar and have it in the DSL directly like the other data formats.We may also want to look into how to configure a public and private key file  and have it load the PGPPublicKey and PGPPrivateKey for you automatic.Instead of using the PGPDataFormatUtil class.,0,0
Stop or shutdown a route with a custom timeout value  will still log using the default timeout in the logs,If you stop a route with a custom time out value  then the graceful shutdown strategy will still use the default timeout value in the logs  so that information is not correct. For example if you have a short default value  but provide a higher timeout value  then you can have the log show negative timeout values.INFO DefaultShutdownStrategy - Waiting as there are still 2 inflight and pending exchanges to complete  timeout in -14 seconds.,0,0
Do not print javax.jms.Message in toString in camel-jms,See nabblehttp://camel.465427.n5.nabble.com/ExchangeTimedOutException-not-properly-constructed-by-Camel-2-7-1-exposing-exchange-data-tp4971556p4971556.htmlThere may be details in the JMS message you do not want to show in logs unintended.,0,1
Simple expression does not find method toString(),In a route builder  we have a log definition: from('direct:testSimple') .log('${body.toString}');The body contains an object  that implements a public toString() method. But the problem is  that the simple-expression does not find the method toString() and route processing stops without throwing an exception.The funny thing is  that when we just rename the method  e.g. toInfoString()  then it works:from('direct:testSimple') .log('${body.toInfoString}');Why does simple expression have a problem with a method named 'toString'?,0,0
NPE from DefaultCxfBinding when  is null,when got soap message from CXF component like this:&lt;soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'&gt;&lt;soap:Header&gt;......&lt;/soap:Header&gt;&lt;soap:Body/&gt;&lt;/soap:Envelope&gt;the NPE will be thrown: 18:04:51 255 | WARN | tp1212500935-153 | ache.cxf.common.logging.LogUtils 372 | - - | Interceptor for {http://airportsoap.sopera.de}airport#{http://airportsoap.sopera.de}getAirportInformationByISOCountryCode has thrown exception  unwinding nowjava.lang.NullPointerException at org.apache.camel.component.cxf.DefaultCxfBinding.getResponsePayloadList(DefaultCxfBinding.java:395)&#91;163:org.apache.camel.camel-cxf:2.8.2&#93; at org.apache.camel.component.cxf.DefaultCxfBinding.populateCxfResponseFromExchange(DefaultCxfBinding.java:318)&#91;163:org.apache.camel.camel-cxf:2.8.2&#93; at org.apache.camel.component.cxf.CxfConsumer$1.setResponseBack(CxfConsumer.java:176)&#91;163:org.apache.camel.camel-cxf:2.8.2&#93; at org.apache.camel.component.cxf.CxfConsumer$1.asyncInvoke(CxfConsumer.java:103)&#91;163:org.apache.camel.camel-cxf:2.8.2&#93; at org.apache.camel.component.cxf.CxfConsumer$1.invoke(CxfConsumer.java:68)&#91;163:org.apache.camel.camel-cxf:2.8.2&#93; at org.apache.cxf.interceptor.ServiceInvokerInterceptor$1.run(ServiceInvokerInterceptor.java:58)&#91;141:org.apache.cxf.bundle:2.5.0&#93; at org.apache.cxf.interceptor.ServiceInvokerInterceptor.handleMessage(ServiceInvokerInterceptor.java:93)&#91;141:org.apache.cxf.bundle:2.5.0&#93; at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:263)&#91;141:org.apache.cxf.bundle:2.5.0&#93; at org.apache.cxf.phase.PhaseInterceptorChain.resume(PhaseInterceptorChain.java:232)&#91;141:org.apache.cxf.bundle:2.5.0&#93; at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:80)&#91;141:org.apache.cxf.bundle:2.5.0&#93; at org.apache.cxf.transport.http_jetty.JettyHTTPDestination.serviceRequest(JettyHTTPDestination.java:323)&#91;141:org.apache.cxf.bundle:2.5.0&#93; at org.apache.cxf.transport.http_jetty.JettyHTTPDestination.doService(JettyHTTPDestination.java:289)&#91;141:org.apache.cxf.bundle:2.5.0&#93; at org.apache.cxf.transport.http_jetty.JettyHTTPHandler.handle(JettyHTTPHandler.java:72)&#91;141:org.apache.cxf.bundle:2.5.0&#93; at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:939)&#91;59:org.eclipse.jetty.server:7.4.5.v20110725&#93; at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:875)&#91;59:org.eclipse.jetty.server:7.4.5.v20110725&#93; at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:117)&#91;59:org.eclipse.jetty.server:7.4.5.v20110725&#93; at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:185)&#91;59:org.eclipse.jetty.server:7.4.5.v20110725&#93; at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:110)&#91;59:org.eclipse.jetty.server:7.4.5.v20110725&#93; at org.eclipse.jetty.server.Server.handleAsync(Server.java:391)&#91;59:org.eclipse.jetty.server:7.4.5.v20110725&#93; at org.eclipse.jetty.server.HttpConnection.handleRequest(HttpConnection.java:594)&#91;59:org.eclipse.jetty.server:7.4.5.v20110725&#93; at org.eclipse.jetty.server.HttpConnection.handle(HttpConnection.java:393)&#91;59:org.eclipse.jetty.server:7.4.5.v20110725&#93; at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:535)&#91;54:org.eclipse.jetty.io:7.4.5.v20110725&#93; at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:40)&#91;54:org.eclipse.jetty.io:7.4.5.v20110725&#93; at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:529)&#91;53:org.eclipse.jetty.util:7.4.5.v20110725&#93; at java.lang.Thread.run(Thread.java:662)&#91;:1.6.0_24&#93;Looking into the source codes  before the line 395 of DefaultCxfBinding  the elements variable shoulde be checked if it's null.,0,0
NPE when using SEDA route and attaching an extra consumer,I'm trying to construct a system for moving some seda queues over toActiveMQ during system shutdown. What I did was create a Route thatconnects to some of my seda queues and then drains the queue to activemq.Basicly I got two routes  the drainer:from('seda:' + sedaId + '?size=1000') .routeId(routeName +sedaIs).noAutoStartup().to(activeMQFailuresQueue);And the main route:from('seda:' + sedaId + '?size=1000') .routeId(routeName + sedaIs).to(SomeProcessor);Now  sometimes the main route stalls for various reasons I need torestart the jvm process it is running in  so I start the first route.But when trying this in production  I got: java.lang.NullPointerException atorg.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:78) atorg.apache.camel.component.seda.SedaConsumer.sendToConsumers(SedaConsumer.java:210) atorg.apache.camel.component.seda.SedaConsumer.doRun(SedaConsumer.java:155) atorg.apache.camel.component.seda.SedaConsumer.run(SedaConsumer.java:129) atjava.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) atjava.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:619)Bvahdat added a comment:just a very tiny pointer:Looking at the source it seems that theSedaEndpoint.getConsumerMulticastProcessor() method returns 'null' causingthe NPE  as the condition:multicastStarted == false || consumerMulticastProcessor == nullis true.,0,0
Bindy does not support quoted value with separator char in CSV datasource,i'm currently writing a tuto on Camel (2.8.2).Showing HTTP4 component usage by downloading US Gov public data  i found a problem : from('quartz://dataTimer?cron=0+?').to('direct:datas'); from('direct:datas') .to('http4://earthquake.usgs.gov/earthquakes/catalogs/eqs7day-M1.txt') .unmarshal(new BindyCsvDataFormat('net.thejeearchitectcookbook.camel.earthquake')) .process(new Processor() { public void process(Exchange exchange) throws Exception { Message message = exchange.getIn(); // ... } });The data format is like and my separator char is ' ':nc 71678421 0 'Wednesday  November 9  2011 14:53:13 UTC' 37.5727 -118.8170 1.3 6.60 14 'Central California'I want to get all datas as java.lang.String but the date value raises exception :java.lang.IllegalArgumentException: No position 11 defined for the field: 14  line: 2 must be specified]My separator is ' ' but some values are nested inside ' '. Unfortunately there are ' ' inside the ' '.Bindy get lost !How can i get String values nested inside ' ' and containing ' ' ?I can note that Camel CSV component deals with it without any problems.Here is my pojo :package net.thejeearchitectcookbook.camel.earthquake;import java.io.Serializable;import org.apache.camel.dataformat.bindy.annotation.CsvRecord;import org.apache.camel.dataformat.bindy.annotation.DataField;@CsvRecord( separator = ' ')public class EarthquakeInfos implements Serializable { @DataField(pos = 1) private String src; @DataField(pos = 2) private String eqid; @DataField(pos = 3) private String version; @DataField(pos = 4) private String datetime; @DataField(pos = 5) private String lat; @DataField(pos = 6) private String lon; @DataField(pos = 7) private String magnitude; @DataField(pos = 8) private String depth; @DataField(pos = 9) private String nst; @DataField(pos = 10) private String place; public String getSrc() { return src; } public void setSrc(String src) { this.src = src; } public String getEqid() { return eqid; } public void setEqid(String eqid) { this.eqid = eqid; } public String getVersion() { return version; } public void setVersion(String version) { this.version = version; } public String getLat() { return lat; } public void setLat(String lat) { this.lat = lat; } public String getLon() { return lon; } public void setLon(String lon) { this.lon = lon; } public String getDepth() { return depth; } public void setDepth(String depth) { this.depth = depth; } public String getNst() { return nst; } public void setNst(String nst) { this.nst = nst; } public String getDatetime() { return datetime; } public void setDatetime(String datetime) { this.datetime = datetime; } public String getMagnitude() { return magnitude; } public void setMagnitude(String magnitude) { this.magnitude = magnitude; } public String getPlace() { return place; } public void setPlace(String place) { this.place = place; }} I can find that CSV Camel component performs well with the same datasource :from('direct:datas').to('http4://earthquake.usgs.gov/earthquakes/catalogs/eqs7day-M1.txt').unmarshal().csv().process(new Processor() { public void process(Exchange exchange) throws Exception { Message message = exchange.getIn(); List&lt;List&lt;String&gt;&gt; datas = (List&lt;List&lt;String&gt;&gt;) message.getBody(); // Skip header datas = datas.subList(1  datas.size() - 1); // Process my data for (List&lt;String&gt; row : datas) { // Process Row String datetime = row.get(3); String region = row.get(9); String magnitude = row.get(6); } }});,0,0
Bindy - CSV format - Should be able to marshal with quotes,See nabblehttp://camel.465427.n5.nabble.com/Bindy-CSV-marshal-does-not-properly-quote-values-defined-by-the-CsvRecord-separator-td4809017.htmlIts fairly common to marshal to/from with quotes in CSV format.We should make this easier by adding an attribute to @CsvRecord where you can define a quote char to use  either single or double etc.,0,0
Add option to override XSLT stylesheet used via header,Similar to 'dynamic templates' in velocity component http://camel.apache.org/velocity,0,0
Text improvements to camel-example-cxf-proxy.,Attachment has improvements to README and the camel-config.xml file shown in the online description of this sample: https://cwiki.apache.org/confluence/display/CAMEL/CXF+Proxy+Example (a web page I just updated).,0,0
When a route is removed from camel  LifecycleStrategy is called twice,DefaultCamelContext.removeRoute method has these lines among others if (getRouteStatus(routeId).isStopped()) { routeService.setRemovingRoutes(true); shutdownRouteService(routeService); removeRouteDefinition(routeId); ServiceHelper.stopAndShutdownServices(routeService);I think the last line from this snippet is not needed  because the route should be already stopped in order to pass the IF statement and then it is shutdown through this call shutdownRouteService(routeService); ServiceHelper.stopAndShutdownServices(routeService) tries to stops again the route if not stopped  but the worse is it shutdown the rout again.It seems to me like a bug  other thoughts?,0,0
Scala DSL does not support defining route-scoped error handlers,The Scala DSL does not allow for defining error handlers at the route scope. The 'errorHandler' method only sets the context-scoped error handler.,0,0
file endpoint to raise a warning msgs if unable to auto-create the starting directory,The file component tries to auto-create any non-existing starting directories however it does not raise any warnings if its unable to create the directory (e.g. due to file permission or due to unmounted file systems). It should at least log a warning msg if it cannot auto-create the starting directory.,0,0
Change cometd SslSocketConnetor to use SslSelectChannelConnector,Currently cometd uses SslSocketConnector for cometds connections. In its current configuration it can only support about 35 connections as SslSocketConnector is a blocking connector. Switching this to use the SslSelectChannelConnector in the same way it uses the SelectChannelConnector will fix this and allow the cometds to perform as the non ssl version.,0,1
Tokenize pair - evaluated as predicate should close input stream,If you read from a file and use the tokenize pair in a predicate such as a filter / content based router  then the input stream should be closed. Otherwise OS such as Windows keep a lock on the stream  and the file cannot be moved/deleted after processing is done.See nabblehttp://camel.465427.n5.nabble.com/Riding-on-org-apache-camel-language-TokenPairPredicateTest-tp5041981p5041981.htmlNote that using tokenizePair as a predicate is must likely very unusual  as its meant for splitting a stream into tokens  and thus most often only used with the splitter EIP.,0,1
Unable to set logName on DefaultErrorHandler as well as executorService on LoggingErrorHandler,The following snippets do not work  although each of the specified error handlers supports logName and executorServiceRef. The issue is actual for the DeadLetterChannel error handler too.LoggingErrorHandler&lt;errorHandler id='errorHandler' type='LoggingErrorHandler' logName='${router.logger.name}' executorServiceRef='redeliveryExecutor'/&gt;DefaultErrorHandler&lt;errorHandler id='errorHandler' type='DefaultErrorHandler' logName='${router.logger.name}' executorServiceRef='redeliveryExecutor'/&gt;StackTraceCaused by: org.springframework.beans.factory.BeanDefinitionStoreException: Unexpected exception parsing XML document from class path resource [META-INF/spring/camel-context.xml]; nested exception is java.lang.IllegalArgumentException: Attribute executorServiceRef is not supported by error handler type: LoggingErrorHandler  in error handler with id: errorHandler at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.doLoadBeanDefinitions(XmlBeanDefinitionReader.java:412) at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:334) at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:302) at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:143) at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:178) at org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader.importBeanDefinitionResource(DefaultBeanDefinitionDocumentReader.java:186) ... 42 moreCaused by: java.lang.IllegalArgumentException: Attribute executorServiceRef is not supported by error handler type: LoggingErrorHandler  in error handler with id: errorHandler,0,0
Avoid explicit cast while using the CamelContext.getEndpoint() or ApplicationContext.getBean() API and better rely on the overloaded counterpart of them taking a class type as the second argument (implicit cast),Some simple change examples on the trunk are:From:jpaTemplate = (JpaTemplate)applicationContext.getBean('jpaTemplate');To:jpaTemplate = applicationContext.getBean('jpaTemplate'  JpaTemplate.class);OrFrom:HttpEndpoint epOut = (HttpEndpoint) getContext().getEndpoint('http://localhost:' + port1 + '?bridgeEndpoint=true&amp;throwExceptionOnFailure=false');To:HttpEndpoint epOut = getContext().getEndpoint('http://localhost:' + port1 + '?bridgeEndpoint=true&amp;throwExceptionOnFailure=false'  HttpEndpoint.class);Here another one with the removal of @SuppressWarnings as a side effect:From: @SuppressWarnings('unchecked') public &lt;T&gt; T lookup(Class&lt;T&gt; type) { ApplicationContext context = getApplicationContext(); String[] names = context.getBeanNamesForType(type  true  true); if (names != null) { int count = names.length; if (count == 1) { // lets instantiate the single bean return (T)context.getBean(names[0]); } else if (count &gt; 1) { throw new IllegalArgumentException('Too many beans in the application context of type: ' + type + '. Found: ' + count); } } throw new IllegalArgumentException('No bean available in the application context of type: ' + type); }To: public &lt;T&gt; T lookup(Class&lt;T&gt; type) { ApplicationContext context = getApplicationContext(); String[] names = context.getBeanNamesForType(type  true  true); if (names != null) { int count = names.length; if (count == 1) { // lets instantiate the single bean return context.getBean(names[0]  type); } else if (count &gt; 1) { throw new IllegalArgumentException('Too many beans in the application context of type: ' + type + '. Found: ' + count); } } throw new IllegalArgumentException('No bean available in the application context of type: ' + type); }There're also cases where we could make a huge benefit of this so that the following code: public &lt;T&gt; T getMandatoryBean(Class&lt;T&gt; type  String name) { Object value = applicationContext.getBean(name); assertNotNull('No spring bean found for name &lt;' + name + '&gt;'  value); if (type.isInstance(value)) { return type.cast(value); } else { fail('Spring bean &lt;' + name + '&gt; is not an instanceof ' + type.getName() + ' but is of type ' + ObjectHelper.className(value)); return null; } }became just a one liner as: public &lt;T&gt; T getMandatoryBean(Class&lt;T&gt; type  String name) { return applicationContext.getBean(name  type); }I also came across the cases where the prefered API indeed was used but there were unneccessary casts around it:From:// must type cast to work with Spring 2.5.xSpringCamelContext context = (SpringCamelContext) applicationContext.getBeansOfType(SpringCamelContext.class).values().iterator().next();To:SpringCamelContext context = applicationContext.getBeansOfType(SpringCamelContext.class).values().iterator().next();Another benefit of this patch is a better test code coverage  because as one would intuitively expect DefaultCamelContext.getEndpoint(String name  Class&lt;T&gt; endpointType) makes use of DefaultCamelContext.getEndpoint(String uri) before casting and returning the answer. So that now through the usage of the first method API (expecting two parameters) we do call both of them while testing (one explicitly and the other one implicitly) There're 147 sources affected by the provided patch (one source change is just because of an already pre-existing checkstyle violation by HtmlToPdfMojo.java on the trunk).I did verify only the tests on camel-core but not the rest with the following test result (Windows-Vista):Results :Failed tests: testConcurrentAppend(org.apache.camel.component.file.FileConcurrentWriteAppendSameFileTest): mock://result Received message count. Expected: &lt;5000&gt; but was: &lt;2655&gt;Tests run: 3969  Failures: 1  Errors: 0  Skipped: 0&#91;INFO&#93; ------------------------------------------------------------------------&#91;INFO&#93; BUILD FAILURE&#91;INFO&#93; ------------------------------------------------------------------------&#91;INFO&#93; Total time: 25:49.095s&#91;INFO&#93; Finished at: Sun Dec 11 00:45:35 CET 2011&#91;INFO&#93; Final Memory: 20M/494M&#91;INFO&#93; ------------------------------------------------------------------------&#91;ERROR&#93; Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2.8:test (default-test) on project camel-core: There are test failures.,0,0
Extra request parameters sent by the camel-http4 component,Described in http://camel.465427.n5.nabble.com/Extra-Request-Params-sent-in-camel-HTTP-component-GET-request-td5042808.htmlRoute from('jetty:http://0.0.0.0:8080/myapp/myservice') .to('http4://www.google.com/?q=camel&amp;bridgeEndpoint=true&amp;throwExceptionOnFailure=false'); sends to the server the bridgeEndpoint=true&amp;throwExceptionOnFailure=false parameters while route from('jetty:http://0.0.0.0:8080/myapp/myservice') .to('http://www.google.com/?q=camel&amp;bridgeEndpoint=true&amp;throwExceptionOnFailure=false'); behaves properly and removes them,0,0
camel-quartz - Using underscore in group name does not work,The group name is not properly resolved if people specify a invalid host name  such as with underscores.If so we should fallback and grab the group name by grabbing the string until the first path separator char.See nabblehttp://camel.465427.n5.nabble.com/Camel-Quartz-consumer-doesn-t-allow-underscores-tp5063734p5063734.html,0,0
Make Ant path matching in file / FTP component easier to use,The existing codebase has an implicit optional dependency from camel-core to camel-spring; camel-core contains the class AntPathMatcherGenericFileFilter  which internally uses camel-spring's SpringAntPathMatcherFileFilter class via runtime classpath checks and reflection. The reason that SpringAntPathMatcherFileFilter is in camel-spring is that it uses Spring's AntPathMatcher class internally. Interestingly  there is already an AntPathMatcher class with an API very similar to Spring's class in the camel-core-xml module.This patch moves camel-core-xml's AntPathMatcher into camel-core  removes the classpath and reflection magic in camel-core's AntPathMatcherGenericFileFilter class  and adds a new class to camel-core named GenericFileFilterConverter  which automagically converts strings to ant path file filters. The patch also adds some unit tests.The end result is that Camel users can now use ant path matching with the file and FTP components without having to add a dependency on camel-spring  and Camel users can specify the ant path expression to use directly in the component querystring  rather than having to go through the work of registering an additional file filter instance in the registry (although this is only true when the user only needs to specify a single include path  which is a very common use case). For example:from('file://target/blah?recursive=true&amp;filter=*/.txt') .to(...);Instead of:from('file://target/blah?recursive=true&amp;filter=#myTxtFilter') .to(...);,0,0
camel-aws can allow SNAPSHOT transitive dependencies,The camel-aws component depends on aws-java-sdk which has several dependencies defined using version ranges. The problem with version ranges is that they can introduce SNAPSHOT versions if they are available on your system which is not so good... in my case I had this http://download.java.net/maven/2/com/sun/mail/javax.mail/1.4.5-SNAPSHOT/javax.mail-1.4.5-SNAPSHOT.jar jar in my local repo so camel-aws promptly used that SNAPSHOT lib.,0,0
Improve Camel aws-sdb component,I would like to improve the aws-sdb component in the following places: Using the Amazon operation names instead of CamelAwsSdbXXX -&gt; With this we can easily support more operations (in the future) and the users are more familiar with this names Add OSGI integration testsI would like to resolve this issue for Camel 2.9.0 because renaming of the operation names are not backwards compatible. I will resolve this issue today.,0,0
After restarting route a camel-quartz component fires right away (and it shouldn't),I am adding a new QuartzRouteRestartTest that demonstrates this issue. Not only a message is fired right after restart  but the scheduled times are messed up as well. I tried to keep the fire interval as low as possible  but it has to be large enough to demonstrate the problem. So I went down to 0/5 (fire every five sec)  but it's more obvious with 0/10 or 0/15  the trigger starts firing at the wrong time.,0,0
camel-jms - Include details about correlation id in exchange timeout exception if a reply message did not come back,This helps make it easier to spot situations when doing request/reply over JMS and the reply message is not received within the timeout period.And then the reply messages comes later.Then it should be easier to spot in the logs when the timeout occurred  and the correlation ID should be in the logs  so you can correlate these two situations.,0,0
Add replyTo option to camel mail component,Add replyTo option to camel mail component,0,0
interceptSendToEndpoint with predicate and skip,The &lt;when&gt; clause in the interceptors behave like filters. This is okay with intercept and interceptFrom  where the only possible route manipulation is &lt;stop /&gt;  which is expressed inside the routing block.However  with interceptSendToEndpoint there is one edge case that could cause ambiguity. When skipSendToEndpoint=true  along with a &lt;when&gt; clause  the user might expect that the skipping will only occur if the condition is met. However  it occurs always. The &lt;when /&gt; only determines whether the routing logic contained inside the body of the intercept block will occur or not.I propose to add a new attribute onlySkipWhenConditionMet  so that when this is true  the &lt;when&gt; clause will be evaluated to determine if the originally intended endpoint is actually skipped or not.,0,0
camel-eventadmin do not work,Christian-Muellers-MacBook-Pro:bin cmueller$ ./karaf cleankaraf@root&gt; features:addurl mvn:org.apache.camel.karaf/apache-camel/2.9.0/xml/featureskaraf@root&gt; features:install camel-eventadminError executing command: Could not start bundle mvn:org.apache.camel/camel-eventadmin/2.9.0 in feature(s) camel-eventadmin-2.9.0: Unresolved constraint in bundle org.apache.camel.camel-eventadmin &#91;59&#93;: Unable to resolve 59.0: missing requirement &#91;59.0&#93; package; (&amp;(package=org.osgi.service.event)(version&gt;=1.2.0)(!(version&gt;=2.0.0)))We have to install the feature eventadmin (from Karaf) first,0,0
Log EIP - Check if it should log first before evaluating exchange,In the log EIP only evaluate the log message if really needed  eg shouldLog returns true,0,1
Tech edits of JavaDoc and other code comments -- lets -> (let's  allow  {}),Partial conversion of 'lets do...' to 'let's do...'  'allows for doing'  or 'do...' as appropriate  and associated other nitpicks found. 'Let's' retained more where the code is part of an example or tutorial or if it's a matter-of-opinion on how to implement.,0,0
Ability to specify the cache level on JMS reply to queue,I'm trying to use Camel (v 2.6.0) JMS Request/Reply with Websphere 7 using Websphere MQ. I'm successfully able to put the request message onto the queue using the following URI: jms:queue:inboundQueue?connectionFactory=#connectionFactory&amp;taskExecutor=#taskExecutor&amp;transactionManager=#transactionManager&amp;cacheLevelName=CACHE_NONE&amp;replyTo=outboundQueue&amp;requestTimeout=120000 Note: I have to use cacheLevelName=CACHE_NONE in order for this to work on Websphere. However  when Camel creates the PersistentQueueMessageListenerContainer to read the reply message  it is hard coding the cache level to CACHE_SESSION (see PersistentQueueReplyManager.java line 192). What happens is that Camel is successfully able to read the reply off the queue  but then spits out the following error repeatedly: 23 Dec 2011 09:23:32 427|||WorkManager.DefaultWorkManager : 3||WARN |org.springframework.jms.listener.DefaultMessageListenerContainer|Setup of JMS message listener invoker failed for destination 'outboundQueue' - trying to recover. Cause: Connection closed I believe this is due to the PersistentQueueMessageListenerContainer using a cache level of CACHE_SESSION instead of CACHE_NONE. Can Camel be enhanced to have the ability to set the cache level on the reply queue?,0,0
Remove ProducerCache from CamelContext service list when shutting down a route,If people add routes dynamic and remove the routes later on  we need to remove services which may have been added to the CamelContext services list. For example the ProducerCache by SendProcessor etc.This will ensure that the ProducerCache can be GC'ed.,0,1
camel-mina - Make it easier to use a custom thread pool for the consumer,It should be easier to use a custom thread pool for the mina consumer  in case you use it in sync mode  where the consumer thread would then be synchronous  and thus take up a thread. So in case you put load on the mina consumer  it will use up the default thread pool size of 10 threads.We should add documentation in the wiki  how to use a custom thread pool / and pool profile.See nabblehttp://camel.465427.n5.nabble.com/inflight-exchange-and-queue-of-apache-camel-tp5112396p5112396.html,0,0
BAM - database constraint violation when restaring application,Take BAM example from http://camel.apache.org/bam-example.html (or any other one  it doesn't matter).Here is the one I'm using: ActivityBuilder request = activity('eaiBroker:topic:SOME_TOPIC?concurrentConsumers=1').name('Request') .correlate(xpath('/MessageRequest/@Id').stringResult()); ActivityBuilder response = activity('eaiBroker:topic:SOME_OTHER_TOPIC?concurrentConsumers=1').name('Response') .correlate(xpath('MessageResponse/@Id').stringResult()); response .starts().after(request.completes()) .expectWithin(seconds(15)) .errorIfOver(seconds(30)) .to('log:com.eai?level=error'); First run of the application and everything works. Restart application and try to activate one of BAM rules  there will be an exception that database constraint has been violated. Every time application is started  Camel tries to do following sql insertinsert into CAMEL_ACTIVITYDEFINITION (name  processDefinition_id  id) values (?  ?  ?)but name columne must be unique in CAMEL_ACTIVITYDEFINITION .Workaround for this is to purge BAM tables every time you want to restart the application  but it's not a solution.,0,0
xpath expression with $header with saxon may throw exception if header did not exist,See CAMEL-747We should return an empty String instead of a Void.class  as this works with both JDK + Saxon XPathEngine.Saxon does not work with the Void.class.,0,0
add feature for camel-context component,Workaround until this makes it into a release is of course justosgi:install -s mvn:org.apache.camel/camel-context/2.9.0,0,0
Timed out Exchanges should be removed from seda queues,When the SedaProducer times out and stops waiting for an Exchange to be processed it should remove it from the queue as well. Same applies to the vm: component.,0,1
CamelContext autoStartup=false and starting context programmatically doesnt work,If a &lt;camelContext&gt; is set to autoStartup=false and then later tried to start it via code or JMX doesn't start routes associated with it.,0,0
Parameter binding not working with BeanExpression,The parameter binding options available in camel-2.9.0 do not work for BeanExpression. The reason is the fake ognl parser that gets confused about the syntax. We need to align the two scenarios and probably replace the ognl like parsing.,0,0
SedaConsumer - Should not poll if CamelContext is starting,If you startup Camel with many routes  which mean starting Camel may take some seconds or whatnot  and then SedaConsumer may poll messages  while CamelContext is starting. It should avoid polling until CamelContext is fully started.,0,0
camel-blueprint - Using namespaces with xpath does not work as the namesapces is not parsed and injected into the camel model,Using xpath predicates in a blueprint xml file does not work if you use custom namespaces  as the camel-blueprint component does not detect the custom namespaces  as camel-spring does.,0,0
Testing headers in multiple messages,The need is something similar to expectedBodiesReceivedInAnyOrder applied to headers :I know that a given endpoint will receive 3 messages in any order  and I need to test ONE header in each of these messages.I wrote :getMockEndpoint('mock:zipSHP').expectedHeaderReceived('zippedFile'  '001.zip');getMockEndpoint('mock:zipSHP').expectedHeaderReceived('zippedFile'  '002.zip');getMockEndpoint('mock:zipSHP').expectedHeaderReceived('zippedFile'  '003.zip');for the route :for('file://filesToBeZipped/').to('bean:my.bean.ZipperBean').log('Zipped : ...');The endpoint effectively received the three messages (the results of three ZIP operations) but the test failed saying that the first message header was '003.zip' and not the expected '001.zip'.,0,0
ManagedBrowsableEndpoint are broken,ManagedeBrowsableEndpoint are broken which means any component that inherit ManagedBrowsableEndpoint have errors as well. Please see the link below which will have error screen shot of queueSize JMX operations.http://camel.465427.n5.nabble.com/JMX-queue-size-operation-fails-Camel-2-9-0-td5233089.html,0,0
exchange.getIn().getBody(.class) throws an exception for Jaxb model objects,exchange.getIn().getBody(Foo.class);should return a Foo instance or null  if no suitable type converter is available. The java doc says: 'return the body of the message as the specified type  or &lt;tt&gt;null&lt;/tt&gt; if not possible to convert'If Foo is an Jaxb object model  this method call: throws an org.xml.sax.SAXParseException if the body content is a string throws a javax.xml.bind.UnmarshalException if the body content is another Jaxb model objectPlease have a look on the attached sample eclipse project.,0,0
Camel 2.9.0 incapable of working with % in endpoint URIs,In the class org.apache.camel.util.URISupport which will be used to resolve endpoints (DefaultCamelContext#normalizeEndpointUri) the method parseParameters will be called.At first the java.net.Uri#getQuery will be called with according to the javadoc 'Returns the decoded query component of this URI' returns a decoded URI. If that fails the java.net.Uri#getSchemeSpecificPart method will be called which according to the javadoc 'Returns the decoded scheme-specific part of this URI.' returns a decoded URI.So to summarize we get in any case a decoded URI.This URI will then be than in the method org.apache.camel.util.URISupport#parseQuery(String) again decoded with java.net.URLDecoder#decode(String String).This code leads to the following behaviour: If a % is properly encoded with %25test the %25test will be substituted by the first call to %test and the decoded again which leads to an Exception.In the http://svn.apache.org/viewvc?view=revision&amp;revision=1166508 commit you can see that the % was uncommented from org.apache.camel.util#UnsafeUriCharactersEncoder. Maybe this is related.However... Double encoding of URIs seems quite odd. With any URI char there is no issue with that. But with % the % will be decoded again  which makes a % unusable in Camel.,0,0
antInclude support for case insensitive patterns,antIncude patterns are case sensitive. I need a case insensitive file matching pattern with file and ftp components.note: custom filters is not applicable since I read patterns from database there is no way to correlate the filters with the routes.,0,0
Cannot use xquery predicate in filter after an xpath splitter.,After upgrading from 2.5.0 to 2.9.0 using xqury predicate after an xpath filter throws java.lang.ClassCastException: net.sf.saxon.tinytree.TinyElementImpl cannot be cast to net.sf.saxon.om.DocumentInfo . Attached unit test doesn't fail in camel 2.5.0.from('direct:xpath') .split(xpathsplitter) .filter().xquery('//record&#91;type=2&#93;') .to('mock:result'); See nabble discussion http://camel.465427.n5.nabble.com/Unit-test-fails-after-upgrading-to-2-7-1-Cannot-use-xquery-expression-after-xpath-td4422582.html,0,0
Problem Removing Endpoints,(see context on the users@ list)When using removeEndpoints(String) with a pattern  some endpoints (like jms topics) are reported as removed but they are not.,1,0
Spring security example does not work,When you try to run the spring security example and access it from a browser you get 404. I debugged into it and the reason is that the camel context does not attach to the camel http servlet.,1,0
ManagedPerformanceCounterMBean should extend ManagedCounterMBean,ManagedPerformanceCounterMBean does not extend ManagedCounterMBean  while ManagedPerformanceCounter does extend ManagedCounter.,0,0
BindyDataFormat should not use the default encoding,Here is the mail thread&#91;1&#93; which discuss about it.&#91;1&#93;http://camel.465427.n5.nabble.com/Bindy-CSV-parser-uses-default-encoding-tp5456136p5456136.html,0,0
Add session information from cometd to camel message headers,The cometd component has the ability to authenticate a connection with a custom SecurityPolicy.&#91;1&#93; This information can then be added to the cometd session for further calls. Unfortunately  session attributes aren't passed to the camel message for processing by endpoints and processors further down the line. 1. http://cometd.org/documentation/2.x/howtos/authentication,1,0
UnsupportedOperationException thrown if @Consume method is not public,If the org.apache.camel.Consume annotation is used on a method that is not public (e.g. default visibility)  then the following exception will be thrown every time a message is delivered to that consumer and the message will roll-back with the consumer never invoked.2012-02-08 16:29:37 298 [Camel Thread 0 - JmsConsumer&#91;paula.inprogress&#93; WARN org.apache.camel.component.jms.JmsMessageListenerContainer - Execution of JMS message listener failed  and no ErrorHandler has been set.org.apache.camel.RuntimeCamelException: java.lang.UnsupportedOperationException at org.apache.camel.util.ObjectHelper.wrapRuntimeCamelException(ObjectHelper.java:1139) at org.apache.camel.component.jms.EndpointMessageListener.onMessage(EndpointMessageListener.java:115) at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:560) at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:498) at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:467) at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325) at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:243) at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1058) at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1050) at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:947) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:680)Caused by: java.lang.UnsupportedOperationException at java.util.Collections$UnmodifiableMap.put(Collections.java:1285) at org.apache.camel.component.bean.BeanInfo.introspect(BeanInfo.java:256) at org.apache.camel.component.bean.BeanInfo.createInvocation(BeanInfo.java:136) at org.apache.camel.component.bean.BeanProcessor.process(BeanProcessor.java:142) at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:109) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:103) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:85) at org.apache.camel.component.jms.EndpointMessageListener.onMessage(EndpointMessageListener.java:92) ... 11 moreI appreacate that this not specifically a bug  so I am filing this as an improvement. However this is a REALLY misleading error message. A more specific error message would be greaty appreaceated and save a lot of time. Thanks.,0,0
DigitalSignatureEndpoint not clearing headers after verify,The DigitalSignatureEndpoint has a clearHeaders option that is supposed to clear headers after a verify operation. However that is not working because the headers cleared are not the actual header values  but the name of the java String fields  which is irrelevant at runtime.The default value of the clearHeaders should also be true  so that Camel does not leave debris in the Exchange after a verify operation.,0,1
Error handler not called when recipient list has non existing endpoint,Given this route onException(Exception.class) .handled(true) .to('mock:dead'); from('direct:start') .recipientList(constant('fail:endpoint')) .to('mock:result');You would assume the on exception will handle the exception from the recipient list with the non existing endpoint.This is not the case. We should let recipient list detect and let the error handler handle it.,0,0
Camel simple language wrong working with real number,I compute real number in route: &lt;setBody&gt;0.02&lt;/setBody&gt;After that I want to filter: &lt;filter&gt;&lt;simple&gt;${body} &gt; 0 &lt;/simple&gt; ... &lt;/filter&gt;This expression return false for value in body = 0.02,0,0
simple without embedded text results in an NPE,After switching to 2.9 the following results in a NPE&lt;camel:setBody&gt; &lt;camel:simple&gt;&lt;/camel:simple&gt;&lt;/camel:setBody&gt;I'm not sure if it is now required to have something in the content of the simple element. I used it for setting the body element to an empty string before (worked with 2.8.1),0,0
Support unmarshall of CSV files that does not contain all fields described in the annotated POJO.,Actually when trying to unmarshall a CSV that does not contain all the fields described via @DataField annotation  an IllegalArgumentException is thrown. Would be better to define a default value for non required fields via @DataField annotation and therefore  not fail.,0,0
Streaming splitter ignores exception handling,If an exception occurs on the next() call of an Iterator in a streaming splitter  the exception is never propagated to the exception or the error handler. This will lead to improper route termination  and inifite rollback/retry cycles.I attached the minimal test case demonstrating the issue.,0,1
CxfProducer should release the CXF when the Producer is stopped.,CXF ClientImpl has the requestContext need to be cleaned when the CxfProducer is stopped.If we don't call the Client.destory() method  the requestContext will cause the memory leak.,0,1
Camel route with bean element sends on startup invalid message to target route that is represented by a proxy who exposes route,I expose a Camel route with a direct endpoint defined in an OSGi bundle with the &lt;camel:proxy&gt; and &lt;osgi:service&gt; tags. The reason for this is to be able to call this direct-route in other routes (defined in other bundles) as a 'sub-route' directly as bean &#91;.bean(routeproxy  &quot;method&quot;)&#93;. This works as expected.But on route startup the toString method is called on the route (for a description) which is propagated to the elements of the route. Therefore my bean-element (which is the direct-route-proxy) receives the toString call and the CamelInvocationHandler converts this toString call to a message and sends it to the direct-route. This more or less empty message is of course not valid for the target route and produces an error on bundle startup. Shouldn't the toString call be suppressed by the proxy  since toString is not part of the Interface the proxy represents? Or is my approach a not recommended or problematic approach?Parts of stacktrace to show the way from route startup to the produced message=&gt; route receives 'empty' message&#91;omitted&#93; at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:45) at org.apache.camel.component.bean.CamelInvocationHandler.invoke(CamelInvocationHandler.java:65) at $Proxy568.toString(Unknown Source) at sun.reflect.GeneratedMethodAccessor406.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597)=&gt; toString call is converted to message and sent to route&#91;omitted&#93; at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171) at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204) at $Proxy583.toString(Unknown Source) at org.apache.camel.component.bean.ConstantBeanHolder.toString(ConstantBeanHolder.java:48)=&gt; toString called on bean-element in route (bean is a proxy for a route) &#91;omitted&#93; at java.lang.String.valueOf(String.java:2826) at java.lang.StringBuilder.append(StringBuilder.java:115) at org.apache.camel.impl.EventDrivenConsumerRoute.toString(EventDrivenConsumerRoute.java:46) at org.apache.camel.management.mbean.ManagedRoute.&lt;init&gt;(ManagedRoute.java:41) at org.apache.camel.management.DefaultManagementLifecycleStrategy.onRoutesAdd(DefaultManagementLifecycleStrategy.java:368) at org.apache.camel.impl.RouteService.doStart(RouteService.java:109)=&gt; Route startup,0,0
Memory leak in SedaComponent if adding and removing a lot of seda endpoints with different queue names,If you add and remove a lot of seda endpoints with different queue names  then the seda component may keep references to non used queues.,0,1
Memory leak in TimerListener if JMX enabled,If adding and removing a lot of routes  and you have JMX enabled with load statistics  then it may leak memory  as the route listener is not properly removed when the route is removed  due invalid equals/hashCode.,0,1
DefaultUnitOfWork should copy headers from the original message if it's a JmsMessage,see Nabble for details,0,0
Offer a way to not set a transaction manager in camel-jms,The following sample Spring config sets up a camel-activemq component&lt;bean id='activemq' class='org.apache.activemq.camel.component.ActiveMQComponent'&gt; &lt;property name='configuration' ref='jmsConfigAmq' /&gt; &lt;/bean&gt; &lt;bean id='jmsConfigAmq' class='org.apache.activemq.camel.component.ActiveMQConfiguration' &gt; &lt;property name='connectionFactory' ref='jmsPooledConnectionFactory' /&gt; &lt;property name='transacted' value='true'/&gt; &lt;!-- &lt;property name='transactionManager' ref='jmsTransactionManager' /&gt; --&gt; &lt;property name='cacheLevelName' value='CACHE_CONSUMER'/&gt; &lt;/bean&gt; &lt;bean id='jmsTransactionManager' class='org.springframework.jms.connection.JmsTransactionManager'&gt; &lt;property name='connectionFactory' ref='jmsPooledConnectionFactory' /&gt; &lt;/bean&gt; &lt;bean id='jmsConnectionFactory' class='org.apache.activemq.ActiveMQConnectionFactory'&gt; &lt;property name='brokerURL' value='tcp://localhost:61617' /&gt; &lt;property name='watchTopicAdvisories' value='false' /&gt; &lt;/bean&gt; &lt;bean id='jmsPooledConnectionFactory' class='org.apache.activemq.pool.PooledConnectionFactory' &gt; &lt;property name='maxConnections' value='1'/&gt; &lt;property name='connectionFactory' ref='jmsConnectionFactory'/&gt; &lt;/bean&gt;The ActiveMQConfiguration sets transacted=true and configures for a JmsTransactionManager. Also  a PooledConnectionFactory is used. The config for a camel-jms component would be similar.The Spring JMS javadoc on AbstractPollingMessageListenerContainer.setTransactionManager states:Note: Consider the use of local JMS transactions instead. Simply switch the 'sessionTransacted' flag to 'true' in order to use a locally transacted JMS Session for the entire receive processing  including any Session operations performed by a SessionAwareMessageListener (e.g. sending a response message).It basically advises to only set transacted=true and don't specify a TX manager. The benefit of doing so is that the cacheLevel setting will be honored when using local transactions without a configured TX manager. When a TX manager is configured  no caching happens at DMLC level and its necessary to rely on a pooled connection factory. This is discussed here.However right now its not possible to configure the cameljms or camel-activemq component to not use an external TX manager when transacted=true is set.Even when setting lazyCreateTransactionManager=false.In case of camel-activemq  it still creates a default JmsTransactionManager:ActiveMQConfiguration.javapublic PlatformTransactionManager getTransactionManager() { PlatformTransactionManager answer = super.getTransactionManager(); if (isTransacted() &amp;&amp; answer == null) { // lets auto-default the transaction manager if its not specified answer = createTransactionManager(); setTransactionManager(answer); answer = getTransactionManager(); } return answer;}In case of camel-jms it throws an exception:JmsConfiguration.javaPlatformTransactionManager tm = getTransactionManager();if (tm != null) { container.setTransactionManager(tm);} else if (transacted) { throw new IllegalArgumentException('Property transacted is enabled but a transactionManager was not injected!');}We should allow for using transactions in camel-jms and camel-activemq without setting an external TX manager.,0,0
Bug: Unique Endpoints Leaking in DefaultInflightRepository,If you have an endpoint protocol which uses unique URIs you will leak Strings in the HashMap stored in the DefaultInflightRepository (org.apache.camel.impl.DefaultInflightRepository)It seems there is a reference counting scheme in place  but it doesn't do a remove until the 'stop' method is called to shut the system down. We are running XMPP endpoints  which use a protocol like xmpp://someaccount@domain/password?to=someOtherAccountWhen there are 10 million accounts  not all of which are active  but all of which may message at some time or another  no references are removed to the endpointCount.When the count becomes 0  the reference should be removed and the size method will still return the appropriate result.Please be careful in the implementation to synchronize on some object (perhaps the AtomicInteger) reflecting a read/write lock on the endpoint count modification.,0,1
npe in camel 2.9.1 validator,validator component seems broken in 2.9.1. Gives you a npe when loading xsd from classpath during unittesting.See http://camel.465427.n5.nabble.com/npe-in-camel-2-9-1-validator-tc5540894.htmlprefixing with classpath eg. &lt;to uri='validator:classpath:BroadcastMonitor.xsd' /&gt; doesn't help.,0,0
camel-jt400 - Parameter length when doing Program Call issue,When the length of each parameter of a program.PGM is greater than the length of his values  the parameters are setted incorrectly.Example:Input of program.pgm:param1 -&gt; A5 (alphanumeric with length 5) param2 -&gt; A5 (alphanumeric with length 5) When the String array is {'123'  '456'} the values are setted on each parameter as:param1 = 12345param2 = 6,0,0
org.apache.camel.component.mybatis.MyBatisBatchConsumerTest.testBatchConsumer() fails unpredictable,I assume we see this failure when we inserted the first test into the database (and only the first one) when the mybatis consumer starts to poll the database. See build failure: https://builds.apache.org/job/Camel.2.8.x.fulltest/org.apache.camel$camel-mybatis/149/,0,0
Incorrect feature definition for camel-fop,,0,0
Timer component - Should use thread name pattern so the thread name is aligned with the Camel threads,When using the timer component  the thread name will just be the timer name.Before2012-03-16 09:28:42 857 [foo ] INFO route1 - Fired timerAfter2012-03-16 09:28:18 611 [Camel (camel-1) thread #0 - foo ] INFO route1 - Fired timer,0,0
Add option autogenColumns to csv data format in XML DSL,See nabblehttp://camel.465427.n5.nabble.com/CSV-dateformat-bug-Attribute-AutogenColumns-is-not-allowed-to-appear-in-element-camel-csv-tp5570066p5570066.htmlThis option is not exposed in the &lt;csv&gt; data format in the XML DSLs,0,0
Timer endpoint getState does not work in JMX,The getState attribute does not work.,0,0
Add the options configRef and strategyRef to csv data format in XML DSL,CAMEL-5100 provided the autogenColumns option which doesn't bring much on it's own (default is true)  which with an explicit value set to false nothing will be appended into the output other than '/n''s.So using the configRef and strategyRef options we could then bring the same power of expression inside XML DSL like inside Java. Following a sample where the user can customize the used CSVConfig and/or CSVStrategy being used: &lt;camelContext id='camel' xmlns='http://camel.apache.org/schema/spring'&gt; &lt;route&gt; &lt;from uri='direct:start' /&gt; &lt;marshal&gt; &lt;csv autogenColumns='false' delimiter='|' configRef='csvConfig1' /&gt; &lt;/marshal&gt; &lt;convertBodyTo type='java.lang.String' /&gt; &lt;to uri='mock:result' /&gt; &lt;/route&gt; &lt;route&gt; &lt;from uri='direct:start2' /&gt; &lt;marshal&gt; &lt;!-- make use of a strategy other than the default one which is 'org.apache.commons.csv.CSVStrategy.DEFAULT_STRATEGY' --&gt; &lt;csv autogenColumns='false' delimiter='|' configRef='csvConfig2' strategyRef='excelStrategy' /&gt; &lt;/marshal&gt; &lt;convertBodyTo type='java.lang.String' /&gt; &lt;to uri='mock:result2' /&gt; &lt;/route&gt; &lt;/camelContext&gt; &lt;bean id='csvConfig1' class='org.apache.commons.csv.writer.CSVConfig'&gt; &lt;property name='fields'&gt; &lt;list&gt; &lt;!-- here we're only interested in 'item' but not in 'orderId' or 'amount' --&gt; &lt;bean class='org.apache.commons.csv.writer.CSVField'&gt; &lt;property name='name' value='item' /&gt; &lt;/bean&gt; &lt;/list&gt; &lt;/property&gt; &lt;/bean&gt; &lt;bean id='csvConfig2' class='org.apache.commons.csv.writer.CSVConfig'&gt; &lt;property name='fields'&gt; &lt;list&gt; &lt;!-- here we're interested in both 'orderId' and 'amount' but not in 'item' --&gt; &lt;bean class='org.apache.commons.csv.writer.CSVField'&gt; &lt;property name='name' value='orderId' /&gt; &lt;/bean&gt; &lt;bean class='org.apache.commons.csv.writer.CSVField'&gt; &lt;property name='name' value='amount' /&gt; &lt;/bean&gt; &lt;/list&gt; &lt;/property&gt; &lt;/bean&gt; &lt;bean id='excelStrategy' class='org.springframework.beans.factory.config.FieldRetrievingFactoryBean'&gt; &lt;property name='staticField' value='org.apache.commons.csv.CSVStrategy.EXCEL_STRATEGY' /&gt; &lt;/bean&gt;,0,0
Set Restlet Server Options and Return HTTP Headers Set in Exchange,The underlying Restlet server options can now be set via an Endpoint option.HTTP headers (e.g. Expires or Last Modified) are returned properly from the exchange to the Restlet.,0,0
CxfBeanDestination should copy the in message header to the out message,User complains about can not access any other headers after the cxfbean in this mail thread&#91;1&#93;.We should let the CxfBeanDestination copy the in message header before it sends the message back.&#91;1&#93;http://camel.465427.n5.nabble.com/Camel-CXF-Drops-Headers-tt5590792.html,0,0
RMI endpoint doesn't handle nested exception and raise CamelRuntimeException instead of RemoteException,When we have a route looking like:&lt;from uri='rmi:...'/&gt;&lt;to uri='myBean'/&gt;if an exception is raised on myBean  the RMI endpoint ignores the exception described in the RemoteInterface and always raises a RuntimeCamelException nesting the original exceptions.More over  RuntimeCamalException should not be raised by the RMI endpoint. It would make more sense to raise a RemoteException  as we are on a RMI endpoint.,0,0
bean component - @Handler should take precedence in a bean that implements Predicate,If you use a bean in a Camel route  and have not specified the method name to invoke. Then Camel has to scan for suitable methods to use. And for that we have the @Handler annotation which should take precedence in this process. However if the bean implements Predicate  or Processor  then Camel will use that. However the @Handler should be used instead  as this is what the end-user expects. And also what we tell in the docs.,0,0
OnException - Handler or Continued predicate is invoked twice per exception,See CAMEL-5139When using handled(predicate) or continued(predicate) those is evaluated twice per exception. We should only do this once  which is what the end user would normally except.,0,0
onException policy within global context lost when error handler redefined within route context.,This may as well be Camel feature (limitation of Java DSL)  but I found no indications/warning that this is a feature in Camel book or web documentation. The route is somewhat ill defined as local errorHandler should be placed before bean part  but maybe for those types of mistakes it should not have this nasty side effects of loosing global onException policy  but at least complain during route creation . Moreover  the route works properly if I remove global error handler  so it is rather nasty effect if route definition correctness depends on the existence of the global error handler definition.If I move local errorHandler before bean part then the my test passes as the onException policy is triggered and works properly. As soon as I redefine the error handler within a route the onException policy is no longer applicable for the route and the route propagates the exception back to the caller.  errorHandler(defaultErrorHandler().maximumRedeliveries(1)); onException(NullPointerException.class).setOnRedelivery(new NullRegistrationDateProcessor()); from('direct:toPropertyFile').routeId('registrationEntryToPropertyFile') .setHeader(Exchange.FILE_NAME  simple('${body.firstname}.${body.surname}')) .bean(RegistrationToPropertiesBean.class  'convert') // Potential bug in Camel  if the same error handler like global is turned on then onException defined in global context will not be picked up. .errorHandler(defaultErrorHandler().maximumRedeliveries(1)) // the code above is working if no default handler was created for a global context. .to('file://' + outFolder);,0,0
Avoid parsing URI each time when getting uri from endpoint,In Camel 2.9  a new EndpointConfiguration was introduced  which has more fine grained details about an URI.However the getEndpointUri method on Endpoint is now parsing the uri on each call  this is not needed  and is also unnecessary overhead.We should parse this once.Also Camel's built-in type converter should be used during the parsing  and not just the hardcoded PropertyEditorTypeConverter which is to be considered removed as its not thread safe causes unforeseen side effects when 3rd party projects register property converter,0,1
'IOException: No space left on device' exception swallowed by camel,When routing a file using the GenericFileConsumer object an exception is swallowed if the lock file cant be created (i.e there is no harddrive space).GenericFileConsumer.javaprotected void processExchange(final Exchange exchange) { GenericFile&lt;T&gt; file = getExchangeFileProperty(exchange); log.trace('Processing file: {}'  file); // must extract the absolute name before the begin strategy as the file could potentially be pre moved // and then the file name would be changed String absoluteFileName = file.getAbsoluteFilePath(); // check if we can begin processing the file try { final GenericFileProcessStrategy&lt;T&gt; processStrategy = endpoint.getGenericFileProcessStrategy(); boolean begin = processStrategy.begin(operations  endpoint  exchange  file); if (!begin) { log.debug(endpoint + ' cannot begin processing file: {}'  file); // begin returned false  so remove file from the in progress list as its no longer in progress endpoint.getInProgressRepository().remove(absoluteFileName); return; } } catch (Exception e) { if (log.isDebugEnabled()) { log.debug(endpoint + ' cannot begin processing file: ' + file + ' due to: ' + e.getMessage()  e); } endpoint.getInProgressRepository().remove(absoluteFileName); return; }....}When processStrategy.begin(operations  endpoint  exchange  file); throws an java.io.IOException this is swallowed in the catch method and never propagated to the error handling of camel. Output from log is: 11:33:44.290 [Camel (camel-2) thread #1 - file:/Users/xxxx/yyyy/Files/] DEBUG o.a.c.component.file.FileConsumer - Endpoint[file:/Users/xxxx/yyyy/Files/] cannot begin processing file: GenericFile[//Users/xxxx/yyyy/Files/file01] due to: No space left on devicejava.io.IOException: No space left on device at java.io.UnixFileSystem.createFileExclusively(Native Method) ~[na:1.6.0_31] at java.io.File.createNewFile(File.java:883) ~[na:1.6.0_31] at org.apache.camel.component.file.strategy.MarkerFileExclusiveReadLockStrategy.acquireExclusiveReadLock(MarkerFileExclusiveReadLockStrategy.java:54) ~[camel-core-2.9.0.jar:2.9.0] at org.apache.camel.component.file.strategy.GenericFileProcessStrategySupport.begin(GenericFileProcessStrategySupport.java:46) ~[camel-core-2.9.0.jar:2.9.0] at org.apache.camel.component.file.strategy.GenericFileRenameProcessStrategy.begin(GenericFileRenameProcessStrategy.java:46) ~[camel-core-2.9.0.jar:2.9.0] at org.apache.camel.component.file.GenericFileConsumer.processExchange(GenericFileConsumer.java:308) [camel-core-2.9.0.jar:2.9.0] at org.apache.camel.component.file.GenericFileConsumer.processBatch(GenericFileConsumer.java:175) [camel-core-2.9.0.jar:2.9.0] at org.apache.camel.component.file.GenericFileConsumer.poll(GenericFileConsumer.java:136) [camel-core-2.9.0.jar:2.9.0] at org.apache.camel.impl.ScheduledPollConsumer.doRun(ScheduledPollConsumer.java:140) [camel-core-2.9.0.jar:2.9.0] at org.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:92) [camel-core-2.9.0.jar:2.9.0] at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) [na:1.6.0_31] at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:317) [na:1.6.0_31] at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:150) [na:1.6.0_31] at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:98) [na:1.6.0_31] at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:180) [na:1.6.0_31] at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:204) [na:1.6.0_31] at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) [na:1.6.0_31] at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) [na:1.6.0_31] at java.lang.Thread.run(Thread.java:680) [na:1.6.0_31]I have tried both tried error handling on the route and the DefaultErrorHandler way but this exception is never handled by the methods  ie Camel log them and then swallow them.,0,0
Backmerge CAMEL-5018 to the Bindy component for non-required fields,The issue  originally reported via CAMEL-5133  is to backmerge the CAMEL-5018 fix into the 2.9.x branch.I merged revision 1292164 into my local 2.9.x branch that I had updated with two new test cases.Before merge one test failed  after merge all tests were successfull.Attaching the updated model and tabtest.&#8212; Revision: 1292164Author: ningjiangDate: den 22 februari 2012 08:49:40Message:CAMEL-5018 support the set the default value on the field of bindy CVSModified : /camel/trunk/components/camel-bindy/src/main/java/org/apache/camel/dataformat/bindy/BindyCsvFactory.javaModified : /camel/trunk/components/camel-bindy/src/main/java/org/apache/camel/dataformat/bindy/annotation/DataField.javaModified : /camel/trunk/components/camel-bindy/src/test/java/org/apache/camel/dataformat/bindy/csv/BindySimpleCsvUnmarshallTest.javaModified : /camel/trunk/components/camel-bindy/src/test/java/org/apache/camel/dataformat/bindy/model/simple/oneclass/Order.java,0,0
JMX issues on WebSphere,While setting up a Camel web application for WebSphere (7) I encountered two issues1. Documentation: the Camel JMX docs proposes the following settings for WebSphere:&lt;camel:jmxAgent id='agent' createConnector='true' mbeanObjectDomainName='org.yourname' mbeanServerDefaultDomain='WebSphere'/&gt;This registers the beans with the PlatformMbeanServer instead of the WebSphere MBean server. The following setup works better:&lt;camel:jmxAgent id='agent' createConnector='false' mbeanObjectDomainName='org.yourname' usePlatformMBeanServer='false' mbeanServerDefaultDomain='WebSphere'/&gt;2. For each Camel route  the same Tracer and DefaultErrorHandler MBeans are tried to be registered over and over again. Because WebSphere changes the ObjectNames on registration  server.isRegistered(name); in DefaultManagementAgent#registerMBeanWithServer always returns false  which causes the MBean to be re-registered  which again cause Exceptions  e.g.14:35:48 198 [WebContainer : 4] [] WARN - DefaultManagementLifecycleStrategy.onErrorHandlerAdd(485) | Could not register error handler builder: ErrorHandlerBuilderRef[CamelDefaultErrorHandlerBuilder] as ErrorHandler MBean.javax.management.InstanceAlreadyExistsException: org.apache.camel:cell=wdf-lap-0319Node01Cell name='DefaultErrorHandlerBuilder(ref:CamelDefaultErrorHandlerBuilder)' context=wdf-lap-0319/camelContext type=errorhandlers node=wdf-lap-0319Node01 process=server1 at com.sun.jmx.mbeanserver.Repository.addMBean(Repository.java:465) at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.internal_addObject(DefaultMBeanServerInterceptor.java:1496) at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerDynamicMBean(DefaultMBeanServerInterceptor.java:975) at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerObject(DefaultMBeanServerInterceptor.java:929) at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerMBean(DefaultMBeanServerInterceptor.java:324) at com.sun.jmx.mbeanserver.JmxMBeanServer.registerMBean(JmxMBeanServer.java:494) at com.ibm.ws.management.PlatformMBeanServer.registerMBean(PlatformMBeanServer.java:484) at org.apache.camel.management.DefaultManagementAgent.registerMBeanWithServer(DefaultManagementAgent.java:320) at org.apache.camel.management.DefaultManagementAgent.register(DefaultManagementAgent.java:236)...The web application starts up  but with a lot of exceptions in the log.Proposal:Instead of using a Set&lt;ObjectName&gt; for mbeansRegistered  use a Map&lt;ObjectName  ObjectName&gt; where the key is the 'Camel' ObjectName and the value is the actually deployed ObjectName.I will provide a patch that illustrates the idea.,0,1
Bean component - Should preserver properties from exchange to allow to transfer state,See nabblehttp://camel.465427.n5.nabble.com/Stateful-Dynamic-Router-tp5647070p5647070.htmlThis allows other EIPs such as the dynamic route to use state when using a bean as its expression.,0,0
spring.schema is not up to date,The URI of the Spring schema has been updated in Camel 2.9.1 and 2.8.4:http://camel.apache.org/schema/cxf/We can see that starting from 2.9.1 and 2.8.4  we suffix the schema with -spring or -blueprint.However  the spring.schema resource file has not been updated with this suffix.,0,0
Strange warning appears: WARN  org.apache.camel.processor.DeadLetterChannel - Cannot determine current route from Exchange with id,The warning gets printed but other than that  everything seems to work. (I hope)12.04.19 10:34:26:463 [drisCamelContext JmsConsumer[dispatchHttpQueue] #4] WARN org.apache.camel.processor.DeadLetterChannel - Cannot determine current route from Exchange with id: ID-dris-ixor-be-42350-1334569164986-0-1052464  will fallback and use first error handler.12.04.19 10:34:26:463 [drisCamelContext JmsConsumer[dispatchHttpQueue] #4] WARN distribution.kv78.dispatch - Failed delivery (attempt = 199) : org.apache.http.conn.HttpHostConnectException: Connection to http://81.82.232.183:9292 refused - 0299c1d9 - KV8passtimes - 81.82.232.183:9292 - queue_dispatchHttpQueue_ID_dris.ixor.be-36583-1334569163882-4_1_24_1_1007When looking up the log statement in RedeliveryErrorHandler  I find this:else if (!exceptionPolicy.getErrorHandlers().isEmpty()) { // note this should really not happen  but we have this code as a fail safe // to be backwards compatible with the old behavior log.warn('Cannot determine current route from Exchange with id: {}  will fallback and use first error handler.'  exchange.getExchangeId()); processor = exceptionPolicy.getErrorHandlers().iterator().next(); }So it shouldn't happen but it happens after all...Here is the route causing the warning. I think it started when I made the route transacted. As shown in the log snippet above  the warning is printed when the HTTP endpoint throws an IOException (route ENDPOINT_DISPATCH) from(ENDPOINT_DISPATCH_QUEUE + '?cacheLevelName=CACHE_CONSUMER&amp;' + // necessary for message groups to work 'concurrentConsumers={{hermes.dris.distribution.kv78.concurrentOutgoingHttpDispatchers}}&amp;' + 'maxConcurrentConsumers={{hermes.dris.distribution.kv78.maxConcurrentOutgoingHttpDispatchers}}') .routeId(ROUTE_ID_DISPATCH_QUEUE) .onException(Throwable.class) // transacted routes override the default error handler // to avoid the message going to the the ActiveMQ DLQ  forward to our DLQ here .to(ENDPOINT_DLQ) .handled(true) .end() .transacted() // determine action // the timingPointSequencer will check what needs to happen with the message .beanRef('timingPointSequencer'  'handleDispatch') .choice() // normal situation  the message can be sent .when(header(TimingPointSequencer.HEADER_ACTION).isEqualTo(constant(TimingPointSequencer.ACTION_PROCEED))) .to(ENDPOINT_DISPATCH) // delay message  usually because of previous errors for this destination .when(header(TimingPointSequencer.HEADER_ACTION).isEqualTo(constant(TimingPointSequencer.ACTION_REENQUEUE))) .log(LoggingLevel.INFO  'Re-enqueuing' + MESSAGE_LOG_FORMAT) .to(ENDPOINT_DISPATCH_QUEUE) .otherwise() .log(LoggingLevel.ERROR  'No action header set ???' + MESSAGE_LOG_FORMAT) .to(ENDPOINT_DLQ) .end() .end(); from(ENDPOINT_DISPATCH) .routeId(ROUTE_ID_DISPATCH) .onException(IOException.class) // in case of IO exceptions  the message is always re-enqueued // reschedule parameters are set by the timingPointSequencer .beanRef('timingPointSequencer'  'handleFailure') .log(LoggingLevel.WARN  'Failed delivery (attempt = ${in.header.tpSecAttempt}) : ${in.header.CamelExceptionCaught}' + MESSAGE_LOG_FORMAT) .to(ENDPOINT_DISPATCH_QUEUE) .handled(true) .end() // clear http headers to avoid interference from other http endpoints .removeHeaders('CamelHttp*') .setHeader(Exchange.HTTP_URI  simple('http://${header.' + HEADER_DESTINATION_ADDRESS + '}')) .setHeader(Exchange.HTTP_PATH  simple('${properties:hermes.dris.distribution.kv78.controller.urlpath}')) .setHeader(Exchange.CONTENT_TYPE  constant('application/xml')) .setHeader(Exchange.CONTENT_ENCODING  constant('gzip')) // use gzip compression .log(verboseLoggingLevel  'Sending request to ${in.header.CamelHttpUri}/${in.header.CamelHttpPath}' + MESSAGE_LOG_FORMAT) // use multicast instead of a pipeline  or the audit log will contain the http response! .multicast() .stopOnException() .to(ENDPOINT_TIMINGPOINT_HTTP + '?httpClientConfigurerRef=timingPointHttpClientConfigurer&amp;headerFilterStrategy=#distributionHttpHeaderFilterStrategy'  ENDPOINT_AUDIT_OUTGOING) .end() .beanRef('timingPointSequencer'  'handleSuccess');,0,0
SftpChangedExclusiveReadLockStrategy does not check the correct field to determine if a file is changing,I have recently upgraded from Camel 2.7 to a more recent version. I can confirm that the bug is still in trunk. In Camel 2.7  there was a generic FileChangedExclusiveReadLockStrategy. This checked the modification time of the file using GenericFile.lastModified. This field was set by SftpComponent#asRemoteFile as file.getAttrs().getMTime() * 1000. In Camel 2.8 onwards  this behaviour is implemented by SftpChangedExclusiveReadLockStrategy. This incorrectly (to my mind) retrieves the timestamp on line 67 using: newLastModified = f.getAttrs().getATime();Taking the atime of the file doesn't make a great deal of sense to me; on a POSIX compliant filesystem  the atime will be incremented every time the file is polled  meaning that this strategy will never be able to mark a file as unchanged. While some filesystems are mounted nowadays as noatime or relatime  the mtime is still absolutely the safest mechanism to determine if something is writing to a target file. The impact of this bug is that we cannot reliably poll files from a remote SFTP server.,0,0
Implement connection pooling in jt400 component,Instead of eagerly obtaining a new connection to the AS/400 system  Endpoint instances request one from a connection pool. Users can specify that their own connection pool be used  or let Camel provide one (default behaviour).Functionally speaking  this feature does not introduce any change (it can be viewed as an optimization in advanced usage scenarios).Thread safety: the producers/consumers  which were inherently thread-safe  became not thread-safe in regard to their start/stop lifecycle.The following text can be used as the documentation for the new URI option:NameconnectionPoolDefault valueAS400ConnectionPool instanceDescriptionCamel 2.10: Reference to an com.ibm.as400.access.AS400ConnectionPool instance in the Registry. This is used for obtaining connections to the AS/400 system. The look up notation ('#' character) should be used.,0,1
initialDelay and idempotentRepository Endpoint URI parameters fail to be read from Camel context when Turkish language is set in host operating system.,org.apache.camel.util.ObjectHelper.capitalize() method uses native JAVA String.toUpperCase() method (without parameters)  which performs capitalization according to operating system current language and regional settings configuration. When these are set to Turkish  a call to capitalize() method  with a String starting with 'i' as parameter  returns Turkish dotted 'I' as capitalized 'i'  which is wrong according to programmatic language and expected behavior.This behaviour impacts  at least  in Endpoint URI parameters which names start with char 'i'  such as 'idempotentRepository' and 'initialDelay' URI parameters. When setter/getter methods lookup is performed for these parameters  wrong method names are returned due to ObjectHelper.capitalize() method. This method uses standard Java String.toUpperCase() function which returns a dotted 'I' instead of dotless 'I' for idempotentRepository and initialDelay parameters.To solve this  the attached patch consists of refactoring ObjectHelper.capitalize() method. Instead of calling toUpperCase() method  it is called toUpperCase(Locale.ENGLISH) to enforce 'I' character (dotless) return.,0,0
Potential dead-lock when shutting down Camel with NotifyBuilder doing notication,See nabblehttp://camel.465427.n5.nabble.com/Gracefull-shutdown-timeouts-due-to-NotifyBuilder-blocks-on-context-tp5654048p5654048.htmlWe should avoid the synchronized getRoutes method which is really not needed.,0,1
Loop causes NullPointerException on error,The following context will cause NullPointerException. &lt;routeContext id='myCamelContext' xmlns='http://camel.apache.org/schema/spring'&gt;  &lt;route&gt; &lt;from uri='jms:myQueue'/&gt; &lt;onException&gt; &lt;exception&gt;org.xml.sax.SAXParseException&lt;/exception&gt; &lt;redeliveryPolicy maximumRedeliveries='2'/&gt; &lt;handled&gt;&lt;constant&gt;true&lt;/constant&gt;&lt;/handled&gt; &lt;to uri='log:camelfatal?showAll=true&amp;multiline=true&amp;level=ERROR'/&gt;  &lt;/onException&gt; &lt;loop copy='true'&gt; &lt;constant&gt;3&lt;/constant&gt; &lt;inOnly uri='smtp://you_can_leave_this_unchanged'/&gt; &lt;/loop&gt; &lt;/route&gt; &lt;/routeContext&gt;The callstack on the NullPointerException:Daemon Thread [Camel (appServerCamelContext) thread #1 - JmsConsumer&#91;emailOutbox&#93;] (Suspended (exception NullPointerException))  DefaultErrorHandler(RedeliveryErrorHandler).processErrorHandler(Exchange  AsyncCallback  RedeliveryErrorHandler$RedeliveryData) line: 262  DefaultErrorHandler(RedeliveryErrorHandler).process(Exchange  AsyncCallback) line: 223  RouteContextProcessor.processNext(Exchange  AsyncCallback) line: 45  RouteContextProcessor(DelegateAsyncProcessor).process(Exchange  AsyncCallback) line: 90  DefaultChannel.process(Exchange  AsyncCallback) line: 304  AsyncProcessorHelper.process(AsyncProcessor  Exchange  AsyncCallback) line: 73  LoopProcessor(DelegateAsyncProcessor).processNext(Exchange  AsyncCallback) line: 99  LoopProcessor.process(Exchange  AsyncCallback  AtomicInteger  AtomicInteger) line: 103  LoopProcessor.process(Exchange  AsyncCallback) line: 74  AsyncProcessorHelper.process(AsyncProcessor  Exchange  AsyncCallback) line: 73  InstrumentationProcessor(DelegateAsyncProcessor).processNext(Exchange  AsyncCallback) line: 99  InstrumentationProcessor(DelegateAsyncProcessor).process(Exchange  AsyncCallback) line: 90  InstrumentationProcessor.process(Exchange  AsyncCallback) line: 71  AsyncProcessorHelper.process(AsyncProcessor  Exchange  AsyncCallback) line: 73  TraceInterceptor(DelegateAsyncProcessor).processNext(Exchange  AsyncCallback) line: 99  TraceInterceptor(DelegateAsyncProcessor).process(Exchange  AsyncCallback) line: 90  TraceInterceptor.process(Exchange  AsyncCallback) line: 91  AsyncProcessorHelper.process(AsyncProcessor  Exchange  AsyncCallback) line: 73  DefaultErrorHandler(RedeliveryErrorHandler).processErrorHandler(Exchange  AsyncCallback  RedeliveryErrorHandler$RedeliveryData) line: 333  DefaultErrorHandler(RedeliveryErrorHandler).process(Exchange  AsyncCallback) line: 223  RouteContextProcessor.processNext(Exchange  AsyncCallback) line: 45  RouteContextProcessor(DelegateAsyncProcessor).process(Exchange  AsyncCallback) line: 90  DefaultChannel.process(Exchange  AsyncCallback) line: 304  RouteContextProcessor.processNext(Exchange  AsyncCallback) line: 45  RouteContextProcessor(DelegateAsyncProcessor).process(Exchange  AsyncCallback) line: 90  UnitOfWorkProcessor.processAsync(Exchange  AsyncCallback  UnitOfWork) line: 150  UnitOfWorkProcessor.process(Exchange  AsyncCallback) line: 117  RouteInflightRepositoryProcessor.processNext(Exchange  AsyncCallback) line: 50  RouteInflightRepositoryProcessor(DelegateAsyncProcessor).process(Exchange  AsyncCallback) line: 90  AsyncProcessorHelper.process(AsyncProcessor  Exchange  AsyncCallback) line: 73  InstrumentationProcessor(DelegateAsyncProcessor).processNext(Exchange  AsyncCallback) line: 99  InstrumentationProcessor(DelegateAsyncProcessor).process(Exchange  AsyncCallback) line: 90  InstrumentationProcessor.process(Exchange  AsyncCallback) line: 71  AsyncProcessorHelper.process(AsyncProcessor  Exchange) line: 99  InstrumentationProcessor(DelegateAsyncProcessor).process(Exchange) line: 86  EndpointMessageListener.onMessage(Message) line: 104  DefaultJmsMessageListenerContainer(AbstractMessageListenerContainer).doInvokeListener(MessageListener  Message) line: 560  DefaultJmsMessageListenerContainer(AbstractMessageListenerContainer).invokeListener(Session  Message) line: 498  DefaultJmsMessageListenerContainer(AbstractMessageListenerContainer).doExecuteListener(Session  Message) line: 467  DefaultJmsMessageListenerContainer(AbstractPollingMessageListenerContainer).doReceiveAndExecute(Object  Session  MessageConsumer  TransactionStatus) line: 325  DefaultJmsMessageListenerContainer(AbstractPollingMessageListenerContainer).receiveAndExecute(Object  Session  MessageConsumer) line: 263  DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener() line: 1058  DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop() line: 1050  DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run() line: 947  ThreadPoolExecutor$Worker.runTask(Runnable) line: 886  ThreadPoolExecutor$Worker.run() line: 908  Thread.run() line: 662,0,0
HazelcastComponent.doStop bombing out,I am setting up an own hazelcast instance on HazelcastComponent  it is created by Spring the problem is when HazelcastComponent.doStop is called  a NullPointerException is throw  becausecreateOwnInstance is null.,0,0
camel-netty can't distinguish between Sharable and Unsharable codecs,Camel-netty uses general configuration model for referenced encoders/decoders for channel pipelines  see DefaultServerPipelineFactory. That is  create encoder/decoder objects at configuration parsing time and store them in a list  then use them when a pipeline is established. However  this will make encoder/decoder objects shared among different pipelines  that may cause data conflicts  when the encoder/decoder is not Sharable(has object status/not annotated as @Sharable)  e.g. a LengthFieldBasedFrameDecoder.Although we can avoid the problem by totally writing a new serverpipelinefactory for our apps  several problem still remains  please see detailed description and testcase for this bug at:http://camel.465427.n5.nabble.com/camel-netty-bug-and-the-need-of-best-practice-for-creating-referenced-parameter-object-on-looking-up-td5627926.html,0,0
Camel 2.9.2 jetty component no longer works with Jetty 7,When attempting to create a camel-jetty endpoint in Camel 2.9.2  the following exception is thrown:java.lang.NoSuchMethodError: org.eclipse.jetty.servlet.ServletContextHandler.addFilter(Lorg/eclipse/jetty/servlet/FilterHolder;Ljava/lang/String;Ljava/util/EnumSet;)Vat org.apache.camel.component.jetty.JettyHttpComponent.enableMultipartFilter(JettyHttpComponent.java:407) at org.apache.camel.component.jetty.JettyHttpComponent.connect(JettyHttpComponent.java:325) at org.apache.camel.component.http.HttpEndpoint.connect(HttpEndpoint.java:148) at org.apache.camel.component.http.HttpConsumer.doStart(HttpConsumer.java:56) at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:60) at org.apache.camel.impl.DefaultCamelContext.startService(DefaultCamelContext.java:1707) at org.apache.camel.impl.DefaultCamelContext.doStartOrResumeRouteConsumers(DefaultCamelContext.java:1979) at org.apache.camel.impl.DefaultCamelContext.doStartRouteConsumers(DefaultCamelContext.java:1934) at org.apache.camel.impl.DefaultCamelContext.safelyStartRouteServices(DefaultCamelContext.java:1862) at org.apache.camel.impl.DefaultCamelContext.doStartOrResumeRoutes(DefaultCamelContext.java:1646) at org.apache.camel.impl.DefaultCamelContext.doStartCamel(DefaultCamelContext.java:1533) at org.apache.camel.impl.DefaultCamelContext.doStart(DefaultCamelContext.java:1420) at org.apache.camel.spring.SpringCamelContext.doStart(SpringCamelContext.java:179) at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:60) at org.apache.camel.impl.DefaultCamelContext.start(DefaultCamelContext.java:1388)...This appears to be a regression of a caused by the this merge from trunk  which I suspect requires Jetty 8 to be used.Creating the endpoint under 2.9.1 works fine.,0,0
jt400: program call should support binary format,Data queue message exchange supports both text and binary formats and so should the remote program call exchange. The specification is the same as the one for the data queue.Additionally  this patch supports the concept of ommiting a parameter. This is achieved by passing null as the parameter value.Implementation note:Since I don't know Camel's policy regarding API breaking  I opted to refer to Jt400DataQueueEndpoint.Format; but Format should now be a top-level class  since the concept is the same for data queues and programs.,0,0
LDAP Component lose headers,When we call to a LDAP endpoint  the result is returned in the Out body and we lose the IN headers (see http://camel.465427.n5.nabble.com/LDAP-Component-lose-headers-td5696602.html). A fix seems relatively easy. The solution could be add this line inside the process() method in LdapProducer.java exchange.getOut().setHeaders(exchange.getIn().getHeaders());,0,0
Relax simple language checking for function start/end tokens  to only validate start tokens has appropriate end token,See nabblehttp://camel.465427.n5.nabble.com/Translating-route-exceptions-to-JSON-with-Simple-Expression-Language-or-SPEL-tp5696933.html,0,0
Incorrect Content-Length returned for converted result objects with Unicode characters,The camel-servlet component responds with an incorrect http Content-Length header  causing the HTTP client to retreive a incomplete response  when the body of the out message is of a POJO type and is converted into a string that contains unicode characters.For example  the following route returns 'B?e W?r'  but should return 'B?e W?rld'.from('servlet:///testUnicodeWithObjectResponse?matchOnUriPrefix=true')  .process(new Processor() { public void process(Exchange exchange) throws Exception {  String contentType = exchange.getIn().getHeader(Exchange.CONTENT_TYPE  String.class); exchange.getOut().setHeader(Exchange.CONTENT_TYPE  contentType + '; charset=UTF-8');  }}) .transform(constant( new Object(){ @Override public String toString() Unknown macro: { return &quot;B?e W?rld&quot;; }  } ));The attached patch contains a fix for the problem and a test to reproduce the problem.,0,0
Make it possible to change the remote file name without changing the local file name,Currently  if you change the remote file name by changing the message header Exchange.FILE_NAME  this will not only change the remote file name but also the local file name. This is often undesirable. Instead it is a common requirement to archive the files that you process locally with their original file names unchanged.This has been discussed on the user mailing list:http://camel.465427.n5.nabble.com/how-to-specify-remote-file-name-when-using-FTP-endpoint-td5697227.html,0,0
Add community and peer address of SNMP TRAP PDUs to camel-snmp header,A patch is included to add the community and peer address of SNMP traps that are received by camel. This is useful to determine where a trap originated from  as not all SNMPv2 traps include an OID that identifies the sender.The information is placed in the message header as strings with names:securityNamepeerAddressThese names correspond to the accessor names in the snmp4j API for the CommandResponderEvent class. securityName is not the correct name for SNMP v1/2 traps  but it's probably better to stick with a name that can be consistant between SNMP versions.,0,0
Jetty client can corrupt streams if used in a bridge mode (proxy),The jetty http producer should favor streams over Strings  which otherwise could cause the payload to be corrupted if doing a bridge mode  eg from jetty to jetty.,0,0
Dependencies with inconsitant paths in repository,Artifactory doesn't by default serve artifacts that have a path inconsistancy in it's repository. The used maven-shade-plugin version 1.4 used by camel 2.10.0-SNAPSHOT depends on such a component. this is fixed in version 1.6I was unable to add an attachement  so here is the patch inline:      Eclipse Workspace Patch 1.0#P camelIndex: parent/pom.xml===================================================================   parent/pom.xml (revision 1338042)+++ parent/pom.xml (working copy)@@ -1684 7 +1684 7 @@ &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;     &lt;version&gt;1.4&lt;/version&gt;+ &lt;version&gt;1.6&lt;/version&gt; &lt;/plugin&gt; &lt;plugin&gt;,0,0
camel-stream overwrites files instead of appending,When a file stream is used with camel-stream  the file is not opened in append mode  therefore the file is overwritten with every message  ending up with just the last message  all others are lost.This contrasts with the documented behavior.,0,0
camel-stream should not close stream after each write,The StreamProducer in camel-stream closes the stream after every write  which significantly affects performance.,0,1
EventNotifiers don't work under Blueprint,EventNotifiers don't work with Blueprint Camel Contexts. Testing on latest 2.10-SNAPSHOT  updated on 22 May 16:45 GMT.After some debugging  it looks like the bean lookup performed on line 202 of AbstractCamelContextFactoryBean.afterPropertiesSet() triggers the initialization of the CamelContext as part of the lookup. As part of the init  all services are started  including the ManagementContext and its EventNotifiers (which we were just looking up).EventNotifiers are then added but never started because they came in late.,0,0
Main is bound to DefaultCamelContext,We are using our own CamelContext  which is extending the DefaultCamelContext. Using Main is impossible in this case  since the getCamelContextMap()-method creates statically a DefaultCamelContext. Overriding this method doesn't works either  since the field registery is final  and no other accessors are defined.The given path doesn't breaks existing code bases  and gives an easy possiblity to override the context-creation  as well as access to the registry.,0,0
camel-ftp - Add option to check files without downloading,download=false could be an option to stop poll consumers from downloading files when all you need is to check for file attributes.The need was generated from ftp component but it could potentially apply to any file consumer. For more info see the original thread http://camel.465427.n5.nabble.com/Camel-FTP-SFTP-check-instead-of-download-td5713363.html,0,1
camel-bindy - Do not use locale if not explicit configured,Bindy should newer use locale if not explicit configured to use one  as they will format numbers and whatnot in unexpected ways.For example an integer with an US locale will have comma as thousand separator  and that dont go well when marshalling to a CSV file  as the comma is also often a separator there.,0,0
Add a Camel Component to support MQTT,MQTT is a light weight messaging protocol for small sensors and mobile devices - see http://mqtt.org,0,0
camel-sql - Should support % sign in query,See nabbleWe should look into supporting the % sign in the sql component.It should possible be less strict in uri validation as people can enter SQL queries. And to make it easy  they should just be able to dump in the SQL as is.We should also consider adding an option to refer to a SQL that is enlisted in the registry.Also people should be able to externalize their SQL in a .properties file and have Camel lookup that using the {{ }} notation,0,0
Camel features file doesn't validate,If you execute$camel/platforms/karaf&gt;mvn clean install -Pvalidateit fails in the feature definition validation for the following components:camel-quickfixcamel-cxfcamel-cdi,0,0
camel-jms - Exception thrown from destination resolver should trigger Camel exception handling,See nabblehttp://camel.465427.n5.nabble.com/Camel-Error-handling-throwing-exception-not-moving-to-error-queue-tp5714076.htmlThe jms producer should catch unhandled exceptions from the Spring JMS  such as its destination resolver. And ensure the callback is invoked  to let Camel error handler be triggered.,0,0
SOAPMessage to InputStream conversion needed for some CXF SOAPMessage Provider scenarios,When you have a SOAPMessage Provider based CXF endpoint in your Camel route and the message is forwarded to an input stream based processor or producer (e.g.  File)  it is necessary to have a converter that converts SOAPMessage into InputStream.It would be practical to have this conversion method included in CxfConverter.I am attaching a test case and a possible implementation. This implementation uses CachedOutputStream to make an InputStream from a SOAPMessage. There might be a better way to get an InputStream  but I don't know a simple one.Thanks.,0,0
Shutting down one of the contexts breaks async redeliveries in others: RedeliveryErrorHandler has static reference to a thread pool,ErrorRedeliveryHandler has static reference to a thread pool used for scheduling retries  thus when it's stopped it stops a pool used by other handler instances(e.g. from other contexts)  thus they now can't redeliver.,0,0
Mail component does not work as expected (Email Deletion is partially broken et Disconnect does not work well),The way disconnect is implemented causes issues with some other options of the consumer. For instance 'disconnect' option is not compatible with 'delete' option.The delete action is done in completion action (processCommit: line 185). On line 305  processCommit method checks if folder is open  but 'disconnect' option force folder at null value at the end of poll method (Line 149).I guess disconnect method should be called on completion after any other completion actions occured: It is not possible to make completion actions if connection to mail server is closed.The result of the usage of disconnect option and delete option is a NullPointerException on test: 'if (!folder.isOpen())' statement on line 308.Issue should be always reproductible.I let you fix the priority of the issue  but it is an annoying issue even if there is a workaround by disabling disconnect option ...,0,0
Improve performance of DefaultJmsKeyFormatStrategy,The current default implementation uses String.replace/replaceAll to escape the illegal characters in the header key. This is unfortunate because replace/replaceAll are implemented in terms of regular expressions which makes the escaping quite costly for something that is executed for every single message. Also it's quite likely that the headers will be identical for every single message that's published via JMS. The attached patch makes two changes; Use Commons Lang StringUtil.replaceEach which using a StringBuilder internally to do the replacement. This adds a dependency on Commons Lang. Cache the output of StringUtil.replaceEach in a ConcurrentHashMap. This could be moved to a separate class if caching every key is a concern. Or this could be changed to use an LRUCache,0,1
CXF Transport loses HTTP Matrix parameters,DefaultCxfMesssageMapper (note the typo - to be fixed in a follow-up JIRA) wrongly initializes CXF Message Message.REQUEST_URI property with the value of Camel Exchange.HTTP_PATH  even though Camel Exchange.HTTP_URI is available.The net effect is that the HTTP matrix parameters if any attached to the last HTTP path segment are lost. Another side-effect is that Exchange.HTTP_PATH will contain the decoded value (done at HTTPServletRequest level) which can lead to the matching issues at the JAX-RS level.A simple patch is attached,0,0
Threads EIP hangs Junit4 tests using adviceWith,If the  threds()  DSL keyword is used in a route and a Junit4 test is performed  the test hangs indefenitely.The issue is descibed here:http://camel.465427.n5.nabble.com/Threads-EIP-hangs-Unit-Tests-JUnit4-td5715031.htmlplease find attached a self-consistent sample project to reproduce it.,0,0
Better error message when trying to write a null body as file,See nabblehttp://camel.465427.n5.nabble.com/Can-t-route-wsdl-request-into-file-tp5715201.htmlWe should have a better error message instead of something about no type converter exception.We could also consider an option to the file producer  to silently ignore writing files if there is no message body.Finding a good name for this option is a challenge  skipNullBody ignoreWritingNullBody,0,0
MQTT Endpoint does not correctly return the MQTT-Payload,MQTT Endpoint does not correctly return the MQTT-Payload. It returns the whole MQTT Message (header + payload).The bug is in line 89 of MQTTEndpoint.java (version 2.11  but also in 2.10) exchange.getIn().setBody(body.getData());must become exchange.getIn().setBody(body.toByteArray()); because getData() ignores the offset (to skip the MQTT header) set in the body byte array.,0,0
ObjectAlreadyExistsException when 'redeploying' routes that uses CronScheduledRoutePolicy,When a route that has a CronScheduledRoutePolicy is removed it does not properly clean up the quartz jobs. The result (apart from possible memory leak) is that if the route is removed from the context and then readded with the same route id a ObjectAlreadyExistsException.This is done using the following steps.1. Stop the route2. Remove the route (and it's endpoints) from the context.3. (Re)add the route to the context using the same name.Attached is a testcase that shows the problem.I've solved this by adding my own implementation of onRemove (that calls doStop()) to CronScheduledRoutePolicy.,0,1
Simple does not handle empty values in predicates properly,Example code:...&lt;choice&gt; &lt;when&gt; &lt;simple&gt;${property.someProperty} == ''&lt;/simple&gt; ... &lt;/when&gt;...Error message: right must be specified,0,0
camel-jms - Log at INFO level if shared replyTo queues are in use  as they are not as fast as temporary or exclusive queues,See nabblehttp://camel.465427.n5.nabble.com/fyi-SI-tp5716049.htmlWe should log at INFO (maybe even WARN level) if shared reply queues are in use as they are not as fast. They have their purposes though  such as a shared clustered queue  or if a queue is used by other apps too (not ideally thought). Temporary and Exclusive reply queues are faster.See the JMS docs at the request reply section  for much more details.,0,0
Folder closed too early when working asynchronously,When using a MailConsumer connected with IMAP to a mailserver and routing the messages to SEDA or any other asynchronous endpoint  it can cause a com.sun.mail.util.FolderClosedIOException or javax.mail.FolderClosedException to happen if you are trying to process the mails/messages attachments.This is because the IMAP folder gets closed at the end of each MailConsumer.poll()I propose to add a new MailConfiguration option 'closeFolder'  which can override this behaviour.Here's an example on how to reproduce the problem. (Scala code  sorry! But it should be self-explanatory)You need a couple of mails with attachments in your mailbox to test this. ~10 mails should be enough to cause the exceptions.import javax.mail.internet.MimeMultipartimport org.apache.camel.impl.DefaultCamelContextimport org.apache.camel.scala.dsl.builder.RouteBuilderimport scala.io.Sourceobject Main {  def main(args: Array&#91;String&#93;): Unit = { val camelContext = new DefaultCamelContext val host = 'imap.gmail.com' val username = '*****@gmail.com' val password = '*****' // this will cause com.sun.mail.util.FolderClosedIOException or javax.mail.FolderClosedException val endpoint = 'imaps://'host'?password='password'&amp;username='username'&amp;folderName=INBOX&amp;unseen=false&amp;disconnect=false&amp;mapMailMessage=true&amp;connectionTimeout=60000' // with fix / new feature 'closeFolder' set to false //val endpoint = 'imaps://'host'?password='password'&amp;username='username'&amp;folderName=INBOX&amp;unseen=false&amp;disconnect=false&amp;mapMailMessage=true&amp;connectionTimeout=60000&amp;closeFolder=false' camelContext.addRoutes( new RouteBuilder { endpoint .to('seda:process') from('seda:process?concurrentConsumers=5') ==&gt; { process { ex =&gt; val att = ex.getIn.getBody.asInstanceOf[MimeMultipart].getBodyPart(1) println('Attachment Name:' + att.getFileName) println('Attachment Content:' + att.getDataHandler.getContent) println('Attachment Content:' + Source.fromInputStream(att.getDataHandler.getInputStream).mkString) Thread.sleep(2500) // simulate some work being done here with the attachment  takes time.. } } } ) camelContext.start() Thread.sleep(45 * 1000) camelContext.stop() }},0,0
IOConverter.toInputStream opens a BufferReader which will never be closed,If called with a non-null charset IOConvert.toInputStream returns a InputStream which will never close the opened BufferedReader.,0,1
camel-jms consumer doesn't send back a reply in all cases,In a very simple route consuming from a Camel JMS endpoint receiving InOut exchanges (i.e. JMSReplyTo header present)  the endpoint will not send back replies.This happens because Camel JMS only returns a reply if the OUT message is set. But if the route looks like: consumer =&gt; processor  and Camel doesn't find the need to 'weave in' an implicit Pipeline processor  no one will implicitly take care of mapping the IN message to an OUT message (unless the user knows about these internal aspects - but we shouldn't expect them too).As a result  these routes DON'T WORK...&lt;route&gt; &lt;from uri='timer:foo?fixedRate=true&amp;amp;period=10000' /&gt; &lt;setBody&gt;&lt;constant&gt;Hello Raul&lt;/constant&gt;&lt;/setBody&gt; &lt;to uri='log:SendingRequest?showAll=true' /&gt; &lt;inOut uri='activemq:queue:test1?requestTimeout=1000' /&gt; &lt;to uri='log:ReceivedReply?showAll=true' /&gt;&lt;/route&gt; &lt;route&gt; &lt;from uri='activemq:queue:test1' /&gt; &lt;to uri='log:ReceivedRequest?showAll=true' /&gt;&lt;/route&gt;... but just by adding an additional log endpoint to the second route (or any other thing  for that matter)  it starts to work because Camel weaves in the Pipeline processor.Other workarounds that work: explicitly wrapping the log endpoint in a &lt;pipeline&gt; DSL &lt;setBody&gt;&lt;simple&gt;${in.body}&lt;/simple&gt;&lt;/setBody&gt;Or simply introducing anything that will force Camel to insert a Pipeline processor.IMHO  there are two solutions to avoid this issue: Always weave in a Pipeline processor (adds overhead in simple routes and may cause regressions) Adapt EndpointMessageListener to pick the IN message when the exchange is out capable and expectation of a reply existsI'm happy to work on a patch for Camel 2.10.1.EDIT: Just wrapping the single endpoint in &lt;pipeline /&gt; doesn't function as a workaround.,0,0
Support to build the camel-soap offline,camel-soap introduce soap12.xsd which has the import from the internet  it will cause some trouble when you build the camel-soap offline.,0,0
camel-mybatis should do a proper transaction demarcation while reading/writing from/to database.,See http://camel.465427.n5.nabble.com/MyBatis-Component-Bug-consumer-onConsume-hits-error-transactions-are-committed-instead-of-rollback-td5716774.htmlOther than DefaultMyBatisProcessingStrategy the same issue exists by MyBatisProducer as well.Another thing which is currently missing completley is that there's no transaction demarcation by the Producer at all while reading from the database  e.g. by SelectOne or SelectList statement types.,1,0
Add option to restrict HTTP method in camel-jetty and camel-servlet,See http://camel.465427.n5.nabble.com/Jetty-consumer-restricting-methods-td5716938.html,0,0
file endpoints on windows without volume name in the path url not working in some cases,I am using file endpoints on Windows without the volume name just like the normal unix based paths look.That means  I have something like file:///tmp/file-in and file:///tmp/file-outThe funny thing that I noticed is that each endpoint itself works fine  but when a route is set up from one to the other  it fails because there seems to be an inconsistency in the way the windows path is handled in the camel-core's file component.As mentioned  each file endpoint itself is working fine. For example  the consumer file endpoint configured in a routefrom('file:///tmp/file-in').to('mock:test')works fine.Similarly  the produce file endpoint configured in a routefrom('direct:test').to('file:///tmp/file-out')works fine.But when a route is setup to connect these two file endpoints  the producer endpoint fails to create the output file.Concretely  there is the following code in GenericFileEndpoint.configureMessage that determines the file name. String name = file.isAbsolute() ? file.getAbsoluteFilePath() : file.getRelativeFilePath(); // skip leading endpoint configured directory String endpointPath = getConfiguration().getDirectory() + getFileSeparator();In this particular case  the name variable is set to 'C:/tmp/file-in/sample.xml' while the endpointPath variable is set to '/tmp/file-in'.So  the subsequent code to extract the file name part  shown below  fails to match the path. if (ObjectHelper.isNotEmpty(endpointPath) &amp;&amp; name.startsWith(endpointPath)) { name = ObjectHelper.after(name  endpointPath); }As a result  the file name is not extracted as 'sample.xml' but remain unchanged as 'C:/tmp/file-in/sample.xml'.Consequently  when the file producer endpoint tries to write this file in the file system  it tries to write a file as '/tmp/file-out/C:/tmp/file-in/sample.xml'  resulting in an error.I modified FileComponent and FileEndpoint so that the endpoint path is stored correctly in this case to make the above extraction code find the file name part correctly.Attached is this proposed patch and a test case which runs on windows and on non-windows but this issue can only be demonstrated under windows.testRouteToFileOnly and testRouteFromFileOnly work without this patch while testRouteFileToFile fails without this patch on windows.Thanks for looking into this issue.Regards  Aki,0,0
camel-testng - The spring base test class should use @AfterMethod on teardown as its parent does,See nabblehttp://camel.465427.n5.nabble.com/Problem-with-testng-CamelSpringTestSupport-several-contexts-runs-simultaneously-tp5716447.html,0,0
Add option to changed readLock to denote whether a zero file size is accepted or not,Some people may write zero files and want them to be accepted.,0,0
'ThreadID is already used' exception under heavy load,In situations with heavy load or under load tests we rarely got exception: 2012-08-21 12:28:02 620 [ool-26-thread-7] ERROR DefaultErrorHandler - Failed delivery for (MessageId: ID-atitov-pc-60956-1345537671897-2-143205 on ExchangeId: ID-atitov-pc-60956-1345537671897-2-143206). Exhausted after delivery attempt: 1 caught: java.lang.IllegalArgumentException: ThreadID is already usedjava.lang.IllegalArgumentException: ThreadID is already used at org.jivesoftware.smack.ChatManager.createChat(ChatManager.java:163) at org.apache.camel.component.xmpp.XmppPrivateChatProducer.getOrCreateChat(XmppPrivateChatProducer.java:97) at org.apache.camel.component.xmpp.XmppPrivateChatProducer.process(XmppPrivateChatProducer.java:65) at org.apache.camel.util.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:61) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.SendProcessor$2.doInAsyncProducer(SendProcessor.java:120) at org.apache.camel.impl.ProducerCache.doInAsyncProducer(ProducerCache.java:292) at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:115) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:91) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:330) at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:220) at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:45) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.interceptor.DefaultChannel.process(DefaultChannel.java:303) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.Pipeline.process(Pipeline.java:117) at org.apache.camel.processor.Pipeline.process(Pipeline.java:80) at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:45) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:122) at org.apache.camel.processor.RouteInflightRepositoryProcessor.processNext(RouteInflightRepositoryProcessor.java:48) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:73) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:61) at org.apache.camel.processor.UnitOfWorkProcessor.processAsync(UnitOfWorkProcessor.java:150) at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:117) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:86) at org.apache.camel.processor.UnitOfWorkProducer.process(UnitOfWorkProducer.java:63) at org.apache.camel.impl.ProducerCache$2.doInProducer(ProducerCache.java:360) at org.apache.camel.impl.ProducerCache$2.doInProducer(ProducerCache.java:1) at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:227) at org.apache.camel.impl.ProducerCache.sendExchange(ProducerCache.java:331) at org.apache.camel.impl.ProducerCache.send(ProducerCache.java:169) at org.apache.camel.impl.DefaultProducerTemplate.send(DefaultProducerTemplate.java:111) at org.apache.camel.impl.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:124) at org.apache.camel.impl.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:131) at org.apache.camel.component.xmpp.XmppProducerConcurrentTest$1.call(XmppProducerConcurrentTest.java:79) at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303) at java.util.concurrent.FutureTask.run(FutureTask.java:138) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:662)2012-08-21 12:28:02 621 [ool-26-thread-5] ERROR DefaultErrorHandler - Failed delivery for (MessageId: ID-atitov-pc-60956-1345537671897-2-143207 on ExchangeId: ID-atitov-pc-60956-1345537671897-2-143208). Exhausted after delivery attempt: 1 caught: java.lang.IllegalArgumentException: ThreadID is already usedjava.lang.IllegalArgumentException: ThreadID is already used at org.jivesoftware.smack.ChatManager.createChat(ChatManager.java:163) at org.apache.camel.component.xmpp.XmppPrivateChatProducer.getOrCreateChat(XmppPrivateChatProducer.java:97) at org.apache.camel.component.xmpp.XmppPrivateChatProducer.process(XmppPrivateChatProducer.java:65) at org.apache.camel.util.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:61) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.SendProcessor$2.doInAsyncProducer(SendProcessor.java:120) at org.apache.camel.impl.ProducerCache.doInAsyncProducer(ProducerCache.java:292) at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:115) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:91) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:330) at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:220) at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:45) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.interceptor.DefaultChannel.process(DefaultChannel.java:303) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.Pipeline.process(Pipeline.java:117) at org.apache.camel.processor.Pipeline.process(Pipeline.java:80) at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:45) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:122) at org.apache.camel.processor.RouteInflightRepositoryProcessor.processNext(RouteInflightRepositoryProcessor.java:48) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:73) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:61) at org.apache.camel.processor.UnitOfWorkProcessor.processAsync(UnitOfWorkProcessor.java:150) at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:117) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:86) at org.apache.camel.processor.UnitOfWorkProducer.process(UnitOfWorkProducer.java:63) at org.apache.camel.impl.ProducerCache$2.doInProducer(ProducerCache.java:360) at org.apache.camel.impl.ProducerCache$2.doInProducer(ProducerCache.java:1) at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:227) at org.apache.camel.impl.ProducerCache.sendExchange(ProducerCache.java:331) at org.apache.camel.impl.ProducerCache.send(ProducerCache.java:169) at org.apache.camel.impl.DefaultProducerTemplate.send(DefaultProducerTemplate.java:111) at org.apache.camel.impl.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:124) at org.apache.camel.impl.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:131) at org.apache.camel.component.xmpp.XmppProducerConcurrentTest$1.call(XmppProducerConcurrentTest.java:79) at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303) at java.util.concurrent.FutureTask.run(FutureTask.java:138) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:662) After debugging and looking at source code we figured out  that smack use some sort of map with week references for chat cache. When memory is low java GC discards chat instances  but in Process() method they instantiated over and over again without synchronization:XmppPrivateChatProducer.java public void process(Exchange exchange) { ......................... Chat chat = chatManager.getThreadChat(endpoint.getChatId()); if (chat == null) { LOG.trace('Creating new chat instance with thread ID {}'  endpoint.getChatId()); chat = chatManager.createChat(getParticipant()  endpoint.getChatId()  new MessageListener() { public void processMessage(Chat chat  Message message) { // not here to do conversation if (LOG.isDebugEnabled()) { LOG.debug('Received and discarding message from {} : {}'  getParticipant()  message.getBody()); } } }); } .........................} But smack implementation prohibits chat instances with same chatId.,0,1
Maven archetype - Generates wrong plugin for surefire plugin,The blueprint archetype creates wrong pom.xml. The groupId for the surefire plugin is wrong.,0,0
Improve how the AWS-SQS component create a new queue with additional attributes,,0,0
Multiple restlet routes of the same restlet URI but different VERBs does not work in Apache Camel 2.10.0   both routes work in Apache Camel 2.9.1.,Multiple restlet routes of the same restlet URI but different VERBs does not work in Apache Camel 2.10.0   both routes work in Apache Camel 2.9.1. Reproduce Steps:-----------------1) Add a restlet route with a from uri of restlet:///nimbus/hello.restlet/1.0?restletMethods=get&lt;route xmlns='http://camel.apache.org/schema/spring' trace='true' &gt; &lt;from uri='restlet:///nimbus/hello.restlet/1.0?restletMethods=get'/&gt; &lt;transform&gt; &lt;simple&gt;Hello Restlet Method: ${header.CamelHttpMethod} ID:${header.id}&lt;/simple&gt; &lt;/transform&gt; &lt;/route&gt;2) Add a restlet route with a from uri of restlet:///nimbus/hello.restlet/1.0?restletMethods=post &lt;route xmlns='http://camel.apache.org/schema/spring' trace='true' &gt; &lt;from uri='restlet:///nimbus/hello.restlet/1.0?restletMethods=post'/&gt; &lt;transform&gt; &lt;simple&gt;Hello Restlet Method: ${header.CamelHttpMethod} ID:${header.id}&lt;/simple&gt; &lt;/transform&gt; &lt;/route&gt;3) route 1work fine  but #2 results in the following exception. both route work fine in Camel 2.9.1.Exception:012-07-27 10:29:20 646-0400 ERROR grails.app.service.nimbus.ComputeService localhost addRoute for hello.restletpost failed - Failed to start route nimbus.hello.restletpost.1.0 because of Multiple consumers for the same endpoint is not allowed: Endpoint&#91;/nimbus/hello.restlet/1.0&#93; Caused by: org.apache.camel.FailedToStartRouteException: Failed to start route nimbus.hello.restletpost.1.0 because of Multiple consumers for the same endpoint is not allowed: Endpoint&#91;/nimbus/hello.restlet/1.0&#93; at org.apache.camel.impl.DefaultCamelContext(doStartOrResumeRouteConsumers:1993) I've already posted on http://camel.465427.n5.nabble.com/Apache-Camel-2-10-0-multiple-restlet-routes-of-the-same-restlet-URI-but-different-VERBs-does-not-work-td5716556.html,0,0
Possible issue in camel-apns - Reported on user forum,See nabblehttp://camel.465427.n5.nabble.com/Issue-with-ApnsServiceFactory-tp5717573.html,0,0
Mina2 Consumer doesn't reliably work with SSL,I've been trying to write a service using Camel 2.10.0 which uses the mina2 component to expose a service  and which uses SSL  using an endpoint of:mina2:tcp://localhost:6500?sync=true&amp;filters=#hl7SslFilterFactory #hl7CodecFilter&amp;allowDefaultCodec=falsehowever  what I found was that the SSL handshake was failing quite often for no apparent reason. Investigating further  it appeared that messages sent during the handshake were being processed out of order - specifically  when the client (which uses a standard java SSLSocket) sent a 'TLSv1 Change Cipher Spec' followed by a 'TLSv1 Handshake'  the 'TLSv1 Handshake' was being processed before the 'TLSv1 Change Cipher Spec'  breaking the process.This appears to have been caused because when the the Mina2Consumer configures MINA for tcp (in Mina2Consumer.setupSocketProtocol)  it is using a UnorderedThreadPoolExecutor - which allows messages to be processed in any order. Switching this to use a OrderedThreadPoolExecutor instead has fixed the issue.May I request that the use of UnorderedThreadPoolExecutor vs OrderedThreadPoolExecutor be configurable via endpoint parameters? (or OrderedThreadPoolExecutor is used when SSL if configured). I'm assuming the reason for the use of UnorderedThreadPoolExecutor is simply for performance.,0,1
File consumer - NPE if configured to consume from root directory,See nabblehttp://camel.465427.n5.nabble.com/Setting-root-folder-as-endpoint-Could-not-poll-endpoint-NPE-tp5717845.html,0,0
Support key password for private key access in XMLSecurity,Enhance the XMLSecurity component to enable access of a private key (for decryption) from a Java key store using a password that is unique to the key  and different than the key store password.The likely solution is to allow an optional 'keyPassword' parameter in the XMLSecurity data format.A description of the issue in context is here :http://camel.465427.n5.nabble.com/XMLSecurity-key-recovery-fails-when-keystore-and-key-use-different-passwords-td5718094.html,1,0
In ScheduledRoutePolicy a suspended route cannot be started,If a route is suspended using the ScheduledRoutePolicy and its subclasses (CronScheduledRoutePolicy)  it cannot be resumed or started.Looking at the code in ScheduledRoutePolicy.onJobExecute()  on start/resume actions  the route status is first checked and must be stopped or suspended before any actions is taken.Suspension of a route  only suspends the consumer and not the route  and hence the start/resume after a suspend does nothing.One solution could be to also check the status of the consumer on start/resume. This would require adding a isSuspended() to serviceHelper and should be relatively straightforward.,0,0
camel-beanio using beanio 2.0 should be using the 2012/03 beanio namespace,camel-beanio which uses beanio-2.0.x library should use the beanio 2.0's namepsace (http://www.beanio.org/2012/03) and not the 1.2 namespace ( http://www.beanio.org/2011/01) in its test cases.The background to this is described in this mail thread.http://camel.465427.n5.nabble.com/issue-with-camel-beanio-s-version-used-in-trunk-td5718596.html,0,0
Make Spring Optional Bundle Import for CXF Transport,The camel-cxf-transport component should define the Spring import packages as optional given they are only required if using the Spring DSL namespaces. If you are using Java DSL Spring is not required.Best Regards Scott ES,0,0
camel-sftp's stepwise behavior to walk up and down relatively to avoid potential traversal issues,I am having a directory traversal problem using the stepwise mode of camel-sftp at the producer side. Basically  it can walk down the path from the starting directory to the walking directory  but it cannot go back correctly to the original starting directly. The server is SSH-2.0-Cleo VLProxy/3.0.1 SSH FTP server.I saw a related JIRA issue CAMEL-3309 that describes some issues in the stepwise traversal and some background to this related problem.My question is on the part that changes the working directory back to the original starting folder. I am wondering why we are using stepwise traversal from the ancestor directory towards the starting child directory  instead of moving upwards relatively from the working directory back to the starting directory. This reverse traversal does not require accessing the ancestry path above the staring directory (hence  not affected by the accessing problem). And in fact  I think this reverse stepwise traversal seems more natural order than doing stepwise traversal each time from top down. How do you think?I have made a change that implements this reverse stepwise traversal in SftpOperations and also made a few minor improvement changes.This changed version passes all the existing tests and works also against the above server.I am attaching a patch file for this change. I would appreciate if you can comment on it.Thanks.regards  aki,0,0
Logger Level is always at default level('ERROR') when error handler is LoggingErrorHandler,when logger level is set to other level (WARN  DEBUG or INFO) except for ERROR  but actually the log is always at ERROR level (it's the default level).,0,0
camel-jackson - Make it easier to support List as output out of the box,See nabblehttp://camel.465427.n5.nabble.com/JSON-Jackson-return-list-rather-than-POJO-tp5717341.htmlWe should look into making it easier to output a List as output with jackson json. On the nabble link there is an example and pseduo code how to do that.We should find a way to make that easy in Camel. Either as some new option  or somehow auto detect its a List etc.,0,0
camel-hl7 bundle should specify the mina version,As there could be different version of mina or mina2 exist in the OSGi platform  we need to specify the right version rang on camel-hl7 which has the dependency on the mina.,0,0
An exception when constructing JT400 endpoints should not leak the password,Sanitize the endpoint URI in the message of the runtime exception thrown in the constructors for Jt400DataQueueEndpoint and Jt400PgmEndpoint.,1,0
JmsToJmsTransactedSecurityTest in camel-jms fails every now and then,Test JmsToJmsTransactedSecurityTest fails every now and then because of JMS message redelivery. When the entire test class is executed  it sometimes happens that the message that failed at testJmsSecurityFailure test method pops up in the assertions of testJmsSecurityOK.,0,0
EventHelper.notifyRouteStarted skips all remaining notifiers if one if the notifiers ignores route events,Having two or more notifiers registered at the management strategy of a camel context  where one of the notifiers (not the last one) is set up to ignore route events  results in all remaining notifiers to be skipped when notifying a RouteStartedEvent.Look at http://svn.apache.org/viewvc/camel/branches/camel-2.10.x/camel-core/src/main/java/org/apache/camel/util/EventHelper.java?revision=1340446&amp;view=markup  line 237: There's a 'return' which actually should be a 'continue'.Note: CamelContextStoppingEvents are also affected.,0,0
ObjectHelper.resolveUriPath is broken  can not handle:  '../../' correctly,In my xsl-files I have imports and includes that resides in folders a few levels up.Ex: &lt;xsl:include href='../../common/myfunctions.xsl'/&gt;When camel starts up and tries to resolve the paths it crashes because of the current implementation in ObjectHelper.resolveUriPath(..)Made a simple testcase that demonstrates my problem.public void testResolveUriPath() throws Exception { assertEquals('xslt/'  ObjectHelper.resolveUriPath('xslt/one/../')); // OK assertEquals('xslt/'  ObjectHelper.resolveUriPath('xslt/one/../two/../')); // OK assertEquals('xslt/'  ObjectHelper.resolveUriPath('xslt/')); // OK assertEquals(''  ObjectHelper.resolveUriPath('./')); // OK assertEquals('xslt/'  ObjectHelper.resolveUriPath('xslt/one/two/../../')); // Fails  gives 'xslt/one/.' assertEquals('xslt/'  ObjectHelper.resolveUriPath('xslt/one/two/../.././'));// Fails  gives 'xslt/one/.' },0,0
Enricher with async routing not handling exceptions thrown from AggregationStrategy,The Enricher does not handle exceptions thrown from the AggregationStrategy when the async routing engine has kicked in. It leads to the following thread dump  callback thread remains blocked forever.'Camel (context) thread #10 - JmsConsumer[queue]' daemon prio=5 tid=103666000 nid=0x113c25000 waiting on condition [113c24000] java.lang.Thread.State: WAITING (parking) at sun.misc.Unsafe.park(Native Method) - parking to wait for &lt;7fd4a8de0&gt; (a java.util.concurrent.CountDownLatch$Sync) at java.util.concurrent.locks.LockSupport.park(LockSupport.java:156) at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:811) at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:969) at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1281) at java.util.concurrent.CountDownLatch.await(CountDownLatch.java:207) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:120) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:85) at org.apache.camel.component.jms.EndpointMessageListener.onMessage(EndpointMessageListener.java:91) at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:560) at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:498) at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:467) at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325) at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263) at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1058) at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1050) at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:947) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:680),0,1
EIPs using custom aggregation strategy should fail if not possible to find in registry,Some EIPs support using a custom aggregations strategy. And if you use XML DSL to refer to a custom strategy  then you may have typo  or the strategy do not implement the interface.What we should do is to ensure to fail if the custom strategy could not be looked up. Some EIPs such as the content enricher will fallback and use a default strategy. This is wrong.,0,0
Camel Endpoint ignores camelContextId property in Spring configuration,Camel Endpoint  if configured outside camelContext element in Spring configuration  ignores camelContextId property. Steps to reproduce: Configure two contexts in spring configuration. Then in the same config file configure two endpoints outside camelContext  but with camelContextId specified. Both endpoints will be created pointing to the same (first) camel context  despite being configured to different contexts. Attempting to use them by reference results in failure  as endpoint camelContext doesn't match the expected one.,0,0
Recipient list EIP - Should shutdown thread pool if parallel mode enabled,We should shutdown the thread pool for recipient list if a pool was in use  and it can be shutdown.The logic in doShutdown is missing that.Camel would though have a fail-safe when it shutdown itself to shutdown that pool otherwise. But we should shutdown when the EIP is shutdown itself.,0,0
camel-mqtt - Nullpointer Exception when disconnected from broker,Hi  from time to time  we get the following exception when producing messages via camel-mqtt:Caused by: java.lang.NullPointerException at org.fusesource.mqtt.client.CallbackConnection.publish(CallbackConnection.java:551) at org.fusesource.mqtt.client.CallbackConnection.publish(CallbackConnection.java:545) at org.apache.camel.component.mqtt.MQTTEndpoint.publish(MQTTEndpoint.java:166) at org.apache.camel.component.mqtt.MQTTProducer.doProcess(MQTTProducer.java:66) at org.apache.camel.component.mqtt.MQTTProducer.process(MQTTProducer.java:38) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73)[...]From looking at the source of both camel-mqtt and the fusesource mqtt client  it looks like that this is caused by the mqtt-client being disconnected and trying to invoke the onFailure method on the callback:CallbackConnection.javapublic void publish(UTF8Buffer topic  Buffer payload  QoS qos  boolean retain  Callback&lt;Void&gt; cb) { queue.assertExecuting(); if( disconnected ) { cb.onFailure(createDisconnectedError()); return; } PUBLISH command = new PUBLISH().qos(qos).retain(retain); command.topicName(topic).payload(payload); send(command  cb); }camel-mqtt passes in null for the callback though. Wouldn't it be better if a more fitting exception were thrown  or if camel passed in a Callback in order to receive the onFailure event when disconnected from the broker?,0,0
Using recipient list in a doTry ... doCatch situation dont work properly,See nabblehttp://camel.465427.n5.nabble.com/Issue-with-doTry-doCatch-not-routing-correctly-tp5720325.htmlThe end user would expect that doTry .. doCatch will overrule. However it gets a bit further more complicated if the try block routes to other routes and using EIPs such as recipient list.,0,0
Netty - Should use ordered thread pool,We should favor using OrderedMemoryAwareThreadPoolExecutor andOrderedDownstreamThreadPoolExecutor to ensure ordering of events in a channel.See nabblehttp://camel.465427.n5.nabble.com/Netty-or-Mina-Async-in-the-same-socket-tp5720478.htmlWe can add an option so people can turn it off  like we did for mina2.,0,0
camel-jms - Should also allow multiple consumers from multiple routes from the same queue,If having 2+ routes that consumes from the same queue  then that should be allowed.Its a bit unusual though for queues in Camel as you most likely want to use the same route for the same queue. But there is nothing in the JMS spec that forbids this.,0,0
camel-netty - The ordered thread pool should be shared,Related to CAMEL-5689The ordered memory thread pool from Netty is intended to be shared per application. And not per consumer.,0,1
NotifyBuilder should be thread safe,In high concurrent tests the NotifyBuilder may miss a counter.,0,0
Rest route returns response with http Status code 500 Internal Server Error when response has Last-Modified or Header-expires in header as string.,Rest route returns Response with http Status code 500 Internal Server Error and expected response headers/body when response has Last-Modified or Header-expires in header as string. I found the issue in below code it try to convert string Wed  31 Dec 1969 18:00:00 CS to Date and it fails. Is it posible to convert String Date without knowing Date format?DefaultRestletBinding======================= if (header.equalsIgnoreCase(HeaderConstants.HEADER_LAST_MODIFIED)) { if (value instanceof Calendar) { message.getEntity().setModificationDate(((Calendar) value).getTime()); } else if (value instanceof Date) { message.getEntity().setModificationDate((Date) value); } else { Date date = exchange.getContext().getTypeConverter().mandatoryConvertTo(Date.class  value); // Here it try to convert String to Date it throws No type converter available to convert from type: java.lang.String to the required type: java.util.Date with value Wed  31 Dec 1969 18:00:00 CS message.getEntity().setModificationDate(date); } }Stack trace===========7 Oct 2012 08:28:06 010 WARN org.restlet.Component.StatusFilter - Exception or error caught in status serviceorg.apache.camel.RuntimeCamelException: Cannot process request at org.apache.camel.component.restlet.RestletConsumer$1.handle(RestletConsumer.java:62) at org.apache.camel.component.restlet.MethodBasedRouter.handle(MethodBasedRouter.java:54) at org.restlet.routing.Filter.doHandle(Filter.java:159) at org.restlet.routing.Filter.handle(Filter.java:206) at org.restlet.routing.Router.doHandle(Router.java:500) at org.restlet.routing.Router.handle(Router.java:740) at org.restlet.routing.Filter.doHandle(Filter.java:159) at org.restlet.routing.Filter.handle(Filter.java:206) at org.restlet.routing.Router.doHandle(Router.java:500) at org.restlet.routing.Router.handle(Router.java:740) at org.restlet.routing.Filter.doHandle(Filter.java:159) at org.restlet.engine.application.StatusFilter.doHandle(StatusFilter.java:154) at org.restlet.routing.Filter.handle(Filter.java:206) at org.restlet.routing.Filter.doHandle(Filter.java:159) at org.restlet.routing.Filter.handle(Filter.java:206) at org.restlet.engine.ChainHelper.handle(ChainHelper.java:114) at org.restlet.Component.handle(Component.java:391) at org.restlet.Server.handle(Server.java:491) at org.restlet.engine.ServerHelper.handle(ServerHelper.java:75) at org.restlet.engine.http.HttpServerHelper.handle(HttpServerHelper.java:153) at org.restlet.ext.servlet.ServerServlet.service(ServerServlet.java:1031) at org.apache.shiro.grails.SavedRequestFilter.doFilter(SavedRequestFilter.java:56) at org.apache.shiro.web.servlet.AbstractShiroFilter.executeChain(AbstractShiroFilter.java:360) at org.apache.shiro.web.servlet.AbstractShiroFilter$1.call(AbstractShiroFilter.java:276) at org.apache.shiro.subject.support.SubjectCallable.doCall(SubjectCallable.java:90) at org.apache.shiro.subject.support.SubjectCallable.call(SubjectCallable.java:83) at org.apache.shiro.subject.support.DelegatingSubject.execute(DelegatingSubject.java:344) at org.apache.shiro.web.servlet.AbstractShiroFilter.doFilterInternal(AbstractShiroFilter.java:272) at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:81) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:909) at java.lang.Thread.run(Thread.java:662)Caused by: org.apache.camel.NoTypeConversionAvailableException: No type converter available to convert from type: java.lang.String to the required type: java.util.Date with value Wed  31 Dec 1969 18:00:00 CST at org.apache.camel.impl.converter.BaseTypeConverterRegistry.mandatoryConvertTo(BaseTypeConverterRegistry.java:169),0,0
BlueprintCamelContext should not get started in the init() method but later when the blueprint container is fully initialized,The init() method in BlueprintCamelContext should not call maybeStart(). but instead should be started when the blueprint container is done doing all its dance and initialization.For example Spring sends on ContextRefreshedEvent when its done.We need something similar for blueprint to tell us when its done doing its initialization et all.The problem is that the CamelContext should not be started until all that other stuff is initialized as well.,0,0
Classloader mixup when consumers across bundles share the same camel-jetty port,Happens in an OSGi environment; but it is also applicable in modular servers that build dynamic classloaders (e.g. JBoss AS) per deployed artifacts (WAR  module  EAR  etc.).If bundles A and B are both creating camel-jetty consumers on the same TCP port  the consumers will share the underlying Jetty connector. Moreover  the Jetty connector is indeed created by the first consumer that initialises on that TCP port.Since the Camel route executes on the Jetty Connector thread  all class resolutions will happen against the classloader of the bundle that initialises first.This makes class resolution absolutely undeterministic and erratic. Quite a nasty bug IMHO.Perhaps this can be fixed by adding a call to Thread.setContextClassLoader() passing the classloader of the JettyHttpEndpoint  as soon as a request comes in?,0,0
Spring-WS consumer and producer do not propagate some custome headers and attachements to a response message,Hi!I wanted to send back as response or as a request some soap messages with modified header.I found out that SpringWebserviceProducer and SpringWebserviceConsumer do not populate a soap header for any outgoing message from a camel exchange.In the attachments I am sending you a patch against camel-spring-ws 2.10.1 that solves this issue.Please let me know  what do you think about it.Best regards Andrej,0,0
HTTP 1.1 Host header not set correctly with camel-http4,The HTTP 1.1 Host header is not set correctly when using the camel-http4 component as a proxy with bridgeEnpoint=true.The original request Host header is set in the proxied request instead of the host of the service requested by the proxy (ref: http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html section 14.23).This simple route shows the problem: &lt;route autoStartup='true' id='TestHost' xmlns:ns2='http://camel.apache.org/schema/web' xmlns='http://camel.apache.org/schema/spring'&gt; &lt;from uri='jetty:http://0.0.0.0:8090/TestHost'/&gt; &lt;to uri='https4://www.google.com?bridgeEndpoint=true&amp;throwExceptionOnFailure=false'/&gt; &lt;/route&gt; This is what I get in the log:INFO | jvm 1 | 2012/10/26 14:52:48 | [ qtp31541880-35 - /TestHost] DefaultClientConnection DEBUG Sending request: GET / HTTP/1.1INFO | jvm 1 | 2012/10/26 14:52:48 | [ qtp31541880-35 - /TestHost] wire DEBUG &gt;&gt; 'GET / HTTP/1.1&#91;/r&#93;&#91;/n&#93;'INFO | jvm 1 | 2012/10/26 14:52:48 | [ qtp31541880-35 - /TestHost] wire DEBUG &gt;&gt; 'breadcrumbId: ID-localhost-1329-1351277552803-0-2&#91;/r&#93;&#91;/n&#93;'INFO | jvm 1 | 2012/10/26 14:52:48 | [ qtp31541880-35 - /TestHost] wire DEBUG &gt;&gt; 'User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:15.0) Gecko/20100101 Firefox/15.0&#91;/r&#93;&#91;/n&#93;'INFO | jvm 1 | 2012/10/26 14:52:48 | [ qtp31541880-35 - /TestHost] wire DEBUG &gt;&gt; 'Accept-Encoding: gzip  deflate&#91;/r&#93;&#91;/n&#93;'INFO | jvm 1 | 2012/10/26 14:52:48 | [ qtp31541880-35 - /TestHost] wire DEBUG &gt;&gt; 'Host: localhost:8090&#91;/r&#93;&#91;/n&#93;'INFO | jvm 1 | 2012/10/26 14:52:48 | [ qtp31541880-35 - /TestHost] wire DEBUG &gt;&gt; 'Accept: text/html application/xhtml+xml application/xml;q=0.9 /;q=0.8&#91;/r&#93;&#91;/n&#93;'INFO | jvm 1 | 2012/10/26 14:52:48 | [ qtp31541880-35 - /TestHost] wire DEBUG &gt;&gt; 'Accept-Language: en-us en;q=0.5&#91;/r&#93;&#91;/n&#93;'INFO | jvm 1 | 2012/10/26 14:52:48 | [ qtp31541880-35 - /TestHost] wire DEBUG &gt;&gt; 'Connection: Keep-Alive&#91;/r&#93;&#91;/n&#93;'INFO | jvm 1 | 2012/10/26 14:52:48 | [ qtp31541880-35 - /TestHost] wire DEBUG &gt;&gt; '&#91;/r&#93;&#91;/n&#93;',0,0
Update SqsConsumer to extend Visibility Timeout correctly,Currently SqsConsumer will scheduled a future to happen start occruing 1/2 the visibility timeout  and reoccur again at the visibility timeout period. Because of the way SQS works  when you request a ChangeMessageVisibility timeout it does not add that to the time remaining on the message visibility. Instead it will set the message visibility to the time out given. This means that what actually happens in the camel code is that: we request the ChangeMessageVisibility timeout to be set to X seconds from now after X/2 seconds then every X seconds after that we we request the ChangeMessageVisibility timeout to be set to X from nowThis means that our message will become visible every now and again as the ChangeMessageVisibility timeout is not updated in time as period between successive executions is the same as the timeout period we request.I've attached two patches which would fix this issue. 'aws_sqs_visibility_timeout_simple.patch' - This patch changes the way we set up the future. The delay and period are now the same so that we call ChangeMessageVisibility every X/2 after the message has been pulled. 'aws_sqs_visibility_timeout_phased_timeout.patch' - This one keeps the delay to 1/2 the period and requests ChangeMessageVisibility every period. This time though it requests the visibility to be 1.5 * the period. This means that it behaves as originally planned  as if it was adding duration to the visibility duration left. This means we call Amazon less times and still keep the message hidden as expected.This was looked at with Alex Hutter (both working on same project).,0,0
Configuring jetty component with a different name dont work with jetty consumer,For example if you do &lt;route&gt; &lt;from uri='jetty2:http://localhost:9090/myapp'/&gt; &lt;transform&gt; &lt;simple&gt;Hello ${body}&lt;/simple&gt; &lt;/transform&gt; &lt;/route&gt;Then it fails withjava.net.SocketException: Unresolved address at sun.nio.ch.Net.translateToSocketException(Net.java:58) at sun.nio.ch.Net.translateException(Net.java:84) at sun.nio.ch.Net.translateException(Net.java:90) at sun.nio.ch.ServerSocketAdaptor.bind(ServerSocketAdaptor.java:61) at org.eclipse.jetty.server.nio.SelectChannelConnector.open(SelectChannelConnector.java:187) at org.eclipse.jetty.server.AbstractConnector.doStart(AbstractConnector.java:316) at org.eclipse.jetty.server.nio.SelectChannelConnector.doStart(SelectChannelConnector.java:265) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.eclipse.jetty.server.Server.doStart(Server.java:286) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.apache.camel.component.jetty.JettyHttpComponent.connect(JettyHttpComponent.java:315) at org.apache.camel.component.http.HttpEndpoint.connect(HttpEndpoint.java:149) at org.apache.camel.component.http.HttpConsumer.doStart(HttpConsumer.java:56) at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:60)...,0,0
Camel Splitter eat up exceptions recorded by the underlying Scanner,See http://camel.465427.n5.nabble.com/Trouble-with-split-tokenize-on-linux-td5721677.html for details,0,0
Camel JMS producer can block a thread under specific circumstances,This is an edge case  but when the following circumstances concur  the asynchronous routing engine in Camel become blocked: Sending an InOut exchange over JMS (request/reply)  where: Persistent messages are enabled (deliveryPersistent=true) useMessageIDasCorrelationID is enabled replyToType is Temporary queues (default) (using TemporaryQueueReplyManager) a timeout is setYou have to be really unlucky  but if the following condition is satisfied  a thread will become blocked:time the broker takes to ACK the produced message &gt; message timeoutHence  if we have a timeout of 3000ms  and the broker takes 4000ms to ACK the message (e.g. slow Disk I/O while the journal is rotating - it happened to us)  at some point we'll see this.2012-10-30 10:46:57 680 | WARN | CorrelationMap | 89 - org.apache.camel.camel-core - 2.8.0.fuse-06-11 | Exception occurred during purge task. This exception will be ignored.java.lang.NullPointerExceptionThe CorrelationMap is rendered useless  so if subsequent exchanges time out  the ReplyHandler may never get an onTimeout callback  thus leading to the waiting thread getting blocked forever if the async routing engine was in place.,0,1
RoutePolicySupport should provide some easy to use utility methods to suspend/resume routes as we have it already to start/stop routes,,0,0
ActiveMQ target endpoint with transferExchange=true does not work together with source File endpoint with preMove option set,Got failure on a simple route reading from file and sending to ActiveMQ queue.On source File endpoint set preMove option to some folder  and on target activemq endpoint set transferExchange=true.It fails with FileNotFound exception  trying to read file from original location  not from temporary preMoved one.Without preMove all works perfect.Simplified Spring application context with Camel routes looks like this:&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;beans xmlns='http://www.springframework.org/schema/beans' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:schemaLocation=' http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd'&gt; &lt;bean id='brokerService' class='org.apache.activemq.broker.BrokerService' init-method='start' destroy-method='stop'&gt; &lt;property name='brokerName' value='localhost' /&gt; &lt;property name='useJmx' value='false' /&gt; &lt;property name='transportConnectorURIs'&gt; &lt;list&gt; &lt;value&gt;vm://localhost&lt;/value&gt; &lt;/list&gt; &lt;/property&gt; &lt;/bean&gt; &lt;bean id='jmsConnectionFactory' class='org.apache.activemq.ActiveMQConnectionFactory' depends-on='brokerService'&gt; &lt;property name='brokerURL' value='vm://localhost'/&gt; &lt;property name='redeliveryPolicy' ref='redeliveryPolicyConfigActiveMQ'/&gt; &lt;/bean&gt; &lt;bean id='pooledConnectionFactory' class='org.apache.activemq.pool.PooledConnectionFactory' init-method='start' destroy-method='stop'&gt; &lt;property name='maxConnections' value='8' /&gt; &lt;property name='maximumActive' value='500' /&gt; &lt;property name='connectionFactory' ref='jmsConnectionFactory' /&gt; &lt;/bean&gt; &lt;bean id='redeliveryPolicyConfigActiveMQ' class='org.apache.activemq.RedeliveryPolicy'&gt; &lt;property name='maximumRedeliveries' value='1'/&gt; &lt;property name='redeliveryDelay' value='5000'/&gt; &lt;/bean&gt; &lt;camelContext id='testCustomer' xmlns='http://camel.apache.org/schema/spring'&gt; &lt;endpoint id='sourceEndpoint' uri='file:e:/work/ids/testCustomer/input/?preMove=.tmp&amp;delay=1000&amp;readLock=rename&amp;copyAndDeleteOnRenameFail=false&amp;move=.archive&amp;moveFailed=.failed' /&gt; &lt;endpoint id='destJms' uri='activemq:queue:source?transferExchange=true&amp;connectionFactory=#pooledConnectionFactory' /&gt; &lt;route id='testRoute'&gt; &lt;from ref='sourceEndpoint' /&gt; &lt;to ref='destJms' /&gt; &lt;/route&gt; &lt;/camelContext&gt;&lt;/beans&gt;Exception trace:org.apache.camel.TypeConversionException: Error during type conversion from type: java.io.File to the required type: byte[] with value e:/work/ids/testCustomer/input/payment.xml due java.io.FileNotFoundException: e:/work/ids/testCustomer/input/payment.xml (The system cannot find the file specified) at com.it.ids.exceptions.HandleException.process(HandleException.java:20) at org.apache.camel.util.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:61) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:73) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:163) at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:45) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.interceptor.DefaultChannel.process(DefaultChannel.java:303) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.Pipeline.process(Pipeline.java:117) at org.apache.camel.processor.Pipeline.process(Pipeline.java:80) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.FatalFallbackErrorHandler.processNext(FatalFallbackErrorHandler.java:42) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.RedeliveryErrorHandler.deliverToFailureProcessor(RedeliveryErrorHandler.java:766) at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:273) at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:220) at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:45) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.interceptor.DefaultChannel.process(DefaultChannel.java:303) at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:45) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.UnitOfWorkProcessor.processAsync(UnitOfWorkProcessor.java:150) at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:117) at org.apache.camel.processor.RouteInflightRepositoryProcessor.processNext(RouteInflightRepositoryProcessor.java:48) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:73) at org.apache.camel.component.file.GenericFileConsumer.processExchange(GenericFileConsumer.java:336) at org.apache.camel.component.file.GenericFileConsumer.processBatch(GenericFileConsumer.java:189) at org.apache.camel.component.file.GenericFileConsumer.poll(GenericFileConsumer.java:155) at org.apache.camel.impl.ScheduledPollConsumer.doRun(ScheduledPollConsumer.java:142) at org.apache.camel.impl.ScheduledPollConsumer.run(ScheduledPollConsumer.java:92) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:317) at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:150) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:98) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:180) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:204) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:662)Caused by: org.apache.camel.RuntimeCamelException: java.io.FileNotFoundException: e:/work/ids/testCustomer/input/payment.xml (The system cannot find the file specified) at org.apache.camel.util.ObjectHelper.wrapRuntimeCamelException(ObjectHelper.java:1270) at org.apache.camel.util.ObjectHelper.invokeMethod(ObjectHelper.java:926) at org.apache.camel.impl.converter.StaticMethodTypeConverter.convertTo(StaticMethodTypeConverter.java:47) at org.apache.camel.impl.converter.BaseTypeConverterRegistry.doConvertTo(BaseTypeConverterRegistry.java:253) at org.apache.camel.impl.converter.BaseTypeConverterRegistry.mandatoryConvertTo(BaseTypeConverterRegistry.java:155) at org.apache.camel.component.file.FileBinding.loadContent(FileBinding.java:57) at org.apache.camel.component.file.GenericFileConverter.genericFileToInputStream(GenericFileConverter.java:123) at org.apache.camel.component.file.GenericFileConverter.genericFileToSerializable(GenericFileConverter.java:152) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.camel.util.ObjectHelper.invokeMethod(ObjectHelper.java:922) at org.apache.camel.impl.converter.StaticMethodTypeConverter.convertTo(StaticMethodTypeConverter.java:47) at org.apache.camel.impl.converter.BaseTypeConverterRegistry.doConvertTo(BaseTypeConverterRegistry.java:253) at org.apache.camel.impl.converter.BaseTypeConverterRegistry.convertTo(BaseTypeConverterRegistry.java:111) at org.apache.camel.impl.DefaultExchangeHolder.checkMapSerializableObjects(DefaultExchangeHolder.java:209) at org.apache.camel.impl.DefaultExchangeHolder.safeSetProperties(DefaultExchangeHolder.java:177) at org.apache.camel.impl.DefaultExchangeHolder.marshal(DefaultExchangeHolder.java:93) at org.apache.camel.impl.DefaultExchangeHolder.marshal(DefaultExchangeHolder.java:71) at org.apache.camel.component.jms.JmsBinding.createJmsMessage(JmsBinding.java:439) at org.apache.camel.component.jms.JmsBinding.makeJmsMessage(JmsBinding.java:287) at org.apache.camel.component.jms.JmsProducer$2.createMessage(JmsProducer.java:266) at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate.doSendToDestination(JmsConfiguration.java:215) at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate.access$100(JmsConfiguration.java:158) at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate$3.doInJms(JmsConfiguration.java:192) at org.springframework.jms.core.JmsTemplate.execute(JmsTemplate.java:466) at org.apache.camel.component.jms.JmsConfiguration$CamelJmsTemplate.send(JmsConfiguration.java:189) at org.apache.camel.component.jms.JmsProducer.doSend(JmsProducer.java:398) at org.apache.camel.component.jms.JmsProducer.processInOnly(JmsProducer.java:352) at org.apache.camel.component.jms.JmsProducer.process(JmsProducer.java:132) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.SendProcessor$2.doInAsyncProducer(SendProcessor.java:122) at org.apache.camel.impl.ProducerCache.doInAsyncProducer(ProducerCache.java:298) at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:117) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:73) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:163) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:334) ... 28 moreCaused by: java.io.FileNotFoundException: e:/work/ids/testCustomer/input/payment.xml (The system cannot find the file specified) at java.io.FileInputStream.open(Native Method) at java.io.FileInputStream.&lt;init&gt;(FileInputStream.java:106) at org.apache.camel.converter.IOConverter.toInputStream(IOConverter.java:73) at org.apache.camel.converter.IOConverter.toByteArray(IOConverter.java:243) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.camel.util.ObjectHelper.invokeMethod(ObjectHelper.java:922) ... 71 more,0,0
limitaions on s3 component. no means to specify acl on created object. objects do not inherit acl from the bucket they belong to.,When using s3 component to create new object on amazon bucket  there is no means to specify acl that will be applied to this newly created object. s3 objects do not inherit acl applied to the bucket they belong to. in s3 camel component (enpoint) we can specify bucket policy but not objects acl.the limitation is in s3producer.there is an attachment file (patch) to fix this quickly and whith little modifications to the existing code. but i think that we need to enhance the design of this component to be more flexible and rely on strategy that executes requests to interact with s3.for now there is no tests for s3producer in camel-aws thus i don't supply a unit test.if we enhance the design we can change or improve this layer with less effort. and we can do tests obviously.,0,0
regression : invalid SetQueueAttributesRequest created  works on 2.10.1,In org.apache.camel.component.aws.sqs.SqsEndpoint.updateQueueAttributes if I don't have any configuration  the created SetQueueAttributesRequest contains a null atttribute collection and AWS emit an error.In 2.10.1  no problem.Workaround in 2.10.2 : force the create SetQueueAttributesRequest to contain a valid attribute collection by defining a configuration in camel. For exemple: from('aws-sqs://'queue'?amazonSQSClient=#amazonSQSClient&amp;delay='pollCycle.getMillis()'&amp;maxMessagesPerPoll=10&amp;deleteAfterRead=false')  -&gt; works on 2.10.1  fail on 2.10.2if I add an argument to my URI'&amp;defaultVisibilityTimeout=30'  -&gt; works on 2.10.1  works on 2.10.2Exception : {{Caused by: org.apache.camel.FailedToCreateRouteException: Failed to create route SQS-to-MongoDB-EVENTS: Route[[From[aws-sqs://EVENTS?amazonSQSClient=#amazonSQSClien... because of Failed to resolve endpoint: aws-sqs://EVENTS?amazonSQSClient=%23amazonSQSClient&amp;delay=60000&amp;deleteAfterRead=false&amp;maxMessagesPerPoll=10 due to: The request must contain the parameter Attribute.Name. at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:176) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.impl.DefaultCamelContext.startRoute(DefaultCamelContext.java:722) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.impl.DefaultCamelContext.startRouteDefinitions(DefaultCamelContext.java:1789) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.impl.DefaultCamelContext.doStartCamel(DefaultCamelContext.java:1575) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.impl.DefaultCamelContext.doStart(DefaultCamelContext.java:1444) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:60) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.impl.DefaultCamelContext.start(DefaultCamelContext.java:1412) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at com.netceler.iv5measure.contract.impl.sqs.CamelRoutesLauncher.start(CamelRoutesLauncher.java:55) ~&#91;webapp-0.1.2-SNAPSHOT.jar:0.1.2-SNAPSHOT&#93; at com.netceler.iv5measure.contract.impl.config.ConfiguredStreamInitializer.startStreams(ConfiguredStreamInitializer.java:39) ~&#91;webapp-0.1.2-SNAPSHOT.jar:0.1.2-SNAPSHOT&#93; ... 58 common frames omittedCaused by: org.apache.camel.ResolveEndpointFailedException: Failed to resolve endpoint: aws-sqs://EVENTS?amazonSQSClient=%23amazonSQSClient&amp;delay=60000&amp;deleteAfterRead=false&amp;maxMessagesPerPoll=10 due to: The request must contain the parameter Attribute.Name. at org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:479) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.util.CamelContextHelper.getMandatoryEndpoint(CamelContextHelper.java:50) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.model.RouteDefinition.resolveEndpoint(RouteDefinition.java:186) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.impl.DefaultRouteContext.resolveEndpoint(DefaultRouteContext.java:108) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.impl.DefaultRouteContext.resolveEndpoint(DefaultRouteContext.java:114) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.model.FromDefinition.resolveEndpoint(FromDefinition.java:72) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.impl.DefaultRouteContext.getEndpoint(DefaultRouteContext.java:90) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:851) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:171) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; ... 66 common frames omittedCaused by: com.amazonaws.AmazonServiceException: The request must contain the parameter Attribute.Name. at com.amazonaws.http.AmazonHttpClient.handleErrorResponse(AmazonHttpClient.java:614) ~&#91;aws-java-sdk-1.3.23.jar:na&#93; at com.amazonaws.http.AmazonHttpClient.executeHelper(AmazonHttpClient.java:312) ~&#91;aws-java-sdk-1.3.23.jar:na&#93; at com.amazonaws.http.AmazonHttpClient.execute(AmazonHttpClient.java:165) ~&#91;aws-java-sdk-1.3.23.jar:na&#93; at com.amazonaws.services.sqs.AmazonSQSClient.invoke(AmazonSQSClient.java:812) ~&#91;aws-java-sdk-1.3.23.jar:na&#93; at com.amazonaws.services.sqs.AmazonSQSClient.setQueueAttributes(AmazonSQSClient.java:246) ~&#91;aws-java-sdk-1.3.23.jar:na&#93; at com.netceler.infra.aws.sqs.JMXSQS.setQueueAttributes(JMXSQS.java:108) ~&#91;infra-sqs-0.0.3-SNAPSHOT.jar:0.0.3-SNAPSHOT&#93; at com.netceler.infra.aws.sqs.AmazonSQSClientProxy.setQueueAttributes(AmazonSQSClientProxy.java:63) ~&#91;infra-sqs-0.0.3-SNAPSHOT.jar:0.0.3-SNAPSHOT&#93; at org.apache.camel.component.aws.sqs.SqsEndpoint.updateQueueAttributes(SqsEndpoint.java:139) ~&#91;camel-aws-2.10.2.jar:2.10.2&#93; at org.apache.camel.component.aws.sqs.SqsEndpoint.doStart(SqsEndpoint.java:93) ~&#91;camel-aws-2.10.2.jar:2.10.2&#93; at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:60) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.impl.DefaultCamelContext.startService(DefaultCamelContext.java:1763) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.impl.DefaultCamelContext.doAddService(DefaultCamelContext.java:931) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.impl.DefaultCamelContext.addService(DefaultCamelContext.java:892) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; at org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:475) ~&#91;camel-core-2.10.2.jar:2.10.2&#93; ... 74 common frames omitted}},0,0
option to add bundle directives in the generated test bundles by camel-test-blueprint,The generated test bundle by camel-test-blueprint has the plain test class name as the bundle symbolic name in its manifest.Some test cases may require bundle directives to be added to the bundle symbolic name entry in the manifest.One such test case is for disabling xml validation.To support such blueprint test cases  I would like to add an option in CamelBlueprintTestSupport to customize the bundle directives.,0,0
Adding blueprint based camel-cxf tests using camel-test-blueprint,Adding some blueprint scenario tests for camel-cxf using camel-test-blueprint.I put this in a separate test-only component under the tests folder. I can't put the test classes directly within camel-cxf because of the way how the bundle context is generated  namely the jars on the classpath are scanned and added to the context. Hence  the tests are in a separate component that refer to all the bundle jars that they need.I don't know if the tests folder is the the right location for this test component  though.,0,0
camel-mongodb - Add converters for files or inputstreams,Inserting files into MongoDB doesn't work like this:from('file:///tmp/test/apachecon?runLoggingLevel=TRACE') .to('mongodb:connectionBean?database=x&amp;collection=y&amp;operation=insert');It requires an explicit .convertBodyTo(String.class). The attached patch adds Converter}}s for File and InputStream object  detecting and supporting both {{JSON and BSON files/streams.The new String(input  'utf-8')) fragment seems a bit dodgy  but I don't really see a better way.,0,0
Regression in validator component in 2.10.3,I get:CaughtExceptionType:java.lang.NullPointerException  CaughtExceptionMessage:null  StackTrace:java.lang.NullPointerException at org.apache.camel.converter.jaxp.XmlConverter.toStreamSource(XmlConverter.java:516) at org.apache.camel.converter.jaxp.XmlConverter.toSAXSource(XmlConverter.java:399) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at org.apache.camel.util.ObjectHelper.invokeMethod(ObjectHelper.java:923) at org.apache.camel.impl.converter.InstanceMethodTypeConverter.convertTo(InstanceMethodTypeConverter.java:66) at org.apache.camel.support.TypeConverterSupport.convertTo(TypeConverterSupport.java:34) at org.apache.camel.processor.validation.ValidatingProcessor.getSource(ValidatingProcessor.java:343) at org.apache.camel.processor.validation.ValidatingProcessor.process(ValidatingProcessor.java:100) at org.apache.camel.impl.ProcessorEndpoint.onExchange(ProcessorEndpoint.java:101) at org.apache.camel.impl.ProcessorEndpoint$1.process(ProcessorEndpoint.java:71) at org.apache.camel.util.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:61) atorg.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.SendProcessor$2.doInAsyncProducer(SendProcessor.java:122) at org.apache.camel.impl.ProducerCache.doInAsyncProducer(ProducerCache.java:298) at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:117) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) /when I upgrade camel to 2.10.3 and use the validator component:&lt;camel:to uri='validator:META-INF/xsd/transactiongatetransfertransaction.xsd' /&gt;this did not happen in 2.10.2 or versions before that.,0,0
Pre-XSLT and Validator Type Conversions from byte[] may easily fail,XsltBuilder.getSource(Exchange e  Object o) tries to convert the payload to a Source. If you have a byte[] payload  then the following type converter will likely be picked:InstanceMethodTypeConverter: public javax.xml.transform.sax.SAXSource org.apache.camel.converter.jaxp.XmlConverter.toSAXSource(byte[] org.apache.camel.Exchange) throws java.io.IOException org.xml.sax.SAXException javax.xml.transform.TransformerExceptionThis type converter requires the Exchange (InstanceMethodTypeConverter.useExchange == true)  but line 461 of XsltBuilder doesn't pass it on.Therefore  a NullPointerException happens because the conversion method tries to access the Exchange.,0,0
camel-quickfix: QuickfixjEndpoint should adhere the InOut exchange pattern if you would ask for this MEP,See http://camel.465427.n5.nabble.com/camel-quickfix-RequestReplyExample-java-io-IOException-td5723769.html,0,0
FTP endpoints should support charset property like File endpoint does,FTP endpoints should support charset property like the File endpoint does. Currently you have to remember to set the CamelCharsetName Exchange property if you want to have the message body transformed to another charset.See http://camel.465427.n5.nabble.com/Problem-w-FTP-producer-and-charset-td5723604.htmlI'll work on a patch and attach it later.,0,0
File consumer - When using done file name then delete the file when batch is complete,When using doneFileName then the file is deleted on each completion of files in the batch. And you get WARN logs about the done file cannot be deleted  because the 1st already deleted the file.We should defer and only delete the done file on the last in the batch.,0,0
When call removeRouteDefinition the route doesn't removed from collection of route Definitions.,When I call removeRouteDefinition for DefaultCamelContext  the route doesn't removed from collection of routes. public synchronized void removeRouteDefinition(RouteDefinition routeDefinition) throws Exception { String id = routeDefinition.idOrCreate(nodeIdFactory); stopRoute(id); removeRoute(id); }it is just remove it from running route service if context is running.When we do restart context this route started again. Workaround for this issue is call removeRouteDefinitions and wrap single route into collection.But when I call removeRouteDefinitions - it is process correctly: remove from collections of definitions and after removed from running route services. public synchronized void removeRouteDefinitions(Collection&lt;RouteDefinition&gt; routeDefinitions) throws Exception { this.routeDefinitions.removeAll(routeDefinitions); for (RouteDefinition routeDefinition : routeDefinitions) { removeRouteDefinition(routeDefinition); } },1,0
Scala DSL: no tokenize('...') method,This is related to issue https://issues.apache.org/jira/browse/CAMEL-5803It looks like the fix included tokenizeXML() method  but there is still not tokenize()  I have a usecase where I have to split my in message body (text) by semi-colon character for downstream processing  so I need to be able to do something like the following in Scala DSL:split(_.in) tokenize(';')I fix would be very welcome  also  if there is a work around with TokenizeLanguage etc - please let me know  thank you!,0,0
NPE when jaxb fallback converter is used with RequestEntityConverter,As the RequestEntityConverter.toRequestEntity(String str  Exchange exchange) doesn't has check if the exchange is null  it caused the NPE as the user complain in camel user mailing list&#91;1&#93;&#91;1&#93;http://camel.465427.n5.nabble.com/Content-Enrich-Error-when-upgrading-Apache-Camel-from-2-9-2-to-any-higher-version-td5724244.htmlHere is the stack trace.CaughtExceptionType:org.apache.camel.TypeConversionException  CaughtExceptionMessage:Error during type conversion from type: com.ecc.DamBean to the required type: org.apache.commons.httpclient.methods.RequestEntity with value com.ecc.DamBean@8811a59 due Error during type conversion from type: java.lang.String to the required type: org.apache.commons.httpclient.methods.RequestEntity with value ... The complete Stack Trace : Exchange[ExchangePattern:InOnly  BodyType:String  Body:  CaughtExceptionType:org.apache.camel.TypeConversionException  CaughtExceptionMessage:Error during type conversion from type: com.ecc.DamBean to the required type: org.apache.commons.httpclient.methods.RequestEntity with value com.ecc.DamBean@8811a59 due Error during type conversion from type: java.lang.String to the required type: org.apache.commons.httpclient.methods.RequestEntity with value due java.lang.NullPointerException  StackTrace:org.apache.camel.TypeConversionException: Error during type conversion from type: com.ecc.DamBean to the required type: org.apache.commons.httpclient.methods.RequestEntity with value com.ecc.DamBean@8811a59 due Error during type conversion from type: java.lang.String to the required type: org.apache.commons.httpclient.methods.RequestEntity with value due java.lang.NullPointerException at org.apache.camel.converter.jaxb.FallbackTypeConverter.convertTo(FallbackTypeConverter.java:98) at org.apache.camel.impl.converter.BaseTypeConverterRegistry.doConvertTo(BaseTypeConverterRegistry.java:289) at org.apache.camel.impl.converter.BaseTypeConverterRegistry.convertTo(BaseTypeConverterRegistry.java:111) at org.apache.camel.impl.MessageSupport.getBody(MessageSupport.java:72) at org.apache.camel.impl.MessageSupport.getBody(MessageSupport.java:47) at org.apache.camel.component.http.HttpProducer.createRequestEntity(HttpProducer.java:390) at org.apache.camel.component.http.HttpProducer.createMethod(HttpProducer.java:343) at org.apache.camel.component.http.HttpProducer.process(HttpProducer.java:91) at org.apache.camel.util.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:61) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.Enricher.process(Enricher.java:114) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:73) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:91) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:334) at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:220) at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:61) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.interceptor.DefaultChannel.process(DefaultChannel.java:303) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.Pipeline.process(Pipeline.java:148) at org.apache.camel.processor.Pipeline.process(Pipeline.java:80) at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:61) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.UnitOfWorkProcessor.processAsync(UnitOfWorkProcessor.java:150) at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:117) at org.apache.camel.processor.RouteInflightRepositoryProcessor.processNext(RouteInflightRepositoryProcessor.java:57) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:73) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.component.seda.SedaConsumer.sendToConsumers(SedaConsumer.java:275) at org.apache.camel.component.seda.SedaConsumer.doRun(SedaConsumer.java:185) at org.apache.camel.component.seda.SedaConsumer.run(SedaConsumer.java:139) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:909) at java.lang.Thread.run(Thread.java:662)Caused by: org.apache.camel.TypeConversionException: Error during type conversion from type: java.lang.String to the required type: org.apache.commons.httpclient.methods.RequestEntity with value due java.lang.NullPointerException at org.apache.camel.impl.converter.BaseTypeConverterRegistry.convertTo(BaseTypeConverterRegistry.java:126) at org.apache.camel.impl.converter.BaseTypeConverterRegistry.convertTo(BaseTypeConverterRegistry.java:98) at org.apache.camel.converter.jaxb.FallbackTypeConverter.marshall(FallbackTypeConverter.java:222) at org.apache.camel.converter.jaxb.FallbackTypeConverter.convertTo(FallbackTypeConverter.java:94) ... 44 moreCaused by: org.apache.camel.RuntimeCamelException: java.lang.NullPointerException at org.apache.camel.util.ObjectHelper.wrapRuntimeCamelException(ObjectHelper.java:1271) at org.apache.camel.util.ObjectHelper.invokeMethod(ObjectHelper.java:927) at org.apache.camel.impl.converter.StaticMethodTypeConverter.convertTo(StaticMethodTypeConverter.java:47) at org.apache.camel.impl.converter.BaseTypeConverterRegistry.doConvertTo(BaseTypeConverterRegistry.java:253) at org.apache.camel.impl.converter.BaseTypeConverterRegistry.convertTo(BaseTypeConverterRegistry.java:111) at org.apache.camel.impl.converter.BaseTypeConverterRegistry.convertTo(BaseTypeConverterRegistry.java:98) at org.apache.camel.converter.jaxb.FallbackTypeConverter.marshall(FallbackTypeConverter.java:222) at org.apache.camel.converter.jaxb.FallbackTypeConverter.convertTo(FallbackTypeConverter.java:94) at org.apache.camel.impl.converter.BaseTypeConverterRegistry.doConvertTo(BaseTypeConverterRegistry.java:289) at org.apache.camel.impl.converter.BaseTypeConverterRegistry.convertTo(BaseTypeConverterRegistry.java:111) at org.apache.camel.impl.MessageSupport.getBody(MessageSupport.java:72) at org.apache.camel.impl.MessageSupport.getBody(MessageSupport.java:47) at org.apache.camel.component.http.HttpProducer.createRequestEntity(HttpProducer.java:390) at org.apache.camel.component.http.HttpProducer.createMethod(HttpProducer.java:343) at org.apache.camel.component.http.HttpProducer.process(HttpProducer.java:91) at org.apache.camel.util.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:61) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.Enricher.process(Enricher.java:114) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:73) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:91) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:334) at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:220) at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:45) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.interceptor.DefaultChannel.process(DefaultChannel.java:303) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.Pipeline.process(Pipeline.java:117) at org.apache.camel.processor.Pipeline.process(Pipeline.java:80) at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:45) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.UnitOfWorkProcessor.processAsync(UnitOfWorkProcessor.java:150) at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:117) at org.apache.camel.processor.RouteInflightRepositoryProcessor.processNext(RouteInflightRepositoryProcessor.java:48) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:73) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.component.seda.SedaConsumer.sendToConsumers(SedaConsumer.java:275) at org.apache.camel.component.seda.SedaConsumer.doRun(SedaConsumer.java:183) at org.apache.camel.component.seda.SedaConsumer.run(SedaConsumer.java:139) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) ... 1 moreCaused by: java.lang.NullPointerException at org.apache.camel.component.http.RequestEntityConverter.toRequestEntity(RequestEntityConverter.java:51) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.camel.util.ObjectHelper.invokeMethod(ObjectHelper.java:923) ... 50 more],0,0
camel-netty - Producer should avoid blocking while waiting for connection,We should at most wait for the connection timeout to trigger.,0,0
camel-jms - JmsPollingConsumer use the constant fields from JmsTemplate for receiveNoWait etc,See nabblehttp://camel.465427.n5.nabble.com/JmsPollingConsumer-and-method-receiveNoWait-has-incorrect-timeout-value-tp5722817.html,0,0
SpringIntegrationConsumer should honor the 'inOut' instance variable by setting the MEP and sending back message headers,See http://camel.465427.n5.nabble.com/how-to-obtain-camel-smpp-submit-message-id-td5723868.html for details,0,0
SJMS component's pom.xml missing taskmanager package in camel.osgi.private.pkg,Hi I know it's not out in the wild yet but with this tiny patch SJMS is usable in my spike project.Sadly doesn't affect the number of passing/failing tests.The pom's &lt;camel.osgi.private.pkg&gt; section is missing an entry for the org.apache.camel.component.sjms.taskmanager package.thanks Caspar,0,0
Cache producer is not thread safe,from('direct:causeFailure') .split().body().parallelProcessing() .setHeader(CacheConstants.CACHE_OPERATION  constant(CacheConstants.CACHE_OPERATION_DELETEALL)) .to('cache://MyTestCache');  String[] body = new String[] { 'a'  'b' }; template.sendBody(body); net.sf.ehcache.ObjectExistsException: Cache MyTestCache already exists at net.sf.ehcache.CacheManager.addCacheNoCheck(CacheManager.java:1294) at net.sf.ehcache.CacheManager.addCache(CacheManager.java:1184) at org.apache.camel.component.cache.CacheEndpoint.initializeCache(CacheEndpoint.java:137) at org.apache.camel.component.cache.CacheProducer.process(CacheProducer.java:56) at org.apache.camel.util.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:61) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.SendProcessor$2.doInAsyncProducer(SendProcessor.java:122) at org.apache.camel.impl.ProducerCache.doInAsyncProducer(ProducerCache.java:298) at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:117) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:91) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:334) at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:220) at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:45) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.interceptor.DefaultChannel.process(DefaultChannel.java:303) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:334) at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:220) at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:45) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.UnitOfWorkProcessor.processAsync(UnitOfWorkProcessor.java:150) at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:117) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:99) at org.apache.camel.processor.MulticastProcessor.doProcessParallel(MulticastProcessor.java:709) at org.apache.camel.processor.MulticastProcessor.access$200(MulticastProcessor.java:80) at org.apache.camel.processor.MulticastProcessor$1.call(MulticastProcessor.java:290) at org.apache.camel.processor.MulticastProcessor$1.call(MulticastProcessor.java:275) at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334) at java.util.concurrent.FutureTask.run(FutureTask.java:166) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603) at java.lang.Thread.run(Thread.java:722),0,0
Dead Letter Channel - Store failed route id on Exchange,Seehttp://camel.465427.n5.nabble.com/Retrieve-failed-Route-from-deadLetterChannel-tp5725420.htmlWe should store the route id where we failed  this allows end users to get that as a detail if they route to another route as part of DLC. You can get the current route  but if you let DLC be a route  then its that route you get  and not the route that failed.So we need to store this as part of the RedeliveryErrorHandler logic inside camel-core.We do have failed endpoint store already. eg if it failed sending a message to an endpoint. But we lack the route id.,0,0
ClassNotFoundException: weblogic.jndi.WLInitialContextFactory when starting the route via Karaf start-route(camel:route-start) command.,We have a simple camel route definied in Java DSL:from('wmq:queue:ESB_TEST_IN').routeId('IN').autoStartup(true).log('${body}');This route receives JMS messages from a WebLogicJMS queue with name ESB_TEST_IN and logs the body to the log file.The route works fine when autoStartup is set to true. But when autoStartup is set to false then the creation of the WebLogic InitialContext failed because of an ClassNotFoundException regarding weblogic.jndi.WLInitialContextFactory and the following message is written to the karaf log file:2012-12-07 12:03:21 502 WARN : DefaultJmsMessageListenerContainer | Setup of JMS message listener invoker failed for destination 'ESB_TEST_IN' - trying to recover. Cause: Destination &#91;ESB_TEST_IN&#93; not found in JNDI; nested exception is javax.naming.NoInitialContextException: Cannot instantiate class: weblogic.jndi.WLInitialContextFactory &#91;Root exception is java.lang.ClassNotFoundException: weblogic.jndi.WLInitialContextFactory&#93; [org.springframework.jms.listener.DefaultMessageListenerContainer | mer&#91;ESB_TEST_IN&#93; | org.springframework.jms.3.0.7.RELEASE(id=135)]This issue's related to https://jira.talendforge.org/browse/TESB-7884,0,0
OsgiServiceRegistry to lookup services with filter on name=blah,OsgiServiceRegistry to lookup services with filter on name=blahWhen using the # bean resolver prefix in plain OSGi (not blueprint) the only way to lookup a service is by specifying the full registered class/interface name of that service.The OsgiServiceRegistry should also try and lookup a service like the OsgiComponentResolver does using a filter on a service property. I suggest that the filter be on a property called 'name'.This means the method public &lt;T&gt; T lookup(String name  Class&lt;T&gt; type) should try to lookup the service with the class from the type parameter and filter on '(name=' + name ')'...,0,0
Using annotations DSL in beans may cause async callback to be called twice,The bean processor and bean invocation logic may in cases when the EIP annotations is used on beans  cause the callback to be called twice.Noticed this problem during investigation of See CAMEL-5905,0,0
CamelJob implementation rely on some inconsistent endpoints LRU cache - Camel endpoints may not be called on quartz fire after some days of uptime,CamelJobs rely on some endpoints LRU cache from camel context. If i'm not wrong  since LRU Cache relies on SoftReferences  Garbage Collector can decide to evict some entries and especially QuartzEndpoints.It happens that sometimes endpoints evicted from LRU Caches are QuartzEndpoints. Since QuartzEnpoints are searched from CamelJob in LRU cache  they are not reachable anymore.The side effect  is that CamelJob isntance initializes a new QuartzEndpoint  but loadbalancer is not initialized since it is initialized from QuartzConsumer.The result is that quartz triggers jobs that instanciate Quartz endpoints with unintialized load balancers which are unable to call processor from the routes associated.I have joined a fix that rely on the search of QuartzEndpoints from initalized routes of Camel context.Fundamentally  the search of endpoints should not rely on endpoints LRU cache. It is a broken design.Hope it helps.By the way  there are other issues related to QuartzEndpoint load balancer initalization: If quartz starts before startup of Camel routes you will have the same issue: Correctly initialized QuartzEndpoints are not in LRU cache since Camel has not started routes (and so endpoints and consumers). Quartz will trigger job  and camel job will search for QuartzEndpoint and put it in LRUCache with uninitialized load balancer.,0,1
RestletComponent component is not removing added route from routers list although route is removed from Context.,In RestletComponent class add entry to instance variable 'private final Map&lt;String  MethodBasedRouter&gt; routers = new HashMap&lt;String  MethodBasedRouter&gt;()' map while invoking getMethodRouter method  but it never remove in disconnect method  also disconnect method has local variable with same name as instance variable 'routes'.Camel Development Forums=========================http://camel.465427.n5.nabble.com/Camel-Restlet-2-10-3-RestletComponent-component-does-not-remove-added-route-form-routers-although-ro-td5726000.html,0,0
Add PGP signature and signature verification support to PGPDataFormat,PGPDataFormat currently supports PGP encryption (equivalent to 'gpg -e') and decryption (equivalent to 'gpg -d')  but does not support simultaneously encrypting and signing (equivalent to 'gpg -e -s') or simultaneously decrypting and verifying (equivalent to 'gpg -v -d').This patch adds three new optional attributes to the PGPDataFormat class (signatureKeyUserid  signatureKeyFileName  signaturePassword)  which can be used to sign while encrypting  or to verify a signature while decrypting.,1,0
NoRedeliveryOnShutdown doesn't work for DeadLetterChannel,See http://camel.465427.n5.nabble.com/Wrong-test-for-allowRedeliveryWhileStopping-possible-bug-td5726184.html for details.The assumption is if we use 'allowRedeliveryWhileStopping(false)' in an error handler definition which use a dead letter channel  the message should be send to the configured dead letter channel if we are in a delivery by stopping Camel (instead of dropping the message).,0,0
camel-bindy fixed length record improvements,The attached patch provides the following improvements for the camel-bindy fixed length record data format: full support for fixed-length header and footer records allows delimited (variable length) fields to be defined within 'fixed-length' records enables the length of a data field to be defined dynamically by another field in the same record fixed-length records can be defined using ordinal / relative pos valuesNew annotation properties:------------------@DataField + lengthPos (int) &#8211; Optionally identifies a data field in the record that defines the fixed length for this field + delimiter (String) &#8211; Optional delimiter to be used if this field has a variable length@FixedLengthRecord + hasHeader (boolean) &#8211; Indicates that the record(s) of this type may be preceded by a single header record at the beginning of the file / stream + hasFooter (boolean) &#8211; Indicates that the record(s) of this type may be followed by a single footer record at the end of the file / stream + skipHeader (boolean) &#8211; Configures the data format to skip marshalling / unmarshalling of the header record + skipFooter (boolean) &#8211; Configures the data format to skip marshalling / unmarshalling of the footer record + isHeader (boolean) &#8211; Identifies this FixedLengthRecord as a header record + isFooter (boolean) &#8211; Identifies this FixedLengthRecord as a footer record,0,0
Improve the BeanInfo performance,See http://camel.465427.n5.nabble.com/BeanInfo-performance-issues-td5726912.html for details.,0,1
Camel Email Component Missing Attachments,see http://camel.465427.n5.nabble.com/Camel-Email-Component-Missing-Attachments-td3386382.html#a5727102The disposition field is optional(see RFC 2183)  so it is possible that camel misses attachments. if (disposition != null &amp;&amp; (disposition.equalsIgnoreCase(Part.ATTACHMENT) || disposition.equalsIgnoreCase(Part.INLINE))) { // only add named attachments String fileName = part.getFileName(); if (fileName != null) { LOG.debug('Mail contains file attachment: ' + fileName); // Parts marked with a disposition of Part.ATTACHMENT are clearly attachments CollectionHelper.appendValue(map  fileName  part.getDataHandler()); } }Adding the fileName check to the if should resolve the issue.,0,0
Camel Spring registry does not look into parent contexts,trunk components/camel-spring/src/main/java/org/apache/camel/spring/spi/ApplicationContextRegistry.javahas next method: @Override public &lt;T&gt; Map&lt;String  T&gt; findByTypeWithName(Class&lt;T&gt; type) { return applicationContext.getBeansOfType(type); }but this method does not look into application context parent contexts.org.springframework.beans.factory.BeanFactoryUtils#beansOfTypeIncludingAncestors should be used instead.,0,0
camel-rss and camel-atom - Not installable in Karaf,karaf@root&gt; features:install camel-rssError executing command: Manifest not present in the first entry of the zip mvn:org.apache.ws.commons.axiom/axiom-impl/1.2.14I think we got a JAR that is flawed 1.2.14,0,0
Check if body is a MimeMessage and send it directly without create a MimeMessage from body and headers,In a route with a component which create a MimeMessage and set it in body  the mail producer ignores the type of body and create his own MimeMessage from body content and headers.The patch add the control of type and disable the override of MailProducer with his own message.The MimeMessage contained in body is sent directly.Patch contains test and fix,0,0
CamelBlueprintContext may be wrongly started and this may lead to a deadlock,We observed a deadlock situation that seems to be caused by the change that came in with CAMEL-5712  which changed the way how CamelBlueprintContext is started to solve another issue.The current code listens to the service registered event for org.osgi....BlueprintContainer (supposedly for its associated BP container) and decides to start itself if not started. From the description of the ticket  this change was intended to make sure the starting of the context occurs after its BP container is registered. In that case  should it be checking whether the received event belongs to the same bundle? This checking is missing in the current code and consequently  it may wrongly react to the event from another bundle's container registration event. When this happens under some specific timing situation  it may also lead to a deadlock.So  should we be checking the event source in CamelBlueprintContext's serviceChanged method?Regards  akiStack trace from 2.10.3========================================================================Name: Blueprint Extender: 3State: BLOCKED on java.lang.Object@9064b42 owned by: Blueprint Extender: 2Total blocked: 13 Total waited: 38Stack trace: org.apache.aries.blueprint.container.BlueprintRepository.createInstances(BlueprintRepository.java:212)org.apache.aries.blueprint.container.BlueprintRepository.createInstance(BlueprintRepository.java:198)org.apache.aries.blueprint.container.BlueprintRepository.create(BlueprintRepository.java:137)org.apache.aries.blueprint.container.BlueprintContainerImpl.getComponentInstance(BlueprintContainerImpl.java:709)org.apache.camel.blueprint.BlueprintContainerRegistry.lookup(BlueprintContainerRegistry.java:41)org.apache.camel.impl.CompositeRegistry.lookup(CompositeRegistry.java:68)org.apache.camel.impl.PropertyPlaceholderDelegateRegistry.lookup(PropertyPlaceholderDelegateRegistry.java:49)org.apache.camel.blueprint.BlueprintComponentResolver.resolveComponent(BlueprintComponentResolver.java:39)org.apache.camel.impl.DefaultCamelContext.getComponent(DefaultCamelContext.java:314) locked java.util.HashMap@1660de94org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:456)org.apache.camel.util.CamelContextHelper.getMandatoryEndpoint(CamelContextHelper.java:50)org.apache.camel.model.RouteDefinition.resolveEndpoint(RouteDefinition.java:186)org.apache.camel.impl.DefaultRouteContext.resolveEndpoint(DefaultRouteContext.java:108)org.apache.camel.impl.DefaultRouteContext.resolveEndpoint(DefaultRouteContext.java:114)org.apache.camel.model.FromDefinition.resolveEndpoint(FromDefinition.java:72)org.apache.camel.impl.DefaultRouteContext.getEndpoint(DefaultRouteContext.java:90)org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:851)org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:171)org.apache.camel.impl.DefaultCamelContext.startRoute(DefaultCamelContext.java:722)org.apache.camel.impl.DefaultCamelContext.startRouteDefinitions(DefaultCamelContext.java:1789)org.apache.camel.impl.DefaultCamelContext.doStartCamel(DefaultCamelContext.java:1575)org.apache.camel.impl.DefaultCamelContext.doStart(DefaultCamelContext.java:1444) locked org.apache.camel.blueprint.BlueprintCamelContext@5011bafaorg.apache.camel.support.ServiceSupport.start(ServiceSupport.java:60)org.apache.camel.impl.DefaultCamelContext.start(DefaultCamelContext.java:1412)org.apache.camel.blueprint.BlueprintCamelContext.maybeStart(BlueprintCamelContext.java:127)org.apache.camel.blueprint.BlueprintCamelContext.serviceChanged(BlueprintCamelContext.java:96)org.eclipse.osgi.internal.serviceregistry.FilteredServiceListener.serviceChanged(FilteredServiceListener.java:104)org.eclipse.osgi.framework.internal.core.BundleContextImpl.dispatchEvent(BundleContextImpl.java:861)org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent(EventManager.java:230)org.eclipse.osgi.framework.eventmgr.ListenerQueue.dispatchEventSynchronous(ListenerQueue.java:148)org.eclipse.osgi.internal.serviceregistry.ServiceRegistry.publishServiceEventPrivileged(ServiceRegistry.java:819)org.eclipse.osgi.internal.serviceregistry.ServiceRegistry.publishServiceEvent(ServiceRegistry.java:771)org.eclipse.osgi.internal.serviceregistry.ServiceRegistrationImpl.register(ServiceRegistrationImpl.java:130)org.eclipse.osgi.internal.serviceregistry.ServiceRegistry.registerService(ServiceRegistry.java:214)org.eclipse.osgi.framework.internal.core.BundleContextImpl.registerService(BundleContextImpl.java:433)org.apache.aries.blueprint.container.BlueprintContainerImpl.registerService(BlueprintContainerImpl.java:410)org.apache.aries.blueprint.container.BlueprintContainerImpl.doRun(BlueprintContainerImpl.java:346)org.apache.aries.blueprint.container.BlueprintContainerImpl.run(BlueprintContainerImpl.java:230) locked java.util.concurrent.atomic.AtomicBoolean@3cb3ada locked java.util.concurrent.atomic.AtomicBoolean@31b4d206java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)java.util.concurrent.FutureTask.run(FutureTask.java:138)java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:98)java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:206)java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)java.lang.Thread.run(Thread.java:722)========================================================================Name: Blueprint Extender: 2State: BLOCKED onorg.apache.camel.blueprint.BlueprintCamelContext@5011bafa owned by: Blueprint Extender: 3Total blocked: 24 Total waited: 58Stack trace: org.apache.camel.impl.DefaultCamelContext.getTypeConverter(DefaultCamelContext.java:1053)org.apache.camel.util.EndpointHelper.setProperties(EndpointHelper.java:249)org.apache.camel.impl.DefaultComponent.setProperties(DefaultComponent.java:222)org.apache.camel.component.file.GenericFileComponent.createEndpoint(GenericFileComponent.java:64)org.apache.camel.component.file.GenericFileComponent.createEndpoint(GenericFileComponent.java:36)org.apache.camel.impl.DefaultComponent.createEndpoint(DefaultComponent.java:91)org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:461)org.apache.camel.core.xml.AbstractCamelEndpointFactoryBean.getObject(AbstractCamelEndpointFactoryBean.java:46)sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)java.lang.reflect.Method.invoke(Method.java:597)org.apache.aries.blueprint.utils.ReflectionUtils.invoke(ReflectionUtils.java:226)org.apache.aries.blueprint.container.BeanRecipe.invoke(BeanRecipe.java:824)org.apache.aries.blueprint.container.BeanRecipe.getInstance(BeanRecipe.java:234)org.apache.aries.blueprint.container.BeanRecipe.internalCreate(BeanRecipe.java:706)org.apache.aries.blueprint.di.AbstractRecipe.create(AbstractRecipe.java:64) locked java.lang.Object@9064b42org.apache.aries.blueprint.container.BlueprintRepository.createInstances(BlueprintRepository.java:219) locked java.lang.Object@9064b42org.apache.aries.blueprint.container.BlueprintRepository.createAll(BlueprintRepository.java:147)org.apache.aries.blueprint.container.BlueprintContainerImpl.instantiateEagerComponents(BlueprintContainerImpl.java:631)org.apache.aries.blueprint.container.BlueprintContainerImpl.doRun(BlueprintContainerImpl.java:337)org.apache.aries.blueprint.container.BlueprintContainerImpl.run(BlueprintContainerImpl.java:230) locked java.util.concurrent.atomic.AtomicBoolean@53b00227 locked java.util.concurrent.atomic.AtomicBoolean@5648a168java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)java.util.concurrent.FutureTask.run(FutureTask.java:138)java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:98)java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:206)java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)java.lang.Thread.run(Thread.java:722),0,1
SOAP over JMS does not work with camel-cxf endpoint,If we would like to use SOAP over JMS using CXF &amp; Camel (2.10) that fails.The CXF endpoint receives well the incoming request from the JMS queue[aultMessageListenerContainer-1] HelloWorldServicePortType INFO Inbound Message----------------------------ID: 1Content-Type: text/xmlHeaders: {JMSMessageType=[text]}Payload: &lt;soapenv:Envelope xmlns:soapenv='http://schemas.xmlsoap.org/soap/envelope/' xmlns:hel='http://helloworld.mycompany.redhat.com'&gt; &lt;soapenv:Header/&gt; &lt;soapenv:Body&gt; &lt;hel:sayHello&gt; &lt;hel:name&gt;fred&lt;/hel:name&gt; &lt;/hel:sayHello&gt; &lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;--------------------------------------[aultMessageListenerContainer-1] route1 INFO SOAP Request received message[aultMessageListenerContainer-1] route1 INFO Mock service repliedbut the response is not returned by CXF neither published in a (reply) queue.Here is the Camel Route @Override public void configure() throws Exception {from('cxf:bean:endpoint.service.worklist?dataFormat=MESSAGE') .convertBodyTo(String.class) .log('SOAP Request received message').setHeader('JMSReplyTo').constant('supervisorworklist.response') .transform().constant(response) // RESPONSE = SOAP MESSAGE .log('Mock service replied'); }&amp; Config&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;beans xmlns='http://www.springframework.org/schema/beans' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:camel='http://camel.apache.org/schema/spring' xmlns:osgi='http://www.springframework.org/schema/osgi' xmlns:cxf='http://camel.apache.org/schema/cxf' xmlns:jms='http://cxf.apache.org/transports/jms' xsi:schemaLocation=' http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/osgi http://www.springframework.org/schema/osgi/spring-osgi.xsd http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/camel-cxf-2.10.0-spring.xsd http://cxf.apache.org/transports/jms http://cxf.apache.org/schemas/configuration/jms.xsd'&gt; &lt;bean id='jms.connectionFactory' class='org.apache.activemq.ActiveMQConnectionFactory'&gt; &lt;!-- &lt;property name='brokerURL' value='vm://myEmbeddedBroker?broker.persistent=false' /&gt;--&gt; &lt;property name='brokerURL' value='tcp://localhost:61616'/&gt; &lt;/bean&gt; &lt;bean id='jms.config.service' class='org.apache.cxf.transport.jms.JMSConfiguration'&gt; &lt;property name='connectionFactory' ref='jms.connectionFactory' /&gt; &lt;property name='targetDestination' value='supervisorworklist' /&gt; &lt;property name='replyDestination' value='supervisorworklist.response'/&gt; &lt;/bean&gt; &lt;bean id='logginOutInterceptor' class='org.apache.cxf.interceptor.LoggingOutInterceptor'/&gt; &lt;bean id='logginInInterceptor' class='org.apache.cxf.interceptor.LoggingInInterceptor'/&gt; &lt;!-- Producer Endpoint --&gt; &lt;cxf:cxfEndpoint id='endpoint.service.worklist' address='jms://'serviceClass='com.redhat.mycompany.helloworld.HelloWorldService' serviceName='s:HelloWorldService' endpointName='s:HelloWorldOverJms' xmlns:s='http://helloworld.atos.redhat.com'&gt; &lt;cxf:features&gt; &lt;bean xmlns='http://www.springframework.org/schema/beans'class='org.apache.cxf.transport.jms.JMSConfigFeature'&gt; &lt;property name='jmsConfig' ref='jms.config.service' /&gt; &lt;/bean&gt; &lt;/cxf:features&gt; &lt;cxf:inInterceptors&gt; &lt;ref bean='logginInInterceptor'/&gt; &lt;/cxf:inInterceptors&gt; &lt;cxf:outInterceptors&gt; &lt;ref bean='logginOutInterceptor'/&gt; &lt;/cxf:outInterceptors&gt; &lt;/cxf:cxfEndpoint&gt; &lt;camelContext xmlns='http://camel.apache.org/schema/spring'&gt; &lt;package&gt;com.redhat.mycompany.cxf&lt;/package&gt; &lt;/camelContext&gt;&lt;/beans&gt;,0,0
CXFEndpoint blueprint config having binding element may lead to NPE,There seems to be an error in the EndpointpointDefinitionParser in parsing the binding element. Concretely speaking  that element is not parsed from the right element but wrongly from its parent element.So  when you have something like &lt;camel-cxf:cxfEndpoint id='routerEndpoint' ...&gt; ... &lt;camel-cxf:binding&gt; &lt;soap:soapBinding mtomEnabled='true' version='1.2'/&gt; &lt;/camel-cxf:binding&gt; &lt;/camel-cxf:cxfEndpoint&gt;you may get an NPE  as shown in:java.lang.NullPointerException: null at org.apache.aries.blueprint.container.RecipeBuilder.getValue(RecipeBuilder.java:335) ~&#91;na:na&#93; at org.apache.aries.blueprint.container.RecipeBuilder.createBeanRecipe(RecipeBuilder.java:258) ~&#91;na:na&#93; at org.apache.aries.blueprint.container.RecipeBuilder.createRecipe(RecipeBuilder.java:106) ~&#91;na:na&#93; at org.apache.aries.blueprint.container.RecipeBuilder.createRepository(RecipeBuilder.java:89) ~&#91;na:na&#93; at org.apache.aries.blueprint.container.BlueprintContainerImpl.getRepository(BlueprintContainerImpl.java:438) ~&#91;na:na&#93; at org.apache.aries.blueprint.container.BlueprintContainerImpl.doRun(BlueprintContainerImpl.java:288) ~&#91;na:na&#93; at org.apache.aries.blueprint.container.BlueprintContainerImpl.run(BlueprintContainerImpl.java:230) ~[na:naFixing this line in EndpointDefinitionParser will fix this issue.,0,0
Improvement to SqlProducer class,I have came across a bug with the Microsoft SQL Server driver (4.0) in where the folowing line is problematic:int expected = ps.getParameterMetaData().getParameterCount();If I run the following query through the component:INSERT INTO &#91;NEW_TABLE&#93; SELECT * FROM &#91;OLD_TABLE&#93; WHERE ID = #expected is set to 0 which results in my value not being set.Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: The value is not set for the parameter number 1.While this is a SQL Server issue  unfortunately the source is not available and an update is not likely any time soon to return the correct meta data. It would be handy if this Producer put the query preperation a little more into the hands of the user. I.e. let me say there are 5 parameters to be prepared along with the 5 values to use.If the user has manually put 5 items in a Map in the body  then can we not just use the map length to identify how many values and then iterate them.,0,0
Race condition in AggregatorProcessor recovery sometimes causes duplicates,There seems to be a race condition in org.apache.camel.processor.aggregate.AggregateProcessor's RecoverTask. That task calls recoverable.scan() to find Exchanges that may need to be recovered. Since scan() might return Exchanges that are actually just in progress  the RecoverTask then checks to see if the Exchange really is in progress. It does this by calling inProgressCompleteExchanges.contains(exchangeId). However  that collection may have been modified during the time between when scan() returned and when contains() is called. This would happen if the in-progress Exchange completes before contains() is called. In that situation  inProgress would evaluate to false  so the Exchange would be recovered. This results in a duplicate Exchange being output by the Aggregator component. One possible solution might be to prevent updating the inProgressCompleteExchanges during the critical section. Another possible solution might be to copy inProgressCompleteExchanges before calling scan(). I'm sure that there are other ways to deal with this also.,0,1
step in a  block runs when the  tag is closed in the wrong place,Example route:&lt;doTry&gt; &lt;to ... &gt;&lt;/doTry&gt;&lt;doCatch&gt; &lt;exception&gt;java.lang.Exception&lt;/exception&gt; &lt;to uri='log.... '/&gt;&lt;/doCatch&gt;The &lt;to uri='log...'/&gt; line will execute every time  regardless if there is an exception or not.I believe the preferred behavior would be that the route should fails to load/validate. Alternatively  the &lt;to uri='log..' /&gt; should not run when there is not an exception.Thanks!,0,0
camel-jms: InOut exchange can time out even if response was received,When performing an InOut JMS exchange with a certain requestTimeout  if the reply message is received in time  but the following formula stands true: T0 + T1 &gt;= T!  where:T0 = JMS response timeT1 = remaining route processing time following the replyT! = requestTimeoutThen camel-jms will throw an ExchangeTimedOutException regardless of the fact that the reply was truly received in time.I'm surprised this bug has gone unnoticed until now  as it's been present since mid-2010.Example unit test: @Test public void testTimeoutNotTriggered() throws Exception { getMockEndpoint('mock:exception').expectedMessageCount(0); template.requestBody('activemq:test'  '&lt;hello /&gt;'); assertMockEndpointsSatisfied(); } @Override protected RouteBuilder createRouteBuilder() throws Exception { return new RouteBuilder() { @Override public void configure() throws Exception { onException(ExchangeTimedOutException.class) .handled(true) .to('mock:exception'); from('activemq:test') .inOut('activemq:test?requestTimeout=500') .delay(constant(1000)); from('activemq:test') .log('test'); } }; },0,0
Simple language - bean function - issue when parameter value has comma,See nabblehttp://camel.465427.n5.nabble.com/Prolems-with-parametrized-bean-method-call-via-simple-tp5728319.html,0,0
NPE when using the imap mail component with quartz or the timer and pollEnrich,There is a NPE when using the imap mail component with quartz or the timer and pollEnrich as dicussed here:http://camel.465427.n5.nabble.com/Schedule-file-mail-endpoint-td3356666.html#a3357538I reproduced it on version 2.10.3 and 2.10.4 with &lt;route id='myTest'&gt; &lt;from uri='timer://foo?fixedRate=true&amp;period=10000'/&gt; &lt;pollEnrich uri='imap://userName@hostName?password=***'/&gt;  &lt;to uri='log:testroute?showAll=true&amp;level=INFO'/&gt; &lt;/route&gt;We need to use it with the quartz component (so we can use a cron expression)  but get the same error &lt;route id='myTest'&gt; &lt;from uri='quartz://testTimer?cron=0+?'/&gt; &lt;pollEnrich uri='imap://userName@hostName?password=***'/&gt;  &lt;to uri='log:testroute?showAll=true&amp;level=INFO'/&gt; &lt;/route&gt;11/03/2013 10:32:04 &#91;DefaultQuartzScheduler-context_Worker-1&#93; ERROR org.apache.camel.processor.DefaultErrorHandler - Failed delivery for (MessageId: ID-W7-009430-52415-1362994261595-0-3 on ExchangeId: ID-W7-009430-52415-1362994261595-0-2). Exhausted after delivery attempt: 1 caught: org.apache.camel.CamelExchangeException: Error occurred during aggregation. Exchange[Message: &#91;Body is null&#93;]. Caused by: [org.apache.camel.RuntimeCamelException - Failed to extract body due to: null. Exchange: Exchange&#91;MailMessage: com.sun.mail.imap.IMAPMessage@411a3fe4&#93;. Message: com.sun.mail.imap.IMAPMessage@411a3fe4]org.apache.camel.CamelExchangeException: Error occurred during aggregation. Exchange[Message: &#91;Body is null&#93;]. Caused by: [org.apache.camel.RuntimeCamelException - Failed to extract body due to: null. Exchange: Exchange&#91;MailMessage: com.sun.mail.imap.IMAPMessage@411a3fe4&#93;. Message: com.sun.mail.imap.IMAPMessage@411a3fe4] at org.apache.camel.processor.PollEnricher.process(PollEnricher.java:194)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.util.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:61)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:72)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:91)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:334)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:220)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:46)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.interceptor.DefaultChannel.process(DefaultChannel.java:308)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.Pipeline.process(Pipeline.java:117)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.Pipeline.process(Pipeline.java:80)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:46)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.UnitOfWorkProcessor.processAsync(UnitOfWorkProcessor.java:150)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:117)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.RouteInflightRepositoryProcessor.processNext(RouteInflightRepositoryProcessor.java:48)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:72)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.loadbalancer.QueueLoadBalancer.process(QueueLoadBalancer.java:44)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:99)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.processor.loadbalancer.QueueLoadBalancer.process(QueueLoadBalancer.java:71)&#91;camel-core-2.10.4.jar:2.10.4&#93; at org.apache.camel.component.quartz.QuartzEndpoint.onJobExecute(QuartzEndpoint.java:113)&#91;camel-quartz-2.10.4.jar:2.10.4&#93; at org.apache.camel.component.quartz.CamelJob.execute(CamelJob.java:61)&#91;camel-quartz-2.10.4.jar:2.10.4&#93; at org.quartz.core.JobRunShell.run(JobRunShell.java:216)&#91;quartz-1.8.5.jar:&#93; at org.quartz.simpl.SimpleThreadPool$WorkerThread.run(SimpleThreadPool.java:549)&#91;quartz-1.8.5.jar:&#93;,0,0
Camel stream producer never close the stream of file,When I was working on CAMEL-6147  I found the file stream is never closed  even it met the close condition.,0,1
SQL component will not look for parameters in header when no body in message,Line 60 in SqlProducer checks if the body is null. This will cause any parameters in header fields not to be populated into the prepared statement. Sample scenario is with a camel-jetty enriching a response using camel-sql.,0,0
Aggregate EIP - Completion from batch consumer should trigger first,See nabblehttp://camel.465427.n5.nabble.com/Issue-Aggregator2-BatchCompletion-disturbed-by-other-completions-and-fails-to-happen-when-it-probabl-tp5728850.html,0,0
camel-http - When bridging endpoints then there may be double parameter values if client sends uri parameters,If you have a jetty/http bridge endpoint  and the caller sends in a parameter with a value that has url encodings  then you may have double values when calling the bridge.eg callinghttp://localhost:23001/jettyTestRouteA?param1=%2B447777111222And having a jetty -&gt; http bridge  you can end up with double values.Caused by: java.lang.AssertionError: expected:&lt; 447777111222&gt; but was:&lt;[+447777111222  +447777111222]&gt;,0,0
Camel 2.10.1 incapable of working with + in endpoint URIs,In the class org.apache.camel.util.URISupport which will be used to resolve endpoints (DefaultCamelContext#normalizeEndpointUri) the method parseParameters will be called.At first the java.net.Uri#getQuery will be called with according to the javadoc 'Returns the decoded query component of this URI' returns a decoded URI. If that fails the java.net.Uri#getSchemeSpecificPart method will be called which according to the javadoc 'Returns the decoded scheme-specific part of this URI.' returns a decoded URI.So to summarize we get in any case a decoded URI.As workaround for CAMEL-4954 all % are encoded  i.e. replaced by %25.The URI will then be decoded again in the method org.apache.camel.util.URISupport#parseQuery(String) with java.net.URLDecoder#decode(String String).This code leads to the following behaviour: If a + is properly encoded with foo%2Bbar the foo%2Bbar will be substituted by the first call with foo+bar and then decoded again which leads to foo bar. If the + is not encoded at all foo+bar will be decoded to foo bar in the first step and not be changed again in the second step. If the + is double encoded to foo%252Bbar the first call will transform it to foo%2Bbar  then the workaround for CAMEL-4954 will change it back to foo%252Bbar and the final decode will change it again to foo%2Bbar.Thus  currently there is no way to use a + in passwords or similar parameter values if the parameter has to be supplied via endpoint URIs.,1,0
Camel-AWS should support any implementation of AmazonXXX (not only AmazonXXXClient),See http://camel.465427.n5.nabble.com/camel-pull-request-making-change-so-that-we-can-use-camel-aws-integration-td5729038.html,0,0
http4 component should default to charset based on content type,HttpProducer determines the charset of an outgoing StringEntity based on an Exchange property (Exchange.CHARSET_NAME)  using null if that property is not set. It also sets the content-type based on the content-type of the camel message (this may also contain a character encoding). If these two don't match the receiver of the http request will probably not be able to parse the message. It would be better if the charset of the StringEntity would by default match the charset specified in the content-type. Matching these two is done when receiving response messages (in HttpProducer.extractResponseBody())...Suggested fix (in HttpProducer.createRequestEntity())  you could of course also do something like org.apache.camel.component.http4.helper.HttpHelper.setCharsetFromContentType() but my approach uses org.apache.http.entity.ContentType and java.nio.charset.Charset instead of trying to determine the correct charset itself):// be a bit careful with String as any type can most likely be converted to String// so we only do an instanceof check and accept String if the body is really a String// do not fallback to use the default charset as it can influence the request// (for example application/x-www-form-urlencoded forms being sent)String charset = IOHelper.getCharsetName(exchange  false);if (charset == null &amp;&amp; contentType != null){ ContentType ct = ContentType.parse(contentType); if (ct != null) { Charset cs = ct.getCharset(); if (cs != null) { charset = cs.name(); } }}StringEntity entity = new StringEntity((String) data  charset);entity.setContentType(contentType);answer = entity;,0,0
TransferExchage InOut ActiveMQ Exception,The scnearios are : when using the transferExchange option only on the producer  I don't get the body back  but not the header. When I use the transferExchange option on both producer and consumer  I get the headers back  but not the body. And instead I get the following exception[ryQueueReplyManager[temporary]] TemporaryQueueReplyManager WARN Execution of JMS message listener failed. Caused by: [java.lang.NullPointerException - null]java.lang.NullPointerException at org.apache.camel.impl.DefaultExchangeHolder.unmarshal(DefaultExchangeHolder.java:107) at org.apache.camel.component.jms.JmsBinding.extractBodyFromJms(JmsBinding.java:128) at org.apache.camel.component.jms.JmsMessage.createBody(JmsMessage.java:214) at org.apache.camel.impl.MessageSupport.getBody(MessageSupport.java:41) at org.apache.camel.component.jms.reply.ReplyManagerSupport.processReply(ReplyManagerSupport.java:136) at org.apache.camel.component.jms.reply.TemporaryQueueReplyHandler.onReply(TemporaryQueueReplyHandler.java:54) at org.apache.camel.component.jms.reply.TemporaryQueueReplyManager.handleReplyMessage(TemporaryQueueReplyManager.java:71) at org.apache.camel.component.jms.reply.ReplyManagerSupport.onMessage(ReplyManagerSupport.java:113) at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:560) at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:498) at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:467) at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325) at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263) at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1058) at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1050) at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:947) at java.lang.Thread.run(Thread.java:662),0,0
json data format - Add support for configuring gson options,Seehttp://stackoverflow.com/questions/15686032/apache-camel-gson-formatterWe should make it possible to configure those gson options in the DSL.,0,0
camel-bindy - Multiple models in the same package lead to unpredictable results,BindyCsvDataFormat only holds one model. When multiple models are defined in the same package or field positions overlap  only one @DataField is kept (the last one) overwriting the previous mapping. This leads to unpredictable behavior  from the wrong field value being populated  to format mismatch exceptions for fields of different types.This behavior is by design  as camel supports deep models  spread over multiple files (see AnnotationModelLoader.loadModels() implementation where whole packages are scanned).The documentation is rather vague  but I believe supporting multiple models in the same package is not really feasible  and overkill at best. Therefore my preference would be to keep the functionality as is and document the limitation.Currently the BindyCVSFieldEndingWithSeparatorIssueTest fails due to a conflict between MyCsvRecord.class and BindyDoubleQuotesCsvUnmarshallTest.Order.class defined in the same package. Moving MyCsvRecord to a different package is a trivial fix. I will look into adding some model validation as well to WARN if the model is inconsistent (i.e. has overlaps or gaps).,0,0
Http4 component does not support PATCH,If I try to use PATCH  it gives me an error about it not being in an enum. However  the HttpClient does support it.http://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/methods/HttpPatch.html,0,0
camel:run in blueprint is broken,Due the Aries blueprint upgrade then the blueprint extenders may run 2+ due classpath issues.,0,0
camel-aws - Possible concurrent modification exception,Noticed this from CI test serversStacktracejava.util.ConcurrentModificationException at java.util.ArrayList$Itr.checkForComodification(ArrayList.java:819) at java.util.ArrayList$Itr.next(ArrayList.java:791) at org.apache.camel.component.aws.sqs.SqsExtendMessageVisibilityTest.longReceiveExtendsMessageVisibility(SqsExtendMessageVisibilityTest.java:61) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42) at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20) at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:30) at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:47) at org.junit.rules.RunRules.evaluate(RunRules.java:18) at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:263) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:68) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:47) at org.junit.runners.ParentRunner$3.run(ParentRunner.java:231) at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:60) at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:229) at org.junit.runners.ParentRunner.access$000(ParentRunner.java:50) at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:222) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:30) at org.junit.runners.ParentRunner.run(ParentRunner.java:300) at org.apache.maven.surefire.junit4.JUnit4TestSet.execute(JUnit4TestSet.java:53) at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:119) at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:101) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at org.apache.maven.surefire.booter.ProviderFactory$ClassLoaderProxy.invoke(ProviderFactory.java:103) at com.sun.proxy.$Proxy0.invoke(Unknown Source) at org.apache.maven.surefire.booter.SurefireStarter.invokeProvider(SurefireStarter.java:150) at org.apache.maven.surefire.booter.SurefireStarter.runSuitesInProcess(SurefireStarter.java:91) at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:69)Standard Output@SLTests run: 1  Failures: 0  Errors: 0  Skipped: 0  Time elapsed: 2.032 sec@SLRunning org.apache.camel.component.aws.sqs.SqsExtendMessageVisibilityTest,0,0
Sql component - Add noop option to execute the query but dont change the message body afterwards,Seehttp://blog.mgm-tp.com/2013/04/camel-router-part1/comment-page-1/#comment-4161Even if the query returns a result set  you may not want to grab that or change the message body.For that we can have a noop=true|false option. If there is a better name for the option then we can go for that  though noop was the first name that came to my mind.,0,0
Scheduled thread pools is not removed from JMX when shutting down,For example if a route use the aggragate eip with a completion timeout  then the scheduled thread pool is enlisted in JMX. But not removed when the route is removed. Though as fail-safe we always remove the JMX when camel is stopping.But for people doing dynamic add/remove routes this can become a problem.,0,1
Simple ognl expression - Possible NPE when using String replaceFirst and replacing with an empty string,See nabblehttp://camel.465427.n5.nabble.com/2-11-NPE-with-replaceFirst-tp5730321.html,0,0
org.apache.camel.support.ServiceSupport: InputStream not being explicitly closed,In method getVersion() of ServiceSupport there is an InputStream opened around line 284:InputStream is = getClass().getResourceAsStream('/META-INF/maven/org.apache.camel/camel-core/pom.properties');This stream is not closed explicitly.If you undeploy an application from a container like GlassFish you get a warning like this:[#|2013-04-11T18:02:00.783+0200|WARNING|glassfish3.1.2|javax.enterprise.system.core.classloading.com.sun.enterprise.loader|_ThreadID=137;_ThreadName=Thread-2;|Input stream has been finalized or forced closed without being explicitly closed; stream instantiation reported in following stack tracejava.lang.Throwable at com.sun.enterprise.loader.ASURLClassLoader$SentinelInputStream.&lt;init&gt;(ASURLClassLoader.java:1230) at com.sun.enterprise.loader.ASURLClassLoader$InternalJarURLConnection.getInputStream(ASURLClassLoader.java:1338) at java.net.URLClassLoader.getResourceAsStream(URLClassLoader.java:233) at com.sun.enterprise.loader.ASURLClassLoader.getResourceAsStream(ASURLClassLoader.java:872) at java.lang.Class.getResourceAsStream(Class.java:2049) at org.apache.camel.support.ServiceSupport.getVersion(ServiceSupport.java:284) at org.apache.camel.impl.DefaultCamelContext.start(DefaultCamelContext.java:1439) at org.apache.camel.cdi.CdiCamelContext.start(CdiCamelContext.java:61) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&#91;...&#93;These were similar issues: XBEAN-190  JCR-2962,0,0
camel-cxfrs blueprint configure could not be installed if there are some subelement settings,Got the OOM Exception when blueprint want to parser the setting like this.&lt;camelcxf:rsClient id='rsClient' address='http://localhost:9002/rest' serviceClass='org.apache.camel.itest.osgi.cxf.jaxrs.testbean.CustomerService'&gt; &lt;camelcxf:features&gt; &lt;bean class='org.apache.cxf.feature.LoggingFeature'/&gt; &lt;/camelcxf:features&gt; &lt;/camelcxf:rsClient&gt;,0,0
camel-stream - Shutdown thread pool on consumer should happen faster,Should be faster to shutdown this pool as you may see WARN logs on stopping Camel[ Thread-1] DefaultShutdownStrategy INFO Starting to graceful shutdown 1 routes (timeout 300 seconds)el-1) thread #2 - ShutdownTask DefaultExecutorServiceManager INFO Waited 2.001 seconds for ExecutorService: org.apache.camel.util.concurrent.RejectableThreadPoolExecutor@48b4da9b&#91;Shutting down  pool size = 1  active threads = 1  queued tasks = 0  completed tasks = 0&#93;&#91;stream://in?promptMessage=Enter+something%3A+&#93; to terminate...el-1) thread #2 - ShutdownTask DefaultExecutorServiceManager INFO Waited 4.002 seconds for ExecutorService: org.apache.camel.util.concurrent.RejectableThreadPoolExecutor@48b4da9b&#91;Shutting down  pool size = 1  active threads = 1  queued tasks = 0  completed tasks = 0&#93;&#91;stream://in?promptMessage=Enter+something%3A+&#93; to terminate...,0,0
StringQuoteHelper - Should ignore whitespace between quoted parameters,Need to merge to 2.11 branch when created.,0,0
Bean - Improve choose method logic for no parameter methods,We should optimize the logic and if a method name with no parameters has been defined  eg.to('bean:myBean?method=foo()')Or in ognl's such as.when().simple('${body.foo()} != null').to('direct:foo')Then we should optimize the logic to filter out methods with methods  as foo has been declare with no methods explicit by ().,0,0
camel-example-reportincident failed,2013-04-14 12:40:23 207 [main ] ERROR ContextLoader - Context initialization failedorg.apache.camel.RuntimeCamelException: org.apache.camel.FailedToCreateRouteException: Failed to create route route1: Route(route1)[[From[cxf:/incident?bus=#cxf&amp;serviceClass=org.... because of Failed to resolve endpoint: cxf:///incident?bus=%23cxf&amp;serviceClass=org.apache.camel.example.reportincident.ReportIncidentEndpoint&amp;wsdlURL=etc%2Freport_incident.wsdl due to: Could not find a suitable setter for property: bus as there isn't a setter method with same type: java.lang.String nor type conversion possible: No type converter available to convert from type: java.lang.String to the required type: org.apache.cxf.Bus with value #cxf at org.apache.camel.util.ObjectHelper.wrapRuntimeCamelException(ObjectHelper.java:1338) at org.apache.camel.spring.SpringCamelContext.onApplicationEvent(SpringCamelContext.java:120) at org.apache.camel.spring.CamelContextFactoryBean.onApplicationEvent(CamelContextFactoryBean.java:285) at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:97) at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:327) at org.springframework.context.support.AbstractApplicationContext.finishRefresh(AbstractApplicationContext.java:941) at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:475) at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:388) at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:293) at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:111) at org.eclipse.jetty.server.handler.ContextHandler.startContext(ContextHandler.java:740) at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:238) at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1238) at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:683) at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:480) at org.mortbay.jetty.plugin.JettyWebAppContext.doStart(JettyWebAppContext.java:256) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.eclipse.jetty.server.handler.HandlerCollection.doStart(HandlerCollection.java:229) at org.eclipse.jetty.server.handler.ContextHandlerCollection.doStart(ContextHandlerCollection.java:172) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.eclipse.jetty.server.handler.HandlerCollection.doStart(HandlerCollection.java:229) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.eclipse.jetty.server.handler.HandlerWrapper.doStart(HandlerWrapper.java:95) at org.eclipse.jetty.server.Server.doStart(Server.java:275) at org.mortbay.jetty.plugin.JettyServer.doStart(JettyServer.java:65) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.mortbay.jetty.plugin.AbstractJettyMojo.startJetty(AbstractJettyMojo.java:511) at org.mortbay.jetty.plugin.AbstractJettyMojo.execute(AbstractJettyMojo.java:364) at org.mortbay.jetty.plugin.JettyRunMojo.execute(JettyRunMojo.java:521) at org.apache.maven.plugin.DefaultBuildPluginManager.executeMojo(DefaultBuildPluginManager.java:101) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:209) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:153) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:145) at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:84) at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:59) at org.apache.maven.lifecycle.internal.LifecycleStarter.singleThreadedBuild(LifecycleStarter.java:183) at org.apache.maven.lifecycle.internal.LifecycleStarter.execute(LifecycleStarter.java:161) at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:320) at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:156) at org.apache.maven.cli.MavenCli.execute(MavenCli.java:537) at org.apache.maven.cli.MavenCli.doMain(MavenCli.java:196) at org.apache.maven.cli.MavenCli.main(MavenCli.java:141) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced(Launcher.java:290) at org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.java:230) at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(Launcher.java:409) at org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:352)Caused by: org.apache.camel.FailedToCreateRouteException: Failed to create route route1: Route(route1)[[From[cxf:/incident?bus=#cxf&amp;serviceClass=org.... because of Failed to resolve endpoint: cxf:///incident?bus=%23cxf&amp;serviceClass=org.apache.camel.example.reportincident.ReportIncidentEndpoint&amp;wsdlURL=etc%2Freport_incident.wsdl due to: Could not find a suitable setter for property: bus as there isn't a setter method with same type: java.lang.String nor type conversion possible: No type converter available to convert from type: java.lang.String to the required type: org.apache.cxf.Bus with value #cxf at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:181) at org.apache.camel.impl.DefaultCamelContext.startRoute(DefaultCamelContext.java:749) at org.apache.camel.impl.DefaultCamelContext.startRouteDefinitions(DefaultCamelContext.java:1828) at org.apache.camel.impl.DefaultCamelContext.doStartCamel(DefaultCamelContext.java:1608) at org.apache.camel.impl.DefaultCamelContext.doStart(DefaultCamelContext.java:1477) at org.apache.camel.spring.SpringCamelContext.doStart(SpringCamelContext.java:179) at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:60) at org.apache.camel.impl.DefaultCamelContext.start(DefaultCamelContext.java:1445) at org.apache.camel.spring.SpringCamelContext.maybeStart(SpringCamelContext.java:228) at org.apache.camel.spring.SpringCamelContext.onApplicationEvent(SpringCamelContext.java:118) ... 48 moreCaused by: org.apache.camel.ResolveEndpointFailedException: Failed to resolve endpoint: cxf:///incident?bus=%23cxf&amp;serviceClass=org.apache.camel.example.reportincident.ReportIncidentEndpoint&amp;wsdlURL=etc%2Freport_incident.wsdl due to: Could not find a suitable setter for property: bus as there isn't a setter method with same type: java.lang.String nor type conversion possible: No type converter available to convert from type: java.lang.String to the required type: org.apache.cxf.Bus with value #cxf at org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:507) at org.apache.camel.util.CamelContextHelper.getMandatoryEndpoint(CamelContextHelper.java:62) at org.apache.camel.model.RouteDefinition.resolveEndpoint(RouteDefinition.java:191) at org.apache.camel.impl.DefaultRouteContext.resolveEndpoint(DefaultRouteContext.java:108) at org.apache.camel.impl.DefaultRouteContext.resolveEndpoint(DefaultRouteContext.java:114) at org.apache.camel.model.FromDefinition.resolveEndpoint(FromDefinition.java:72) at org.apache.camel.impl.DefaultRouteContext.getEndpoint(DefaultRouteContext.java:90) at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:861) at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:176) ... 57 moreCaused by: java.lang.IllegalArgumentException: Could not find a suitable setter for property: bus as there isn't a setter method with same type: java.lang.String nor type conversion possible: No type converter available to convert from type: java.lang.String to the required type: org.apache.cxf.Bus with value #cxf at org.apache.camel.util.IntrospectionSupport.setProperty(IntrospectionSupport.java:526) at org.apache.camel.util.IntrospectionSupport.setProperty(IntrospectionSupport.java:536) at org.apache.camel.util.IntrospectionSupport.setProperties(IntrospectionSupport.java:430) at org.apache.camel.util.EndpointHelper.setProperties(EndpointHelper.java:249) at org.apache.camel.impl.DefaultComponent.setProperties(DefaultComponent.java:258) at org.apache.camel.component.cxf.CxfComponent.createEndpoint(CxfComponent.java:84) at org.apache.camel.impl.DefaultComponent.createEndpoint(DefaultComponent.java:119) at org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:487) ... 65 more2013-04-14 12:40:23.217:WARN:oejw.WebAppContext:Failed startup of context o.m.j.p.JettyWebAppContext{/ file:/Users/cmueller/workspaceRelease/camel/examples/camel-example-reportincident/src/main/webapp/} file:/Users/cmueller/workspaceRelease/camel/examples/camel-example-reportincident/src/main/webapp/org.apache.camel.RuntimeCamelException: org.apache.camel.FailedToCreateRouteException: Failed to create route route1: Route(route1)[[From[cxf:/incident?bus=#cxf&amp;serviceClass=org.... because of Failed to resolve endpoint: cxf:///incident?bus=%23cxf&amp;serviceClass=org.apache.camel.example.reportincident.ReportIncidentEndpoint&amp;wsdlURL=etc%2Freport_incident.wsdl due to: Could not find a suitable setter for property: bus as there isn't a setter method with same type: java.lang.String nor type conversion possible: No type converter available to convert from type: java.lang.String to the required type: org.apache.cxf.Bus with value #cxf at org.apache.camel.util.ObjectHelper.wrapRuntimeCamelException(ObjectHelper.java:1338) at org.apache.camel.spring.SpringCamelContext.onApplicationEvent(SpringCamelContext.java:120) at org.apache.camel.spring.CamelContextFactoryBean.onApplicationEvent(CamelContextFactoryBean.java:285) at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:97) at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:327) at org.springframework.context.support.AbstractApplicationContext.finishRefresh(AbstractApplicationContext.java:941) at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:475) at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:388) at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:293) at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:111) at org.eclipse.jetty.server.handler.ContextHandler.startContext(ContextHandler.java:740) at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:238) at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1238) at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:683) at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:480) at org.mortbay.jetty.plugin.JettyWebAppContext.doStart(JettyWebAppContext.java:256) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.eclipse.jetty.server.handler.HandlerCollection.doStart(HandlerCollection.java:229) at org.eclipse.jetty.server.handler.ContextHandlerCollection.doStart(ContextHandlerCollection.java:172) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.eclipse.jetty.server.handler.HandlerCollection.doStart(HandlerCollection.java:229) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.eclipse.jetty.server.handler.HandlerWrapper.doStart(HandlerWrapper.java:95) at org.eclipse.jetty.server.Server.doStart(Server.java:275) at org.mortbay.jetty.plugin.JettyServer.doStart(JettyServer.java:65) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.mortbay.jetty.plugin.AbstractJettyMojo.startJetty(AbstractJettyMojo.java:511) at org.mortbay.jetty.plugin.AbstractJettyMojo.execute(AbstractJettyMojo.java:364) at org.mortbay.jetty.plugin.JettyRunMojo.execute(JettyRunMojo.java:521) at org.apache.maven.plugin.DefaultBuildPluginManager.executeMojo(DefaultBuildPluginManager.java:101) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:209) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:153) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:145) at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:84) at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:59) at org.apache.maven.lifecycle.internal.LifecycleStarter.singleThreadedBuild(LifecycleStarter.java:183) at org.apache.maven.lifecycle.internal.LifecycleStarter.execute(LifecycleStarter.java:161) at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:320) at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:156) at org.apache.maven.cli.MavenCli.execute(MavenCli.java:537) at org.apache.maven.cli.MavenCli.doMain(MavenCli.java:196) at org.apache.maven.cli.MavenCli.main(MavenCli.java:141) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced(Launcher.java:290) at org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.java:230) at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(Launcher.java:409) at org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:352)Caused by:org.apache.camel.FailedToCreateRouteException: Failed to create route route1: Route(route1)[[From[cxf:/incident?bus=#cxf&amp;serviceClass=org.... because of Failed to resolve endpoint: cxf:///incident?bus=%23cxf&amp;serviceClass=org.apache.camel.example.reportincident.ReportIncidentEndpoint&amp;wsdlURL=etc%2Freport_incident.wsdl due to: Could not find a suitable setter for property: bus as there isn't a setter method with same type: java.lang.String nor type conversion possible: No type converter available to convert from type: java.lang.String to the required type: org.apache.cxf.Bus with value #cxf at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:181) at org.apache.camel.impl.DefaultCamelContext.startRoute(DefaultCamelContext.java:749) at org.apache.camel.impl.DefaultCamelContext.startRouteDefinitions(DefaultCamelContext.java:1828) at org.apache.camel.impl.DefaultCamelContext.doStartCamel(DefaultCamelContext.java:1608) at org.apache.camel.impl.DefaultCamelContext.doStart(DefaultCamelContext.java:1477) at org.apache.camel.spring.SpringCamelContext.doStart(SpringCamelContext.java:179) at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:60) at org.apache.camel.impl.DefaultCamelContext.start(DefaultCamelContext.java:1445) at org.apache.camel.spring.SpringCamelContext.maybeStart(SpringCamelContext.java:228) at org.apache.camel.spring.SpringCamelContext.onApplicationEvent(SpringCamelContext.java:118) at org.apache.camel.spring.CamelContextFactoryBean.onApplicationEvent(CamelContextFactoryBean.java:285) at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:97) at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:327) at org.springframework.context.support.AbstractApplicationContext.finishRefresh(AbstractApplicationContext.java:941) at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:475) at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:388) at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:293) at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:111) at org.eclipse.jetty.server.handler.ContextHandler.startContext(ContextHandler.java:740) at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:238) at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1238) at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:683) at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:480) at org.mortbay.jetty.plugin.JettyWebAppContext.doStart(JettyWebAppContext.java:256) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.eclipse.jetty.server.handler.HandlerCollection.doStart(HandlerCollection.java:229) at org.eclipse.jetty.server.handler.ContextHandlerCollection.doStart(ContextHandlerCollection.java:172) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.eclipse.jetty.server.handler.HandlerCollection.doStart(HandlerCollection.java:229) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.eclipse.jetty.server.handler.HandlerWrapper.doStart(HandlerWrapper.java:95) at org.eclipse.jetty.server.Server.doStart(Server.java:275) at org.mortbay.jetty.plugin.JettyServer.doStart(JettyServer.java:65) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.mortbay.jetty.plugin.AbstractJettyMojo.startJetty(AbstractJettyMojo.java:511) at org.mortbay.jetty.plugin.AbstractJettyMojo.execute(AbstractJettyMojo.java:364) at org.mortbay.jetty.plugin.JettyRunMojo.execute(JettyRunMojo.java:521) at org.apache.maven.plugin.DefaultBuildPluginManager.executeMojo(DefaultBuildPluginManager.java:101) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:209) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:153) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:145) at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:84) at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:59) at org.apache.maven.lifecycle.internal.LifecycleStarter.singleThreadedBuild(LifecycleStarter.java:183) at org.apache.maven.lifecycle.internal.LifecycleStarter.execute(LifecycleStarter.java:161) at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:320) at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:156) at org.apache.maven.cli.MavenCli.execute(MavenCli.java:537) at org.apache.maven.cli.MavenCli.doMain(MavenCli.java:196) at org.apache.maven.cli.MavenCli.main(MavenCli.java:141) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced(Launcher.java:290) at org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.java:230) at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(Launcher.java:409) at org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:352)Caused by:org.apache.camel.ResolveEndpointFailedException: Failed to resolve endpoint: cxf:///incident?bus=%23cxf&amp;serviceClass=org.apache.camel.example.reportincident.ReportIncidentEndpoint&amp;wsdlURL=etc%2Freport_incident.wsdl due to: Could not find a suitable setter for property: bus as there isn't a setter method with same type: java.lang.String nor type conversion possible: No type converter available to convert from type: java.lang.String to the required type: org.apache.cxf.Bus with value #cxf at org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:507) at org.apache.camel.util.CamelContextHelper.getMandatoryEndpoint(CamelContextHelper.java:62) at org.apache.camel.model.RouteDefinition.resolveEndpoint(RouteDefinition.java:191) at org.apache.camel.impl.DefaultRouteContext.resolveEndpoint(DefaultRouteContext.java:108) at org.apache.camel.impl.DefaultRouteContext.resolveEndpoint(DefaultRouteContext.java:114) at org.apache.camel.model.FromDefinition.resolveEndpoint(FromDefinition.java:72) at org.apache.camel.impl.DefaultRouteContext.getEndpoint(DefaultRouteContext.java:90) at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:861) at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:176) at org.apache.camel.impl.DefaultCamelContext.startRoute(DefaultCamelContext.java:749) at org.apache.camel.impl.DefaultCamelContext.startRouteDefinitions(DefaultCamelContext.java:1828) at org.apache.camel.impl.DefaultCamelContext.doStartCamel(DefaultCamelContext.java:1608) at org.apache.camel.impl.DefaultCamelContext.doStart(DefaultCamelContext.java:1477) at org.apache.camel.spring.SpringCamelContext.doStart(SpringCamelContext.java:179) at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:60) at org.apache.camel.impl.DefaultCamelContext.start(DefaultCamelContext.java:1445) at org.apache.camel.spring.SpringCamelContext.maybeStart(SpringCamelContext.java:228) at org.apache.camel.spring.SpringCamelContext.onApplicationEvent(SpringCamelContext.java:118) at org.apache.camel.spring.CamelContextFactoryBean.onApplicationEvent(CamelContextFactoryBean.java:285) at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:97) at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:327) at org.springframework.context.support.AbstractApplicationContext.finishRefresh(AbstractApplicationContext.java:941) at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:475) at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:388) at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:293) at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:111) at org.eclipse.jetty.server.handler.ContextHandler.startContext(ContextHandler.java:740) at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:238) at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1238) at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:683) at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:480) at org.mortbay.jetty.plugin.JettyWebAppContext.doStart(JettyWebAppContext.java:256) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.eclipse.jetty.server.handler.HandlerCollection.doStart(HandlerCollection.java:229) at org.eclipse.jetty.server.handler.ContextHandlerCollection.doStart(ContextHandlerCollection.java:172) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.eclipse.jetty.server.handler.HandlerCollection.doStart(HandlerCollection.java:229) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.eclipse.jetty.server.handler.HandlerWrapper.doStart(HandlerWrapper.java:95) at org.eclipse.jetty.server.Server.doStart(Server.java:275) at org.mortbay.jetty.plugin.JettyServer.doStart(JettyServer.java:65) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.mortbay.jetty.plugin.AbstractJettyMojo.startJetty(AbstractJettyMojo.java:511) at org.mortbay.jetty.plugin.AbstractJettyMojo.execute(AbstractJettyMojo.java:364) at org.mortbay.jetty.plugin.JettyRunMojo.execute(JettyRunMojo.java:521) at org.apache.maven.plugin.DefaultBuildPluginManager.executeMojo(DefaultBuildPluginManager.java:101) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:209) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:153) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:145) at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:84) at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:59) at org.apache.maven.lifecycle.internal.LifecycleStarter.singleThreadedBuild(LifecycleStarter.java:183) at org.apache.maven.lifecycle.internal.LifecycleStarter.execute(LifecycleStarter.java:161) at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:320) at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:156) at org.apache.maven.cli.MavenCli.execute(MavenCli.java:537) at org.apache.maven.cli.MavenCli.doMain(MavenCli.java:196) at org.apache.maven.cli.MavenCli.main(MavenCli.java:141) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced(Launcher.java:290) at org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.java:230) at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(Launcher.java:409) at org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:352)Caused by:java.lang.IllegalArgumentException: Could not find a suitable setter for property: bus as there isn't a setter method with same type: java.lang.String nor type conversion possible: No type converter available to convert from type: java.lang.String to the required type: org.apache.cxf.Bus with value #cxf at org.apache.camel.util.IntrospectionSupport.setProperty(IntrospectionSupport.java:526) at org.apache.camel.util.IntrospectionSupport.setProperty(IntrospectionSupport.java:536) at org.apache.camel.util.IntrospectionSupport.setProperties(IntrospectionSupport.java:430) at org.apache.camel.util.EndpointHelper.setProperties(EndpointHelper.java:249) at org.apache.camel.impl.DefaultComponent.setProperties(DefaultComponent.java:258) at org.apache.camel.component.cxf.CxfComponent.createEndpoint(CxfComponent.java:84) at org.apache.camel.impl.DefaultComponent.createEndpoint(DefaultComponent.java:119) at org.apache.camel.impl.DefaultCamelContext.getEndpoint(DefaultCamelContext.java:487) at org.apache.camel.util.CamelContextHelper.getMandatoryEndpoint(CamelContextHelper.java:62) at org.apache.camel.model.RouteDefinition.resolveEndpoint(RouteDefinition.java:191) at org.apache.camel.impl.DefaultRouteContext.resolveEndpoint(DefaultRouteContext.java:108) at org.apache.camel.impl.DefaultRouteContext.resolveEndpoint(DefaultRouteContext.java:114) at org.apache.camel.model.FromDefinition.resolveEndpoint(FromDefinition.java:72) at org.apache.camel.impl.DefaultRouteContext.getEndpoint(DefaultRouteContext.java:90) at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:861) at org.apache.camel.model.RouteDefinition.addRoutes(RouteDefinition.java:176) at org.apache.camel.impl.DefaultCamelContext.startRoute(DefaultCamelContext.java:749) at org.apache.camel.impl.DefaultCamelContext.startRouteDefinitions(DefaultCamelContext.java:1828) at org.apache.camel.impl.DefaultCamelContext.doStartCamel(DefaultCamelContext.java:1608) at org.apache.camel.impl.DefaultCamelContext.doStart(DefaultCamelContext.java:1477) at org.apache.camel.spring.SpringCamelContext.doStart(SpringCamelContext.java:179) at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:60) at org.apache.camel.impl.DefaultCamelContext.start(DefaultCamelContext.java:1445) at org.apache.camel.spring.SpringCamelContext.maybeStart(SpringCamelContext.java:228) at org.apache.camel.spring.SpringCamelContext.onApplicationEvent(SpringCamelContext.java:118) at org.apache.camel.spring.CamelContextFactoryBean.onApplicationEvent(CamelContextFactoryBean.java:285) at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:97) at org.springframework.context.support.AbstractApplicationContext.publishEvent(AbstractApplicationContext.java:327) at org.springframework.context.support.AbstractApplicationContext.finishRefresh(AbstractApplicationContext.java:941) at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:475) at org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:388) at org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:293) at org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:111) at org.eclipse.jetty.server.handler.ContextHandler.startContext(ContextHandler.java:740) at org.eclipse.jetty.servlet.ServletContextHandler.startContext(ServletContextHandler.java:238) at org.eclipse.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1238) at org.eclipse.jetty.server.handler.ContextHandler.doStart(ContextHandler.java:683) at org.eclipse.jetty.webapp.WebAppContext.doStart(WebAppContext.java:480) at org.mortbay.jetty.plugin.JettyWebAppContext.doStart(JettyWebAppContext.java:256) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.eclipse.jetty.server.handler.HandlerCollection.doStart(HandlerCollection.java:229) at org.eclipse.jetty.server.handler.ContextHandlerCollection.doStart(ContextHandlerCollection.java:172) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.eclipse.jetty.server.handler.HandlerCollection.doStart(HandlerCollection.java:229) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.eclipse.jetty.server.handler.HandlerWrapper.doStart(HandlerWrapper.java:95) at org.eclipse.jetty.server.Server.doStart(Server.java:275) at org.mortbay.jetty.plugin.JettyServer.doStart(JettyServer.java:65) at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64) at org.mortbay.jetty.plugin.AbstractJettyMojo.startJetty(AbstractJettyMojo.java:511) at org.mortbay.jetty.plugin.AbstractJettyMojo.execute(AbstractJettyMojo.java:364) at org.mortbay.jetty.plugin.JettyRunMojo.execute(JettyRunMojo.java:521) at org.apache.maven.plugin.DefaultBuildPluginManager.executeMojo(DefaultBuildPluginManager.java:101) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:209) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:153) at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:145) at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:84) at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:59) at org.apache.maven.lifecycle.internal.LifecycleStarter.singleThreadedBuild(LifecycleStarter.java:183) at org.apache.maven.lifecycle.internal.LifecycleStarter.execute(LifecycleStarter.java:161) at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:320) at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:156) at org.apache.maven.cli.MavenCli.execute(MavenCli.java:537) at org.apache.maven.cli.MavenCli.doMain(MavenCli.java:196) at org.apache.maven.cli.MavenCli.main(MavenCli.java:141) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced(Launcher.java:290) at org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.java:230) at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(Launcher.java:409) at org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:352)2013-04-14 12:40:23.241:INFO:oejs.AbstractConnector:Started SelectChannelConnector@0.0.0.0:9080,0,0
camel-example-cxf-tomcat failed,By accessing 'http://localhost:8080/camel-example-cxf-tomcat/webservices/incident?wsdl' I get the following exception:Apr 14  2013 7:56:37 PM org.apache.catalina.core.StandardWrapperValve invokeSEVERE: Allocate exception for servlet CXFServletorg.springframework.beans.factory.NoSuchBeanDefinitionException: No bean named 'cxf' is defined at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanDefinition(DefaultListableBeanFactory.java:549) at org.springframework.beans.factory.support.AbstractBeanFactory.getMergedLocalBeanDefinition(AbstractBeanFactory.java:1095) at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:277) at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:197) at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1109) at org.apache.cxf.transport.servlet.CXFServlet.loadBus(CXFServlet.java:77) at org.apache.cxf.transport.servlet.CXFNonSpringServlet.init(CXFNonSpringServlet.java:71) at org.apache.catalina.core.StandardWrapper.initServlet(StandardWrapper.java:1280) at org.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:1193) at org.apache.catalina.core.StandardWrapper.allocate(StandardWrapper.java:865) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:136) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:123) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:472) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:171) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:99) at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:936) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407) at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1004) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:589) at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:310) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918) at java.lang.Thread.run(Thread.java:680),0,0
Restarting routes using sql aggregation repository may lead to Class loading issues,Its the code in ClassLoadingAwareObjectInputStream in camel-sql that has the bug.,0,0
Make SqsConsumer support async processors,Switch SqsConsumer from using getProcessor().process() to getAsyncProcessor().process() with a callback to allow use of async processors.As I understand it is ok to always use the async processor call as its to show that 'the caller supports having the exchange asynchronously processed' rather than specifically always process it asynchronously.,0,0
Camel archetype component - Use bundle packaging so component is ready to install in OSGi,The component archetypes should have the pom.xml changed so they generate a project that use bundle packaging with the felix bundle plugin.Then the component is ready to install in OSGi.See nabblehttp://camel.465427.n5.nabble.com/Creating-new-processor-components-td5730919.html,0,0
AdviceWith doesn't work with doTry,I have the following route definition: from('direct:billing_' + operation) .routeId(getRouteId(operation)) .errorHandler(noErrorHandler()) // propagate exceptions to the parent route .validate(body().isInstanceOf( com.cleverlance.cleverbss.integration.modules.in.customer.model.Customer.class)) .beanRef(BILLING_CUSTOMER_ROUTE_BEAN  'createRequestFor' + WordUtils.capitalize(operation)) // SetCustomer -&gt; XML .marshal(jaxbIn) .doTry() .to(uri + '?messageSender=#billingSender').id('toURI') .doCatch(AlreadyExistsException.class) .setProperty(exPropertyName  property(Exchange.EXCEPTION_CAUGHT)) .end() .choice() .when(property(exPropertyName).isNull()) // XML -&gt; SetCustomerResponse .unmarshal(jaxbOut) .endChoice();And I would like to replace TO in the tests: getCamelContext().getRouteDefinition(BillingCustomerRoutes.ROUTE_ID_UPDATE_CUSTOMER) .adviceWith(getCamelContext()  new AdviceWithRouteBuilder() { @Override public void configure() throws Exception { weaveByType(ToDefinition.class).replace().process(new Processor() { @Override public void process(Exchange exchange) throws Exception { throw new AlreadyExistsException('msg'  new AlreadyExists()); } }); } });When I use weaveById('toURI') or weaveByToString()  it doesn't work neither.,0,0
Mina UDP default codec should keep the data as byte[],The MinaUdpProtocolCodecFactory on the consumer side decodes data from an udp datagram to a byte[]. byte[] bytes = context.getTypeConverter().convertTo(byte[].class  in);On the provider side where it gets back to the wire it gets converted to a string: String value = context.getTypeConverter().convertTo(String.class  message);and then set to the ByteBuffer with the given charset.The result is that the original datagram is not valid anymore. The default codec should the data convert to a byte array or keep the data as byte array.,0,0
debugBefore() and debugAfter() not called if unit test extends CamelBlueprintTestSupport,A test that extends CamelBlueprintTestSupport does not get its debugBefore() and debugAfter() methods called.,0,0
Property placeholder optimization broke placeholders in Spring camelContext configuration,We are upgrading from 2.10.0 to 2.11.0  and are getting an error on startup.Example Spring configuration:&lt;camelContext id='camel' handleFault='true' autoStartup='{{autoStartup}}' xmlns='http://camel.apache.org/schema/spring'&gt; &lt;contextScan /&gt; &lt;jmxAgent id='camelAgent' createConnector='true' registryPort='{{jmxPort}}' /&gt;&lt;/camelContext&gt;&lt;bean id='properties' class='org.apache.camel.component.properties.PropertiesComponent'&gt; &lt;property name='location' value='classpath:foo.properties'/&gt;&lt;/bean&gt;As you can see  we use the Camel properties component to configure Camel auto-startup  JMX port  etc.This is the error we're getting on startup:org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'properties' defined in class path resource [org/apache/camel/component/properties/SpringPropertiesComponentTest.xml]: Initialization of bean failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'camel-1': Invocation of init method failed; nested exception is java.lang.IllegalArgumentException: PropertiesComponent with name properties must be defined in CamelContext to support property placeholders. at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:527) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456) at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294) at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225) at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291) at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:193) at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:607) at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:925) at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:472) at org.springframework.context.support.ClassPathXmlApplicationContext.&lt;init&gt;(ClassPathXmlApplicationContext.java:139) at org.springframework.context.support.ClassPathXmlApplicationContext.&lt;init&gt;(ClassPathXmlApplicationContext.java:83) at org.apache.camel.component.properties.SpringPropertiesComponentTest.createApplicationContext(SpringPropertiesComponentTest.java:30) at org.apache.camel.spring.SpringTestSupport.setUp(SpringTestSupport.java:52) at junit.framework.TestCase.runBare(TestCase.java:139) at org.apache.camel.TestSupport.runBare(TestSupport.java:58) at junit.framework.TestResult$1.protect(TestResult.java:122) at junit.framework.TestResult.runProtected(TestResult.java:142) at junit.framework.TestResult.run(TestResult.java:125) at junit.framework.TestCase.run(TestCase.java:129) at junit.framework.TestSuite.runTest(TestSuite.java:255) at junit.framework.TestSuite.run(TestSuite.java:250) at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:84) at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:50) at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'camel-1': Invocation of init method failed; nested exception is java.lang.IllegalArgumentException: PropertiesComponent with name properties must be defined in CamelContext to support property placeholders. at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1455) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:519) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:456) at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:294) at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:225) at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:291) at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:197) at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1109) at org.apache.camel.spring.CamelBeanPostProcessor$1.getOrLookupCamelContext(CamelBeanPostProcessor.java:69) at org.apache.camel.impl.DefaultCamelBeanPostProcessor.postProcessBeforeInitialization(DefaultCamelBeanPostProcessor.java:85) at org.apache.camel.spring.CamelBeanPostProcessor.postProcessBeforeInitialization(CamelBeanPostProcessor.java:148) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsBeforeInitialization(AbstractAutowireCapableBeanFactory.java:394) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1448) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:519) ... 27 moreCaused by: java.lang.IllegalArgumentException: PropertiesComponent with name properties must be defined in CamelContext to support property placeholders. at org.apache.camel.impl.DefaultCamelContext.resolvePropertyPlaceholders(DefaultCamelContext.java:1063) at org.apache.camel.util.CamelContextHelper.parseBoolean(CamelContextHelper.java:337) at org.apache.camel.core.xml.AbstractCamelContextFactoryBean.initCamelContext(AbstractCamelContextFactoryBean.java:543) at org.apache.camel.core.xml.AbstractCamelContextFactoryBean.afterPropertiesSet(AbstractCamelContextFactoryBean.java:266) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1514) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1452) ... 40 moreI believe this is a side-effect of the optimization introduced in CAMEL-5508  which was incorporated into 2.10.1 and 2.11.0.I'll attach a small patch that modifies one of the unit tests in the camel-spring component to reproduce the issue.,0,0
Camel-validator not able to resolve schema when using useSharedSchema=false,This one works: &lt;to uri='validator:META-INF/xsd/fundscheckmaintainavailablebalance.xsd' /&gt;This one doesn't: &lt;to uri='validator:META-INF/xsd/fundscheckmaintainavailablebalance.xsd?useSharedSchema=false' /&gt;it fails with:org.xml.sax.SAXParseException: schema_reference.4: Failed to read schema document 'null'  because 1) could not find the document; 2) the document could not be read; 3) the root element of the document is not &lt;xsd:schema&gt;.The streamsource object in the validator is populated  but the buffered inputstream object has no content,0,0
Moving logic out of getTypeConverter,TypeConverter is never added as a service if we use the method setTypeConverter(). Used through camel-guice you had expect this service to be active without additional instruction.See : http://camel.465427.n5.nabble.com/Ambiguity-in-DefaultCamelContext-with-TypeConverter-td5731480.html,0,0
Control Bus - Add suspend and resume actions,We have start and stop actions. But we need suspend and resume as well.,0,0
camel-netty - Loading key store and trust stores should support classpath as well,The options keyStoreFile and trustStoreFile is currently java.io.File based.We should use the resource loader API in Camel so we can load from classpath as well.,0,0
DefaultShutdownStrategy shutdown timeout of 0 will never timeout and go in negative time,A timeout of 0 won't timeout in the instant  the time will go negative. camelcontext.stopRoute(routeId  0  TimeUnit.SECONDS  false); &#91;org.apache.camel.impl.DefaultShutdownStrategy&#93; : Waiting as there are still 3 inflight and pending exchanges to complete  timeout in -1 seconds.&#91;org.apache.camel.impl.DefaultShutdownStrategy&#93; : Waiting as there are still 3 inflight and pending exchanges to complete  timeout in -2 seconds.&#91;org.apache.camel.impl.DefaultShutdownStrategy&#93; : Waiting as there are still 3 inflight and pending exchanges to complete  timeout in -3 seconds. Found a post related to it there : http://camel.465427.n5.nabble.com/Forcefully-shutting-down-routes-td5722447.html,1,1
link to camel registry in camel-stax is missing,,0,0
Validations exception should include line/column,When a 'validator:' route step reports exceptions  they should include the line/column location.Here is a small patch that adds support for it.,0,0
camel-sjms - Consumers should always use dedicated Sessions,If you add more then one MessageListener to a Session then that session will use a single thread to notify each MessageListener in turn. Which defeats the purpose of using multiple MessageListeners  at least in my opinion.sessionCount in SjmsEndpoint should be ignored for Consumers  each Consumer (consumerCount) should instead use a dedicated Session  like what happens when transactions are enabled.,0,0
vm component - Stopping a route when using multipleConsumers should not stop MP if there is other routes using it,See nabblehttp://camel.465427.n5.nabble.com/Removing-route-stops-other-routes-from-the-same-producer-tp5732616.html,0,0
Headers are not set correctly in some situation,If I define a route like this: from('&lt;MyUrl&gt;/test') .setHeader(Exchange.HTTP_RESPONSE_CODE  simple('400')); my http client get a 200 response code. If a add something else on the route like: from('&lt;MyUrl&gt;/test') .setHeader(Exchange.HTTP_RESPONSE_CODE  simple('400')) .log('400').my http client get a 400 response code as expected. forum :http://camel.465427.n5.nabble.com/route-http-code-td5732728.html,0,0
New restlet endpoints don't work if route is created after restlet server is started.,If a route with restlet endponit is created after restlet server is started  restlet can't handle the endpoint correctly  because restlet translate all URI pattern of routes at server starting  but don't it for later attached routes. So we must translate the URI pattern before attach it to restlet after restlet server is started. See http://restlet.tigris.org/issues/show_bug.cgi?id=988.,0,0
Route with suspended SedaConsumer can't be stopped correctly,Route with suspended SedaConsumer can't be stopped correctly. Here is test: @Test public void testOriginalSedaShutdownSuspended() throws Exception { SedaEndpoint endpoint = context().getEndpoint('seda:test'  SedaEndpoint.class); context().addRouteDefinition(new RouteDefinition() .id('testRoute') .from(endpoint) .to('log:body') ); Set&lt;SedaConsumer&gt; consumers = endpoint.getConsumers(); Assert.assertFalse(consumers.isEmpty()); for (SedaConsumer sedaConsumer: consumers) { sedaConsumer.suspend(); } Assert.assertTrue(context().stopRoute('testRoute'  2  TimeUnit.SECONDS  true)); },0,0
cxf endpoint's should log the parsing exception when failing to extract the root element name,When the content is not xml and the root element is not correctly extracted by the CxfEndpoint's root element extraction method  the original exception is not logged but a subsequent exception (not the original one) will be thrown upwards. This behavior is confusing and could potentially lead to another issue depending on what the stax parser does on its getLocalName().Currently  when r.next() throws an exception  it's ignored and the subsequent call to r.getLocalName()'s exception is thrown.So I think it's preferable to log the original exception and simply return null as in the other cases for not finding the root element.Logging the original exception will provide a more helpful information in spotting the issue  as it will show up like:com.ctc.wstx.exc.WstxUnexpectedCharException: Unexpected character 'c' (code 99) in prolog; expected '&lt;'This is an action to the point raised in http://camel.465427.n5.nabble.com/Test-route-with-CXF-endpoint-td5733266.html,0,0
File consumer - Race condition for markerFile read lock strategy,See nabblehttp://camel.465427.n5.nabble.com/File-markerFile-strategy-race-condition-tp5733561.htmlWe should delete the .camelLock file last  as currently we move the processed file first. And there is a very tiny tiny window where another process could potential see the file and pickup it.,0,0
baseResource of Jetty ServletContextHandler does not work when project deployed as a bundle,If we package a camel websocket route ('websocket://0.0.0.0:9090/newsTopic?sendToAll=true&amp;staticResources=classpath:webapp') as a bundle and set the staticResources as parameter (classpath:webapp)  then the pages cannot be accessed from the browserCode should be  if (resources[0].equals('classpath')) { URL url = this.getCamelContext().getClassResolver().loadResourceAsURL(resources[1]); context.setBaseResource(Resource.newResource(url)); } else if (resources[0].equals('file')) { context.setBaseResource(Resource.newResource(resources[1])); },0,0
endChoice() has no effect in nested choice definition,I just upgraded from 2.10.4 to 2.11.0 and noticed that nested choice definitions started acting strangely. For example: .choice() .when(header(Exchange.EXCEPTION_CAUGHT).isNotNull()) // 1 .setBody(exceptionMessage().append(SystemUtils.LINE_SEPARATOR).append(exceptionStackTrace())) .choice() .when(header(HEADER_CONTROLLER_ID).isNotNull()) // 1a .setHeader(Exchange.FILE_NAME  simple(AUDIT_CONTROLLER_FAILED_FILENAME + '.error.log')) .to(ENDPOINT_AUDIT_DIR) .otherwise() // 1b .setHeader(Exchange.FILE_NAME  simple(AUDIT_FAILED_FILENAME + '.error.log')) .to(ENDPOINT_AUDIT_DIR) // INSERTING .end() here solves the issue .endChoice() .log(LoggingLevel.WARN  'DLQ written: ${in.header.CamelExceptionCaught}' .otherwise() // 2 .log(LoggingLevel.WARN  'DLQ written' + MESSAGE_LOG_FORMAT) .end()I have a test that is supposed to go through 1 and 1a. However it now passes through 1 and 2!It looks like the endChoice() in 1b has no effect and the otherwise() in 2 is executed instead of 1b. Inserting and end() statement as shown seems to solve the issue  but it looks suspicious.It's probably a regression introduced by the fix for CAMEL-5953  but I'm not 100% sure.,0,0
camel-quartz - Stateful job - Redeploying bundle/war and having changed endpoint uri issue,Seehttp://camel.465427.n5.nabble.com/In-came-quartz-route-after-bundle-update-jobs-are-not-triggred-tp5734196.htmlIn these situations we should use job.name to name the job unique so when you change the endpoint uri and redeploy the apps/bundles  then camel-quartz can find the old job in the quartz persistent store.There may be logic needed to lookup using job.name as the unique name in these situations  and then allow endpoint uri options to change over time  such as the cron trigger etc. Which should be adjusted accordingly as well.,0,0
connectionTimeout property is ignored by JavaMail,JavaMail ignores the timeout values set via the connectionTimeout property. Within MailConfiguration::createJavaMailProperties the mail.&lt;protocol&gt;.timeout and mail.&lt;protocol&gt;.connectionTimeout parameters are set as long values In com.sun.mail.util.PropUtil::getInt (line 141) the property is ignored since it is a long valueChanging the type of connectionTimeout from long to int would be the cleanest solution - another suggestion would be to downcast the connectionTimeout in MailConfiguration::createJavaMailProperties,0,1
NULL values are not supported in named parameters,Due to the bug in the DefaultSqlPrepareStatementStrategy there no ability to use NULL values.Following query will be failed  if we try to use NULL as a parameter value:select a  b from foo where (:#param1 IS NOT NULL AND a &gt; 12 ) OR (:#param2 IS NOT NULL AND b &gt; 12)We'll get an error: Caused by: java.sql.SQLException: Number of parameters mismatch. Expected: 2  was:1at org.apache.camel.component.sql.DefaultSqlPrepareStatementStrategy.populateStatement(DefaultSqlPrepareStatementStrategy.java:132) ~&#91;camel-sql-2.11.0.jar:2.11.0&#93; at org.apache.camel.component.sql.SqlProducer$1.doInPreparedStatement(SqlProducer.java:74) ~&#91;camel-sql-2.11.0.jar:2.11.0&#93; at org.apache.camel.component.sql.SqlProducer$1.doInPreparedStatement(SqlProducer.java:57) ~&#91;camel-sql-2.11.0.jar:2.11.0&#93; at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:587) ~&#91;spring-jdbc-3.1.4.RELEASE.jar:3.1.4.RELEASE&#93;Fix is quite simple: iterator implementation (returned by DefaultSqlPrepareStatementStrategy.createPopulateIterator()) should be changed as follows: return new Iterator&lt;Object&gt;() { private NamedQueryParser parser = new NamedQueryParser(query); private String nextParam; private boolean done; @Override public boolean hasNext() { if (done) { return false; } if (nextParam == null) { nextParam = parser.next(); if (nextParam == null) { done = true; } } return nextParam != null; } @Override public Object next() { if(!hasNext()){ throw new NoSuchElementException(); } boolean contains = bodyMap != null ? bodyMap.containsKey(nextParam) : false; contains |= headerMap != null ? headerMap.containsKey(nextParam) : false; if (!contains) { throw new RuntimeExchangeException('Cannot find key [' + nextParam + '] in message body or headers to use when setting named parameter in query [' + query + ']'  exchange); } // get from body before header Object next = bodyMap != null ? bodyMap.get(nextParam) : null; if (next == null) { next = headerMap != null ? headerMap.get(nextParam) : null; } nextParam = null; return next; } @Override public void remove() { // noop } };,0,0
Can't access to length of Array (java) from simple language,Cannot evaluate length on java.lang.String[] in simpleI suspect this is because this is part of the language itself. But still  why not?repro steprun this: ?xml version='1.0' encoding='UTF-8'?&gt;&lt;routes xmlns='http://camel.apache.org/schema/spring' &gt; &lt;route&gt; &lt;from uri='timer:test?repeatCount=1'/&gt; &lt;setBody&gt; &lt;groovy&gt;[[2  'Chaine_avec_des_underscores'  12  'c']  ['d4'  'e5'  'f6']]&lt;/groovy&gt; &lt;/setBody&gt; &lt;split&gt; &lt;simple&gt;${body}&lt;/simple&gt; &lt;setHeader headerName='splittedColumn1'&gt; &lt;simple&gt;${body[1].split('_')}&lt;/simple&gt; &lt;/setHeader&gt; &lt;log message='${header.splittedColumn1.length}'/&gt; &lt;/split&gt; &lt;/route&gt;&lt;/routes&gt;errors with:org.apache.camel.language.bean.RuntimeBeanExpressionException: Failed to invoke method: .length on null due to: org.apache.camel.language.bean.RuntimeBeanExpressionException: Failed to invoke method: length on null due to: org.apache.camel.component.bean.MethodNotFoundException: Method with name: length not found on bean: [Ljava.lang.String;@33318365 of type: [Ljava.lang.String;. Exchange[Message: [d4  e5  f6]],0,0
org.apache.camel.main.Main#doStop() throws java.lang.IndexOutOfBoundsException,When calling a Camel application with parameter -h all parameters are printed an the program exits.But it is no clean exit; it throws an java.lang.IndexOutOfBoundsException.The reason for this is the expression in doStop():+getCamelContexts().get(0).stop();get(0) returns null  if no context is initialized yet.See camel-users mailinglist  thread 'Bug in org.apache.camel.main.Main#doStop() ?',0,0
SFTP: NPE if no private key file is supplied,Hi a NPE is thrown if no private key file is supplied in the configuration for SFTP. The error isCaused by: java.lang.NullPointerException: while trying to get the length of an array loaded from local variable 'foo'at com.jcraft.jsch.Buffer.putString(Buffer.java:59)I have analysed the code a bit and found that the problem is causedby the class SftpOperations. The method createSession sets the userInfo for the seesion by an inline class. Here the method promptKeyboardInteractive does not work correctly if no private key file is supplied. In that case JSCH switches to user/pw authorization and this method is called. But since there is no password maintained the configation object returns NULL. The present implementation adds it to the string array causing the error in JSCH. JSCH either wants a NULL string array or an empty string array (I have tested both). So the code should look e.g. as follows: public String[] promptKeyboardInteractive(String destination  String name  String instruction  String[] prompt  boolean[] echo) { String password = configuration.getPassword(); if (password == null) { return new String[0]; } else { return new String[] { password }; } }With that change JSCH returnsCaused by: java.io.FileNotFoundException: ./data/ssh/id_rsa (No such file or directory) at java.io.FileInputStream.open(Native Method)and that is the real cause of the error Best Regards J?rg,0,0
Routing slip EIP - Does not send ExchangeSentEvent notifications,When using routing slip eip  then we only get the ExchangeSendingEvent  what we miss is the ExchangSentEvent.,0,0
FtpConsumer fills up log file with 'Cannot connect/login' WARN level messages,If the FTP server becomes unavailable  the container log gets flooded with WARN-level messages and gets filled with lines like:16:32:34 511 WARN &#91;org.apache.camel.component.file.remote.FtpConsumer&#93; Cannot connect/login to: ftp://adpt5@localhost:21. Will skip this poll.16:32:49 048 WARN &#91;org.apache.camel.component.file.remote.FtpConsumer&#93; Cannot connect/login to: ftp://adpt5@localhost:21. Will skip this poll.16:33:03 576 WARN &#91;org.apache.camel.component.file.remote.FtpConsumer&#93; Cannot connect/login to: ftp://adpt5@localhost:21. Will skip this poll.i.e. a WARN message gets added to the log every five seconds. We only need to be notified once per incidence.The issue is in org.apache.camel.component.file.remote.RemoteFileConsumer.prePollCheck().I recommend a table of latches  keyed by endpoint key. The latch is set when the initial warning is logged  then cleared upon any subsequent successful connection.,0,0
camel-netty - unable to consume on UDP multicast addresses,When using a route to listen to UDP multicast address   no messages seem to get consumed. No exceptions are observed. Multicast address is defined as addresses in the range of 224.0.0.0 through 239.255.255.255 (http://en.wikipedia.org/wiki/Multicast_address)Input was simple string (e.g. 'Test String')Example Route:&lt;route&gt; &lt;from uri='netty:udp://225.1.1.1:8001?allowDefaultCodec=false&amp;sync=false&amp;broadcast=true'/&gt;&lt;/route&gt;Found an old topic in the user discussion forum that seems related. Did not find any unit tests in the Camel source code exercising this behavior. (http://camel.465427.n5.nabble.com/camel-netty-and-multicast-tt4638622.html),0,0
Wrong InputStream reference is used in method storeFile of class ScpOperations,In method storeFile(String name  Exchange exchange) of class org.apache.camel.component.jsch.ScpOperations the wrong reference of the required input stream is used (line 131). Should be write(channel  file  is  cfg); instead of write(channel  file  exchange.getIn().getMandatoryBody(InputStream.class)  cfg);,0,0
camel-cxf should shutdown the bus when the endpoint is stopped.,If the bus is create by cxfEndpoint itself  cxfEndpoint should shutdown it when the endpoint is stopped.,0,1
JMX - browsable endpoints such as seda has some attributes listed as unavaiable,See screenshotThe problem is related to extending a ManagedEndpoint then some options is shown as unavaiable in JMX consoles.,0,0
SFTP endpoint fails if the server disconnected the socket,If the ssh server disconnects the socket held by an SFTP endpoint (and the disconnect option is not set to true) the next call to this endpoint will fail. A call after the failed call will reconnect (and succeed if the server is available again).The error message is as follows:SftpSimpleProduceDisconnectTestorg.apache.camel.component.file.remote.sftp.SftpSimpleProduceDisconnectTesttestSftpSimpleProduce(org.apache.camel.component.file.remote.sftp.SftpSimpleProduceDisconnectTest)org.apache.camel.CamelExecutionException: Exception occurred during execution on the exchange: Exchange&#91;Message: Hello World&#93; at org.apache.camel.util.ObjectHelper.wrapCamelExecutionException(ObjectHelper.java:1360) at org.apache.camel.util.ExchangeHelper.extractResultBody(ExchangeHelper.java:619) at org.apache.camel.impl.DefaultProducerTemplate.extractResultBody(DefaultProducerTemplate.java:454) at org.apache.camel.impl.DefaultProducerTemplate.extractResultBody(DefaultProducerTemplate.java:450) at org.apache.camel.impl.DefaultProducerTemplate.sendBodyAndHeader(DefaultProducerTemplate.java:152) at org.apache.camel.impl.DefaultProducerTemplate.sendBodyAndHeader(DefaultProducerTemplate.java:146) at org.apache.camel.component.file.remote.sftp.SftpSimpleProduceDisconnectTest.testSftpSimpleProduce(SftpSimpleProduceDisconnectTest.java:50) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source) at java.lang.reflect.Method.invoke(Unknown Source) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44) at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17) at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27) at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55) at org.junit.rules.RunRules.evaluate(RunRules.java:20) at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50) at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238) at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63) at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236) at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53) at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229) at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27) at org.junit.runners.ParentRunner.run(ParentRunner.java:309) at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:50) at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)Caused by: org.apache.camel.component.file.GenericFileOperationFailedException: Cannot change directory to: target at org.apache.camel.component.file.remote.SftpOperations.doChangeDirectory(SftpOperations.java:536) at org.apache.camel.component.file.remote.SftpOperations.changeCurrentDirectory(SftpOperations.java:524) at org.apache.camel.component.file.remote.SftpOperations.storeFile(SftpOperations.java:771) at org.apache.camel.component.file.GenericFileProducer.writeFile(GenericFileProducer.java:278) at org.apache.camel.component.file.GenericFileProducer.processExchange(GenericFileProducer.java:166) at org.apache.camel.component.file.remote.RemoteFileProducer.process(RemoteFileProducer.java:49) at org.apache.camel.util.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:61) at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:192) at org.apache.camel.processor.UnitOfWorkProducer.process(UnitOfWorkProducer.java:73) at org.apache.camel.impl.ProducerCache$2.doInProducer(ProducerCache.java:366) at org.apache.camel.impl.ProducerCache$2.doInProducer(ProducerCache.java:1) at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:233) at org.apache.camel.impl.ProducerCache.sendExchange(ProducerCache.java:337) at org.apache.camel.impl.ProducerCache.send(ProducerCache.java:175) at org.apache.camel.impl.DefaultProducerTemplate.send(DefaultProducerTemplate.java:111) at org.apache.camel.impl.DefaultProducerTemplate.sendBodyAndHeader(DefaultProducerTemplate.java:150) ... 31 moreCaused by: 4:  at com.jcraft.jsch.ChannelSftp.cd(ChannelSftp.java:332) at org.apache.camel.component.file.remote.SftpOperations.doChangeDirectory(SftpOperations.java:534) ... 46 moreCaused by: java.io.IOException: Pipe closed at java.io.PipedInputStream.read(Unknown Source) at java.io.PipedInputStream.read(Unknown Source) at com.jcraft.jsch.ChannelSftp.fill(ChannelSftp.java:2665) at com.jcraft.jsch.ChannelSftp.header(ChannelSftp.java:2691) at com.jcraft.jsch.ChannelSftp._realpath(ChannelSftp.java:2148) at com.jcraft.jsch.ChannelSftp.cd(ChannelSftp.java:315) ... 47 more,0,0
Predicates from java dsl are not dumped to xml correctly,Predicates defined in the java dsl are not dumped to xml when using jmx.Eg  this java dsl route:from('seda:a').choice().when(header('test').isNotNull()).log('not null').end().to('mock:a');Will be dumped as this:&lt;?xml version='1.0' encoding='UTF-8' standalone='yes'?&gt;&lt;route group='com.example.TestRoute' id='route1' xmlns='http://camel.apache.org/schema/spring'&gt; &lt;from uri='seda:a'/&gt; &lt;choice id='choice23'&gt; &lt;when id='when24'&gt; &lt;expressionDefinition/&gt; &lt;log message='not null' id='log20'/&gt; &lt;/when&gt; &lt;/choice&gt; &lt;to uri='mock:a' id='to17'/&gt;&lt;/route&gt;The &lt;expressionDefinition&gt; element should contain the expression.This seems similar to CAMEL-4733.,0,0
camel-cmis component: test packages have the wrong name,Unit tests for camel-cmis are under package org.apache.camel.componenet instead of org.apache.camel.componentActions:1) Rename folder src/test/java/org/apache/camel/componenet to src/test/java/org/apache/camel/component/2) Fix the package name in each unit testAffected version: 2.12-SNAPSHOT and before,0,0
camel-cxf ClassCastException when use cxf FailoverFeature,With PAYLOAD data format used  the first element in argument is casted to a CxfPayload instance and the argument is changed into a List&lt;DOMSource&gt; instance by the method 'setParameters' in class org.apache.camel.component.cxf.CxfEndpoint.Then FailoverFeature calls retry  the class-cast action throws a ClassCastException.btw: 'message.remove(DataFormat.class)' at the end of the method 'setParameters' dosn't work. The method 'remove' is inherited from Map  and a new message with data format PAYLOAD is created when retry.,0,0
Add ability to connect to SQS queue of different owner,Unable to connect to Amazon SQS queue owned by a different account. In B2B scenario  would like to have different accounts for owner  writer  and reader of a queue.,0,0
Support attaching to SQS queues where the user doesn't have permission to list the queues (manually build URL),Currently the code assume that the user either has permission to list all the queues on their account or run a query request to get the queue url. In situations where security is more controlled you might have permission to read/write to/from a queue but not have permission to query SQS for the URL. In these cases there needs to be a way to manually build the URL from the pieces in the configuration.,0,0
Add requestBufferSize and requestHeaderSize options for jetty,Add requestBufferSize and requestHeaderSize options for jetty server to allow configuration of allowable request header limitThis option is exposed by standalone jetty server but not exposed by camel-jetty.,0,0
SimpleLanguage.simple should detect if its a predicate and use that instead,When using predicates with the simple language static methods  then ppl should use the correct method. We should improve the javadoc  and as well add methods for easy to create predicates.See nabblehttp://camel.465427.n5.nabble.com/How-to-check-that-a-file-is-empty-tp5737256.html,0,0
SJMS component throws class cast error when used with IBM Webshpere MQ,When using the IBM MQ JMS classes and pub/sub over a TOPIC the JmsObjectFactory.createMessageConsumer method throws a cast class exception. The session is being cast to a TopicSession which for MQ it is not.Using pure jms this cast is not required as the session class is aware of the destination type.,0,0
FTP consumer - Add option to not use LIST command,If you want to download a single file  and you know the absolute name of the file  then you should be able to download the file  without using any LIST commands. As some use-cases have permissions disabled for this  so you can only download that file only.The ftp/sftp consumers should have an option to ?useList=false  so they do not use the list command.,0,0
Add allowNull option to @Converter to allow type converters to return null as valid response for special use-cases,See nabblehttp://camel.465427.n5.nabble.com/Xpath-parameter-binding-NodeList-vs-Node-tp5738067.htmlThis avoids the situation with the NodeList -&gt; Node converter that may return null the 1st time  and then its regarded as a misses for conversion in future attempts.Just be annotation the method from@Converterto:@Converter(allowNull = true)Should allow to fix this. As then the type converter registry knows that a null response is valid.,0,0
Throttler does not honor time slots after period expires,Camel's Throttler eip uses time slots to calc what tasks need to be delayed and which don't. The time slots don't take into account period elapse. See from this mailing list question:http://camel.465427.n5.nabble.com/Camel-Throttler-not-throttling-as-expected-td5738158.htmlI can recreate  and working on a patch.,0,0
Simple language - Have singleton language for better performance,We can optimize the simple language using in eg bean ognl expressions and the likes.,0,1
camel-dozer - Does not work well in OSGi Blueprint,Dozer doesnt work to well in OSGi. It seems to work with spring  but fails with OSGi blueprint.2013-08-29 14:44:51 302 | ERROR | l Console Thread | BlueprintContainerImpl | container.BlueprintContainerImpl 393 | 7 - org.apache.aries.blueprint.core - 1.1.0 | Unable to start blueprint container for bundle blueorg.osgi.service.blueprint.container.ComponentDefinitionException: Error when instantiating bean dozerMapper of class class org.dozer.DozerBeanMapper at org.apache.aries.blueprint.container.BeanRecipe.getInstance(BeanRecipe.java:333)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.blueprint.container.BeanRecipe.internalCreate2(BeanRecipe.java:806)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.blueprint.container.BeanRecipe.internalCreate(BeanRecipe.java:787)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.blueprint.di.AbstractRecipe$1.call(AbstractRecipe.java:79)[7:org.apache.aries.blueprint.core:1.1.0] at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)[:1.7.0_25] at java.util.concurrent.FutureTask.run(FutureTask.java:166)[:1.7.0_25] at org.apache.aries.blueprint.di.AbstractRecipe.create(AbstractRecipe.java:88)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.blueprint.container.BlueprintRepository.createInstances(BlueprintRepository.java:245)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.blueprint.container.BlueprintRepository.createAll(BlueprintRepository.java:183)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.blueprint.container.BlueprintContainerImpl.instantiateEagerComponents(BlueprintContainerImpl.java:668)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.blueprint.container.BlueprintContainerImpl.doRun(BlueprintContainerImpl.java:370)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.blueprint.container.BlueprintContainerImpl.run(BlueprintContainerImpl.java:261)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.blueprint.container.BlueprintExtender.createContainer(BlueprintExtender.java:259)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.blueprint.container.BlueprintExtender.modifiedBundle(BlueprintExtender.java:222)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.customizerModified(BundleHookBundleTracker.java:500)[11:org.apache.aries.util:1.1.0] at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.customizerModified(BundleHookBundleTracker.java:433)[11:org.apache.aries.util:1.1.0] at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$AbstractTracked.track(BundleHookBundleTracker.java:725)[11:org.apache.aries.util:1.1.0] at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.bundleChanged(BundleHookBundleTracker.java:463)[11:org.apache.aries.util:1.1.0] at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$BundleEventHook.event(BundleHookBundleTracker.java:422)[11:org.apache.aries.util:1.1.0] at org.apache.felix.framework.util.SecureAction.invokeBundleEventHook(SecureAction.java:1103)[org.apache.felix.framework-4.0.3.jar:] at org.apache.felix.framework.util.EventDispatcher.createWhitelistFromHooks(EventDispatcher.java:695)[org.apache.felix.framework-4.0.3.jar:] at org.apache.felix.framework.util.EventDispatcher.fireBundleEvent(EventDispatcher.java:483)[org.apache.felix.framework-4.0.3.jar:] at org.apache.felix.framework.Felix.fireBundleEvent(Felix.java:4244)[org.apache.felix.framework-4.0.3.jar:] at org.apache.felix.framework.Felix.startBundle(Felix.java:1923)[org.apache.felix.framework-4.0.3.jar:] at org.apache.felix.framework.Felix.updateBundle(Felix.java:2235)[org.apache.felix.framework-4.0.3.jar:] at org.apache.felix.framework.BundleImpl.update(BundleImpl.java:962)[org.apache.felix.framework-4.0.3.jar:] at org.apache.felix.framework.BundleImpl.update(BundleImpl.java:949)[org.apache.felix.framework-4.0.3.jar:] at org.apache.karaf.shell.osgi.UpdateBundle.doExecute(UpdateBundle.java:37)[43:org.apache.karaf.shell.osgi:2.3.2] at org.apache.karaf.shell.osgi.BundleCommand.doExecute(BundleCommand.java:42)[43:org.apache.karaf.shell.osgi:2.3.2] at org.apache.karaf.shell.console.OsgiCommandSupport.execute(OsgiCommandSupport.java:38)[14:org.apache.karaf.shell.console:2.3.2] at org.apache.felix.gogo.commands.basic.AbstractCommand.execute(AbstractCommand.java:35)[14:org.apache.karaf.shell.console:2.3.2] at org.apache.felix.gogo.runtime.CommandProxy.execute(CommandProxy.java:78)[14:org.apache.karaf.shell.console:2.3.2] at org.apache.felix.gogo.runtime.Closure.executeCmd(Closure.java:474)[14:org.apache.karaf.shell.console:2.3.2] at org.apache.felix.gogo.runtime.Closure.executeStatement(Closure.java:400)[14:org.apache.karaf.shell.console:2.3.2] at org.apache.felix.gogo.runtime.Pipe.run(Pipe.java:108)[14:org.apache.karaf.shell.console:2.3.2] at org.apache.felix.gogo.runtime.Closure.execute(Closure.java:183)[14:org.apache.karaf.shell.console:2.3.2] at org.apache.felix.gogo.runtime.Closure.execute(Closure.java:120)[14:org.apache.karaf.shell.console:2.3.2] at org.apache.felix.gogo.runtime.CommandSessionImpl.execute(CommandSessionImpl.java:89)[14:org.apache.karaf.shell.console:2.3.2] at org.apache.karaf.shell.console.jline.Console.run(Console.java:173)[14:org.apache.karaf.shell.console:2.3.2] at java.lang.Thread.run(Thread.java:724)[:1.7.0_25]Caused by: org.dozer.MappingException: java.lang.ClassNotFoundException: org.dozer.util.DefaultClassLoader at org.dozer.util.MappingUtils.throwMappingException(MappingUtils.java:82) at org.dozer.util.DefaultClassLoader.loadClass(DefaultClassLoader.java:38) at org.dozer.DozerInitializer.loadBeanType(DozerInitializer.java:115) at org.dozer.DozerInitializer.initialize(DozerInitializer.java:97) at org.dozer.DozerInitializer.init(DozerInitializer.java:74) at org.dozer.DozerBeanMapper.init(DozerBeanMapper.java:173) at org.dozer.DozerBeanMapper.&lt;init&gt;(DozerBeanMapper.java:99) at org.dozer.DozerBeanMapper.&lt;init&gt;(DozerBeanMapper.java:94) at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)[:1.7.0_25] at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)[:1.7.0_25] at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)[:1.7.0_25] at java.lang.reflect.Constructor.newInstance(Constructor.java:526)[:1.7.0_25] at org.apache.aries.blueprint.utils.ReflectionUtils.newInstance(ReflectionUtils.java:329)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.blueprint.container.BeanRecipe.newInstance(BeanRecipe.java:962)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.blueprint.container.BeanRecipe.getInstance(BeanRecipe.java:331)[7:org.apache.aries.blueprint.core:1.1.0] ... 39 moreCaused by: java.lang.ClassNotFoundException: org.dozer.util.DefaultClassLoader at java.net.URLClassLoader$1.run(URLClassLoader.java:366)[:1.7.0_25] at java.net.URLClassLoader$1.run(URLClassLoader.java:355)[:1.7.0_25] at java.security.AccessController.doPrivileged(Native Method)[:1.7.0_25] at java.net.URLClassLoader.findClass(URLClassLoader.java:354)[:1.7.0_25] at java.lang.ClassLoader.loadClass(ClassLoader.java:424)[:1.7.0_25] at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)[:1.7.0_25] at java.lang.ClassLoader.loadClass(ClassLoader.java:357)[:1.7.0_25] at java.lang.Class.forName0(Native Method)[:1.7.0_25] at java.lang.Class.forName(Class.java:270)[:1.7.0_25] at org.apache.commons.lang3.ClassUtils.getClass(ClassUtils.java:823) at org.apache.commons.lang3.ClassUtils.getClass(ClassUtils.java:889) at org.apache.commons.lang3.ClassUtils.getClass(ClassUtils.java:872) at org.dozer.util.DefaultClassLoader.loadClass(DefaultClassLoader.java:36) ... 52 more,0,0
Using simple language OGNL expressions doesn't work for Bean Binding when a field is null,The following functionality doesn't work  when one of the fields is null: http://camel.apache.org/bean-binding.htmlYou can also use the OGNL support of the Simple expression language. Now suppose the message body is an object which has a method named asXml. To invoke the asXml method we can do as follows:.bean(OrderService.class  'doSomething(${body.asXml}  ${header.high})')Instead of using .bean as shown in the examples above  you may want to use .to instead as shown:.to('bean:orderService?method=doSomething(${body.asXml}  ${header.high})')A test case is provided. Instead of getting values of fields 'foo' and 'bar' respectively  the first parameter (which should be null) receives value of pojo.toString()  while the second parameter receives the correct value.,0,0
Memory leak SoapOutInterceptor.writeSoapEnvelopeStart with security headers,When proxying the WS-Security request through camel route with CXF_MESSAGE data format  we will get the endless loop that eat up the memory.'qtp967241364-210' prio=10 tid=0x00007f1de4306800 nid=0x1c9f runnable [0x00007f1d8d451000] java.lang.Thread.State: RUNNABLE at org.apache.cxf.staxutils.W3CDOMStreamWriter.writeCharacters(W3CDOMStreamWriter.java:292) at org.apache.cxf.staxutils.DelegatingXMLStreamWriter.writeCharacters(DelegatingXMLStreamWriter.java:91) at org.apache.cxf.staxutils.StaxUtils.copy(StaxUtils.java:588) at org.apache.cxf.staxutils.StaxUtils.copy(StaxUtils.java:564) at org.apache.cxf.staxutils.StaxUtils.copy(StaxUtils.java:542) at org.apache.cxf.binding.soap.interceptor.SoapOutInterceptor.writeSoapEnvelopeStart(SoapOutInterceptor.java:160) at org.apache.cxf.binding.soap.interceptor.SoapOutInterceptor.handleMessage(SoapOutInterceptor.java:81) at org.apache.cxf.binding.soap.interceptor.SoapOutInterceptor.handleMessage(SoapOutInterceptor.java:61) at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:262) - locked &lt;0x00000000e28af4a0&gt; (a org.apache.cxf.phase.PhaseInterceptorChain) at org.apache.cxf.endpoint.ClientImpl.doInvoke(ClientImpl.java:530) at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:456) at org.apache.camel.component.cxf.CxfProducer.process(CxfProducer.java:112) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.SendProcessor$2.doInAsyncProducer(SendProcessor.java:122) at org.apache.camel.impl.ProducerCache.doInAsyncProducer(ProducerCache.java:298) at org.apache.camel.processor.SendProcessor.process(SendProcessor.java:117) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:73) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.interceptor.TraceInterceptor.process(TraceInterceptor.java:91) at org.apache.camel.processor.interceptor.HandleFaultInterceptor.process(HandleFaultInterceptor.java:41) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.fabric.FabricTraceProcessor.process(FabricTraceProcessor.java:81) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.RedeliveryErrorHandler.processErrorHandler(RedeliveryErrorHandler.java:334) at org.apache.camel.processor.RedeliveryErrorHandler.process(RedeliveryErrorHandler.java:220) at org.apache.camel.processor.interceptor.StreamCachingInterceptor.process(StreamCachingInterceptor.java:52) at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:46) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.interceptor.DefaultChannel.process(DefaultChannel.java:308) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.Pipeline.process(Pipeline.java:117) at org.apache.camel.processor.Pipeline.process(Pipeline.java:80) at org.apache.camel.processor.RouteContextProcessor.processNext(RouteContextProcessor.java:46) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.processor.UnitOfWorkProcessor.processAsync(UnitOfWorkProcessor.java:150) at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:117) at org.apache.camel.processor.RouteInflightRepositoryProcessor.processNext(RouteInflightRepositoryProcessor.java:48) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:73) at org.apache.camel.processor.DelegateAsyncProcessor.processNext(DelegateAsyncProcessor.java:99) at org.apache.camel.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:90) at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:73) at org.apache.camel.component.cxf.CxfConsumer$1.asyncInvoke(CxfConsumer.java:93) - locked &lt;0x00000000e2533d18&gt; (a org.apache.cxf.transport.http_jetty.continuations.JettyContinuationWrapper) at org.apache.camel.component.cxf.CxfConsumer$1.invoke(CxfConsumer.java:72) at org.apache.cxf.interceptor.ServiceInvokerInterceptor$1.run(ServiceInvokerInterceptor.java:58) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334) at java.util.concurrent.FutureTask.run(FutureTask.java:166) at org.apache.cxf.workqueue.SynchronousExecutor.execute(SynchronousExecutor.java:37) at org.apache.cxf.interceptor.ServiceInvokerInterceptor.handleMessage(ServiceInvokerInterceptor.java:107) - locked &lt;0x00000000e28af958&gt; (a org.apache.cxf.interceptor.ServiceInvokerInterceptor$2) at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:262) - locked &lt;0x00000000e26edb48&gt; (a org.apache.cxf.phase.PhaseInterceptorChain) at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:121) at org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:236) at org.apache.cxf.transport.servlet.ServletController.invokeDestination(ServletController.java:214) at org.apache.cxf.transport.servlet.ServletController.invoke(ServletController.java:194) at org.apache.cxf.transport.servlet.CXFNonSpringServlet.invoke(CXFNonSpringServlet.java:130) at org.apache.cxf.transport.servlet.AbstractHTTPServlet.handleRequest(AbstractHTTPServlet.java:221) at org.apache.cxf.transport.servlet.AbstractHTTPServlet.doPost(AbstractHTTPServlet.java:141) at javax.servlet.http.HttpServlet.service(HttpServlet.java:713) at org.apache.cxf.transport.servlet.AbstractHTTPServlet.service(AbstractHTTPServlet.java:197) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:606) at org.ops4j.pax.web.service.internal.HttpServiceStarted$1.invoke(HttpServiceStarted.java:182) at org.ops4j.pax.web.service.internal.$Proxy6.service(Unknown Source) at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:652) at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:447) at org.ops4j.pax.web.service.jetty.internal.HttpServiceServletHandler.doHandle(HttpServiceServletHandler.java:70) at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137) at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:534) at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:227) at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1038) at org.ops4j.pax.web.service.jetty.internal.HttpServiceContext.doHandle(HttpServiceContext.java:117) at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:374) at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:189) at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:972) at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135) at org.ops4j.pax.web.service.jetty.internal.JettyServerHandlerCollection.handle(JettyServerHandlerCollection.java:75) at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116) at org.eclipse.jetty.server.Server.handle(Server.java:363) at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:483) at org.eclipse.jetty.server.AbstractHttpConnection.content(AbstractHttpConnection.java:931) at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content(AbstractHttpConnection.java:992) at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:856) at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235) at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82) at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:627) at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:51) at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608) at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543) at java.lang.Thread.run(Thread.java:724),0,1
seda - queue size compare should use equals,See nabblehttp://camel.465427.n5.nabble.com/Camel-2-11-1-SedaComponent-issues-with-Queue-size-tp5738258.html,0,0
mbeansRegistered in DefaultManagementAgent isn't ThreadSafe,This is more or less a 'corner-case' I stumbled upon  thoughthe HashSet/HashMap (2.5/2.10 camel versions) in the DefaultManagementAgent containing the registered Mbean mbeansRegistered isn't Thread-Safe. This has been an issue for us while using the ProducerTemplate in a wrongful way  by instantiating the ProducerTemplate during every Route run. As this might be a common mistake by users I'd suggest to improve the mbeansRegistered by using a Synchronized Map.,0,0
camel-test-blueprint - Allow to register custom services in OSGi registry before Camel starts,If you have some services your Camel apps uses during testing  then its not easy to enlist them before CamelContext starts.We should allow people to enlist services from the unit test class  so they can enlist mock services / shared services that are mocked or what  so they can do their unit tests.,0,0
camel-blueprint - Using  and referrring to SSLContextParameters with property placeholders can lead to CircularDependencyException,Configuring a blueprint xml file with &lt;endpoint id='myNettyServer' uri='netty-http:http://0.0.0.0:{{port}}/foo?ssl=true&amp;amp;sslContextParameters=#mySsl'/&gt;Can lead to ciruclar exceptionsCaused by: org.apache.aries.blueprint.di.CircularDependencyException: [BeanRecipe[name='mySsl']  BeanRecipe[name='.camelBlueprint.factory.mySsl']  BeanRecipe[name='camel-4']  BeanRecipe[name='myNettyServer']  BeanRecipe[name='mySsl']] at org.apache.aries.blueprint.container.BlueprintRepository.push(BlueprintRepository.java:343)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.blueprint.di.AbstractRecipe.create(AbstractRecipe.java:71)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.blueprint.container.BlueprintRepository.createInstances(BlueprintRepository.java:245)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.blueprint.container.BlueprintRepository.createInstance(BlueprintRepository.java:230)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.blueprint.container.BlueprintRepository.create(BlueprintRepository.java:145)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.aries.blueprint.container.BlueprintContainerImpl.getComponentInstance(BlueprintContainerImpl.java:746)[7:org.apache.aries.blueprint.core:1.1.0] at org.apache.camel.blueprint.BlueprintContainerRegistry.lookupByNameAndType(BlueprintContainerRegistry.java:54) at org.apache.camel.impl.CompositeRegistry.lookupByNameAndType(CompositeRegistry.java:52) ... 125 more,0,0
DefaultStreamCachingStrategy - Check for enabled in shouldSpoolCache method,If stream caching is disabled then we should not spool to disk. This allows components and whatnot to safely use CachedOutputStream and not cause spool to disk  even if stream caching is disabled.,0,0
camel-yammer - Endpoint yammer:current throwns JsonMappingException exception,Getting org.codehaus.jackson.map.JsonMappingException: Can not deserialize instance of java.util.ArrayList out of START_OBJECT tokenwhen trying to return the current user using yammer:current. Workaround is to just add ?useJson=true and do marshaling manually. Fixing on master shortly.,0,0
Installation of camel-stomp feature fails,Christians-MacBook-Pro:bin cmueller$ ./karaf clean __ __ ____ / //_/____ __________ _/ __/ /  &lt; / __ '/ ___/ __ '/ /_ / /| |/ /_/ / / / /_/ / __/ /_/ |_|/__ _/_/ /__ _/_/ Apache Karaf (2.3.2)Hit '&lt;tab&gt;' for a list of available commandsand '[cmd] --help' for help on a specific command.Hit '&lt;ctrl-d&gt;' or type 'osgi:shutdown' or 'logout' to shutdown Karaf.karaf@root&gt; features:chooseurl camel 2.12.0adding feature url mvn:org.apache.camel.karaf/apache-camel/2.12.0/xml/featureskaraf@root&gt; features:install camel-stompError executing command: Could not start bundle mvn:org.apache.geronimo.specs/geronimo-jms_1.1_spec/1.1.1 in feature(s) spring-jms-3.1.4.RELEASE  camel-spring-ws-2.12.0  spring-jms-3.2.3.RELEASE  spring-jms-3.0.7.RELEASE  camel-jms-2.12.0  camel-bam-2.12.0  camel-stomp-2.12.0  camel-sjms-2.12.0  camel-jpa-2.12.0: Unresolved constraint in bundle org.apache.geronimo.specs.geronimo-jms_1.1_spec [62]: Unable to resolve 62.0: missing requirement [62.0] osgi.wiring.package; (osgi.wiring.package=javax.transaction.xa),0,0
binding component - Should start/stop its child services,We should ensure all the child services the binding component create is also started/stopped so they can do initialization logic.,0,1
Add cache option to beanRef and  in the DSL,Added cache option to beanRef and &lt;bean&gt; in the DSL. This avoids looking up the Bean from the Registry on each usage; this can safely be done for singleton beans.,0,1
Camel-Redis: Serializer passed through URI is used only on consumer,Please add camel-redis componentThe serializer passed through URI is used only on consumer and not on producer. Beside been unexpected and undocumented I think it can cause problems on interacting with the Redis DB if the same serializer is not used in both ways.You can find the example and discussion of this problem on this thread on the forum:http://camel.465427.n5.nabble.com/camel-redis-strings-serialization-td5738994.htmlI put as minor because from the discussion it looks like it is possible to have a workaround using a RedisTemplate.,0,0
XML Signature Component: Stream not closed in XmlSignerHelper.getXslTransform(String path),Component camel-xmlsecurity: InputStream is not closed after it is read in method XmlSignerHelper.getXslTransform(String path),0,1
camel-jt400 - no longer able to configure a pollStrategy on Jt400DataQueueEndpoint,With camel 2.11.0 we were able to configure a pollStrategy in the URL of an endpoint consuming information from a data queue.After upgrading to 2.12.0 we get an exception during camel startup stating 'Unknown consumer parameters=[{pollStrategy=#jt400PollStrategy}]'. The application no longer starts.Downgrading to 2.11.0 allows the application to be started normally.The problem seems to originate from the fact that Camel (in DefaultPollingEndpoint.createConsumer()) creates a new DefaultScheduledPollConsumer  which gets the poll strategy (no problem). Then afterwards in Jt400DataQueueEndpoint.createPollingConsumer() a Jt400DataQueueConsumer is created and inside configureConsumer() normal flow is stopped because there is no pollStrategy property in a Jt400DataQueueConsumer  and there is an entry for this property in the endpoint's consumerProperties map.I suspect that the consumerProperty pollStrategy should be removed from the endpoint's consumerProperties after it has been set on the DefaultScheduledPollConsumer...,0,0
mustache component - Should use app class loader to load templates,It uses the TCCL to load the templates. We should use the App CL which then would allow to better load templates from OSGi.,0,0
Bean binding to covariant methods throws AmbiguousMethodCallException,Attached is a patch and test case for an issue in the bean binding code which prevents binding to an overloaded method with a covariant return type from the base class. The fix is to check for method covariance at the last moment before throwing AmbiguousMethodCallException. If all methods remaining are covariant  any one of them can be called. Unfortunately this happens in 3 places in the code- if we pre-filtered the list of methods then we could lose annotations on either of the method signature which could be problematic depending on the resolution type.,0,0
UnitUtilsTest cant manage a locale different from US,When locale is set to a language different from english (for example italian)  the unit test in org.apache.camel.util.UnitUtilsTest fail  because in the italian locale the decimal separator is the comma  not the dot.The test compare the results of printUnitFromBytes to static strings formatted with the dot  and in an italian locale fails because it espects '1.0' and get instead '1 0'.I have patched the test code to make it works in every locale (building the expected results with the current locale decimal separator)  and i have attached the patch to this issue.,0,0
scp task does not respect StrictHostKeyChecking option,The SCP component does not currently do anything with the StrictHostKeyChecking option  as documented. The attached patch fixes this (no test case I'm afraid).,0,0
Null Pointer exception when removing SjmsComponent,NullPointer exception in SjmsComponent when trying to remove it from camel context:2013-09-16 11:51:54 201 &#91;WARN&#93; org.apache.camel.impl.DefaultCamelContext.removeComponent(DefaultCamelContext.java:388):org.apache.camel.spring.SpringCamelContext: Error stopping component org.apache.camel.component.sjms.SjmsComponent@232560ec. This exception will be ignored.java.lang.NullPointerException at org.apache.camel.component.sjms.SjmsComponent.doStop(SjmsComponent.java:143) at org.apache.camel.support.ServiceSupport.stop(ServiceSupport.java:102) at org.apache.camel.util.ServiceHelper.stopService(ServiceHelper.java:116) at org.apache.camel.impl.DefaultCamelContext.stopServices(DefaultCamelContext.java:1902) at org.apache.camel.impl.DefaultCamelContext.removeComponent(DefaultCamelContext.java:386),0,0
HttpConnectionManagerParams doesn't take effect when it is set to HttpComponent,Here is the user complain.It is caused by the patch of CAMEL-6296 which override the setting of HttpConnectionManagerParams.,0,0
InterceptFrom - Add support for using property placeholders,InterceptFrom does not support property placeholders. We should add support for that.Seehttp://camel.465427.n5.nabble.com/Usage-of-property-placeholders-in-the-interceptFrom-String-method-calls-tp5739273.html,0,0
rabbitmq component sends basic ack after channel closed when endpoint is set to autoAck,Consuming from a rabbitmq endpoint uri that is configured to autoAck generates errors and fails.Example URI: rabbitmq://localhost:5672/test?autoAck=true&amp;queue=test&amp;autoDelete=false&amp;username=guest&amp;password=guestHere's the relevant log output:12:19:03.746 - osis-ht TRACE o.a.c.c.rabbitmq.RabbitMQConsumer - Acknowleding receipt &#91;delivery_tag=10&#93;12:19:03.747 - osis-ht WARN o.a.c.c.rabbitmq.RabbitMQConsumer - Error processing exchange. Exchange&#91;Message: WTF-9-1379531943713&#93;. Caused by: &#91;com.rabbitmq.client.AlreadyClosedException - clean connection shutdown; reason: Attempt to use closed channel&#93;com.rabbitmq.client.AlreadyClosedException: clean connection shutdown; reason: Attempt to use closed channel at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:190) ~&#91;amqp-client-3.1.3.jar:na&#93; at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:291) ~&#91;amqp-client-3.1.3.jar:na&#93; at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:285) ~&#91;amqp-client-3.1.3.jar:na&#93; at com.rabbitmq.client.impl.ChannelN.basicAck(ChannelN.java:907) ~&#91;amqp-client-3.1.3.jar:na&#93; at org.apache.camel.component.rabbitmq.RabbitMQConsumer$RabbitConsumer.handleDelivery(RabbitMQConsumer.java:126) ~&#91;camel-rabbitmq-2.12.0.jar:2.12.0&#93; at com.rabbitmq.client.impl.ConsumerDispatcher$4.run(ConsumerDispatcher.java:121) &#91;amqp-client-3.1.3.jar:na&#93; at com.rabbitmq.client.impl.ConsumerWorkService$WorkPoolRunnable.run(ConsumerWorkService.java:76) &#91;amqp-client-3.1.3.jar:na&#93; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) &#91;na:1.7.0_21&#93; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) &#91;na:1.7.0_21&#93; at java.lang.Thread.run(Thread.java:722) &#91;na:1.7.0_21&#93;,0,0
Network Server Protocol error when select fails and 'order by' is specified,Reporting for Army  filed on derby-dev list.If  when using the Network Server  one tries to execute a select statement that fails because of an SQL exception (ex. divide-by-zero)  and if an 'order by' clause is specified as part of the select  the server will throw a distributed protocol exception  instead of the appropriate error.Repro (using the 'ij' utility)ij&gt; connect 'jdbc:derby:net://localhost:1527/myDB:user=u;password=p;';ij&gt; create table t1 (i int  j int);0 rows inserted/updated/deletedij&gt; insert into t1 values (2 0);1 row inserted/updated/deleted&#8211; Without an 'order by' it's fine...&#8211; (22012 ==&gt; 'Attempt to divide by zero.'  which is fine)ij&gt; select {fn mod(i j)} from t1;1-----------ERROR 22012: DB2 SQL error: SQLCODE: -1  SQLSTATE: 22012  SQLERRMC: 22012&#8211; With an order by  it dies...ij&gt; select {fn mod(i j)} from t1 order by 1;ERROR 58009: Execution failed due to a distribution protocol error that caused deallocation of the conversation. A DRDA Data Stream Syntax Error was detected. Reason: 0x13NOTES:The problem is in the DRDAConnThread.java file  'processCommands(...)' method  in the 'case CodePoint.OPNQRY' block of code. In the case of an SQL exception  there's a call to 'writer.clearBuffer()' that is used to ensure that only an OPNQFLRM is sent back to the client  not the OPNQRYRM and/or QRYDSC that may have been written to buffer before the OPNQFLRM. That call to 'clearBuffer' has to be replaced with something smarter  so that instead of doing a full clear (which causes the problem shown above)  it only backs out the buffer writes that it has made since beginning the 'case CodePoint.OPNQRY' block...,0,0
NPE when trying to create a database at a directory that is not allowed,Opening this bug on behalf of Daniel Debrunner--------------------------------------------------------------This bug occurs in embedded Derby and Derby Network Server. In Derby Network Server  it might be best for a security exception to be thrown when trying to create a database at a disallowed directory (SQLSTATE 38000).This bug can be reproduced in IJ like so:(if your 'D' drive is an inaccessible disk. e.g. your CD-ROM)ij&gt; connect 'jdbc:derby:d:/wombat2;create=true';ERROR XJ041: Failed to create database 'd:/wombat2',0,0
Make LOCKS as non-reserved keyword in Derby since it is not a reserved keyword in the SQL standards,Since LOCKS is not a reserved keyword in SQL standards  Derby should not make LOCKS as reserved keyword.,0,0
When using encryption  do not store the length information about the external key in service.properties,When using derby database encryption there is a provision to provide the key to be used for encryption as an external key. In this case the key is not stored in the database for added security. There should not be any useful information about the external key that was used for encrypting the database in the service.properties.Right now  key length is stored in service.properties. This should not be stored in service.properties.,1,0
Support for like ? Escape ?,Request to have support forSelect * from foo where like ? escape ?This functionality works with other JDBC/RDBMS combos including DB2/DB2 universal driver.This functionality is beneficial for tools as well as appservers for generating the SQL from EJBQL,0,0
Request support for CAST() in Like clause,Request support for CAST() in like clause for example:select t0.ID  t0.QUANTITY  t0.NAME  t0.PRICE  t0.PNUM from PRODUCTEJB_TABLE t0 where t0.NAME like CAST (? AS VARCHAR(32672))This is supported by DB2 and will ease migration between DB2 and Derby,0,0
NPE when creating a trigger on a table and default schema doesn't exist.,BACKGROUND:When connecting to a Derby db with a user id and password  the default schema is USER. For example  if I connect with:ij&gt; connect 'jdbc:derby:myDB;user=someUser;password=somePwd';then the default schema is 'SOMEUSER'.PROBLEM:It turns out that if a table t1 exists in a non-default schema and the default schema (in this case  'SOMEUSER') doesn't exist yet (because no objects have been created in that schema)  then attempts to create a trigger on t1 using its qualified name will lead to a null pointer exception in the Derby engine.REPRO:In ij:&#8211; Create database with default schema 'SOMEUSER'.ij&gt; connect 'jdbc:derby:myDB;create=true;user=someUser;password=somePwd';&#8211; Create table t1 in a non-default schema; in this case  call it 'ITKO'.ij&gt; create table itko.t1 (i int);0 rows inserted/updated/deleted&#8211; Now schema ITKO exists  and T1 exists in schema ITKO  but default schema SOMEUSER does NOT exist  because we haven't created any objects in that schema yet.&#8211; So now we try to create a trigger in the ITKO (i.e. the non-default) schema...ij&gt; create trigger trig1 after update on itko.t1 for each row mode db2sql select * from sys.systables;ERROR XJ001: Java exception: ': java.lang.NullPointerException'.A look at the derby.log file shows the stack trace given below. In a word  it looks like the 'compilation schema' field of SYS.SYSTRIGGERS isn't getting set  and so it ends up being null. That causes the NPE in subsequent processing...java.lang.NullPointerException at org.apache.derby.impl.sql.catalog.SYSSTATEMENTSRowFactory.makeSYSSTATEMENTSrow(SYSSTATEMENTSRowFactory.java:200) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.addSPSDescriptor(DataDictionaryImpl.java:2890) at org.apache.derby.impl.sql.execute.CreateTriggerConstantAction.createSPS(CreateTriggerConstantAction.java:354) at org.apache.derby.impl.sql.execute.CreateTriggerConstantAction.executeConstantAction(CreateTriggerConstantAction.java:258) at org.apache.derby.impl.sql.execute.MiscResultSet.open(MiscResultSet.java:56) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:366) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1100) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:509) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:467) at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:299) at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:433) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:310) at org.apache.derby.impl.tools.ij.Main.go(Main.java:210) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:176) at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:56) at org.apache.derby.tools.ij.main(ij.java:60),0,0
RunSuite summary rounds incorrectly,Example output from RunSuite in the report file203 Tests Run100% Pass (202 tests passed) 0% Fail (1 tests failed)A single failure should not lead to 0% fail and 100% pass.Should round down on pass percentage and round up on fail percentage.,0,0
dblook displays message keys instead of their associated text,Using Derby version 10.0.2.1 - (106978)  when I execute java org.apache.derby.tools.dblookinstead of getting the usage message  I get CSLOOK_UsageSimilarly  when using dblook to generate database schema  the output text contains keys such as the one above  instead of their associated text. e.g.&#8211; CSLOOK_Timestamp  &lt;2004-12-04 19:22:57.038&gt;&#8211; CSLOOK_DBName  &lt;sample&gt;&#8211; CSLOOK_DBUrl  &lt;jdbc:derby:sample&gt;&#8211; appendLogs: false&#8211; ----------------------------------------------&#8211; CSLOOK_SchemasHeader&#8211; ----------------------------------------------CREATE SCHEMA 'SAMP';&#8211; ----------------------------------------------&#8211; CSLOOK_TablesHeader&#8211; ----------------------------------------------CREATE TABLE 'SAMP'.'IN_TRAY' ('RECEIVED' TIMESTAMP  'SOURCE' CHAR(8)  'SUBJECT' CHAR(64)  'NOTE_TEXT' VARCHAR(3000));,0,0
Lock not being released properly  possibly related to occurence of lock escalation,In the following scenario: &lt;code snippet&gt; String sel = 'select * from t1 FOR UPDATE of i2'; PreparedStatement ps1 = conn.prepareStatement (sel); int val = 300; ps1.setMaxRows(val); ResultSet rs = ps1.executeQuery(); String ins = 'Update t1 set i2=? WHERE CURRENT OF '+rs.getCursorName() ; PreparedStatement ps2 = conn.prepareStatement(ins); ps2.setInt(1 iteration); while(rs.next()) { ps2.executeUpdate(); }; // print lock table information System.out.println('Lock Table before commit transaction'); printLockTable(conn); conn.commit();&lt;end code snippet&gt;Running the above transaction twice causes a lock timeout the second time.It seems like locks are not being released properly on the table even after the transaction commits and the connection is closed. Also  this condition seems to happen only when lock escalation to table lock occurs. By increasing lock escalation threshold to prevent lock escalation and with only row level locking  the locks are released properly.I printed out the locks information and see a U row level lock on the table   and also a table level lock as a result of lock escalation. After commit  and resultset being closed  the U row level lock is not released. Thus in the second iteration of the test  the unreleased U row level lock causes a lock timeout to happen. In case of the second iteration of the test  the lock table shows the previous U row lock with a null transaction id. This is not right. The transactions are running at the default isolation level ( read committed).By default  the lock escalation threshold is set to 5000http://incubator.apache.org/derby/manuals/tuning/perf80.html#IDX547I will be attaching the program for reproduction. To reproduce the problem with less number of rows in the table  please run the program with the following derby properties set derby.locks.deadlockTrace=truederby.locks.escalationThreshold=110,0,0
Add support for insert functionality using JDBC 2.0 updatable resultset apis,The JDBC 2.0 API introduced the ability to update/delete/insert rows from a resultset using methods in the Java programming language rather than having to send an SQL command. This Jira entry is to track the insert rows functionality using JDBC 2.0 apis.,0,0
[PATCH] Improvements on the NetServlet,Hi all I did some minor enhancements on the Net Servlet: changed Cloudscape to Derby in the i18n bundles added pt_BT to know languages (the bundle was already there  but the language was not set at the .java)  improved use of tracingDirectory: init-parameter is now used (it was documented but not used before) current value is shown when the user try to change it improved function that handles the request locale (for instance  mozilla uses a - instead of _ to separate the country from language) shows on the screen which port the server is running on added a new SRV_POrtNumber message key for such infoSo  I'm sending a trunk patch with such changes.&#8211; Felipe,0,0
Suite jdk14 is skipped incorrectly with J2SE 5.0,Since J2SE 5.0 is a super set of JDK 1.4  and JDK1.4 tests should run in J2SE5.0,0,0
Derby incorrectly rounds double values down during insert into NUMERIC,When inserting a double value into a field defined as NUMERIC(a b) using PreparedStatement.setDouble()  Derby may incorrectly round the number down. For example  a NUMERIC(5 2) field with a double = 4.64 ends up with a value of 4.63 in the database. This works fine in Oracle and other databases.The problem occurs because double cannot represent 4.64 exactly  so the actual value is 4.6399999... SQLDecimal.setCoreValue uses BigDecimal(double) which constructs a BigDecimal of 4.6399999... and then SQLDecimal.setWidth uses value.setScale(desiredScale  BigDecimal.ROUND_DOWN); Note that BigDecimal javadoc recommends that the double constructor be avoided for this reason.One fix appears to be to change SQLDecimal.setCoreValue(double) to avoid using the double constructor of BigDecimal. Using Double.toString() and BigDecimal(String) looks as if it would work as expected  because Double.toString() has 'special rounding abilities' and converts 4.639999... back to 4.64.,0,0
Aliased Columns not recognized after 'group by... order by' combination,I've been doing work to try and integrate Derby with the Mondrian ROLAP engine  which has uncovered a bug in Derby when a query involves column aliasing  a group by clause  and an order by clause.For example: Mondrian will generate the following query:select STORE.STORE_COUNTRY as c0  STORE.STORE_STATE as c1  STORE.STORE_CITY as c2  STORE.STORE_NAME as c3  STORE.STORE_TYPE as c4  STORE.STORE_MANAGER as c5  STORE.STORE_SQFT as c6  STORE.GROCERY_SQFT as c7  STORE.FROZEN_SQFT as c8  STORE.MEAT_SQFT as c9  STORE.COFFEE_BAR as c10  STORE.STORE_STREET_ADDRESS as c11 from STORE as STORE group by STORE.STORE_COUNTRY  STORE.STORE_STATE  STORE.STORE_CITY  STORE.STORE_NAME  STORE.STORE_TYPE  STORE.STORE_MANAGER  STORE.STORE_SQFT  STORE.GROCERY_SQFT  STORE.FROZEN_SQFT  STORE.MEAT_SQFT  STORE.COFFEE_BAR  STORE.STORE_STREET_ADDRESS order by STORE.STORE_COUNTRY  STORE.STORE_STATE  STORE.STORE_CITY  STORE.STORE_NAMEwhich should be valid SQL. I have tested this query outside of the Mondrian environment and still receive the same error which is:'Column 'STORE.STORE_COUNTRY' is not in any table in the FROM list or it appears within a join specification and is outside the scope of the join specification or it appears in a HAVING clause and is not in the GROUP BY list.SQL State: 42x04Error Code: 30000However  if I remove any one of the three elements (aliasing  group by  order by) or if the order by uses the aliased names  the query works. It is only the combination of all 3 elements that is causing a problem.&#91;ie. all of the following queries work correctly&#93;select STORE.STORE_COUNTRY   STORE.STORE_STATE   STORE.STORE_CITY   STORE.STORE_NAME   STORE.STORE_TYPE   STORE.STORE_MANAGER   STORE.STORE_SQFT   STORE.GROCERY_SQFT   STORE.FROZEN_SQFT   STORE.MEAT_SQFT   STORE.COFFEE_BAR   STORE.STORE_STREET_ADDRESS from STORE as STORE group by STORE.STORE_COUNTRY  STORE.STORE_STATE  STORE.STORE_CITY  STORE.STORE_NAME  STORE.STORE_TYPE  STORE.STORE_MANAGER  STORE.STORE_SQFT  STORE.GROCERY_SQFT  STORE.FROZEN_SQFT  STORE.MEAT_SQFT  STORE.COFFEE_BAR  STORE.STORE_STREET_ADDRESS order by STORE.STORE_COUNTRY  STORE.STORE_STATE  STORE.STORE_CITY  STORE.STORE_NAMEselect STORE.STORE_COUNTRY as c0  STORE.STORE_STATE as c1  STORE.STORE_CITY as c2  STORE.STORE_NAME as c3  STORE.STORE_TYPE as c4  STORE.STORE_MANAGER as c5  STORE.STORE_SQFT as c6  STORE.GROCERY_SQFT as c7  STORE.FROZEN_SQFT as c8  STORE.MEAT_SQFT as c9  STORE.COFFEE_BAR as c10  STORE.STORE_STREET_ADDRESS as c11 from STORE as STORE group by STORE.STORE_COUNTRY  STORE.STORE_STATE  STORE.STORE_CITY  STORE.STORE_NAME  STORE.STORE_TYPE  STORE.STORE_MANAGER  STORE.STORE_SQFT  STORE.GROCERY_SQFT  STORE.FROZEN_SQFT  STORE.MEAT_SQFT  STORE.COFFEE_BAR  STORE.STORE_STREET_ADDRESSselect STORE.STORE_COUNTRY as c0  STORE.STORE_STATE as c1  STORE.STORE_CITY as c2  STORE.STORE_NAME as c3  STORE.STORE_TYPE as c4  STORE.STORE_MANAGER as c5  STORE.STORE_SQFT as c6  STORE.GROCERY_SQFT as c7  STORE.FROZEN_SQFT as c8  STORE.MEAT_SQFT as c9  STORE.COFFEE_BAR as c10  STORE.STORE_STREET_ADDRESS as c11 from STORE as STORE order by STORE.STORE_COUNTRY  STORE.STORE_STATE  STORE.STORE_CITY  STORE.STORE_NAMEselect STORE.STORE_COUNTRY as c0  STORE.STORE_STATE as c1  STORE.STORE_CITY as c2  STORE.STORE_NAME as c3  STORE.STORE_TYPE as c4  STORE.STORE_MANAGER as c5  STORE.STORE_SQFT as c6  STORE.GROCERY_SQFT as c7  STORE.FROZEN_SQFT as c8  STORE.MEAT_SQFT as c9  STORE.COFFEE_BAR as c10  STORE.STORE_STREET_ADDRESS as c11 from STORE as STORE group by STORE.STORE_COUNTRY  STORE.STORE_STATE  STORE.STORE_CITY  STORE.STORE_NAME  STORE.STORE_TYPE  STORE.STORE_MANAGER  STORE.STORE_SQFT  STORE.GROCERY_SQFT  STORE.FROZEN_SQFT  STORE.MEAT_SQFT  STORE.COFFEE_BAR  STORE.STORE_STREET_ADDRESS order by c0 c1 c2 c3,0,0
Network Server Gives NPE if SQLException has null arguments   (e.g. for ERROR XBM0H),Network server  Network Server throws an NPE because one of the arguments of the SQLException is null. It shouldn't do so.To reproduce try to create a database in the root directory on Linux. Do not run in security manager. The trace below came from an extra '/' in the url in NSinSameJVM.javaThe issues are:1) Network Server throws an NPE because one of the arguments of the SQLException is null in this code. It shouldn't do so.// arguments are variable part of a message Object[] args = ce.getArguments(); for (int i = 0; args != null &amp;&amp; i &lt; args.length; i++) sqlerrmc += args&#91;i&#93;.toString() + separator;2) This exception seems to have null arguments which doesn't seem right. ERROR XBM0H: Directory /NSinSameJVMTestDB cannot be created.ERROR XBM0H: Directory /NSinSameJVMTestDB cannot be created. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:322) at org.apache.derby.impl.services.monitor.PersistentServiceImpl$8.run(PersistentServiceImpl.java:668) at java.security.AccessController.doPrivileged(Native Method) at org.apache.derby.impl.services.monitor.PersistentServiceImpl.createServiceRoot(PersistentServiceImpl.java:632) at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1756) at org.apache.derby.impl.services.monitor.BaseMonitor.createPersistentService(BaseMonitor.java:1018) at org.apache.derby.iapi.services.monitor.Monitor.createPersistentService(Monitor.java:578) at org.apache.derby.impl.jdbc.EmbedConnection.createDatabase(EmbedConnection.java:1504) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(EmbedConnection.java:215) at org.apache.derby.impl.jdbc.EmbedConnection20.&lt;init&gt;(EmbedConnection20.java:56) at org.apache.derby.impl.jdbc.EmbedConnection30.&lt;init&gt;(EmbedConnection30.java:72) at org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Driver30.java:73) at org.apache.derby.jdbc.Driver169.connect(Driver169.java:175) at org.apache.derby.impl.drda.Database.makeConnection(Database.java:245) at org.apache.derby.impl.drda.DRDAConnThread.getConnFromDatabaseName(DRDAConnThread.java:1160) at org.apache.derby.impl.drda.DRDAConnThread.verifyUserIdPassword(DRDAConnThread.java:1138) at org.apache.derby.impl.drda.DRDAConnThread.parseSECCHK(DRDAConnThread.java:2613) at org.apache.derby.impl.drda.DRDAConnThread.parseDRDAConnection(DRDAConnThread.java:1001) at org.apache.derby.impl.drda.DRDAConnThread.exchangeServerAttributes(DRDAConnThread.java:950) at org.apache.derby.impl.drda.DRDAConnThread.sessionInitialState(DRDAConnThread.java:563) at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:219)Cleanup action completed2005-01-21 01:12:12.794 GMT Thread&#91;DRDAConnThread_2 5 derby.daemons&#93; (DATABASE = /NSinSameJVMTestDB)  (DRDAID = {2})  Failed to create database '/NSinSameJVMTestDB'  see the next exception for details.2005-01-21 01:12:12.795 GMT Thread&#91;DRDAConnThread_2 5 derby.daemons&#93; (DATABASE = /NSinSameJVMTestDB)  (DRDAID = {2})  Directory /NSinSameJVMTestDB cannot be created.2005-01-21 01:12:12.816 GMT Thread&#91;DRDAConnThread_2 5 derby.daemons&#93; (DATABASE = /NSinSameJVMTestDB)  (DRDAID = NF000001.A9FB-4124733202448020360{2})  Failed to create database '/NSinSameJVMTestDB'  see the next exception for details.2005-01-21 01:12:12.816 GMT Thread&#91;DRDAConnThread_2 5 derby.daemons&#93; (DATABASE = /NSinSameJVMTestDB)  (DRDAID = NF000001.A9FB-4124733202448020360{2})  nullnulljava.lang.NullPointerException at org.apache.derby.impl.drda.DRDAConnThread.writeSQLCAGRP(DRDAConnThread.java:5076) at org.apache.derby.impl.drda.DRDAConnThread.writeSQLCARD(DRDAConnThread.java:4882) at org.apache.derby.impl.drda.DRDAConnThread.parseDRDAConnection(DRDAConnThread.java:1042) at org.apache.derby.impl.drda.DRDAConnThread.exchangeServerAttributes(DRDAConnThread.java:950) at org.apache.derby.impl.drda.DRDAConnThread.sessionInitialState(DRDAConnThread.java:563) at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:219)nulljava.lang.NullPointerException at org.apache.derby.impl.drda.DRDAConnThread.writeSQLCAGRP(DRDAConnThread.java:5076) at org.apache.derby.impl.drda.DRDAConnThread.writeSQLCARD(DRDAConnThread.java:4882) at org.apache.derby.impl.drda.DRDAConnThread.parseDRDAConnection(DRDAConnThread.java:1042) at org.apache.derby.impl.drda.DRDAConnThread.exchangeServerAttributes(DRDAConnThread.java:950) at org.apache.derby.impl.drda.DRDAConnThread.sessionInitialState(DRDAConnThread.java:563) at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:219),0,0
Derby should throw a truncation error or warning when CASTing a parameter/constant to char or char for bit datatypes and the data is too large for the datatype.,Derby doesn't throw a truncation exception/warning when data is too large during casting of constants or parameters to character string or bit string data types. Following is ij example for constants which is too big for the datatype it is getting cast toij&gt; values (cast ('hello' as char(3)));1hel1 row selectedij&gt; values (cast (X'0102' as char(1) for bit data));1011 row selectedFollowing code snippet is when using parameters through a JDBC program s.executeUpdate('create table ct (c CLOB(100K))'); //the following Formatters just loads cData with 32700 'c' characters String cData = org.apache.derbyTesting.functionTests.util.Formatters.repeatChar('c' 32700); //notice that ? in the preared statement below is bound to length 32672 pSt = con.prepareStatement('insert into ct values (cast (? as varchar(32672)))'); pSt.setString(1  cData); //Derby doesn't throw an exception at ps.execute time for 32700 characters into 32672 parameter. It silently truncates it to 32672 pSt.execute();,0,0
in place table/index compress which returns space to OS,Each derby table or index is stored in a separate file. Space fromdeleted rows is eventually reclaimed within the file as is used forsubsequent inserts into the same file. That space is not returned tothe OS unless the user calls the SYSCS_UTIL.SYSCS_COMPRESS_TABLEsystem procedure. That procedure will return the unused space inthe tables and indexes to the OS. It gets an exclusive lock on thetable  copies all rows in the indexes and the base table into newcompressed files and delete the old files. Prior to jdk 1.4 this wasthe only way to return space from a file to the OS.In jdk 1.4 RandomAccessFile was enhanced to allow the truncation of afile  which would return the space at the 'end' of the file back tothe OS. In order to take advantage of this new feature a newcompress feature is needed in derby.The assumption is that this work will be used in future work which willautomatically schedule this job and others in background  with nointeraction needed from the dba. The 1st phase of this work willsimply build a procedure that will do the work. The 2nd phase willbe to look into scheduling the procedure automatically as part ofthe current background post commit processing. Longer term it wouldbe best if this fit into a new background task monitor  which couldschedule larger background tasks balanced against the other prioritiesof the system. These tasks might include: this new online compress automatic statistics gathering  more proactive deleted row reclamation  ....The proposed feature will reorganize base tables and indexes  movingempty pages to the 'end'. It will release space back to the operatingsystem when it has created a chunk of empty pages at the end of thefile. It will be designed to run in background  and will lock resourcesof the table for as short a time as possible so that it can iterativelyprocess the table.To reclaim space in the heap  it will scan the heap in page reverse order.It will get a short term table lock  process all the rows on a page  andthen commit that transaction releasing the lock. The commit will beoptimized like other internal transactions  and will not need to waitfor a synchonized write. Each row moved  will require all the indexentries for that row to also be updated. While doing the processing itwill also take care of processing committed deleted rows. When spaceis free at the end of the table it will be freed back to the operatingsystem  using the RandomAccessFile.setLength() interface.To reclaim space in the btree  data on pages will be moved rather thanrows. Data from pages at the end of the file will be moved to freesmaller numbered pages. Again short term table locks will be required and the operation will look similar to the current btree merge operationsalready implemented. Again when a chunk of pages is free at the end ofthe file  they will be returned to the OS using the same mechanism asthe heap.,0,1
Bad Eclipse plugin version specification,In the plugin.xml of the Derby Eclipse plugin  the version specification reads '10.1.0.0 (124830)'  which Eclipse complains about as being illegal. In consequence  the plugin is not loaded.The Eclipse docs have the following to say about the version specification: 'Plug-in version format is major.minor.service.qualifier'.Stripping the '(1234830)'  whatever that is anyway  solves the problem.,0,0
Inserting values in an identity column,It is not possible to insert a specific value in a column defined as identity. This makes it very hard to migrate from other RDBMSs or to import data dumped from other databases. For example  an autoincrement column in MySQL should be an identity column. The problem is that when the data is dumped from MySQL to a file  it generates inserts with values. These values cant be inserted in the Derby table. Posible solutions: 1. being able to 'generate by default as identity' 2. being able to disable the 'identity' feature for a column 3. being able to generate a column as non identity and after data is populated  alter table to add the 'identity' to the column.,0,0
For the concurrency of ResultSet  Network Server should not send the concurrency of Statement.,I am working on getting updatable resulset functionality to work under Network Server. One issue that I found is Network Server sends the concurrency of the Statement object when it really needs to send the concurrency of the Resultset. This was ok in the past because CONCUR_READ_ONLY was the only concurreny supported by Derby. But  now with the support of CONCUR_UPDATABLE  it is possible that the concurrency of ResultSet might not be same as the Statement object. Hence  Network Server should send the concurrency of the ResultSet object if that is what the protocol calls for.The fix for this is localized in java/drda/org/apache/derby/impl/drda/DRDAConnThread.java.,0,0
setNull does not work with java.sql.Types.TIMESTAMP,Calling setNull(x java.sql.Types.TIMESTAMP) throws an exception with the following message.( x is the column number)Message is: ' An attempt was made to get a data value of type 'TIMESTAMP' from a data value of type 'null''.,0,0
Parameter names required in CREATE FUNCTION,A statement like create function s2.f2( char(8)  integer) returns int language java parameter style java external name 'myclass.mymethod'fails with the message ERROR 42X01: Syntax error: Encountered 'char' at line 1  column 24However create function s2.f2( p1 char(8)  p2 integer) returns int language java parameter style java external name 'myclass.mymethod'is accepted.The Derby documentation (at http://incubator.apache.org/derby/manuals/reference/sqlj27.html#CREATE+PROCEDURE+Statement)  the SQL2003 standard  and DB2 all agree that the parameter name is optional.,0,0
List of jar files in tools/java incorrect in BUILDING.txt,Section 2 of BUILDING.txt describes how to obtain JDK 1.4  JDK 1.3  JDBC 2.0 extensions  JCE  OSGI. But then it says you should have the following jars:${derby.source}/tools/java/javacc.jar${derby.source}/tools/java/jakarta-oro-2.0.8.jar${derby.source}/tools/java/jce1_2_2.jar${derby.source}/tools/java/jdbc2_0-stdext.jar${derby.source}/tools/java/jta-1_0_1B-classes.zip${derby.source}/tools/java/servlet.jar${derby.source}/tools/java/osgi.jarActually  what you have is the following:empty.jargeronimo-spec-jta-1.0.1B-rc4.jargeronimo-spec-servlet-2.4-rc4.jarjakarta-oro-2.0.8.jarjavacc.jarjce1_2_2.jarjdbc2_0-stdext.jarosgi.jarI am providing a patch with this correction.,0,0
isFirst() returns true when relative(x) goes beyond result set,Bizarre error. Not sure if this is a JDBC  Derby  or Java issue.An opened result set has 4 records. A call to relative(3) while on row 3 should result in isAfterLast=true  and isFirst  isBeforeFirst  and IsLast set to false. However  the result is isAfterLast=True and isFirst=True.ij connect 'IsAfter;create=true';create table x (a char(1)); insert into x values '1' '2' '3' '4';quit;import java.sql.*; public class ErrIsFirst { public static void main(String argv[]) throws SQLException { Connection conn = null; Statement s = null; ResultSet rs = null; String DerbyDriver = 'org.apache.derby.jdbc.EmbeddedDriver'; String returnValue; try { Class.forName(DerbyDriver).newInstance(); } catch (Exception NoDriver) { System.out.println('Derby driver not found: ' + DerbyDriver); NoDriver.printStackTrace(); System.exit(1); } try { conn = DriverManager.getConnection('jdbc:derby:IsAfter'); s = conn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE ResultSet.CONCUR_READ_ONLY); rs = s.executeQuery( 'SELECT A FROM X'); rs.next(); // First Record returnValue = rs.getString('A'); System.out.println('Value='+returnValue); rs.relative(2); System.out.println('isFirst=' + rs.isFirst() + ' isLast=' + rs.isLast() + ' isAfterLast=' + rs.isAfterLast()); returnValue = rs.getString('A'); System.out.println('Value='+returnValue); rs.relative(-2); returnValue = rs.getString('A'); System.out.println('Value='+returnValue); rs.relative(10); System.out.println('isFirst=' + rs.isFirst() + ' isLast=' + rs.isLast() + ' isAfterLast=' + rs.isAfterLast()); returnValue = rs.getString('A'); System.out.println('Value='+returnValue); rs.close(); s.close(); } catch (SQLException se) { String SQLState = se.getSQLState(); String SQLMessage = se.getMessage(); System.out.println('Error = '+SQLState); System.out.println(SQLMessage); } }}The results on my system are:Value=1isFirst=false isLast=false isAfterLast=falseValue=3Value=1isFirst=true isLast=false isAfterLast=trueError = 24000Invalid cursor state - no current row.If you eliminate the first println call to isFirst() you get the following (correct) results.Value=1Value=3Value=1isFirst=false isLast=false isAfterLast=trueError = 24000Invalid cursor state - no current row.Okay  so where did we go wrong?,0,0
Add Support for network Server USRIDONL security,Currently Network Server supports only two security mechanisms.User ID and password (usridpwd)User ID and encrypted password (eusridpwd)It would be good to add support for User ID Only security so that it could more closely match the embedded driver and not always require a password.See details of security mechanism implementations in section 4.4.2.1 of DRDA V3 Vol. 1: Distributed Relational Database Architecture http://www.opengroup.org/dbiop/,1,0
setNull(x JDBCType.DATE) does not work when batching is turned on,Trying to execute batch on which setNull(x DATE) was called gives the following exception:SQL Exception: An attempt was made to get a data value of type 'DATE' from a data value of type 'null'. at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java) at org.apache.derby.impl.jdbc.EmbedConnection.newSQLException(EmbedConnection.java) at org.apache.derby.impl.jdbc.ConnectionChild.newSQLException(ConnectionChild.java) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.dataTypeConversion(EmbedPreparedStatement.java) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.setObject(EmbedPreparedStatement.java) at org.apache.derby.iapi.types.DataType.setInto(DataType.java) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeBatchElement(EmbedPreparedStatement.java) at org.apache.derby.impl.jdbc.EmbedStatement.executeBatch(EmbedStatement.java) at net.sf.hibernate.impl.BatchingBatcher.doExecuteBatch(BatchingBatcher.java:54)DATE column is nullable in db schema  so it should pass there ok. I believe the problem is in org.apache.derby.iapi.types.SQLDate  which does not implement setInto method  so DataType.setInto method is executed  calling setObject(x null). setObject thinks this is JDBC spec violation and fails on exception.Problem exists in both 10.0.2.1 and 10.0.2.0,0,0
Optimize some specific methods in Network Server to improve performance,In reviewing the Network Server Code and profiling there were several areas that showed potential for providing performance improvement.Functions that need optimizing to prevent unneeded object creation and excessive decodingparsePKGNAMCSN()parseSQLDTA_work()buildDB2CursorName()In DDMWriter and DDMReader  use System Routines in java.util.Arrays and System.arrayCopy instead of writing code to do functions like copy arrays and pad strings.,0,1
Javadoc build should include a timestamp and/or the svn revision number in a visible location.,In order to easily identify when a specific set of javadoc was built  and from what source  it would be useful to include a timestamp and/or the svn revision number at the time the javadoc is built. The footer is an excellent location to place this information  as it is visible on every generated page.,0,0
Column names on ResultSet.updateXXX and getXXX methods are handled incorrectly,Sections 14.2.3 and &#91;14.2.3&#93; of JDBC 3.0 spec sayColumn names supplied to getter &#91;updater&#93; methods are case insensitive. If a select listcontains the same column more than once  the first instance of the column will bereturned &#91;updated&#93;.Derby returns or updates the last column in the select list  not the first. With the attached Java class I seePRE-UPDATE1 100POST-UPDATE1 500POST-UPDATE getXXX(name)AB:500 ab500,0,0
'Schema already exists' when creating a table,When running a multithreaded program where several threads in parallell create tables in a schema that is not explicitly created  one often get the following exception:ERROR X0Y68: Schema 'TESTSCHEMA' already exists. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:322) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.duplicateDescriptorException(DataDictionaryImpl.java:1512) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.addDescriptorNow(DataDictionaryImpl.java:1496) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.addDescriptor(DataDictionaryImpl.java:1478) at org.apache.derby.impl.sql.execute.CreateSchemaConstantAction.executeConstantAction(CreateSchemaConstantAction.java:147) at org.apache.derby.impl.sql.execute.DDLConstantAction.getSchemaDescriptorForCreate(Unknown Source) at org.apache.derby.impl.sql.execute.CreateTableConstantAction.executeConstantAction(CreateTableConstantAction.java:213) at org.apache.derby.impl.sql.execute.MiscResultSet.open(MiscResultSet.java:56) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:366) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1108) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:517) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:475) at derbytest.Main$CreateTable.run(Main.java:42) at java.lang.Thread.run(Thread.java:595)A program that reproduces this bug will be attached.,0,0
'FOR UPDATE' required for updatable result set to work,To get an updatable result set  the JDBC 3.0 spec  section 14.2.4 'Modifying ResultSet Objects' states:  'ResultSet objects with concurrency CONCUR_UPDATABLE can be updated using ResultSet objects'.In addition  Derby requires the SQL SELECT statement to have a 'FORUPDATE' clause for updates to be allowed. This may be a usability issue  asmany examples  e.g. in 'JDBC API tutorial and reference and reference'book and the JDBC 3.0 Specification (14.2.4.1) do not include a 'FORUPDATE' clause in the SQL SELECT.Mamta Satoor says:'Derby implements the JDBC updatable resultset by using the existing updatable cursor implementation. And in order to do that  it requires that the SELECT statement should include the FOR UPDATE clause. One can change the Derby implementation so that it does not require FOR UPDATE clause to piggyback on updatable cursor implementation.'Dan DeBrunner says:'Technically I wonder if this is covered by the JDBC standard  I see nothing in the JDBC 3.0 that states any requirements for the SQL statement for an updateable result set. I know the JDBC tutorial book has some guidelines as to what will typically work  but isn't it up to the database engine to define what works here? Having said that I think that not requiring the FOR UPDATE would be a useful improvement.',0,0
Fix copyright notices and other IBM/Cloudscape references in java/demo/*,Assigning this issue to 'Documentation' component  as there is not a Demos component.,0,0
Testharness: testEncryptionAlgorithm property is not being picked up correctly for some encryption suites,It looks like the encryption.properties - testEncryptionAlgorithm=DESede/CBC/NoPadding is not being picked up for the encryption run of stress.multi test. But the test uses a database with the default encryption algorithm - DES/CBC/NoPadding,1,0
Need a online backup feature  that does not block update operations   when online backup is in progress.,Currently Derby allows users to perfoms online backups using SYSCS_UTIL.SYSCS_BACKUP_DATABASE() procedure  but while the backup is in progress  update operations are temporarily blocked  but read operations can still proceed.Blocking update operations can be real issue specifically in client server environments  because user requests will be blocked for a long time if a backup is in the progress on the server.,0,0
connection toString should uniquely identify the connection,The toString() on the Derby connection doesn't print unique information.for example System.out.println(conn) prints:EmbedConnection in the case of derby embeddedIt would be great if the toString() method for connections could be used to differentiate one connection from another.,0,0
Network Server demo program should support Derby network client driver,Currently  the Network Server demo programs require the IBM Universal JDBC Driver (JCC) for client functionality. The demo should be enhanced to also support using the Derby client driver.,0,0
Builds fail during splitmessages step if path contains spaces,If the path to the Derby source files contains a space  for example /opt/My Local Drive/derbysource  then the build will fail at the splitmessages step with the following error: &#91;java&#93; Exception in thread 'main' java.lang.StringIndexOutOfBoundsException: String index out of range: -1 &#91;java&#93; at java.lang.String.substring(String.java:1444) &#91;java&#93; at org.apache.derbyBuild.splitmessages.main(splitmessages.java:44)splitmessages should be improved to handle spaces in the path to the message files.,0,0
test tools/dblook_test.java fails if run in a directory having '*derby/*' in its path,SYMPTOM: The test 'tools/dblook_test' will fail. The diff looks similar to this:     Start: dblook_test jdk1.4.2_02 derbyall:derbytools 2005-05-06 22:37:37 ***4861d4860&lt; java.io.FileNotFoundException: &lt;filePath&gt;Test Failed. End: dblook_test jdk1.4.2_02 derbyall:derbytools 2005-05-06 22:37:53 ***    cf mail thread:http://mail-archives.apache.org/mod_mbox/db-derby-dev/200505.mbox/%3c20050507140048.GB690@ac30.fr34.2y.net%3eANALYSIS: The problem lies with the sedfunctionality in the test harness  which delete certain lines beforecomparing with the master file.Sed.java in the harness removes lines containing derby/ in the path viz: deleteLines.addElement('^.derby/.//&lt;.//&gt;//(.).*$');  deleteLines.addElement('^.derby/.//(.).$'); so if your tests are running in a directory containing this pattern  aline too much is deleted from dblook_test.tmp  thereby giving acomparison failure like you describe.I don't know the reason for this deletion yet  so I can't say how tofix it  but the work-around is obvious: Run test in a directory whosename does not contain this pattern,0,0
Provide some way to update index cardinality statistics (e.g. reimplement update statistics),Performance problems are being reported that can be resolved by updating the cardinality statistics used by the optimizer. Currently the only time the statistics are guaranteed to be an up-to-date is when the index is first created on a fully populated table. This is most easily accomplished on an existing table by using the command:  alter table &lt;table-name&gt; compress &#91;sequential&#93; Compress table is an I/O intensive task. A better way to achieve this would be to re-enable parser support for the 'update statistics' command or re-implement the update in some other fashion.,0,1
testing/README.htm property descriptions: testSpecialProps wrongly named; useprocess omitted,In section 4.12 in ../testing/README.htm  the property  TestSpecialFlags is described for specifying additional properties to RunTest. I could notfind any evidence of this in RunTest or elsewhere. However  the property testSpecialPropsis supported by RunTest.java. I found this to work. This propertyalso has a syntax for specifying more than one property using a '^'delimiter between properties  i.e. testSpecialProps=&lt;prop-1&gt;=&lt;value-1&gt;^ ... ^&lt;prop-n&gt;=&lt;value-n&gt;Also I noticed the property 'useprocess' (default=true) for controllingwhether RunTest runs the test in a separate vm or a thread in currentvm isn't documented in README.htm. I suggest it be included  sinceit's potentially useful for debugging tests. I could include it in thepatch for derby-313 (I don't think anybody committed it yet) or file anew JIRA issue.Looking at RunTest reveals that unit tests are not (yet) runnable with'useprocess=false'  though.,0,0
SYS.SYSCOLUMN problem with 'GENERATED BY DEFAULT' column w/ Network Server,When connected to the Derby Network Server  if one has a table with a column defined as 'GENERATED BY DEFAULT' and then one tries to select the 'COLUMNDEFAULT' field from SYS.SYSCOLUMNS  the result is an NPE in the server code that leads to connection deallocation.I don't know if this is a problem with the 'GENERATED BY DEFAULT' feature or if it's a problem with Network Server--more investigation is required.To reproduce  use ij to connect to a database using Network Server  and then:ij&gt; create table t1 (i int generated by default as identity);0 rows inserted/updated/deletedij&gt; select columndefault from sys.syscolumns;COLUMNDEFAULT--------------------------------------------------------------------------------------------------------------------------------nulljava.lang.NullPointerException at org.apache.derby.impl.drda.DRDAConnThread.writeFdocaVal(DRDAConnThread.java:6550) at org.apache.derby.impl.drda.DRDAConnThread.writeFDODTA(DRDAConnThread.java:5973) at org.apache.derby.impl.drda.DRDAConnThread.writeQRYDTA(DRDAConnThread.java:5796) at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:595) at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:226)agentThread&#91;DRDAConnThread_2 5 main&#93;ERROR 58009: Execution failed due to a distribution protocol error that caused deallocation of the conversation. A DRDA Data Stream Syntax Error was detected. Reason: 0x3,0,0
Remove resultSetHoldability property from ClientDataSource,ClientDataSource (through ClientBaseDataSource) implements a Java Bean property resultSetHoldability which is not documented in the functional spec at.http://incubator.apache.org/derby/papers/DerbyClientSpec.htmlJDBC provides standard ways to set the holdability of ResultSets  so a non-standard separate mechanism is not required. The property and associated code needs to be removed.,0,0
AES encryption test fails on Solaris 10,The store/aes.sql test on Solaris 10 produces the following diff report:     Start: aes jdk1.4.2_02 2005-05-30 12:13:17 ***206 del&lt; ERROR XJ001: Java exception: 'Wrong keysize: must be equal to 128  192 or 256: java.security.InvalidParameterException'.206a206&gt; ERROR XJ001: Java exception: 'AES key length must be 128  192  or 256 bits: java.security.InvalidParameterException'.Test Failed. End: aes jdk1.4.2_02 2005-05-30 12:14:06 ***    The cause of this problem is that on most OSs  the java.security.InvalidParameterException thrown by the JVM when an invalid encryption key length is requested contains a message with the following text: Wrong keysize: must be equal to 128  192 or 256while on Solaris 10 the message contained in the exception has been changed to: AES key length must be 128  192  or 256 bitsThe reason for this is most likely that a different encryption library is included in Solaris 10 comparedto the other OSs  either as part of the JVM or as a native library.The problem occurs on Solaris 10 running on both x86 and Sparc processors. It occurs both with jdk 1.4 and jdk 1.5.,1,0
Many files do not have correct svn-properties,There are two problems with svn properties in Derby:1) A number of non-binary files do not have the svn:eol-style=native property set. Some of these currently has CRLF (Windows-style) line terminators  Example:dt136804@atum10~/local/DERBY/d_rby-138$ file ./plugins/eclipse/org.apache.derby.ui/src/org/apache/derby/ui/popup/actions/RemoveDerbyNature.java./plugins/eclipse/org.apache.derby.ui/src/org/apache/derby/ui/popup/actions/RemoveDerbyNature.java: ASCII C program text  with CRLF line terminatorsdt136804@atum10~/local/DERBY/d_rby-138$ svn proplist -v ./plugins/eclipse/org.apache.derby.ui/src/org/apache/derby/ui/popup/actions/RemoveDerbyNature.javawhereas others have LF(Unix-style). Example:dt136804@atum10~/local/DERBY/d_rby-138$ file ./plugins/eclipse/org.apache.derby.ui/src/org/apache/derby/ui/actions/SysInfoAction.java./plugins/eclipse/org.apache.derby.ui/src/org/apache/derby/ui/actions/SysInfoAction.java: ASCII C program textdt136804@atum10~/local/DERBY/d_rby-138$ svn proplist -v ./plugins/eclipse/org.apache.derby.ui/src/org/apache/derby/ui/actions/SysInfoAction.javaSome of the files that don't have this property do instead have a property called 'snv:eol-style'. I'm guessing this is a typo.Example:dt136804@atum10~/local/DERBY/d_rby-138$ svn proplist -v java/testing/org/apache/derbyTesting/unitTests/crypto/T_CipherOFB.javaProperties on 'java/testing/org/apache/derbyTesting/unitTests/crypto/T_CipherOFB.java': snv:eol-style : native2) A seemingly arbitrary collection of files have the svn:executable property set. To my knowledge  the only files in the Derby respository that should have this property are the *.ksh and perhaps the *.bat scripts  (I don't know if Windows cares about this property when the file has the .bat suffix). Currently none of the *.ksh scripts have this property  but a number of java source files (not all) have it. (If there is some reason to have this property on other files  it should at least be done consistently throughout the repository).Example:dt136804@atum10~/local/DERBY/d_rby-138$ svn proplist -v java/drda/org/apache/derby/drda/NetworkServerControl.javaProperties on 'java/drda/org/apache/derby/drda/NetworkServerControl.java': svn:executable : svn:eol-style : nativedt136804@atum10~/local/DERBY/d_rby-138$ svn proplist -v java/testing/org/apache/derbyTesting/unitTests/crypto/T_CipherOFB.javaProperties on 'java/testing/org/apache/derbyTesting/unitTests/crypto/T_CipherOFB.java': snv:eol-style : nativeIf I understand correctly it is not possible to create a patchfile that contains property changes  so I guess a committer will have to do this. I'm willing to create a script file containing all the svn commands that must be run  as a 'pseudo patch'.,0,0
Network client XA should only keep XA state for transaction branch association  to track whether to send commit in autocommit mode.  All other state and state related decisions should be deferred to the server.,Network client XA should only keep XA state for transaction branch association  to track whether to send commit in autocommit mode. All other state and state related decisions should be defered to the server.The client tries to track XA state to make decisions based on current XA state. Most of this state handling was removed with DERBY246  but it still was not being handled properly. This is evidenced by multiple failures in xaSimplePostive that now that it gets past DERBY-246.This fix will have the client track only branch association as outlined in the XA+ specification. Table 6-2  State Table for Transaction Branch Association. The client will track onlyXA_TO_NOT_ASSOCIATEDXA_T1_ASSOCIATEDAssociation Suspended (T2) will map to XA_TO_NOT_ASSOCIATED for the client's pupurposes.The client commit in autocommit mode only for XA_TO_NOT_ASSOCIATED.,0,0
example.html file for the SimpleApp does not describe the arguments accepted by the program,The SimpleApp.java demo program supplied with Derby currently accepts two arguments and will soon (see JIRA entry: DERBY-247) accept a third that allows the application to run as a client to Network Server. Only 'embedded' is documented in the ${DERBY_INSTALL}/demo/simple/example.html file. The others should be added. The current undocumented argument is:'jccjdbcclient' - will use the JCC client driver to access Network ServerThe new argument might be:'derbyclient' - will use the Net client driver to access Network ServerThis brief description of the program using the derby client might help in this update:To use the SimpleApp in client mode only the directory containing the SimpleApp and the netclient.jar file are needed in the CLASSPATH. By passing in 'derbyclient' as an argument the program will load the client driver rather than start the Derby engine. The parseArguments() method (line 230) changes two key strings. The variables 'driver' and 'protocol' are set to the client driver values. With these new definitions the go() method loads the client driver at line 73 and creates the client URL at lines 93-94. With the variables expanded these lines will look like this:line 76: Class.forName('org.apache.derby.jdbc.ClientDriver')line 93-94: conn = DriverManager.getConnection('jdbc:derby://localhost:1527/' + 'derbyDB;create=true'  props); As in the embedded example the connection will create the database if it does not exist and boot derbyDB if it has not already been loaded by the Network Server. Note that the application is well behaved and does not shutdown the database when operating as a client.,0,0
setByte() with executeBatch causes hang with client if mapping is invalid  e.g. setByte to DATE,setByte() followed by an addBatch() and then an executeBatch causes a hang.May apply to any setXXX call that will result in any invalid conversion  possibly only those conversions handled by the client.See the test jdbcapi/parameterMapping  look for this bug number in the code  to see the cases disabled when running with the client.,0,1
It is desirable to have IDENTITY_VAL_LOCAL() function return last recent user specified value or system generated value for BY DEFAULT identity columns.,Derby was recently enhanced to support BY DEFAULT identity column. While the behavior of this feature is not documented yet  I think  it is desirable for IDENTITY_VAL_LOCAL() function  that is used to retrieve last single statement insert value for identity column  to return user specified value for the default column.For GENERATED ALWAYS identity columns  this issue doesn't apply  since users can't provide a value. But for GENERATED BY DEFAULT identity columns  users can optionally specify a value. IDENTITY_VAL_LOCAL() function should return this value. Derby currently doesn't support this behavior.ij&gt; create table tauto ( i int generated by default as identity  j int  k int);0 rows inserted/updated/deletedij&gt; insert into tauto (j k) values (1 1);1 row inserted/updated/deletedij&gt; values identity_val_local();1-------------------------------11 row selectedij&gt; insert into tauto (j k) values (1 1);1 row inserted/updated/deletedij&gt; values identity_val_local();1-------------------------------21 row selectedij&gt; insert into tauto values (5 1 1);1 row inserted/updated/deletedij&gt; values identity_val_local();1-------------------------------2 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;============= This needs be '5'1 row selectedij&gt; select * from tauto;I |J |K-----------------------------------1 |1 |12 |1 |15 |1 |13 rows selected,0,0
Unknown page format  error  while doing recovery after a  a crash while doing  in place compress.,Crash was done manually when compress was almost in the end. Log trace before the crash:DEBUG LogTrace OUTPUT: Write log record: tranId=14527 instant: (23 6270154) length: 20BeginXact null transactionStatus 0DEBUG LogTrace OUTPUT: Write log record: tranId=14527 instant: (23 6270190) length: 25Page Operation: Page(0 Container(0  768)) pageVersion 9567 : CompressSpaceOperation: newHighestPage = 0;num_pages_truncated = 956 to Page(0 Container(0  768))DEBUG LogTrace OUTPUT: Flush log to 1350071DEBUG LogTrace OUTPUT: Write log record: tranId=Null instant: (23 6251544) length: 21Checksum Operation algorithm = 1 value = 3588488 data length= 18650DEBUG LogTrace OUTPUT: Begin log sync...DEBUG LogTrace OUTPUT: end log sync.DEBUG LogTrace OUTPUT: Flush log to 6270235DEBUG LogTrace OUTPUT: Begin log sync...DEBUG LogTrace OUTPUT: end log sync.DEBUG LogTrace OUTPUT: Write log record: tranId=14527 instant: (24 61) length: 17EndXact null Committed : transactionStatus = Committed&#8212;C:/suresht/databases&gt;java -Dij.protocol=jdbc:derby: org.apache.derby.tools.ijij version 10.1ij&gt; call SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE('APP'   'T1'   1   1  1) ;IJ ERROR: Unable to establish connectionij&gt; connect 'jdbc:derby:wombat';ERROR XJ040: Failed to start database 'wombat'  see the next exception for details.ERROR XSDB1: Unknown page format at page Page(102 Container(0  768))ij&gt;What was done on the DB :$ rm -rf wombat$ ijC:/suresht/databases&gt;rem set DERBY_INSTALL=C:/suresht/databases&gt;java -Dij.protocol=jdbc:derby: org.apache.derby.tools.ijij version 10.1ij&gt; Terminate batch job (Y/N)? ^C$ ijC:/suresht/databases&gt;rem set DERBY_INSTALL=C:/suresht/databases&gt;java -Dij.protocol=jdbc:derby: org.apache.derby.tools.ijij version 10.1ij&gt; connect 'jdbc:derby:wombat;create=true';ij&gt; create table t1(a int ) ;0 rows inserted/updated/deletedij&gt; insert into t1 values(1) ;1 row inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;1 row inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;2 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;4 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;8 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;16 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;32 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;64 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;128 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;256 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;512 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;1024 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;2048 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;4096 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;8192 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;16384 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;32768 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;65536 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;131072 rows inserted/updated/deletedij&gt; insert into t1 select a + 1 from t1 ;262144 rows inserted/updated/deletedij&gt; commit ;ij&gt; delete from t1 ;524288 rows inserted/updated/deletedij&gt; select * from new org.apache.derby.diag.SpaceTable('T1') ;ERROR 42X01: Syntax error: Encountered '&lt;EOF&gt;' at line 1  column 57.ij&gt; select * from new org.apache.derby.diag.SpaceTable('T1') t ;CONGLOMERATENAMEISIND&amp;NUMALLOCATEDPAGES NUMFREEPAGES NUMUNFILLEDPAGES PAGESIZE ESTIMSPACESAVING---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------T10 1 3826 1 4096 156712961 row selectedij&gt; select NUMALLOCATEDPAGES from new org.apache.derby.diag.SpaceTable('T1') t ;NUMALLOCATEDPAGES--------------------11 row selectedij&gt; select NUMAFREEPAGES from new org.apache.derby.diag.SpaceTable('T1') t ;ERROR 42X04: Column 'NUMAFREEPAGES' is either not in any table in the FROM listor appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE statement then 'NUMAFREEPAGES' is not a column in the target table.ij&gt; select NUMFREEPAGES from new org.apache.derby.diag.SpaceTable('T1') t ;NUMFREEPAGES--------------------38261 row selectedij&gt; call SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE('APP'   'T1'   1   1  1) ;0 rows inserted/updated/deletedij&gt; select NUMFREEPAGES from new org.apache.derby.diag.SpaceTable('T1') t ;NUMFREEPAGES--------------------01 row selectedij&gt; select * from new org.apache.derby.diag.SpaceTable('T1') t ;CONGLOMERATENAMEISIND&amp;NUMALLOCATEDPAGES NUMFREEPAGES NUMUNFILLEDPAGES PAGESIZE ESTIMSPACESAVING---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------T10 1 01 4096 01 row selectedij&gt; ^CTerminate batch job (Y/N)? ^C$ ij/&gt;$ ijC:/suresht/databases&gt;rem set DERBY_INSTALL=C:/suresht/databases&gt;java -Dij.protocol=jdbc:derby: org.apache.derby.tools.ijij version 10.1ij&gt; connect 'jdbc:derby:wombat';ij&gt; select * from t1 ;A-----------0 rows selectedij&gt; insert into t1 values(1) ;1 row inserted/updated/deletedij&gt; insert into t1 select * from t1 ;1 row inserted/updated/deletedij&gt; insert into t1 select * from t1 ;2 rows inserted/updated/deletedij&gt; insert into t1 select * from t1 ;4 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;8 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;16 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;32 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;64 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;128 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;256 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;512 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;1024 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;2048 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;4096 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;8192 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;16384 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;32768 rows inserted/updated/deletedij&gt; insert into t1 select a+1 from t1 ;65536 rows inserted/updated/deletedij&gt; delete from t1 ;131072 rows inserted/updated/deletedij&gt; select * from new org.apache.derby.diag.SpaceTable('T1') t ;CONGLOMERATENAMEISIND&amp;NUMALLOCATEDPAGES NUMFREEPAGES NUMUNFILLEDPAGES PAGESIZE ESTIMSPACESAVING---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------T10 1 9560 4096 39157761 row selectedij&gt; call SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE('APP'   'T1'   1   1  1) ;0 rows inserted/updated/deletedij&gt; Terminate batch job (Y/N)? ^C$ ijC:/suresht/databases&gt;rem set DERBY_INSTALL=C:/suresht/databases&gt;java -Dij.protocol=jdbc:derby: org.apache.derby.tools.ijij version 10.1ij&gt; call SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE('APP'   'T1'   1   1  1) ;IJ ERROR: Unable to establish connectionij&gt; connect 'jdbc:derby:wombat';ERROR XJ040: Failed to start database 'wombat'  see the next exception for details.ERROR XSDB1: Unknown page format at page Page(102 Container(0  768))ij&gt;Stacks: pageVersion 8611 : Change page allocation status of 102 to 1(undo 0) instant = (23 6494) logEnd = (23 6536) logIn at 22 available 4DEBUG LogTrace OUTPUT: scanned 12606 : Page Operation: Page(102 Container(0  768)) pageVersion 412 : Invalidate Page - it has been deallocated instant = (23 6536) logEnd = (23 6574) logIn at 18 available 4------------ BEGIN SHUTDOWN ERROR STACK -------------ERROR XSLA7: Cannot redo operation Page Operation: Page(102 Container(0  768)) pageVersion 412 : Invalidate Page - it has been deallocated in the log. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:315) at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1515) at org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:798) at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:323) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:539) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418) at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:994) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:539) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418) at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:757) at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:178) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1832) at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1698) at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(BaseMonitor.java:1577) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:996) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:988) at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:533) at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:1551) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(EmbedConnection.java:196) at org.apache.derby.impl.jdbc.EmbedConnection30.&lt;init&gt;(EmbedConnection30.java:72) at org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Driver30.java:73) at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:183) at java.sql.DriverManager.getConnection(DriverManager.java:512) at java.sql.DriverManager.getConnection(DriverManager.java:140) at org.apache.derby.impl.tools.ij.ij.dynamicConnection(ij.java:836) at org.apache.derby.impl.tools.ij.ij.ConnectStatement(ij.java:698) at org.apache.derby.impl.tools.ij.ij.ijStatement(ij.java:528) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:289) at org.apache.derby.impl.tools.ij.Main.go(Main.java:203) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169) at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55) at org.apache.derby.tools.ij.main(ij.java:60)============= begin nested exception  level (1) ===========ERROR XSDB1: Unknown page format at page Page(102 Container(0  768)) at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:315) at org.apache.derby.impl.store.raw.data.CachedPage.changeInstanceTo(CachedPage.java:315) at org.apache.derby.impl.store.raw.data.CachedPage.setIdentity(CachedPage.java:195) at org.apache.derby.impl.services.cache.CachedItem.takeOnIdentity(CachedItem.java:235) at org.apache.derby.impl.services.cache.Clock.addEntry(Clock.java:798) at org.apache.derby.impl.services.cache.Clock.find(Clock.java:303) at org.apache.derby.impl.store.raw.data.FileContainer.getAnyPage(FileContainer.java:2430) at org.apache.derby.impl.store.raw.data.BaseContainer.getAnyPage(BaseContainer.java:473) at org.apache.derby.impl.store.raw.data.BaseContainerHandle.getAnyPage(BaseContainerHandle.java:590) at org.apache.derby.impl.store.raw.data.PageBasicOperation.findpage(PageBasicOperation.java:303) at org.apache.derby.impl.store.raw.data.PageBasicOperation.needsRedo(PageBasicOperation.java:159) at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1394) at org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:798) at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:323) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:539) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418) at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:994) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:539) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418) at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:757) at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:178) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1832) at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1698) at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(BaseMonitor.java:1577) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:996) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:988) at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:533) at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:1551) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(EmbedConnection.java:196) at org.apache.derby.impl.jdbc.EmbedConnection30.&lt;init&gt;(EmbedConnection30.java:72) at org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Driver30.java:73) at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:183) at java.sql.DriverManager.getConnection(DriverManager.java:512) at java.sql.DriverManager.getConnection(DriverManager.java:140) at org.apache.derby.impl.tools.ij.ij.dynamicConnection(ij.java:836) at org.apache.derby.impl.tools.ij.ij.ConnectStatement(ij.java:698) at org.apache.derby.impl.tools.ij.ij.ijStatement(ij.java:528) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:289) at org.apache.derby.impl.tools.ij.Main.go(Main.java:203) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169) at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55) at org.apache.derby.tools.ij.main(ij.java:60)============= end nested exception  level (1) ======================== begin nested exception  level (2) ===========ERROR XBM0U: No class was registered for identifier 0. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:311) at org.apache.derby.impl.services.monitor.BaseMonitor.classFromIdentifier(BaseMonitor.java:648) at org.apache.derby.impl.services.monitor.BaseMonitor.newInstanceFromIdentifier(BaseMonitor.java:661) at org.apache.derby.iapi.services.monitor.Monitor.newInstanceFromIdentifier(Monitor.java:618) at org.apache.derby.impl.store.raw.data.CachedPage.changeInstanceTo(CachedPage.java:303) at org.apache.derby.impl.store.raw.data.CachedPage.setIdentity(CachedPage.java:195) at org.apache.derby.impl.services.cache.CachedItem.takeOnIdentity(CachedItem.java:235) at org.apache.derby.impl.services.cache.Clock.addEntry(Clock.java:798) at org.apache.derby.impl.services.cache.Clock.find(Clock.java:303)-More- at org.apache.derby.impl.store.raw.data.FileContainer.getAnyPage(FileContainer.java:2430) at org.apache.derby.impl.store.raw.data.BaseContainer.getAnyPage(BaseContainer.java:473) at org.apache.derby.impl.store.raw.data.BaseContainerHandle.getAnyPage(BaseContainerHandle.java:590) at org.apache.derby.impl.store.raw.data.PageBasicOperation.findpage(PageBasicOperation.java:303) at org.apache.derby.impl.store.raw.data.PageBasicOperation.needsRedo(PageBasicOperation.java:159) at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1394) at org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:798) at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:323) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:539) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418) at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:994) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:539) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418) at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:757) at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:178) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1985) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1832) at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1698) at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(BaseMonitor.java:1577) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:996) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:988) at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:533) at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:1551) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(EmbedConnection.java:196) at org.apache.derby.impl.jdbc.EmbedConnection30.&lt;init&gt;(EmbedConnection30.java:72) at org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Driver30.java:73) at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:183) at java.sql.DriverManager.getConnection(DriverManager.java:512) at java.sql.DriverManager.getConnection(DriverManager.java:140) at org.apache.derby.impl.tools.ij.ij.dynamicConnection(ij.java:836) at org.apache.derby.impl.tools.ij.ij.ConnectStatement(ij.java:698) at org.apache.derby.impl.tools.ij.ij.ijStatement(ij.java:528) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:289) at org.apache.derby.impl.tools.ij.Main.go(Main.java:203) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169) at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55) at org.apache.derby.tools.ij.main(ij.java:60)============= end nested exception  level (2) ===========-More-,0,0
Specification of incomplete server properties on command line causes NPE with NetworkServerControl when starting the server.,When using the command line to start the Network Server  there a couple of cases where if a property is specified on the command line but no value is given (ex. '-Dderby.drda.maxThreads' instead of '-Dderby.drda.maxThreads=3')  a Null Pointer Exception will result  when the correct behavior should be to use some kind of default.For example:&gt; java -Dderby.drda.maxThreads org.apache.derby.drda.NetworkServerControl start -p 1528java.lang.NullPointerException at org.apache.derby.impl.drda.NetworkServerControlImpl.localizeMessage(NetworkServerControlImpl.java) at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessageWork(NetworkServerControlImpl.java) at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessage(NetworkServerControlImpl.java) at org.apache.derby.impl.drda.NetworkServerControlImpl.getIntPropVal(NetworkServerControlImpl.java) at org.apache.derby.impl.drda.NetworkServerControlImpl.getPropertyInfo(NetworkServerControlImpl.java) at org.apache.derby.impl.drda.NetworkServerControlImpl.&lt;init&gt;(NetworkServerControlImpl.java) at org.apache.derby.drda.NetworkServerControl.main(NetworkServerControl.java)Note that even though we see this NPE  it appears that the server still starts up  although the startup may not be complete (subsequent attempts to connect might lead to errors like 'Invalid reply from network server: Insufficient data.').For other properties  this will just result in the default value being used  which is the correct behavior. For example:&gt; java -Dderby.drda.host org.apache.derby.drda.NetworkServerControl start -p 1528Server is ready to accept connections on port 1528.,0,0
servlet Back to Main Page link points to csnet instead of derbynet,The link at the top of the servlet java/drda/org/apache/derby/drda/NetServlet.java links to csnet (because of the static String SERVLET_ADDRESS). However  the servlet address is now derbynet.,0,0
SimpleNetworkClientSample.java network server example has an error which causes it to fail,The file SimpleNetworkClientSample.java under the demo/nserverdemo has an error which preventsit from completing successfully.The one line that is a problem is this: private static final String DERBY_CLIENT_URL= 'jdbc:derby://localhost:'+ NETWORKSERVER_PORT+'/NSSampledb;create=true';The one line fix is this: private static final String DERBY_CLIENT_URL= 'jdbc:derby://localhost:'+ NETWORKSERVER_PORT+'/' DBNAME';create=true';,0,0
With Network Server Database hangs after some time with many connections executing prepareStatement(),Rajesh found this issue in running Network Server system tests for the 10.1 release candidateWhile running the Network Server system test with 210 clients  the Network Server and all the clients hangs after some time. A Ctrl+/ on the Network Server shows that upto 180 threads waiting on the PreparedStatements to compile and comes from the embedded engine. The following is the stack trace from the java dump.3XMTHREADINFO 'DRDAConnThread_181' (TID:1007C998  sys_thread_t:85C4478  state:CW  native ID:4575ABB0) prio=54XESTACKTRACE at java.lang.Object.wait(Native Method)4XESTACKTRACE at java.lang.Object.wait(Object.java(Compiled Code))4XESTACKTRACE at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java(Compiled Code))4XESTACKTRACE at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java)4XESTACKTRACE at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java)4XESTACKTRACE at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(EmbedPreparedStatement.java)4XESTACKTRACE at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&lt;init&gt;(EmbedPreparedStatement20.java)4XESTACKTRACE at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&lt;init&gt;(EmbedPreparedStatement30.java)4XESTACKTRACE at org.apache.derby.jdbc.Driver30.newEmbedPreparedStatement(Driver30.java)4XESTACKTRACE at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java)4XESTACKTRACE at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java)4XESTACKTRACE at sun.reflect.GeneratedMethodAccessor3.invoke(Unknown Source)4XESTACKTRACE at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java(Compiled Code))4XESTACKTRACE at java.lang.reflect.Method.invoke(Method.java(Compiled Code))4XESTACKTRACE at org.apache.derby.impl.drda.DRDAStatement.prepareStatementJDBC3(DRDAStatement.java)4XESTACKTRACE at org.apache.derby.impl.drda.DRDAStatement.prepare(DRDAStatement.java)4XESTACKTRACE at org.apache.derby.impl.drda.DRDAStatement.explicitPrepare(DRDAStatement.java(Compiled Code))4XESTACKTRACE at org.apache.derby.impl.drda.DRDAConnThread.parsePRPSQLSTT(DRDAConnThread.java(Compiled Code))4XESTACKTRACE at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java(Compiled Code))4XESTACKTRACE at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java),0,1
Disable creating indexes on long varchar for bit data. Long varchar column doesn't allow creating indexes already.,I guess I did not articulate my reasons for suggesting removal of index support for 'long varchar for bit data' completely. 1) Long varchar types are not comparable... If they are not comparable  it should not be possible to use them in GROUP BY  ORDER BY or allow regular B-Tree indexes. 2) Also  long varchar types tend to be long in size and hence the regular B-Tree mechanism is not a suitable way to index them. Dan also mentioned they become ineffective for keys longer than half a page size.It should not be possible to create an index on 'long varchar for bit data' datatypes. Derby currently doesn't allow creating indexes on 'long varchar' datatypes and the same should apply for it's bit data equivalent too.ij&gt; create table longchar ( i int  c long varchar);0 rows inserted/updated/deletedij&gt; create index longIdx on longchar(c);ERROR X0X67: Columns of type 'LONG VARCHAR' may not be used in CREATE INDEX  ORDER BY  GROUP BY  UNION  INTERSECT  EXCEPT or DISTINCT statements because comparisons are not supported for that type.ij&gt; create table longcharBitData ( i int  c long varchar for bit data);0 rows inserted/updated/deletedij&gt; create index longIdx on longcharBitData(c);0 rows inserted/updated/deletedDerby also seems to allow GROUP BY and/or ORDER BY on LONG VARCHAR FOR BIT DATA types. I believe this is incorrect too.select c from longcharBitData group by c;C--------------------------------------------------------------------------------------------------------------------------------0 rows selectedij&gt; select c from longcharBitData group by c order by c;C--------------------------------------------------------------------------------------------------------------------------------0 rows selected,0,0
Network client message strings not internationalized,In investigating DERBY-254  I discovered that all SQLExceptions are thrown with hardcoded English error messages. This needs to be modified to use message string resource bundles similar to the embedded code.,0,0
Client DataSource should not require user property to be set,ClientDataSource should not require user to be set. It should default to user APP as described in:http://incubator.apache.org/derby/docs/adminguide/cadminappsclient.htmlThis all seems to work ok for for DriverManager connections but fails for ClientDataSource run the attached repro $ java DataSourceNoUserembedded no userid/passwordclient userid/password setclient no passwordclient no userid/no passwordorg.apache.derby.client.am.SqlException: null userid not supported at org.apache.derby.client.net.NetConnection.checkUser(NetConnection.java:998) at org.apache.derby.client.net.NetConnection.flowConnect(NetConnection.java:380) at org.apache.derby.client.net.NetConnection.initialize(NetConnection.java:233) at org.apache.derby.client.net.NetConnection.&lt;init&gt;(NetConnection.java:201) at org.apache.derby.jdbc.ClientDataSource.getConnection(ClientDataSource.java:156) at org.apache.derby.jdbc.ClientDataSource.getConnection(ClientDataSource.java:135) at DataSourceNoUser.main(DataSourceNoUser.java:42),0,0
sysinfo with -cp client option should not print error saying DB2 jar file and driver class are missing,If you run java org.apache.derby.tools.sysinfo -cp client SimpleApp.classyou getFOUND IN CLASS PATH: Derby Client libraries (derbyclient.jar) user-specified class (SimpleApp)NOT FOUND IN CLASS PATH: Derby Client libraries (db2jcc.jar) (com.ibm.db2.jcc.DB2Driver not found.)The 'NOT FOUND IN CLASSPATH' output is confusing and invalid because we're testing the network client  not the DB2 JCC client.,0,0
Create a new sample database for use in examples in the manuals,The Derby manuals still refer to Cloudscape example databases that were unable to be contributed to Derby. A new sample database should be created which is complex enough to serve as the basis for examples in the various manuals.,0,0
Queryplan for a query using SESSION schema view is incorrectly put in statement cache. This could cause incorrect plan getting executed later if a temp. table is created with that name.,See DERBY-405 for some discussion related this issue. I suspect this is because of statement caching. Derby doesn't seem to recognise we have a temporary table that just overloaded an existing physical table. It would have been good to avoid permanent tables/views/synonyms in SESSION schema. Not sure what we should do now about this  though. ij&gt; create view session.st1 as select * from t; 0 rows inserted/updated/deleted ij&gt; select * from session.st1; I |J |K ----------------------------------- 1 |1 |NULL 2 |2 |NULL 3 |3 |NULL 4 |4 |NULL 4 rows selected ij&gt; select * from t; I |J |K ----------------------------------- 1 |1 |NULL 2 |2 |NULL 3 |3 |NULL 4 |4 |NULL 4 rows selected ij&gt; declare global temporary table st1(c11 int  c12 int) on commit preserve rows  not logged; 0 rows inserted/updated/deleted ij&gt; select * from session.st1; I |J |K ----------------------------------- 1 |1 |NULL 2 |2 |NULL 3 |3 |NULL 4 |4 |NULL 4 rows selected ij&gt; select * from session.st1; &lt;==== This statement has an extra space between FROM and session.st1 C11 |C12 ----------------------- 0 rows selected,0,0
Passing the return of  a RETURN NULL ON NULL INPUT function to another function call throws linkage error.,Error in ij (RN_RADIANS is a function declared as returns null on null input)ij&gt; VALUES CAST( CALL_COS(RN_RADIANS(90.0)) AS DECIMAL(3 2));ERROR XBCM1: Java linkage error thrown during load of generated class org.apache.derby.exe.ace5214067x0105x5e41x7a46xffff855452e375.ERROR XJ001: Java exception: '(class: org/apache/derby/exe/ace5214067x0105x5e41x7a46xffff855452e375  method: e0 signature: ()Ljava/lang/Object Expecting to find double on stack: java.lang.VerifyError'.extract from derby.log2005-07-28 16:23:43.836 GMT Thread&#91;main 5 main&#93; Wrote class org.apache.derby.exe.ace5214067x0105x5e41x7a46xffff855452e375 to file C:&#95;work/svn_pb/trunk/systest/out/functions/ace5214067x0105x5e41x7a46xffff855452e375.class. Please provide support with the file and the following exception information: java.lang.VerifyError: (class: org/apache/derby/exe/ace5214067x0105x5e41x7a46xffff855452e375  method: e0 signature: ()Ljava/lang/Object Expecting to find double on stackI will add a test case to lang/functions.sql commented with this bug number. Test casesthat fail will be commented out.,0,0
Error message  X0X07  has incorrect property name  db2j.database.classpath instead of derby.database.classpath,Example output is in the test lang/dcl.sql  extracted here.ERROR X0X07: Cannot drop jar file ''EMC'.'MAIL_APP'' because its on your db2j.database.classpath ''EMC'.'MAIL_APP''.Also the its should be it's (it is).Might also make sense to change drop to remove  as the procedure is called remove_jar.,0,0
SecurityException or LinkageException thrown during loading a class from a database jar incorrectly shuts the engine down.,In addiing test cases to lang/dcl.test for signed jar files stored in the database I found that if a jar is installed with a tampered class the resulting SecurityException shuts Derby down. Most likely the same would be true for an invalid class hacked into the jar.,1,0
DatabaseMetaData.getColumns() fails on iSeries JDK 1.4 with verfier error on generated class.,Analysis shows that ----------------------------------------------------------------------The problem is occurring starting at offset 2007 in method e23. There is an invokeinterface to method setWidth(int  int  boolean) of class VariableSizeDataValue. This invoke returns a value of class DataValueDescriptor. That value is in turn stored in field e142 at offset 2015 in method e23. The problem is that field e142 is a NumberDataValue  and DataValueDescriptor is not a valid subclass of NumberDataValue. Thus the store is not allowed.----------------------------------------------------------------------Looking at the generated setWidth() calls I see one in BinaryOperatorNode where the return (DataValueDescriptor) is not cast to the type of the field it is stored in.,0,0
Result set holdability defined inside stored procedures is ignored by server/client,Assume I have a Java stored procedure that returns one or more result sets  and the holdability of those result sets is specified as part of the createStatement() method within the procedure definition (see below for an example).If I execute this procedure against Derby embedded  the holdability of each result set matches that of the statement-specific holdability that is defined within the stored procedure. However  if I run the procedure against the Network Server using the Derby client  the holdability of all result sets is the same  and it is based on the holdability of the statement that executed the procedure--i.e. the statement-specific holdability that is defined within the procedure is ignored.Ex: If I create a stored procedure that corresponds to the following method:public static void p2(ResultSet[] rs1  ResultSet[] rs2  ResultSet[] rs3) throws Exception{ Connection conn = DriverManager.getConnection( 'jdbc:default:connection'); Statement st1 = conn.createStatement( ResultSet.TYPE_FORWARD_ONLY  ResultSet.CONCUR_READ_ONLY  ResultSet.HOLD_CURSORS_OVER_COMMIT); rs1[0] = st1.executeQuery('select * from testtable1'); Statement st2 = conn.createStatement( ResultSet.TYPE_FORWARD_ONLY  ResultSet.CONCUR_READ_ONLY  ResultSet.CLOSE_CURSORS_AT_COMMIT); rs2[0] = st2.executeQuery('select * from testtable2'); Statement st3 = conn.createStatement( ResultSet.TYPE_FORWARD_ONLY  ResultSet.CONCUR_READ_ONLY  ResultSet.HOLD_CURSORS_OVER_COMMIT); rs3[0] = st3.executeQuery('select * from testtable3'); return; }}Then with Derby embedded  if I have a JDBC Statement that executes a call to this procedure  rs1 and rs3 will behave with HOLD_CURSORS holdability and rs2 will behave with CLOSE_CURSORS holdability--and that will be the case regardless of the holdability on the Statement that executed the call. That seems correct to me.But if I do the same thing with Network Server  all of the result sets (rs1  rs2  and rs3) will have the same holdability as the JDBC Statement that executed the call. It doesn't matter what the holdabilities used within the procedure definition are: they will all be over-ridden by the holdability of the Statement that made the call.,0,0
Expose BOOLEAN datatype to end users,Veaceslav Chicu started an email thread on 8 August 2005 titled 'boolean type'. He was disappointed that Derby doesn't support the ansi BOOLEAN datatype. On closer inspection  Derby does internally support this type but does not expose this support to end users.Derby should let users declare table columns of type BOOLEAN. This should be an indexable datatype.,0,0
SELECT DISTINCT returns duplicates when selecting from subselects,When one performs a select distinct on a table generated by a subselect  there sometimes are duplicates in the result. The following example shows the problem:ij&gt; CREATE TABLE names (id INT PRIMARY KEY  name VARCHAR(10));0 rows inserted/updated/deletedij&gt; INSERT INTO names (id  name) VALUES (1  'Anna')  (2  'Ben')  (3  'Carl')  (4  'Carl')  (5  'Ben')  (6  'Anna');6 rows inserted/updated/deletedij&gt; SELECT DISTINCT(name) FROM (SELECT name  id FROM names) AS n;NAME ----------Anna Ben Carl Carl Ben Anna Six names are returned  although only three names should have been returned.When the result is explicitly sorted (using ORDER BY) or the id column is removed from the subselect  the query returns three names as expected:ij&gt; SELECT DISTINCT(name) FROM (SELECT name  id FROM names) AS n ORDER BY name;NAME ----------Anna Ben Carl 3 rows selectedij&gt; SELECT DISTINCT(name) FROM (SELECT name FROM names) AS n;NAME ----------Anna Ben Carl 3 rows selected,0,0
Integrate upgrade tests into test suite,Currently there are no upgrade tests in the derbyAll suite.The upgrade tests java/testing/org/apache/derbyTesting are run by script and require that the version to be tested by specified on the command line so that the classpath can be changed. runphases old_major old_minor old_engine new_engine# e.g.# runphases 10 0 c:/derby/10.0.2.1/lib c:/derby/trunk/jars/sanePerhaps this script can be rewritten in Java using class loaders and previous Derby verssions such as 10.0 and 10.1 be checked in so that this testing can be incorporated into the derbyAll test suite.,0,0
getAsciiStreamshould replace non-ASCII characters with 0x3f  '?'  to match embedded,When calling Clob.getAsciiStream or ResultSet.getAsciiStream if the column type is a character type or a CLOB  then any out of range character (to the ASCII set) needs to be replaced by 0x3f ('?'  question mark). ASCII is defined as 8 bit characters  thus Unicode Characters in the range 0x0000 to 0x00ff are mapped to ASCII characters 0x00 to 0xff  and Unicode characters in the range 0x0100 to 0xffff are mapped to 0x3fBy code inspection:client code in org.apache.derby.client.am.ResultSetembedded in org.apache.derby.impl.jdbc.ReaderToAscii,0,0
Incorrect insane build on windows platform,I've found that Derby will not build sane properly for me. I have isolated it to here: &lt;target name='evaluate.sane'&gt; &lt;condition property='generate.sane'&gt; &lt;equals arg1='${sane}' arg2='true'/&gt; &lt;/condition&gt; &lt;/target&gt;The scope of the generate.sane property is limited to this target (only tested in a Windows XP environment)  ergo it will always be an insane build. Patch to follow shortly.,0,0
ClientDriver ignores Properties object in connect(String url  Properties connectionProperties) method,In contrast to EmbeddedDriver  a connection attribute create=true is not recognized when presented as a property in a Properties object. As a workaround I append the attributes from the Properties object to the url string before invoking the connect() method: then a new database is created and a connection is established.Next code fragment illustrates the bug and the workaround: private static final ClientDriver clientDriver = new ClientDriver(); private Connection getClientConnection(String database  Properties connectionProperties) throws SQLException { try { System.out.println('Try to connect with properties'); String connectionURL = 'jdbc:derby://127.0.0.1:1527/' + database; System.out.println('connectionURL: ' + connectionURL); Connection rv = clientDriver.connect(connectionURL  connectionProperties); System.out.println('Connection: ' + rv); return rv; } catch (SQLException e) { System.out.println('Try to connect with URL attributes'); StringBuffer sb = new StringBuffer(); for (Enumeration enu = connectionProperties.propertyNames(); enu .hasMoreElements() { String key = (String) enu.nextElement(); sb.append(';'); sb.append(key); sb.append('='); sb.append(connectionProperties.getProperty(key  '')); } String connectionURL = 'jdbc:derby://127.0.0.1:1527/' + database + sb.toString(); System.out.println('connectionURL: ' + connectionURL); Connection rv = clientDriver.connect(connectionURL  connectionProperties); System.out.println('Connection: ' + rv); System.out .println('!!!!!!!!!!! seems a bug: Properties argument in ClientDriver.connect(String  Properties) has not been used'); return rv; } },0,0
The current build.properties for the Derby Help Plug-in for Eclipse does not work for creating a deployable plug-in,While updating the information for the web site about the Derby plug-ins I revised the instructions on how to create zip files for the plug-ins. The current build.properties file for the help plug-in did not work to create a deployable plug-in  without manual intervention. The attached patch for the build.properties file for the help plug-in should replace the existing one  which allows users to select Export &gt;&gt; Deployable plug-ins and fragments and then create a zip file which is suitable for deployment.svn stat output:M plugins/eclipse/org.apache.derby.plugin.doc/build.propertiesTests:I built a new doc zip file using the new build.properties file  unzipped it to another eclipse install in the ECLIPSE_HOME directory and made sure all of the files for the help were in the correct location and accessible.I'd appreciate it if someone could commit this.Thanks Susan,0,0
Loading databases from jars in the classpath is broken  databases cannot be found.,In converting an old Cloudscape test to ensure changes made for DERBY-538 would not break loading from classes stored in the database when the database itself is in a jar  I discovered that a database cannot be found that is in a jar on the classpath.Discovered the reason is the StoreFactory implementation for classpath always prepends a leading foward slash to the database name  but this is incorrect (e.g. db7 to /db7). This causes the database not to be found when the classloader is URLClassLoader as the correct path for the service.properties file is db7/services.properties  not /db7/services.properties.Will add converted test (lang/dbjar.sql),0,0
Read-only databases fail to boot after soft upgrade. Raises error message:  40XD1: Container was opened in read-only mode.,Attempting to boot a database that is created using Derby 10.0 fail in soft upgrade mode in Derby 10.1 or in trunk. (10.2) Boot fails with Error 40XD1: Container was opened in read-only mode.After debugging the problem a little  it seems soft upgrade code attempts do change a database property value and since the database is read-only  the error is raised. Here is what I tried:ij&gt; connect 'jdbc:derby:jar:(t10.jar)t10db';ERROR XJ040: Failed to start database 'jar:(t10.jar)t10db'  see the next exception for details.ERROR 40XD1: Container was opened in read-only mode.Here is the stack trace:ERROR 40XD1: Container was opened in read-only mode. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:301) at org.apache.derby.impl.store.raw.data.BaseContainer.use(BaseContainer.java:539) at org.apache.derby.impl.store.raw.data.BaseContainerHandle.useContainer(BaseContainerHandle.java:786) at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:633) at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:494) at org.apache.derby.impl.store.raw.xact.Xact.openContainer(Xact.java:1270) at org.apache.derby.impl.store.access.conglomerate.OpenConglomerate.init(OpenConglomerate.java:865) at org.apache.derby.impl.store.access.heap.Heap.openScan(Heap.java:675) at org.apache.derby.impl.store.access.RAMTransaction.openScan(RAMTransaction.java:530) at org.apache.derby.impl.store.access.RAMTransaction.openScan(RAMTransaction.java:1582) at org.apache.derby.impl.store.access.PropertyConglomerate.openScan(PropertyConglomerate.java:230) at org.apache.derby.impl.store.access.PropertyConglomerate.saveProperty(PropertyConglomerate.java:296) at org.apache.derby.impl.store.access.PropertyConglomerate.setProperty(PropertyConglomerate.java:535) at org.apache.derby.impl.store.access.RAMTransaction.setProperty(RAMTransaction.java:1787) at org.apache.derby.impl.sql.catalog.DD_Version.applySafeChanges(DD_Version.java:281) at org.apache.derby.impl.sql.catalog.DD_Version.upgradeIfNeeded(DD_Version.java:223) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.loadDictionaryTables(DataDictionaryImpl.java:5826) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.boot(DataDictionaryImpl.java:629) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1996) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:542) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionFactory.bootDataDictionary(GenericLanguageConnectionFactory.java:355) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionFactory.boot(GenericLanguageConnectionFactory.java:328) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1996) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:542) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:418) at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:193) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1996) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290) at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1834) at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1700) at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartServiceBaseMonitor.java:1528) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:998) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:990) at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:533) at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:1551) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(EmbedConnection.java:196) at org.apache.derby.impl.jdbc.EmbedConnection30.&lt;init&gt;(EmbedConnection30.java:72) at org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Driver30.java:73) at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:183) at java.sql.DriverManager.getConnection(DriverManager.java:512) at java.sql.DriverManager.getConnection(DriverManager.java:140) at org.apache.derby.impl.tools.ij.ij.dynamicConnection(ij.java:836) at org.apache.derby.impl.tools.ij.ij.ConnectStatement(ij.java:698) at org.apache.derby.impl.tools.ij.ij.ijStatement(ij.java:528) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:289) at org.apache.derby.impl.tools.ij.Main.go(Main.java:203) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169) at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55) at org.apache.derby.tools.ij.main(ij.java:60)ij&gt;,0,0
Dynamic parameter should be allowed to be the operand of unary operator '-'. Derby throws exception 42X36: The '-' operator is not allowed to take a ? parameter as an operand.',A simple test program which uses dynamic parameter for unary operator '-' fails with an exception. Following is the snippet of the code ps = con.prepareStatement('select * from t1 where c11 = -?'); ps.setInt(1 1); rs = ps.executeQuery();The prepareStatement call fails with following exceptionSQLSTATE(42X36):ERROR 42X36: The '-' operator is not allowed to take a ? parameter as an operand.,0,0
Using derby.language.logStatementText=true can mask certain exceptions and lead to incorrect behavior in some cases,Using derby.language.logStatementText=true can mask certain exceptions and lead to incorrect behavior.I observed this with tests using streams  where if valid (expected) exceptions are raised when DVD.getString() is called  the exception gets eaten up when this property is set. See 1)in GenericParameter.toString()try{return value.getString();}catch (StandardException se){return 'unexpected exception from getString() - ' + se;}}2)in GenericPreparedStatement.execute()  where pvs.toString() is called for the parameters.________Reproduction: Run the test jdbcapi/resultsetStream.java   with derby.language.logStatementText=true and expected error exceptions wont be thrown for the error cases. I looked at the tests that use streams   only the store/streamingColumn.java uses derby.language.logStatementText=true. I'll file another bug to resolve this test.,0,0
SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE fails on (very) large tables,SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE fails with one of the following error messages when applied to a very large table (&gt;2GB):Log operation null encounters error writing itself out to the log stream  this could be caused by an errant log operation or internal log buffer full due to excessively large log operation. SQLSTATE: XJ001: Java exception: ': java.io.IOException'.orThe exception 'java.lang.ArrayIndexOutOfBoundsException' was thrown while evaluating an expression. SQLSTATE: XJ001: Java exception: ': java.lang.ArrayIndexOutOfBoundsException'.In either case  no entry is written to the console log or to derby.log.,0,0
Make the client driver connection URL work when spaces are in the URL.,At present  if I want to connect to a database on a Derby server which has a space in the path  there is no way to do it.This can be done with the embedded driver  and for consistency it would be good if it worked for the client driver in the same fashion.,0,0
sysinfo incorrectly requires permission on Derby jar files,Running the test derbynet/sysinfo.java requires this permission in derby_tests.policy  in order to read the jar files.permission java.io.FilePermission '${csinfo.codedir}${/}*'  'read'But according to the Java security specs:'Note: code can always read a file from the same directory it's in (or a subdirectory of that directory); it does not need explicit permission to do so.'Probably means a privileged block is required when accessing the contents of the jar files in sysinfo,1,0
Derby monitor accesses two system properties without using a privileged block when built sane=true,When built with sane=true and testing with the jars these permissions are required to be granted all the way up the stack  currently this means for the tests granting them to the network server jar. permission java.util.PropertyPermission 'derby.monitor.verbose'  'read'; permission java.util.PropertyPermission 'derby.debug.*'  'read';The engine contains code to read system properties using privileged blocks  this should be used by the monitor.,1,0
create trigger fails with null pointer exception,When i create a brand new database  and execute the following statements all in one transaction or each of them in their own transaction  then it fails at trigger creation with null pointer exception. if i exclude the schema names from statement  then it runs fine. (If S1 is ommited from every statement then it runs fine). Once the version without the schema names run fine  i can run the version that has schema names  fine also. create schema S1;create table S1.PRODUCT( PRODUCT_ID VARCHAR(255) unique not null  VERSION BIGINT );create table S1.CATEGORY( CAT_ID VARCHAR(255)  NAME varchar(255) not null  VERSION BIGINT );create table S1.PROD_IN_CAT( CAT_ID VARCHAR(255) not null  PRODUCT_ID VARCHAR(255) not null  VERSION BIGINT );create trigger S1.product_v after update of version on S1.productreferencing new as nfor each rowmode db2sql update S1.prod_in_cat set version = n.version where S1.prod_in_cat.product_id=n.product_id;java.lang.NullPointerException at org.apache.derby.impl.sql.catalog.SYSSTATEMENTSRowFactory.makeSYSSTATEMENTSrow(Unknown Source) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.addSPSDescriptor(Unknown Source) at org.apache.derby.impl.sql.execute.CreateTriggerConstantAction.createSPS(Unknown Source) at org.apache.derby.impl.sql.execute.CreateTriggerConstantAction.executeConstantAction(Unknown Source)Stopping progress indicator for: Executing SQL at org.apache.derby.impl.sql.execute.MiscResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source),0,0
Subquery materialization can cause stack overflow,A performance optimization in subquery processing can cause a stack overflow.The optimization materializes a subquery ResultSet in memory where it thinks the rows will fit in memory. The materialization is done as a set of nested unions of constant rows (UnionResultSets and RowResultSets). If there are a lot of rows this can cause a stack overflow when fetching a row.The obvious fix is to make it use an iterative technique rather than a recursive one for storing and returning the rows. See the method BaseActivation.materializeResultSetIfPossible() in the language execution code.There are some other issues with this performance optimization that should be looked at:1) The optimization can backfire  making the query run much slower. For example  in the query: select * from one_row_table where column1 not in (select column2 from million_row_table)reading million_row_table into memory is an expensive operation. If there is an index on million_row_table.column2  the query should return a result very quickly despite the large size of million_row_table by doing a single probe into million_row_table via the index.Since in-memory materialization can be an expensive operation  the decision about whether to do it should be made based on query optimizer cost estimates. See SubqueryNode.generateExpression().2) It may not be wise to cache partial query results in memory at all. Although this can help performance in some cases  it also chews up memory. This is different from a limited-size cache with a backing store (like what the store uses for page caching). The language has no way to limit the total amount of memory used in this type of processing. Note that hash joins originally used in-memory hash tables with no backing store  and that a backing store was added later.3) The implementation of this optimization has some problems. The decision to materialize the subquery results in memory is made during code generation - all such decisions should be made during the compilation phase. It's not clear to me why materializeResultSetIfPossible() is in BaseActivation - I would expect the of materialization to be done by a type of ResultSet  not by a method in BaseActivation. Also  this method calls getMaxMemoryPerTable() in the OptimizerFactory - nothing in the execution code should refer to anything in the compilation code (perhaps getMaxMemoryPerTable() should be moved somewhere else).,0,1
Network driver setTransactionIsolation() causes a commit  but does not complete it locally,When autocommit is set to false  a call to setTransactionIsolation using client driver does not end the transaction when the method exits. When a close() is called on the conection  it throws an exception.Running the code below: conn.setAutoCommit(false); conn.setTransactionIsolation(Connection.TRANSACTION_READ_COMMITTED); try{ conn.close(); }catch(SQLException se){ System.out.println('Got exception when closing the connection'); se.printStackTrace(); }with client driver gives:Got exception when closing the connectionorg.apache.derby.client.am.SqlException: java.sql.Connection.close() requested while a transaction is in progress on the connection.The transaction remains active  and the connection cannot be closed.with embedded driver  it works okay and does not throw any exception.,0,0
SELECT MAX doesn't use indices optimally,I tried running SELECT MAX on an indexed column in a big (8 GB)table. It took 12 minutes  which is about 12 minutes more than Iexpected.After a bit of investigation  I found out that a full index scan wasperformed because all the rows referenced from the rightmost B-treenode were actually deleted.Possible improvements: 1. Implement backwards scan in the B-trees (this is also suggested in the comments in BTreeMaxScan). 2. Go up to the parent node and down to the next leaf node on the left side  and continue until a valid max value is found. In Derby  traversing up in a B-tree is not allowed  but would it be ok to go up if the latches were kept on the higher-level nodes in the tree? Of course  this would have negative impact on concurrency. 3. Right-to-left traversal on the leaf level is possible (using ControlRow.getLeftSibling())  but will throw an exception if the page cannot be latched without waiting. It is therefore possible to try a right-to-left search for the max value  and only fall back to the left-to-right approach if a conflict arises.,0,1
getImportedKeys returns duplicate rows in some cases,I have a database with a large number of tables. I get duplicate rows when I call DatabaseMetaData.getImportedKeys for a particular table. However  if I create the same table with same number of foreign keys in another database (which has fewer number of tables)  then getImportedKeys returns me the correct number of rows. This error seems to happen only when the database has a large number of tables. I will attach a repro for this shortly.,0,0
SecurityException with accessDeclaredMembers on DatabaseMetaData.getTables.,The code to determine the size of a class is using getDeclaredMembers which requires the permission accessDeclaredMembers. Ideally should not require to grant this permission to derby.jar. Need to see whichclass's size was being calculated. The code is not in a priv block which would require granting the permission all the way up the stack.Maybe if the class's declared memebrs can not be accessed and the value can not be pre-calculkated then some estimate could be made. (using public fields?).java.security.AccessControlException: Access denied (java.lang.RuntimePermission accessDeclaredMembers) at java.security.AccessController.checkPermission(AccessController.java:107) at java.lang.SecurityManager.checkPermission(SecurityManager.java:547) at com.ibm.ws.security.core.SecurityManager.checkPermission(SecurityManager.java:188) at java.lang.SecurityManager.checkMemberAccess(SecurityManager.java:1677) at java.lang.Class.checkMemberAccess(Class.java:104) at java.lang.Class.getDeclaredFields(Class.java:508) at org.apache.derby.iapi.services.cache.ClassSize.getSizeCoefficients(Unknown Source) at org.apache.derby.iapi.services.cache.ClassSize.estimateBase(Unknown Source) at org.apache.derby.iapi.store.access.BackingStoreHashtable.&lt;clinit&gt;(Unknown Source) at java.lang.J9VMInternals.initializeImpl(Native Method) at java.lang.J9VMInternals.initialize(J9VMInternals.java:148) at org.apache.derby.impl.sql.execute.HashTableResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.JoinResultSet.openRight(Unknown Source) at org.apache.derby.impl.sql.execute.JoinResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.SortResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeQuery(Unknown Source) at org.apache.derby.impl.jdbc.EmbedDatabaseMetaData.getTables(Unknown Source),1,0
during crash recovery of a drop table  on case insensitive files systems derby may delete wrong file,Sometimes during redo the system will incorrectly remove the file associatedwith a table. The bug requires the following conditions to reproduce:1) The OS/filesystem must be case insensitive such that a request to delete a file named C2080.dat would also remove c2080.dat. This is true in windows default file systems  not true in unix/linux filesystems that I am aware of.2) The system must be shutdown not in a clean manner  such that a subsequent access of the database causes a REDO recovery action of a drop table statement. This means that a drop table statement must have happened since the last checkpoint in the log file. Examples of things that cause checkpoints are: o clean shutdown from ij using the 'exit' command o clean shutdown of database using the 'shutdown=true' url o calling the checkpoint system procedure o generating enough log activity to cause a regularly scheduled checkpoint.3) If the conglomerate number of the above described drop table is TABLE_1  then for a problem to occur there must also exist in the database a table such that it's HEX(TABLE_2) = TABLE_14) Either TABLE_2 must not be accessed during REDO prior to the REDO operation of the drop of TABLE_1 or there must be enough other table references during the REDO phase to push the caching of of the open of TABLE_2 out of cache.If all of the above conditions are met then during REDO the system willincorrectly delete TABLE_2 while trying to redo the drop of TABLE_1.&lt;p&gt;I will be adding the following test to reproduce the problem:1) create 500 tables  need enough tables to insure that conglomerate number 2080 (c820.dat) and 8320 (c2080.dat) exist.2) checkpoint the database so that create does not happen during REDO3) drop table with conglomerate number 2080  mapping to c820.dat. It looks it up in the catalog in case conglomerate number assignment changes for some reason.4) exit the database without a clean shudown  this is the default for test suites which run multiple tests in a single db - no clean shutdown is done. Since we only do a single drop since the last checkpoint  test will cause the drop during the subsequent REDO.5) run next test program dropcrash2  which will cause redo of the drop. At this point the bug will cause file c2080.dat to be incorrectly deleted and thus accesses to conglomerate 8320 will throw container does not exist errors.6) check the consistency of the database which will find the container does not exist error.,0,0
Remove backup(File ...) methods,The code contains backup methods both for specifying the backup directory both as a String and as a File parameter. Only the String versions are currently used. The File versions should be removed to avoid duplication of code etc.Examples of such methods are:BasicDatabase.backupBasicDatabase.backupAndEnableLogArchiveModeRAMAccessManager.backupRAMAccessManager.backupAndEnableLogArchiveModeRawStore.backupAndEnableLogArchiveModeplus corresponding interfaces.,0,0
Build-time processing of 'metadata.properties' file handles slashes incorrectly.,As found and described by Mamta here:http://www.nabble.com/-Derby-573-Optimizer-overrides-and-metadata.properties-files-t460642.htmlDuring the ant build process  Derby's metadata.properties file is modified by the ODBCMetadataGenerator class and that class treats backslashes that occur in the metadata.properties file incorrectly. More specifically  it treats every backslash as the end of a line and thus will translate things likeFROM --DERBY-PROPERTIES joinOrder=FIXED n /intoFROM --DERBY-PROPERTIES joinOrder=FIXED //n /(in other words  escaped characters like '/n' are handled incorrectly)..,0,0
In ij  executing a prepared statement with numeric/decimal parameter fails with NullPointerException in J2ME/CDC/FP,NPE is thrown in ij when executing prepared statement which  has numeric/decimal parameters does not return any result setRepro for this problem is the test lang/cast.sql. This test currently fails in CDC/FP.The following lines in the test throw NPE:execute q10 using 'values 123456.78';execute q11 using 'values 123456.78';where q10 is 'prepare q10 as 'insert into t1 (num) values cast(? as numeric(18))';'and q11 is 'prepare q11 as 'insert into t1 (dc) values cast(? as decimal(18))';'The stack trace for failure is:java.lang.NullPointerException at org.apache.derby.impl.tools.ij.util.DisplayMulti(util.java:666) at org.apache.derby.impl.tools.ij.utilMain.displayResult(utilMain.java:398) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:290) at org.apache.derby.impl.tools.ij.Main.go(Main.java:203) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169) at org.apache.derby.impl.tools.ij.Main.main(Main.java:75) at org.apache.derby.tools.ij.main(ij.java:56)This happens in the following code. Since the above prepared statements do not return result sets  call to getMetaData() will return null. But in the code  no check is done to see if getMetaData() returns null before calling getColumnType.------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- // In J2ME there is no object that represents // a DECIMAL value. By default use String to // pass values around  but for integral types // first convert to a integral type from the DECIMAL // because strings like 3.4 are not convertible to // an integral type. switch (ps.getMetaData().getColumnType(c)) { case Types.BIGINT: ps.setLong(c  rs.getLong(c)); break; case Types.INTEGER: case Types.SMALLINT: case Types.TINYINT: ps.setInt(c  rs.getInt(c)); break; default: ps.setString(c rs.getString(c)); break; } -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------,0,0
Add tests for error codes for severe exceptions,Add tests to test error codes for disconnect exceptions and other severe errors for client and embedded drivers.,0,0
NullPointerException or ClassCastException if UPDATE or DELETE is performed on a diagnostic VTI,UPDATE and DELETE statements on read-only vtis will hit NullPointerException in insane mode  and ClassCastException in sane mode.ij&gt; delete from new org.apache.derby.diag.TransactionTable();ERROR XJ001: Java exception: ': java.lang.NullPointerException'.While these statements make no sense  a more graceful error should be returned  especially as in insane mode this causes the engine to shutdown. Code already exists to detect this situation but is not being called.Found through adding negative tests for DERBY-571,0,0
Network client: deleteRow() makes getter methods return nulls for the following rows.,On the network driver  the ResultSet.deleteRow() method causes the getXXX() methods in the following rows to return null values. It should be possible to use the getXXX methods after positioning the cursor in the next row. It also has this side effect on other result sets if these are created with the same prepared statement.The repro case is uploaded as an attachment 'testDeleteRow.java'Output of the report case:List all rowsRow: 1: Testing 1Row: 2: Testing 2Row: 3: Testing 3Row: 4: Testing 4Row: 5: Testing 5Row: 6: Testing 6Row: 7: Testing 7Row: 8: Testing 8Row: 9: Testing 9Row: 10: Testing 10List all rows and delete first rowRow: 1: Testing 1Row deleted!Row: 0: nullRow: 0: nullRow: 0: nullRow: 0: nullRow: 0: nullRow: 0: nullRow: 0: nullRow: 0: nullRow: 0: nullList all rowsRow: 2: Testing 2Row: 3: Testing 3Row: 4: Testing 4Row: 5: Testing 5Row: 6: Testing 6Row: 7: Testing 7Row: 8: Testing 8Row: 9: Testing 9Row: 10: Testing 10,0,0
Unable to create databases whose name containg Chinese characters through the client driver,Trying to create a database with the following URL (note the Chinese character in the database name):jdbc:derby://localhost:1527//u4e10;create=truethrows the following exception:----%&lt;----Exception in thread 'main' org.apache.derby.client.am.SqlException: Unicode string can't convert to Ebcdic string at org.apache.derby.client.net.EbcdicCcsidManager.convertFromUCS2(Unknown Source) at org.apache.derby.client.net.Request.writeScalarPaddedString(Unknown Source) at org.apache.derby.client.net.NetConnectionRequest.buildRDBNAM(Unknown Source) at org.apache.derby.client.net.NetConnectionRequest.buildACCSEC(Unknown Source) at org.apache.derby.client.net.NetConnectionRequest.writeAccessSecurity(Unknown Source) at org.apache.derby.client.net.NetConnection.writeServerAttributesAndKeyExchange(Unknown Source) at org.apache.derby.client.net.NetConnection.flowServerAttributesAndKeyExchange(Unknown Source) at org.apache.derby.client.net.NetConnection.flowUSRIDONLconnect(Unknown Source) at org.apache.derby.client.net.NetConnection.flowConnect(Unknown Source) at org.apache.derby.client.net.NetConnection.&lt;init&gt;(Unknown Source) at org.apache.derby.jdbc.ClientDriver.connect(Unknown Source) at java.sql.DriverManager.getConnection(DriverManager.java:525) at java.sql.DriverManager.getConnection(DriverManager.java:193) at jdbctest.Main.main(Main.java:33)----%&lt;----It's possible  however  to create databases using the embedded driver  using an URL like:jdbc:derby:/u4e10;create=trueTested with both 10.1.1.0 and 10.1.2.1 with the same result.Complete code to reproduce the bug:----%&lt;----public static void main(String[] args) throws Exception { Class.forName('org.apache.derby.jdbc.ClientDriver'); Connection conn = DriverManager.getConnection('jdbc:derby://localhost:1527//u4e10;create=true');}----%&lt;----,0,0
Starvation in RAFContainer.readPage(),When Derby is completely disk bound  threads might be starved inRAFContainer.readPage(). This is a real problem when multiple clientsare repeatedly accessing one or a small number of large tables. Incases like this  I have observed very high maximum response times(several minutes in the worst cases) on simple transactions. Theaverage response time is not affected by this.The starvation is caused by a synchronized block inRAFContainer.readPage(): synchronized (this) { fileData.seek(pageOffset); fileData.readFully(pageData  0  pageSize); }If many threads want to read pages from the same file  there will be along queue of threads waiting for this monitor. Since the Javaspecification does not guarantee that threads waiting for monitors aretreated fairly  some threads might have to wait for a long time beforethey get the monitor. (Usually  a couple of threads get full throughputwhile the others have to wait.),0,1
SYSCS_UTIL.SYSCS_COMPRESS_TABLE should create statistics if they do not exist,There must be an entry in the SYSSTATISTICS table in order for the cardinality statistics in SYSSTATISTICS to be created with SYSCS_UTIL.SYSCS_COMPRESS_TABLE SYSCS_UTIL.SYSCS_COMPRESS_TABLE should create statistics if they don't exist. The only way to create them if the index was created on an empty table  seems to be to drop and recreate the index after the table has been loaded.The documentation will also need updating if this change is made.http://db.apache.org/derby/docs/10.1/tuning/ctunstats57373.html,0,0
Problem setting sanity state to false by using 'ant -Dsane=false',Problem report from Kathey Marsden:There seems to be some sort of problem with the sanity state.After ant clobber  rm -rf jars  rm -rf snapshot no apparent problematicfiles  ant -Dsane=false snapshot seemed to sometimes build the jars tothe sane jar directory and yield the following error..... &#91;delete&#93; Deleting directory D:/svn/opensource/10.1/javadoc/sourcedir &#91;mkdir&#93; Created dir: D:/svn/opensource/10.1/snapshotBUILD FAILEDD:/svn/opensource/10.1/build.xml:1287:D:/svn/opensource/10.1/jars/insane not found.A reliable workaround was to runant insanebefore ant -Dsane=false snapshot.,0,0
Materialize subqueries in select list where possible to avoid creating invariant resultsets many times.,Derby's handling of union subqueries in from list can be improved by materializing invariant resultsets once  rather than creating them many times.For example:create view V1 as select i  j from T1 union select i j from T2;create view V2 as select a b from T3 union select a b from T4;insert into T1 values (1 1)  (2 2)  (3 3)  (4 4)  (5 5);For a query like select * from V1  V2 where V1.j = V2.b and V1.i in (1 2 3 4 5)  it is possible the resultset for V2 is created 5 times. (assuming V2 is choosen as the the inner table) This can be very costly if the underlying selects can take long time and also may perform union many times.Enhance materialization logic in setOperatorNode.java. It currently returns FALSE always.public boolean performMaterialization(JBitSet outerTables) throws StandardException{ // RESOLVE - just say no to materialization right now - should be a cost based decision return false; /* Actual materialization  if appropriate  will be placed by our parent PRN. This is because PRN might have a join condition to apply. (Materialization can only occur before that. */ //return true;},0,0
Enhance ALTER TABLE syntax to allow users to change the next value to be generated for an identity column,Derby allows a user to change the interval between consecutive values of the identity column using ALTER TABLE. But there is no way to change the next value to be generated for an identity column. Such a support in Derby will be very handy for tables with identity column defined as GENERATED BY DEFAULT and with a unique key defined on them. Column defined with GENERATED BY DEFAULT allows system to generate values for them or allows the user to manually supply the value for them. A column defined this way is very useful when the user might want to import some data into the generated column manually. But this can create problems when the system generated values conflict with manually inserted values.egautocommit on;create table tauto(i int generated by default as identity  k int); create unique index tautoInd on tauto; insert into tauto(k) values 1 2; &#8211; let system generate values for the identity column&#8211; now do few manual inserts into identity columninsert into tauto values (3 3); insert into tauto values (4 4); insert into tauto values (5 5); insert into tauto values (6 6); insert into tauto values (7 7); insert into tauto values (8 8); &#8211; notice that identity column at this point has used 1 through 8&#8211; now if the user wants to let the system generate a value  system will generate 3 but that is already used and hence&#8211; insert will throw unique key failure exception. System has consumed 3 at this point.insert into tauto(k) values 9;&#8211; the insert above will continue to fail with the unique key failure exceptions until system has consumed all the values till 8&#8211; If we add ALTER TABLE syntax to allow changing the next value to be generated  then user can simply use that to change&#8211; next value to be generated to 9 after the manual inserts above and then insert into tauto(k) values 9 will not failSQL standard syntax for changing the next generated valueALTER TABLE &lt;tablename&gt; ALTER &lt;columnName&gt; RESTART WITH integer-constant,0,0
cursor closed as a sideeffect of closing another cursor with the same name on another connection,I was writing some tests for the Scrollable updatable ResultSet feature  and found some tests failing with ERROR XCL07: Cursor 'SQLCUR0' is closed. Verify that autocommit is OFF.in ResultSet.updateRow(). The test does the following:1. set up a connection  and run a query which selects one tuple2. update the tuple using updateXXX and updateRow3. rollback the transaction and close the connectionThen  repeat the process  however this time use a different string in the query. This time updateRow() may fail with the error above. The problem has been reproduced on forward only  updatable resultsets.Workaround:It does not seem to fail if Ia  set another cursorname on the statement object b  use the same query string.I will attach the program to reproduce the problem. Below is the output:~:/&lt;3&gt;db-derby-10.1.2.1-bin/lib&gt; java -cp /home/ak136785/devel/derbytesting/derbytest/build/classes/:derby.jar derbytest.CursorIsClosedIssue1 1 19 Tuple 12 2 21 Tuple 2ERROR XCL07: Cursor 'SQLCUR0' is closed. Verify that autocommit is OFF. at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.impl.sql.execute.CurrentOfResultSet.getCursor(Unknown Source) at org.apache.derby.impl.sql.execute.CurrentOfResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.NormalizeResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.UpdateResultSet.setup(Unknown Source) at org.apache.derby.impl.sql.execute.UpdateResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedResultSet.updateRow(Unknown Source) at derbytest.CursorIsClosedIssue.runTest(CursorIsClosedIssue.java:80) at derbytest.CursorIsClosedIssue.main(CursorIsClosedIssue.java:103),0,0
Allow parallel access to data files.,Derby currently serializes accesses to a data file. For example  theimplementation of RAFContainer.readPage is as follows: synchronized (this) { // 'this' is a FileContainer  i.e. a file object fileData.seek(pageOffset); // fileData is a RandomAccessFile fileData.readFully(pageData  0  pageSize); }I have experiemented with a patch where I have introduced several filedescriptors (RandomAccessFile objects) per RAFContainer. These areused for reading. The principle is that when all readers are busy  areadPage request will create a new reader. (There is a maximum numberof readers.) With this patch  throughput was improved by 50% onlinux. For more discussion on this  seehttp://www.nabble.com/Derby-I-O-issues-during-checkpointing-t473523.htmlThe challenge with the suggested approach is to make a mechanism tolimit the number of open file descpriptors. Mike Matrigali hassuggested to use the existing CacheManager infrastructure for thispurpose. For a discussion on that  see:http://www.nabble.com/new-uses-for-basic-services-cache---looking-for-advice-t756863.html,0,1
One each deleted or updated from a heap row a new RowPosition object is created.,See the new RowPosition in GenericConglomerateController.delete and replace. The fetch methods also have new RowPosition calls but in general these calls are not made for scans.Can a single RowPosition object be re-used across the life of the query?In general Derby should try to avoid creating objects per row in any statement as the gc overhead when operating on a large number of rows can be high.,0,1
Incorrect documentation for 'NetworkServerControl.logConnections(boolean)',The documentation for 'NetworkServerControl.logConnections(boolean)' states that Derby logs both connections and disconnections. As of 10.1.2.1 and (all) earlier releases  this is not true. The documentation should be corrected to avoid confusing users.The thought of adding logging of disconnections has also been posted on derby-dev.Byran Pendleton identified the following documentation with the incorrect description:http://db.apache.org/derby/javadoc/publishedapi/org/apache/derby/drda/NetworkServerControl.htmlhttp://db.apache.org/derby/docs/10.1/adminguide/radminconfigdb2jdrdalogconnections.htmlhttp://db.apache.org/derby/docs/10.0/manuals/admin/hubprnt23.htmlhttp://db.apache.org/derby/docs/10.1/adminguide/tadminlogfile.htmlShould we fix this in 10.0? If yes  please update fix versions for this issue.,0,0
Client driver: Pre-fetch data on executeQuery(),Currently  the client driver does not pre-fetch data whenexecuteQuery() is called  but it does on the first call toResultSet.next(). Pre-fetching data on executeQuery() would reducenetwork traffic and improve performance.The DRDA protocol supports this. From the description of OPNQRY (openquery): The qryrowset parameter specifies whether a rowset of rows is to be returned with the command. This is only honored for non-dynamic scrollable cursors (QRYATTSNS not equal to QRYSNSDYN) and for non-scrollable cursors conforming to the limited block query protocol. The target server fetches no more than the requested number of rows. It may fetch fewer rows if it is restricted by extra query block limits  or if a fetch operation results in a negative SQLSTATE or an SQLSTATE of 02000.,0,1
modify setCharacterStreamInternal to take a long for the length  and perform the > max int check in the method,A similar change to setBinaryStreamInternal is being handled as part of DERBY-599.,0,0
LDAP user authentication fails under a security manager,Running the test jdbcapi/secureUsers1.sql with a security manager results in:&gt; ERROR 08004: Connection refused : javax.naming.CommunicationException: noSuchMachine:389 &#91;Root exception is java.security.AccessControlException: access denied (java.net.SocketPermission noSuchMachine resolve)&#93;Adding this permission to the policy file has no effect. which means a priv block is required around the LDAP call.permission java.net.SocketPermission 'noSuchMachine'  'resolve';,1,0
Intermittent failure of store/readlocks.sql,The store/readlocks.sql test in derbyall fails intermittently with the following diff:     Start: readlocks jdk1.3.1_15 storeall:storemore 2006-01-22 03:25:51 ***19532a19533&gt; APP |UserTran|ROW |1 |S |A |(2 6) |GRANT|ACTIVE Test Failed. End: readlocks jdk1.3.1_15 storeall:storemore 2006-01-22 03:30:30 ***    i.e. it looks like there is an extra lock in the printed lock table.,0,0
add mechanism for specifying policy file for individual function tests,It would be nice to be able to specify a test-specific policy file.This should get handled similar to existing properties  i.e. get specified in a test_app.properties file (or  for a suite  in the suite.properties file). The file should then be copied into the correct place.Note  that the 'old' functionTests harness (as opposed to junit tests) includes a check for a property called 'serverPolicyFile' (in harness/jvm.java). The name is a left over from when the policy file was only used for/by network server  and should be renamed - derbyTestPolicyFile  for instance. It is not used anywhere at present  and not specific to network server. It would be nice if this could be expanded  or  if not used  removed.The default policy file used is the derby_tests.policy file under functionTests/util.Also  currently  the property can only be used with RunTest - for further traction  it should probably get passed on through RunSuite/RunList.Once confirmed to be working  the property should get documented in &lt;trunk&gt;/java/testing/README.htm.,0,0
Remove use of String(byte[]) and String(byte[]  int  int) constructors in testing leading to non-portable behaviour,These constructors use the Java default platform encoding to convert the bytes to a String  this typically leads to bugs on platforms with different encodings.Replace with code using fixed conversion  or alternative mechanisms. If the call is required its use should be commented as to why it is required.org.apache.derbyTesting.functionTests.tests.jdbcapi.blobclob4BLOBorg.apache.derbyTesting.functionTests.tests.jdbcapi.resultsetorg.apache.derbyTesting.functionTests.tests.lang.coalesceTestsorg.apache.derbyTesting.functionTests.tests.store.streamingColumnI generated this list using the Java search in eclipse for references to the constructorsString(byte[])String(byte[] int int) (no occurrences in java/testing),0,0
big decimal error diff in derbyall lang/procedure test run in the DerbyNetClient - jdk1.3 specific,derby all regression test failure in the following test. Most recently it failed in the 1/27 derby build. It also failed on 1/20. It ran fine on 1/13. Havenot had time to narrow down further. Did note that there is a separate master for this test   but no jdk131 specific masters that I could see.     Start: procedure jdk1.3.1_15 DerbyNetClient derbynetmats:derbynetmats 2006-01-22 05:30:23 ***274 del&lt; EXPECTED SQL Exception: BigDecimal conversion exception &#91;converters&#93; Overflow occurred during numeric data type conversion of '10243'.. See attached Throwable.274a274&gt; EXPECTED SQL Exception: BigDecimal conversion exception &#91;converters&#93; Overflow occurred during numeric data type conversion of '10243'.. See attached Throwable. Caused by exception class org.apache.derby.client.am.ConversionException: &#91;converters&#93; Overflow occurred during numeric data type conversion of '10243'.337 del&lt; EXPECTED SQL Exception: Invalid argument: parameter index 2 is not an OUT or INOUT parameter.337a337&gt; EXPECTED SQL Exception: XN009.S : &#91;0&#93; 2355 del&lt; EXPECTED SQL Exception: BigDecimal conversion exception &#91;converters&#93; Overflow occurred during numeric data type conversion of '102.33'.. See attached Throwable.355a355&gt; EXPECTED SQL Exception: BigDecimal conversion exception &#91;converters&#93; Overflow occurred during numeric data type conversion of '102.33'.. See attached Throwable. Caused by exception class org.apache.derby.client.am.ConversionException: &#91;converters&#93; Overflow occurred during numeric data type conversion of '102.33'.Test Failed. End: procedure jdk1.3.1_15 DerbyNetClient derbynetmats:derbynetmats 2006-01-22 05:31:39 ***,0,0
introduce a new test type to run junit tests from the current harness,It seems to me that for including a new JUnit test into i.e derby-all we need to make a new java class with a main() method  which parses a command line and set up the testsuite and run it  just like any java program. Basically we are running the junit tests as test type 'java'.Instead of having to do this for every junit test going into a derby test suite  I would propose a different strategy.I propose to introduce a new test type called 'junit' (current test types are: sql sql2 unit java multi demo - unit is not junit)Then you can use:java org.apache.derbyTesting.functionTests.harness.RunTest &lt;TestCaseClassName&gt;.junitto run a Junit test - instead of:java org.apache.derbyTesting.functionTests.harness.RunTest &lt;AnotherClassWithMainMethod&gt;.javaWhen starting a test of type junit  the RunTest class may simply use thejunit.textui.TestRunner class  which has a main method which takes a TestCase class name as parameter. The junit.textui.TestRunner runs the tests defined by the suite() method of the TestCase class.I think this strategy will make it easier to integrate new JUnit tests into the current test suites  since it save you the trouble of creating a java class with a main method for every test.,1,0
new JDBC4 metadata API getFunctions() needs to be implemented,For now I am implementing this to return empty result set so at least we're compliant  but we should be able to implement this one,0,0
NullPointerException at ResultSet.close() time for simple query using UNION and INTERSECT,If I set 'derby.language.logQueryPlan' to true and then attempt to execute the following simple query using UNION and INTERSECT  Derby will return the correct results and then  after returning the results  will throw a NullPointerException. This error also occurs for 10.1.To reproduce:&gt; java -Dderby.language.logQueryPlan=true org.apache.derby.tools.ijand then do:create table t1 (i int);create table t2 (j int);create table t3 (a int);ij&gt; select i from t1 union (select j from t2 intersect select a from t3);1-----------0 rows selectedERROR XJ001: Java exception: ': java.lang.NullPointerException'.If I add data  the query will return the correct results  but then throw the NPE.insert into t1 values 1  2  3  4  5;insert into t2 values 2  4  6  8  10;insert into t3 values 2  3  4;ij&gt; select i from t1 union (select j from t2 intersect select a from t3);1-----------123455 rows selectedERROR XJ001: Java exception: ': java.lang.NullPointerException'.The embedded and client stack traces are shown below. Both suggest that the problem occurs during the close of the result set.&#8211; Embedded &#8211;java.lang.NullPointerException at org.apache.derby.impl.sql.execute.rts.RealUnionResultSetStatistics.getStatementExecutionPlanText(RealUnionResultSetStatistics.java:107) at org.apache.derby.impl.sql.execute.rts.RealSortStatistics.getStatementExecutionPlanText(RealSortStatistics.java:124) at org.apache.derby.impl.sql.execute.rts.RunTimeStatisticsImpl.getStatementExecutionPlanText(RunTimeStatisticsImpl.java:293) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.finishAndRTS(BasicNoPutResultSetImpl.java:633) at org.apache.derby.impl.sql.execute.SortResultSet.finish(SortResultSet.java:479) at org.apache.derby.impl.jdbc.EmbedResultSet.close(EmbedResultSet.java:533) at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:272) at org.apache.derby.tools.JDBCDisplayUtil.DisplayResults(JDBCDisplayUtil.java:260) at org.apache.derby.impl.tools.ij.utilMain.displayResult(utilMain.java:381) at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:434) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:310) at org.apache.derby.impl.tools.ij.Main.go(Main.java:203) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169) at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55) at org.apache.derby.tools.ij.main(ij.java:60)&#8211; Client &#8211;ERROR (no SQLState): actual code point  4692 does not match expected code point  9224java.sql.SQLException: actual code point  4692 does not match expected code point  9224 at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:280) at org.apache.derby.client.am.ResultSet.close(ResultSet.java:412) at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:272) at org.apache.derby.tools.JDBCDisplayUtil.DisplayResults(JDBCDisplayUtil.java:260) at org.apache.derby.impl.tools.ij.utilMain.displayResult(utilMain.java:381) at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:434) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:310) at org.apache.derby.impl.tools.ij.Main.go(Main.java:203) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169) at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55) at org.apache.derby.tools.ij.main(ij.java:60)Caused by: org.apache.derby.client.am.DisconnectException: actual code point  4692 does not match expected code point  9224 at org.apache.derby.client.net.Reply.zThrowSyntaxError(Reply.java:1157) at org.apache.derby.client.net.Reply.parseLengthAndMatchCodePoint(Reply.java:1057) at org.apache.derby.client.net.NetConnectionReply.parseSQLCARD(NetConnectionReply.java:2519) at org.apache.derby.client.net.NetConnectionReply.parseRDBCMMreply(NetConnectionReply.java:200) at org.apache.derby.client.net.NetConnectionReply.readLocalCommit(NetConnectionReply.java:133) at org.apache.derby.client.net.ConnectionReply.readLocalCommit(ConnectionReply.java:42) at org.apache.derby.client.net.NetConnection.readLocalCommit_(NetConnection.java:1347) at org.apache.derby.client.am.Connection.readCommit(Connection.java:624) at org.apache.derby.client.am.Connection.readAutoCommit(Connection.java:614) at org.apache.derby.client.am.ResultSet.readAutoCommitIfNotAutoCommitted(ResultSet.java:509) at org.apache.derby.client.am.ResultSet.readCloseAndAutoCommit(ResultSet.java:474) at org.apache.derby.client.am.ResultSet.flowCloseAndAutoCommitIfNotAutoCommitted(ResultSet.java:455) at org.apache.derby.client.am.ResultSet.closeX(ResultSet.java:425) at org.apache.derby.client.am.ResultSet.close(ResultSet.java:407)ERROR XJ001: DERBY SQL error: SQLCODE: -1  SQLSTATE: XJ001  SQLERRMC: java.lang.NullPointerException&#91;XX&#93; XJ001.Ujava.sql.SQLException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XJ001  SQLERRMC: java.lang.NullPointerException&#91;XX&#93;XJ001.U at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:280) at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:295) at org.apache.derby.client.am.ResultSet.close(ResultSet.java:412) at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:272) at org.apache.derby.tools.JDBCDisplayUtil.DisplayResults(JDBCDisplayUtil.java:260) at org.apache.derby.impl.tools.ij.utilMain.displayResult(utilMain.java:381) at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:434) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:310) at org.apache.derby.impl.tools.ij.Main.go(Main.java:203) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169) at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55) at org.apache.derby.tools.ij.main(ij.java:60),0,0
Error 22001 can include 'XX-RESOLVE-XX' which should be removed,In some cases  error 22001 can come up as follows: A truncation error was encountered trying to shrink CHAR () FOR BIT DATA 'XX-RESOLVE-XX' to length 40.This message makes it appear as if there is a column called XX-RESOLVE-XX  however  this string is coming out of SQLBinary.java.It should be removed from the message.Other references for this string are in the masters for updatableResultSet.out  and in the test lang/concateTests.java (referring to DERBY-124).So  running updatableResultSet will generate the message.The stack trace I saw: at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:362) at org.apache.derby.iapi.types.SQLBinary.checkHostVariable(SQLBinary.java:977) at org.apache.derby.exe.ac05550069x0109x5d95xbdfcxffff9c80fb80163.e0 (Unknown Source) at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:138) at org.apache.derby.impl.sql.execute.RowResultSet.getNextRowCore(RowResultSet.java:155) at org.apache.derby.impl.sql.execute.NormalizeResultSet.getNextRowCore (NormalizeResultSet.java:204) at org.apache.derby.impl.sql.execute.DMLWriteResultSet.getNextRowCore(DMLWriteResultSet.java:123) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:521) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:359) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1142) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1421) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:263),0,0
DatabaseMetadata method supportsResultSetConcurrency returns wrong result on network client,The DatabaseMetaData method supportsResultSetConcurrency erroneouslyreturns false on the network client for all arguments combination  cfthe attached repro program. The embedded client returns correctresults  viz the output:org.apache.derby.jdbc.ClientDriver:SupportsResultSetConcurrency: TYPE_FORWARD_ONLY CONCUR_READ_ONLY: falseSupportsResultSetConcurrency: TYPE_FORWARD_ONLY CONCUR_UPDATABLE: falseSupportsResultSetConcurrency: TYPE_SCROLL_INSENSITIVE CONCUR_READ_ONLY: falseSupportsResultSetConcurrency: TYPE_SCROLL_INSENSITIVE CONCUR_UPDATABLE: falseSupportsResultSetConcurrency: TYPE_SCROLL_SENSITIVE CONCUR_READ_ONLY: falseSupportsResultSetConcurrency: TYPE_SCROLL_SENSITIVE CONCUR_UPDATABLE: falseorg.apache.derby.jdbc.EmbeddedDriver:SupportsResultSetConcurrency: TYPE_FORWARD_ONLY CONCUR_READ_ONLY: trueSupportsResultSetConcurrency: TYPE_FORWARD_ONLY CONCUR_UPDATABLE: trueSupportsResultSetConcurrency: TYPE_SCROLL_INSENSITIVE CONCUR_READ_ONLY: trueSupportsResultSetConcurrency: TYPE_SCROLL_INSENSITIVE CONCUR_UPDATABLE: falseSupportsResultSetConcurrency: TYPE_SCROLL_SENSITIVE CONCUR_READ_ONLY: falseSupportsResultSetConcurrency: TYPE_SCROLL_SENSITIVE CONCUR_UPDATABLE: falsePresumably  this is wrong in released versions as well.,0,0
creating a preparedStatement outside of a Global tran using a ClientXADatasource  will result in an 'SqlException: Cannot set holdability'  if the statement  is used in a Global transaction,creating a preparedStatement outside of a Global tran using an xa datasource will result in an exception if the statement is used in a Global (i.e. xa transaction).  DERBY-346 and DERBY-8 may be relevant to this issue.User noted 1) setting the holdability on the connection to CLOSE_CURSORS_AT_COMMIT doesn't seem to be taken affect  since the problem is observed to happen even if I set the the holdability to CLOSE_CURSORS_AT_COMMIT before creating the statement. (maybe another bug)2) setting the holdability to close_cursor_at_commit on the PS when creating it  doesn't seem to be affecting the outcome  this  not sure its even honored (maybe another bug)Test case is below:import java.sql.Connection;import java.sql.PreparedStatement;import java.sql.ResultSet;import java.sql.SQLException;import java.sql.Statement;import javax.sql.XAConnection;import javax.transaction.xa.XAException;import javax.transaction.xa.XAResource;import javax.transaction.xa.Xid;import com.ibm.db2.jcc.DB2Xid;class CursorHoldProblem{ public static PreparedStatement pstmt = null; public static void main (String args [])throws Exception { org.apache.derby.jdbc.ClientXADataSource ds = new  org.apache.derby.jdbc.ClientXADataSource(); System.out.println('getting connection'); ds.setDatabaseName('sample'); //ds.setTraceFile('trace.out'); ds.setConnectionAttributes('create=true'); conn1 = ds.getConnection();System.out.println(conn1.getMetaData().getDatabaseProductVersion()); PreparedStatement ps1 = null; try { System.out.println('creating table'); ps1 = conn1.prepareStatement('CREATE TABLE TAB1(COL1 INT NOT NULL)'); ps1.executeUpdate(); System.out.println('done creating table'); conn1.commit (); } catch (SQLException x) { System.out.println ('table already exists'); conn1.commit(); } XAConnection pc1 = ds.getXAConnection(); XAResource xar1 = pc1.getXAResource(); Xid xid1 = createXid(11); Connection conn = pc1.getConnection(); System.out.println('get Holidability returning: ' + conn.getHoldability()); conn.setHoldability(ResultSet.CLOSE_CURSORS_AT_COMMIT);  //==&gt; setting this has no affect  doSelect(conn  23); xar1.start(xid1  XAResource.TMNOFLAGS); doSomeWork1(conn  66); doSelect(conn  50); xar1.end(xid1  XAResource.TMSUCCESS); int prp1 = xar1.prepare(xid1); System.out.println('prp1 is: ' + prp1); if (prp1 == XAResource.XA_OK) xar1.commit(xid1  false); } private static void doSomeWork1(Connection conn  int deptno) throws SQLException  { Statement stmt = conn.createStatement(); int cnt = stmt.executeUpdate('INSERT INTO tab1 VALUES (' + deptno + ')'); System.out.println('No of rows Affected ' + cnt); stmt.close(); stmt = null; } private static void doSelect(Connection conn  int deptno) throws SQLException  { if (pstmt == null) pstmt = conn.prepareStatement('select * from tab1'); ResultSet rset1 = pstmt.executeQuery(); while (rset1.next()) { System.out.println('==&gt;: ' + rset1.getString(1)); break; }  } static Xid createXid(int bids) throws XAException { byte[] gid = new byte[1]; gid[0] = (byte) 9; byte[] bid = new byte[1]; bid[0] = (byte) bids; byte[] gtrid = new byte[64]; byte[] bqual = new byte[64]; System.arraycopy(gid  0  gtrid  0  1); System.arraycopy(bid  0  bqual  0  1); Xid xid = new DB2Xid(0x1234  gtrid  bqual); return xid; } },0,0
tests derbynet/csPrepStmt and prepStmt use mechanisms that are not portable over encodings,With zOS  with the classic 32 bit jvm  the tests derbynet/csPrepStmt and prepStmt.java fail because the insert with setAsciiStream of a byte array obtained from a new String.getBytes() (and/or the retrieval of that inserted value) is not ok. No error is returned  but the select shows no value.This is the section in the test csPrepStmt:----------------- ps.setString(10  'column11string'); byte[] c11ba = new String('column11vcstring').getBytes(); int len = c11ba.length; ps.setAsciiStream(11  new ByteArrayInputStream(c11ba)  len);and the value is retrieved using an ResultSet.getString(#)--------------------------28 del&lt; got row: 1 2 3 4 5.0 6.0 7.0 88.88 99.100 column11string  column11vcstring column12lvcstring 0123456789abcdef10111213202020 0123456789abcdef10111213 0123456789abcdef10111213 xxxxxxFILTERED-TIMESTAMPxxxxx-04-12 11:44:30.028a28&gt; got row: 1 2 3 4 5.0 6.0 7.0 88.88 99.100 column11string  column12lvcstring 0123456789abcdef10111213202020 0123456789abcdef10111213 0123456789abcdef10111213 xxxxxxFILTERED-TIMESTAMPxxxxx-04-12 11:44:30.0--------------------(i.e. the string 'column11vcstring' is not in the database)This needs to be replaced by a encoding-neutral (eg. fixed encoding) mechanism and the tests derbynet/prepStmt.java and csPrepStmt.java need to be checked for other non-portable code.,0,0
unit/daemonService.unit fails intermittently: 'ran out of time','Signature':                 Diff file unit/unit/daemonService.diff             Start: daemonService jdk1.5.0_04 unit:unit 2006-02-14 20:46:42 ***2 del&lt; &#8211; Unit Test T_DaemonService finished2 add&gt; ran out of time&gt; Shutting down due to unit test failure.&gt; Exit due to time bombTest Failed. End: daemonService jdk1.5.0_04 unit:unit 2006-02-14 21:47:13 ***    http://www.multinet.no/~solberg/public/Apache/Derby/Limited/testSummary-377800.html &#91;SunOS-5.10 i86pc-i386&#93;,0,0
store/access.sql fails - incorrect index?,ij&gt; &#8211; should only be 1 distinct row in this table since space used by the &#8211; index should be the same before and after select count(distinct a) from spaceused;'Signature':                 Diff file derbyall/encryptionAll/storemats/storemats/access.diff             Start: access jdk1.5.0_03 storemats:storemats 2006-02-15 05:04:54 ***2756 del&lt; 1 2756a2756&gt; 2 Test Failed. End: access jdk1.5.0_03 storemats:storemats 2006-02-15 05:06:04 ***    http://www.multinet.no/~solberg/public/Apache/Derby/Limited/testSummary-377800.html &#91;SunOS-5.10 sun4u-sparc&#93;,0,0
tests jdbcapi/SURTest.junit and jdbcapi/SURQueryMixTest.junit run twice in derbynetclientmats,The tests SURTest.junit and SURQueryMixTest.junit both appear in derbynetclientmats.runall as well as in jdbcapi.runall. So it unnecessarily runs twice  because jdbcapi is already included in the suites in derbynetclientmats.properties. It should be removed from derbynetclientmats.runall.,0,0
Optimizer can return incorrect 'best cost' estimates with nested subqueries  which leads to generation of sub-optimal plans.,When optimizing a query that has nested subqueries in it  it's possible that the optimizer for the subqueries will return cost estimates that are lower than what they were actually calculated to be. The result is that the outer query can pick an access plan that is sub-optimal.Filing this jira issue based on the thread '&#91;OPTIMIZER&#93; OptimizerImpl 'best plans' for subqueries?' from derby-dev. Description that follows is pasted from that email:http://article.gmane.org/gmane.comp.apache.db.derby.devel/14836Following example of what I saw when tracing through the code demonstrates the problem.select x1.j  x2.b from (select distinct i j from t1) x1  (select distinct a b from t3) x2where x1.i = x2.a;During optimization of this query we will create three instancesof OptimizerImpl: OI_0: For 'select x1.j  x2.b from x1  x2 where x1.i = x2.a' OI_1: For 'select distinct i j from t1' OI_2: For 'select distinct a b from t3'Query ran against a clean codeline when T1 had 1 row and T3 had 50 000. &#8211; Top-level call is made to the optimize() method of the outermost SelectNode  which creates OI_0. &#8211; OI_0: picks join order {X1  X2} and calls X1.optimizeIt() &#8211; X1: creates OI_1 and makes calls to optimize it. &#8211; OI_1: picks join order {T1} and calls T1.optimizeIt() &#8211; T1: returns a cost of 20. &#8211; OI_1: saves 20 as new best cost and tells T1 to save it. &#8211; X1: calls OI_1.getOptimizedCost()  which returns 20. X1 then returns 20 to OI_0. &#8211; OI_0: calls X2.optimizeIt() &#8211; X2: creates OI_2 and makes calls to optimize it. &#8211; OI_2: picks join order {T3} and calls T3.optimizeIt() &#8211; T3: returns a cost of 64700. &#8211; OI_2: saves 64700 as new best cost and tells T3 to save it. &#8211; X2: calls OI_2.getOptimizedCost()  which returns 64700. X2 then returns 64700 to OI_0. &#8211; OI_0: saves 20 + 64700 = 64720 as new best cost and tells X1 to save 20 and X2 to save 64700. &#8211; OI_0: picks join order {X2  X1} and calls X2.optimizeIt() &#8211; X2: fetches OI_2 and makes calls to optimize it. &#8211; OI_2: picks join order {T3} and calls T3.optimizeIt() &#8211; T3: returns a cost of 10783. &#8211; OI_2: saves 10783 as new best cost and tells T3 to save it. &#8211; X2: calls OI_2.getOptimizedCost()  which returns 10783. X2 then returns 10783 to OI_0. &#8211; OI_0: calls X1.optimizeIt() &#8211; X1: fetches OI_1 and makes calls to optimize it. &#8211; OI_1: picks join order {T1} and calls T1.optimizeIt() &#8211; T1: returns a cost of 1 MILLION!. &#8211; OI_1: rejects new cost (1 mil &gt; 20) and does nothing. &#8211; X1: calls OI_1.getOptimizedCost()  which returns 20. X1 then returns 20 to OI_0...this seems WRONG! &#8211; OI_0: saves 10783 + 20 = 10803 as new best cost and tells X2 to save 10783 and X1 to save 20.So in the end  the outer-most OptimizerImpl chooses join order {X2  X1} because it thought the cost of this join order was only 10783  which is better than 64720. However  the actual cost of the join order was really estimated at 1 million--so the outer OptimizerImpl chose (and will generate) a plan that  according to the estimates  was (hugely) sub-optimal.,0,1
Embedded ResultSet.getStatement() does not return the Statement object that created it  for a connection returned from EmbeddedXADataSource,May also be the case for connections obtained from EmbeddedConnectionPoolDataSource.ResultSet.getStatement() is returning the undetlying 'physical' java.sql.Statement object  not the brokered object.Bug as applications can then get at the underlying 'physical' connection and thus continue to use a connection that may have been assigned to someone else. Causes FAIL messages in thenew jdbcapi/XATest  real checks should be added in checkDataSource to ensure all the possibleconnection objects are checked.,0,0
new test lang/ShutdownDatabase.java fails with j2ME,The new test lang/ShutdownDatabase.java fails with: java.lang.NoClassDefFoundError: java.sql.DriverThe test needs to be rewritten to take advantage of the TestUtil methods for getting a connection from a datasource or using a driver  similar to e.g. lang/closed.java.The stack trace is like so:java.lang.NoClassDefFoundError: java.sql.Driver at java.lang.ClassLoader.defineClassImpl(Native Method) at java.lang.ClassLoader.defineClass(ClassLoader.java:212) at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:109) at java.net.URLClassLoader.findClassImpl(URLClassLoader.java:1026) at java.net.URLClassLoader$4.run(URLClassLoader.java:557) at java.security.AccessController.doPrivileged(AccessController.java:167) at java.net.URLClassLoader.findClass(URLClassLoader.java:555) at com.ibm.oti.vm.URLSystemClassLoader.findClass(URLSystemClassLoader.java:32) at java.lang.ClassLoader.loadClass(ClassLoader.java:602) at com.ibm.oti.vm.URLSystemClassLoader.loadClass(URLSystemClassLoader.java:65) at java.lang.ClassLoader.loadClass(ClassLoader.java:561) at java.lang.Class.forNameImpl(Native Method) at java.lang.Class.forName(Class.java:116) at org.apache.derby.impl.tools.ij.util.loadDriver(util.java:837) at org.apache.derby.impl.tools.ij.util.startJBMS(util.java:492) at org.apache.derby.impl.tools.ij.util.startJBMS(util.java:573) at org.apache.derby.impl.tools.ij.util.startJBMS(util.java:554) at org.apache.derbyTesting.functionTests.tests.lang.ShutdownDatabase.openConnectionToNewDatabase(ShutdownDatabase.java:530) at org.apache.derbyTesting.functionTests.tests.lang.ShutdownDatabase.testOnlyTransactionWasCommited(ShutdownDatabase.java:151) at org.apache.derbyTesting.functionTests.tests.lang.ShutdownDatabase.testShutDownWithCommitedTransaction(ShutdownDatabase.java:116) at org.apache.derbyTesting.functionTests.tests.lang.ShutdownDatabase.main(ShutdownDatabase.java:86),0,0
forupdate.sql   holdCursorIJ.sql ..etc are failing when run with 10.1 client againest trunk,derbynetclientmats/derbynetmats/derbynetmats.fail:lang/forupdate.sql derbynetclientmats/derbynetmats/derbynetmats.fail:lang/holdCursorIJ.sql derbynetclientmats/derbynetmats/derbynetmats.fail:store/holdCursorJDBC30.sql derbynetclientmats/derbynetmats/derbynetmats.fail:jdbcapi/LOBTest.java derbynetclientmats/derbynetmats/derbynetmats.fail:jdbcapi/blobclob4BLOB.java derbynetclientmats/derbynetmats/derbynetmats.fail:jdbcapi/parameterMapping.java derbynetclientmats/derbynetmats/derbynetmats.fail:jdbcapi/setTransactionIsolation.java derbynetclientmats/derbynetmats/derbynetmats.fail:jdbcapi/metadataJdbc20.java derbynetclientmats/derbynetmats/derbynetmats.fail:jdbcapi/connectionJdbc20.javaSample diff :     Start: forupdate jdk1.5.0_02 DerbyNetClient derbynetmats:derbynetmats 2006-02-23 07:30:19 ***23 del&lt; ERROR 42X01: Syntax error: Encountered '&lt;EOF&gt;' at line 1  column 23.23a23&gt; ERROR 42X01: Syntax error: Encountered '&lt;EOF&gt;' at line 3  column 23.59 del&lt; ERROR (no SQLState): Invalid cursor name 'C1' in the Update/Delete statement.59a59&gt; ERROR 42X30: Cursor 'SQL_CURLH000C1' not found. Verify that autocommit is OFF.132 del&lt; ERROR (no SQLState): Invalid cursor name 'C4' in the Update/Delete statement.132a132&gt; ERROR 42X30: Cursor 'SQL_CURLH000C1' not found. Verify that autocommit is OFF.135 del&lt; ERROR (no SQLState): Invalid cursor name 'C4' in the Update/Delete statement.135a135&gt; ERROR 42X30: Cursor 'SQL_CURLH000C1' not found. Verify that autocommit is OFF.180 del&lt; ERROR 42X01: Syntax error: Encountered '.' at line 1  column 34.180a180&gt; ERROR 42X01: Syntax error: Encountered '.' at line 3  column 34.Test Failed. End: forupdate jdk1.5.0_02 DerbyNetClient derbynetmats:derbynetmats 2006,0,0
JVMInfo is duplicated in derbyclient.jar,The JVMInfo class is included twice in derbyclient.jar  asorg.apache.derby.iapi.services.info.JVMInfo andorg.apache.derby.shared.common.info.JVMInfo. The only one of themactually used by the client code is the one found inorg.apache.derby.shared.common.info.org.apache.derby.iapi.services.info.JVMInfo is also included inderby.jar  so one could run into problems if the classpath containsderbyclient.jar and derby.jar with different versions.,0,0
test jdbcapi/checkDataSource30 and savepointJdbc30_XA fail with remote server with security exceptions,The .tmp from the jdbcapi/checkDataSource30.java is:----------------------START XA HOLDABILITY TESTERROR (no SQLState): java.security.PrivilegedActionException : Error opening socket to server localhost on port 1527 with message : Connection refusedCompleted checkDataSource30----------------------The .tmp from the jdbcapi/savepointJdbc30_XA.java is:-------------------------------------FAIL &#8211; unexpected exceptionSQLSTATE(null):java.sql.SQLException: java.security.PrivilegedActionException : Error opening socket to server localhost on port 1527 with message : Connection refused at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:285) at org.apache.derby.client.ClientPooledConnection.&lt;init&gt;(ClientPooledConnection.java:104) at org.apache.derby.client.ClientXAConnection.&lt;init&gt;(ClientXAConnection.java:47) at org.apache.derby.jdbc.ClientXADataSource.getXAConnection(ClientXADataSource.java:50) at org.apache.derby.jdbc.ClientXADataSource.getXAConnection(ClientXADataSource.java:43) at org.apache.derbyTesting.functionTests.tests.jdbcapi.savepointJdbc30_XA.main(savepointJdbc30_XA.java:58)Caused by: org.apache.derby.client.am.DisconnectException: java.security.PrivilegedActionException : Error opening socket to server localhost on port 1527 with message : Connection refused at org.apache.derby.client.net.NetAgent.&lt;init&gt;(NetAgent.java:113) at org.apache.derby.client.net.NetConnection.newAgent_(NetConnection.java:928) at org.apache.derby.client.am.Connection.initConnection(Connection.java:174) at org.apache.derby.client.am.Connection.&lt;init&gt;(Connection.java:144) at org.apache.derby.client.net.NetConnection.&lt;init&gt;(NetConnection.java:207) at org.apache.derby.client.net.NetXAConnection.&lt;init&gt;(NetXAConnection.java:39) at org.apache.derby.client.ClientPooledConnection.&lt;init&gt;(ClientPooledConnection.java:94) ... 4 more-----------------------------,0,0
Security.AccessControlException in client under SecurityManager when trying to connect using EUSRIDPWD security mechanism,When using EUSRIDPWD security mechanism  the JCE provider is added and since this is not in a privileged block  an accesscontrol exception is raised when trying to connect using EUSRIDPWD security mechanism  when client is run under security manager.Enabled test (T5) in testSecMec.java &gt; T5: jdbc:derby://xxxFILTERED_HOSTNAMExxx:xxxFILTEREDPORTxxx/wombat;user=neelima;password=lee;securityMechanism=9 - EXCEPTION Unexpected throwable caught java.security.AccessControlException: access denied (java.security.SecurityPermission insertProvider.SunJCE),1,0
Change the internal implemetation of SYSCS_INPLACE_COMPRESS_TABLE to share existing alter table,Change the internal implemetation of SYSCS_INPLACE_COMPRESS_TABLE to share existing alter tablecode. One suggested approach is to use the same mechanism as SYSCS_COMPRESS_TABLE. Suchan implementation would involve:o change the parser for alter table to accecpt some internal only syntax for SYSCS_INPLACE_COMPRESS_TABLEo change the alter table constant action to get the required information for inplace compresso move most of the inplace compress driving code to a routine in alter table execution  following the same coding pattern as existing alter table compress.I believe doing this will have multiple benefits:1) shares existing alter table code  so things like error checking  security management  ... is all done by one piece of code2) by sharing the code I believe the following outstanding JIRA issues will be addressed: DERBY-719  DERBY-720 -3) future changes addressing ddl like grant/revoke will automatically work.,0,0
Delete cascade causes NULL values inserted into table when after delete Trigger fires,When an after delete trigger which inserts into a table is created on a table that has a foreign key that references a primary key and uses the on delete cascade constraint  nulls are inserted into the table by the trigger.The SQL below shows that the cascade delete works correctly:ij&gt; CREATE TABLE TABLE1 ( X INT PRIMARY KEY );0 rows inserted/updated/deletedij&gt; CREATE TABLE TABLE1_DELETIONS ( X INT );0 rows inserted/updated/deletedij&gt; CREATE TABLE TABLE2 ( Y INT  CONSTRAINT Y_AND_X FOREIGN KEY(Y) REFERENCES TABLE1(X) ON DELETE CASCADE);0 rows inserted/updated/deletedij&gt; CREATE TABLE TABLE2_DELETIONS ( Y INT );0 rows inserted/updated/deletedij&gt; INSERT INTO TABLE1 VALUES (0);1 row inserted/updated/deletedij&gt; INSERT INTO TABLE2 VALUES (0);1 row inserted/updated/deletedij&gt; INSERT INTO TABLE1 VALUES (1);1 row inserted/updated/deletedij&gt; INSERT INTO TABLE2 VALUES (1);1 row inserted/updated/deletedij&gt; select * from table1;X-----------012 rows selectedij&gt; select * from table2;Y-----------012 rows selectedij&gt; DELETE FROM TABLE1;2 rows inserted/updated/deletedij&gt; select * from table1;X-----------0 rows selectedij&gt; select * from table2;Y-----------0 rows selectedNow insert the rows again  create the triggers  delete the rows from the primary key table  verify the cascade delete worked and observe the values in the tables used by the triggers:ij&gt; INSERT INTO TABLE1 VALUES(0);1 row inserted/updated/deletedij&gt; INSERT INTO TABLE2 VALUES(0);1 row inserted/updated/deletedij&gt; INSERT INTO TABLE1 VALUES(1);1 row inserted/updated/deletedij&gt; INSERT INTO TABLE2 VALUES(1);1 row inserted/updated/deletedij&gt; CREATE TRIGGER TRIGGER1 AFTER DELETE ON TABLE1 REFERENCING OLD AS OLD_ROW FOR EACH ROW MODE DB2SQL INSERT INTO TABLE1_DELETIONS VALUES (OLD_ROW.X);0 rows inserted/updated/deletedij&gt; CREATE TRIGGER TRIGGER2 AFTER DELETE ON TABLE2 REFERENCING OLD AS OLD_ROW FOR EACH ROW MODE DB2SQL INSERT INTO TABLE2_DELETIONS VALUES (OLD_ROW.Y);0 rows inserted/updated/deletedij&gt; DELETE FROM TABLE1;2 rows inserted/updated/deletedij&gt; select * from TABLE1;X-----------0 rows selectedij&gt; select * from TABLE2;Y-----------0 rows selectedij&gt; SELECT * FROM TABLE1_DELETIONS;X-----------012 rows selectedij&gt; SELECT * FROM TABLE2_DELETIONS;Y-----------NULLNULLThe TABLE2_DELETIONS table contains NULLs instead of the correct values which should be 0 and 1.,0,0
Misleading/wrong error message while dropping a view,while dropping a view which does not really exist on a database   the error message thrown by ij says ERROR X0X05: Table 'VIEW222' does not exist. It looks like we should make the error message to say that 'Table/View' does not exist  instead of 'table'.Look at other messages that are shared for both Table and View.,0,0
Derby fails inserting a join into a table with a generated column,I've been having a problem inserting the result of a join into a table with a generated column. If I rephrase the join clause into a where clause  the problem goes away. And it only seems to happen if the target table has a generated column. Unfortunately  the join that I want to do in my application is pretty complex so I don't think I can rephrase it. But here's a very simplified example of what I'm talking about:ij version 10.1ij&gt; connect 'jdbc:derby:test;create=true';ij&gt; create table source (source_id int not null primary key);0 rows inserted/updated/deletedij&gt; insert into source values (0);insert into source values (1);insert into source values (2);insert into source values (3);insert into source values (4);insert into source values (5);insert into source values (6);insert into source values (7);insert into source values (8);insert into source values (9);1 row inserted/updated/deletedij&gt; 1 row inserted/updated/deletedij&gt; 1 row inserted/updated/deletedij&gt; 1 row inserted/updated/deletedij&gt; 1 row inserted/updated/deletedij&gt; 1 row inserted/updated/deletedij&gt; 1 row inserted/updated/deletedij&gt; 1 row inserted/updated/deletedij&gt; 1 row inserted/updated/deletedij&gt; 1 row inserted/updated/deletedij&gt; create table dest (dest_id int not null primary key generated always as identity source_id_1 int not null source_id_2 int not null);0 rows inserted/updated/deletedij&gt; select s1.source_id  s2.source_idfrom source as s1join source as s2on 1 = 1;SOURCE_ID |SOURCE_ID-----------------------0 |00 |10 |20 |30 |40 |50 |60 |70 |80 |91 |01 |11 |21 |31 |41 |51 |61 |71 |81 |92 |02 |12 |22 |32 |42 |52 |62 |72 |82 |93 |03 |13 |23 |33 |43 |53 |63 |73 |83 |94 |04 |14 |24 |34 |44 |54 |64 |74 |84 |95 |05 |15 |25 |35 |45 |55 |65 |75 |85 |96 |06 |16 |26 |36 |46 |56 |66 |76 |86 |97 |07 |17 |27 |37 |47 |57 |67 |77 |87 |98 |08 |18 |28 |38 |48 |58 |68 |78 |88 |99 |09 |19 |29 |39 |49 |59 |69 |79 |89 |9100 rows selectedij&gt; insert into dest (source_id_1  source_id_2)select s1.source_id  s2.source_idfrom source as s1join source as s2on 1 = 1;ERROR XJ001: Java exception: ': java.lang.NullPointerException'.ij&gt;derby.log:----------------------------------------------------------------2006-03-07 20:01:12.152 GMT:Booting Derby version The Apache Software Foundation - Apache Derby - 10.1.2.1 - (330608): instance c013800d-0109-d64c-5067-000000172958on database directory D:/Documents and Settings&#42;**/My Documents/testDatabase Class Loader started - derby.database.classpath=''2006-03-07 20:01:52.671 GMT Thread&#91;main 5 main&#93; (XID = 124)  (SESSIONID = 0)  (DATABASE = test)  (DRDAID = null)  Cleanup action starting2006-03-07 20:01:52.671 GMT Thread&#91;main 5 main&#93; (XID = 124)  (SESSIONID = 0)  (DATABASE = test)  (DRDAID = null)  Failed Statement is: insert into dest (source_id_1  source_id_2)select s1.source_id  s2.source_idfrom source as s1join source as s2on 1 = 1java.lang.NullPointerExceptionat org.apache.derby.impl.sql.compile.ResultColumnList.remapColumnReferencesToExpressions(Unknown Source)at org.apache.derby.impl.sql.compile.JoinNode.flatten(Unknown Source)at org.apache.derby.impl.sql.compile.FromList.flattenFromTables(Unknown Source)at org.apache.derby.impl.sql.compile.SelectNode.preprocess(Unknown Source)at org.apache.derby.impl.sql.compile.SingleChildResultSetNode.preprocess(Unknown Source)at org.apache.derby.impl.sql.compile.DMLStatementNode.optimize(Unknown Source)at org.apache.derby.impl.sql.compile.DMLModStatementNode.optimize(Unknown Source)at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source)at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source)at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source)at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source)at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source)at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source)at org.apache.derby.impl.tools.ij.Main.go(Unknown Source)at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source)at org.apache.derby.impl.tools.ij.Main14.main(Unknown Source)at org.apache.derby.tools.ij.main(Unknown Source)Cleanup action completed2006-03-07 20:43:03.759 GMT:Shutting down instance c013800d-0109-d64c-5067-000000172958----------------------------------------------------------------,0,0
Test harness does not pass jvm flags properly if there are more than 1 property in jvm flags,To run Derby tests with EMMA for Code coverage  there is a need to set up emma flag -Djvmflags=-Demma.verbosity.level=silent. This is basically to enable EMMA not to print out any messages to avoid having any diffs. This all works fine when running Derby tests with EMMA for jdk142  jdk15  jdk131 etc because there is no other jvm flag that is passed while calling RunSuite Command. Now  while running tests with j2me/cdc/foundation  another value needs to be passed as jvmflag which is-Djvmflags='Dij.dataSource=org.apache.derby.jdbc.EmbeddedSimpleDataSource'.I tried to combine values for both jvm flags as following  but it did not work properly:1. -Djvmflags='-Demma.verbosity.level=silent -Dij.dataSource=org.apache.derby.jdbc.EmbeddedSimpleDataSource'During this run  the value that was further passed while running one test was Djvmflags=''-Demma.verbosity.level=silent'.As you can notice it took jvm flag as '-Demma.verbosity.level=silent 2. -Djvmflags='-Demma.verbosity.level=silent -Dij.dataSource=org.apache.derby.jdbc.EmbeddedSimpleDataSource'During this run  the value that was further passed while running one test was Djvmflags=''-Demma.verbosity.level=silent'.As you can notice it took jvm flag as '-Demma.verbosity.level=silent From the above it looks like test harness needs to be changed so that it can parse multiple values for jvm flags properly.,0,0
ResultSet.getHoldabilty will return incorrect value when the ResultSet is obtained from a procedure call,EmbedResultSet40.getHoldability returns the holdability of the statement returned by ResultSet.getStatement().When a ResultSet is created by a procedure call  its holdability may not match the holdability of the Statement that called the procedure  which is probably what ResultSet.getStatement() should return.This may not be exposed as a bug yet  but I think this method should be directly obtaining the holdability of the ResultSet using the Activation.getResultSetHoldability() method  rather than through a Statement. Seems a safer approach.,0,0
For existing databases JDBC metadata queries do not get updated properly  between maintenance versions.,The JDBC DatabaseMetaData queries are stored as stored prepared statements in the database. If a bug is fixed for any of the metadata calls it can require that these queries be changed. Currently existing databases will not get updated properly if a bug is fixed. Ideally the metadata queries should match the derby version that is running. That way we avoid situations where the query is not compatible with the Derby version running.To confirm I :1) created a database with 10.1.1.02) Made a metadata change in my 10.1.2.4 client.3) Connected to the 10.1.1.0 database with 10.1.2.4 and saw that there was no change to the stored prepared statements in SYS.SYSSTATEMENTSI also confirmed that a database created with 10.1.2.4 does not get changed when reverting to 10.1.1.0.Below this line is some history and reference that might be helful to someone fixing this issue:------------------------------------------------------------------------------------------------------------------------------------------------In discussing DERBY-970  the subject of the metadata stored prepared statements came up.The general questions are: 1) Why do we use stored prepared statements for metadata queries?  2) What issues might there be related to upgrade/downgrade with the metadata stored prepared statements? 3) How do we address potential upgrade/downgrade issues?GENERAL HISTORY: Cloudscape 5.x had stored prepared statements  a way to store precompiledstatements in the database. This is no longer exposed externally. Metadata stored prepared statements were a performance optimization thatpredated the statement cache. In the past  this performance optimization has been of particular importanceto gui database browsers that execute all the metadata methods on connection to the database. This would still probably be an issue with embedded even with the statement cache. All stored prepared statements get recompiled on the first connection to thedatabase if the version changes.UPGRADE HISTORY In Cloudscape 5.1  the metadata stored prepared statements have traditionallybeen a source of trouble for even minor version changes as queries change or they refer to methods/stored procedures that may or may not exist in the target version and cannot recompile or execute.  The solution to the problem in Cloudscape v5.1.60 was to automaticallyalways call DD_Version.dropJDBCMetadataSPSes() whenever the version changed up or down in upgradeIfNeeded(). The workaround before this change to do this automatically was to call thismethod manually: CALL Factory.getDatabaseOfConnection(). dropAllJDBCMetaDataSPSes()HOW DERBY WORKS TODAY: In Derby we now only call dropJDBCMetadataSPSes() on fullUpgrade and it hasbeen this way since contribution. I think the problems of upgrade/downgrade for metadata stored preparedstatements may exist in Derby. I don't know a workaround to drop the metadata stored prepared statements ifwe need to deliver a bug fix or how the ugprade/downgrade is handled currently. I seem to recall some special handling in Derby for soft upgrade for optimizer directives  but don't know the details.RECENT DISCUSSIONS:In discussing DERBY-970  the subject of the metadata stored prepared statements came up.The general questions are: 1) Why do we use stored prepared statements for metadata queries?  2) What issues might there be related to upgrade/downgrade with the metadata stored prepared statements? 3) How do we address potential upgrade/downgrade issues?MY QUESTIONSAnyone know when/why the dropJDBCMetadataSPSes() on all version changes was removed between Cloudcape 5.1.60 and contribution? How do we deliver bug fixes for metadata queries or handle changes in the metadata queries in Derby?,0,0
transaction logs files requried for recovery are getting deleted when backup and checkpointas are running in parallel.,----------------------------------------------------------------2006-03-14 19:45:40.573 GMT: Booting Derby version The Apache Software Foundation - Apache Derby - 10.2.0.0 alpha - (1): instance c013800d-0109-fa4a-bf58-0000001078a0on database directory E:/,0,0
client gives SqlException for test callable.java and parameterMapping.java on zOS,On zOS  the tests callable.java and parameterMapping.java failed with networkserver and the derby client. The failure did not occur with the db2jcc.jar. The stack trace was as follows:org.apache.derby.client.am.SqlException: ^V^V^30^30^D^F^53^F^31^38^31 : at org.apache.derby.client.am.Statement.completeExecute(Statement.java:1139) at org.apache.derby.client.net.NetStatementReply.parseEXCSQLSTTreply(NetStatementReply.java:296) at org.apache.derby.client.net.NetStatementReply.readExecuteCall(NetStatementReply.java:97) at org.apache.derby.client.net.StatementReply.readExecuteCall(StatementReply.java:74) at org.apache.derby.client.net.NetStatement.readExecuteCall_(NetStatement.java:174) at org.apache.derby.client.am.Statement.readExecuteCall(Statement.java:1105) at org.apache.derby.client.am.PreparedStatement.flowExecute(PreparedStatement.java:1426) at org.apache.derby.client.am.CallableStatement.executeX(CallableStatement.java:124) at org.apache.derby.client.am.CallableStatement.execute(CallableStatement.java:114) at org.apache.derbyTesting.functionTests.tests.derbynet.callable.main(Unknown Source)In callable.java  it's this part of the test that caused the failure:------------------------------------------ System.out.println('return value is: ' + cs.getInt(1)); cs.close(); // stmt.execute('DROP FUNCTION method4'); // different parameter types  also method overload stmt.execute('CREATE PROCEDURE method4P(' + 'IN P1 SMALLINT  IN P2 INT  IN P3 BIGINT  IN P4 REAL  ' + 'IN P5 DOUBLE  IN P6 DECIMAL(6 3)  IN P7 DATE  IN P8 TIME  IN P9 TIMESTAMP  IN P10 VARCHAR(20) FOR BIT DATA  ' + 'OUT O1 SMALLINT  OUT O2 INT  OUT O3 BIGINT  OUT O4 REAL  ' + 'OUT O5 DOUBLE  OUT O6 DECIMAL(6 3)  OUT O7 DATE  OUT O8 TIME  OUT O9 TIMESTAMP  OUT O10 VARCHAR(20) FOR BIT DATA' + ') ' + 'EXTERNAL NAME 'org.apache.derbyTesting.functionTests.tests.derbynet.callable.method4'' + ' NO SQL LANGUAGE JAVA PARAMETER STYLE JAVA'); cs = conn.prepareCall('call method4P(?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?)'); cs.setShort(1  (short) 3); cs.setInt(2  4); cs.setLong(3  5); cs.setFloat(4  (float) 6.0); cs.setDouble(5  7.0); cs.setBigDecimal(6  new BigDecimal('88.88')); cs.setDate(7  Date.valueOf('2002-05-12')); cs.setTime(8  Time.valueOf('10:05:02')); cs.setTimestamp(9  Timestamp.valueOf('2002-05-12 10:05:02.000000000')); byte[] ba = new byte&#91;2&#93;; ba&#91;0&#93; = 1; ba&#91;1&#93; = 2; cs.setBytes(10  ba); int n = 10; cs.registerOutParameter (n+1  java.sql.Types.SMALLINT); cs.registerOutParameter (n+2  java.sql.Types.INTEGER); cs.registerOutParameter (n+3  java.sql.Types.BIGINT); cs.registerOutParameter (n+4  java.sql.Types.REAL); cs.registerOutParameter (n+5  java.sql.Types.DOUBLE); cs.registerOutParameter (n+6  java.sql.Types.DECIMAL); cs.registerOutParameter (n+7  java.sql.Types.DATE); cs.registerOutParameter (n+8  java.sql.Types.TIME); cs.registerOutParameter (n+9  java.sql.Types.TIMESTAMP); cs.registerOutParameter (n+10  java.sql.Types.VARBINARY); cs.execute();------------------I found in derby.log a reference to error 22007  (.S.181) - i.e. syntax error on parameter 3 of SYSIBM.SQLCAMESSAGE (yes  this is from last year):-------------------------------2005-09-10 01:56:17.009 GMT Thread&#91;DRDAConnThread_2 5 main&#93; (XID = 110)  (SESSIONID = 0)  (DATABASE = wombat)  (DRDAID = NF000001.G7C1-4327676640608975420{2}) End compiling prepared statement: call method4P(?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?  ?) :End prepared statement2005-09-10 01:56:17.311 GMT Thread&#91;DRDAConnThread_2 5 main&#93; (XID = 110)  (SESSIONID = 0)  (DATABASE = wombat)  (DRDAID = NF000001.G7C1-4327676640608975420{2}) Begin compiling prepared statement: call SYSIBM.SQLCAMESSAGE(? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?) :End prepared statement2005-09-10 01:56:17.429 GMT Thread&#91;DRDAConnThread_2 5 main&#93; (XID = 110)  (SESSIONID = 0)  (DATABASE = wombat)  (DRDAID = NF000001.G7C1-4327676640608975420{2}) End compiling prepared statement: call SYSIBM.SQLCAMESSAGE(? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?) :End prepared statement2005-09-10 01:56:17.831 GMT Thread&#91;DRDAConnThread_2 5 main&#93; (XID = 110)  (SESSIONID = 0)  (DATABASE = wombat)  (DRDAID = NF000001.G7C1-4327676640608975420{2}) Executing prepared statement: call SYSIBM.SQLCAMESSAGE(? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?) :End prepared statement with 16 parameters begin parameter #1: -1 :end parameter begin parameter #2: 11 :end parameter begin parameter #3: ^V^V^30^30^D^F^53^F^31^38^31 :end parameter begin parameter #4: ^43^53^53^31^30^30^31^31 :end parameter begin parameter #5: 0 :end parameter begin parameter #6: 0 :end parameter begin parameter #7: 0 :end parameter begin parameter #8: 0 :end parameter begin parameter #9: 0 :end parameter begin parameter #10: 0 :end parameter beginparameter #11: ^20^20^20^20^20^20^20^20^20^20^20 :end parameter begin parameter#12: ^V^V^30^30^D :end parameter begin parameter #13: null :end parameter beginparameter #14: en :end parameter begin parameter #15: null :end parameter begin----------------------,0,0
jdbc4/TestDbMetaData.java fails because of changes in SQLException text,jdbc4/TestDbMetaData.java fails with the following diff:                 Diff file jdbc4/DerbyNetClient/jdbc4/TestDbMetaData.diff             Start: TestDbMetaData jdk1.6.0-beta2 DerbyNetClient jdbc4:jdbc4 2006-03-16 20:13:06 ***49 del&lt; SQLSTATE(0A000):java.sql.SQLException: 0A000.S : &#91;0&#93; getClientInfoProperties ()50 del&lt; Caused by: org.apache.derby.client.am.SqlException: 0A000.S : &#91;0&#93; getClientInfoProperties ()50a49 50&gt; SQLSTATE(0A000):java.sql.SQLException: Feature not implemented: getClientInfoProperties ().&gt; Caused by: org.apache.derby.client.am.SqlException: Feature not implemented: getClientInfoProperties ().58 del&lt; SQLSTATE(0A000):java.sql.SQLException: 0A000.S : &#91;0&#93; getSchemas (String  String)59 del&lt; Caused by: org.apache.derby.client.am.SqlException: 0A000.S : &#91;0&#93; getSchemas (String  String)59a58 59&gt; SQLSTATE(0A000):java.sql.SQLException: Feature not implemented: getSchemas (String  String).&gt; Caused by: org.apache.derby.client.am.SqlException: Feature not implemented: getSchemas (String  String).Test Failed. End: TestDbMetaData jdk1.6.0-beta2 DerbyNetClient jdbc4:jdbc4 2006-03-16 20:13:16 ***    (http://www.multinet.no/~solberg/public/Apache/DerbyJDK16/testlog/JDK16Jvm1.6SunOS-5.10_i86pc-i386/386413-jdbc4_diff.txt)The failure is caused by changes in MessageUtil which have modified the exception message.,0,0
compatibility tests fail with security related errors.,A * few* cases:                 Begin: serverVM-1.3_serverTrunk_clientVM-1.3_clientTrunkException in thread 'main' java.lang.NoClassDefFoundError: javax/crypto/IllegalBlockSizeException             End: serverVM-1.3_serverTrunk_clientVM-1.3_clientTrunk                     Begin: serverVM-1.3_server10.0.2.1_clientVM-1.3_clientDB2JCCcom.ibm.db2.jcc.c.SqlException: java.net.ConnectException : Error opening socket to server localhost on port 1527 with message : Connection refused at org.apache.derbyTesting.functionTests.tests.junitTests.compatibility.CompatibilitySuite.main(CompatibilitySuite.java:129)Exception in thread 'main' java.lang.Exception: Error lookup up server info: java.net.ConnectException : Error opening socket to server localhost on port 1527 with message : Connection refused             End: serverVM-1.3_server10.0.2.1_clientVM-1.3_clientDB2JCC                     Begin: serverVM-1.3_server10.0.2.1_clientVM-1.3_clientDerby10.1.1.0org.apache.derby.client.am.DisconnectException: java.security.PrivilegedActionException : Error opening socket to server localhost on port 1527 with message : nullException in thread 'main' java.lang.Exception: Error lookup up server info: java.security.PrivilegedActionException : Error opening socket to server localhost on port 1527 with message : null             End: serverVM-1.3_server10.0.2.1_clientVM-1.3_clientDerby10.1.1.0                     Begin: serverVM-1.3_server10.0.2.1_clientVM-1.3_clientDerby10.1.2.0org.apache.derby.client.am.DisconnectException: java.security.PrivilegedActionException : Error opening socket to server localhost on port 1527 with message : nullException in thread 'main' java.lang.Exception: Error lookup up server info: java.security.PrivilegedActionException : Error opening socket to server localhost on port 1527 with message : null             End: serverVM-1.3_server10.0.2.1_clientVM-1.3_clientDerby10.1.2.0                     Begin: serverVM-1.3_server10.0.2.1_clientVM-1.3_clientTrunkException in thread 'main' java.lang.NoClassDefFoundError: javax/crypto/IllegalBlockSizeException             End: serverVM-1.3_server10.0.2.1_clientVM-1.3_clientTrunk                     Begin: serverVM-1.3_server10.0.2.1_clientVM-1.4_clientDB2JCCcom.ibm.db2.jcc.c.SqlException: java.net.ConnectException : Error opening socket to server localhost on port 1527 with message : Connection refused at org.apache.derbyTesting.functionTests.tests.junitTests.compatibility.CompatibilitySuite.main(CompatibilitySuite.java:129)Exception in thread 'main' java.lang.Exception: Error lookup up server info: java.net.ConnectException : Error opening socket to server localhost on port 1527 with message : Connection refused             End: serverVM-1.3_server10.0.2.1_clientVM-1.4_clientDB2JCC    See e.g.http://www.multinet.no/~solberg/public/Apache/Derby/testlog/SunOS-5.10_i86pc-i386/386871-compatibility_diff.txt inhttp://www.multinet.no/~solberg/public/Apache/Derby/Limited/testSummary-386871.htmlhttp://www.multinet.no/~solberg/public/Apache/DerbyJDK16/testlog/JDK16Jvm1.6SunOS-5.10_i86pc-i386/387016-compatibility_diff.txt inhttp://www.multinet.no/~solberg/public/Apache/DerbyJDK16/Limited/testSummary-current.htmlFirst occurence in svn 386687 &#91;2006-03-17 19:45:55 CET&#93;Changes in http://www.multinet.no/~solberg/public/Apache/Derby/UpdateInfo/386687.txt,1,0
Truncation Error with Concat,Consider the tableCREATE TABLE CUSTOMER_TABLE ( ID VARCHAR(255) PRIMARY KEY NOT NULL  NAMEZ VARCHAR(255)   COUNTRY VARCHAR(255) )Sql:PreparedStatement ps = conn.prepateStatement ('SELECT * FROM CUSTOMER_TABLE WHERE NAMEZ = VARCHAR ( CAST (? AS VARCHAR(32672) ) || CAST (? AS VARCHAR(32672) ) )' );ps.setString(1  'Alan E. ');ps.setString(2  'Frechette');ps.executeQuery()Error:'A truncation error was encountered trying to shrink VARCHAR 'Alan E. Frechette' to length 15.'getErrorCode()-1getSQLState()22001 Please note that-The query executes ok against DB2 database-The query executes ok if the total length of both the parameters bound is less than 15. That is as follows //Total length of parameters bound = len('Alan E. Fre') = 11 ps.setString(1  'Alan E. '); ps.setString(2  'Fre');-The error occurs both with embedded and network mode of derby-Omitting the casts as follows also gives the same error query: SELECT * FROM CUSTOMER_TABLE WHERE NAMEZ = VARCHAR( 'Frechette' || ? ) error: SQLState: 22001 'A truncation error was encountered trying to shrink VARCHAR 'FrechetteAlan E. ' to length 15'-Using parameter markers for both the variables without cast like as follows results in error query: SELECT * FROM CUSTOMER_TABLE WHERE NAMEZ = ? || ? error: SQLState: 42X35 'It is not allowed for both operands of '||' to be ? parameters.'-Using parameter markers for only one variables without cast like as follows results in error query: SELECT * FROM CUSTOMER_TABLE WHERE NAMEZ = 'Frechette' || ? error:SQLState: 42818 'Comparisons between 'VARCHAR' and 'LONG VARCHAR' are not supported.' -It works to cast to VARCHAR(2000)  but not VARCHAR(2001) or larger. Regardless of length  if it fails  the magic number is always 15.,0,0
With client PooledConnection.getConnection() does not reset holdability and isolation state properly,I found this issue when working on DERBY-1044 which was filed for the isolation not getting reset for XAConnections.I found that this was a generic issue for PooledConnections and also that holdability was also wrong.The fix proposed for DERBY-1044 should also fix this issue. That bug has the repro for the isolation state issueFor holdability  this code passes for embedded but fails for client: // Test holdability  ConnectionPoolDataSource ds = TestUtil.getConnectionPoolDataSource(p); pc1 = ds.getPooledConnection(); testPooledConnHoldability('PooledConnection'  pc1); pc1.close(); ** @param string @param pc1 */ private static void testPooledConnHoldability(String string  PooledConnection pc1)  throws SQLException Unknown macro: { System.out.println(&quot;n**Test holdability state**&quot;); Connection conn = pc1.getConnection(); conn.setHoldability(ResultSet.CLOSE_CURSORS_AT_COMMIT); // reset the connection and see if the holdability gets reset conn = pc1.getConnection(); int holdability = conn.getHoldability(); if (holdability != ResultSet.HOLD_CURSORS_OVER_COMMIT) { System.out.println('FAIL: Holdability not reset on get Connection'); } else { System.out.println('PASS: Holdability reset on getConnection'); } conn.close(); },0,1
Failures in sysinfo and sysinfo_withproperties induced by classpath wiring,If you wire your classpath together out of the compiled classtree and the checked-in jars  you get the following error in the sysinfo and sysinfo_withproperties tests. You don't see this error if you run against the built Derby jar files:15d14&lt; Unable to analyze class path: access denied (java.util.PropertyPermission java.class.path read)43d41&lt; Unable to analyze class path: access denied (java.util.PropertyPermission java.class.path read)72d69&lt; Unable to analyze class path: access denied (java.util.PropertyPermission java.class.path read)Test Failed.,0,0
derbynet/testSecMec.java fails with Sun JDK 1.3,derbynet/testSecMec.java fails with Sun JDK 1.3:&lt; SECMEC_EUSRIDPWD:EXCEPTION testSecurityMechanism() Security exception encountered  see next exception for details.&gt; SECMEC_EUSRIDPWD:EXCEPTION testSecurityMechanism() Security exception encountered  see next exception for details. Caused by exception class java.security.NoSuchProviderException: null... (and so forth)Does not fail with 1.4  so probably just a master update.,0,0
Separate XAResource from EmbedXAConnection,jdbc4.0 introduces two new methods in javax.sql.PooledConnection. Due to this a new implementation of PooledConnection and XAConnection for jdbc4.0 is required. According to current hierarchy XAConnection extends from PooledConnection. Going by similar hierarchy for new classes PooledConnection40 will extend from PooledConnection and XAConnection40 will be extending from PooledConnection40. This structure forces to replicate all the methods of XAConnection to be present in XAConnection40 too. In the current implementation EmbedXAConnection itself is XAResource. This will cause to replicate all the XAResource methods to be present in XAConnection40. Separating these two implementation will save replication of lots of methods.See the comments on jira issue 1137 for some more discussion about this issue.,0,0
allow the encrypting of an existing unencrypted db and allow the re-encrypting of an existing encrypted db,encrypted database to be re-encrypted with a new password.Here are some ideas for an initial implementation.The easiest way to do this is to make sure we have exclusive access to thedata and that no log is required in the new copy of the db. I want to avoidthe log as it also is encrypted. Here is my VERY high level plan:1) Force exclusive access by putting all the work in the low level store  offline boot method. We will do redo recovery as usual  but at the end there will be an entry point to do the copy/encrypt operation.copy/encrypt process:0) The request to encrypt/re-encrypt the db will be handled with a new set of url flags passed into store at boot time. The new flags will provide the same inputs as the current encrypt flags. So at high level the request will be 'connect db old_encrypt_url_flags; new_encrypt_url_flags'. TODO - provide exact new flag syntax.1) Open a transaction do all logged work to do the encryption. All logging will be done with existing encryption.2) Copy and encrypt every db file in the database. The target files will be in the data directory. There will be a new suffix to track the new files  similar to the current process used for handling drop table in a transaction consistent manner without logging the entire table to the log. Entire encrypted destination file is guaranteed synced to disk before transaction commits. I don't think this part needs to be logged. Files will be read from the cache using existing mechanism and written directly into new encrypted files (new encrypted data does not end up in the cache).3) Switch encrypted files for old files. Do this under a new log operation so the process can be correctly rolled back if the encrypt db operation transaction fails. Rollback will do file at a time switches  no reading of encrypted data is necessary.4) log a 'change encryption of db' log record  but do not update system.properties with the change.5) commit transaction.6) update system.properties and sync changes.7) TODO - need someway to handle crash between steps 5 and 6.6) checkpoint all data  at this point guaranteed that there is no outstanding transaction  so after checkpoint is done there is no need for the log.ISSUES:o there probably should be something that catches a request to encrypt to whatever db was already encrypted with.,1,0
Helper methods in BaseJDBCTestCase for creating data sources,BaseJDBCTestCase should be extended with methods that create DataSource  ConnectionPoolDataSource and XADataSource objects.,0,0
PreparedStatement.executeUpdate throws a XJ05C exception in a global transaction if the statement is HOLD_CURSORS_OVER_COMMIT,SQLSTATE(XJ05C): Cannot set holdability ResultSet.HOLD_CURSORS_OVER_COMMIT for a global transaction.Exception is thrown in client  in embedded the statement executes successfully.Since HOLD_CURSORS_OVER_COMMIT only applies to ResultSets and executeUpdate states it only succeeds if the statementdoes not generate ResultSets  then this combination should succeed.Probably related to the fact that in embedded an execute() call on the same PreparedStatement will thrown a XJ05C exceptionWorkaround is to prepare the statement explicitly with CLOSE_CURSORS_AT_COMMIT.,0,0
NullPointerException in network server with LDAP authentication,While trying to fix DERBY-1000 I tried to set up Derby's network server to use LDAP authentication  but I ran into something that looks like a bug  but could just as well be my own configuration mistake. I would appreciate any help in figuring this out. =)The problem is a NullPointerException in the Network Server when it tries to initialize the LDAP authentication service. The attached derby.log shows the exception and its stacktrace. The attached derby.properties is what I put in the derby home directory.I'm seeing this problem in the trunk as well as my own build of the 10.1 branch and the 10.1.2.1 release build available from the Derby web site. ( http://db.apache.org/derby/releases/release-10.1.2.1.cgi )The problem is cause by the setInitDirContextEnv method in JNDIAuthenticationSchemeBase receiving a null dbProps argument  which it obviously doesn't expect. Adding a check for a null dbProps argument and returning immediately after creating the initDirContextEnv object fixes the NullPointerException and makes LDAP authentication work for me. This is a reasonable enough robustness fix and shouldn't have any negative impact  but if the source of the problem is that JNDIAuthenticationSchemeBase should never receive that null pointer in the first place  more patching is needed. I'm not sure about this  so I'm leaving it up to the experts to decide this. =),1,0
defragment of inplace compress pass for described dataset is not freeing up empty pages.,For the following script defragment pass is not freeing up the free pages:drop table t1;create table t1 (i integer primary key  j integer  c char(200));insert into t1 values (1  1  'a');insert into t1 (select t1.i + 1  t1.j + 1  t1.c from t1);insert into t1 (select t1.i + 2  t1.j + 2  t1.c from t1);insert into t1 (select t1.i + 4  t1.j + 4  t1.c from t1);insert into t1 (select t1.i + 8  t1.j + 8  t1.c from t1);insert into t1 (select t1.i + 16  t1.j + 16  t1.c from t1);insert into t1 (select t1.i + 32  t1.j + 32  t1.c from t1);insert into t1 (select t1.i + 64  t1.j + 64  t1.c from t1);insert into t1 (select t1.i + 128  t1.j + 128  t1.c from t1);insert into t1 (select t1.i + 256  t1.j + 256  t1.c from t1);insert into t1 (select t1.i + 512  t1.j + 512  t1.c from t1);delete from t1 where i &lt; 512;select cast(conglomeratename as char(12)) as tabname  isindex  cast(numallocatedpages as int) as alloc  numfreepages  cast(numunfilledpages as int) as unfilled  pagesize  estimspacesavingfrom new org.apache.derby.diag.SpaceTable('T1') t order by conglomeratename;CALL SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE('APP'  'T1'  1  1  1);select cast(conglomeratename as char(12)) as tabname  isindex  cast(numallocatedpages as int) as alloc  numfreepages  cast(numunfilledpages as int) as unfilled  pagesize  estimspacesavingfrom new org.apache.derby.diag.SpaceTable('T1') t order by conglomeratename;select cast(conglomeratename as char(12)) as tabname  isindex  cast(numallocatedpages as int) as alloc  numfreepages  cast(numunfilledpages as int) as unfilled  pagesize  estimspacesavingfrom new org.apache.derby.diag.SpaceTable('T1') t order by conglomeratename;Here is example output from a run on the trunk:ij&gt; drop table t1;0 rows inserted/updated/deletedij&gt; create table t1 (i integer primary key  j integer  c char(200));0 rows inserted/updated/deletedij&gt; insert into t1 values (1  1  'a');1 row inserted/updated/deletedij&gt; insert into t1 (select t1.i + 1  t1.j + 1  t1.c from t1);1 row inserted/updated/deletedij&gt; insert into t1 (select t1.i + 2  t1.j + 2  t1.c from t1);2 rows inserted/updated/deletedij&gt; insert into t1 (select t1.i + 4  t1.j + 4  t1.c from t1);4 rows inserted/updated/deletedij&gt; insert into t1 (select t1.i + 8  t1.j + 8  t1.c from t1);8 rows inserted/updated/deletedij&gt; insert into t1 (select t1.i + 16  t1.j + 16  t1.c from t1);16 rows inserted/updated/deletedij&gt; insert into t1 (select t1.i + 32  t1.j + 32  t1.c from t1);32 rows inserted/updated/deletedij&gt; insert into t1 (select t1.i + 64  t1.j + 64  t1.c from t1);64 rows inserted/updated/deletedij&gt; insert into t1 (select t1.i + 128  t1.j + 128  t1.c from t1);128 rows inserted/updated/deletedij&gt; insert into t1 (select t1.i + 256  t1.j + 256  t1.c from t1);256 rows inserted/updated/deletedij&gt; insert into t1 (select t1.i + 512  t1.j + 512  t1.c from t1);512 rows inserted/updated/deletedij&gt; delete from t1 where i &lt; 512;511 rows inserted/updated/deletedij&gt; select cast(conglomeratename as char(12)) as tabname  isindex  cast(numallocatedpages as int) as alloc  numfreepages  cast(numunfilledpages as int) as unfilled  pagesize  estimspacesavingfrom new org.apache.derby.diag.SpaceTable('T1') t order by conglomeratename;TABNAME |ISIND&amp;|ALLOC |NUMFREEPAGES |UNFILLED |PAGESIZE |ESTIMSPACESAVING-------------------------------------------------------------------------------------------------SQL060406034|1 |7 |0 |0 |4096 |0T1 |0 |60 |9 |0 |4096 |368642 rows selectedij&gt; CALL SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE('APP'  'T1'  1  1  1);0 rows inserted/updated/deletedij&gt; select cast(conglomeratename as char(12)) as tabname  isindex  cast(numallocatedpages as int) as alloc  numfreepages  cast(numunfilledpages as int) as unfilled  pagesize  estimspacesavingfrom new org.apache.derby.diag.SpaceTable('T1') t order by conglomeratename;TABNAME |ISIND&amp;|ALLOC |NUMFREEPAGES |UNFILLED |PAGESIZE |ESTIMSPACESAVING-------------------------------------------------------------------------------------------------SQL060406034|1 |7 |0 |1 |4096 |0T1 |0 |69 |0 |0 |4096 |02 rows selectedij&gt;,0,1
Network Server reports wrong product name when logging connections to derby.log,The Derby Network Server is symptomatic of dissociative identity disorder when derby.drda.logConnections=true. At startup and shutdown the network server correctly recognizes itself as 'Apache Derby'. When logging connections  however  it thinks it is 'Cloudscape'. See the following derby.log for an example:======= derby.log START ================Apache Derby Network Server - 10.2.0.0 alpha started and ready to accept connections on port 1527 at 2006-04-07 09:09:22.766 GMTConnection number: 1.----------------------------------------------------------------2006-04-07 09:10:02.054 GMT: Booting Derby version The Apache Software Foundation - Apache Derby - 10.2.0.0 alpha - (392214): instance c013800d-010a-739c-e4bf-0000001109c8on database directory /export/home/tmp/test/testDBDatabase Class Loader started - derby.database.classpath=''2006-04-07 09:10:03.287 GMT Thread&#91;DRDAConnThread_3 5 main&#93; (DATABASE = testDB)  (DRDAID = {1})  Cloudscape Network Server connected to database testDB;create=true======= derby.log END ================To reproduce  do the following:1. Start the network server with the property derby.drda.logConnections set to true. An example follows:bash-3.00 $ java -Dderby.drda.logConnections=true -jar ${DERBY_CURRENT}/derbyrun.jar NetworkServerControl startApache Derby Network Server - 10.2.0.0 alpha started and ready to accept connections on port 1527 at 2006-04-07 09:09:22.766 GMTConnection number: 1.2. Use the client driver to connect to the server. An example follows (using IJ):bash-3.00 $ java -jar ${DERBY_CURRENT}/derbyrun.jar ijij version 10.2ij&gt; connect 'jdbc:derby://localhost:1527/testDB;create=true';ij&gt; exit;,0,0
Derby Server and Administration Guide - Servlet interface - Running page,In this page is written:1) You can use the running page to stop the server and turn logging and tracing on or off  boot or shut down databases.I installed the servlet in Tomcat  and I can't see any option to boot or shut down databases in this page.2) Test the connection. (If you choose this option  the Test connection page is displayed.)I also can't see any option to test connection in this page.3) Stop the application server.The option is 'Press the button to stop the Network server'  and not the application server.I'm using:--------- Derby Information --------JRE - JDBC: J2SE 1.4.2 - JDBC 3.0&#91;/org/apache/derby/info/DBMS.properties&#93; 10.1.2.1 - (330608)&#91;/org/apache/derby/info/net.properties&#93; 10.1.2.1 - (330608)I don't know if my servlet's version is old  but those things are written in the manual for the version I'm using.I'm sending a diff file to adjust this page to what appears in the servlet I'm using.,0,0
ij should have a --help option to print command line syntax,ij should accept a --help option to print command line syntax for reference and friendliness.,0,0
jdbcapi/checkDataSource.java and jdbcapi/checkDataSource30.java hang intermittently with client,The tests checkDataSource.java and checkDataSource30.java hang intermittently especially with jdk 1.5.Attached is the test run output and traces when the server is started separately.1) Enable checkDataSource30.java by taking it out of functionTests/suites/DerbyNetClient.exclude.2) Run the test with client.java -Dij.exceptionTrace=true -Dkeepfiles=true -Dframework=DerbyNetClient org.apache.derbyTesting.functionTests.harness.RunTest jdbcapi/checkDataSource30.javaAttachements: testfiles_after_hang.zip - Test directory. traces_on_hang.txt - Server side traces obtained by starting the server separately before running the test.I wish I had time to work on this right now as I would really like to see this valuable test in the suite  but hopefully someone else will pick it up.,0,1
Remove the huge log files (TesterN.out) left from running 'stress/stress.multi',See http://www.nabble.com/derbyall-test-uses-%7E11Gb-disk-space-when-run%21-t530808.html#a1433024 :'I discovered that when I now run the derbyall test it uses ~11Gb disk space!I find 4 x 10 '..../multi/Tester*.out' files which each is ~270Mb! (=&gt;10.8Gb.)'I will upload a patch which makes ij/mtTester.java able to tell if the mtTester detected errors  which then is used by harness/MultiTest.java to decide if the .out file can be deleted.mtTester is currently only used by harness/MultiTest.java.,0,1
LIKE does not match empty strings when used with a prepared statement,LIKE should give true for two 0-length strings. See SQL 2003 Ch. 8.5General Rules 3)c)i)The query SELECT * FROM t WHERE v like ''appears to give me all rows where v is an emptystring  as expected.But a prepared statementSELECT * FROM t WHERE v like ?  with setString(1  '')always returns an empty result set. See attached repro for the full example.,0,0
Move isPoolable() and setPoolable() from PreparedStatement to Statement,An upcoming release of jdk1.6 will move isPoolable() and setPoolable() from PreparedStatement to Statement. We should conform.,0,0
Verify that applications can't manipulate the transaction state while inside a distributed transaction.,The next rev of the JDBC4 spec will clarify that applications may not call the following methods while inside distributed transactions: setAutoCommit( true )  commit()  rollback()  and setSavepoint(). We should verify that we conform.,0,0
Assert failure in BasePage.shiftUp() when running store/onlineBackupTest4.sql,I saw this error when I ran derbyall.                 Diff file derbyall/storeall/storemore/onlineBackupTest4.diff             Start: onlineBackupTest4 jdk1.5.0_04 storeall:storemore 2006-04-24 11:51:50 ***68 del&lt; ij(CONNECTION1)&gt; select * from ctest;69 del&lt; ID |NAME 70 del&lt; --------------------------------------------------------------------------------------------------------------------------------------------71 del&lt; 1 |derby backup/compress test &amp;72 del&lt; 2 |derby backup/compress test &amp;73 del&lt; 300 |derby backup/compress test &amp;74 del&lt; 509 |derby backup/compress test &amp;75 del&lt; 510 |derby backup/compress test &amp;76 del&lt; 511 |derby backup/compress test &amp;77 del&lt; 512 |derby backup/compress test &amp;78 del&lt; ij(CONNECTION1)&gt; insert into ctest values(2000  'restore was successfil') ;79 del&lt; 1 row inserted/updated/deleted80 del&lt; ij(CONNECTION1)&gt; 80 add&gt; org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED shiftUp failed  low must be between 0 and recordCount. low = 140  recordCount = 2&gt; ERROR XJ040: Failed to start database 'wombat'  see the next exception for details.&gt; ERROR XJ001: Java exception: 'ASSERT FAILED shiftUp failed  low must be between 0 and recordCount. low = 140  recordCount = 2: org.apache.derby.shared.common.sanity.AssertFailure'.&gt; ij&gt; select * from ctest;&gt; IJ ERROR: Unable to establish connection&gt; ij&gt; insert into ctest values(2000  'restore was successfil') ;&gt; IJ ERROR: Unable to establish connection&gt; ij&gt; Test Failed. End: onlineBackupTest4 jdk1.5.0_04 storeall:storemore 2006-04-24 11:51:56 ***    The test usually succeeds  but I managed to reproduce the failure by running this loop in the shell:touch onlineBackupTest4.passwhile [ -f onlineBackupTest4.pass ]; do rm onlineBackupTest4.pass java org.apache.derbyTesting.functionTests.harness.RunTest store/onlineBackupTest4.sqldone,0,0
Old clients with new server return wrong database metadata values for some methods,With an old client (10.1.1  10.1.2) accessing a new (10.2) server some metadata calls will return the wrong value for both the JCC andthe Derby clients: deletesAreDetected(TYPE_SCROLL_INSENSITIVE) -&gt; true updatedAreDetected(TYPE_SCROLL_INSENSITIVE) -&gt; true ownDeletesAreVisible(TYPE_SCROLL_INSENSITIVE) -&gt; true ownUpdatesAreVisible(TYPE_SCROLL_INSENSITIVE) -&gt; trueThis happens because these values were changed for the 10.2 withthe addition of updatable scrollable insensitive result sets (DERBY-775) combined with a weakness in the way the client and the server cooperates to answer these metadata calls.Presently  when the client application invokes these methods  theresults will be returned by the server without regard to the identityof the client  i.e. the 2-tuple {JCC or Derby client  client version}.The values to be returned for the methods in question are based solelyon the values found in the file metadata_net.properties  which is partof the server.In general  some database metadata is dependent on the combination ofthe capabilities in the client and the server and the returned valuesshould reflect this  which in general implies negotiating (down) tovalues which are correct for the actual combination of client andserver.,0,0
XAConnection uses NetConnection as underlying physical connection for JDBC4/Java 1.6,When running under DerbyNetClient (using Derby network server) using Java 1.6  XAConnection.getConnection() returns a NetConnection instance instead of NetConnection40 instance for the underlying 'physical connection'. This causes AbstractMethod errors for calls in LogicalConnection40 (not yet committed). PooledConnection does the correct thing according to the test that revealed this problem.The XAConnection was obtained by using TestUtil.getXADataSource().getXAConnection(). The underlying connection object was then obtained with XAConnection.getConnection().A new ConnectionTest is on the way as part of DERBY-1180. It will be submitted/committed  but not enabled until this bug is fixed.,0,0
Implement new JDBC4 methods for creating empty LOBs in the embedded client,Implement Connection.createClob() and Connection.createBlob(). Right now these methods are implemented in the network client but not the embedded client.,0,0
Client: Attempted deleteRow or updateRow while on insert row gives wrong error message,This fragment from deleteRowX shows the problem:&gt; if (isOnInsertRow_) {&gt; throw new SqlException(agent_.logWriter_  &gt; new MessageId(SQLState.CURSOR_NOT_POSITIONED_ON_INSERT_ROW));&gt; }It should be the opposite: the problem is that the cursor is on theinsert row  not that it isn't.These is a similar error in updateRowX.The client master files for updatableResultSet show the problem  sothe masters are wrong  too.&gt; Negative Test 39.a - run updateRow on insertRow&gt; SQL State: XJ086&gt; Got expected exception: This method cannot be invoked while the cursor is not on the insert row or if the concurrency of this  ResultSet object is CONCUR_READ_ONLY.,0,0
Network Server does not shutdown the databases it has booted when started and shutdown from the command line,If network server is started and shutdown from the comand line t does not shutdown the database. This can is evidenced by the fact that the db.lck file remains after the following steps.java org.apache.derby.drda.NetworkServerControl start &amp;&lt;some database access&gt;java org.apache.derby.drda.NetworkServerControl shutdown There is much discussion about the correct behavior of NetworkServer in this regard related to embedded server scenarios in DERBY-51  but it seems clear in this case the databases should be shutdown.,0,0
Calling ResultSet.isLast() on a scrollable insensitive resultset  causes the entire ResultSet to be populated,The following is not a bug  however some applications do not always need to scroll to the last row  however they do want to check isLast(). Therefore it is unfortunate that isLast() is expensive. The general logic in ScrollInsensitiveResultSet is to populate rows by demand.The current logic in ScrollInsensitiveResultSet to return true or false on isLast()  is to move to the last row. If the last row is not the same row number as the current  then isLast() returns false. When moving to the last row  all rows will be populated into the BackingStoreHashtable of the ScrollInsensitiveResultSet.This logic may be rewritten to only move to the next row. If the next row exists  isLast() may return false.(note the logic is also optimized to use beforeFirst and afterLast flags),0,0
Resolve test failures with JCC2.8,The following tests fail when run with JCC 2.8 driver:derbynetmats/derbynetmats.fail:jdbcapi/resultset.javaderbynetmats/derbynetmats.fail:jdbcapi/LOBTest.javaderbynetmats/derbynetmats.fail:jdbcapi/parameterMapping.javaderbynetmats/derbynetmats.fail:derbynet/testSecMec.java (fails with Sun JDKs only),0,0
Tests jdbcapi/HoldabilityTest.junit  jdbcapi/UpdateXXXTest.junit jdbcapi/SURTest.junit fail on wctme5.7_foundation,05/05/2006 regression test run of derbyall shows the following test failure with wctme5.7_foundation  derbyall/derbyall.fail:jdbcapi/HoldabilityTest.junitderbyall/derbyall.fail:jdbcapi/UpdateXXXTest.junitderbyall/derbyall.fail:jdbcapi/SURTest.junitDiff is a CNFE with ConnectionPoolDataSource.                 Diff file derbyall/jdbcapi/HoldabilityTest.diff             Start: HoldabilityTest jdkJ2ME Foundation Specification v1.0 derbyall:jdbcapi 2006-05-07 11:31:05 ***0 add&gt; Exception in thread 'main' java.lang.NoClassDefFoundError: javax.sql.ConnectionPoolDataSourceTest Failed. End: HoldabilityTest jdkJ2ME Foundation Specification v1.0 derbyall:jdbcapi 2006-05-07 11:31:06 ***    My guess is these tests need to excluded from running in this environment. Can someone please confirm. Thanks.,0,0
SUR: Use DRDA's extended diagnostic to send ROW_UPDATED and ROW_DELETED warnings.,Detectability of own changes is implemented in the client using warnings cf the write-up for DERBY-775. When a row has been deleted and/or updated  a warning will be sent to the client to indicate that fact. Presently  only one warning can be sent each time a data row is sent from to the client  that means that some warnings may be lost. Using extended diagnostic allows us to send several warnings for each data row.I propose to use extended diagnostics to send ROW_UPDATED and ROW_DELETED warnings when necessary. This may later be extended for other warnings  but I do not plan to do it as a part of the work in this issue.,0,0
Differences between client and embedded when invoking stored procedures using Statement.executeUpdate(),When invoking a stored procedure using Statement.executeUpdate()  theclient driver and the embedded driver behave differently.If the stored procedure does not return any result set  the embeddeddriver returns 0  whereas the client returns -1.If the stored procedure returns one or more result sets  the embeddeddriver returns -1  whereas the client fails with an exception.,0,0
Test lang/procedure.java fails with ibm1.5 jvm,lang/procedure.java fails on IBM1.5 jvm on linux machine. I spoke to Manjula who filed DERBY-1108 that this is related to that issue and is a JVM bug. The JVM team has been notified. Please note: I have marked this as a Regression Test Failure although this test has not passed with IBM 1.5 JVM atleast in our nightly regression test runs  so it is not a regression of the product. diff:                 Diff file derbyall/derbylang/procedure.diff             Start: procedure jdk1.5.0 derbyall:derbylang 2006-05-10 22:17:16 ***1018 del&lt; testImplicitClose(): PASSED1018 add&gt; testImplicitClose(): FAILED (no exception thrown)Test Failed. End: procedure jdk1.5.0 derbyall:derbylang 2006-05-10 22:17:31 ***    here is machine info.------------------ Java Information ------------------Java Version: 1.5.0Java Vendor: IBM CorporationJava home: /local1/cloudtst/dev/src/ibm15/jreJava classpath: /local1/cloudtst/dev/src/jars/insane/derby.jar:/local1/cloudtst/dev/src/jars/insane/derbytools.jar:/local1/cloudtst/dev/src/jars/insane/derbynet.jar:/local1/cloudtst/dev/src/jars/insane/derbyclient.jar:/local1/cloudtst/dev/src/jars/insane/derbyTesting.jar:/local1/cloudtst/dev/src/jcc/db2jcc.jar:/local1/cloudtst/dev/src/jcc/db2jcc_license_c.jar:/local1/cloudtst/dev/src/jars/insane/derbyTesting.jar:/local1/cloudtst/dev/src/tools/java/jakarta-oro-2.0.8.jar:/local1/cloudtst/dev/src/tools/java/junit.jar:/local1/cloudtst/dev/src/jars/insane/derbyLocale_de_DE.jar:/local1/cloudtst/dev/src/jars/insane/derbyLocale_es.jar:/local1/cloudtst/dev/src/jars/insane/derbyLocale_fr.jar:/local1/cloudtst/dev/src/jars/insane/derbyLocale_it.jar:/local1/cloudtst/dev/src/jars/insane/derbyLocale_ja_JP.jar:/local1/cloudtst/dev/src/jars/insane/derbyLocale_ko_KR.jar:/local1/cloudtst/dev/src/jars/insane/derbyLocale_pt_BR.jar:/local1/cloudtst/dev/src/jars/insane/derbyLocale_zh_CN.jar:/local1/cloudtst/dev/src/jars/insane/derbyLocale_zh_TW.jar:/local1/cloudtst/dev/src/jars/insane/derbyrun.jar:OS name: LinuxOS architecture: x86OS version: 2.6.5-7.252-bigsmpJava user name: cloudtstJava user home: /u/cloudtstJava user dir: /local1/cloudtst/dev/src/NightlyBuildResults.2006-05-10/ibm15_derbyalljava.specification.name: Java Platform API Specificationjava.specification.version: 1.5--------- Derby Information --------JRE - JDBC: J2SE 5.0 - JDBC 3.0&#91;/local1/cloudtst/dev/src/jars/insane/derby.jar&#93; 10.2.0.0 alpha - (405653)&#91;/local1/cloudtst/dev/src/jars/insane/derbytools.jar&#93; 10.2.0.0 alpha - (405653)&#91;/local1/cloudtst/dev/src/jars/insane/derbynet.jar&#93; 10.2.0.0 alpha - (405653)&#91;/local1/cloudtst/dev/src/jars/insane/derbyclient.jar&#93; 10.2.0.0 alpha - (405653)&#91;/local1/cloudtst/dev/src/jcc/db2jcc.jar&#93; 2.6 - (90)&#91;/local1/cloudtst/dev/src/jcc/db2jcc_license_c.jar&#93; 2.6 - (90)------------------------------------------------------,0,0
Missing resets of isOnInsertRow state in net client when navigating away via other than ResultSet#next,Please see the enclosed repro program.When attempting the deleteRow  it will fail with SQL state 24000 'nocurrent row'  since the first() call doesn't properly reset theIsOnInsertRow_ state. By inspection of ../am/ResultSet.java I foundthe other positioning calls beside next and moveToCurrentRow to sufferthe same problem.,0,0
Need to remove old copyright notice,An IBM copyright is in these files:derby/code/trunk/tools/jar/copyright.txtderby/code/branches/10.1/tools/jar/copyright.txtderby/code/branches/10.0/tools/jar/copyright.txt'svn log' shows it was part of the original code contribution &#8211; I think this was just missed in the copyright cleanup.There also exists reference to CPL injava/drda/org/apache/derby/impl/drda/EbcdicCcsidManager.java(22): http://www.ibm.com/developerworks/oss/CPLv1.0.htmMore references:java/engine/org/apache/derby/database/Database.java(47): * &lt;I&gt;IBM Corp. reserves the right to change  rename  orjava/engine/org/apache/derby/database/UserUtility.java(41): IBM Corp. reserves the right java/engine/org/apache/derby/iapi/db/ConnectionInfo.java(40): * &lt;i&gt;IBM Corp. reserves the right to change  rename or remove this class orjava/engine/org/apache/derby/iapi/db/ConsistencyChecker.java(70): * &lt;I&gt;IBM Corp. reserves the right to change  rename  orjava/engine/org/apache/derby/iapi/db/Factory.java(58): * &lt;I&gt;IBM Corp. reserves the right to change  rename  orjava/engine/org/apache/derby/iapi/db/PropertyInfo.java(54): * &lt;I&gt;IBM Corp. reserves the right to change  rename  orjava/engine/org/apache/derby/iapi/db/TriggerExecutionContext.java(32): * &lt;I&gt;IBM Corp. reserves the right to change  rename  orjava/engine/org/apache/derby/impl/sql/compile/AggregateDefinition.java(46): * &lt;I&gt; IBM Corp. reserves the right to change  rename  orjava/engine/org/apache/derby/vti/VTICosting.java(40): * &lt;I&gt;IBM Corp reserves the right to change  rename  orjava/engine/org/apache/derby/vti/VTIEnvironment.java(29): * &lt;I&gt;IBM Corp. reserves the right to change  rename  or,0,0
Isolation level of local connection does not get reset after exiting a global transaction if the isolation level was changed using SQL,If we update the isolation level using SQL instead of JDBC and then join/resume a global transaction  on ending the transaction  the isolation level of the local connection is not restored. The problem seems to be in EmbedXAResource. So it happens with both embedded and client driver. Client driver internally uses SQL to set the transaction isolation. So the problem is more likely to be hit with the client. I will attach a repro and a draft patch with more details.,0,0
Identity column can be  created with wrong and very large start with value with  'J2RE 1.5.0 IBM Windows 32 build pwi32dev-20060412 (SR2)' with JIT on,Using the following JRE with JIT on an identity column may be created with a wrong and very large START WITH value. When the problem occurs it affects not only the table being created  but also other tables that were created in previous transactions.For example attempting to create 1000 tables with identity columns the 126th table creation changes the start with value in sys.syscolumns to 41628850257395713 for ALL 125 tables. Attempts to insert into any of the tables cause'SQL Exception: A truncation error was encountered trying to shrink ... to length 12.' This program will create up to 1000 tables until the problem occursNote: The problem does not occur with -Xnojit (JIT OFF) The problem  when it occurs  changes not only the table beingcreated but all previous tables created. See output below. Every thing was fine up until mytable126 and then all the tables got changed to start with 41628850257395713  Problem occurs with autocommit on/off. The problem occurs after the create table but before thecommit. If the non-identity columns are removed the problem does notreproduce.import java.sql.DatabaseMetaData;import java.sql.ResultSet;import java.sql.SQLException;import java.sql.Statement;import java.sql.DriverManager;public class BadStartWith{ public static void main (String args [])throws Exception  { testBadStartWith(); } /** After some number of table creations with JIT turned on  the START WITH value for the table being created and all the ones already created gets mysteriously changed with pwi32dev-20060412 (SR2)  @throws Exception */ public static void testBadStartWith() throws Exception { Class.forName('org.apache.derby.jdbc.EmbeddedDriver').newInstance(); Connection conn = DriverManager.getConnection('jdbc:derby:wombat;create=true'); conn.setAutoCommit(false); Statement stmt = null; DatabaseMetaData md = conn.getMetaData() ; System.out.println(md.getDatabaseProductVersion()); System.out.println(md.getDatabaseProductName()); System.out.println(md.getDriverName()); dropAllAppTables(conn); System.out.println('Create tables until we get a wrong Start with value'); stmt = conn.createStatement(); // numBadStartWith will be changed if any columns get a bad start with value. int numBadStartWith = 0;  try { // create 1000 tables. Break out if we get a table that has a bad // start with value. for (int i = 0; (i &lt; 1000) &amp;&amp; (numBadStartWith == 0); i++) { String tableName = 'APP.MYTABLE' + i; String createTableSQL = 'CREATE TABLE ' + tableName + ' (ROLEID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 2  INCREMENT BY 1)  INSTANCEID INTEGER  STATUS INTEGER  LOGICAL_STATE INTEGER  LSTATE_TSTAMP TIMESTAMP  UPDT_TSTAMP TIMESTAMP  TSTAMP TIMESTAMP  CLALEVEL1_CLALEVEL2_CLALEVEL2ID VARCHAR(255)  CLALEVEL1_CLALEVEL2_CLALEVEL3_CLALEVEL3ID VARCHAR(255))'; stmt.executeUpdate(createTableSQL); System.out.println(createTableSQL); System.out.println('Check before commit'); numBadStartWith = checkBadStartWithCols(conn 2); conn.commit(); System.out.println('Check after commit'); numBadStartWith = checkBadStartWithCols(conn 2); if (numBadStartWith &gt; 0) break; } } catch (SQLException se) { se.printStackTrace(); } if (numBadStartWith == 0) System.out.println('PASS: All 1000 tables created without problems'); stmt.close(); conn.rollback(); conn.close(); }/** Check that all tables in App do not have a an autoincrementstart value greater tan maxautoincrementstart @param conn @param maxautoincrementstart Maximum expected autoincrementstart value @return number of columns with bad autoincrementstart value */ private static int checkBadStartWithCols(Connection conn  int maxautoincrementstart) throws Exception { Statement stmt = conn.createStatement(); ResultSet rs =stmt.executeQuery('select count(autoincrementstart) from sys.syscolumns c  sys.systables t  sys.sysschemas s WHERE t.schemaid = s.schemaid and s.schemaname = 'APP' and autoincrementstart &gt; ' + maxautoincrementstart); rs.next(); int numBadStartWith = rs.getInt(1); System.out.println(numBadStartWith + ' columns have bad START WITH VALUE'); rs.close(); if (numBadStartWith &gt; 0) { rs =stmt.executeQuery('select tablename  columnname  autoincrementstart from sys.syscolumns c  sys.systables t  sys.sysschemas s WHERE t.schemaid = s.schemaid and s.schemaname = 'APP' and autoincrementstart &gt; 2 ORDER BY tablename'); while (rs.next()) { System.out.println('Unexpected start value: ' + rs.getLong(3) + ' on column ' + rs.getString(1) + '(' + rs.getString(2) + ')'); } } return numBadStartWith; } /** Drop all tables in schema APP @param conn @throws SQLException */ private static void dropAllAppTables(Connection conn) throws SQLException { Statement stmt1 = conn.createStatement(); Statement stmt2 = conn.createStatement(); System.out.println('Drop all tables in APP schema'); ResultSet rs = stmt1.executeQuery('SELECT tablename from sys.systables t  sys.sysschemas s where t.schemaid = s.schemaid and s.schemaname = 'APP''); while (rs.next()) { String tableName = rs.getString(1); try { stmt2.executeUpdate('DROP TABLE ' + tableName); } catch (SQLException se) { System.out.println('Error dropping table:' + tableName); se.printStackTrace(); continue; } } }}Relevant output:$java BadStartWith10.2.0.0 alphaApache DerbyApache Derby Embedded JDBC DriverDrop all tables in APP schemaCreate tables until we get a wrong Start with valueCREATE TABLE APP.MYTABLE0 (ROLEID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 2  INCREMENT BY 1)  INSTANCEID INTEGER  STATUS INTEGER  LOGICAL_STATE INTEGER  LSTATE_TSTAMP TIMESTAMP  UPDT_TSTAMP TIMESTAMP  TSTAMP TIMESTAMP  CLALEVEL1_CLALEVEL2_CLALEVEL2ID VARCHAR(255)  CLALEVEL1_CLALEVEL2_CLALEVEL3_CLALEVEL3ID VARCHAR(255))Check before commit0 columns have bad START WITH VALUECheck after commit0 columns have bad START WITH VALUE&#91;snip MYTABLE1 ... MYTABLE124&#93;CREATE TABLE APP.MYTABLE125 (ROLEID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 2  INCREMENT BY 1)  INSTANCEID INTEGER  STATUS INTEGER  LOGICAL_STATE INTEGER  LSTATE_TSTAMP TIMESTAMP UPDT_TSTAMP TIMESTAMP  TSTAMP TIMESTAMP  CLALEVEL1_CLALEVEL2_CLALEVEL2ID VARCHAR(255)  CLALEVEL1_CLALEVEL2_CLALEVEL3_CLALEVEL3ID VARCHAR(255))Check before commit0 columns have bad START WITH VALUECheck after commit0 columns have bad START WITH VALUECREATE TABLE APP.MYTABLE126 (ROLEID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 2  INCREMENT BY 1)  INSTANCEID INTEGER  STATUS INTEGER  LOGICAL_STATE INTEGER  LSTATE_TSTAMP TIMESTAMP UPDT_TSTAMP TIMESTAMP  TSTAMP TIMESTAMP  CLALEVEL1_CLALEVEL2_CLALEVEL2ID VARCHAR(255)  CLALEVEL1_CLALEVEL2_CLALEVEL3_CLALEVEL3ID VARCHAR(255))Check before commit127 columns have bad START WITH VALUEUnexpected start value: 41628850257395713 on column MYTABLE0(ROLEID)Unexpected start value: 41628850257395713 on column MYTABLE1(ROLEID)Unexpected start value: 41628850257395713 on column MYTABLE10(ROLEID)Unexpected start value: 41628850257395713 on column MYTABLE100(ROLEID)Unexpected start value: 41628850257395713 on column MYTABLE101(ROLEID)Unexpected start value: 41628850257395713 on column MYTABLE102(ROLEID)Unexpected start value: 41628850257395713 on column MYTABLE103(ROLEID)Unexpected start value: 41628850257395713 on column MYTABLE104(ROLEID)Unexpected start value: 41628850257395713 on column MYTABLE105(ROLEID)Unexpected start value: 41628850257395713 on column MYTABLE106(ROLEID)Unexpected start value: 41628850257395713 on column MYTABLE107(ROLEID)Unexpected start value: 41628850257395713 on column MYTABLE108(ROLEID)Unexpected start value: 41628850257395713 on column MYTABLE109(ROLEID)Unexpected start value: 41628850257395713 on column MYTABLE11(ROLEID)Unexpected start value: 41628850257395713 on column MYTABLE110(ROLEID)&#91;snip the rest of the tables have unexpected START WITH value too&#93;,0,0
messages_pt_BR.properties file  should not translate Network Server 'start' and 'shutdown' commands,In the current file messages_pt_BR.properties the commands 'start' and 'shutdown' are translated  but once they are commands they should not be translated. Also the word host wasn't translated  and it appears in many lines. Others modifications were done for compatibility with the translated manuals.,0,0
lang/forupdate.sql fails with derbyclient in the 10.1 branch,Derby 10.1 branch - 10.1.2.5 - (409283)     Start: forupdate jdk1.5.0_02 DerbyNetClient derbynetmats:derbynetmats 2006-05-24 21:24:26 ***333 del&lt; SQL_CURLH000C3333a333&gt; SQL_CURLH000C1393 del&lt; SQL_CURLH000C3393a393&gt; SQL_CURLH000C1Test Failed. End: forupdate jdk1.5.0_02 DerbyNetClient derbynetmats:derbynetmats 2006-05-24 21:24:41 ***,0,0
ClientDriver ResultSetMetaData.isAutoIncrement(column) always returns false,With ClientDriver  resultSet.getMetaData().isAutoIncrement(column) always returns false. EmbeddedDriver correctly returns the true value (true or false)The following code demonstrates the problem:===================================================================================import java.sql.Connection;import java.sql.DriverManager;import java.sql.ResultSet;import java.sql.ResultSetMetaData;import java.sql.SQLException;import java.sql.Statement;import org.apache.derby.jdbc.ClientDriver;import org.apache.derby.jdbc.EmbeddedDriver;public class TestAutoIncrement { private static final String URL_EMBEDDED = 'jdbc:derby:EmbeddedTestBase;'; private static final String URL_CLIENT = 'jdbc:derby://localhost:1527/ClientTestBase;'; public TestAutoIncrement() { super(); } public static void main(String[] args) throws SQLException { System.out.println(new ClientDriver().getClass().getName() + ' registered'); System.out.println(new EmbeddedDriver().getClass().getName() + ' registered'); new TestAutoIncrement().test(); } private void test() throws SQLException { if (test(URL_EMBEDDED) != test(URL_CLIENT)) { System.out.println('Embedded and client driver behave differently for isAutoIncrement().'); } else { System.out.println('Embedded and client driver behave the same for isAutoIncrement().'); } } private boolean test(String url) throws SQLException { boolean ai = false; Connection connection = DriverManager.getConnection(url + 'create=true;'); Statement statement = connection.createStatement(); statement .execute('CREATE TABLE TEST_TABEL (' + 'ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1  INCREMENT BY 1) ' + 'VALUE INTEGER NOT NULL  PRIMARY KEY (ID))'); statement.execute('INSERT INTO TEST_TABEL (VALUE) VALUES(1)'); ResultSet resultSet = statement .executeQuery('SELECT * FROM TEST_TABEL'); ResultSetMetaData meta = resultSet.getMetaData(); ai = meta.isAutoIncrement(1); System.out.println('For ' + url + ' ' + meta.getColumnName(1) + ' isAutoIncrement: ' + ai); connection.close(); try { DriverManager.getConnection(url + 'shutdown=true;'); } catch (SQLException e) { System.out.println(e.getMessage()); } return ai; }}===================================================================================The output I receive from the above program is:org.apache.derby.jdbc.ClientDriver registeredorg.apache.derby.jdbc.EmbeddedDriver registeredFor jdbc:derby:EmbeddedTestBase; ID isAutoIncrement: trueDatabase 'EmbeddedTestBase' shutdown.For jdbc:derby://localhost:1527/ClientTestBase; ID isAutoIncrement: falseDERBY SQL error: SQLCODE: -1  SQLSTATE: 08006  SQLERRMC: Database 'ClientTestBase' shutdown.Embedded and client driver behave differently for isAutoIncrement().===================================================================================Ouput from sysinfo:------------------ Java Information ------------------Java Version: 1.5.0_06Java Vendor: Sun Microsystems Inc.Java home: C:/Program Files/Java/jre1.5.0_06Java classpath: .;C:/PROGRA~1/JMF21~1.1E/lib/sound.jar;C:/PROGRA~1/JMF21~1.1E/lib/jmf.jar;C:/PROGRA~1/JMF21~1.1E/lib;C:/WINDOWS/java/classes;C:/WorkSpace/PB 3.0/bin;C:/WorkSpace/Filipe/bin;C:/Documents and Settings/Piet/My Documents/Resources/Jars/ImgrRdr130.jar;C:/Documents and Settings/Piet/My Documents/Resources/Jars/lucene-1.4.1.jar;C:/Documents and Settings/Piet/My Documents/Resources/Jars/Multivalent20040415.jar;C:/Workspace/Stick/bin;OS name: Windows XPOS architecture: x86OS version: 5.1Java user name: PietJava user home: C:/Documents and Settings/PietJava user dir: C:/StickFolderjava.specification.name: Java Platform API Specificationjava.specification.version: 1.5--------- Derby Information --------JRE - JDBC: J2SE 5.0 - JDBC 3.0&#91;/org/apache/derby/info/DBMS.properties&#93; 10.1.2.1 - (330608)&#91;/org/apache/derby/info/tools.properties&#93; 10.1.2.1 - (330608)&#91;/org/apache/derby/info/net.properties&#93; 10.1.2.1 - (330608)&#91;/org/apache/derby/info/dnc.properties&#93; 10.1.2.1 - (330608)----------------------------------------------------------------------- Locale Information -----------------Current Locale : [Nederlands/Nederland &#91;nl_NL&#93;]Found support for locale: &#91;de_DE&#93; version: 10.1.2.1 - (330608)Found support for locale: &#91;es&#93; version: 10.1.2.1 - (330608)Found support for locale: &#91;fr&#93; version: 10.1.2.1 - (330608)Found support for locale: &#91;it&#93; version: 10.1.2.1 - (330608)Found support for locale: &#91;ja_JP&#93; version: 10.1.2.1 - (330608)Found support for locale: &#91;ko_KR&#93; version: 10.1.2.1 - (330608)Found support for locale: &#91;pt_BR&#93; version: 10.1.2.1 - (330608)Found support for locale: &#91;zh_CN&#93; version: 10.1.2.1 - (330608)Found support for locale: &#91;zh_TW&#93; version: 10.1.2.1 - (330608)------------------------------------------------------,0,0
Class-Path manifest entry for derby.jar is missing from the 10.2.0.2 snapshot,The class path manifest entry should include all the supported locales. It is missing from the snapshot.I see this entry when I build the jar files myself.Class-Path: derbyLocale_de_DE.jar derbyLocale_es.jar derbyLocale_fr.ja r derbyLocale_it.jar derbyLocale_ja_JP.jar derbyLocale_ko_KR.jar derb yLocale_pt_BR.jar derbyLocale_zh_CN.jar derbyLocale_zh_TW.jar,0,0
add  lang/grantrevoke.java to derbynetclientmats,I noticed running lang./grantrevoke.java with client fails with :&gt; Unexpected exception&gt; 08004: Connection authentication failure occurred. Reason: userid or password invalid.&gt; java.sql.SQLException: Connection authentication failure occurred. Reason: userid or password invalid.&gt; Caused by: org.apache.derby.client.am.SqlException: Connection authentication failure occurred. Reason: userid or password invalid.&gt; ... 8 more&gt; FAILED. 1 errorTest Failed.     End: grantRevoke jdk1.4.2_07 DerbyNetClient 2006-06-01 12:17:25 ***    Perhaps just a test configuration problem of some sort  but It would be good to have client testing for grant revoke.,0,0
File java/engine/org/apache/derby/loc/messages_en.properties - Message XSLAT.D,The message XSLAT.D (String LOG_SEGMENT_EXIST = 'XSLAT.D' states:XSLAT.D=Log directory {0} exists. Please make sure specified logDevice location is correct.But it seems by the source code that the problem is not that this directory exists  but the fact that it is not empty (// make sure log directory is empty  in LogToFile.java). So it seems to me that the following message would be better:XSLAT.D=Log directory {0} is not empty. Please make sure specified logDevice location is correct.,0,0
Interface changes introduced in Mustang build 86,Build 86 of Mustang introduced changes to the Connection interface that were not compatible with the existing Derby implementions. createArray() was renamed createArrayOf() and setClientInfoProperties() now throws SQLClientInfoException (rather than ClientInfoException). The result of this is that it is not possible to build Derby with build 86.,0,0
Wrong results with query using LIKE and ESCAPE clause that includes '%'  '/'  and '_',After the fix for DERBY-1262 was checked in  I'm noticing that the following query now returns different results. Prior to the fix for DERBY-1262 the query returned 2 rows; now it doesn't return any rows.create table escTable (c1 char(10));insert into escTable values ('%_/a');insert into escTable values ('%_b');insert into escTable values ('%c');insert into escTable values ('d');insert into escTable values ('%_/e');select c1 from escTable where c1 like '&#37;&#95;%' ESCAPE '/';Before DERBY-1262  the SELECT returned:C1----------%_/a%_/e2 rows selectedNow it returns:C1----------0 rows selectedBrief inspection of the query and data suggest to me that these new results (i.e. no rows) are wrong  and that Derby should in fact return 2 rows/.Based on comments in DERBY-1262  I'm creating a new Jira issue for the regression since it has been checked into the 10.1 maintenance branch. I've set the priority to 'Critical' since this could potentially delay a 10.1.3 release--I.e. I don't think we'd want to release 10.1.3 knowing that we have a wrong results regression. But if anyone thinks that's not the correct priority  feel free to speak up.Other option  of course  is to back out the change for DERBY-1262 in 10.1 and then lower the priority accordingly. Input/feedback/comments would be appreciated.,0,0
Message id J029 (CONN_RESTORE_FROM) does not have a matching message text,This is used by engine.org.apache.derby.jdbc.Driver20. Uncovered by the test i18n/MessageBundleTest.jav,0,0
Typo in link to Simple Example from frameworks/readme.html,There is a small typo in frameworks/readme.html.The link 'see the simple example' links to  ../demo/programs/simple/example.htmlbut it should link to  ../demo/simple/example.htmlbecause there is no 'programs' folder in the 'demo' subtree.I'm attaching a patch for review.,0,0
setEmbeddedCP.ksh and setNetworkCleitn.ksh does not work or gives wrong error message,setEmbeddedCP.ksh (and setNetworkClient.ksh) gives the following message if neither DERBY_HOME nor DERBY_INSTALL is set: echo '/$DERBY_HOME or /$DERBY_INSTALL not set. Please set one of these variables' echo 'to the location of your Derby installation.'but the scripts do not work if only DERBY_HOME is set,0,0
Using -Djvmflags option causes NoClassDefFoundError,When starting tests with the -Djvmflags option  the harness (RunList class) places '' around the argument to -Djvmflags when executing the java launcher to start a new jvm. This is (at least by suns java launcher) interpreted as a Class and not as a command line option  because of the ''. Because of this I get a NoClassDefFoundError.I believe this is a problem that happens only when using Suns java launcher.,0,0
Add MessageBundleTest to build script to verify that there are no orphaned message ids,MessageBundleTest can't be run with the regular tests because it relies on SQLState.java and MessageId.java  which are not in the jar files. But it actually makes more sense to run it as part of the build  as we are verifying the consistency of code references.,0,0
Network Server should flush the PrintWriter after console output,If Network Server is started with a PrintWriter specified for console output it will not automatically flush output such as starting the server. This can be confusing as the console output shows no activity.Users currently need to specify the PrintWriter to autoflush e.g. starterWriter = new PrintWriter(new FileOutputStream(new File(SERVER_START_LOG)) true); derbyServer = new NetworkServerControl(); derbyServer.start(starterWriter); For repro see:http://www.nabble.com/Questions-about-Network-Server-API-Behavior-p5055814.htmlAnd change the following line in the program to not autoflush as follows:starterWriter = new PrintWriter(new FileOutputStream(new File(SERVER_START_LOG)) false);,0,0
Correct instructions in demo html file demo/simple/example.html,In file demo/simple/example.html  under section 'Next run the SimpleApp demo in Derby client mode:'  step 5'java org.apache.derby.tools.sysinfo -cp client SimpleApp.class' gives the following error:Exception in thread 'main' java.lang.NoClassDefFoundError: org/apache/derby/tools/sysinfoThe above error is given because step 4 instructs to set path as following:export CLASSPATH=.:${DERBY_INSTALL}/lib/derbyclient.jarNow as neither derby.jar or derbytool.jar is been added to the above classpath  sysinfo file not found.Step 4 should instruct to set up path as following:export CLASSPATH=.:${DERBY_INSTALL}/lib/derbyclient.jar:${DERBY_INSTALL}/lib/derby.jar,0,0
Provide ALTER TABLE DROP COLUMN functionality,Provide a way to drop a column from an existing table. Possible syntax would be: ALTER TABLE tablename DROP COLUMN columnname CASCADE / RESTRICT;Feature should properly handle columns which are used in constraints  views  triggers  indexes  etc.,0,0
EmbeddedDriver does not implement PreparedStatement.setNull(int  int  String),The embedded driver throws Util.notImplemented() when PreparedStatement.setNull(int  int  String) is called. The javadoc says that '&#91;if&#93; the parameter does not have a user-defined or REF type  the given typeName is ignored.' The client driver correctly ignores typeName and forwards the call to setNull(int  int). Embedded should be changed to match the client.,0,0
testSecMec needs many masters - should convert to junit,derbynet/testSecMec.java fails with jcc2.8 with 131 vms. I have checked the diff and it is a master update with difference in the exception  message string.diff snippet:8 del&lt; T5: jdbc:derby:net://xxxFILTERED_HOSTNAMExxx:xxxFILTEREDPORTxxx/wombat:user=neelima;password=lee;securityMechanism=9; - EXCEPTION java.security.InvalidAlgorithmParameterException is caught when initializing EncryptionManager 'Prime size must be multiple of 64  and can only range from 512 to 1024 (inclusive)'8a8&gt; T5: jdbc:derby:net://xxxFILTERED_HOSTNAMExxx:xxxFILTEREDPORTxxx/wombat:user=neelima;password=lee;securityMechanism=9; - EXCEPTION java.security.NoSuchAlgorithmException is caught when initializing EncryptionManager 'DH KeyPairGenerator not available'14 del----------------There is difference in the exception message and will require lot of jvm specific master files which can become difficult to maintain. Myrna suggested that this might be a good test to convert to junit.,1,0
test run exits for _foundation run because unloadEmbeddedDriver uses driverManager  which isn't available.,The wctme5.7_foundation runs have been exiting out for a while. We only run this environment weekly and were under the impression there was a time out. But I ran the suite  capturing the output in a file  and the last part of the run shows the problem is with unloadEmbeddedDriver:Now do RunListException in thread 'main' java.lang.NoClassDefFoundError: java.sql.DriverManager at org.apache.derbyTesting.functionTests.harness.RunList.unloadEmbeddedDriver(RunList.java:1636) at org.apache.derbyTesting.functionTests.harness.RunList.runSuites(RunList.java:276) at org.apache.derbyTesting.functionTests.harness.RunList.&lt;init&gt;(RunList.java:167) at org.apache.derbyTesting.functionTests.harness.RunSuite.getSuitesList(RunSuite.java:208) at org.apache.derbyTesting.functionTests.harness.RunSuite.main(RunSuite.java:147)UnloadEmbeddedDriver was put in to allow running with useprocess=false and autoload of the driver  so it's needed. But maybe we can add an appropriate if condition so it doesn't try to do this with foundation.,0,0
'SQLBinary.readFromStream' can enter endless loop,Under certain circumstances  the method 'SQLBinary.readFromStream' can enter an endless loop while reading the stream. The following must be true for the bug to occur:  There must be more data in the stream than what can fit into the initial buffer (32 K). The method 'available' of the stream returns 0.Since the default return value for 'InputStream.available' is 0  and the method reading the stream can be used for data types CHAR FOR BIT DATA  VARCHAR FOR BIT DATA and LONG VARCHAR FOR BIT DATA  the bug should be fixed. The maximum length is 32700 bytes.The method will also be used by SQLBlob  but it may be better to introduce a new streaming method for it  since the current implementation has memory-problems for large data (materializes the whole stream). A separate issue should/will be created for this.The symptom for this bug is a hang when calling one of the execute methods of Prepared- or CallableStatement and maybe also certain set methods in ResultSet.The visibility of this bug is very low  but the impact is severe/critical. When the JDBC 4 length less streaming overloads are added (DERBY-1417)  visibility might increase.,0,0
Upgrade test needs to be enhanced to test grant revoke,Grant Revoke is one of the features targeted for 10.2 Release. The upgrade test should be modified to test this feature with various upgrade scenarios to make sure everything works fine.,1,0
Factor out type checks in EmbedResultSet and EmbedPreparedStatement,EmbedPreparedStatement and EmbedResultSet have many occurrences of switch (...) { case Types.CHAR: case Types.VARCHAR: case Types.LONGVARCHAR: case Types.CLOB: break; default: throw dataTypeConversion(...); }and switch (...) { case Types.BINARY: case Types.VARBINARY: case Types.LONGVARBINARY: case Types.BLOB: break; default: throw dataTypeConversion(...); }Instead of having many copies of this code  it would be good to factorit out into methods that can be shared. For instance  one could addthese methods to DataTypeDescriptor: public static boolean isAsciiStreamCompatible(int jdbcType) public static boolean isBinaryStreamCompatible(int jdbcType) public static boolean isCharacterStreamCompatible(int jdbcType),0,0
The Eclipse plug-in distributions (UI and Core zip files) do not contain the Apache license  copyright or notice files,The Apache Derby Core and Apache Derby UI plug-ins do not contain the appropriate Apache Software Foundation license files in their zip distributions  derby_core_plugin_10.1.3.zip  derby_ui_plugin_1.1.0.zip.I'm not sure exactly which files are required  LICENSE  COPYRIGHT and NOTICE  but the zip filesshould contain some or all of these files.,0,0
Unexpected behavior on self privilege revocation,When revoking the owner's own privilege against the table he have created  Derby executes the revocation successfullybut the owner is able to select from the table later as if though the REVOKE statement has no effect. More importantly  I was expecting a SQLException with the appropriate SQLSTATE to be thrown when the owner attempts to revoke privilege from himself. i.e.:ij&gt; connect 'jdbc:derby:authtest' user 'yip' as conn1;ij&gt; create table t1 (c1 int);0 rows inserted/updated/deletedij&gt; insert into t1 values 1 2 3;3 rows inserted/updated/deletedij&gt; revoke select on t1 from yip;0 rows inserted/updated/deletedij&gt; select * from t1;C1-----------1233 rows selectedHere is the sysinfo:------------------ Java Information ------------------Java Version: 1.4.2_12Java Vendor: Sun Microsystems Inc.Java home: C:/jdk142/jreJava classpath: derby.jar;derbytools.jar;.OS name: Windows XPOS architecture: x86OS version: 5.1Java user name: yipJava user home: C:/Documents and Settings/AdministratorJava user dir: C:/derby/trunk/jars/sanejava.specification.name: Java Platform API Specificationjava.specification.version: 1.4--------- Derby Information --------JRE - JDBC: J2SE 1.4.2 - JDBC 3.0&#91;C:/derby/trunk/jars/sane/derby.jar&#93; 10.2.0.4 alpha - (423353)&#91;C:/derby/trunk/jars/sane/derbytools.jar&#93; 10.2.0.4 alpha - (423353)----------------------------------------------------------------------- Locale Information -----------------Current Locale : [English/United States &#91;en_US&#93;]Found support for locale: &#91;de_DE&#93; version: 10.2.0.4 alpha - (423353)Found support for locale: &#91;es&#93; version: 10.2.0.4 alpha - (423353)Found support for locale: &#91;fr&#93; version: 10.2.0.4 alpha - (423353)Found support for locale: &#91;it&#93; version: 10.2.0.4 alpha - (423353)Found support for locale: &#91;ja_JP&#93; version: 10.2.0.4 alpha - (423353)Found support for locale: &#91;ko_KR&#93; version: 10.2.0.4 alpha - (423353)Found support for locale: &#91;pt_BR&#93; version: 10.2.0.4 alpha - (423353)Found support for locale: &#91;zh_CN&#93; version: 10.2.0.4 alpha - (423353)Found support for locale: &#91;zh_TW&#93; version: 10.2.0.4 alpha - (423353)------------------------------------------------------,1,0
A  trigger should be dropped when a privilege required by the trigger is revoked.,A trigger tracks its privileges requirements using Derby's Dependency Manager. If any one of those required privileges are revoked  the trigger should be dropped automatically. I am just creating a new jira entry here so it is easier to track sub items of DERBY-1330. Will link this Jira entry to DERBY-1330.See the functional spec attached to DERBY-1330,1,0
Make test jdbc4/TestPreparedStatement run under the security manager,See trunk/java/testing/org/apache/derbyTesting/functionTests/tests/jdbc4/TestPreparedStatement_app.properties which says: test fails trying to read blob content filesOther tests succesfully read files so it must be possible to enable this test under the security manager.Maybe the files need to be marked as support files and copied into the extin/extout/extinout foldersto use the existing permissions in the test policy files.,1,0
derbynet/testProtocol.java fails with security manager enabled,The tinderbox test started failing after revision 423676 which enabled security manager for derbynet/testProtocol.java. See http://www.multinet.no/~solberg/public/Apache/TinderBox_Derby/testlog/SunOS-5.10_i86pc-i386/423706-derbyall_diff.txtException in thread 'main' java.security.AccessControlException: access denied (java.net.SocketPermission 127.0.0.1:1527 connect resolve) at java.security.AccessControlContext.checkPermission(AccessControlContext.java:264) at java.security.AccessController.checkPermission(AccessController.java:427) at java.lang.SecurityManager.checkPermission(SecurityManager.java:532) at java.lang.SecurityManager.checkConnect(SecurityManager.java:1034) at java.net.Socket.connect(Socket.java:501) at java.net.Socket.connect(Socket.java:457) at java.net.Socket.&lt;init&gt;(Socket.java:365) at java.net.Socket.&lt;init&gt;(Socket.java:178) at org.apache.derby.impl.drda.TestProto.getConnection(Unknown Source) at org.apache.derby.impl.drda.TestProto.&lt;init&gt;(Unknown Source) at org.apache.derbyTesting.functionTests.tests.derbynet.testProtocol.executeFile(Unknown Source) at org.apache.derbyTesting.functionTests.tests.derbynet.testProtocol.main(Unknown Source),1,0
Derby JDBC 4.0 driver returns 3 for JDBC driver major version,For 10.2 the DatabaseMetaData.getJDBCMajorVersion() is returning '3' for the Derby JDBC 4.0 driver. It should return 4. This is easily reproduced by running a simple test to obtain a connection and output the value Database product: Apache DerbyDatabase version: 10.2.0.4 alphaDriver name: Apache Derby Embedded JDBC DriverDriver version: 10.2.0.4 alphaJDBC driver major version: 3JDBC driver minor version: 0Test code:org.apache.derby.jdbc.EmbeddedConnectionPoolDataSource40 ds = new org.apache.derby.jdbc.EmbeddedConnectionPoolDataSource40();ds.setDatabaseName('C://drivers//derby//databasesJDBC40DB'); ds.setUser('dbuser1'); ds.setPassword('dbpwd1'); PooledConnection pooledConn = ds.getPooledConnection(); Connection conn = pooledConn.getConnection(); System.out.println('Database product: ' + conn.getMetaData().getDatabaseProductName()); System.out.println('Database version: ' + conn.getMetaData().getDatabaseProductVersion()); System.out.println('Driver name: ' + conn.getMetaData().getDriverName()); System.out.println('Driver version: ' + conn.getMetaData().getDriverVersion()); System.out.println('JDBC driver major version: ' + conn.getMetaData().getJDBCMajorVersion()); System.out.println('JDBC driver minor version: ' + conn.getMetaData().getJDBCMinorVersion());Relevant Derby Embedded code in EmbedDatabaseMetaData is: JDBC 3.0 * Retrieves the major JDBC version number for this driver. * @return JDBC version major number */ public int getJDBCMajorVersion() { return 3; }and client code in org.apache.derby.client.am.DatabaseMetaData:public int getJDBCMajorVersion() throws SQLException { checkForClosedConnection(); return 3; }I am not sure if this should be JVM dependent or if it should always return 4 regardless of the JVM version.,0,0
enable more testcases in ConcurrencyTest,A number of testcases  which depend on SUR  are not enabled in the ConcurrencyTest.These testcases can be enabled. The test should also set some properties to reduce lock timeout  so that it runs faster.,0,0
NullPointerException in UPDATE with COALESCE and subquery,The following statements generate a NullPointerException:CREATE TABLE t1 (i INTEGER);CREATE TABLE t2 (i INTEGER);UPDATE t1 SET i = COALESCE( (SELECT i FROM t2 WHERE t2.i=t1.i)  0);Any further SQL statements generate an internal error in RawStore  e.g.:SELECT * FROM t1;,0,0
Link 'Getting Started....' and 'Apache Derby Server ....' in demo.html needs to be linked to actual documents instead of manuals page,The links 'Getting Started with Apache Derby' and 'Apache Derby Server and Administration Guide' in file https://svn.apache.org/repos/asf/db/derby/code/trunk/java/demo/demo.html needs to be linked to actual documents as following:Getting Started with Apache Derby to 'http://db.apache.org/derby/docs/dev/getstart/getstartderby.pdf'Apache Derby Server and Administration Guide to 'http://db.apache.org/derby/docs/dev/adminguide/derbyadmin.pdf' Right now the links are linked to 'http://db.apache.org/derby/manuals/index.html'Also  once the dev release is committed (for example committed to 10.2)  the links needs to be changed so that 'dev' is replaced with actual release number.,0,0
Network server fails with DRDAProtocolException if a BLOB with size 2147483647 is streamed from client,When executing a program which inserts a BLOB of size 2GB-1  the Network server fails with DRDAProtocolException. This happens before it starts handling the actual LOB data:java org.apache.derby.drda.NetworkServerControl startApache Derby Network Server - 10.2.0.4 alpha started and ready to accept connections on port 1527 at 2006-07-26 14:15:21.284 GMTExecution failed because of a Distributed Protocol Error: DRDA_Proto_SYNTAXRM; CODPNT arg = 0; Error Code Value = corg.apache.derby.impl.drda.DRDAProtocolException at org.apache.derby.impl.drda.DRDAConnThread.throwSyntaxrm(DRDAConnThread.java:441) at org.apache.derby.impl.drda.DDMReader.readLengthAndCodePoint(DDMReader.java:554) at org.apache.derby.impl.drda.DDMReader.getCodePoint(DDMReader.java:617) at org.apache.derby.impl.drda.DRDAConnThread.parseSQLDTA_work(DRDAConnThread.java:4072) at org.apache.derby.impl.drda.DRDAConnThread.parseSQLDTA(DRDAConnThread.java:3928) at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLSTTobjects(DRDAConnThread.java:3806) at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLSTT(DRDAConnThread.java:3640) at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:928) at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:254)nullorg.apache.derby.impl.drda.DRDAProtocolException at org.apache.derby.impl.drda.DRDAConnThread.throwSyntaxrm(DRDAConnThread.java:441) at org.apache.derby.impl.drda.DDMReader.readLengthAndCodePoint(DDMReader.java:554) at org.apache.derby.impl.drda.DDMReader.getCodePoint(DDMReader.java:617) at org.apache.derby.impl.drda.DRDAConnThread.parseSQLDTA_work(DRDAConnThread.java:4072) at org.apache.derby.impl.drda.DRDAConnThread.parseSQLDTA(DRDAConnThread.java:3928) at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLSTTobjects(DRDAConnThread.java:3806) at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLSTT(DRDAConnThread.java:3640) at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:928) at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:254),0,0
Scripts in frameworks direcotry needs to be revisted to set up CLASSPATH properly,Need to revisit scripts in directory frameworks/embedded/bin and frameworks/NetworkServer/bin for setting up CLASSPATH properly. The current problem is as following:If user already has a CLASSPATH set on their system  the CLASSPATH is not set again within the script. Therefore  there are no derby classes in the CLASSPATH which results in java command failing as it can not find the derby class it is calling. Basically  to make the scripts work  user has to either issue command 'set CLASSPATH=' or have derby jar files be appended to their system CLASSPATH before running any frameworks batch script.In ksh scripts  there is same problem except that the user has to issue command 'export CLASSPATH=' or have derby jar files be appended to their system CLASSPATH only once as whatever CLASSPATH is set up by scripts is not visible once the script is done.So I am proposing the following solution so that frameworks scripts work properly without interfering with system classpath or without any setup from user.In batch scripts:-----------------------1. Before line 'call '%DERBY_INSTALL%'/frameworks/embedded/bin/setEmbeddedCP.bat'  save the current classpath as follows:set SAVED_CLASSPATH=%CLASSPATH%2. Replace the following lines:@if Unable to render embedded object: File (&quot;%CLASSPATH%&quot;==) not found. call '%DERBY_INSTALL%'/frameworks/embedded/bin/setEmbeddedCP.bat@if '%CLASSPATH%' == '' call '%DERBY_INSTALL%'/frameworks/embedded/bin/setEmbeddedCP.batwithcall '%DERBY_INSTALL%'/frameworks/embedded/bin/setEmbeddedCP.batNote: I have given the above as example only. The name of script that is getting called may be different.3. At the end of script  reset the CLASSPATH to system CLASSPATH as follows:set CLASSPATH=%SAVED_CLASSPATH%In korn scripts:-----------------------In ksh script  even though system classpath is only modified within the script and is not effective once script exits  to be consistent with batch scripts  do the following:1. Before line '. '$DERBY_HOME'/frameworks/embedded/bin/setEmbeddedCP.ksh' save the current classpath as follows:export SAVED_CLASSPATH=$CLASSPATH2. Replace the following lines:[ -z '$CLASSPATH' ] &amp;&amp; { . '$DERBY_HOME'/frameworks/embedded/bin/setEmbeddedCP.ksh}with. '$DERBY_HOME'/frameworks/embedded/bin/setEmbeddedCP.kshNote: I have given the above as example only. The name of script that is getting called may be different.3. At the end of script  reset the CLASSPATH to system CLASSPATH as follows:export CLASSPATH=$SAVED_CLASSPATH,0,0
test harness evaluates j9 2.2 jvm (a.k.a wctme5.7) as isJDBC4; does enthousiastic sed-ing,The wctme5.7 run shows failures like so:     Start: iepnegativetests jdk1.3.1 subset - 2.2 derbyall:derbytools 2006-07-24 11:41:43 ***16 del&lt; ERROR 38000: The exception 'java.sql.SQLException: Table/View 'IEP.NOTABLE' does not exist.' was thrown while evaluating an expression.16a16&gt; ERROR 38000: The exception 'SQL Exception: Table/View 'IEP.NOTABLE' does not exist.' was thrown while evaluating an expression....    It seems to me this is because it evaluates the major/minor version (2.2) as isJDBC4 in functionTests/harness/RunTest.java : JavaVersionHolder jvh = getProperties(sp); boolean isJDBC4 = jvh.atLeast( 1  6 );and is gets passed on to Sed.java.The following tests fail with this jvm because of this:lang/compressTable.sqllang/nestedCommit.sqllang/releaseCompileLocks.sqltools/iepnegativetests.sqltools/importExportThruIJ.sqltools/ieptests.sqljdbcapi/statementJdbc20.javai18n/iepnegativetests_ES.sqlstore/streamingColumn.javastore/TransactionTable.sqllang/procedureInTrigger.sqlIt seems to me we need an if (!jvmName.startsWith('j9')) or some such around the isJDBC4 assignment.,0,0
derbyrunjartest hangs with wctme5.7 & always uses j9_13; hangs with _foundation,derbyrunjartest hangs with wctme5.7.I am not sure what the hook up is but if I do this:j9 -jcl:max -Xbootclasspath/p:c:/wctme5.7/ive/lib/jclMax/classes.zip;c:/wctme5.7/ive/lib/charconv.zip;c:/wctme5.7/ive/lib/database_enabler.jar -jar c:/derbyt/svn2/trunk/jars/sane/derbyrun.jar ij --helpI get successfully:Usage: java org.apache.derby.tools.ij &#91;-p propertyfile&#93; [-ca connectionAttributePropertyFile] &#91;inputfile&#93;Also  when looking at the code of this test  it forces the jvm class to be used to be j9_13 whenever the jvm as set in RunTest starts with J9. However  wctme5.7 is j9_22 and this also prevents running with foundation (assuming that's supported).,0,1
new j9 canons required/canons need to be removed to catch up to changes to 7/27/06.,There are some newer failures with wctme5.7 &amp; wsdd5.6 that are just due to canon maintenance. lang/aggregate.sql - needs a new j9_13 and j9_22 canon lang/ejbql.sql - j9_13 canon can be removed (there is no j9_22 canon) lang/distinct.sql - needs new j9_22 canon nist/dml099.sql - j9_13 canon can be removed lang/procedureInTrigger.sql - needs a j9_22 canon note  this last test also suffers from DERBY-1605.,0,0
Test harness overrides heap size settings when starting Network Server,Test specific heap size settings can be passed to the test harness using the jvmflags system property  for example in a &lt;testname&gt;_app.properties file or at the command line when starting a test  e.g '-Djvmflags=-Xms32m^-Xmx32m'.The test harness almost always overrides such settings when starting a new Network Server using the org.apache.derbyTesting.functionTests.harness.NetServer class of the test harness. Currently  if either -ms or -Xms is missing from the jvmflags  NetServer.start() adds -ms16777216. Also  if either -mx or -Xmx is missing from the jvmflags  NetServer.start() adds -ms33554432. This has been the case since SVN revision 420048 (July 8  2006).Earlier revisions did not override the heap settings unless the newer -Xms or -Xmx flags were used instead of the -ms and -mx flags. A patch for DERBY-1091 attempted (among other things) to make the harness recognize the newer flags as well as the older flags  but the resulting behavior is (most likely) not as intended. If a test is run in either the DerbyNet framework or the DerbyNetClient framework  the test-specific JVM flags should (probably) be used for the Network Server JVM as well as the test JVM. Currently  even if non-default heap size flags are passed to the harness  the server JVM will ignore these settings since the harness adds -ms and/or -mx flags after all other heap flags. The exception is if both new and old versions of heap flags are passed to the harness  e.g:jvmflags=-ms32m^-Xms32m^-mx128m^-Xmx128mHere is the code causing this behaviour:if (setJvmFlags &amp;&amp; ((jvmflags.indexOf('-ms') == -1) || (jvmflags.indexOf('-Xms') == -1))) // only setMs if no starting memory was given jvm.setMs(16*1024*1024); // -ms16mif (setJvmFlags &amp;&amp; ((jvmflags.indexOf('-mx') == -1) || (jvmflags.indexOf('-Xmx') == -1))) // only setMx if no max memory was given jvm.setMx(32*1024*1024); // -mx32m,0,1
Lots of jdk1.6 regression test failures with diffs because of  SQL Exception instead of java.sql.SQLException,jdk16 derbyall derbyall: 19 failures derbyall/derbyall.fail:lang/compressTable.sql derbyall/derbyall.fail:lang/nestedCommit.sql derbyall/derbyall.fail:lang/outparams.java derbyall/derbyall.fail:lang/procedure.java derbyall/derbyall.fail:lang/procedureInTrigger.sql derbyall/derbyall.fail:tools/importExportThruIJ.sql derbyall/derbyall.fail:tools/ieptests.sql derbyall/derbyall.fail:tools/iepnegativetests.sql derbyall/derbyall.fail:jdbcapi/statementJdbc20.java derbyall/derbyall.fail:jdbcapi/statementJdbc30.java derbyall/derbyall.fail:jdbcapi/parameterMapping.java derbyall/derbyall.fail:i18n/iepnegativetests_ES.sql derbyall/derbynetclientmats/derbynetclientmats.fail:jdbc4/ClosedObjectTest.junit derbyall/derbynetclientmats/derbynetclientmats.fail:jdbc4/UnsupportedVetter.junit derbyall/derbynetclientmats/derbynetclientmats.fail:jdbc4/VerifySignatures.junit derbyall/encryptionAll/encryption.fail:stress/stress.multi derbyall/encryptionAll/storemats.fail:store/streamingColumn.java derbyall/storeall/storeall.fail:store/TransactionTable.sql derbyall/storeall/storemats.fail:store/streamingColumn.java,0,0
Sysinfo in 10.2  shows multiple entries if the derby jars reside in a directory with spaces in its name,For the Derby jars residing in C:/Documents and Settings/Administrator/TEMP DIR/lib  the sysinfo shows:--------- Derby Information --------JRE - JDBC: J2SE 5.0 - JDBC 3.0&#91;C:/Documents%20and%20Settings/Administrator/TEMP%20DIR/lib/derby.jar&#93; 10.2.0.5 alpha - (426734)&#91;C:/Documents%20and%20Settings/Administrator/TEMP%20DIR/lib/derbytools.jar&#93; 10.2.0.5 alpha - (426734)&#91;C:/Documents%20and%20Settings/Administrator/TEMP%20DIR/lib/derbynet.jar&#93; 10.2.0.5 alpha - (426734)&#91;C:/Documents%20and%20Settings/Administrator/TEMP%20DIR/lib/derbyclient.jar&#93; 10.2.0.5 alpha - (426734)&#91;C:/Documents and Settings/Administrator/TEMP DIR/lib/derby.jar&#93; 10.2.0.5 alpha - (426734)&#91;C:/Documents and Settings/Administrator/TEMP DIR/lib/derbynet.jar&#93; 10.2.0.5 alpha - (426734)&#91;C:/Documents and Settings/Administrator/TEMP DIR/lib/derbyclient.jar&#93; 10.2.0.5 alpha - (426734)&#91;C:/Documents and Settings/Administrator/TEMP DIR/lib/derbytools.jar&#93; 10.2.0.5 alpha - (426734)&#91;C:/Documents%20and%20Settings/Administrator/TEMP%20DIR/lib/db2jcc.jar&#93; 2.6 - (90)&#91;C:/Documents and Settings/Administrator/TEMP DIR/lib/db2jcc_license_c.jar&#93; 2.6 - (90)------------------------------------------------------This is a regression from 10.1 where the same sysinfo shows:--------- Derby Information --------JRE - JDBC: J2SE 5.0 - JDBC 3.0&#91;C:/Documents and Settings/Administrator/TEMP DIR/lib/derby.jar&#93; 10.1.3.2 - (426741)&#91;C:/Documents and Settings/Administrator/TEMP DIR/lib/derbynet.jar&#93; 10.1.3.2 - (426741)&#91;C:/Documents and Settings/Administrator/TEMP DIR/lib/derbyclient.jar&#93; 10.1.3.2 - (426741)&#91;C:/Documents and Settings/Administrator/TEMP DIR/lib/derbytools.jar&#93; 10.1.3.2 - (426741)&#91;C:/Documents and Settings/Administrator/TEMP DIR/lib/db2jcc.jar&#93; 2.6 - (90)&#91;C:/Documents and Settings/Administrator/TEMP DIR/lib/db2jcc_license_c.jar&#93; 2.6 - (90)------------------------------------------------------,0,0
Trigger action statement is not recompile when there is a change that would affect it.,A trigger action statement  such as an INSERT statement is not recompiled when there is some DDL change on the underlying table  such as a CREATE INDEX.In the example below a unique index is added to the table (t2) inserted into by the trigger's action statement. When the tirgger fires it does not raise any error (should raise a unique constraint violated error) and does not insert the value into the index. A select from t2 does not show the additional rows in t2 as it is performing an index scan  once the index is dropped the rows appear to the select.ij version 10.2ij&gt; connect 'jdbc:derby:cs;create=true';ij&gt; create table t (i int);0 rows inserted/updated/deletedij&gt; create table t2 (i int);0 rows inserted/updated/deletedij&gt; create trigger tt after insert on t for each statement mode db2sqlinsert into t2 values 1;0 rows inserted/updated/deletedij&gt; insert into t values 1;1 row inserted/updated/deletedij&gt; select * from t2;I-----------11 row selectedij&gt; create unique index tu on t2;0 rows inserted/updated/deletedij&gt; insert into t values 1;1 row inserted/updated/deletedij&gt; select * from t2;I-----------11 row selectedij&gt; insert into t values 1;1 row inserted/updated/deletedij&gt; select * from t2;I-----------11 row selectedij&gt; drop index tu;0 rows inserted/updated/deletedij&gt; select * from t2;I-----------1113 rows selected,0,0
NetConnection40 references an engine class  org.apache.derby.impl.jdbc.Util,NetConnection40.java contains this:...import org.apache.derby.impl.jdbc.Util;... public boolean isValid(int timeout) throws SQLException { // Validate that the timeout has a legal value if (timeout &lt; 0) { throw Util.generateCsSQLException(SQLState.INVALID_API_PARAMETER  new Integer(timeout)  'timeout'  'java.sql.Connection.isValid'); }...This was added as part of DERBY-1090. This should be changed to use the client's method of throwing exceptions.,0,0
A  'revoke execute ... restrict' should fail if there are dependent objects on the execute privilege,As per the functional spec attached to DERBY-1330  a 'revoke execute ... restrict' should fail if there are dependent objects on the execute privilegeIn order to implement this  when revoke execute is executed  a special invalidation action should be sent and dependent objects will need to catch that invalidation and throw an exception. If there are no dependents  then no exception will be thrown and revoke execute will succeed.I am just creating a new jira entry here so it is easier to track sub items of DERBY-1330. Will link this Jira entry to DERBY-1330. See the functional spec attached to DERBY-1330,1,0
NPE when inserting values to a table that has a column declared as generated by default as identity,The following scenario triggers a NullPointerException in statement compilation:ij&gt; create table t1 (c1 int  c2 int generated by default as identity);0 rows inserted/updated/deletedij&gt; insert into t1 (c2) values default  10;ERROR XJ001: Java exception: ': java.lang.NullPointerException'.Stacktrace from derby.log:Database Class Loader started - derby.database.classpath=''2006-08-04 06:31:17.235 GMT Thread&#91;main 5 main&#93; (XID = 235)  (SESSIONID = 0)  (DATABASE = wombat)  (DRDAID = null)  Cleanup action starting2006-08-04 06:31:17.235 GMT Thread&#91;main 5 main&#93; (XID = 235)  (SESSIONID = 0)  (DATABASE = wombat)  (DRDAID = null)  Failed Statement is: insert into t1 (c2) values default  10java.lang.NullPointerException at org.apache.derby.impl.sql.compile.ResultColumnList.generateCore(ResultColumnList.java:1033) at org.apache.derby.impl.sql.compile.ResultColumnList.generate(ResultColumnList.java:893) at org.apache.derby.impl.sql.compile.RowResultSetNode.generate(RowResultSetNode.java:690) at org.apache.derby.impl.sql.compile.UnionNode.generate(UnionNode.java:589) at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1424) at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1286) at org.apache.derby.impl.sql.compile.NormalizeResultSetNode.generate(NormalizeResultSetNode.java:122) at org.apache.derby.impl.sql.compile.InsertNode.generate(InsertNode.java:764) at org.apache.derby.impl.sql.compile.StatementNode.generate(StatementNode.java:232) at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:477) at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:118) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:713) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:567) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:516) at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:313) at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:478) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:347) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:248) at org.apache.derby.impl.tools.ij.Main.go(Main.java:203) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169) at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55) at org.apache.derby.tools.ij.main(ij.java:69)sysinfo:------------------ Java Information ------------------Java Version: 1.4.2_12Java Vendor: Sun Microsystems Inc.Java home: C:/jdk142/jreJava classpath: classes;.OS name: Windows XPOS architecture: x86OS version: 5.1Java user name: yipJava user home: C:/Documents and Settings/AdministratorJava user dir: C:/derby/trunkjava.specification.name: Java Platform API Specificationjava.specification.version: 1.4--------- Derby Information --------JRE - JDBC: J2SE 1.4.2 - JDBC 3.0&#91;C:/derby/trunk/classes&#93; 10.2.0.5 alpha - (1)----------------------------------------------------------------------- Locale Information -----------------Current Locale : [English/United States &#91;en_US&#93;]Found support for locale: &#91;de_DE&#93; version: 10.2.0.5 alpha - (1)Found support for locale: &#91;es&#93; version: 10.2.0.5 alpha - (1)Found support for locale: &#91;fr&#93; version: 10.2.0.5 alpha - (1)Found support for locale: &#91;it&#93; version: 10.2.0.5 alpha - (1)Found support for locale: &#91;ja_JP&#93; version: 10.2.0.5 alpha - (1)Found support for locale: &#91;ko_KR&#93; version: 10.2.0.5 alpha - (1)Found support for locale: &#91;pt_BR&#93; version: 10.2.0.5 alpha - (1)Found support for locale: &#91;zh_CN&#93; version: 10.2.0.5 alpha - (1)Found support for locale: &#91;zh_TW&#93; version: 10.2.0.5 alpha - (1)------------------------------------------------------,0,0
Create index on large tables fails with too many open files   FileNotFoundException.,Create index fails on a table with 18million rows during sort with too many open files errorThis error was first seen when running against a tpcc-like test. The test creates the tables  inserts data and then creates the indexes &amp; adds constraints.Customer table has 18 million rows in this case. The below error is thrown on create index. ij&gt; create index customer_last on customer(c_w_id  c_d_id  c_last);ERROR XSDF1: Exception during creation of file /home/cloudtst/SinglePerf/testruns/scripts/dbtpcc/tmp/T1128794811044.tmp for containerERROR XJ001: Java exception: '/home/cloudtst/SinglePerf/testruns/scripts/dbtpcc/tmp/T1128794811044.tmp (Too many open files): java.io.FileNotFoundException'.ij,0,0
Network Server should not send to client that it supports EUSRIDPWD when running against Sun JVM,As part of ACCSECRD  if the server does not accept the security mechanism sent by the client  the server will send a list of security mechanism that it supports. Currently even when the server is running with sun jvm  it will still send EUSRIDPWD as a sec mec that it supports  which is incorrect. The server should test if it can support EUSRIDPWD dynamically and if it does  only then send EURRIDPWD as an option that it supports.see DRDAConnThread.writeACCSECRD(int),0,0
Regression (wrong results): Join predicate can be ignored for left-most child in a chain of nested unions.,If Derby chooses to do a join between two FromTables and the right table is a chain of UNIONs  then the optimizer may choose to push the join predicate (if provided) down into the UNION and to both children of every UNION in the chain. But if the predicate cannot be pushed to the children of any of the UNIONs (except the top-level one) the predicate can end up being ignored altogether with respect to that UNION's children. The result is that query execution can return rows that do not satisfy the predicate.This is a regression introduced in 10.1.2.4 and thus it affects 10.1.3 and 10.2. I came across this while tracing through code for DERBY-1633.,0,0
ConsistencyToken.hashCode() is not thread safe,If ConsistencyToken.hashCode() is run concurrently by different threads  some of the threads may see a partial result instead of the correct hash code. This is not a problem in the current code since all calls to that method are synchronized on a higher level  but it would be good to fix in case the method will be used differently in the future.,0,0
jdbcapi/blobclob4BLOB.java fails under DerbyNet framework with JCC 2.6,With JCC 2.6  the jdbcapi/blobclob4BLOB.java fails. The diff did not show anything alarming  so I am guessing itmay be a master update. The test passed fine with DerbyClient     Start: blobclob4BLOB jdk1.5.0_06 DerbyNet derbynetmats:jdbcapi 2006-08-11 23:29:48 ***466a467 474&gt; EXPECTED SQLSTATE(22018): Invalid character string format for type INTEGER.&gt; end clobTest54&gt; START: clobTest6&gt; EXPECTED SQLSTATE(null): Invalid position 0 or length 5&gt; EXPECTED SQLSTATE(null): Invalid position 1 or length -76&gt; EXPECTED SQLSTATE(null): Invalid position 1 or length -1&gt; EXPECTED SQLSTATE(null): Invalid position 0 or length 0&gt; FAIL &#8211; unexpected exception:java.lang.StringIndexOutOfBoundsException: String index out of range: -1468 475d475&lt; EXPECTED SQLSTATE(22018): Invalid character string format for type INTEGER.&lt; end clobTest54&lt; START: clobTest6&lt; EXPECTED SQLSTATE(null): Invalid position 0 or length 5&lt; EXPECTED SQLSTATE(null): Invalid position 1 or length -76&lt; EXPECTED SQLSTATE(null): Invalid position 1 or length -1&lt; EXPECTED SQLSTATE(null): Invalid position 0 or length 0&lt; FAIL &#8211; unexpected exception:java.lang.StringIndexOutOfBoundsException: String index out of range: -1775a776 782&gt; blobTest54 finished&gt; START: blobTest6&gt; EXPECTED SQLSTATE(null): Invalid position 0 or length 5&gt; EXPECTED SQLSTATE(null): Invalid position 1 or length -76&gt; EXPECTED SQLSTATE(null): Invalid position 1 or length -1&gt; EXPECTED SQLSTATE(null): Invalid position 0 or length 0&gt; FAIL &#8211; unexpected exception:java.lang.NegativeArraySizeException777 783d783&lt; blobTest54 finished&lt; START: blobTest6&lt; EXPECTED SQLSTATE(null): Invalid position 0 or length 5&lt; EXPECTED SQLSTATE(null): Invalid position 1 or length -76&lt; EXPECTED SQLSTATE(null): Invalid position 1 or length -1&lt; EXPECTED SQLSTATE(null): Invalid position 0 or length 0&lt; FAIL &#8211; unexpected exception:java.lang.NegativeArraySizeException789 del&lt; com.ibm.db2.jcc.c.SqlException: Operation 'CREATE TRIGGER' cannot be performed on object 'TESTBLOB' because there is an open ResultSet dependent on that object.789a789&gt; com.ibm.db2.jcc.a.SqlException: Operation 'CREATE TRIGGER' cannot be performed on object 'TESTBLOB' because there is an open ResultSet dependent on that object.Test Failed. End: blobclob4BLOB jdk1.5.0_06 DerbyNet derbynetmats:jdbcapi 2006-08-11 23:30:46 ***,0,0
Client driver does not use the query timeout value set using Statement.setQueryTimeout() for subsequent executions using the same statement object,I will attach a repro with more details.,0,0
derbynet/testProperties.java hangs,The testProperties.execCmd() is used to fork a JVM and not handle itsstreams. This will cause problems  as indicated by the javadoc for Process.'The parent process uses these streams to feed input to and get outputfrom the subprocess. Because some native platforms only provide limitedbuffer size for standard input and output streams  failure to promptlywrite the input stream or read the output stream of the subprocess maycause the subprocess to block  and even deadlock',0,1
testSecMec.java fails with JCC 2.6 and JCC 2.8,After the checkin for DERBY-528 testSecMec fails with JCC 2.6 and 2.8. My hope was to just wait until the masters were normalized with the conversion of this test to Junit  but I think that work has been deferred for a bit so I will look at the current test.I have had a problem with this test on my machine for sometime with DERBY-1114 like symptoms with all jvms and even with derbyclient. I need to investigate that or run on another machine to resolve this issue.,0,0
Add more tests for Statement.setQueryTimeout method,Currently  the following checks work as expected but it would be good to add them to regression tests: Add tests to check query timeout value is used by executeUpdate method. Existing test tests calls to execute and executeQuery. The following mail mentions query timeout limit should be applied for all executeXXX methods. http://www.nabble.com/Statement.setQueryTimeout-tf94429.html#a258410 Add tests for Statement and CallableStatement class. Existing test tests this method with PreparedStatement only. I found a difference in behaviour with client driver when using Statement class (DERBY-1692). So it may be good to add some tests for each statement class.,0,0
Deprecate scripts in frameworks directory,With revision 432159  new scripts to be added to the -bin distribution as a part of DERBY-1032 were added to the distributions and snapshots. The old frameworks scripts should be marked as deprecated where appropriate in the documentation  readme files  and release pages.,0,0
huge single insert statements fail with JVM error due to size of generated method,ERROR XBCM1: Java linkage error thrown during load of generated class org.apache.derby.exe.ace5214067x010dx1c21xe385x00000011be005.ERROR XJ001: Java exception: 'Invalid method Code length 68686 in class file org/apache/derby/exe/ace5214067x010dx1c21xe385x00000011be005: java.lang.ClassFormatError'.The above occurred when doing an insert statement using the mutiple row syntax 'INSERT INTO foo (...) VALUES (...)  (...) ...' for huge amounts of input data. I was able to insert 500 rows at once  but it balked at 1000.Workaround: chunk one huge insert into several merely big inserts before sending them to Derby.,0,0
Invoking Java stored procedure that contains GRANT or REVOKE statement with CONTAINS SQL should fail.,In Derby SQL authorization mode  invoking Java stored procedure that contains GRANT or REVOKE statement with CONTAINS SQL from a trigger should fail but in the following test  it successfully executed the trigger action. Attaching repro patch for trunk.i.e.:ij&gt; connect 'triggerProcSQLAuth;create=true' user 'APP' as app;WARNING 01J14: SQL authorization is being used without first enabling authentication.ij&gt; &#8212; setup the environment&#8212; table used in the procedurescreate table t1 (i int primary key  b char(15));0 rows inserted/updated/deletedij&gt; insert into t1 values (1  'XYZ');1 row inserted/updated/deletedij&gt; insert into t1 values (2  'XYZ');1 row inserted/updated/deletedij&gt; &#8212; table used in this testcreate table t2 (x integer  y integer);0 rows inserted/updated/deletedij&gt; create procedure grant_select_proc()  parameter style java dynamic result sets 0 language java  contains sql external name 'org.apache.derbyTesting.functionTests.util.ProcedureTest.grantSelect';0 rows inserted/updated/deletedij&gt; create procedure revoke_select_proc()  parameter style java dynamic result sets 0 language java  contains sql external name 'org.apache.derbyTesting.functionTests.util.ProcedureTest.revokeSelect';0 rows inserted/updated/deletedij&gt; &#8212; testscreate trigger grant_select_trig AFTER delete on t1  for each STATEMENT mode db2sql call grant_select_proc();0 rows inserted/updated/deletedij&gt; &#8212; should faildelete from t1 where i = 1;1 row inserted/updated/deletedij&gt; &#8212; check delete failedselect * from t1;I |B ---------------------------2 |XYZ 1 row selectedij&gt; &#8212; check if there are rows in sys.systableperms  should be 0select count from SYS.SYSTABLEPERMS;1 -----------1 1 row selectedij&gt; drop trigger grant_select_trig;0 rows inserted/updated/deletedij&gt; create trigger revoke_select_trig AFTER delete on t1  for each STATEMENT mode db2sql call revoke_select_proc();0 rows inserted/updated/deletedij&gt; &#8212; should faildelete from t1 where i = 2;1 row inserted/updated/deletedij&gt; &#8212; check delete failedselect * from t1;I |B ---------------------------0 rows selectedij&gt; &#8212; check if there are rows in sys.systableperms  should be 0select count from SYS.SYSTABLEPERMS;1 -----------0 1 row selectedij&gt; drop trigger revoke_select_trig;0 rows inserted/updated/deletedij&gt; ------------------ Java Information ------------------Java Version: 1.4.2_12Java Vendor: Sun Microsystems Inc.Java home: C:/Program Files/Java/j2re1.4.2_12Java classpath: derby.jar;derbytools.jarOS name: Windows XPOS architecture: x86OS version: 5.1Java user name: YipJava user home: C:/Documents and Settings/YipJava user dir: C:/work3/derby/trunk/jars/sanejava.specification.name: Java Platform API Specificationjava.specification.version: 1.4--------- Derby Information --------JRE - JDBC: J2SE 1.4.2 - JDBC 3.0&#91;C:/work3/derby/trunk/jars/sane/derby.jar&#93; 10.3.0.0 alpha - (432670M)&#91;C:/work3/derby/trunk/jars/sane/derbytools.jar&#93; 10.3.0.0 alpha - (432670M)----------------------------------------------------------------------- Locale Information -----------------Current Locale : [English/United States &#91;en_US&#93;]Found support for locale: &#91;de_DE&#93; version: 10.3.0.0 alpha - (432670M)Found support for locale: &#91;es&#93; version: 10.3.0.0 alpha - (432670M)Found support for locale: &#91;fr&#93; version: 10.3.0.0 alpha - (432670M)Found support for locale: &#91;it&#93; version: 10.3.0.0 alpha - (432670M)Found support for locale: &#91;ja_JP&#93; version: 10.3.0.0 alpha - (432670M)Found support for locale: &#91;ko_KR&#93; version: 10.3.0.0 alpha - (432670M)Found support for locale: &#91;pt_BR&#93; version: 10.3.0.0 alpha - (432670M)Found support for locale: &#91;zh_CN&#93; version: 10.3.0.0 alpha - (432670M)Found support for locale: &#91;zh_TW&#93; version: 10.3.0.0 alpha - (432670M)------------------------------------------------------,1,0
Manifest file doesn't contain OSGi attributes,With osgi.jar in tools/java  'ant buildjars' does not add the OSGi attributes to derby.jar's manifest. Instead  a file named ${manifest.file} is created in the root of the source tree. This file contains what should have been in the manifest  for instance:Manifest-Version: 1.0Ant-Version: Apache Ant 1.6.5Created-By: diablo-1.5.0_07-b00 (Sun Microsystems Inc.)Bundle-Activator: org.apache.derby.osgi.EmbeddedActivatorDynamicImport-Package: *Export-Package: org.apache.derby.authentication org.apache.derby.datab ase org.apache.derby.io org.apache.derby.jdbc org.apache.derby.vtiThis seems to be caused by build.xml containing a reference to '${manifest.file}' at a location where manifest.file is not bound to a value. The attached patch (manifest.diff) fixes the issue by replacing '${manifest.file}' with '${derby.jar.dir}/lists/smf.mf'.,0,0
The language and store systems treat a JVM error such as OutOfMemoryError differently leading to the raw store protocol violation errors,Don't have the exact details  but remember noticing it a while ago. I think the store transaction context closes the transaction on such an error  while the language conneciton context just rollsback the transaction or the statement. I think the best and consistent approach would be to close the connection.,0,0
derbynet/testSecMec.java fails with NullPointerException (intermittent failure),http://www.multinet.no/~solberg/public/Apache/TinderBox_Derby/testlog/SunOS-5.10_i86pc-i386/433374-derbyall_diff.txt                 Diff file derbyall/derbynetclientmats/DerbyNetClient/derbynetmats/derbynetmats/testSecMec.diff             Start: testSecMec jdk1.5.0_04 DerbyNetClient derbynetmats:derbynetmats 2006-08-22 01:45:28 ***61a62 63&gt; java.sql.SQLException: No current connection.&gt; Exception in thread 'DRDAConnThread_15' java.lang.NullPointerExceptionTest Failed. End: testSecMec jdk1.5.0_04 DerbyNetClient derbynetmats:derbynetmats 2006-08-22 01:46:05 ***    Detailed log:Test USRSSBPWD_with_BUILTIN - derby.drda.securityMechanism=nullTurning ON Derby BUILTIN authenticationUSRSSBPWD (T0): jdbc:derby://localhost:20000/wombat;user=neelima;password=lee;shutdown=true;securityMechanism=8 - EXCEPTION DERBY SQL error: SQLCODE: -1  SQLSTATE: 08006  SQLERRMC: Database 'wombat' shutdown.java.sql.SQLException: No current connection. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.noCurrentConnection(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.checkIfClosed(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.setupContextStack(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.rollback(Unknown Source) at org.apache.derby.impl.drda.Database.close(Unknown Source) at org.apache.derby.impl.drda.Session.close(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.closeSession(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)Exception in thread 'DRDAConnThread_15' java.lang.NullPointerException at java.lang.Throwable.printStackTrace(Throwable.java:509) at org.apache.derby.impl.drda.DRDAProtocolException.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.drda.DRDAProtocolException.newAgentError(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.sendUnexpectedException(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.closeSession(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source),0,0
Implement Bracketed SQL comments (/*...*/ comments),Hibernate use multiline sql statements to show the internal building of the hql statements. You can disable this feature  but it would be nice if you can implements bracketed SQL comments in Derby.Thanks.,0,0
derbynet/testSecMec.java fails with ShutdownException in DerbyNetClient framework,During 10.2.1.0 beta testing this test failed with org.apache.derby.iapi.services.context.ShutdownException on 2 of 4 platforms running Solaris zones:Platform 'sparc_zone2': derbynetclientmats/derbynetmats/DerbyNetClient/derbynetmats/testSecMec.diffPlatform 'sparc_zone3': derbynetclientmats/derbynetmats/DerbyNetClient/derbynetmats/testSecMec.diff derbyall/derbynetclientmats/DerbyNetClient/derbynetmats/derbynetmats/testSecMec.diffThe test did not fail on other platforms  which may indicate timing sensitivity (tests are run concurrently in 4 zones (1 global  3 local) on one single machine). Here is one of the diffs (from platform 'sparc_zone2'):                 Diff file derbynetclientmats/derbynetmats/DerbyNetClient/derbynetmats/testSecMec.diff             Start: testSecMec jdk1.6.0-rc DerbyNetClient derbynetmats:derbynetmats 2006-08-14 21:31:48 ***308a309 312&gt; java.sql.SQLException: Java exception: ': org.apache.derby.iapi.services.context.ShutdownException'.&gt; ... 14 more----------------------------------------------&gt; Testing with derby.drda.securityMechanism=INVALID_VALUE&gt; EXPECTED EXCEPTION DRDA_InvalidValue.U:Invalid value  INVALID_VALUE  for derby.drda.securityMechanism.310 312d313&lt; Testing with derby.drda.securityMechanism=INVALID_VALUE&lt; EXPECTED EXCEPTION DRDA_InvalidValue.U:Invalid value  INVALID_VALUE  for derby.drda.securityMechanism.&lt; -----Test Failed. End: testSecMec jdk1.6.0-rc DerbyNetClient derbynetmats:derbynetmats 2006-08-14 21:32:54 ***    The failure occurred in the DerbyNetClient framework when shutting down the database for the second (and last) time in the method testUSRSSBPWD_with_BUILTIN(). This test method was added August 9  2006 (DERBY-528).Attatching derby.log from the failure in derbynetclientmats/derbynetmats on sparc_zone2.,0,0
XMLSERIALIZE operator doesn't follow SQL/XML spec in some areas when serializing a sequence.,The SQL/XML specification dictates that  when serializing a sequence of XML items  the XMLSERIALIZE operator must first 'normalize' the sequence based on the rules defined here: http://www.w3.org/TR/xslt-xquery-serialization/#serdmThe current Derby implementation doesn't perform such normalization  which leads to two ways in which the results of an XMLSERIALIZE operator may not agree with the required behavior: 1. Sequences of atomic values will not have spaces between  but the space is required as part of step 3 of the normalization rules at the above link. 2. Derby will allow serialization of a sequence even if it has a top-level Attribute node in it  but the rules of normalization dictate that an error should be thrown instead (step 7).Both of these behaviors can be seen with the following query.values xmlserialize( xmlquery('/ageinfo/@*' passing by ref xmlparse( document '&lt;ageinfo age='48' birthdate='1900-02-08'/&gt;' preserve whitespace ) empty on empty ) as char(50) )Derby will currently return the following result from this statement:1--------------------------------------------------481900-02-08This result does not abide by SQL/XML specification because a) Derby allowed serialization of a sequence having a top-level attribute node (actually  the sequence had two)  and b) the atomic values produced from the attributes were displayed without a space between them.The correct behavior for the above example is to return a serialization error caused by the presence of an Attribute node in the sequence.If the example was rewritten as  say: xmlquery('/ageinfo/@*' passing by ref+ xmlquery('fn:data(/ageinfo/@*)' passing by refthen the attribute nodes are no longer present--we only have their atomic values  which is allowed. Thus the correct result should then be:1--------------------------------------------------48 1900-02-08Note  though  that Xalan doesn't appear to support the 'fn:data' function  so this rewritten query won't actually work. I tried using Xalan's built-in string function  as follows: xmlquery('/ageinfo/@*' passing by ref+ xmlquery('string(/ageinfo/@*)' passing by refbut Xalan only returns the first attribute in that case; it doesn't return the second one. So part of this Jira issue is probably going to involve figuring out how to allow a user to retrieve a sequence of attribute values (as opposed to attribute nodes) using Xalan and still abide by the SQL/XML rules.,0,1
remote server testing with 10.2 snapshot showed 8 failures,I ran derbynetclientmats between two IPV6 machines with the 10.2 snapshot and finally got to look at the results...There were 8 failures  4 of those because of other tests leaving stuff behind.2 tests complained about junit classes not being found (? one of those was checkDataSource!).2 tests seemed to have trouble connecting - those might be the more interesting ones.Will do further analysis  &amp; create test cleanup patches.The failing tests and some comments:suite derbynetclientmats with ibm142 &amp; IPV6 machines using -DhostName= (i.e. remote server test) and build: 10.2.0.4 alpha - (419130)derbynetclientmats/derbynetclientmats.fail:jdbcapi/checkDataSource.java ?? fails because of an error accessing junit. Not sure why  junit is in client classpath...and it's not even a junit test. Stack trace not helpful. (points to client.am  which makes little/no sense).derbynetclientmats/derbynetmats/derbynetmats.fail:derbynet/testconnection.java ?? no connectionderbynetclientmats/derbynetmats/derbynetmats.fail:derbynet/testij.java ?? no connectionderbynetclientmats/derbynetmats/derbynetmats.fail:jdbcapi/metadata.java extra tables/views: JIRA1454  Y.derbynetclientmats/derbynetmats/derbynetmats.fail:jdbcapi/odbc_metadata.java dittoderbynetclientmats/derbynetmats/derbynetmats.fail:lang/syscat.sql dittoderbynetclientmats/derbynetmats/derbynetmats.fail:jdbcapi/ProcedureTest.junit junit not available??derbynetclientmats/derbynetmats/derbynetmats.fail:jdbcapi/checkDataSource30.java Table/View 'Y' already exists.,1,0
ERROR 42Z72: XML syntax error; missing keyword(s): 'AS'. - Misleading text,create table t (i int  x xml);select xmlserialize from t;ERROR 42Z72: XML syntax error; missing keyword(s): 'AS'.This is not an 'XML Syntax error'  it's a syntax in the SQL language. No need to have a special error messgae here  wouldn't the error be caught by regular parsing?,0,0
The database owner is incorrectly referred to as dba in the code comments that were checked in Derby 10.2 for grant revoke work. We should clean this up at some point.,Grant revoke functionality was added in Derby 10.2 The comments that went into the grant revoke code  in some places refer to database owner as 'dba'. They are not the same thing. In the grant revoke world  dba is a role. We haven't added roles into Derby yet but current use of dba in comments might make it confusing when we do start working on roles including dba.,0,0
Embedded ResultSet.getTimestamp on a TIME column returns a java.sql.Timestamp with a date portion that can be incorrect.,The date portion of the java.sql.Timestamp from a TIME column is intended to be the current date but instead can be any date value  based upon the last getXXX call that required a Java Calendar object.,0,0
Client's ResultSet.getTime() on a SQL TIMESTAMP column loses the sub-second resolution and always has a milli-second value of zero.,In embedded the java.sql.Time object returned from ResultSet.getTime() for a SQL TIMESTAMP object has its millisecond value for the time portion equal to that for the java.sql.Timestamp value.In client the millisecond time value for such a value is always set to zero.Note a Derby SQL TIME value has by definition resolution of only a second so its millisecond value is always zero but java.sql.Time is not a direct mapping to the SQL Type  it's a JDBC type  so when converting from a SQL TIMESTAMPit should retain the precision.The new test lang.TimeHandlingTest has this assert code that shows the problem  one of its calls will be commented outwith a comment with this bug number. private void assertTimeEqual(Time tv  Timestamp tsv) { cal.clear(); cal.setTime(tv); int hour = cal.get(Calendar.HOUR_OF_DAY); int min = cal.get(Calendar.MINUTE); int sec = cal.get(Calendar.SECOND); int ms = cal.get(Calendar.MILLISECOND); // Check the time portion is set to the same as tv cal.clear(); cal.setTime(tsv); assertEquals(hour  cal.get(Calendar.HOUR_OF_DAY)); assertEquals(min  cal.get(Calendar.MINUTE)); assertEquals(sec  cal.get(Calendar.SECOND)); assertEquals(ms  cal.get(Calendar.MILLISECOND)); &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; FAILS HERE },0,0
Access rule violations should use a SQL state starting with '42' according to the SQL standard.,The SQL standard says that SQL State '42' is for 'syntax error or accessrule violation' (section 23.1).There is a question of what JDBC 4.0 exception should be thrown for a access rule violation JDBC 4.0 maps '42' to SQLSyntaxErrorException which seems wrong for an access rule.Message thread:http://mail-archives.apache.org/mod_mbox/db-derby-dev/200609.mbox/%3c45004A04.5080002@apache.org%3e,0,0
lang/procedureInTrigger.sql fails with wctme5.7 foundation with CNFE  java.sql.DriverManager and other exceptions.,Test failed with 10.3 jars 10.3.0.0 alpha - (439522). I am attaching the report file from the test run wctme5.7_derbyall_report.txt . Please see this file for the diff. This test was added as part of DERBY-551 and checkin - r421281.,0,0
sysinfo test fails with 'access denied (java.util.PropertyPermission java.class.path read)' when derbyclient.jar is first in classpath,Seen on Linux and Solaris  with Sun JVM 1.4  1.5  1.6 when derbyclient.jar is first in classpath:                 Diff file derbyall/derbynetmats/DerbyNet/derbynetmats/sysinfo.diff             Start: sysinfo jdk1.4.2_02 DerbyNet derbynetmats:derbynetmats 2006-09-05 08:44:54 ***14a15&gt; Unable to analyze class path: access denied (java.util.PropertyPermission java.class.path read)17 26d17&lt; Current Locale : [English/United States &#91;en_US&#93;]&lt; Found support for locale: &#91;de_DE&#93;&lt; Found support for locale: &#91;es&#93;&lt; Found support for locale: &#91;fr&#93;&lt; Found support for locale: &#91;it&#93;&lt; Found support for locale: &#91;ja_JP&#93;&lt; Found support for locale: &#91;ko_KR&#93;&lt; Found support for locale: &#91;pt_BR&#93;&lt; Found support for locale: &#91;zh_CN&#93;&lt; Found support for locale: &#91;zh_TW&#93;41a33&gt; Unable to analyze class path: access denied (java.util.PropertyPermission java.class.path read)44 53d35&lt; Current Locale : [English/United States &#91;en_US&#93;]&lt; Found support for locale: &#91;de_DE&#93;&lt; Found support for locale: &#91;es&#93;&lt; Found support for locale: &#91;fr&#93;&lt; Found support for locale: &#91;it&#93;&lt; Found support for locale: &#91;ja_JP&#93;&lt; Found support for locale: &#91;ko_KR&#93;&lt; Found support for locale: &#91;pt_BR&#93;&lt; Found support for locale: &#91;zh_CN&#93;&lt; Found support for locale: &#91;zh_TW&#93;69a52&gt; Unable to analyze class path: access denied (java.util.PropertyPermission java.class.path read)72 81d54&lt; Current Locale : [English/United States &#91;en_US&#93;]&lt; Found support for locale: &#91;de_DE&#93;&lt; Found support for locale: &#91;es&#93;&lt; Found support for locale: &#91;fr&#93;&lt; Found support for locale: &#91;it&#93;&lt; Found support for locale: &#91;ja_JP&#93;&lt; Found support for locale: &#91;ko_KR&#93;&lt; Found support for locale: &#91;pt_BR&#93;&lt; Found support for locale: &#91;zh_CN&#93;&lt; Found support for locale: &#91;zh_TW&#93;Test Failed. End: sysinfo jdk1.4.2_02 DerbyNet derbynetmats:derbynetmats 2006-09-05 08:44:59 ***,1,0
Correct message SQL State 01006 to reflect that is being revoked - 'user' and update the Ref Manual,the SQL State 01006 'Privilege not revoked from {0}.' should be changed to 'Privilege notrevoked from user {0}.'Once changed in the code  the Ref Manual file rrefexcept71493. dita needs to be updated as well.,0,0
jdbcapi/blobclob4BLOB.java fails with JCC drivers,Test fails with JCC versions 2.4  2.6 and 2.8. Sample diff:&lt; FAIL: Caught exception java.lang.NegativeArraySizeException592a592&gt; FAIL: Caught exception java.lang.NegativeArraySizeException:,0,0
Create a script that allows users to easily update their Derby jars with the JDBC4 classes.,Since the resolution of the JDBC 4 licensing issue was to not ship a build that includes Derby's JDBC 4 code  but continue to ship the Derby source files for them  a script which automatically compiles and updates the Derby jars with the JDBC 4 classes would be useful.,0,0
Tests lang/grantRevokeDDL.sql and lang/grantRevokeDDL2.sql fails on IBM WCTME 5.7 Foundation (jdkJ2ME Foundation Specification v1.0),The diff for grantRevokeDDL.sql is big  hence attaching. For lang/grantRevokeDDL2.sql the diff is as follows:                 Diff file derbyall/derbylang/grantRevokeDDL2.diff             Start: grantRevokeDDL2 jdkJ2ME Foundation Specification v1.0 derbyall:derbylang 2006-09-10 11:42:23 ***0a1&gt; java.lang.reflect.InvocationTargetException: java.lang.NullPointerException99 del&lt; ERROR: Failed with SQLSTATE 3800199a100&gt; ERROR: Failed with SQLSTATE XJ001119 del&lt; ERROR: Failed with SQLSTATE 38002119a120&gt; ERROR: Failed with SQLSTATE XJ001139 del&lt; ERROR: Failed with SQLSTATE 38002139a140&gt; ERROR: Failed with SQLSTATE XJ001158 del&lt; 1 row inserted/updated/deleted158a159 160&gt; ERROR: Failed with SQLSTATE 38000&gt; ERROR: Failed with SQLSTATE XJ001163 del&lt; 0 rows selected163a165 166&gt; 4 |XYZ &gt; 1 row selected168a172 182&gt; ERROR: Failed with SQLSTATE 28508&gt; ij(USER2)&gt; set connection user1;&gt; ij(USER1)&gt; create trigger revoke_select_trig AFTER delete on t1 &gt; for each STATEMENT mode db2sql call revoke_select_proc1();&gt; 0 rows inserted/updated/deleted&gt; ij(USER1)&gt; &#8211; should fail&gt; delete from t1 where i = 5;&gt; ERROR: Failed with SQLSTATE 38000&gt; ERROR: Failed with SQLSTATE XJ001&gt; ij(USER1)&gt; &#8211; check delete failed&gt; select * from t1 where i = 5;171 184d184&lt; 1 |XYZ &lt; 1 row selected&lt; ij(USER2)&gt; set connection user1;&lt; ij(USER1)&gt; create trigger revoke_select_trig AFTER delete on t1 &lt; for each STATEMENT mode db2sql call revoke_select_proc1();&lt; 0 rows inserted/updated/deleted&lt; ij(USER1)&gt; &#8211; should fail&lt; delete from t1 where i = 5;&lt; ERROR: Failed with SQLSTATE 38000&lt; ERROR: Failed with SQLSTATE 38001&lt; ij(USER1)&gt; &#8211; check delete failed&lt; select * from t1 where i = 5;&lt; I |B &lt; ---------------------------191a192 202&gt; ERROR: Failed with SQLSTATE 28508&gt; ij(USER2)&gt; set connection user1;&gt; ij(USER1)&gt; create trigger revoke_select_trig AFTER delete on t1 &gt; for each STATEMENT mode db2sql call revoke_select_proc2();&gt; 0 rows inserted/updated/deleted&gt; ij(USER1)&gt; &#8211; should fail&gt; delete from t1 where i = 6;&gt; ERROR: Failed with SQLSTATE 38000&gt; ERROR: Failed with SQLSTATE XJ001&gt; ij(USER1)&gt; &#8211; check delete failed&gt; select * from t1 where i = 6;194 207d204&lt; 1 |XYZ &lt; 1 row selected&lt; ij(USER2)&gt; set connection user1;&lt; ij(USER1)&gt; create trigger revoke_select_trig AFTER delete on t1 &lt; for each STATEMENT mode db2sql call revoke_select_proc2();&lt; 0 rows inserted/updated/deleted&lt; ij(USER1)&gt; &#8211; should fail&lt; delete from t1 where i = 6;&lt; ERROR: Failed with SQLSTATE 38000&lt; ERROR: Failed with SQLSTATE 38002&lt; ij(USER1)&gt; &#8211; check delete failed&lt; select * from t1 where i = 6;&lt; I |B &lt; ---------------------------214a212 222&gt; ERROR: Failed with SQLSTATE 28508&gt; ij(USER2)&gt; set connection user1;&gt; ij(USER1)&gt; create trigger revoke_select_trig AFTER delete on t1 &gt; for each STATEMENT mode db2sql call revoke_select_proc3();&gt; 0 rows inserted/updated/deleted&gt; ij(USER1)&gt; &#8211; should fail&gt; delete from t1 where i = 7;&gt; ERROR: Failed with SQLSTATE 38000&gt; ERROR: Failed with SQLSTATE XJ001&gt; ij(USER1)&gt; &#8211; check delete failed&gt; select * from t1 where i = 7;217 230d224&lt; 1 |XYZ &lt; 1 row selected&lt; ij(USER2)&gt; set connection user1;&lt; ij(USER1)&gt; create trigger revoke_select_trig AFTER delete on t1 &lt; for each STATEMENT mode db2sql call revoke_select_proc3();&lt; 0 rows inserted/updated/deleted&lt; ij(USER1)&gt; &#8211; should fail&lt; delete from t1 where i = 7;&lt; ERROR: Failed with SQLSTATE 38000&lt; ERROR: Failed with SQLSTATE 38002&lt; ij(USER1)&gt; &#8211; check delete failed&lt; select * from t1 where i = 7;&lt; I |B &lt; ---------------------------237a232 242&gt; ERROR: Failed with SQLSTATE 28508&gt; ij(USER2)&gt; set connection user1;&gt; ij(USER1)&gt; create trigger revoke_select_trig AFTER delete on t1 &gt; for each STATEMENT mode db2sql call revoke_select_proc4();&gt; 0 rows inserted/updated/deleted&gt; ij(USER1)&gt; &#8211; ok&gt; delete from t1 where i = 8;&gt; ERROR: Failed with SQLSTATE 38000&gt; ERROR: Failed with SQLSTATE XJ001&gt; ij(USER1)&gt; &#8211; check delete &gt; select * from t1 where i = 8;240 del&lt; 1 |XYZ 240a245&gt; 8 |XYZ 241a247 252&gt; ij(USER1)&gt; drop trigger revoke_select_trig;&gt; 0 rows inserted/updated/deleted&gt; ij(USER1)&gt; set connection user2;&gt; ij(USER2)&gt; &#8211; should fail&gt; select * from user1.t1 where i = 1;&gt; ERROR: Failed with SQLSTATE 28508243 260d253&lt; ij(USER1)&gt; create trigger revoke_select_trig AFTER delete on t1 &lt; for each STATEMENT mode db2sql call revoke_select_proc4();&lt; 0 rows inserted/updated/deleted&lt; ij(USER1)&gt; &#8211; ok&lt; delete from t1 where i = 8;&lt; 1 row inserted/updated/deleted&lt; ij(USER1)&gt; &#8211; check delete &lt; select * from t1 where i = 8;&lt; I |B &lt; ---------------------------&lt; 0 rows selected&lt; ij(USER1)&gt; drop trigger revoke_select_trig;&lt; 0 rows inserted/updated/deleted&lt; ij(USER1)&gt; set connection user2;&lt; ij(USER2)&gt; &#8211; should fail&lt; select * from user1.t1 where i = 1;&lt; ERROR: Failed with SQLSTATE 28508&lt; ij(USER2)&gt; set connection user1;Test Failed. End: grantRevokeDDL2 jdkJ2ME Foundation Specification v1.0 derbyall:derbylang 2006-09-10 11:42:33 ***,1,0
Assert failure in sane mode for queries that used to work in 10.1.2.1,Derby-1777 gives a database and a small program called 'ViewerInit' that prepares a bunch of large queries involving nested subqueries  unions  and join predicates. The actual bug described in DERBY-1777 is an NPE  and that's what the patch for DERBY-1777 addresses.However  once the NPEs are fixed  some of the queries in that same program now fail with ASSERT failures when running in SANE mode; this Jira issue is for addressing those assert failures.While this does constitute a regression  I don't know yet what the root cause of the problem is  so I hesitate to make it a 10.2 blocker--hence urgency is 'Normal'. I'm still investigating the queries to try to track down where the problem is  but all I've been able to deduce so far is that a) the assertion occurs for a scoped predicate and thus the pushing of join predicates into UNIONs is somehow involved  and b) in INSANE mode the query compiles without problem and appears (based on some early and very incomplete testing) to execute without problem. But more investigation is required to determine if the execution/results are actually correct  and to understand more about why the assertion is being thrown.I'm marking the fixin as 10.2.2.0 for now since I don't enough to make this a blocker for 10.2.1. Hopefully more info will be forthcoming...,0,0
largeDataTests/LobLimits master needs update for new exception names,&lt; EXPECTED SQL Exception: (XJ001) Java exception: 'Input stream did not have exact amount of data as the requested length.: java.io.IOException'.47a47&gt; EXPECTED SQL Exception: (XJ001) Java exception: 'Input stream did not have exact amount of data as the requested length.: org.apache.derby.iapi.services.io.DerbyIOException'.+ moreSee http://www.multinet.no/~solberg/public/Apache/LargeData/testlog/SunOS-5.10_i86pc-i386/448277-largeData_diff.txt,0,0
The source distribution for 10.2.1.4 rc1 includes derby.log files,The db-derby-10.2.1.4-src release candidate built on 9/22/06 includes derby.log files. db-derby-10.2.1.4-src/derby.log db-derby-10.2.1.4-src/java/demo/toursdb/derby.logFile sizes: $ ls -l derby.log rw-rw-r- 1 jta jta 767545 Sep 22 16:12 derby.log $ ls -l java/demo/toursdb/derby.log rw-rr- 1 jta jta 542 Sep 22 14:28 java/demo/toursdb/derby.logIf the release candidates need to be rebuilt  it would be good to remove those derby.log files  but it doesn't harm anything to have them in there (just consumes a little space).The db-derby-10.2.1.4-lib and db-derby-10.2.1.4-bin distributions don't have these files.,0,0
error 58009.C.19  refers to non-existent codepoint secktn - needs correcting,error 58009.C.19=Network protocol exception: secktn was not returned. The connection has been terminated.This is NET_SECTKN_NOT_RETURNED in org.apache.derby.drda.client.net.NetConnection.javaI searched in the drda specs but I could not find SECKTN  but I did find SECTKN.So...I think the error message should get changed to SECTKN.The same non-existent codepoint seems to be referred to in: XN002.U=secktn was not returned.This affects the following: English messages .properties file(s) Brazilian messages .properties file(s) documentation for SQLStates.I didn't find any masters with this.It should probably go into 10.2.1  although it's not important enough to hold up a release. Targeting for 10.2.2 for now.Myrna,0,0
SQLSTATE 42X10 occurs when qualifying a column with a synonym in ORDER BY clause,SQLSTATE 42X10 occurs when qualifying a column with a synonym in ORDER BY clause  where the synonym was declared in a different schema:ij version 10.3ij&gt; connect 'jdbc:derby:wombat;create=true';ij&gt; create schema test1;0 rows inserted/updated/deletedij&gt; create schema test2;0 rows inserted/updated/deletedij&gt; create table test1.testtable(id bigint not null);0 rows inserted/updated/deletedij&gt; create synonym test2.testtable for test1.testtable;0 rows inserted/updated/deletedij&gt; set schema test1;0 rows inserted/updated/deletedij&gt; select testtable.id from testtable;ID --------------------0 rows selectedij&gt; set schema test2;0 rows inserted/updated/deletedij&gt; select testtable.id from testtable;ID --------------------0 rows selectedij&gt; select testtable.id from testtable order by testtable.id;ERROR 42X10: 'TESTTABLE' is not an exposed table name in the scope in which it appears.ij&gt;,0,0
10.2.1.5 source distribution is missing many files and includes some files that it should not.,The source distribution is missing the top-level bin and maven directories  as well as BUILDING.txt  README  index.html  and published-api-overview.html. Also  the tools directory is missing release/build.xml.In addition  tools/testing/derby contains a complete set of the Derby 10.1 jars  these should be removed from the -src distribution.,0,0
The scripts under the /bin of the distribution does not have the executable permission,The scripts under the /bin directory of the distribution does not have the execute permission. Here is the dir listing:rw-rr- 1 rajeshk RD 1153 2006-09-15 12:12 dblookrw-rr- 1 rajeshk RD 1353 2006-09-15 12:20 dblook.batrw-rr- 1 rajeshk RD 2348 2006-09-15 12:12 derby_common.batrw-rr- 1 rajeshk RD 4853 2006-09-15 12:56 derby_common.shrw-rr- 1 rajeshk RD 1241 2006-09-15 12:12 ijrw-rr- 1 rajeshk RD 1345 2006-09-15 12:20 ij.bat....The issue was raised in the list earlierhttp://www.nabble.com/Questions-on-the-scripts-in--bin--directory-of-Derby-install-p6271633.htmlbut looks it is not fully resolved.,1,0
ALTER TABLE DROP COLUMN needs to update GRANTed column privileges,When ALTER TABLE DROP COLUMN is used to drop a column from a table  it needs to update the GRANTed column privileges on that table.The following behaviors need to be provided: DROP COLUMN needs to automatically revoke any privileges which have been granted on this column Privileges which have been granted on other columns in this table need to be adjusted due to changed column position numbersWhen this problem is fixed  the following additional cleanup steps should occur: The check that disables DROP COLUMN in sqlAuthorization mode needs to be removed There is a comment in AlterTableConstantAction that needs to be revised The tests in lang/altertableDropColumn.sql should be moved into altertable.sql altertableDropColumn.sql and altertableDropColumn.out should be deletedSearch for this JIRA issue number in the code to find the relevant places to change.,1,0
Bring STATUS file up to date,The STATUS file is stale:1) Votes taken since February aren't mentioned.2) The development trunk is labelled as 10.23) The committer list is stale.,0,0
readme.html under frameworks does not mention about Derby client and some minor typos in example.html,The readme.html file under frameworks mentions about the JCC driver but nothing about the Derbyclient.Also under the demo/programs/simple/example.html some minor issues/typos:Under the section 'Next run the SimpleApp demo in Derby client mode:' step 5 on classpath mentions:NOT FOUND IN CLASS PATH: Derby Client libraries (db2jcc.jar) (com.ibm.db2.jcc.DB2Driver not found.)The above show JCC info instead of Derby Client,0,0
Add re-encrytion  of database test cases to the upgrade test..,Add a encryption of an un-encrypted database and re-encryption of encrypted database test case to the upgrade test. Please see DERBY-1156 for details about re-encryption feature. re-encrytpion test cases will be added to run only when test is executed using jar files. Upgrade test mixes the old version of derby classes in the jar files and the new classes when run under code-line using classes.; This cause boot time error when databases is encrypted ( This kind of mixing different version of classes is not supported   see DERBY-1898) .,0,0
Make FOR EACH clause and MODE DB2SQL in CREATE TRIGGER statement optional,According to SQL:2003 standard  section 11.39 &lt;trigger definition&gt;  under Syntax Rules item 8:If neither FOR EACH ROW nor FOR EACH STATEMENT is specified  then FOR EACH STATEMENT is implicit.[ FOR EACH { ROW | STATEMENT } ],0,0
Remove stale code from the statement classes in the client driver,Statement and ParameterMetaData contain flags called escapedProcedureCallWithResult_. These flags might have had a function before  but now they are always false. They are used in many if-statements and make the code harder to read. Removing the flags and the code that is only executed when the flags are true  would simplify the code and make it more maintainable.,0,0
improve XSDG3 error to print container  actual i/o operation  and file name.,The current error does not give enough information to know what container is the problem:ERROR XSDG3: Meta-data for Containerorg.apache.derby.impl.store.raw.data.RAFContainer@10632cd could not beaccessed,0,0
Routine parameter names displayed by dblook are not escaped.,After using this SQL to create a function with a delimited parameter nameCREATE FUNCTION FRED ('paramOne' INTEGER) RETURNS INTEGERLANGUAGE JAVA PARAMETER STYLE JAVA EXTERNAL NAME 'fred.foo' dblook will output a CREATE FUNCTION statement with the parameter name without quotes:CREATE FUNCTION 'APP'.'FRED' (paramOne INTEGER) RETURNS INTEGERLANGUAGE JAVA PARAMETER STYLE JAVAREADS SQL DATA CALLED ON NULL INPUTEXTERNAL NAME 'fred.foo';Using the output from dblook to re-create the function will result in a function with a different parameter name.,0,0
Junit tests that require SQL authorization mode should use a different database to the default one.,Since databases are re-used in the JUnit world having a single database for the two modes does not work.Not sure if there are any tests that need this yet. SQLAuthorizationPropTest actually tests setting the property so it really needs its own database (I think).,0,0
Add Order Entry application/system/performance test/toolkit,Order Entry (OE) is an OLTP application/toolkit which is based upon the TPC-C specification but is not claiming to be a valid implementation. The TPC-C specification is used mainly forthe database schema &amp; population rules and the logic of the business transactions.http://www.tpc.org/tpcc/OE is set up so that the driving &amp; display of the business transactions is separated from the actual implementation which then allows different implementations to compare performance of Derby features. In all cases the implementationswould perform the logical functionality required by the TPC-C  but need not be strict implementations. As an examplethe new order number is obtained in a defined way in TPC-C  but Derby could use generated keys to perform thesame logical function. Testing the two ways would lead to see if there were performance problems with generated keys.Examples of the possible implementations of the business transactions are: direct - client executes SQL statements directly holding onto PreparedStatements for the lifetime of the client) procedure - client executes a procedure per business transaction EOD - implementation using JDBC 4^H5? EOD updateable ResultSets positioned updates etc.Other options include use of triggers use of generated keys etc.Possible values for the display (results of the transaction) nothing text HTML for servlets/JSPs etc.Also the loading of the data could support different options: load with/without contraints in place load using INSERT statements load using import load using import with a ResultSet class.OE allows the amount of data loaded initially to be varied very easily  just by setting the warehousescale factor  so a warehouse=1 creates a database of size N  and warehouse=100 a database of size 100N (roughly).This allows databases in the range 10-100Gb to be easily created.The general setup would that OE could be used as a function test  performance test  or stress test so it's seen as a toolkit.I hope also that the OE could be expanded beyond the TPC-C spec  for example: adding images (BLOBs) and descriptions (CLOBs) to the product ITEM table. adding triggers to send-email on various actions.These additions would be intended to test Derby functionality in a 'real-world' OLTP application.The top-level package under java/testing would be org.apache.derbyTesting.systemTests.oe,0,1
Convert jdbc4/TestJDBC40Exception.java to JUnit,TestJDBC40Exception is written in a JUnit-like style and could easily be converted into JUnit.,0,0
Convert jdbc4/TestDbMetaData.java to JUnit,Rewrite the test in JUnit using the utility methods added in DERBY-1976.,0,0
Misleading stack traces for exceptions raised by the JDBC 4.0 embedded driver,When the embedded driver raises an SQLException  its stack trace alwayssays it is created in SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA().This is not correct.At some point  SQLExceptionFactory40.getSQLException() set the stack traceof the SQLException to the stack trace of the non-SQLException that causedit  if there were one. This was probably done to mimic the behaviour ofEmbedSQLException  which overrides printStackTrace() to achieve thesame. Later  code was added to ferry arguments over DRDA. This code createda dummy exception which the old code interpreted as a non-SQLExceptionwhose stack trace should be used for the main exception. Therefore  allexceptions now have the same stack trace as the dummy exception created inwrapArgsForTransportAcrossDRDA().I think the best solution is not to set the stack trace explicitly  noteven when the SQLException is caused by a non-SQLException.EmbedSQLException overrides printStackTrace() because throwables in Java1.3 didn't have initCause()/getCause()  so it was the only way to preservethe original stack trace. Since the SQLExceptions in JDBC 4.0 haveinitCause()/getCause()  there is no reason why the JDBC4 driver shouldmimic EmbedSQLException's workaround for not having these methods.,0,0
Use a lower wait timeout in BlobClob4BlobTest,These test cases wait 60 seconds for a timeout: testLockingClob testLockingWithLongRowClob testLockingBlob testLockingWithLongRowBlobSince they run both in embedded and network client mode  BlobClob4BlobTest spends about eight minutes waiting for a timeout. Therefore  it would be good if its setUp() method lowered the timeout (and tearDown() reset it). TestJDBC40Exception shows how this could be achieved.,0,0
NullPointerException with LTRIM  RTRIM and 2-argument SUBSTR() call in GROUP BY clause.,The following query  which fails with a syntax error in 10.1.3 (because functions are not allowed in a GROUP BY expression for 10.1) fails with a NullPointerException in 10.2 and in the codeline (10.3):create table dt (vc varchar(30)); insert into dt values ('1928-09-21')  ('1903-12-08'); select substr(vc  3) from dt group by substr(vc  3); Result (on trunk) is:java.lang.NullPointerException at org.apache.derby.impl.sql.compile.TernaryOperatorNode.isEquivalent(TernaryOperatorNode.java:924) at org.apache.derby.impl.sql.compile.GroupByList.findGroupingColumn(GroupByList.java:244) at org.apache.derby.impl.sql.compile.VerifyAggregateExpressionsVisitor.skipChildren(VerifyAggregateExpressionsVisitor.java:146) at org.apache.derby.impl.sql.compile.TernaryOperatorNode.accept(TernaryOperatorNode.java:497) at org.apache.derby.impl.sql.compile.ResultColumn.accept(ResultColumn.java:1515) at org.apache.derby.impl.sql.compile.QueryTreeNodeVector.accept(QueryTreeNodeVector.java:159) at org.apache.derby.impl.sql.compile.SelectNode.bindExpressions(SelectNode.java:619) at org.apache.derby.impl.sql.compile.FromSubquery.bindExpressions(FromSubquery.java:262) at org.apache.derby.impl.sql.compile.FromList.bindExpressions(FromList.java:337) at org.apache.derby.impl.sql.compile.SelectNode.bindExpressions(SelectNode.java:500) at org.apache.derby.impl.sql.compile.DMLStatementNode.bindExpressions(DMLStatementNode.java:249) at org.apache.derby.impl.sql.compile.DMLStatementNode.bind(DMLStatementNode.java:162) at org.apache.derby.impl.sql.compile.CursorNode.bind(CursorNode.java:253) at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:345) at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:119) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:745) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:568) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:517),0,0
ArrayIndexOutOfBoundsException for COALESCE with aggregate functions,The following statements produce an ArrayIndexOutOfBoundsException:CREATE TABLE t1 ( f1 INTEGER);SELECT COALESCE(MAX(f1) 0) FROM t1;Workaround: VALUES COALESCE( (SELECT MAX(f1) FROM t1)  0);Stack trace:----------------------------------------------------------------2006-10-29 14:52:53.765 GMT: Booting Derby version The Apache Software Foundation - Apache Derby - 10.2.1.6 - (452058): instance c013800d-010e-948f-0faa-00000012f418on database directory C:/temp_sys/temp_Derby_TestErr_dbDatabase Class Loader started - derby.database.classpath=''2006-10-29 14:53:02.906 GMT Thread&#91;main 5 main&#93; (XID = 122)  (SESSIONID = 0)  (DATABASE = c:/temp_sys/temp_Derby_TestErr_db)  (DRDAID = null)  Cleanup action starting2006-10-29 14:53:02.906 GMT Thread&#91;main 5 main&#93; (XID = 122)  (SESSIONID = 0)  (DATABASE = c:/temp_sys/temp_Derby_TestErr_db)  (DRDAID = null)  Failed Statement is: SELECT COALESCE(MAX(f1) 0) FROM t1java.lang.ArrayIndexOutOfBoundsException: -1 at org.apache.derby.impl.services.bytecode.BCMethod.popStack(Unknown Source) at org.apache.derby.impl.services.bytecode.BCMethod.callMethod(Unknown Source) at org.apache.derby.impl.sql.compile.ResultColumnList.generateCore(Unknown Source) at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(Unknown Source) at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(Unknown Source) at org.apache.derby.impl.sql.compile.ScrollInsensitiveResultSetNode.generate(Unknown Source) at org.apache.derby.impl.sql.compile.CursorNode.generate(Unknown Source) at org.apache.derby.impl.sql.compile.StatementNode.generate(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source) at org.apache.derby.impl.tools.ij.Main14.main(Unknown Source) at org.apache.derby.tools.ij.main(Unknown Source),0,0
NullPointerException in CREATE VIEW ... VALUES NULL;,The following statement produces a NullPointerException: CREATE VIEW v1 (f1) AS VALUES NULL;Stack trace:----------------------------------------------------------------2006-10-30 12:39:31.750 GMT: Booting Derby version The Apache Software Foundation - Apache Derby - 10.2.1.6 - (452058): instance c013800d-010e-993b-512f-00000012f418on database directory C:/temp_sys/temp_Derby_TestErr_dbDatabase Class Loader started - derby.database.classpath=''2006-10-30 12:39:38.484 GMT Thread&#91;main 5 main&#93; (XID = 122)  (SESSIONID = 0)  (DATABASE = c:/temp_sys/temp_Derby_TestErr_db)  (DRDAID = null)  Cleanup action starting2006-10-30 12:39:38.484 GMT Thread&#91;main 5 main&#93; (XID = 122)  (SESSIONID = 0)  (DATABASE = c:/temp_sys/temp_Derby_TestErr_db)  (DRDAID = null)  Failed Statement is: CREATE VIEW v1 (f1) AS VALUES NULLjava.lang.NullPointerException at org.apache.derby.impl.sql.catalog.SYSCOLUMNSRowFactory.makeRow(Unknown Source) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.addDescriptorArray(Unknown Source) at org.apache.derby.impl.sql.execute.CreateViewConstantAction.executeConstantAction(Unknown Source) at org.apache.derby.impl.sql.execute.MiscResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source) at org.apache.derby.impl.tools.ij.Main14.main(Unknown Source) at org.apache.derby.tools.ij.main(Unknown Source),0,0
jdbcapi.LobStreamsTest runs only in client (not embedded) but its suite() method gives no reason why.,It's essential to document why such decisions were made  makes life easier for subsequent deveopers as they try to understand the code and why it is not being used to test embedded.,0,0
Setting a login timeout in client driver can lead to query timeout,Setting the login timeout by using DriverManager.setLoginTimeout(intseconds) also affects the amount of time the client driver is waitingfor a query to finish. For instance  setting the login timeout to 10seconds will result in any queries taking more than 10 seconds to failwith the following exception:Exception thrown: java.sql.SQLException: A communications error has been detected: Read timed out.java.sql.SQLException: A communications error has been detected: Read timed out. at org.apache.derby.client.am.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:46) at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:345) at org.apache.derby.client.am.Statement.executeQuery(Statement.java:414) at LoginTimeout.main(LoginTimeout.java:53)Caused by: org.apache.derby.client.am.DisconnectException: A communications error has been detected: Read timed out. at org.apache.derby.client.net.NetAgent.throwCommunicationsFailure(NetAgent.java:408) at org.apache.derby.client.net.Reply.fill(Reply.java:176) at org.apache.derby.client.net.Reply.ensureALayerDataInBuffer(Reply.java:215) at org.apache.derby.client.net.Reply.readDssHeader(Reply.java:317) at org.apache.derby.client.net.Reply.startSameIdChainParse(Reply.java:1147) at org.apache.derby.client.net.NetStatementReply.readPrepareDescribeOutput(NetStatementReply.java:51) at org.apache.derby.client.net.StatementReply.readPrepareDescribeOutput(StatementReply.java:40) at org.apache.derby.client.net.NetStatement.readPrepareDescribeOutput_(NetStatement.java:139) at org.apache.derby.client.am.Statement.readPrepareDescribeOutput(Statement.java:1341) at org.apache.derby.client.am.Statement.flowExecute(Statement.java:1977) at org.apache.derby.client.am.Statement.executeQueryX(Statement.java:420) at org.apache.derby.client.am.Statement.executeQuery(Statement.java:405) ... 1 moreCaused by: java.net.SocketTimeoutException: Read timed out at java.net.SocketInputStream.socketRead0(Native Method) at java.net.SocketInputStream.read(SocketInputStream.java:129) at org.apache.derby.client.net.Reply.fill(Reply.java:174) ... 11 more,0,0
'set schema sys' followed by 'show tables' does not show tables in sys schema,If you create a new database in IJ  followed by 'set schema sys' and then 'show tables'  ij shows no tables in the schema. This is because ij's show tables command only shows system tables if a schema is provided.,0,0
provide checking tool to flag possible errors in message translations,It would be useful to have a tool available that flags possible translation file issues  such as: missing translations for (new) English messages mismatched parameters between English and non-English messages translation of keywords quoting problems (i.e. use of double quotes when single quotes should be used  use of single quotes when double quotes should be used. This is based on what's described in the MessageFormat api doc) mismatched characters such as &lt; (when meaning smaller than)  &gt; (when meaning larger than)  % etc. identification of invalid characters  specifically characters in the range of 0x00-0x1f (which are ASCII) and 0x7f-0xffNote that such a tool cannot be definite (except about the missing messages) because the English messages are not following very strict formatting  and because what's acceptable syntax/grammar in one language may not work in another. A discussion about a first cut at such a tool can be found at:http://comments.gmane.org/gmane.comp.apache.db.derby.devel/32187,0,0
Setting derby.database.classpath to contain installed jars causes the database to be unbootable when a Securitymanager is installed.,If the jars are sucessfully installed (without a security manager see DERBY-537) and the class path set then subsequent boots with a security manager fail with a SecurityException due to trying to install a class loader.Related to DERBY-537 but not the same.,1,0
Make class org.apache.derby.iapi.store.raw.PageKey final,The methods of the PageKey class are called frequently both from the lock manager and the cache manager. Since no other classes extend it  it should be declared final to help the run-time compiler optimize the method calls.,0,1
TestDataSourceFactory doesn't work correctly outside the old harness,TestDataSourceFactory uses TestUtil to create DataSource  ConnectionPoolDataSource and XADataSource objects. TestUtil needs to run in the old harness in order to detect which framework it is running under  so it will create embedded data sources for all JUnit tests that are run outside the old harness.,0,0
LangScripts JUnit test fails in views.sql,LangScripts JUnit test fails in views.sqlThere was 1 failure:1) views(org.apache.derbyTesting.functionTests.tests.lang.LangScripts )junit.framework.ComparisonFailure: Output at line 104 expected:&lt;...T1' because VIEW 'SV&#91;1&#93;' is dependent on th...&gt; but was:&lt;...T1' because VIEW 'SV&#91;2&#93;' is dependent on th...&gt; at org.apache.derbyTesting.functionTests.util.CanonTestCase.compareCanon(CanonTestCase.java:100) at org.apache.derbyTesting.functionTests.util.ScriptTestCase.runTest(ScriptTestCase.java:117) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:76) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)FAILURES!!!Tests run: 2016  Failures: 1  Errors: 0Some observations:If org.apache.derbyTesting.functionTests.tests.lang.LangScripts is used to run views.sql as a single test  then it ran smoothly without a problem..Time: 7.109OK (1 test)But if views.sql is run as part of a suite  then the ordering diff occurs.,0,0
JDBC.assertRowInResultSet compares the wrong value if using trimmed strings and a SMALLINT column exists.,There is a bug in assertRowInResultSet where a path through the loop does not set the variable obj.This leads to it being compared with the previous value.Using locally scoped variables within the loop would have most likely caught this bug at development time.Then the compiler sees that obj has one uninitialzed path through the code and throws an error.,0,0
Rewrite 'derbynet/SuicideOfStreaming' to a JUnit test,The test 'derbynet/SuicideOfStreaming' should be rewritten to a JUnit test more in line with our newly created test system.It is one of the last tests still being run from the deprecated 'tests/junitTests/' directory  through a wrapper class.,0,0
NullPointerException when two threads load sort factory concurrently,12:34:45 323 ERROR &#91;pool-1-thread-3&#93; history.helpers.HistoryDataAccessHelper - failed to read measurements  filter = (fromTime=Mon Nov 06 12:34:00 MSK 2006  toTime=Mon Nov 13 12:34:00 MSK 2006    properties=2-6-2-value) org.springframework.jdbc.UncategorizedSQLException: PreparedStatementCallback; uncategorized SQLException for SQL &#91;SELECT COUNT(DISTINCT sshis.measurement_time) FROM sshis_property_measurement sshis INNER JOIN sstmp_filter_3 filtertbl ON sshis.property_id = filtertbl.property_id WHERE sshis.measurement_time &gt;= ? AND sshis.measurement_time &lt; ?&#93;; SQL state &#91;XJ001&#93;; error code &#91;0&#93;; Java exception:': java.lang.NullPointerException'.; nested exception isorg.apache.derby.impl.jdbc.EmbedSQLException: Java exception: ': java.lang.NullPointerException'.java.lang.NullPointerException at java.util.Hashtable.put(Unknown Source) at org.apache.derby.impl.store.access.RAMAccessManager.registerAccessMethod(Unknown Source) at org.apache.derby.impl.store.access.RAMAccessManager.findMethodFactoryByImpl(Unknown Source) at org.apache.derby.impl.store.access.RAMTransaction.createSort(UnknownSource) at org.apache.derby.impl.sql.execute.DistinctScalarAggregateResultSet.loadSorter(Unknown Source) at org.apache.derby.impl.sql.execute.DistinctScalarAggregateResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeQuery(Unknown Source) at org.springframework.jdbc.core.JdbcTemplate$1.doInPreparedStatement(JdbcTemplate.java:535) at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:476) at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:528) at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:561) at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:579) at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:589) at org.springframework.jdbc.core.JdbcTemplate.queryForObject(JdbcTemplate.java:619) at org.springframework.jdbc.core.JdbcTemplate.queryForObject(JdbcTemplate.java:629) at org.springframework.jdbc.core.JdbcTemplate.queryForInt(JdbcTemplate.java:656) at com.meshnetics.wsn.ctrl.dispatcher.services.history.helpers.MeasurementsSaveGetHelper.getMeasurements(MeasurementsSaveGetHelper.java:81) at com.meshnetics.wsn.ctrl.dispatcher.services.history.helpers.HistoryDataAccessHelper$7.doInTransaction(HistoryDataAccessHelper.java:315) at com.meshnetics.wsn.ctrl.dispatcher.services.history.helpers.HistoryDataAccessHelper$7.doInTransaction(HistoryDataAccessHelper.java:314) at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:117) at com.meshnetics.wsn.ctrl.dispatcher.services.history.helpers.HistoryDataAccessHelper.getMeasurements(HistoryDataAccessHelper.java:313) at com.meshnetics.wsn.ctrl.dispatcher.services.history.asyncread.MeasurementsReadTask.executeTask(MeasurementsReadTask.java:127) at com.meshnetics.wsn.ctrl.dispatcher.services.history.asyncread.MeasurementsReadTask.run(MeasurementsReadTask.java:97) at java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source) at java.util.concurrent.FutureTask$Sync.innerRun(Unknown Source) at java.util.concurrent.FutureTask.run(Unknown Source) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source) at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source) at java.lang.Thread.run(Unknown Source),0,0
store/BootAllTest.junit fails on wctme5.7 foundation  on 10.2,Fails on 10.2. wctme5.7 foundation                 Diff file derbyall/storeall/storemore/BootAllTest.diff             Start: BootAllTest jdkJ2ME Foundation Specification v1.0 storeall:storemore 2006-11-04 03:55:56 ***0 add&gt; .E&gt; There was 1 error:&gt; 1) testSettingBootAllPropertyWithHomePropertySet(org.apache.derbyTesting.functionTests.tests.store.BootAllTest)java.lang.NoClassDefFoundError: java.sql.DriverManager&gt; FAILURES!!!&gt; Tests run: 1  Failures: 0  Errors: 1Test Failed. End: BootAllTest jdkJ2ME Foundation Specification v1.0 storeall:storemore 2006-11-04 03:56:14 ***,0,0
After a Lexical Error due to syntax error      even a simple create table does not work  on the same connection.,connect 'jdbc:derby:wombat;create=true';create table t1(a int ) ;create table 't2'(a int ) ;&#8211; this should fail. create table foo (a int   /'YEAR/' int ) ;&#8211; but this should not fail. But failingcreate table t4 ( b int ) ;FYI:$ java org.apache.derby.tools.ijij version 10.3ij&gt; run 'weird1.sql';ij&gt; connect 'jdbc:derby:wombat;create=true';ij&gt; create table t1(a int ) ;0 rows inserted/updated/deletedij&gt; create table 't2'(a int ) ;0 rows inserted/updated/deletedij&gt; &#8211; this should fail.create table foo (a int   /'YEAR/' int ) ;ERROR 42X02: Lexical error at line 2  column 28. Encountered: '' (92)  after: ''.ij&gt; &#8211; but this should not fail. But failingcreate table t4 ( b int ) ;ERROR 42X01: Syntax error: Encountered '' at line 2  column 21.ij&gt;,0,0
Implement SSL/TLS communication between client and server,Implement SSL/TLS communication between client and server,1,0
Let Clock embed a HashMap rather than inherit from Hashtable,Clock currently inherits from Hashtable  but the use of Hashtable is really an implementation detail that would benefit from being hidden as private member. All access to the hashtable happens inside sychronized blocks so it is safe to substitute a HashMap. This change appears to trigger a small increase in throughput  as measured by the average TPS number obtained by running the select client from DERBY-1961 repeatedly.,0,1
Test files missing svn:eol-style,The following files don't have the svn:eol-style property:functionTests/harness/ibm15.javafunctionTests/tests/i18n/MessageBundleTest.javafunctionTests/tests/store/LogDeviceTest.javafunctionTests/tests/storetests/st_derby1189.sqlfunctionTests/tests/tools/IJRunScriptTest.javajunit/SystemPropertyTestSetup.java,0,0
Intermittent failure in lang/compressTable.sql,lang/compressTable.sql has failed a number of times in the nightly regression tests. The diffs vary slightly:http://dbtg.thresher.com/derby/test/trunk15/jvm1.5/testing/testlog/Linux-2.6.9-34.ELsmp_x86_64-x86_64/476241-derbylang_diff.txthttp://dbtg.thresher.com/derby/test/trunk15/jvm1.5/testing/testlog/CYGWIN_NT-5.1_i686-unknown/476241-derbyall_diff.txt                 Diff file derbylang/derbylang/compressTable.diff             Start: compressTable jdk1.5.0_07 derbylang:derbylang 2006-11-17 20:10:12 ***1318 del&lt; T1 |1 |2 1318a1318&gt; T1 |3 |0 Test Failed. End: compressTable jdk1.5.0_07 derbylang:derbylang 2006-11-17 20:10:39 ***    http://dbtg.thresher.com/derby/test/trunk15/jvm1.5/testing/testlog/CYGWIN_NT-5.1_i686-unknown/476584-derbyall_diff.txt                 Diff file derbyall/derbylang/compressTable.diff             Start: compressTable jdk1.5.0_05 derbyall:derbylang 2006-11-18 23:07:44 ***1318 del&lt; T1 |1 |2 1318a1318&gt; T1 |2 |1 Test Failed. End: compressTable jdk1.5.0_05 derbyall:derbylang 2006-11-18 23:08:11 ***,0,0
Change some boundary checks in ArrayInputStream to ASSERTs to improve performance,Profiling shows that a significant amount of CPU is spent doing boundary checking in ArrayInputStream.setPosition() and ArrayInputStream.setLimit(). These checks appear to be there to detect error conditions  so it seems more appropriate to make them ASSERTs. Especially since they are so expensive.DTrace analysis seems to confirm that these methods get called very frequently:Knut Anders Hatlen wrote the following in a message on derby-dev:FYI  I just ran the DERBY-1961 test clients and traced them with aDTrace script that printed how often each method was called. For thejoin client  ArrayInputStream.setPosition() was the most frequentlycalled method (43837.7 calls/tx). For the single-record select client it was third (58.4 calls/tx)  only beaten by Object.&lt;init&gt;() andDDMWriter.ensureLength(). I think this means that setPosition() is theengine method that is most frequently called  at least in read-mostlytransactions. ArrayInputStream.setLimit() also appeared near the topof the list. See http://wiki.apache.org/db-derby/Derby1961MethodCallsfor the details.,0,1
Add long running System test for Derby,I will use this place to add 2 long running system tests for Derby.,0,0
Replace Vectors and Hashtables with ArrayLists and HashMaps in RAMTransaction,In org.apache.derby.impl.store.access.RAMTransaction  synchronized collection objects could be replaced with unsynchronized ones. See discussion here: http://www.nabble.com/Use-of-synchronized-containers-in-engine-code-tf2754469.html,0,1
Reduce use of synchronized collections in GenericLanguageConnectionContext,In org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext  it is probably safe to replace some of the synchronized collections with unsynchronized ones. This should be investigated  and the unnecessary synchronization should be removed. See discussion here: http://www.nabble.com/Use-of-synchronized-containers-in-engine-code-tf2754469.html,0,1
suites.All falls over with foundation after revision 482433; java.lang.NoClassFoundError: javax.xml.parsers.DocumentBuilderFactory,When attempting to run:&lt;j9binpath&gt;/j9 -jcl:foun10 -Dderby.system.home=&lt;testhome&gt; -DderbyTesting.serverhost=localhost -DderbyTesting.clienthost=localhost -DderbyTesting.codeclasses=file:/&lt;classesdir&gt;/ -DderbyTesting.junit=file://unused -DderbyTesting.antjunit=file://unused -Djava.security.policy=file:/&lt;classesdir&gt;/org/apache/derbyTesting/functionTests/util/derby_tests.policy -Xbootclasspath/a:&lt;j9libpath&gt;/jdbc.jar -cp &lt;classesdir&gt;;junit.jar junit.textui.TestRunner org.apache.derbyTesting.functionTests.suites.All The textui.TestRunner keels over with the following error:Failed to invoke suite():java.lang.NoClassDefFoundError: javax.xml.parsers.DocumentBuilderFactoryThis happens after  but not before revision 482433.,0,0
message XSDB8 and 42Y32 have references to db2j,trunk/messages.xml shows two messages that incorrectly refer to db2j:42Y32=Aggregator class ''{0}'' for aggregate ''{1}'' on type {2} does not implement com.ibm.db2j.aggregates.Aggregator. There is now no class Aggregator in Derby. This message is generated from the class: org.apache.derby.impl.sql.compile.AggregateNode.java. private void checkAggregatorClassName(String className) throws StandardException { className = verifyClassExist(className  false); if (!classInspector.assignableTo(className  'org.apache.derby.iapi.sql.execute.ExecAggregator')) { throw StandardException.newException (SQLState.LANG_BAD_AGGREGATOR_CLASS2  className  aggregateName  operand.getTypeId().getSQLTypeName()); } }The original in Cloudscape had a reference to an Aggregator class  the if looked like this: if (!classInspector.assignableTo(className  'com.ibm.db2j.aggregates.Aggregator') &amp;&amp; !classInspector.assignableTo  (className  'com.ibm.db2j.protocol.Database.Language.Execution.ExecAggregator')) { throw StandardException.newException(SQLState.LANG_BAD_AGGREGATOR_CLASS2   ....Maybe the message now needs to mention org.apache.derby.iapi.sql.execute.ExecAggregator?But  I think maybe this message cannot be obtained unless someone introduces a bug within the Derby code. I think the reference to another internal class should be removed. Or maybe the text of Cloudscape message 42Y31 can be used: 42Y31=LANG_BAD_AGGREGATOR_CLASS='Aggregator class ''{0}'' for aggregate ''{1}'' on type {2} is inaccessable or does not exist.'XSDB8.D=DATA_MULTIPLE_JBMS_FORCE_LOCK ='WARNING: Derby (instance {0}) is attempting to boot the database {1} even though Derby (instance {2}) may still be active. Only one instance of Derby should boot a database at a time. Severe and non-recoverable corruption can result if 2 instances of Derby boot on the same database at the same time. The db2j.database.forceDatabaseLock=true property has been set  so the database will not boot until the db.lck is no longer present. Normally this file is removed when the first instance of Derby to boot on the database exits  but it may be left behind in some shutdowns. It will be necessary to remove the file by hand in that case. It is important to verify that no other VM is accessing the database before deleting the db.lck file by hand.'John Embretsen commented on this in DERBY-1838:https://issues.apache.org/jira/browse/DERBY-1838#action_12434090Indicating that not only should the message refer to derby.database.forceDatabaseLock  but the replacement of parameters is not happening either. But I can not find a place where this message is generated  so maybe it can just be removed.,0,0
Trigger recompilation problem when trigger action has its table not qualified with a schema,Trigger recompilation problem when trigger action has its table not qualified with a schema.SPSs in SYS.SYSSTATEMENTS get invalidated for recompilation when sqlj.install_jar  sqlj.remove_jar  sqlj.replace_jar are called  or when a database upgrade is performed. The problem arises when the trigger action statement does not qualify the table with an explicit schema name. During recompilation it uses the default schema instead of using the original schema that was persisted in SYS.SYSSTATEMENTS causing an exception to occur. e.g.:C:/derby/trunk&gt;java -classpath classes;. org.apache.derby.tools.ijij version 10.3ij&gt; connect 'jdbc:derby:wombat;create=true';ij&gt; create table app.t1 (i int  j int);0 rows inserted/updated/deletedij&gt; insert into app.t1 values (1 10);1 row inserted/updated/deleted&#8211; notice trigger action's update statement did not qualify table t1 with a schema nameij&gt; create trigger app.tr1 after update of i on app.t1 update t1 set j = 1;0 rows inserted/updated/deletedij&gt; update app.t1 set i=i+1;1 row inserted/updated/deletedij&gt; select * from app.t1;I |J-----------------------2 |11 row selected&#8211; this action invalidates the SPS and mark for recompilationij&gt; call sqlj.install_jar('c:/derby/procs/Procs.jar'  'APP.Procs'  0);0 rows inserted/updated/deletedij&gt; disconnect;ij&gt; connect 'jdbc:derby:wombat' user 'user1';&#8211; recompilation occurs but uses 'USER1' as the schema to compile instead of 'APP'  resulting in errorij&gt; update app.t1 set i=i+1;ERROR 42Y07: Schema 'USER1' does not existij&gt;,0,0
Nested triggers not working properly after maximum trigger count exception is thrown,After the maximum allowed nested trigger exception is thrown  subsequent statement that result in nested trigger execution may result in the same error again even though it does not exceed the limit of nested triggers(16).e.g.:C:/derby/trunk&gt;java -classpath classes;. org.apache.derby.tools.ijij version 10.3ij&gt; connect 'jdbc:derby:wombat;create=true';ij&gt; create table t1 (i int);0 rows inserted/updated/deletedij&gt; insert into t1 values 1 2 3;3 rows inserted/updated/deletedij&gt; create trigger tr1 after update on t1 for each row update t1 set i=i+1;0 rows inserted/updated/deleted&#8211; force the 'maximum depth of nested triggers' error to occurij&gt; update t1 set i=i+1;ERROR 54038: Maximum depth of nested triggers was exceeded.ij&gt; drop trigger tr1;0 rows inserted/updated/deletedij&gt; create trigger tr1 after update on t1 referencing old as oldt for each row update t1 set i=i+1 where oldt.i=2;0 rows inserted/updated/deleted&#8211; this should have executed successfully instead of throwing the same error again!ij&gt; update t1 set i=i+1;ERROR 54038: Maximum depth of nested triggers was exceeded.ij&gt; disconnect;ij&gt; connect 'jdbc:derby:wombat';ij&gt; select * from t1;I-----------1233 rows selected&#8211; ok after reconnection  it looks like the trigger execution context(TEC) may not have been cleanup properly in the previous connectionij&gt; update t1 set i=i+1;3 rows inserted/updated/deletedij&gt; select * from t1;I-----------4563 rows selectedij&gt;,0,0
Add performance tests to Derby using the junit perf framework,There is a simple performance junit framework that has been added as part of derby-1970. There are a number of improvements suggested for derby-1970  please see DERBY-1970.This jira is to add new performance tests to derby so that these tests are easily available for anyone to run   report issues  fix issues etc..,0,0
DROP PROCEDURE depends on SET SCHEMA,This is possibly related to Bug https://issues.apache.org/jira/browse/DERBY-1304.Use ij to execute the following statements:CREATE SCHEMA datamgmt;CREATE PROCEDURE datamgmt.exit ( IN value INTEGER ) MODIFIES SQL DATA PARAMETER STYLE JAVA LANGUAGE JAVA EXTERNAL NAME 'java.lang.System.exit';DROP PROCEDURE datamgmt.exit;DROP SCHEMA datamgmt RESTRICT;Then execute exactly the same lines once again. Then statement 'DROP PROCEDURE datamgmt.exit' yields:ERROR 42X94: PROCEDURE 'EXIT' does not exist.However  if the DROP works if a default schema (SET SCHEMA) is used instead of the prefixed schemaName. That is  the following lines can be executed more than once in a row:CREATE SCHEMA datamgmt;CREATE PROCEDURE datamgmt.exit ( IN value INTEGER ) MODIFIES SQL DATA PARAMETER STYLE JAVA LANGUAGE JAVA EXTERNAL NAME 'java.lang.System.exit';SET SCHEMA datamgmt;DROP PROCEDURE exit;DROP SCHEMA datamgmt RESTRICT;Therefore  SET SCHEMA can be used as a workaround  hence minor importance.,0,0
java/testing/README.htm needs to be updated with information on JUnit tests,Currently  the testing readme at java/testing/README.htm does not contain any information on running or developing Derby junit tests. This document should at least be updated with information on how to run Derby's junit tests. A description of the top-level suites and running the Ant junitreport target would be a good start.,0,0
Uncommitted transactions executed throught XAResource will held locks after the application terminates (or crashes during the transaction).,Using this piece of code derby will not release a table lock of 'dummy' table. String query = 'insert into dummy (field1) values ('' + Integer.toString(value) + '')'; XAConnection xaConnection = createXAConnection('jdbc:derby://localhost:1527/TestDB'  ''  ''); XAResource xaResource = xaConnection.getXAResource(); conn = xaConnection.getConnection(); Xid xid = createXid(value);  xaResource.setTransactionTimeout(10); xaResource.start(xid  XAResource.TMNOFLAGS); Statement statement = conn.createStatement(); statement.execute(query);  // terminate the client application // this will not release any locks System.exit(0);,0,1
'show indexes in SCHEMANAME' does not work with the client driver,The ij command 'show indexes in SCHEMANAME' does not work at all with the client driver.It does work with the embedded driver.Sample output from ij:ij&gt; connect 'jdbc:derby://localhost/myDB;create=true';ij&gt; create table test (id int primary key);0 rows inserted/updated/deletedij&gt; show indexes in app;ERROR XJ103: Table name can not be nullij&gt; show indexes from test;TABLE_NAME |COLUMN_NAME |NON_U&amp;|TYPE|ASC&amp;|CARDINA&amp;|PAGES----------------------------------------------------------------------------TEST |ID |0 |3 |A |NULL |NULL1 row selectedij&gt; show indexes from app.test;TABLE_NAME |COLUMN_NAME |NON_U&amp;|TYPE|ASC&amp;|CARDINA&amp;|PAGES----------------------------------------------------------------------------TEST |ID |0 |3 |A |NULL |NULL1 row selectedij&gt;Using delimited table and/or schema names does not work  but I think this is according to documentation.I.e.:ij&gt; show indexes from 'TEST';ERROR 42X01: Syntax error: Encountered 'show' at line 1  column 1.ij&gt; show indexes from 'APP'.test;ERROR 42X01: Syntax error: Encountered 'show' at line 1  column 1.ij&gt; show indexes from 'APP'.'TEST';ERROR 42X01: Syntax error: Encountered 'show' at line 1  column 1.ij&gt;,0,0
Let BasePage.fetchFieldFromSlot use the special single-col FetchDescriptor ctor,BasePage.fetchFieldFromSlot needs to construct a FetchDescriptor with single column. To do this it creates a FormatableBitSet that identifies the correct column and then passes this bitset to the FetchDescriptor constructor. But FetchDescriptor has a special constructor for the single column case  that doesn't need a bitset. Using this constructor instead makes the code simpler  and presumably more efficient as well.,0,0
Test harness should support J2ME 1.1,I would like to enable the 'old' test harness to support the new version of IBM's j2ME implementation  which is based on j2ME jdk spec version 1.1. This is available with a product named Websphere Everyplace Micro Edition 6.1. from IBM.We already support j9_foundation  which matches to j2ME jdk spec 1.0. I'd like to add j9_foundation11  which then matches to j2ME jdk spec 1.1.I'm proposing to switch my automated tests over to the newer version going forward  and to minimize complexity of the change  I'd like to make the canons reflect behavior of the new version. The differences are minimal. However  I want to be able to still run with the old (except where the results differ  failures would occur with the old version).One of the reasons for moving to the new version is that there is a bug with the older version in regards to security manager  preventing a smooth run of the junit tests  and I'd like to run all short-running tests (suites.All and derbyall) with at least one of the versions. Another reason is that the j2ME spec 1.0 is really old.,0,0
compatibilitytest fails after DERBY-2121 change.,Client-server compatibility testing with JVM 1.3 is not relevant on trunk/10.3 following DERBY-2121See e.g. http://dbtg.thresher.com/derby/test/tinderbox_trunk15/jvm1.5/testing/Limited/testSummary-495558.htmlhttp://dbtg.thresher.com/derby/test/trunk15/jvm1.5/testing/Limited/testSummary-495683.html,0,0
Assert during log file switch: log file position exceeded max log file size,When running simple tpc-b like transactions against a embedded Derby based on a SANE build of trunk the following assertion occurs for the background thread and all user threads: org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED log file position exceeded max log file sizeThis seems to occur during a switch to a new log file.derby.log contains the following call stack for the background thread:Exception trace: org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED log file position exceeded max log file size at org.apache.derby.shared.common.sanity.SanityManager.ASSERT(SanityManager.java:120) at org.apache.derby.impl.store.raw.log.LogCounter.makeLogInstantAsLong(LogCounter.java:120) at org.apache.derby.impl.store.raw.log.LogToFile.switchLogFile(LogToFile.java:1900) at org.apache.derby.impl.store.raw.log.LogToFile.appendLogRecord(LogToFile.java:3530) at org.apache.derby.impl.store.raw.log.FileLogger.logAndDo(FileLogger.java:345) at org.apache.derby.impl.store.raw.xact.Xact.logAndDo(Xact.java:1185) at org.apache.derby.impl.store.raw.log.LogToFile.checkpointWithTran(LogToFile.java:1540) at org.apache.derby.impl.store.raw.log.LogToFile.checkpoint(LogToFile.java:1357) at org.apache.derby.impl.store.raw.RawStore.checkpoint(RawStore.java:439) at org.apache.derby.impl.store.raw.log.LogToFile.performWork(LogToFile.java:3416) at org.apache.derby.impl.services.daemon.BasicDaemon.serviceClient(BasicDaemon.java:331) at org.apache.derby.impl.services.daemon.BasicDaemon.work(BasicDaemon.java:668) at org.apache.derby.impl.services.daemon.BasicDaemon.run(BasicDaemon.java:394) at java.lang.Thread.run(Thread.java:619)2007-01-17 23:09:48.638 GMT Thread&#91;derby.rawStoreDaemon 5 derby.daemons&#93; Cleanup action startingorg.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED log file position exceeded max log file size at org.apache.derby.shared.common.sanity.SanityManager.ASSERT(SanityManager.java:120) at org.apache.derby.impl.store.raw.log.LogCounter.makeLogInstantAsLong(LogCounter.java:120) at org.apache.derby.impl.store.raw.log.LogToFile.switchLogFile(LogToFile.java:1900) at org.apache.derby.impl.store.raw.log.LogToFile.appendLogRecord(LogToFile.java:3530) at org.apache.derby.impl.store.raw.log.FileLogger.logAndDo(FileLogger.java:345) at org.apache.derby.impl.store.raw.xact.Xact.logAndDo(Xact.java:1185) at org.apache.derby.impl.store.raw.log.LogToFile.checkpointWithTran(LogToFile.java:1540) at org.apache.derby.impl.store.raw.log.LogToFile.checkpoint(LogToFile.java:1357) at org.apache.derby.impl.store.raw.RawStore.checkpoint(RawStore.java:439) at org.apache.derby.impl.store.raw.log.LogToFile.performWork(LogToFile.java:3416) at org.apache.derby.impl.services.daemon.BasicDaemon.serviceClient(BasicDaemon.java:331) at org.apache.derby.impl.services.daemon.BasicDaemon.work(BasicDaemon.java:668) at org.apache.derby.impl.services.daemon.BasicDaemon.run(BasicDaemon.java:394) at java.lang.Thread.run(Thread.java:619)Cleanup action completedFor my user threads the call stack is similar:Database Class Loader started - derby.database.classpath=''2007-01-17 23:09:36.401 GMT Thread&#91;Thread-51 5 main&#93; (XID = 12632406)  (SESSIONID = 51)  (DATABASE = /export/home/tmp/derby-db)  (DRDAID = null)  Cleanup action starting2007-01-17 23:09:36.401 GMT Thread&#91;Thread-51 5 main&#93; (XID = 12632406)  (SESSIONID = 51)  (DATABASE = /export/home/tmp/derby-db)  (DRDAID = null)  Failed Statement is: UPDATE accounts SET abal = abal + ? WHERE aid = ? AND bid = ?org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED log file position exceeded max log file size at org.apache.derby.shared.common.sanity.SanityManager.ASSERT(SanityManager.java:120) at org.apache.derby.impl.store.raw.log.LogCounter.makeLogInstantAsLong(LogCounter.java:120) at org.apache.derby.impl.store.raw.log.LogToFile.switchLogFile(LogToFile.java:1900) at org.apache.derby.impl.store.raw.log.LogToFile.appendLogRecord(LogToFile.java:3530) at org.apache.derby.impl.store.raw.log.FileLogger.logAndDo(FileLogger.java:345) at org.apache.derby.impl.store.raw.xact.Xact.logAndDo(Xact.java:1185) at org.apache.derby.impl.store.raw.data.LoggableActions.doAction(LoggableActions.java:221) at org.apache.derby.impl.store.raw.data.LoggableActions.actionUpdate(LoggableActions.java:85) at org.apache.derby.impl.store.raw.data.StoredPage.doUpdateAtSlot(StoredPage.java:8521) at org.apache.derby.impl.store.raw.data.BasePage.updateAtSlot(BasePage.java:1108) at org.apache.derby.impl.store.access.conglomerate.GenericConglomerateController.replace(GenericConglomerateController.java:479) at org.apache.derby.impl.sql.execute.RowChangerImpl.updateRow(RowChangerImpl.java:523) at org.apache.derby.impl.sql.execute.UpdateResultSet.collectAffectedRows(UpdateResultSet.java:566) at org.apache.derby.impl.sql.execute.UpdateResultSet.open(UpdateResultSet.java:260) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:358) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1182) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1652) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:299) at com.sun.derby.perf.clients.tpcb.DBConnection.performTransaction(DBConnection.java:595) at com.sun.derby.perf.clients.tpcb.Client.run(Client.java:218)After this it seems like no user threads are able to connect to the database (not surpricing).This happend using a SANE build and I am unsure by just looking at the assertion in the code whether this situation would have been fatal also if I had been using an INSANE build.,1,0
DatabaseMetaData.getTypeInfo() does not list supported Derby SQL types correctly.,These types are returned but not supported by Derby.LONG NVARCHARNATIONAL CHARNATIONAL CHAR VARYINGThe XML type is supported by Derby but not returned.,0,0
DatabaseMetaData.getTypeInfo returns incorrect MAXIMUM_SCALE value for DECIMAL and NUMERIC types,Maximum scale is returned as 32767 but maximum scale for numerics is 31.,0,0
bad logic in jvm:guessWSHome() in old test harness affects j9 runs,Running derbyall using either wcmte5.7_foundation or weme6.1 results in the following stack trace.Exception in thread 'main' java.lang.StringIndexOutOfBoundsException at java.lang.String.substring(String.java:1043) at org.apache.derbyTesting.functionTests.harness.jvm.guessWSHome(jvm.java:301) at org.apache.derbyTesting.functionTests.harness.jvm.getSecurityProps(jvm.java:356) at org.apache.derbyTesting.functionTests.harness.jvm.setSecurityProps(jvm.java:336) at org.apache.derbyTesting.functionTests.harness.RunTest.buildTestCommand(RunTest.java:2350) at org.apache.derbyTesting.functionTests.harness.RunTest.testRun(RunTest.java:498) at org.apache.derbyTesting.functionTests.harness.RunTest.main(RunTest.java:368)I think this code was not reached until various security related changes recently  but the code is just bad.I think this code was used at one point to attempt to kick off another jvm to run a server with  but that is now defunct.Rather than try to make the code work  or try to clean it up  I'd rather spend time converting tests to the junit framework  so I will just fix this up so we don't hit the error.The bad code is:  wshome = jhome.substring(0 jhome.indexOf(sep + 'jre')); wshome = wshome.substring(0 wshome.lastIndexOf(sep));If the jhome ( System.getProperty('java.home')) does not contain 'jre'  we will get -1 as the 2nd parameter in jhome.substring  and thus cause the ArrayIndexOutOfBounds.I propose to fix this piece of code as follows: int havejre=jhome.indexOf(sep + 'jre'); if (havejre &gt; 0) { wshome = jhome.substring(0 jhome.indexOf(sep + 'jre')); wshome = wshome.substring(0 wshome.lastIndexOf(sep)); } else wshome = jhome.substring(0 jhome.lastIndexOf(sep));,1,0
AccessControlException when exiting junit.swingui.TestRunner,When the JUnit tests are run with junit.swingui.TestRunner  one gets the following exception when the test runner window is closed:Exception in thread 'AWT-EventQueue-0' java.security.AccessControlException: access denied (java.io.FilePermission /home/kh160127/.junitsession write),1,0
Add a generic utility tool to drive the Order Entry load phase.,Add a generic utility program that can take in the driver name and the database connection url to populate the order entry database. Currently the load phase for OE is completed and hence this driver program should allow one to be able to populate the database.Maybe once OE run is completed  we can add the driving of the transactions also. This driver can be in org.apache.derbyTesting.system.oe.runsee DERBY-1987 and sub-tasks for details.,0,1
Missing sql script: '/org/apache/derbyTesting/functionTests/tests/lang/altertableDropColumn.sql',Seen since svn r503550 2007-02-05 06:02:19 CET.First occurence in http://dbtg.thresher.com/derby/test/tinderbox_trunk16/jvm1.6/testing/Limited/testSummary-503550.html .Also in http://dbtg.thresher.com/derby/test/Daily/jvm1.5/testing/Limited/testSummary-503767.html (all platforms except windows!?).derbyall/derbyall_fail.txt shows:------------------------------------------derbyall/derbyall:derbylang.fail:lang/altertableDropColumn.sql derbyall/derbyall_diff.txt does not show a diff.butderbyall.sum shows:---------------------------     Start: altertable jdk1.6.0 derbyall:derbylang 2007-02-05 06:38:55 *** End: altertable jdk1.6.0 derbyall:derbylang 2007-02-05 06:39:08 ***Could not locate lang/altertableDropColumn.sqlException in thread 'main' java.io.FileNotFoundException: /org/apache/derbyTesting/functionTests/tests/lang/altertableDropColumn.sql at org.apache.derbyTesting.functionTests.harness.RunTest.setDirectories(RunTest.java:701) at org.apache.derbyTesting.functionTests.harness.RunTest.main(RunTest.java:266)    On windows I found that derbyall.sum contained:-----------------------------------------------------------------     Start: altertable jdk1.5.0_07 derbyall:derbylang 2007-02-05 19:21:24 *** End: altertable jdk1.5.0_07 derbyall:derbylang 2007-02-05 19:21:55 ***Could not locate lang/altertableDropColumn.sqlException in thread 'main' java.io.IOException: The filename  directory name  or volume label syntax is incorrect at java.io.WinNTFileSystem.canonicalize0(Native Method) at java.io.Win32FileSystem.canonicalize(Win32FileSystem.java:395) at java.io.File.getCanonicalPath(File.java:531) at org.apache.derbyTesting.functionTests.harness.RunTest.addToListFile(RunTest.java:2187) at org.apache.derbyTesting.functionTests.harness.RunTest.addToFailures(RunTest.java:2159) at org.apache.derbyTesting.functionTests.harness.RunTest.setDirectories(RunTest.java:700) at org.apache.derbyTesting.functionTests.harness.RunTest.main(RunTest.java:266),0,0
compatibility/testScript.xml should include 10.2.2 in the server/client combinations,Add SERVER_10.2.2.0 and CLIENT_10.2.2.0 in the combinations to be tested.,0,0
Convert compatibility/testScript.xml to JUnit,I have started converting compatibility/testScript.xml to JUnit to1) be able to more dynamically specify which combinations to test  2) get standard JUnit reports from the test  and3) more easily include the compatibility test in the regression test runs.I plan to use a property file (patterened after the current ant.property file for the compatibility test)  to specify jvm and derby library locations.With the growing number of jvm and derby versions I also think that it should be possible to specify a number of different kinds of compatibility test combinations for example:a) the current way  which is all combinations of derby and jvm on both  server and client. &#91;(derbys*jvms)*(derbys*jvms)&#93;b) Current trunk client and jvms vs. all server derbys and jvms. &#91;(1*jvms)*(derbys*jvms)&#93;c) All clients and jvms vs. current trunk server and jvms. &#91;(derbys*jvms)*(1*jvms)&#93;d) Exact specification of the combinations to be tested. &#91;(N*M)*(X*Y)&#93;Which kind of test to run should be specified in the property file.,0,0
org.apache.derbyTesting.functionTests.suites.All is extremely CPU intensive since ~svn 507489,Run org.apache.derbyTesting.functionTests.suites.All.http://www.nabble.com/org.apache.derbyTesting.functionTests.suites.All-is-extremely-CPU-intensive%21-tf3230539.htmlSee e.g. http://dbtg.thresher.com/derby/test/tinderbox_trunk16/jvm1.6/testing/Limited/testSummary-507489.htmlhttp://dbtg.thresher.com/derby/test/trunk15/jvm1.5/testing/Limited/testSummary-507650.htmlThese logs also include thread dumps.,0,0
Accessing a BLOB column twice in an INSERT trigger leads to errors in the value on-disk,Either the BLOB is stored with the incorrect value or the value on disk does not match the stored length on disk and an exception is raised. The BLOB was supplied as a stream value.See this with the new TriggersTest. The text fixture will have a comment with this bug number showing how to reproduce the problem.,0,0
Use of XML values in the action statement of a trigger throw exceptions.,A trigger like  where V  V1 and V2 are columns of type XML will thrown an exception when fired.CREATE TRIGGER AIS AFTER INSERT ON T_MAIN  REFERENCING NEW_TABLE AS N FOR EACH STATEMENT  INSERT INTO T_ACTION_STATEMENT(A  V1  ID  V2)  SELECT 'I'  V  ID  V FROM NERROR 38000: The exception 'java.sql.SQLException: An attempt was made to get a data value of type 'java.lang.Object' from a data value of type 'XML'.' was thrown while evaluating an expression.Most likely because triggers are implementing using VTIs and hence JDBC ResultSets and XML is not supported through JDBC yet.TriggerTest shows this issue  see the comment with the bug number to reproduce.,0,0
ORDER BY with expression with distinct in the select list returns incorrect result,When distinct is in the select list and the query has order by with expression  the resultset produced contains an additional column. ij&gt; create table t1 (c1 int  c2 varchar(10))0 rows inserted/updated/deletedij&gt; insert into t1 values (1 'a') (2 'b') (3 'c');3 rows inserted/updated/deletedselect distinct c1  c2 from t1 order by c1;C1 |C2----------------------1 |a2 |b3 |c3 rows selectedij&gt; select distinct c1  c2 from t1 order by c1+1;C1 |C2 |3 &lt;=====returns 3 columns  incorrect result returned----------------------------------1 |a |22 |b |33 |c |43 rows selected,0,0
Unable to perform select query using DISTINCT on a read-only database,It is not possible to perform queries using DISTINCT on a read-only database packaged in a zip file. This generates the following error:ERROR 40XD1: Container was opened in read-only mode.  at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.impl.store.raw.data.BaseContainer.use(Unknown Source) at org.apache.derby.impl.store.raw.data.BaseContainerHandle.useContainer(Unknown Source) at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(Unknown Source) at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(Unknown Source) at org.apache.derby.impl.store.raw.xact.Xact.openContainer(Unknown Source) at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.addContainer(Unknown Source) at org.apache.derby.impl.store.raw.xact.Xact.addContainer(Unknown Source) at org.apache.derby.impl.store.access.heap.Heap.create(Unknown Source) at org.apache.derby.impl.store.access.heap.HeapConglomerateFactory.createConglomerate(Unknown Source) at org.apache.derby.impl.store.access.RAMTransaction.createConglomerate(Unknown Source) at org.apache.derby.iapi.store.access.DiskHashtable.&lt;init&gt;(Unknown Source) at org.apache.derby.iapi.store.access.BackingStoreHashtable.spillToDisk(Unknown Source) at org.apache.derby.iapi.store.access.BackingStoreHashtable.add_row_to_hash_table(Unknown Source) at org.apache.derby.iapi.store.access.BackingStoreHashtable.put(Unknown Source) at org.apache.derby.impl.store.access.btree.BTreeForwardScan.fetchRows(Unknown Source) at org.apache.derby.impl.store.access.btree.BTreeScan.fetchSet(Unknown Source) at org.apache.derby.impl.store.access.BackingStoreHashTableFromScan.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.store.access.RAMTransaction.createBackingStoreHashtableFromScan(Unknown Source) at org.apache.derby.impl.sql.execute.HashScanResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeQuery(Unknown Source) at DerbyTest.main(DerbyTest.java:29)The problem can be reproduced using the attached java program and the following database file:http://ftp2.bigcat.unimaas.nl/~thomas.kelder/derbytest/testdb.zip.Both the 'derby.storage.tempDirectory' and 'derby.stream.error.file' properties are set to writable locations  as advised in the help file.Also see derby-user mailing list thread: http://article.gmane.org/gmane.comp.apache.db.derby.user/6123'This appears to be a bug  possibly a regression. When I converted yourDB to10.0 everything worked fine even when I did NOT set the propertiesfor tempDirectory and error.file (hmmm..). When I switched to using the10.1 or 10.2 jars and accessed the very same database the 40XD1 ERRORhappened.' (Stanley Bradbury),0,1
Code cleanups for the org.apache.derby.impl.store.access.* packages,When trying to learn more about the access layer  it was discovered that some code improvements could easily be made to increase the readability of the code.Patches attached to this issue will be cleanup patches only  and no functionality should be changed. Changes the will/may be made: remove unused imports remove unused methods fix JavaDoc errors tighter encapsulation and removal of unused variables where appropriate,0,0
Modify compatibility/testScript.xml to not run embedded/jvm1.3 case any more - not valid after r509863,After svn r509863(DERBY-1983 Remove some uses of java13compile.classpath that do not require code changes.) the 'compatibility test' for embedded/jvm1.3 should be removed.ERROR XBM02: Startup failed due to missing functionality for org.apache.derby.iapi.types.DataValueFactory. Please ensure your classpath includes the correct Derby software.compatibility diff -------------------------------------------------------------                 Start: embedded_VM-1.3java.sql.SQLException: Failed to start database 'compatDB'  see the next exception for details. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.newSQLException(Unknown Source) at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)Exception in thread 'main' java.lang.Exception: Error lookup up server info: Failed to start database 'compatDB'  see the next exception for details.             End: embedded_VM-1.3    compatibility/embedded_VM-1.3:---------------------------------------------VM Version = 1.3Driver org.apache.derby.jdbc.AutoloadedDriver Version = 10.3java.sql.SQLException: Failed to start database 'compatDB'  see the next exception for details. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.newSQLException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(Unknown Source) at org.apache.derby.jdbc.Driver20.getNewEmbedConnection(Unknown Source) at org.apache.derby.jdbc.InternalDriver.connect(Unknown Source) at org.apache.derby.jdbc.AutoloadedDriver.connect(Unknown Source) at java.sql.DriverManager.getConnection(DriverManager.java:512) at java.sql.DriverManager.getConnection(DriverManager.java:141) at org.apache.derbyTesting.functionTests.util.DerbyJUnitTest.getConnection(DerbyJUnitTest.java:378) at org.apache.derbyTesting.functionTests.util.DerbyJUnitTest.getConnection(DerbyJUnitTest.java:357) at org.apache.derbyTesting.functionTests.tests.junitTests.compatibility.CompatibilitySuite.findServer(CompatibilitySuite.java:283) at org.apache.derbyTesting.functionTests.tests.junitTests.compatibility.CompatibilitySuite.main(CompatibilitySuite.java:130)ERROR XBM02: Startup failed due to missing functionality for org.apache.derby.iapi.types.DataValueFactory. Please ensure your classpath includes the correct Derby software. at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.iapi.services.monitor.Monitor.missingImplementation(Unknown Source) at org.apache.derby.impl.services.monitor.TopService.bootModule(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(Unknown Source) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Unknown Source) at org.apache.derby.impl.db.BasicDatabase.boot(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(Unknown Source) at org.apache.derby.impl.services.monitor.TopService.bootModule(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(Unknown Source) at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(Unknown Source) at org.apache.derby.jdbc.Driver20.getNewEmbedConnection(Unknown Source) at org.apache.derby.jdbc.InternalDriver.connect(Unknown Source) at org.apache.derby.jdbc.AutoloadedDriver.connect(Unknown Source) at java.sql.DriverManager.getConnection(DriverManager.java:512) at java.sql.DriverManager.getConnection(DriverManager.java:141) at org.apache.derbyTesting.functionTests.util.DerbyJUnitTest.getConnection(DerbyJUnitTest.java:378) at org.apache.derbyTesting.functionTests.util.DerbyJUnitTest.getConnection(DerbyJUnitTest.java:357) at org.apache.derbyTesting.functionTests.tests.junitTests.compatibility.CompatibilitySuite.findServer(CompatibilitySuite.java:283) at org.apache.derbyTesting.functionTests.tests.junitTests.compatibility.CompatibilitySuite.main(CompatibilitySuite.java:130)Exception in thread 'main' java.lang.Exception: Error lookup up server info: Failed to start database 'compatDB'  see the next exception for details. at org.apache.derbyTesting.functionTests.tests.junitTests.compatibility.CompatibilitySuite.findServer(CompatibilitySuite.java:295) at org.apache.derbyTesting.functionTests.tests.junitTests.compatibility.CompatibilitySuite.main(CompatibilitySuite.java:130),0,0
EXISTS may return the wrong value for sub-queries involving set operations,It seems like EXISTS on a SELECT returning zero rows returns false (asexpected)  but EXISTS on INTERSECT of two disjunct sets returns true e.g EXISTS (values 1 intersect values 2).Yip Ng wrote on derby-dev:I believe its probably got to do with the EXISTS subquery transformingthe original RCL toa TRUE boolean value for the INTERSECT. So during row comparison atexecution timefor INTERSECT processing since true == true(thus intersects)  so itwill always return 'BAD'. Likewise select * from ( values 'OK' ) as T where exists (values 1 except values 2);This supposedly should return 'OK' but because of the booleantransformation mentionedabove for EXISTS subquery  it will return no rows for EXCEPTprocessing.,0,0
Setting a default value for a VARCHAR column fails when column contains data,I'm seeing a problem updating the default value for a VARCHAR column when the column already contains data. I'm  using:alter table TABLE_NAME alter column COL_NAME DEFAULT 'new value'and with some VARCHAR columns I get an error like this:Invalid character string format for type long.; nested exception is java.sql.SQLException: Invalid character string format for type long.Caused by: ERROR 22018: Invalid character string format for type long. at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.iapi.types.SQLChar.getLong(Unknown Source) at org.apache.derby.impl.sql.execute.AlterTableConstantAction.getColumnMax(Unknown Source) at org.apache.derby.impl.sql.execute.AlterTableConstantAction.modifyColumnDefault(Unknown Source) at org.apache.derby.impl.sql.execute.AlterTableConstantAction.execGuts(Unknown Source) at org.apache.derby.impl.sql.execute.AlterTableConstantAction.executeConstantAction(Unknown Source) at org.apache.derby.impl.sql.execute.MiscResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)This only happens on VARCHAR columns containing data. Columns that are entirely NULL update fine. This was discussed on users mailing list:http://www.nabble.com/problem-with-ALTER-COLUMN-DEFAULT-on-VARCHAR-column-tf3274046.htmland the conclusion was that it is related to this statement being run internally as part of the updata process:SELECT MAX(COL_NAME) FROM TABLE_NAME As reported in that discussion:-bash-2.05b$ java org.apache.derby.tools.ijij version 10.3ij&gt; connect 'jdbc:derby:brydb';ij&gt; create table t (a varchar(10));0 rows inserted/updated/deletedij&gt; alter table t alter column a default 'my val';0 rows inserted/updated/deletedij&gt; insert into t (a) values ('hi');1 row inserted/updated/deletedij&gt; alter table t alter column a default 'another val';ERROR 22018: Invalid character string format for type long.,0,0
ParameterMappingTest fails due to ArrayIndexOutOfBoundsException  executing a procedure,The test ParameterMappingTest fails due to a connection reset error during tearDown. Commenting out the teardown actions I see that the real cause of the connection reset is an ArrayIndexOutOfBoundsException executing a callable statement. I have not narrowed it down more than this. Currently the test runs only for embedded. It should be reenabled for client once this bug is fixed. Below is the stack trace:java.lang.ArrayIndexOutOfBoundsException at java.lang.System.arraycopy(Native Method) at org.apache.derby.client.net.Reply.shiftBuffer(Reply.java:107) at org.apache.derby.client.net.Reply.ensureSpaceInBufferForFill(Reply.java:153) at org.apache.derby.client.net.Reply.fill(Reply.java:165) at org.apache.derby.client.net.Reply.ensureALayerDataInBuffer(Reply.java(Compiled Code)) at org.apache.derby.client.net.Reply.readDssHeader(Reply.java:317) at org.apache.derby.client.net.Reply.peekCodePoint(Reply.java:1008) at org.apache.derby.client.net.NetStatementReply.parseEXCSQLSTTreply(NetStatementReply.java:324) at org.apache.derby.client.net.NetStatementReply.readExecuteCall(NetStatementReply.java:105) at org.apache.derby.client.net.StatementReply.readExecuteCall(StatementReply.java:75) at org.apache.derby.client.net.NetStatement.readExecuteCall_(NetStatement.java:176) at org.apache.derby.client.am.Statement.readExecuteCall(Statement.java:1464) at org.apache.derby.client.am.PreparedStatement.flowExecute(PreparedStatement.java:2151) at org.apache.derby.client.am.PreparedStatement.executeX(PreparedStatement.java:1571) at org.apache.derby.client.am.PreparedStatement.execute(PreparedStatement.java:1556) at org.apache.derbyTesting.functionTests.tests.jdbcapi.ParameterMappingTest.testParameterMapping(ParameterMappingTest.java:487) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:85) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:58) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:60) at java.lang.reflect.Method.invoke(Method.java:391) at junit.framework.TestCase.runTest(TestCase.java:154) at junit.framework.TestCase.runBare(TestCase.java:127) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:76) at junit.framework.TestResult$1.protect(TestResult.java:106) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.framework.TestResult.run(TestResult.java:109) at junit.framework.TestCase.run(TestCase.java:118) at junit.framework.TestSuite.runTest(TestSuite.java:208) at junit.framework.TestSuite.run(TestSuite.java:203) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:128) at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196),0,0
XAResource.end does not set the XA transaction state correctly when the XAException is thrown,As the comments in DERBY-2360 show when calling the XAResource.end the XAException may be thrown even when the transaction was successfully disassociated from the connection but the transaction was marked as rollback only. The code at the end of XAResource.end function does not handle this correctly. It either throws an XAException or sets the connection state to XA_T0_NOT_ASSOCIATED. The corresponding code from NetXAResource.end method is if (rc != XAResource.XA_OK) { throwXAException(rc  false); }else { conn_.setXAState(Connection.XA_T0_NOT_ASSOCIATED); },0,0
Provide collation sensitive subclasses for SQLChar  SQLVarchar  SQLLongvarchar and SQLClob which will use the passed Collator to do the collation rather than the default collation of UCS_BASIC,This jira entry is one of the tasks involved in implementing DERBY-2336.The existing SQLChar datatype has the Derby's default collation which is UCS_BASIC defined on them. With Derby 10.3  we want to support an additional collation for char datatypes which will be based on the territory. This jira issue is the placeholder for creating subclass of SQLChar which will use the passed Collator to do the collation. The current use of this class in Derby 10.3 will be for territory based collation but this class can be used in future for other kinds of collations like case-insensitive etc.,0,0
ejbql and floattypes in org.apache.derbyTesting.functionTests.tests.lang.LangScripts intermittently fails with 'expected: but was:<[-0.0]  ',Seen intermittently on Linux since 2007-02-27.Seen on Solaris 2007-03-12.&lt;signature&gt;ejbql(org.apache.derbyTesting.functionTests.tests.lang.LangScripts)junit.framework.ComparisonFailure: Output at line 454 expected:&lt;&#91;0.0 &#93; &gt; but was:&lt;&#91;-0.0&#93; &gt; at org.apache.derbyTesting.functionTests.util.CanonTestCase.compareCanon(CanonTestCase.java:100) at org.apache.derbyTesting.functionTests.util.ScriptTestCase.runTest(ScriptTestCase.java:124) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:80) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;/signature&gt;&lt;signature&gt;floattypes(org.apache.derbyTesting.functionTests.tests.lang.LangScripts)junit.framework.ComparisonFailure: Output at line 1823 expected:&lt;&#91;0.0 &#93; &gt; but was:&lt;&#91;-0.0&#93; &gt; at org.apache.derbyTesting.functionTests.util.CanonTestCase.compareCanon(CanonTestCase.java:100) at org.apache.derbyTesting.functionTests.util.ScriptTestCase.runTest(ScriptTestCase.java:124) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:80) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;/signature&gt;,0,0
Clob.Position returning wrong value when operating on Reader,,0,0
File stream is left open when an exception occurs while setting up a character stream for data export.,The JUnit test tools/ImportExportTest.java has been failing since it was first contributed with the following error:ImportExportTest:embeddedjunit.framework.AssertionFailedError: extinout/T1.datat org.apache.derbyTesting.junit.DropDatabaseSetup.removeDir(DropDatabaseSetup.java:102)at org.apache.derbyTesting.junit.DropDatabaseSetup.access$000(DropDatabaseSetup.java:38)at org.apache.derbyTesting.junit.DropDatabaseSetup$1.run(DropDatabaseSetup.java:77)at java.security.AccessController.doPrivileged1(Native Method)at java.security.AccessController.doPrivileged(AccessController.java:287)at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDirectory(DropDatabaseSetup.java:74)at org.apache.derbyTesting.junit.SupportFilesSetup.tearDown(SupportFilesSetup.java:107)at junit.extensions.TestSetup$1.protect(TestSetup.java:20)at junit.extensions.TestSetup.run(TestSetup.java:23)at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)at junit.extensions.TestSetup$1.protect(TestSetup.java:19)at junit.extensions.TestSetup.run(TestSetup.java:23)Also fails with the client  as well. Per the comment posted by Suresh to DERBY-2295  it looks like the cause of this failure is that the 'openFile()' method of java/engine/org/apache/derby/impl/load/ExportWriteData.java does not close the file stream in cases where an invalid encoding is specified.,0,0
org.apache.derby.impl.store.access.BackingStoreHashTableFromScan does not honor ResultSet holdability,After an unrelated statement on the same connection commits  and after some number of successful calls to ResultSet.next()  a subsequent call to ResultSet.next() throws an SQLException with a message like: The heap container with container id Container(-1  1173965368428) is closed. This seems to be related to the hard-coded passing of false to the super in the constructor of org.apache.derby.impl.store.access.BackingStoreHashTableFromScan.Steps to reproduce:1. Execute a statement on a connection that returns a result set.2. Execute a second statement on the same connection that modifies the database and commits.3. Call next() on the first result set until the exception is thrown.Note that the number of rows that can be successfully retrieved from the result set seems to be related to the amount of data per row. Increasing the number of columns in the result set or the length of the columns causes the exception to be taken sooner.The attached test program demonstrates the issue.,0,0
'Invalid transaction state...' in jdbcapi.SetTransactionIsolationTest,See e.g. http://dbtg.thresher.com/derby/test/Daily/jvm1.5/testing/testlog/sles/520949-suitesAll_diff.txt1) testIsolation(org.apache.derbyTesting.functionTests.tests.jdbcapi.SetTransactionIsolationTest)ERROR X0X03: Invalid transaction state - held cursor requires same isolation level at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.setIsolationLevel(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.setTransactionIsolation(Unknown Source) at org.apache.derbyTesting.functionTests.tests.jdbcapi.SetTransactionIsolationTest.checkIsolationLevelNoTimeout(SetTransactionIsolationTest.java:113) at org.apache.derbyTesting.functionTests.tests.jdbcapi.SetTransactionIsolationTest.testIsolation(SetTransactionIsolationTest.java:50) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:80) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;method&gt;org.apache.derbyTesting.functionTests.tests.jdbcapi.SetTransactionIsolationTest&lt;/method&gt;&lt;signature&gt;Invalid transaction state - held cursor requires same isolation level&lt;/signature&gt;,0,0
DriverManager.getConnection leaks memory when connecting to a non-existent database,Repeated calls to java.sql.DriverManager.getConnection('jdbc:derby:C:DOES_NOT_EXIST') leak memory and eventually lead to an OutOfMemoryError.This bug is similar to DERBY-1947 in that ContextManager objects are not getting removed from the HashSet. The attached test program demonstrates the issue. When run with VM options -Xms8m -Xmx8m  it throws an OutOfMemoryError after 19022 calls to DriverManager.getConnection.,0,1
Convert syscat.sql to junit,,0,0
Enhance Derby with EXPLAIN Functionality,This enhancement extends Derby with EXPLAIN functions. Users want to have more feedback than they're getting with the current RuntimeStatistics facility. This extension is based on the RuntimeStatistics/ResultSetStatistics functions / classes.,0,0
Batch scripts in bin/ report extraneous errors when DERBY_HOME is invalid,If DERBY_HOME is set to an invalid location (for example a directory that does not contain lib/derby.jar)  most .bat scripts in the bin directory (the ones that call derby_common.bat) report three distinct error messages  of which only one is of value to the user. Reproduction:C:/Derby_10/db-derby-10.2.2.0-bin&gt;set DERBY_HOME=c:/tempC:/Derby_10/db-derby-10.2.2.0-bin&gt;echo %DERBY_HOME%c:/tempC:/Derby_10/db-derby-10.2.2.0-bin&gt;bin/sysinfoDERBY_HOME is set incorrectly or derby.jar could not be located. Please set DERBY_HOME.The system cannot find the batch label specified - end'''' is not recognized as an internal or external command operable program or batch file.The distinct error messages are:1) DERBY_HOME is set incorrectly or derby.jar could not be located. Please set DERBY_HOME.2) The system cannot find the batch label specified - end3) '''' is not recognized as an internal or external command  operable program or batch file.Only 1) is relevant for the user  and should ideally be the only one displayed.,0,0
Unclosed ResultSets choke JUnit lang _Suite on java 6,The lang suite fail for me from UnaryArithmeticParameterTest on. The tests can't drop table T1 because a ResultSet is open.,0,0
Network Client allows execution of callable statement when one of the parameters is not set,If the second input parameter is set and the first is not. Client allows execution of the stored procedure. See the following code in LangProcedureTest.java with a reference to this bug. op.clearParameters(); op.setString(2  '2'); try { // a not set op.execute(); fail('FAIL - a not set'); } catch (SQLException sqle) { assertSQLState('07000'  sqle); },0,0
Convert lang/grantRevokeDDL and grantRevokeDDL2 to JUnit,,0,0
Client does not return SQLException on XAConnection.getXAResource() on a closed connection  Embedded does,In the following scenario from converted test DataSourceTest:(non-tested code based on the test code)---------------- ClientXADataSource dsx = new ClientXADataSource(); dsx.setDatabaseName('tstdb'); XAConnection xac = dsx.getXAConnection(); XAConnection xac2 = dsx.getXAConnection(); XAResource xar2 = xac2.getXAResource(); xac2.close(); // allow close on already closed XAConnection xac2.close(); try { xac2.getXAResource(); // Network Server does not think this is worth an exception. } catch (SQLException sqle) { System.out.println('expect a 08003 as with Embedded'); }------------------With DerbyNetClient  the xac2.getXAResource() does not return an SQLException.This ought to be documented if expected  or fixed.,0,0
Make Locale available in DataValueFactory(DVF). This Locale object will be used to construct Collator object if the user has requested territory based collation.,Add a new api on DVF which will make Locale object available to DVF. This new api on DVF will get called by the boot method of BasicDatabase after BasicDatabase has finished booting DVF. This Locale will be either the Locale obtained from the territory attribute supplied by the user on the JDBC url at database create time or if user didn't provide the territory attribute at database create time  then it will be set to the default JVM locale. This Locale object will be used by DVF to construct the Collator object if user has requested territory based collation.The new api will look like following void setLocale(Locale localeOfTheDatabase);,0,0
testVirtualMemoryHeap junit test fails with 'Virtual memory heap test failed! Got unexpected value. expected: but was:',junit suite fails with the following error:2) testVirtualMemoryHeap(org.apache.derbyTesting.functionTests.tests.lang.UpdateCursorTest)junit.framework.AssertionFailedError: Virtual memory heap test failed! Got unexpected value. expected:&lt;202&gt; but was:&lt;103&gt; at org.apache.derbyTesting.functionTests.tests.lang.UpdateCursorTest.testVirtualMemoryHeap(UpdateCursorTest.java:178) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25),0,0
Code paths for db restore do not use doPrivileged-calls  causing SecurityException,When using 'createFrom' or 'restoreFrom' in the JDBC url to restore a database from a backup image  a SecurityException is thrown even though the policyfile for codebase derby.jar is correctly configured (giving Derby access to the backup image).A few comments on this issue can be found here (and in subsequent comments): https://issues.apache.org/jira/browse/DERBY-1001#action_12439811A workaround is wrapping the connection call in doPrivileged at the 'application-level code'  or granting the required permissions to the application codebase as well.,1,0
Missing asserts in ProcedureInTriggerTest,ProcedureInTriggerTest sometimes executes queries without checking the results. The comments indicate that the results should have been checked.line 258-259 and line 263-264: //--- Check that insert successful and trigger fired.  rs = s.executeQuery('select * from t1');line 408-410: //--- check delete failed rs = s.executeQuery('select * from t1'); expectedRows = new String[][] { {'5' 'two'} {'6' 'four'} {'8' 'eight'}};line 421-422: //--- check trigger is not dropped rs = s.executeQuery('select count from SYS.SYSTRIGGERS where triggername='TEST_TRIG'');line 431-432: // &#8211; check index is not created rs = s.executeQuery('select count from SYS.SYSCONGLOMERATES where CONGLOMERATENAME='IX' and ISINDEX=1');line 438-440: // &#8211; check delete failed rs = s.executeQuery('select * from t1'); expectedRows = new String[][] { {'5' 'two'} {'6' 'four'} {'8' 'eight'}};,0,0
ContextService.notifyAllActiveThreads()  and network server code need a privileged block around the calls to Thread.interrupt(),It looks to me as though the call to interrupt() can raise a SecurityException. I think this may give rise to another permission that we need to add to our template policy file and to our security documentation.,1,0
Create a utility which generates Release Notes,This proposal summarizes an off-list conversation among Myrna van Lunteren  Bernt Johnsen  Andrew McIntyre  and myself.Currently  there is a template for release notes in the top level directory of the code tree. Actually filling in this template is a time-consuming  error-prone process. We would like to automate this process as much as possible. We believe it ought to be possible to generate the Release Notes given the following inputs:1) A high-level description of the release. The Release Manager would write this description  based on a template.2) An xml report produced by a JIRA filter. The filter would list all of the JIRAs addressed by the release.In order for this to work  we would need for the community to agree on conventions for the release notes which are attached to JIRAs  viz.  the JIRAs whose 'Release Note Needed' toggles are turned on. These JIRA-specific notes become items in the Issues section of the final Release Notes. Each of these items calls the reader's attention to a significant topic involving Derby's behavior  that behavior's compatibility with previous releases  and adjustments which the user may need to make to her applications.The following approach makes sense to us:A) The community will agree on an html template for these notes.B) The note-writer will fill in this template and attach it to the JIRA using a canonical file name  say 'releaseNote.html'.C) Various iterations of the note may be needed.D) The utility for generating Release Notes will grab the latest rev of 'releaseNote.html' attached to the JIRA.This effort involves at least two major steps:I) Getting the community to agree to these note-writing conventions.II) Writing the Release Note generator.,0,0
AssertFailure class should use JDK's built-in chaining of exceptions,Currently  AssertFailure implements its own chaining of exceptions. It should use the chaining mechanism provided by the JDK.,0,0
At code generation time  look at collation type to determine what kind of DVD should get generated for character types.,Currently  in Derby 10.2  we generate SQLChar/SQLVarchar/SQLLongvarchar/SQLClob for various SQL character types. All these DVDs have the default collation of UCS_BASIC. Starting 10.3  we should look at the collation type of the DTD before deciding what kind of DVD gets generated for SQL character types. If the collation type of the character type is terriotry based collation  then we should generate CollatorSQLChar/CollatorSQLVarchar/CollatorSQLLongvarchar/CollatorSQLClob rather than SQLChar/SQLVarchar/SQLLongvarchar/SQLClob. The CollatorSQLxxx DVDs will have the territory based collator associated with them and hence the collation order of these DVDs will be different than the DVDs with default collation of UCS_BASIC.,0,0
Wrong description of IndexName field in public JavaDoc for LockTable,The public JavaDoc for LockTable says the following in the description of the INDEXNAME retrieved from SYSCS_DIAG.LOCK_TABLE: INDEXNAME varchar(128) - normally null. If non-null  a lock is held on the index  this can only happen if this is not a user transaction.I think the last part is wrong. Normal user transactions might also have a value in the INDEXNAME. For example  here is part of the lock table for three user transactions:XID |TYPE |MODE|TABLENAME |LOCKNAME |STATE|TABLETYPE|INDEXNAME---------------------------------------------------------------------186 |ROW |X |T2 |(1 9) |GRANT|T |NULL184 |ROW |S |T2 |(1 9) |WAIT |T |NULL188 |ROW |X |T1 |(1 11) |GRANT|T |NULL 186 |ROW |S |T1 |(1 11) |WAIT |T |NULL186 |ROW |S |T1 |(1 1) |GRANT|T |SQL070425023213370 188 |ROW |S |T1 |(1 1) |GRANT|T |SQL070425023213370 184 |ROW |X |T1 |(1 7) |GRANT|T |NULL 188 |ROW |S |T1 |(1 7) |WAIT |T |NULL Two of the lock entries have an index. I expect this to be the Scan lock that have been set during traversal of the B-tree.Proposed fix: remove the last part of the sentence.,0,0
TIMESTAMP value is truncated  when return to client,In ParameterMappingTest I see the following differences between embedded and client. Client is truncating the TIMESTAMP value. Look for this bug number in the test for reproduction. case java.sql.Types.TIMESTAMP: if (param == 2) if (usingEmbedded()) assertEquals('2004-03-12 21:14:24.938222433'  val.toString()); else assertEquals('2004-03-12 21:14:24.938222'  val.toString()); else if (param == 3) if (usingEmbedded()) assertEquals('2004-04-12 04:25:26.462983731'  val.toString()); else assertEquals('2004-04-12 04:25:26.462983'  val.toString()); break;,0,0
Derby should print the parameters to failed statements to the derby.log when it logs the error,It would be good if when derby dumped an error to derby.log it printed the parameters for the failed statement. Currently the default behaviour is that only the statement text will print. Users have to set derby.language.logStatementText=true if they want to see the parameters. It would be useful if any errors included the parameters as well as the statement text.To reproduce put derby.stream.error.logSeverityLevel=0 in your derby.properties and run this script: connect 'jdbc:derby:wombat;create=true';create table t (i int);prepare p as 'insert into t values'; execute p using 'values(1)';execute p using 'values(10000000000000000000000000000000000000000000)';,1,0
DatabaseMetaData is not consistent about throwing SqlException when tablename=null,According to java.sql.DatabaseMetaData  the following DatabaseMetaData methods should not allow tablename=null:getBestRowIdentifier  getColumnPrivileges  getIndexInfo  getVersionColumns  getPrimaryKeys  getImportedKeys  getExportedKeys. In the five former methods  SqlExceptions are thrown if tablename == null  but this check is not performed in the latter two.The method calls eventually end up in EmbedDatabaseMetaData  which performs this check. Hence  an exception is thrown either way. If we want the exception to be thrown as early as possible  the two latter methods should do so as well. If not  the check should be removed from the former methods.,0,0
Queries in metadata.properties allow tablepattern for JDBC methods that do not allow patterns,The DatabaseMetaData methods getBestRowIdentifier  getColumnPrivileges  getIndexInfo  getVersionColumns  getPrimaryKeys  getImportedKeys  getExportedKeys do not allow table name patterns. However  the SQL in metadata.properties implement these with 'table like ?'  thus allowing patterns. The SQL for these methods should be modified to 'table=?'.,0,0
upgrade test incorrectly tries to test in place compress in 10.0 release.,When trying to run upgrade test in trunk with all releases available for upgrade to test found at:https://svn.apache.org/repos/asf/db/derby/jars/10.2.2.0/I got 4 errors (not including those that are part of DERBY-2598).:1) testNegValueSupportedLogRecord(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3)java.sql.SQLException: 'SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE' is not recognized as a function or procedure. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:305) at org.apache.derby.impl.sql.compile.StaticMethodCallNode.bindExpression(StaticMethodCallNode.java:224) at org.apache.derby.impl.sql.compile.JavaToSQLValueNode.bindExpression(JavaToSQLValueNode.java:243) at org.apache.derby.impl.sql.compile.CallStatementNode.bindStatement(CallStatementNode.java:145) at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:314) at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:88) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:742) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:567) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:516) at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3.checkDataToCase606(Changes10_3.java:177) at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3.testNegValueSupportedLogRecord(Changes10_3.java:118) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)2) testGetTablesModify(org.apache.derbyTesting.functionTests.tests.jdbcapi.DataaseMetaDataTest)java.sql.SQLException: Use of 'XML' requires database to be upgaded from version 10.0 to version 10.1 or later. at org.apache.derby.iapi.error.StandardException.newException(StandardExcepion.java:356) at org.apache.derby.impl.sql.catalog.DD_Version.checkVersion(DD_Version.jav:788) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.checkVersion(DataDitionaryImpl.java:8487) at org.apache.derby.impl.sql.compile.SQLParser.checkVersion(SQLParser.java:00) at org.apache.derby.impl.sql.compile.SQLParser.XMLType(SQLParser.java:4181) at org.apache.derby.impl.sql.compile.SQLParser.dataTypeCommon(SQLParser.jav:3607) at org.apache.derby.impl.sql.compile.SQLParser.dataTypeDDL(SQLParser.java:337) at org.apache.derby.impl.sql.compile.SQLParser.columnDefinition(SQLParser.jva:3400) at org.apache.derby.impl.sql.compile.SQLParser.tableElement(SQLParser.java:368) at org.apache.derby.impl.sql.compile.SQLParser.tableElementList(SQLParser.jva:3209) at org.apache.derby.impl.sql.compile.SQLParser.tableDefinition(SQLParser.jaa:10992) at org.apache.derby.impl.sql.compile.SQLParser.createStatements(SQLParser.jva:1811) at org.apache.derby.impl.sql.compile.SQLParser.StatementPart(SQLParser.java1718) at org.apache.derby.impl.sql.compile.SQLParser.Statement(SQLParser.java:163) at org.apache.derby.impl.sql.compile.ParserImpl.parseStatement(ParserImpl.jva:151) at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.jva:280) at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java88) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareIternalStatement(GenericLanguageConnectionContext.java:742) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:56) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:51) at org.apache.derbyTesting.functionTests.tests.jdbcapi.DatabaseMetaDataTestcreateTablesForTest(DatabaseMetaDataTest.java:1123) at org.apache.derbyTesting.functionTests.tests.jdbcapi.DatabaseMetaDataTesttestGetTablesModify(DatabaseMetaDataTest.java:912) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.jav:64) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessormpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)3) testNegValueSupportedLogRecord(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3)ERROR 42Y03: 'SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE' is not recognized as a function or procedure. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java) at org.apache.derby.impl.sql.compile.StaticMethodCallNode.bindExpression(StaticMethodCallNode.java) at org.apache.derby.impl.sql.compile.JavaToSQLValueNode.bindExpression(JavaToSQLValueNode.java) at org.apache.derby.impl.sql.compile.CallStatementNode.bind(CallStatementNode.java) at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java) at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java) at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3.checkDataToCase606(Changes10_3.java:177) at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3.testNegValueSupportedLogRecord(Changes10_3.java:122) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)4) Upgrade Phase: UPGRADEjava.sql.SQLException: Failed to start database 'singleUse/oneuse0'  see the next exception for details. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:94) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:173) at org.apache.derby.impl.jdbc.EmbedConnection.newSQLException(EmbedConnection.java:2119) at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:1783) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(EmbedConnection.java:249) at org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Driver30.java:74) at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:209) at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSource.java:479) at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(EmbeddedDataSource.java:423) at org.apache.derbyTesting.functionTests.tests.upgradeTests.PhaseChanger.setUp(PhaseChanger.java:94) at junit.extensions.TestSetup$1.protect(TestSetup.java:18) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)FAILURES!!!Tests run: 505  Failures: 0  Errors: 4,0,0
intermittent network startup related errors in running junit nightly test suite,I intermitently get network startup related errors in running the nightly full test suite on my laptop  running XP  with a firewall and a VPN - I am not sure what if any of those environmental factors is causing it. I have been mostly ignoring the errors as it seemed like it usually was only one test. I my latest run it was more like 7 or 8. I'll append exact tests as a comment on this issue.To debug the problem I picked one - org.apache.derbyTesting.functionTests.tests.derbynet.NSSecurityMechanismTest and ran it in a loop. When I did this it failed everytime after the first one (and the first one intermittently failed). When I bumped the WAIT_TIME up to 300000 and the SLEEP_TIME to 500 injava/testing/org/apache/derbyTesting/junit/NetworkServerTestSetup.java then the test passed everytime . In 30 runs theentire test took varying times from 2 minutes to 6 minutes  mostly in the 4 minute range.,0,0
Expose existing auto-generated key functionality through more JDBC APIs in embedded mode.,Derby currently supports the following JDBC methods for auto-generated keys: // Indicate that we want to retrieve auto-generated key values. Connection.prepareStatement(String sql  int autoGeneratedKeys); Statement.execute(String sql  int autoGeneratedKeys); Statement.executeUpdate(String sql  int autoGeneratedKeys); // Retrieve the auto-generated values (only applies to INSERT statements). ResultSet rs = Statement.getGeneratedKeys();The current implementation of getGeneratedKeys() internally maps to the 'IDENTITY_VAL_LOCAL()' method  which means that Derby's implementation only returns generated keys for autoincrement columns (no other default columns are supported). Further: 1. The generated key result set only ever has a single column. This is because Derby only allows one autoincrement column per table. 2. The type of the single column in the result set will be DECIMAL(31 0). This is defined by IDENTITY_VAL_LOCAL(). 3. The generated key result set will only ever have a single row. This is because IDENTITY_VAL_LOCAL() only returns values that were assigned as the result of a single row INSERT statement using a VALUES clause. For a single row INSERT statement  at most one autoincrement value will be generated.All of that said  JDBC 3.0 also defines the following methods  which allow the user to explicitly indicate  via column position or column name  the columns for which the auto-generated keys should be made available: Connection.prepareStatement(String sql  String[] columnNames); Connection.prepareStatement(String sql  int[] columnIndexes); Statement.execute(String sql  String[] columNames); Statement.execute(String sql  int[] columIndexes); Statement.executeUpdate(String sql  String[] columnNames); Statement.executeUpdate(String sql  int[] columnIndexes);Derby currently throws a 'Feature not supported' error for all of these methods. However  it seems like the above methods could be 'mapped' onto the existing Derby behavior with relatively little effort (in embedded mode). Most of the required code is already in place.Doing so would make it easier for applications that rely on the columnNames and/or columnIndexes APIs to work with Derby (assuming the app just wants generated keys for identity (autoincrement) columns).Note that this Jira does not entail removing any of the restrictions nor changing any of the behavior outlined above. All of that will remain exactly as it is. This Jira simply exposes the existing functionality (restrictions and all) through additional (standard) API methods. In particular this means that any column specified by index (position) or name must be an auto-increment column for the INSERT table; otherwise Derby should throw an error. Or put differently  a user who specifies a column name/position will get-in the absence of errors-the exact same results as s/he would get from invoking the '(String sql  int autoGeneratedKeys)' method.Note also: This Jira is specifically for embedded mode. I think it would be harder to support these methods for Derby Client and so do not plan to address that.,0,0
upgrade tests fail through BlobStoredProcedureTest and ClobStoredProcedureTest with JSR169,The 10.3 upgrade tests (Changes_10.3) add the ClobStoredProcedureTest and BlobStoredProcedureTest.class.However these tests should not run with JSR169  for the stored procedures use DriverManager to obtain the default connection.This should be unimportant with JSR169  because the procedures are internal procedures that are only intended to be exercised by client code  and client/server is not currently supported with JSR169.For reference  the stack trace is (for example) like so:33) testClobGetLengthSP(org.apache.derbyTesting.functionTests.tests.jdbcapi.ClobStoredProcedureTest)java.sql.SQLException: The exception 'java.lang.NoClassDefFoundError: java.sql.DriverManager' was thrown while evaluating an expression. at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.iapi.error.StandardException.unexpectedUserException(Unknown Source) at org.apache.derby.impl.services.reflect.DirectCall.invoke(Unknown Source) at org.apache.derby.impl.sql.execute.RowResultSet.getNextRowCore(Unknown Source) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(Unknown Source) at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(Unknown Source) at org.apache.derby.impl.jdbc.EmbedResultSet.next(Unknown Source) at org.apache.derby.impl.jdbc.EmbedCallableStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(Unknown Source) at org.apache.derbyTesting.functionTests.tests.jdbcapi.ClobStoredProcedureTest.setUp(ClobStoredProcedureTest.java:77) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23),0,0
Convert lang/dynamicLikeOptimization.sql to JUnit,,0,0
upgrade test failures with weme 6.1.,Since activating the upgrade tests for weme6.1 (and resolving some of the failures) I can now see 1 new error and 13 new failures. Some of these may warrant their own bug; some are probably caused by the initial problem.(In the section below  I'm skipping the junit.extensions.* part of the stack.)error:2) testProcedureSignature(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_1)java.sql.SQLException: PROCEDURE 'GC' already exists. at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.impl.sql.execute.CreateAliasConstantAction.executeConstantAction(Unknown Source) at org.apache.derby.impl.sql.execute.MiscResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_1.testProcedureSignature(Changes10_1.java:87) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88) ....------------------failures: 6) testProcedureSignature(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_1)junit.framework.AssertionFailedError: Expected error 'XCL47' but no error was thrown. at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertStatementError(BaseJDBCTestCase.java:703) at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_1.testProcedureSignature(Changes10_1.java:82) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at &lt;unknown class&gt;.&lt;unknown method&gt;(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88) ...2) and  11) testOldVersion(org.apache.derbyTesting.functionTests.tests.upgradeTests.BasicSetup)junit.framework.AssertionFailedError: Old minor (driver): expected:&lt;0&gt; but was:&lt;3&gt; at org.apache.derbyTesting.functionTests.tests.upgradeTests.BasicSetup.testOldVersion(BasicSetup.java:61) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at &lt;unknown class&gt;.&lt;unknown method&gt;(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88) ...--------------------3)  7) and 12)  with a variation in originating line number in Changes10_2:(marked (#) in the stack below).and expected error numbertestGrantRevokeStatements(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_2)(3  12) junit.framework.ComparisonFailure: Unexpected SQL state. expected:&lt;...X01&gt; but was:&lt;...Z60&gt;(7)junit.framework.ComparisonFailure: Unexpected SQL state. expected:&lt;XCL47&gt; but was:&lt;42Z60&gt; at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDBCTestCase.java:523) at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDBCTestCase.java:585) at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertStatementError(BaseJDBCTestCase.java:706)(3  12) at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_2.testGrantRevokeStatements(Changes10_2.java:241)(7) at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_2.testGrantRevokeStatements(Changes10_2.java:250) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at &lt;unknown class&gt;.&lt;unknown method&gt;(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88) ...Caused by: java.sql.SQLException: GRANT not allowed unless database property derby.database.sqlAuthorization has value 'TRUE'. at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.impl.sql.compile.SQLParser.checkSqlStandardAccess(Unknown Source) at org.apache.derby.impl.sql.compile.SQLParser.grantStatement(Unknown Source) at org.apache.derby.impl.sql.compile.SQLParser.StatementPart(Unknown Source) at org.apache.derby.impl.sql.compile.SQLParser.Statement(Unknown Source) at org.apache.derby.impl.sql.compile.ParserImpl.parseStatement(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertStatementError(BaseJDBCTestCase.java:701)(3  12) at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_2.testGrantRevokeStatements(Changes10_2.java:241)(7) at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_2.testGrantRevokeStatements(Changes10_2.java:250) at at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) ... 64 more------------------4)  8) and 13) testDatabaseOwnerChange(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_2)junit.framework.ComparisonFailure: AUTHORIZATIONID not valid for SYSIBM expected:&lt;DBA&gt; but was:&lt;APP&gt; at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_2.checkSystemSchemasOwner(Changes10_2.java:300) at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_2.testDatabaseOwnerChange(Changes10_2.java:282) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at &lt;unknown class&gt;.&lt;unknown method&gt;(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88) ...------------------5)   10) and 14)testPolicyReloadingProcedure(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3)junit.framework.AssertionFailedError: Reloading results. expected:&lt;false&gt; but was:&lt;true&gt; at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3.tryReloading(Changes10_3.java:362) at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3.assertPolicyReloaderDoesNotExist(Changes10_3.java:340) at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3.testPolicyReloadingProcedure(Changes10_3.java:311) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at &lt;unknown class&gt;.&lt;unknown method&gt;(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88) ...------------------9) testImportExportLobsProcedures(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3)junit.framework.AssertionFailedError: Expected error '42Y03' but no error was thrown. at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertStatementError(BaseJDBCTestCase.java:703) at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3.testImportExportLobsProcedures(Changes10_3.java:252) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at &lt;unknown class&gt;.&lt;unknown method&gt;(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88) ...------------------,0,0
Convert jdbcapi/parameterMetaDataJdbc30.java to JUnit,Convert jdbcapi/parameterMetaDataJdbc30.java to JUnit.,0,0
Errors/messages early in starting the network server through NetworkServerControl.start() are not reported to the PrintWriter passed into start().,Cause seems to be not calling setLogWriter() in NetworkServerControlImpl.start() before calling startNetworkServer.,0,0
performance of like in territory based collation databases may be improved by changing way collation elements are calculated.,WorkHorseForCollatorDatatypes.java has a method getCollationElementsForString() which currently getscalled when processing like clauses in databases that have been created with territory based collation  this isnot an issue in pre-10.3 databases or post 10.3 default databases.getCollationElementsForString gets the collation elements for the entire value of the String held bythe datatype using the class.If you take the case of pattern 'A%' and the value of datatype is 'BXXXXXXXXXXXXXXXXXXXXXXX'  then it would have been better to better to get collation elements one character of the String value at a timeto avoid the process of getting collation elements for the entire string when we don't really need it One could imagine this might have a huge performance impact on running like against a long clob wherethe like pattern has leading fixed-length pattern to match.Comments on this from Dan and Dag can be found in DERBY-2416.,0,1
If large clob is updated after Reader. the reader continues to point to old data,If a Reader is fetched from a large clob (obtained from ResultSet) a reader linked to the dvd stream is returned once a set method is called on it the clob data is materialized in control class but the Reader returned previously continues to point to old data.,0,0
Ensure that a temporary file is not created for a lob obtained from resultset unless user updates it.,Currently LOBStreamControl has a buffer limit of 4k if the lob is larger than this a temporary file is created. Ensure that lob data is kept in memory unless user start to update it.,0,1
Implement not implemented Embedded methods Blob.getBinaryStream(long pos  long length) and Clob. getCharacterStream(long pos  long length),The following methods were introduced in the java.sql.Clob and java.sql.Blob interface as part of JDBC 4.0 and need to be implemented.Clob------getCharacterStream(long pos  long length)Blob------getBinaryStream(long pos  long length)The implementation on the Network Client is already done as part of Derby-2444,0,0
LIKE parameter marker combined with index multi-probing leads to ASSERT failure with sane jars  wrong results with insane jars.,In cases where the optimizer chooses to do index multi-probing for an IN list (DERBY-47)  the presence of a LIKE condition whose argument is a parameter marker leads to an ASSERTion failure with sane jars. With insane jars  the same query returns incorrect results (it only returns rows matching the first argument in the IN list).As an example  if we have the following DDL: create table ct (i int  c1 char(25)  c2 char(40)); insert into ct values 1  2  3  4  5  6  7  8  9; insert into ct values 0  10  11  12  13  14  15  16  17  18  19; insert into ct select 7 * i from ct; insert into ct select 13 * i from ct; update ct set c1 = cast(i as char(25)); update ct set c2 = c1 || c1; create index idx2 on ct (c1  c2);Then we see the following results:&#8211; This one works.select i c1 c2 from ct where c1 in ('1' '2') and c2 like '%' order by i;&#8211; These all work  too.prepare p1 as 'select i c1 c2 from ct where c1 in (''2'' ''1'') and c2 like ''%''';execute p1;prepare p1 as 'select i c1 c2 from ct where c1 in (? ?) and c2 like ''%''';execute p1 using 'values (''1''  ''2'')';&#8211; But these all fail. Something about having a parameter in the LIKE is triggering the assertion...prepare p1 as 'select i c1 c2 from ct where c1 in (? ?) and c2 like ? order by i';execute p1 using 'values (''1''  ''2''  ''%'')';prepare p1 as 'select i c1 c2 from ct where c1 in (? ?) and c2 like ?';execute p1 using 'values (''1''  ''2''  ''%'')';prepare p1 as 'select i c1 c2 from ct where c1 in (''2'' ''1'') and c2 like ?';execute p1 using 'values (''%'')';prepare p1 as 'select i c1 c2 from ct where c1 in (''2'' ?) and c2 like ?';execute p1 using 'values (''1''  ''%'')';The actual assertion is thrown because multiprobing expects the start and stop keys to be same value. But something about the LIKE parameter violates that expectation:ERROR XJ001: Java exception: 'ASSERT FAILED All multi-probing result sets are expected to have a single key that is both the start key AND the stop key  but that is not the case.: org.apache.derby.shared.common.sanity.AssertFailure'.This is a regression introduced by the DERBY-47 changes; everything runs fine in 10.2 and earlier.,0,0
jdbcapi/metadata.java and jdbcapi/odbc_metadata.java fail because of new procedure SYSCS_UTIL SYSCS_GET_USER_ACCESS,The following failure occurs with Rev: 543499  likely due to checkin of DERBY-2735failure Details:                 Diff file derbyall/derbylang/metadata.diff             Start: metadata jdk1.6.0_01 derbyall:derbylang 2007-06-01 12:37:31 ***59a60&gt; null SYSCS_UTIL SYSCS_GET_USER_ACCESS org.apache.derby.catalog.SystemProcedures.SYSCS_GET_USER_ACCESS xxxxGENERATED-IDxxxx78a80&gt; null SYSCS_UTIL SYSCS_GET_USER_ACCESS org.apache.derby.catalog.SystemProcedures.SYSCS_GET_USER_ACCESS xxxxGENERATED-IDxxxx93a96&gt; null SYSCS_UTIL SYSCS_GET_USER_ACCESS org.apache.derby.catalog.SystemProcedures.SYSCS_GET_USER_ACCESS xxxxGENERATED-IDxxxx107a111&gt; null SYSCS_UTIL SYSCS_GET_USER_ACCESS org.apache.derby.catalog.SystemProcedures.SYSCS_GET_USER_ACCESS xxxxGENERATED-IDxxxx136a141 142&gt; null SYSCS_UTIL SYSCS_GET_USER_ACCESS  4 12 VARCHAR 128 256 null null 1 null 256 0 YES xxxxGENERATED-IDxxxx 1 -1&gt; null SYSCS_UTIL SYSCS_GET_USER_ACCESS USERNAME 1 12 VARCHAR 128 256 null null 1 null 256 1 YES xxxxGENERATED-IDxxxx 1 0Test Failed. End: metadata jdk1.6.0_01 derbyall:derbylang 2007-06-01 12:37:40 ***            Diff file derbyall/derbylang/odbc_metadata.diff             Start: odbc_metadata jdk1.6.0_01 derbyall:derbylang 2007-06-01 12:37:45 ***89a90&gt; null SYSCS_UTIL SYSCS_GET_USER_ACCESS org.apache.derby.catalog.SystemProcedures.SYSCS_GET_USER_ACCESS xxxxGENERATED-IDxxxx108a110&gt; null SYSCS_UTIL SYSCS_GET_USER_ACCESS org.apache.derby.catalog.SystemProcedures.SYSCS_GET_USER_ACCESS xxxxGENERATED-IDxxxx123a126&gt; null SYSCS_UTIL SYSCS_GET_USER_ACCESS org.apache.derby.catalog.SystemProcedures.SYSCS_GET_USER_ACCESS xxxxGENERATED-IDxxxx137a141&gt; null SYSCS_UTIL SYSCS_GET_USER_ACCESS org.apache.derby.catalog.SystemProcedures.SYSCS_GET_USER_ACCESS xxxxGENERATED-IDxxxx166a171 172&gt; null SYSCS_UTIL SYSCS_GET_USER_ACCESS  4 12 VARCHAR 128 256 null null 1 null 256 0 YES xxxxGENERATED-IDxxxx 1 -1&gt; null SYSCS_UTIL SYSCS_GET_USER_ACCESS USERNAME 1 12 VARCHAR 128 256 null null 1 null 256 1 YES xxxxGENERATED-IDxxxx 1 0Test Failed. End: odbc_metadata jdk1.6.0_01 derbyall:derbylang 2007-06-01 12:37:55 ***,0,0
testLoadJavaClassIndirectly & als fails on JVM 1.4 with 'Unexpected SQL state. expected: but was:'  'Jar file 'MY_JAVA' already exists in Schema 'EMC'',1) testLoadJavaClassDirectly(org.apache.derbyTesting.functionTests.tests.lang.DatabaseClassLoadingTest)java.sql.SQLException: Jar file 'MY_JAVA' already exists in Schema 'EMC'.2) testLoadJavaClassDirectly2(org.apache.derbyTesting.functionTests.tests.lang.DatabaseClassLoadingTest)java.sql.SQLException: Jar file 'MY_JAVA' already exists in Schema 'EMC'.3) testLoadJavaClassDirectly3(org.apache.derbyTesting.functionTests.tests.lang.DatabaseClassLoadingTest)java.sql.SQLException: Jar file 'MY_JAVA' already exists in Schema 'EMC'.4) testLoadDerbyClassIndirectly(org.apache.derbyTesting.functionTests.tests.lang.DatabaseClassLoadingTest)java.sql.SQLException: Jar file 'MY_JAVA' already exists in Schema 'EMC'.1) testLoadJavaClassIndirectly(org.apache.derbyTesting.functionTests.tests.lang.DatabaseClassLoadingTest)junit.framework.ComparisonFailure: Unexpected SQL state. expected:&lt;&#91;38000&#93;&gt; but was:&lt;&#91;XJ001&#93;&gt;See e.g.http://dbtg.thresher.com/derby/test/Daily/jvm1.4/testing/Limited/testSummary-543922.htmlhttp://dbtg.thresher.com/derby/test/trunk16/jvmAll/testing/Limited/testSummary-543945.html,0,0
org.apache.derby.impl.drda.DDMWriter might swallow unexpected exceptions,Some methods in org.apache.derby.impl.drda.DDMWriter catch Exception and print a message about unsupported encoding. They should instead catch the specific exception UnsupportedEncodingException and let all other exceptions propagate up the call stack.,0,0
Client connections should not fail if permission is not granted to read derby.client.traceLevel  and derby.client.traceDirectory,Running the 10.2 network server tests with the 10.3 server  most tests fail with:AccessControlException: Access denied java.util.Property derby.client.traceLevel readdue to DERBY-1275. This can break existing applications that don't have this permission and should be a non-fatal warning if permission is not granted.,1,0
testBlobAfterCommit(....jdbcapi.BlobClob4BlobTest) fails with 'Unexpected SQL state. expected: but was:',testBlobAfterCommit(org.apache.derbyTesting.functionTests.tests.jdbcapi.BlobClob4BlobTest)junit.framework.ComparisonFailure: Unexpected SQL state. expected:&lt;XJ&#91;073&#93;&gt; but was:&lt;XJ&#91;215&#93;&gt;after r544777 / DERBY-2729See http://dbtg.thresher.com/derby/test/tinderbox_trunk16/jvm1.6/testing/testlog/SunOS-5.10_i86pc-i386/544778-org.apache.derbyTesting.functionTests.suites.All_diff.txt,0,0
ij 'describe' built in command cannot describe a table named 'run',steps to duplicate:(attach ij to any database)ij&gt; create table run (i int);0 rows inserted/updated/deletedij&gt; desc run;ERROR 42X01: Syntax error: Encountered 'desc' at line 1  column 1.ij&gt; I think this is a parser problem within ij where the 'run' is taken as a token and that token is not included in the definition of a tablename expression in the grammer (should be an easy fix).,0,0
make entry for clob in connection so that temporary file is removed when a connection is closed or transaction is commited/rolledback,,0,0
DatabaseMetaData .locatorsUpdateCopy() should return true,Since updates made to a BLOB or CLOB value in Derby is made on a copy  DatabaseMetaData .locatorsUpdateCopy() call should return true. For the embedded driver the functionality to update a LOB value is new in 10.3. For the client driver  updates have been possible in prior releases  and locatorsUpdateCopy() has returned false. That behavior was wrong since the client updated a main-memory copy  not the values in the database. For 10.3  the client will use a locator based implementation which will rely on the behavior of the embedded driver. Hence  locatorsUpdateCopy() should return true in both cases.,0,0
Obscure error messages when using SSL in various combinations,I ran clients with various ssl configurations on their urls and startup options against servers with various ssl configurations. I will attach an html file recording my results. I feel that many of the error conditions raised diagnostics which were too obscure to be helpful. I think this will be burdensome to tech support.,1,0
ASSERT failure with sane build if DISTINCT and ORDER BY are present in a query that selects from a diagnostic table function.,Attempts to execute the following query will lead to an ASSERT failure with sane jars:ij&gt; select distinct * from table(syscs_diag.space_table('T1')) X order by 3;ERROR XJ001: Java exception: 'ASSERT FAILED markOrderingDependent() not expected to be called for org.apache.derby.impl.sql.compile.FromVTI: org.apache.derby.shared.common.sanity.AssertFailure'.Stack trace is: at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:162) at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:147) at ResultSetNode.markOrderingDependent(ResultSetNode.java:1881) at SingleChildResultSetNode.markOrderingDependent(SingleChildResultSetNode.java:578) at SingleChildResultSetNode.markOrderingDependent(SingleChildResultSetNode.java:578) at SingleChildResultSetNode.markOrderingDependent(SingleChildResultSetNode.java:578) at SelectNode.genProjectRestrict(SelectNode.java:1409) at SelectNode.modifyAccessPaths(SelectNode.java:1816) at SingleChildResultSetNode.modifyAccessPaths(SingleChildResultSetNode.java:439) at DMLStatementNode.optimizeStatement(DMLStatementNode.java:307) at CursorNode.optimizeStatement(CursorNode.java:515)I was able to avoid this by adding an empty implementation of 'markOrderingDependent' to the FromVTI class  so that's probably the fix that I will post (after looking a bit more closely at the code to see if this makes sense).,0,0
calling getByteLength on org.apache.derby.impl.jdbc.StoreStreamClob makes BinaryStream  fetched before this call  unusable,StoreStreamClob.getByteLength first resets the internal stream and then reads the entire stream. Due to this any read on Stream obtained by StoreStreamClob.getRawByteStream returns -1.StoreStreamClob is a read only InternalClob  so probably keeping the length in a variable will be good idea.,0,0
Assessing blob (when its linked to DVD stream  ie large blob) corrupts stream fetched prior to this access.,,0,0
ij doesn't start with J2ME / JSR169 / weme6.1 because attempting to find java.sql.Driver if ij.protocol property is specified,When starting ij with the following command:ij -jcl:foun11 -Xbootclasspath/a:&lt;path_to_jdbc.jar&gt; org.apache.derby.tools.ij -p derby.propertiesand derby.properties contains the following:-----------------ij.database=jdbc:derby:bladb;create=trueij.protocol=jdbc:derby:ij.showNoConnectionsAtStart=trueij.showNoCountForSelect=true DataSource properties  only used if ij.dataSource is setij.dataSource.databaseName=bladbij.dataSource.createDatabase=createij.dataSource=org.apache.derby.jdbc.EmbeddedSimpleDataSource------------------ij does not start and instead gives the following stack trace:Exception in thread 'main' java.lang.NoClassDefFoundError: java.sql.Driver at java.lang.ClassLoader.defineClassImpl(Native Method) at java.lang.ClassLoader.defineClass(ClassLoader.java:226) at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:109) at java.net.URLClassLoader.findClassImpl(URLClassLoader.java:1029) at java.net.URLClassLoader$4.run(URLClassLoader.java:549) at java.security.AccessController.doPrivileged(AccessController.java:213) at java.net.URLClassLoader.findClass(URLClassLoader.java:547) at com.ibm.oti.vm.URLSystemClassLoader.findClass(URLSystemClassLoader.java:27) at java.lang.ClassLoader.loadClass(ClassLoader.java:606) at com.ibm.oti.vm.URLSystemClassLoader.loadClass(URLSystemClassLoader.java:60) at java.lang.ClassLoader.loadClass(ClassLoader.java:563) at java.lang.Class.forNameImpl(Native Method) at java.lang.Class.forName(Class.java:114) at org.apache.derby.impl.tools.ij.util.loadDriver(util.java:849) at org.apache.derby.impl.tools.ij.util.loadDriverIfKnown(util.java:833) at org.apache.derby.impl.tools.ij.util.startJBMS(util.java:476) at org.apache.derby.impl.tools.ij.util.startJBMS(util.java:585) at org.apache.derby.impl.tools.ij.ConnectionEnv.init(ConnectionEnv.java:64) at org.apache.derby.impl.tools.ij.utilMain.initFromEnvironment(utilMain.java:179) at org.apache.derby.impl.tools.ij.Main.&lt;init&gt;(Main.java:230) at org.apache.derby.impl.tools.ij.Main.getMain(Main.java:193) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:178) at org.apache.derby.impl.tools.ij.Main.main(Main.java:73) at org.apache.derby.tools.ij.main(ij.java:67)The properties file is an example of the 'old test harness' properties files. The test harness would get sql scripts tested with J2ME by stripping away the ij.protocol and ij.database specifications.In another bug - DERBY-1218 - it was suggested ij.protocol be blanked out (in tools/ij/util.java?) with J2ME.Another approach would be to check for ij.protocol or ij.database setting when we have a datasource and we're using J2ME.,0,0
Error messages for deadlocks contain less information than in 10.2,In 10.2  an error message for a deadlock would look like this:ERROR 40001: A lock could not be obtained due to a deadlock  cycle of locks and waiters is:Lock : ROW  T  (1 8) Waiting XID : {235  S}   APP  select * from t where id = 2 Granted XID : {238  X} Lock : ROW  T  (1 7) Waiting XID : {238  S}   APP  select * from t where id = 1 Granted XID : {235  X} . The selected victim is XID : 235.On trunk  the same deadlock would be reported asjava.sql.SQLException: A lock could not be obtained due to a deadlock  cycle of locks and waiters is:Lock : ROW  T  (1 8) Waiting XID : {org.apache.derby.impl.services.locks.LockSpace@94884d  S}  Granted XID : {org.apache.derby.impl.services.locks.LockSpace@da6bf4  X} Lock : ROW  T  (1 7) Waiting XID : {org.apache.derby.impl.services.locks.LockSpace@da6bf4  S}  Granted XID : {org.apache.derby.impl.services.locks.LockSpace@94884d  X} . The selected victim is XID : org.apache.derby.impl.services.locks.LockSpace@94884d.That is  the transaction id and the failing statement are not shown.,0,0
Rewrite ClobUpdatableReader constructors,When the fix for DERBY-2806 is in place  the current implementation of ClobUpdateableReader will fail.This patch is a preparation for the mentioned issue  and I have also removed some 'internal' (package private) methods from EmbedClob and replaced it with a single one. Instead of writing methods that forwards calls to the underlying InternalClob  the method getInternalClob will return the internal clob itself. This seems more in place  since the method getByteLength does not belong in EmbedClob. It also comes with a warning that using the reference to the internal clob object requires the caller to take more care. Second  isWritable() does not belong to EmbedClob either  as a Clob is always writable (unless the database/connection itself is read/only). However  the internal clob representation may be read-only  in case EmbedClob must clone the content and create a writable representation.The fix leaves more of the handling of implementation details to the InternalClob itself.,0,0
Improve error reporting  fix whitespace/formatting issues and replace tabs in UTF8Reader,I plan to do the following changes to UTF8Reader: Improve the error reporting when hitting a UTF8 decoding error (currently an UTFDataFormatException with no message). This might also lead to deleting one helper method for generating an exception (the one with no message). Improve error reporting for trying to use the reader after it has been closed (currently an IOException with no message). Remove trailing spaces  and add a few newlines here and there. Replace tabs in the file with spaces.Now  the last point can be discussed  but here are my arguments for doing it: The file now has a mix of tabs and spaces (but still more tabs). Spaces are the preferred/required method of indentation. I want to get it fixed before the branch is cut  which makes it easier to port fixes from trunk/10.3-NEXT to 10.3. If I don't make it for 10.3  I won't do it. I don't see it as very likely that we will back-port major fixes to this class on the 10.2 branch. If we have to  I will volunteer  Since so much else of the Clob 'infrastructure' has changed recently  this seems like a good time to do the clean-up.Please raise your concern as soon as possible if you want to veto these changes. I do plan to commit them tomorrow.,0,0
Rename ClobStreamControl to TemporaryClob,Since the original submission  the situation has changed quite a lot and the original name no longer fits as well as it did before.The class is changed to TemporaryClob  signalling that the Clob object is living temporarily outside the database. This is true for all scenarios  except for small Clobs that are stored as non-stream objects in the database. The general contract is that as soon as a change is made to the Clob  it becomes a temporary Clob. Unless the user reinserts the Clob (i.e. updateRow  updateClob + execute)  the changes will be lost. This is also true for Clobs created with Connection.createClob. If it is not explicitly inserted into the database  it is lost.,0,0
ParameterMetaDataJdbc30 fails for weme6.1  which prevents rest of suites.All from completing.,With the addtion of the ParameterMetaDataJdbc30 JUnit test (DERBY-2658)  suites.All has been failing with weme6.1. It turns out the that new ParameterMetaDataJdbc30Test fails with the following error: Failed to invoke suite():java.lang.NoClassDefFoundError: java.sql.ParameterMetaData which prevents suites.All from continuing and thus no results can be gathered.It might be good to disable the test for weme6.1 at least in the short term so that rest of suites.All can run cleanly again. Not sure if that's a complete solution or just a temporary one until the test can be fixed...,0,0
BUILDING.txt doesn't mention junit.jar in list of jars installed in tools/java,BUILDING.txt contains this paragraph:Note: After following the steps in sections 2.2.4-2.2.8 of thisdocument  you should have the following:${derby.source}/tools/java/empty.jar${derby.source}/tools/java/geronimo-spec-servlet-2.4-rc4.jar${derby.source}/tools/java/jakarta-oro-2.0.8.jar${derby.source}/tools/java/javacc.jar${derby.source}/tools/java/osgi.jar----Since section 2.2.5 mentions how to install junit.jar into ${derby.source}/tools/java  the list should also include junit.jar.Also  since the paragraph refers to sections 2.2.4-2.2.8  it should be located below section 2.2.8 (currently  it's between 2.2.7 and 2.2.8).,0,0
iepnegativetests_ES.sql fails: new canon needed?,See http://dbtg.thresher.com/derby/test/Daily/jvm1.6/testing/Limited/testSummary-550528.html / w2003&lt;method&gt;i18n/iepnegativetests_ES.sql&lt;/method&gt;&lt;signature&gt;&lt; ERROR XJ001: Excepci EnC:&gt;243&lt; n de Java: 'extout/nodir/t1.dat (No such file or directory): java.io.FileNotFoundException'.49a49&gt; ERROR XJ001: Excepci EnC:&gt;243&lt; n de Java: 'extout/nodir/t1.dat (The system cannot find the path specified): java.io.FileNotFoundException'.&lt;/signature&gt;,0,0
NetworkServer not accepting connections with default security manager on Ipv6 machines,While running tests on Ipv6 machines using the 10.3 jars with the default security manager  I had the following findings/questionsI started the server like this java org.apache.derby.drda.NetworkServerControl start -h 2002:92a:8f7a:13:9:42:74:19and the server started with the following commandSecurity manager installed using the Basic server security policy.Apache Derby Network Server - 10.3.1.0 beta - (548006) started and ready to accept connections on port 1527 at 2007-06-25 23:44: 36.835 GMTSo I think the server is using the default security manager. Then when I tried to get conenction though ijgot the following error messageAccess denied (java.net.SocketPermission &#91;2002:92a:8f7a:13:9:42:73:218&#93;:34016 accept resolve)java.security.AccessControlException: Access denied (java.net.SocketPermission &#91;2002:92a:8f7a:13:9:42:73:218&#93;:34016 accept resolve)  at java.security.AccessController.checkPermission(AccessController.java:104) at java.lang.SecurityManager.checkPermission(SecurityManager.java:547) at java.lang.SecurityManager.checkAccept (SecurityManager.java:1172) at java.net.ServerSocket.implAccept(ServerSocket.java:466) at java.net.ServerSocket.accept(ServerSocket.java:433) at org.apache.derby.impl.drda.ClientThread$1.run (Unknown Source) at java.security.AccessController.doPrivileged(AccessController.java:242) at org.apache.derby.impl.drda.ClientThread.run(Unknown Source)I had the derby.properties file like thisderby.database.sqlAuthorization=truederby.connection.requireAuthentication=truederby.infolog.append=truederby.authentication.provider=BUILTINderby.stream.error.logSeverityLevel=0#derby.language.logStatementText=true User's Definitionsderby.user.user2=pass2,1,0
CREATE TABLE AS  does not maintain the collation for character types.,create table t as select tablename from sys.systables with no data;This creates a column TABLENAME with collation based upon the user schema  but the type of sys.systables.tablename has collation UCS_BASIC.The required behaviour should be verified with the SQL standard (11.3 SR6)  but since collation is an attribute of a type it seems logical that the collation is maintained by the create.Fixing this to keep the collation of the system column will cause problems though as there would be no way to recreate this table through a regular create table  say if the schema is dumped and recreated using ddlutils.I think this is critical as fixing it after a release would lead to a change in behaviour for applications.,0,0
Wrong connection object used in EmbedConnection.clearLOBMapping(),I think there are two bugs in EmbedConnection.clearLOBMapping(): 1) It checks if lobHashMap is non-null  but it should have checked rootConnection.lobHashMap. 2) It calls getlobHMObj().clear() regardless of whether there is a HashMap. This creates a HashMap object even though it's not needed  and all the subsequent transactions on that connection have to perform cleanup on that object.,0,1
Closing a resultset after retrieving a large > 32665 bytes value with Network Server does not release locks,This is the same issue as DERBY-255 (https://issues.apache.org/jira/browse/DERBY-255). The test attached to DERBY-255 shows the locks being not released. Everything is fine when using Derby 10.1.3.1 .I would think it's a regression bug.Output from sysinfo:------------------ Java-Informationen ------------------Java-Version: 1.6.0_01Java-Anbieter: Sun Microsystems Inc.Java-Home: C:/work/applications/development/java/jdk1.6u1-SE/jreJava-Klassenpfad: C:/work/applications/development/derby-10.2.2.0/lib/derby.jar;C:/work/applications/development/derby-0.2.2.0/lib/derbynet.jar;C:/work/applications/development/derby-10.2.2.0/lib/derbyclient.jar;C:/work/applications/develpment/derby-10.2.2.0/lib/derbytools.jarName des Betriebssystems: Windows XPArchitektur des Betriebssystems: x86Betriebssystemversion: 5.1Java-Benutzername: thomas.niessenJava-Benutzerausgangsverzeichnis: C:/Dokumente und Einstellungen/thomas.niessenJava-Benutzerverzeichnis: C:/work/applications/development/derby-10.2.2.0java.specification.name: Java Platform API Specificationjava.specification.version: 1.6--------- Derby-Informationen --------JRE - JDBC: Java SE 6 - JDBC 4.0&#91;C:/work/applications/development/derby-10.2.2.0/lib/derby.jar&#93; 10.2.2.0 - (485682)&#91;C:/work/applications/development/derby-10.2.2.0/lib/derbytools.jar&#93; 10.2.2.0 - (485682)&#91;C:/work/applications/development/derby-10.2.2.0/lib/derbynet.jar&#93; 10.2.2.0 - (485682)&#91;C:/work/applications/development/derby-10.2.2.0/lib/derbyclient.jar&#93; 10.2.2.0 - (485682)----------------------------------------------------------------------- Informationen zur Lﾃｵndereinstellung -----------------Aktuelle Lﾃｵndereinstellung: [Deutsch/Deutschland &#91;de_DE&#93;]Es wurde Unterstﾂｳtzung fﾂｳr die folgende Lﾃｵndereinstellung gefunden: &#91;cs&#93; Version: 10.2.2.0 - (485682)Es wurde Unterstﾂｳtzung fﾂｳr die folgende Lﾃｵndereinstellung gefunden: &#91;de_DE&#93; Version: 10.2.2.0 - (485682)Es wurde Unterstﾂｳtzung fﾂｳr die folgende Lﾃｵndereinstellung gefunden: &#91;es&#93; Version: 10.2.2.0 - (485682)Es wurde Unterstﾂｳtzung fﾂｳr die folgende Lﾃｵndereinstellung gefunden: &#91;fr&#93; Version: 10.2.2.0 - (485682)Es wurde Unterstﾂｳtzung fﾂｳr die folgende Lﾃｵndereinstellung gefunden: &#91;hu&#93; Version: 10.2.2.0 - (485682)Es wurde Unterstﾂｳtzung fﾂｳr die folgende Lﾃｵndereinstellung gefunden: &#91;it&#93; Version: 10.2.2.0 - (485682)Es wurde Unterstﾂｳtzung fﾂｳr die folgende Lﾃｵndereinstellung gefunden: &#91;ja_JP&#93; Version: 10.2.2.0 - (485682)Es wurde Unterstﾂｳtzung fﾂｳr die folgende Lﾃｵndereinstellung gefunden: &#91;ko_KR&#93; Version: 10.2.2.0 - (485682)Es wurde Unterstﾂｳtzung fﾂｳr die folgende Lﾃｵndereinstellung gefunden: &#91;pl&#93; Version: 10.2.2.0 - (485682)Es wurde Unterstﾂｳtzung fﾂｳr die folgende Lﾃｵndereinstellung gefunden: &#91;pt_BR&#93; Version: 10.2.2.0 - (485682)Es wurde Unterstﾂｳtzung fﾂｳr die folgende Lﾃｵndereinstellung gefunden: &#91;ru&#93; Version: 10.2.2.0 - (485682)Es wurde Unterstﾂｳtzung fﾂｳr die folgende Lﾃｵndereinstellung gefunden: &#91;zh_CN&#93; Version: 10.2.2.0 - (485682)Es wurde Unterstﾂｳtzung fﾂｳr die folgende Lﾃｵndereinstellung gefunden: &#91;zh_TW&#93; Version: 10.2.2.0 - (485682),0,0
INSERT and UPDATES succeed when permission has not been granted.,GrantRevokeTest had assert methods (assertInsertPrivilege etc.) of the formtry { s.execute(command)} catch (SQLException sqle){ if (!hasPrivilege)  assertSQLState('42502'  e); else fail(...);}Note that no fail() assert was in the try portion after the SQL execution. The statement should not work if hasPrivilege is false  but the test will incorrectly pass if the statement succeeds. I added fail asserts with revision 552922 like:if (!hasPrivilege) fail('expected no INSERT permission on table');but these two for INSERT and UPDATE caused the test to fail (about 6 fixtures fail) indicating that the statement succeeds even if the permission is not granted.It could be a test problem but needs some investigation.The asserts for assertInsertPrivilege and asserUpdatePrivilege are commented out to stop the test failing.,1,0
AS IDENTITY (START WITH -9223372036854775808) fails,When creating a tableAS IDENTITY (START WITH -9223372036854775808)fails butAS IDENTITY (START WITH -9223372036854775807)succeeds.Guess this is a parsing SQL problem as the absolute value appears to be held in a long  which is not quite long enough at the positive end.,0,0
SimpleStringOperatorNode in it's bindExpression method generates a character string CAST if required but does not set the correct collation.,Following query should run into error if run in a territory based database SELECT TABLENAME FROM SYS.SYSTABLES WHERE UPPER(CURRENT_DATE) = TABLENAME;When a CAST node is generated on top of CURRENT_DATE to create a character string type  we do not set the collation of that character string type and hence it always ends up getting the default which is collation derivation IMPLICIT and collation type UCS_BASIC. That does not sound right. There might be other places where we generate CAST node to create a character string type. We should check if the collation is set correctly for them.,0,0
Implement a buffer manager using java.util.concurrent classes,There are indications that the buffer manager is a bottleneck for some types of multi-user load. For instance  Anders Morken wrote this in a comment on DERBY-1704: 'With a separate table and index for each thread (to remove latch contention and lock waits from the equation) we (...) found that org.apache.derby.impl.services.cache.Clock.find()/release() caused about 5 times more contention than the synchronization in LockSet.lockObject() and LockSet.unlock(). That might be an indicator of where to apply the next push'.It would be interesting to see the scalability and performance of a buffer manager which exploits the concurrency utilities added in Java SE 5.,0,1
DDMReader.readLengthAndCodePoint() decodes long integer incorrectly,DDMReader.readLengthAndCodePoint() contains code to decode a long integer from a byte array. This code is broken since it uses int operations and not long operations in the decoding. The long might be encoded using four  six or eight bytes  and since Derby currently always uses the four bytes encoding  the bug is not exposed in the current code.,0,0
ERROR 22011: The second or third argument of the SUBSTR function is out of range   with data concatenation in group by query.,CREATE TABLE A (C CHAR(10) NOT NULL  D DATE NOT NULL  DC DECIMAL(6 2));INSERT INTO A VALUES ('aaa'  DATE('2007-07-10')  500.00); SELECT A.C  SUBSTR (MAX(CAST(A.D AS CHAR(10)) || CAST(A.DC AS CHAR(8)))  11  8) AS BUG FROM A GROUP BY A.C;results in a 22011 error on the select.ij&gt; C |BUG-------------------ERROR 22011: The second or third argument of the SUBSTR function is out of rangeNote that the ResultSetMetaData seems to indicate to ij that the column width of 'BUG' is four instead of 18.,0,0
In soft upgrade mode  the metadata queries do not get compiled in SYS schema. This will cause problems in future releases of Derby.,EmbedDatabaseMetaData implements metadata queries. The implementation of metadata queries in EmbedDatabaseMetaData checks if we are in soft upgrade mode (getPreparedQuery() has following code)if (notInSoftUpgradeMode()) s = getPreparedQueryUsingSystemTables(queryName  net);else { try { //Can't use stored prepared statements because we are in soft upgrade //mode and hence need to get metadata sql from metadata.properties file //or metadata_net.properties String queryText = getQueryFromDescription(queryName  net); s = getEmbedConnection().prepareMetaDataStatement(queryText); } catch (Throwable t) { throw handleException(t); } }So  when running in soft upgrade mode  we do not go through SYSSTATEMENT but this will cause the metadata query to run in whatever the current schema may be rather than in SYS schema. This is not a problem in Derby 10.3 release because during soft upgarde  the collation will always be UCS_BASIC and hence collation mismatch can't happen.But in Derby 10.3  a user can create a database with territory based collation. When such a database will be in soft upgrade mode for say Derby 10.4  the metadata queries will run into problem if they are run in a user schema. This is because in soft upgrade mode  we do not go through SYSSTATEMENTS and instead compile the metadata queries in current schema. If the current schema is user schema  then character string literals in metadata queries will get the collation type of territory based and when compared with character string colunms from SYS tables with collation type of UCS_BASIC  we will end up getting compilation error for the metadata queries. So  before the next release  we will have to fix this problem. One solution may be to somehow make the current compilation schema as SYS when running the metadata queries in soft upgrade mode.,0,0
BatchUpdateTest.testAssociatedParams test fails with collation with exception: Java exception: 'ASSERT FAILED type of inserted column[0] = org.apache.derby.iapi.types.CollatorSQLChartype of template column[0] = org.apache.derby.iapi.types.SQLChar:,BatchUpdateTest.testAssociatedParams test fails with collation with exception: java.sql.SQLException: Java exception: 'ASSERT FAILED type of inserted column&#91;0&#93; = org.apache.derby.iapi.types.CollatorSQLChartype of template column&#91;0&#93; = org.apache.derby.iapi.types.SQLChar: org.apache.derby.shared.common.sanity.AssertFailure'.Full trace below:Java exception: 'ASSERT FAILED type of inserted column&#91;0&#93; = org.apache.derby.iapi.types.CollatorSQLChartype of template column&#91;0&#93; = org.apache.derby.iapi.types.SQLChar: org.apache.derby.shared.common.sanity.AssertFailure'.at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88) at org.apache.derby.impl.jdbc.Util.javaException(Util.java:245) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:1572) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1293) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1652) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:299) at org.apache.derbyTesting.functionTests.tests.jdbcapi.BatchUpdateTest.testAssociatedParams(BatchUpdateTest.java:416) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:615) at junit.framework.TestCase.runTest(TestCase.java:154) at junit.framework.TestCase.runBare(TestCase.java:127) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95) at junit.framework.TestResult$1.protect(TestResult.java:106) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.framework.TestResult.run(TestResult.java:109) at junit.framework.TestCase.run(TestCase.java:118) at junit.framework.TestSuite.runTest(TestSuite.java:208) at junit.framework.TestSuite.run(TestSuite.java:203) at junit.framework.TestSuite.runTest(TestSuite.java:208) at junit.framework.TestSuite.run(TestSuite.java:203) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.framework.TestSuite.runTest(TestSuite.java:208) at junit.framework.TestSuite.run(TestSuite.java:203) at junit.framework.TestSuite.runTest(TestSuite.java:208) at junit.framework.TestSuite.run(TestSuite.java:203) at junit.framework.TestSuite.runTest(TestSuite.java:208) at junit.framework.TestSuite.run(TestSuite.java:203) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:128) at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)Caused by: org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED type of inserted column&#91;0&#93; = org.apache.derby.iapi.types.CollatorSQLChartype of template column&#91;0&#93; = org.apache.derby.iapi.types.SQLChar at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:162) at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:147) at org.apache.derby.impl.store.access.btree.OpenBTree.isIndexableRowConsistent(OpenBTree.java:529) at org.apache.derby.impl.store.access.btree.BTreeController.doIns(BTreeController.java:385) at org.apache.derby.impl.store.access.btree.BTreeController.insert(BTreeController.java:1035) at org.apache.derby.impl.store.access.btree.index.B2IController.insert(B2IController.java:211) at org.apache.derby.impl.sql.execute.IndexChanger.insertAndCheckDups(IndexChanger.java:455) at org.apache.derby.impl.sql.execute.IndexChanger.doInsert(IndexChanger.java:398) at org.apache.derby.impl.sql.execute.IndexChanger.insert(IndexChanger.java:605) at org.apache.derby.impl.sql.execute.IndexSetChanger.insert(IndexSetChanger.java:268) at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(RowChangerImpl.java:453) at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1024) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:497) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1203) ... 54 more,0,0
ERROR 42ZA2 creating table with check constraint with literal comparison,I cannot create the following table with a collated database. EMPNAME should be TERRITORY_BASED collation I think  but perhaps is not initialized in time for the check constraint processing.ij&gt; connect 'jdbc:derby:nordb;create=true;territory=no_NO;collation=TERRITORY_BASED';ij&gt; CREATE TABLE STAFF9 (EMPNUM CHAR(3) NOT NULL CONSTRAINT STAFF9_PK PRIMARY KEY  EMPNAME CHAR(20)  GRADE DECIMAL(4)  CITY CHAR(15)  CONSTRAINT STAFF9_EMPNAME CHECK (EMPNAME NOT LIKE 'T%'));ERROR 42ZA2: Operand of LIKE predicate with type CHAR(20) and collation UCS_BASIC is not compatable with LIKE pattern operand with type CHAR(2) and collation TERRITORY_BASED.,0,0
TriggerTest.testTypesINActionStatement fails with 'ASSERT FAILED col1.getClass() (class org.apache.derby.iapi.types.SQLClob) expected to be the same as col2.getClass() (class org.apache.derby.iapi.types.CollatorSQLClob),I have not yet been able to create a stand-alone repro but the test TriggerTest.testTypesINActionStatement fails with 'ASSERT FAILED col1.getClass() (class org.apache.derby.iapi.types.SQLClob) expected to be the same as col2.getClass() (class org.apache.derby.iapi.types.CollatorSQLClob)Failed statement is: sqlMain = 'SELECT ID  XMLSERIALIZE(V AS CLOB)  ' + 'XMLSERIALIZE(V AS CLOB) FROM T_MAIN ORDER BY 1';2) testTypesInActionStatement(org.apache.derbyTesting.functionTests.tests.lang.TriggerTest)java.sql.SQLException: Java exception: 'ASSERT FAILED col1.getClass() (class org.apache.derby.iapi.types.SQLClob) expected to be the same as col2.getClass() (class org.apache.derby.iapi.types.CollatorSQLClob): org.apache.derby.shared.common.sanity.AssertFailure'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88) at org.apache.derby.impl.jdbc.Util.javaException(Util.java:245) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:1572) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1293) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:596) at org.apache.derby.impl.jdbc.EmbedStatement.executeQuery(EmbedStatement.java:153) at org.apache.derbyTesting.functionTests.tests.lang.TriggerTest.actionTypesCompareMainToAction(TriggerTest.java:769) at org.apache.derbyTesting.functionTests.tests.lang.TriggerTest.actionTypesInsertTest(TriggerTest.java:546) at org.apache.derbyTesting.functionTests.tests.lang.TriggerTest.actionTypeTest(TriggerTest.java:445) at org.apache.derbyTesting.functionTests.tests.lang.TriggerTest.testTypesInActionStatement(TriggerTest.java:427) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)Caused by: org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED col1.getClass() (class org.apache.derby.iapi.types.SQLClob) expected to be the same as col2.getClass() (class org.apache.derby.iapi.types.CollatorSQLClob) at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:162) at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:147) at org.apache.derby.impl.store.access.sort.MergeSort.checkColumnTypes(MergeSort.java:467) at org.apache.derby.impl.store.access.sort.MergeInserter.insert(MergeInserter.java:98) at org.apache.derby.impl.sql.execute.SortResultSet.loadSorter(SortResultSet.java:317) at org.apache.derby.impl.sql.execute.SortResultSet.openCore(SortResultSet.java:268) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(BasicNoPutResultSetImpl.java:258) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1203) ... 45 more,0,0
rs.moveToInsertRow() causes loss of connection with TERRITORY_BASED collation.,In the attached test case  rs.moveToInsertRow() causes loss of the connection with a TERRITORY_BASED collation database. With UCS_BASIC it is fine.,0,0
Convert jdbcapi/prepStamtNull.java to JUnit,,0,0
The ResultSet returned by DatabaseMetaData.getFunctions() does not contain a required column named FUNCTION_TYPE.,The FUNCTION_TYPE column  sandwiched between REMARKS and SPECIFIC_NAME  is supposed to describe the return type of the function.,0,0
Query involving CASE statement significantly slower in 10.3.1.4 than in 10.2.2.0,A select of a CASE statement that performed acceptably in 10.2.2.0 is very slow in 10.3.1.4 the first time it is executed.The following example ij script:ELAPSEDTIME ON;CREATE table test1(id integer);CREATE table test2(id varchar(10));SELECT CASE WHEN t.id = 1 THEN 'a' WHEN t.id = 2 THEN 'b' WHEN t.id = 3 THEN 'c' WHEN t.id = 4 THEN 'd' WHEN t.id = 5 THEN 'e' WHEN t.id = 6 THEN 'f' WHEN t.id = 7 THEN 'g' WHEN t.id = 8 THEN 'h' WHEN t.id = 11 THEN 'i' WHEN t.id = 12 THEN 'j'  WHEN t.id = 15 THEN 'k' WHEN t.id = 16 THEN 'l' WHEN t.id = 23 THEN 'm'  WHEN t.id = 24 THEN 'n' WHEN t.id = 27 THEN 'o' WHEN t.id = 31 THEN 'p' WHEN t.id = 41 THEN 'q' WHEN t.id = 42 THEN 'r' WHEN t.id = 50 THEN 's' ELSE (SELECT t2.id FROM test2 t2 ) ENDFROM test1 t;When run on 10.2.2.0 the select results in ELAPSED TIME = 187 milliseconds.When run on 10.3.1.4 the select results in ELAPSED TIME = 62281 milliseconds.,0,1
Insert into table with constraints fails if the table name is 'indicator' (or any other SQL keyword),I've runned the testcase against both 10.2.2.0 (latest stable) and 10.4.0.0 alpha (trunk) and results are the same.Sysinfo output:------------------ ﾐ侑ｽﾑ・ｾﾑﾐｼﾐｰﾑ・ｸﾑ・Java ------------------ﾐ漬ｵﾑﾑ・ｸﾑ・Java: 1.5.0_11ﾐ渙ｾﾑ・ひｰﾐｲﾑ禍ｸﾐｺ Java: Sun Microsystems Inc.ﾐ頒ｾﾐｼﾐｰﾑ威ｽﾐｸﾐｹ ﾐｺﾐｰﾑひｰﾐｻﾐｾﾐｳ Java: C:/java/jre-1.5.0ﾐ湲τび・ﾐｺﾐｻﾐｰﾑ・・ｾﾐｲ Java: D:/dev/workspaces/DerbyQuery/bin;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbytools.jar;D:/dev/src/db-derby-trunk-20070802/jars/sane/derby.jar;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbyclient.jar;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbyLocale_cs.jar;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbyLocale_de_DE.jar;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbyLocale_es.jar;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbyLocale_fr.jar;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbyLocale_hu.jar;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbyLocale_it.jar;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbyLocale_ja_JP.jar;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbyLocale_ko_KR.jar;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbyLocale_pl.jar;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbyLocale_pt_BR.jar;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbyLocale_zh_CN.jar;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbyLocale_zh_TW.jar;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbynet.jar;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbyrun.jarﾐ侑ｼﾑ・ﾐ榧｡: Windows XPﾐ績ﾑ・ｸﾑひｵﾐｺﾑびτﾐｰ ﾐ榧｡: x86ﾐ漬ｵﾑﾑ・ｸﾑ・ﾐ榧｡: 5.1ﾐ侑ｼﾑ・ﾐｿﾐｾﾐｻﾑ糊ｷﾐｾﾐｲﾐｰﾑひｵﾐｻﾑ・Java: dmitrygusevﾐ頒ｾﾐｼﾐｰﾑ威ｽﾐｸﾐｹ ﾐｺﾐｰﾑひｰﾐｻﾐｾﾐｳ ﾐｿﾐｾﾐｻﾑ糊ｷﾐｾﾐｲﾐｰﾑひｵﾐｻﾑ・Java: C:/Documents and Settings/dmitrygusevﾐ墟ｰﾑひｰﾐｻﾐｾﾐｳ ﾐｿﾐｾﾐｻﾑ糊ｷﾐｾﾐｲﾐｰﾑひｵﾐｻﾑ・Java: D:/dev/workspaces/DerbyQueryjava.specification.name: Java Platform API Specificationjava.specification.version: 1.5--------- ﾐ侑ｽﾑ・ｾﾑﾐｼﾐｰﾑ・ｸﾑ・Derby --------JRE - JDBC: J2SE 5.0 - JDBC 3.0&#91;D:/dev/src/db-derby-trunk-20070802/jars/sane/derby.jar&#93; 10.4.0.0 alpha - (???)&#91;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbytools.jar&#93; 10.4.0.0 alpha - (???)&#91;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbynet.jar&#93; 10.4.0.0 alpha - (???)&#91;D:/dev/src/db-derby-trunk-20070802/jars/sane/derbyclient.jar&#93; 10.4.0.0 alpha - (???)----------------------------------------------------------------------- ﾐ侑ｽﾑ・ｾﾑﾐｼﾐｰﾑ・ｸﾑ・ﾐｾ ﾐｻﾐｾﾐｺﾐｰﾐｻﾐｸ ------------------ﾐ｢ﾐｵﾐｺﾑτ禍ｰﾑ・ﾐｻﾐｾﾐｺﾐｰﾐｻﾑ・ [ﾑﾑτ・・ｺﾐｸﾐｹ/ﾐﾐｾﾑ・・ｸﾑ・&#91;ru_RU&#93;]ﾐ榧ｱﾐｽﾐｰﾑﾑσｶﾐｵﾐｽﾐｰ ﾐｿﾐｾﾐｴﾐｴﾐｵﾑﾐｶﾐｺﾐｰ ﾐｻﾐｾﾐｺﾐｰﾐｻﾐｸ: &#91;cs&#93; ﾐｲﾐｵﾑﾑ・ｸﾑ・ 10.4.0.0 alpha - (???)ﾐ榧ｱﾐｽﾐｰﾑﾑσｶﾐｵﾐｽﾐｰ ﾐｿﾐｾﾐｴﾐｴﾐｵﾑﾐｶﾐｺﾐｰ ﾐｻﾐｾﾐｺﾐｰﾐｻﾐｸ: &#91;de_DE&#93; ﾐｲﾐｵﾑﾑ・ｸﾑ・ 10.4.0.0 alpha - (???)ﾐ榧ｱﾐｽﾐｰﾑﾑσｶﾐｵﾐｽﾐｰ ﾐｿﾐｾﾐｴﾐｴﾐｵﾑﾐｶﾐｺﾐｰ ﾐｻﾐｾﾐｺﾐｰﾐｻﾐｸ: &#91;es&#93; ﾐｲﾐｵﾑﾑ・ｸﾑ・ 10.4.0.0 alpha - (???)ﾐ榧ｱﾐｽﾐｰﾑﾑσｶﾐｵﾐｽﾐｰ ﾐｿﾐｾﾐｴﾐｴﾐｵﾑﾐｶﾐｺﾐｰ ﾐｻﾐｾﾐｺﾐｰﾐｻﾐｸ: &#91;fr&#93; ﾐｲﾐｵﾑﾑ・ｸﾑ・ 10.4.0.0 alpha - (???)ﾐ榧ｱﾐｽﾐｰﾑﾑσｶﾐｵﾐｽﾐｰ ﾐｿﾐｾﾐｴﾐｴﾐｵﾑﾐｶﾐｺﾐｰ ﾐｻﾐｾﾐｺﾐｰﾐｻﾐｸ: &#91;hu&#93; ﾐｲﾐｵﾑﾑ・ｸﾑ・ 10.4.0.0 alpha - (???)ﾐ榧ｱﾐｽﾐｰﾑﾑσｶﾐｵﾐｽﾐｰ ﾐｿﾐｾﾐｴﾐｴﾐｵﾑﾐｶﾐｺﾐｰ ﾐｻﾐｾﾐｺﾐｰﾐｻﾐｸ: &#91;it&#93; ﾐｲﾐｵﾑﾑ・ｸﾑ・ 10.4.0.0 alpha - (???)ﾐ榧ｱﾐｽﾐｰﾑﾑσｶﾐｵﾐｽﾐｰ ﾐｿﾐｾﾐｴﾐｴﾐｵﾑﾐｶﾐｺﾐｰ ﾐｻﾐｾﾐｺﾐｰﾐｻﾐｸ: &#91;ja_JP&#93; ﾐｲﾐｵﾑﾑ・ｸﾑ・ 10.4.0.0 alpha - (???)ﾐ榧ｱﾐｽﾐｰﾑﾑσｶﾐｵﾐｽﾐｰ ﾐｿﾐｾﾐｴﾐｴﾐｵﾑﾐｶﾐｺﾐｰ ﾐｻﾐｾﾐｺﾐｰﾐｻﾐｸ: &#91;ko_KR&#93; ﾐｲﾐｵﾑﾑ・ｸﾑ・ 10.4.0.0 alpha - (???)ﾐ榧ｱﾐｽﾐｰﾑﾑσｶﾐｵﾐｽﾐｰ ﾐｿﾐｾﾐｴﾐｴﾐｵﾑﾐｶﾐｺﾐｰ ﾐｻﾐｾﾐｺﾐｰﾐｻﾐｸ: &#91;pl&#93; ﾐｲﾐｵﾑﾑ・ｸﾑ・ 10.4.0.0 alpha - (???)ﾐ榧ｱﾐｽﾐｰﾑﾑσｶﾐｵﾐｽﾐｰ ﾐｿﾐｾﾐｴﾐｴﾐｵﾑﾐｶﾐｺﾐｰ ﾐｻﾐｾﾐｺﾐｰﾐｻﾐｸ: &#91;pt_BR&#93; ﾐｲﾐｵﾑﾑ・ｸﾑ・ 10.4.0.0 alpha - (???)ﾐ榧ｱﾐｽﾐｰﾑﾑσｶﾐｵﾐｽﾐｰ ﾐｿﾐｾﾐｴﾐｴﾐｵﾑﾐｶﾐｺﾐｰ ﾐｻﾐｾﾐｺﾐｰﾐｻﾐｸ: &#91;ru&#93; ﾐｲﾐｵﾑﾑ・ｸﾑ・ 10.4.0.0 alpha - (???)ﾐ榧ｱﾐｽﾐｰﾑﾑσｶﾐｵﾐｽﾐｰ ﾐｿﾐｾﾐｴﾐｴﾐｵﾑﾐｶﾐｺﾐｰ ﾐｻﾐｾﾐｺﾐｰﾐｻﾐｸ: &#91;zh_CN&#93; ﾐｲﾐｵﾑﾑ・ｸﾑ・ 10.4.0.0 alpha - (???)ﾐ榧ｱﾐｽﾐｰﾑﾑσｶﾐｵﾐｽﾐｰ ﾐｿﾐｾﾐｴﾐｴﾐｵﾑﾐｶﾐｺﾐｰ ﾐｻﾐｾﾐｺﾐｰﾐｻﾐｸ: &#91;zh_TW&#93; ﾐｲﾐｵﾑﾑ・ｸﾑ・ 10.4.0.0 alpha - (???)------------------------------------------------------How to reproduce the bug:1. Create a table with name 'indicator' (or any other SQL keyword as the name  i.e. 'select') and one field of any type  for instance CHAR(1)  like this:CREATE TABLE /'indicator/'(c CHAR(1) DEFAULT 'N')2. Add constraint to the field:ALTER TABLE /' indicator /' ADD CONSTRAINT /'MY_CONSTRAINT/' CHECK ((c IN ('Y' 'N')))3. Try to insert any row to that table:INSERT INTO /'indicator/' VALUES ('N')The INSERT statement will throw an exception:java.sql.SQLException: Java exception: ': java.util.EmptyStackException'.Also  see the program (Main.java) attached to this issue and derby.log contained the exception's stacktace output.I've also created and attached the patch that may fix this issue. Hope this help to improve Derby.,0,0
Index split deadlock,After doing dome research on the mailing list  it appears that the index split deadlock is a known behaviour  so I will start by describing the theoretical problem first and then follow with the details of my test case.If you have concurrent select and insert transactions on the same table  the observed locking behaviour is as follows: the select transaction acquires an S lock on the root block of the index and then waits for an S lock on some uncommitted row of the insert transaction the insert transaction acquires X locks on the inserted records and if it needs to do an index split creates a sub-transaction that tries to acquire an X lock on the root block of the indexIn summary: INDEX LOCK followed by ROW LOCK + ROW LOCK followed by INDEX LOCK = deadlockIn the case of my project this is an important issue (lack of concurrency after being forced to use table level locking) and I would like to contribute to the project and fix this issue (if possible). I was wondering if someone that knows the code can give me a few pointers on the implications of this issue: Is this a limitation of the top-down algorithm used? Would fixing it require to use a bottom up algorithm for better concurrency (which is certainly non trivial)? Trying to break the circular locking above  I would first question why does the select transaction need to acquire (and hold) a lock on the root block of the index. Would it be possible to ensure the consistency of the select without locking the index?The attached test (InsertSelectDeadlock.java) tries to simulate a typical data collection application  it consists of:  an insert thread that inserts records in batch a select thread that 'processes' the records inserted by the other thread: 'select * from table where id &gt; ?'The derby log provides detail about the deadlock trace and stacktraces_during_deadlock.txt shows that the inser thread is doing an index split.The test was run on 10.2.2.0 and 10.3.1.4 with identical behaviour.Thanks Bogdan Calmac.,0,0
getBinaryStream returns incorrect result (truncated value) if underlying blob is deleted,If getBinaryStream is reading a value (READ_UNCOMMITTED) and the row is deleted by another connection  a truncated value will be returned without error. I believe instead either the whole value or an IOException should occur.With 10.2 and higher with the repro attahed we get:&gt; java TruncatedBlobEmbedded:Read 32669 bytes0 rows in BLOBCLOBWith 10.1Embedded:Read 40000 bytes (OK)0 rows in BLOBCLOB Note network server returns the full value for both 10.1 and 10.2 but gives a lock timeout for 10.2+. I will file a separate issue for that.,0,0
iepnegativetests_ES.diff fails with J2ME Foundation,Diff file derbyall/i18nTest/iepnegativetests_ES.diff             Start: iepnegativetests_ES jdkJ2ME Foundation Specification v1.1 derbyall:i18nTest 2007-08-03 01:28:49 ***54a55 58&gt; ij&gt; --export table is null&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  null  'extinout/t1.dat'  &gt; null  null  null) ;&gt; ERROR XIE06: Nombre de entidad nulo.64a69 72&gt; ij&gt; --export query is null &gt; call SYSCS_UTIL.SYSCS_EXPORT_QUERY(null &gt; 'extinout/t1.dat'   null  null  null) ;&gt; ERROR XIE06: Nombre de entidad nulo.70 del&lt; ij&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('XXXX'  'T1'   'extinout/t1.dat'   70a78&gt; ij&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('XXXX'  'T1'   'extinout/t2.dat'   76 del&lt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t1.dat'   76a84&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t2.dat'   79 del&lt; ij&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t1.dat'   79a87&gt; ij&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t2.dat'   83 del&lt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t1.dat'   83a91&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t2.dat'   87 del&lt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t1.dat'   87a95&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t2.dat'   90 del&lt; ij&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t1.dat'   90a98&gt; ij&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t2.dat'   95 del&lt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t1.dat'   95a103&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t2.dat'   98 del&lt; ij&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t1.dat'   98a106&gt; ij&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t2.dat'   104 del&lt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t1.dat'   104a112&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t2.dat'   110 del&lt; ij&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t1.dat'   110a118&gt; ij&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T1'   'extinout/t2.dat'   115 del&lt; ij&gt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE('IEP'  'T1'   'extinout/t1.dat'   115a123&gt; ij&gt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE('IEP'  'T1'   'extinout/t2.dat'   131 del&lt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE('IEP'  'T1'   'extin/nodir/t1.dat'   131a139&gt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE('IEP'  'T1'   'extin/nodir/t2.dat'   136 del&lt; ERROR XIE04: Archivo de datos no encontrado: extin/nodir/t1.dat136a144&gt; ERROR XIE04: Archivo de datos no encontrado: extin/nodir/t2.dat138 del&lt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE ('IEP'  'NOTABLE'   'extinout/t1.dat'   138a146&gt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE ('IEP'  'NOTABLE'   'extinout/t2.dat'   142 del&lt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE ('XXXX'  'T1'   'extinout/t1.dat'   142a150&gt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE ('XXXX'  'T1'   'extinout/t2.dat'   145 del&lt; ij&gt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE ('IEP'  'T1'   'extinout/t1.dat'   145a153&gt; ij&gt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE ('IEP'  'T1'   'extinout/t2.dat'   154 del&lt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE ('IEP'  'T1'   'extinout/t1.dat'   154a162&gt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE ('IEP'  'T1'   'extinout/t2.dat'   160 del&lt; ij&gt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE ('IEP'  'T1'   'extinout/t1.dat'   160a168&gt; ij&gt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE ('IEP'  'T1'   'extinout/t2.dat'   167 del&lt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE ('IEP'  'T1'   'extinout/t1.dat'   167a175&gt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE ('IEP'  'T1'   'extinout/t2.dat'   288 del&lt; ij&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T3'   'extinout/t3.dat'   288a296&gt; ij&gt; call SYSCS_UTIL.SYSCS_EXPORT_TABLE ('IEP'  'T3'   'extinout/t3_1.dat'   293 del&lt; 'extinout/t3.dat'   293a301&gt; 'extinout/t3_1.dat'   297 del&lt; 'extinout/t3.dat'   297a305&gt; 'extinout/t3_1.dat'   302 del&lt; 'extinout/t3.dat'   302a310&gt; 'extinout/t3_1.dat'   307 del&lt; 'extinout/t3.dat'   307a315&gt; 'extinout/t3_1.dat'   313 del&lt; 'extinout/t3.dat'   313a321&gt; 'extinout/t3_1.dat'   317 del&lt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE ('SYS'  'SYSTABLES'   'extinout/t3.dat'   317a325&gt; call SYSCS_UTIL.SYSCS_IMPORT_TABLE ('SYS'  'SYSTABLES'   'extinout/t3_1.dat'   Test Failed. End: iepnegativetests_ES jdkJ2ME Foundation Specification v1.1 derbyall:i18nTest 2007-08-03 01:29:03 ***,0,0
convert lang/lockTable.sql to Junit,,0,0
CollationTest fails with 'Unexpected row count: expected: but was:' when Xalan 2.7 jars are in classpath,When I have the Xalan jars in the classpath  testEnglishCollation()  testNorwayCollation() and testPolishCollation() fail with this stack trace:1) testEnglishCollation(org.apache.derbyTesting.functionTests.tests.lang.CollationTest)junit.framework.AssertionFailedError: Unexpected row count: expected:&lt;0&gt; but was:&lt;1&gt; at org.apache.derbyTesting.junit.JDBC.assertDrainResults(JDBC.java:540) at org.apache.derbyTesting.junit.JDBC.assertEmpty(JDBC.java:468) at org.apache.derbyTesting.functionTests.tests.lang.CollationTest.checkLangBasedQuery(CollationTest.java:1129) at org.apache.derbyTesting.functionTests.tests.lang.CollationTest.commonTestingForTerritoryBasedDB(CollationTest.java:1056) at org.apache.derbyTesting.functionTests.tests.lang.CollationTest.testEnglishCollation(CollationTest.java:512) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)If I remove the Xalan jars from the classpath  the test runs cleanly.,0,0
java.lang.ClassCastException returning null from a case statement  in subquery,The following query returning NULL date from a case statement in a subquery causees a ClassCastException in 10.3.The query works fine in 10.2ij&gt; create table t (d date  vc varchar(30));0 rows inserted/updated/deletedij&gt; insert into t values(CURRENT_DATE  'hello');1 row inserted/updated/deletedij&gt; SELECT d from t where d = (SELECT CASE WHEN 1 = 1 THEN CURRENT_DATE ELSE NULL END from t);D----------2007-08-281 row selectedij&gt; SELECT d from t where d = (SELECT CASE WHEN 1 = 0 THEN CURRENT_DATE ELSE NULL END from t);D----------ERROR 38000: The exception 'java.lang.ClassCastException: org.apache.derby.iapi.types.SQLChar incompatible with org.apache.derby.iapi.types.DateTimeDataValue' was thrown while evaluating an expression.java.sql.SQLException: The exception 'java.lang.ClassCastException: org.apache.derby.iapi.types.SQLChar incompatible with org.apache.derby.iapi.types.DateTimeDataValue' was thrown while evaluating an expression. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88) at org.apache.derby.impl.jdbc.Util.seeNextException(Util.java:224) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:398) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:1572) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) at org.apache.derby.impl.jdbc.EmbedResultSet.closeOnTransactionError(EmbedResultSet.java:4323) at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:464) at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:368) at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:382) at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:338) at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:241) at org.apache.derby.tools.JDBCDisplayUtil.DisplayResults(JDBCDisplayUtil.java:229) at org.apache.derby.impl.tools.ij.utilMain.displayResult(utilMain.java:449) at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:523) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:364) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:262) at org.apache.derby.impl.tools.ij.Main.go(Main.java:215) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181) at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:56) at org.apache.derby.tools.ij.main(ij.java:71)Caused by: java.sql.SQLException: Java exception: 'org.apache.derby.iapi.types.SQLChar incompatible with org.apache.derby.iapi.types.DateTimeDataValue: java.lang.ClassCastException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88) at org.apache.derby.impl.jdbc.Util.javaException(Util.java:245) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403) ... 19 moreCaused by: java.lang.ClassCastException: org.apache.derby.iapi.types.SQLChar incompatible with org.apache.derby.iapi.types.DateTimeDataValue at org.apache.derby.exe.ac12564092x0114xaec2x9627x0000002183d82.g0(Unknown Source) at org.apache.derby.exe.ac12564092x0114xaec2x9627x0000002183d82.e1(Unknown Source) at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:141) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:267) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(BasicNoPutResultSetImpl.java:468) at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:424) ... 13 moreERROR XJ001: Java exception: 'org.apache.derby.iapi.types.SQLChar incompatible with org.apache.derby.iapi.types.DateTimeDataValue: java.lang.ClassCastException'.java.sql.SQLException: Java exception: 'org.apache.derby.iapi.types.SQLChar incompatible with org.apache.derby.iapi.types.DateTimeDataValue: java.lang.ClassCastException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88) at org.apache.derby.impl.jdbc.Util.javaException(Util.java:245) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:398) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:1572) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) at org.apache.derby.impl.jdbc.EmbedResultSet.closeOnTransactionError(EmbedResultSet.java:4323) at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:464) at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:368) at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:382) at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:338) at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:241) at org.apache.derby.tools.JDBCDisplayUtil.DisplayResults(JDBCDisplayUtil.java:229) at org.apache.derby.impl.tools.ij.utilMain.displayResult(utilMain.java:449) at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:523) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:364) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:262) at org.apache.derby.impl.tools.ij.Main.go(Main.java:215) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181) at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:56) at org.apache.derby.tools.ij.main(ij.java:71)Caused by: java.lang.ClassCastException: org.apache.derby.iapi.types.SQLChar incompatible with org.apache.derby.iapi.types.DateTimeDataValue at org.apache.derby.exe.ac12564092x0114xaec2x9627x0000002183d82.g0(Unknown Source) at org.apache.derby.exe.ac12564092x0114xaec2x9627x0000002183d82.e1(Unknown Source) at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:141) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:267) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(BasicNoPutResultSetImpl.java:468) at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:424) ... 13 more,0,0
select query results in nullpointer exception in skipScan(),The following error was repeatedly thrown when we tried to run a select query via JDBC. Strangely  the exact same select query did not trigger any error when run from the command line console. After we added an index  the error went away completely. java.lang.NullPointerException at org.apache.derby.impl.sql.execute.NoPutResultSetImpl.skipScan(Unknown Source) at org.apache.derby.impl.sql.execute.TableScanResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.IndexRowToBaseRowResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.JoinResultSet.openRight(Unknown Source) at org.apache.derby.impl.sql.execute.JoinResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.SortResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.drda.DRDAStatement.execute(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source),0,0
'Schema  does not exist' when constraint used in table definition,https://issues.apache.org/jira/browse/DERBY-568#action_12524420In the response to my original comment post  which you can find via the permalink above  I was encouraged to file this as a new issue.verified this back to 10.1.2.1 with the following ij script.connect 'jdbc:derby:wombat;create=true;user=blogs';CREATE TABLE BLOGSCOM_BLOGSUSERS(PK INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY username VARCHAR(16) NOT NULL CONSTRAINT BLOGSCOMBLOGSUSERS_UNIQUE_username UNIQUE CONSTRAINT BLOGSCOMBLOGS_USERS_PASSWORD_username CHECK(LENGTH(username)&gt;7) password VARCHAR (32672) NOT NULL   PRIMARY KEY(PK));,0,0
lang/synonym.sql fails with weme 6.1 with junit.framework.ComparisonFailure: Output at line 383 expected: but was:,synonym(org.apache.derbyTesting.functionTests.tests.lang.LangScripts) failed:junit.framework.ComparisonFailure: Output at line 383 expected:&lt;...1...&gt; but was:&lt;...2...&gt; at junit.framework.Assert.assertEquals(Assert.java:81) at org.apache.derbyTesting.functionTests.util.CanonTestCase.compareCanon(CanonTestCase.java:100) at org.apache.derbyTesting.functionTests.util.ScriptTestCase.runTest(ScriptTestCase.java:124) at junit.framework.TestCase.runBare(TestCase.java:127) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95) at junit.framework.TestResult$1.protect(TestResult.java:106) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.framework.TestResult.run(TestResult.java:109) at junit.framework.TestCase.run(TestCase.java:118) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.framework.TestSuite.runTest(TestSuite.java:208) at junit.framework.TestSuite.run(TestSuite.java:203) at junit.framework.TestSuite.runTest(TestSuite.java:208) at junit.framework.TestSuite.run(TestSuite.java:203) at junit.framework.TestSuite.runTest(TestSuite.java:208) at junit.framework.TestSuite.run(TestSuite.java:203) at junit.framework.TestSuite.runTest(TestSuite.java:208) at junit.framework.TestSuite.run(TestSuite.java:203) at junit.framework.TestSuite.runTest(TestSuite.java:208) at junit.framework.TestSuite.run(TestSuite.java:203) at TimeRunner.main(TimeRunner.java:31),0,0
testImportExportProcedureNegative(org.apache.derbyTesting.functionTests.tests.tools.ImportExportProcedureTest)junit.framework.ComparisonFailure: Unexpected SQL state. expected: but was:,1) testImportExportProcedureNegative(org.apache.derbyTesting.functionTests.tests.tools.ImportExportProcedureTest)junit.framework.ComparisonFailure: Unexpected SQL state. expected:&lt;38000&gt; but was:&lt;XIE0S&gt; at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDBCTestCase.java:668) at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDBCTestCase.java:717) at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertStatementError(BaseJDBCTestCase.java:898) at org.apache.derbyTesting.functionTests.tests.tools.ImportExportProcedureTest.testImportExportProcedureNegative(ImportExportProcedureTest.java:1933) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:64) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)Caused by: java.sql.SQLException: The export operation was not performed  because the specified output file (extinout/t1.dat) already exists. Export processing will not overwrite an existing file  even if the process has permissions to write to that file  due to security concerns  and to avoid accidental file damage. Please either change the output file name in the export procedure arguments to specify a file which does not exist  or delete the existing file  then retry the export operation. at org.apache.derby.client.am.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.client.am.SqlException.getSQLException(Unknown Source) at org.apache.derby.client.am.PreparedStatement.execute(Unknown Source) at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertStatementError(BaseJDBCTestCase.java:893) ... 45 moreCaused by: org.apache.derby.client.am.SqlException: The export operation was not performed  because the specified output file (extinout/t1.dat) already exists. Export processing will not overwrite an existing file  even if the process has permissions to write to that file  due to security concerns  and to avoid accidental file damage. Please either change the output file name in the export procedure arguments to specify a file which does not exist  or delete the existing file  then retry the export operation. at org.apache.derby.client.am.Statement.completeExecute(Unknown Source) at org.apache.derby.client.net.NetStatementReply.parseEXCSQLSTTreply(Unknown Source) at org.apache.derby.client.net.NetStatementReply.readExecuteCall(Unknown Source) at org.apache.derby.client.net.StatementReply.readExecuteCall(Unknown Source) at org.apache.derby.client.net.NetStatement.readExecuteCall_(Unknown Source) at org.apache.derby.client.am.Statement.readExecuteCall(Unknown Source) at org.apache.derby.client.am.PreparedStatement.flowExecute(Unknown Source) at org.apache.derby.client.am.PreparedStatement.executeX(Unknown Source) ... 47 more,0,0
Derby does not resolve functions bound to methods with varargs.,Varargs were added in Java 5. It would be nice if Derby let you invoke a function bound to a method with a variable length argument list. The Reference Guide states a small number of restrictions for methods which can be invoked as Derby functions: They must be public  static  and not have arguments which are long datatypes. I see no reason that Derby shouldn't be able to resolve and invoke functions which are bound to methods which don't suffer these limitations but which have variable argument lists.,0,0
Trying to reconnect with derby client after bringing server down throws SQL Exception 58009 rather than 08XXX exception,This issue was discussed in DERBY-401  because the case where the server is brought down and an application tries to reconnect does not throw a SQLNonTransientException. Discussion is still underway about whether 58XXX exceptions should be SQLNonTransientExceptions  but at least for this case changing the exception to 08006 per Knut's suggestion should correct the problem for this case. See https://issues.apache.org/jira/browse/DERBY-401#action_12527400Below is current stack and test case.Apache Derbygot connection now sleepnow try to use the connection after you killed the nSException in thread 'main' java.sql.SQLException: A communications error has been detected: Software caused connection abort: recv failed.at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(Unknown Source)at org.apache.derby.client.am.SqlException.getSQLException(Unknown Source)at org.apache.derby.client.am.Connection.prepareStatement(Unknown Source)at org.apache.derby.client.am.LogicalConnection.prepareStatement(Unknown Source)at DerbyClientNonXA.main(DerbyClientNonXA.java:48)Caused by: org.apache.derby.client.am.DisconnectException: A communications error has been detected: Software caused connection abort: recv failed.at org.apache.derby.client.net.NetAgent.throwCommunicationsFailure(Unknown Source)at org.apache.derby.client.net.Reply.fill(Unknown Source)at org.apache.derby.client.net.Reply.ensureALayerDataInBuffer(Unknown Source)at org.apache.derby.client.net.Reply.readDssHeader(Unknown Source)at org.apache.derby.client.net.Reply.startSameIdChainParse(Unknown Source)at org.apache.derby.client.net.NetStatementReply.readPrepareDescribeOutput(Unknown Source)at org.apache.derby.client.net.StatementReply.readPrepareDescribeOutput(Unknown Source)at org.apache.derby.client.net.NetStatement.readPrepareDescribeOutput_(Unknown Source)at org.apache.derby.client.am.Statement.readPrepareDescribeOutput(Unknown Source)at org.apache.derby.client.am.PreparedStatement.readPrepareDescribeInputOutput(Unknown Source)at org.apache.derby.client.am.PreparedStatement.flowPrepareDescribeInputOutput(Unknown Source)at org.apache.derby.client.am.PreparedStatement.prepare(Unknown Source)at org.apache.derby.client.am.Connection.prepareStatementX(Unknown Source)... 3 moreCaused by: java.net.SocketException: Software caused connection abort: recv failedat java.net.SocketInputStream.read(SocketInputStream.java:129)... 15 moreimport java.sql.Connection;import java.sql.DatabaseMetaData;import java.sql.PreparedStatement;import java.sql.SQLException;import java.sql.Statement;import javax.sql.PooledConnection;public class DerbyClientNonXA{public static void main(String args[]) throws Exception{org.apache.derby.jdbc.ClientConnectionPoolDataSource40 ds = new org.apache.derby.jdbc.ClientConnectionPoolDataSource40();Connection conn = null;ds.setDatabaseName('e://temp//sampl127;create=true');PooledConnection pooledCon = ds.getPooledConnection();conn = pooledCon.getConnection();DatabaseMetaData md = conn.getMetaData();System.out.println(md.getDatabaseProductVersion());System.out.println(md.getDatabaseProductName());System.out.println('got connection now sleep. Bring down network server.');Statement st = null;PreparedStatement ps1 = null;st = conn.createStatement();try{st.executeUpdate('drop table TAB1');}catch (SQLException x){System.out.println('no table exists');}Thread.sleep(15000);System.out.println('now try to use the connection after you killed the nS');ps1 = conn.prepareStatement('CREATE TABLE TAB1(COL1 INT NOT NULL)');ps1.executeUpdate();conn.commit();System.out.println('done');}},0,0
Use java.util.concurrent in TransactionTable to improve scalability,Running scalability tests with the client and buffer manager from DERBY-2911 shows that access to the TransactionTable.trans (a Hashtable) and XactFactory.tranId (a shared long) are the next major sources of contention.,0,1
Intermittent transaction failure caused by internal duplicate savepoint name for triggers,While running our app overnight  performing some intensive database operations (primarily deletes)  we experienced a transaction failure  with error message 'A SAVEPOINT with the passed name already exists in the current transaction'. This failure appears to be very intermittent  as I've run the same operation successfully for hours and hours without failure. Some more information:1. I see that there are four JIRA issues which report the same message (DERBY-2773  DERBY-1457  DERBY-2808  DERBY-2804). I am not sure to what extent if any  the problem I experienced is related to these issues.窶｢ At least three of the above JIRA issues are related to triggers. Our transaction failure occurred while performing a delete in a table which has delete triggers.窶｢ We aren't using savepoints explicitly. Of course  it can be seen in the stack trace that the trigger operation is setting a savepoint.窶｢ One of the JIRA issues mentions exceeding maximum depth of nested triggers. Not sure what a nested trigger is  but the trigger we are performing should not (in theory) cause another trigger event.2. Here's the stack trace:Caused by: java.sql.SQLException: A SAVEPOINT with the passed name already exists in the current transaction. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(Unknown Source) at com.referentia.sdf.monitor.samplebase.derby.DerbySampleBase$3.perform(DerbySampleBase.java:682) at com.referentia.sdf.monitor.samplebase.derby.DerbySampleBase.performInTransaction(DerbySampleBase.java:2747) ... 7 moreCaused by: java.sql.SQLException: A SAVEPOINT with the passed name already exists in the current transaction. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source) ... 18 moreCaused by: ERROR 3B501: A SAVEPOINT with the passed name already exists in the current transaction. at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.impl.store.raw.xact.Xact.setSavePoint(Unknown Source) at org.apache.derby.impl.store.access.RAMTransaction.setSavePoint(Unknown Source) at org.apache.derby.impl.sql.conn.GenericStatementContext.setSavePoint(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(Unknown Source) at org.apache.derby.impl.sql.execute.RowTriggerExecutor.fireTrigger(Unknown Source) at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(Unknown Source) at org.apache.derby.impl.sql.execute.DeleteResultSet.fireAfterTriggers(Unknown Source) at org.apache.derby.impl.sql.execute.DeleteResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) ... 12 more3. Here are the relevant tables and triggers. We have different tables for different 'sample' data types in our application (currently int  long  float  double  Boolean  string). I have shown the int_sample table; the other tables are identical but have a different data type for the value field. Sample records are first class; time records are second class - they only exist to support sample records. When there are no remaining sample records for a given time record  the time record can be removed. It is the job of the trigger to perform this cleanup: when a record is deleted from any of the sample tables  the time record corresponding to *_sample.fk_time_id is deleted only if there are no remaining records in any of the sample tables which have the same fk_time_id. So although there are cascading deletes (deleting a time record deletes all of its samples)  the trigger should not recurse because the trigger only deletes when there are no associated records.create table time ( id int not null generated always as identity  time timestamp not null  constraint time_pk primary key (id)  constraint time_unique unique (time));create table int_sample ( fk_band_id int not null  fk_time_id int not null  value int not null  constraint int_sample_pk primary key (fk_band_id  fk_time_id)  constraint int_sample_fk_band foreign key (fk_band_id) references band (id) on delete cascade  constraint int_sample_fk_time foreign key (fk_time_id) references time (id) on delete cascade);create trigger cascade_delete_unused_time_for_int_sample_trigger after delete on int_sample referencing old as oldrow for each row delete from time where  time.id = oldrow.fk_time_id and id not in (select fk_time_id from int_sample)  and id not in (select fk_time_id from long_sample)  and id not in (select fk_time_id from float_sample)  and id not in (select fk_time_id from double_sample)  and id not in (select fk_time_id from boolean_sample)  and id not in (select fk_time_id from string_sample);4. Invocation. This is very rough pseudocode focusing on the core logic. In reality  there's a lot more code  but I'm doing the usual stuff  such as using prepared statements  and closing all resources when done. The key thing is that I'm using two statements in a nested fashion; in the outer statement  I iterate over records in the time table  and in the inner loop I use a second statement to delete records in one of the sample tables. I can provide the actual code if desired.deleteSamples(int bandId  String sampleTable  Object someQueryCriteria) { within transaction { create stmt1 iterating over time ids in time table (restricted by someQueryCriteria) for (time_id in stmt1) { PreparedStatement stmt2 = conn.prepareStatement(String.format( 'delete from %s where fk_band_id = ? and fk_time_id = ?'  sampleTable)); set stmt2 parameters and executeUpdate() } }},0,0
LOB locks are not released after free().,When getBlob/getClob is called on the ResultSet  the current row islocked if the JDBC driver does not cache the entire LOB value inmemory. This is done to prevent the Blob/Clob object from beingchanged. Until now  this lock has been held to the end of thetransaction.JDBC4 introduced free() methods for the Blob/Clob class. The lockingshould be changed so that the locks is releases when the Blob/Clobobject is freed.,0,0
java.lang.NumberFormatException in test lang.TableFunctionTest on specific machines (Win2003  Vista),This failure is gleaned from the nightly tests posted to the list. The test started failing on September 13.The stack is:1) testTableFunctions(org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest)java.lang.NumberFormatException: For input string: '13 00' at sun.misc.FloatingDecimal.readJavaFormatString(FloatingDecimal.java:1224) at java.lang.Double.parseDouble(Double.java:510) at org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest.readDoubleTag(TableFunctionTest.java:1647) at org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest.vtiCosting(TableFunctionTest.java:1124) at org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest.testTableFunctions(TableFunctionTest.java:797) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95),0,0
On client  Clob.free() does not release locators.,On client  Clob.free() does not call the stored procedure to release the locator associated with the Clob. Hence  server-side Clob objects are not freed until the transaction terminates.,0,1
totalSpace not properly initialized in AllocPage,There are some problems with the initialization of totalSpace in AllocPage. It is initialized in StoredPage.initSpace() which is again called from StoredPage.usePageBuffer()  and it is set to the value returned from AllocPage.getMaxFreeSpace(). The problems are: 1) The calculation in getMaxFreeSpace() uses borrowedSpace  but when createIdentity() is called on an AllocPage  borrowedSpace has not been initialized when getMaxFreeSpace() is called and the calculated size is wrong. 2) When a page object is reused  usePageBuffer() is only called if a new byte array must be allocated (because the new page has a different size than the old page). This means that the totalSize field gets the same value as in the old page if their sizes are equal  which is not necessarily correct.,0,0
Adjust master build script to require the Java 5 compiler to build Derby,Require the Java 5 compiler in order to build Derby as approved by the community recently: http://www.nabble.com/-VOTE--Require-Java-5-%28or-later%29-compiler-to-build-Derby-tf4522491.html#a13030783,0,0
Cut down on object creations in LIKE clause implementation of territory based characters.,The LIKE clause for territory based characters was implemented correctly based on SQL standards in DERBY-2967 but the object (String and CollationElementIterator) creations introduced in DERBY-2967 can be cut down by following Knut's simple solution. I am copying that solution from DERBY-2967. We should implement that solution to improve the performance of LIKE for territory based characters.*********copied from DERBY-2967*********************************************************Another simple way to cut down the string allocations... I think you could express iapi.types.Like:checkEquality() like this:  if (val&#91;vLoc&#93; == pat&#91;pLoc&#93;) { // same character  so two strings consisting of this // single character must be equal regardless of territory return true; } else if (collator == null) { // not same character  must be unequal in UCS_BASIC return false; }  String s1 = new String(val  vLoc  1);  String s1 = new String(pat  pLoc  1);  return collator.compare(s1  s2) == 0; This would only allocate new objects if the characters are not equal.,0,1
ComparisonFailure in synonym(org.apache.derbyTesting.functionTests.tests.lang.LangScripts),Since r587553 'synonym(org.apache.derbyTesting.functionTests.tests.lang.LangScripts)' has failed with 'junit.framework.ComparisonFailure: Output at line 18 expected:&lt;[]&gt; but was:&lt;&#91;-- When we decide to convert this test to junit test  the converted tests can &#93;&gt;'&lt;method&gt;org.apache.derbyTesting.functionTests.tests.lang.LangScripts&lt;/method&gt;&lt;signature&gt;Output at line 18 expected:&lt;[]&gt; but was:&lt;&#91;-- When we decide to convert this test to junit test  the converted tests can &#93;&gt;&lt;/signature&gt;,0,0
IllegalArgumentException: Malformed /uxxxx encoding while trying to find Xalan version running tests via ant,Following stack trace after executing:ant -propertyfile ant.properties junit-all-codeline-jars &#91;junit&#93; Unexpected exception while trying to find Xalan version: &#91;junit&#93; java.lang.IllegalArgumentException: Malformed /uxxxx encoding. &#91;junit&#93; at java.util.Properties.loadConvert(Properties.java:531) &#91;junit&#93; at java.util.Properties.load(Properties.java:370) &#91;junit&#93; at org.apache.derbyTesting.junit.XML.checkXalanVersion(XML.java:329) &#91;junit&#93; at org.apache.derbyTesting.junit.XML.&lt;clinit&gt;(XML.java:116),0,0
Reduce dependency on NetworkServerControl in TestConfiguration,Code has been added in TestConfiguration to allow for starting and stopping a Derby network server.Even if you know will not need this functionality  or you simply don't want to have this functionality available  you must include derbynet.jar (or point to classes/).I think this dependency should be reduced  by not having any instance variables and by not importing the class with an explicit import statement. The existing instance variables are not used.With this planned change  you can run tests without including derbynet.jar on the classpath  as long as they don't call 'startNetworkServer' or 'stopNetworkServer'. Most often these methods will be called by a decorator.The downside of this change  is that you won't get any error messages before the mentioned methods are actually executed.A typical error message:Failed to invoke suite():java.lang.NoClassDefFoundError: org/apache/derby/drda/NetworkServerControlI'm sure there are other solutions as well  but this one is really easy.Any opinions on this change?,0,0
AccessControlException when running junit tests under the ant harness in ant 1.7.0,The following AccessControlException occurs on junit tests run under the ant harness if the ant version is 1.7.0: &#91;junit&#93; Running org.apache.derbyTesting.functionTests.tests.jdbcapi.AutoloadTest &#91;junit&#93; Tests run: 3  Failures: 0  Errors: 1  Time elapsed: 1.029 sec &#91;junit&#93; Exception in thread 'main' java.security.AccessControlException: access denied (java.io.FilePermission /Users/rh161140/derby/mainline/trunk/junitvmwatcher520156310.properties write) &#91;junit&#93; at java.security.AccessControlContext.checkPermission(AccessControlContext.java:264) &#91;junit&#93; at java.security.AccessController.checkPermission(AccessController.java:427) &#91;junit&#93; at java.lang.SecurityManager.checkPermission(SecurityManager.java:532) &#91;junit&#93; at java.lang.SecurityManager.checkWrite(SecurityManager.java:962) &#91;junit&#93; at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:169) &#91;junit&#93; at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:70) &#91;junit&#93; at java.io.FileWriter.&lt;init&gt;(FileWriter.java:46) &#91;junit&#93; at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.registerNonCrash(JUnitTestRunner.java:924) &#91;junit&#93; at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:772) &#91;junit&#93; Running org.apache.derbyTesting.functionTests.tests.jdbcapi.AutoloadTest &#91;junit&#93; Tests run: 1  Failures: 0  Errors: 1  Time elapsed: 0 secI haven't looked at the ant source  but here is my theory about what is going on:1) Ant 1.7.0 is trying to write a file to the directory where the ant script lives2) The write is not wrapped in a privileged block3) So all code domains above it on the stack need to be granted write permission on the directory where the ant script livesI will attach a modified version of derby_tests.policy which allows me to start up the tests without tripping across this security exception.,1,0
SYSCS_GET_USER_ACCESS incorrectly treats the passed in user name as a SQL identifier and thus can reports the wrong user information,VALUES SYSCS_GET_USER_ACCESS(CURRENT_USER) will report the wrong user information if the user name needs to be a delimited identifier when used in a SQL statement such as GRANT. E.g. user fred@derby.com  123 etc.Passing the user name as a VARCHAR also returns the wrong user for such user names.,1,0
Updating Building.txt,We (Svein Erik Lﾃｸvland and Henrik Holum) have updated the building.txt document for Derby Trunk. We built the code following every step of the document  and here are our suggested changes. A review of the changes would be appresiated.Removed the empty subsections  and updated the section and subsection numbers. We also updated the references according to the new subsection numbers.Removed 2.2.3 and 2.2.4Renamed 2.2.5 -&gt; 2.2.3  2.2.6 -&gt; 2.2.4 and 2.2.7 -&gt; 2.2.52.1Added 3 directories2.2.1 (1)Updated the text to indicate that any newer version than 1.6.3 can be used. Old text indicated that you could only use 1.6.x versions  not 1.7.2.2.2 (2) and (4) (Windows)Updated the URLs to point directly to download pages for the desired java versions2.2.3 (Previous 2.2.5)Can we use Junit 3.8.2 or does it have to be 3.8.1? if Junit 3.8.2 can be used the link can be replaced with http://kent.dl.sourceforge.net/sourceforge/junit/junit3.8.2.zip. Also update the text to indicate these changes (3.8.*)2.2.5 (Previous 2.2.7)Moved the Optional tag to be consistent with 2.2.4 (Previous 2.2.6) We updated references in the note to reflect the new subsection number.3.3 (3)Updated the number of jar files with local support to 13 instead of 9.We have used Windows XP  so we have not checked the *nix or Mac settings.Hope this is helpfull-Henrik and Svein Erik,0,0
NetworkServerControlApiTest fails with java.security.AccessControlException if not run as first test,There appears to be a problem loading the test specific policy file for NetworkServerControlApiTest if it is not run as the first test in the suite.Failure in the derby.log is:Trace directory changed to C:/test/system.access denied (java.io.FilePermission C:/test/system/Server3.trace write)java.security.AccessControlException: access denied (java.io.FilePermission C:/test/system/Server3.trace write) at java.security.AccessControlContext.checkPermission(AccessControlContext.java:323) at java.security.AccessController.checkPermission(AccessController.java:546) at java.lang.SecurityManager.checkPermission(SecurityManager.java:532) at java.lang.SecurityManager.checkWrite(SecurityManager.java:962) at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:169) at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:70) at java.io.FileWriter.&lt;init&gt;(FileWriter.java:46) at org.apache.derby.impl.drda.DssTrace$1.run(DssTrace.java:181) at java.security.AccessController.doPrivileged(Native Method) at org.apache.derby.impl.drda.DssTrace.startComBufferTrace(DssTrace.java:178) at org.apache.derby.impl.drda.Session.initTrace(Session.java:138) at org.apache.derby.impl.drda.Session.setTraceOn(Session.java:152) at org.apache.derby.impl.drda.NetworkServerControlImpl.setTrace(NetworkServerControlImpl.java:3372) at org.apache.derby.impl.drda.NetworkServerControlImpl.processCommands(NetworkServerControlImpl.java:1422) at org.apache.derby.impl.drda.DRDAConnThread.sessionInitialState(DRDAConnThread.java:630) at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:264),1,0
NullPointerException on INSERT after ALTER TABLE ... DROP COLUMN,ij version 10.3ij&gt; connect 'jdbc:derby:bugdb;create=true';ij&gt; create table t ( x varchar(12)  y varchar(12)  id int primary key generated by default as identity);0 rows inserted/updated/deletedij&gt; alter table t drop column y;0 rows inserted/updated/deletedij&gt; insert into t values 'a';ERROR XJ001: Java exception: ': java.lang.NullPointerException'.java.sql.SQLException: Java exception: ': java.lang.NullPointerException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source) at org.apache.derby.impl.tools.ij.Main14.main(Unknown Source) at org.apache.derby.tools.ij.main(Unknown Source) at org.apache.derby.iapi.tools.run.main(Unknown Source)Caused by: java.sql.SQLException: Java exception: ': java.lang.NullPointerException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source) ... 18 moreCaused by: java.lang.NullPointerException at org.apache.derby.impl.sql.compile.ResultColumn.columnTypeAndLengthMatch(Unknown Source) at org.apache.derby.impl.sql.compile.ResultColumnList.columnTypesAndLengthsMatch(Unknown Source) at org.apache.derby.impl.sql.compile.InsertNode.bindStatement(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source) ... 11 more,0,0
DataSourceTest uses ConnectionEventListener but never verifies that events are getting fired,Derby has a junit test called DataSourceTest in jdbcapi package. This test registers ConnectionEventListener for various Connection objects but never verifies that events from those Connection objects are getting delivered to the listeners. Prior to this test's conversion to junit  there were System.out.println in the test but since this test is not cannon based anymore  those printlns have been commented out. I will soon submit a patch where this test will have asserts to make sure that Connection events are getting fired.,0,0
New simple demo suitable for supported Java ME platforms,DERBY-2216 added J2ME (Java ME) support in the simple demo (SimpleApp)  but broke the basic client functionality of the demo (at least in some VMs). Since DERBY-3187 fixes this by removing Java ME support from SimpleApp  a separate simple demo for Java ME should be included along with the other demos available in Derby distributions.Currently supported Java ME platforms are Java ME Virtual Machines with Connected Device Configuration (CDC) support and the Foundation Profile 1.1 or better  with the optional package for JDBC (JSR-169).The new demo should be easy to use and understand  and should be well commented. The demo code should demonstrate how to create and connect to a Derby database in a valid Java ME environment  and perform some basic database operations (insert  update  query). A readme file describing the demo (and instructions for building and running it) should be included.,0,0
LOCALIZEDDISPLAY of CURRENT_TIMESTAMP returns only the TIME,In IJ - LOCALIZEDDISPLAY ON causes VALUES CURRENT_TIMESTAMP to display on the TIMEij&gt; values current_timestamp;1--------------------------2007-11-09 10:37:58.8281 row selectedij&gt; localizeddisplay on;ij&gt; values current_timestamp;1---------------10:38:10 AM PST1 row selected,0,0
Using setQueryTimeout will leak sections,The implementation of setQueryTimeout relies on NetStatementReply.writeSetSpecialRegister() which will allocate a dynamic section when called. No reference to this Section object is kept  and so Section.free() never gets called on it. Executing the same statment repeatedly with a query timeout set results in the client driver throwing an exception because the number of Sections exceeding 32000.,0,1
'AccessControlException: access denied (java.io.FilePermission C:/..../file-2.log read)' in ErrorStreamTest.,Seen on Windows only.See e.g. http://dbtg.thresher.com/derby/test/Daily/jvm1.6/testing/Limited/testSummary-594211.html : vista  w2003.suitesAll fail *************************************************************1) testFile(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)java.security.AccessControlException: access denied (java.io.FilePermission C:/cludev/jagtmp/autoderbyN_regression/suitesAll_30/log/system/file-2.log read)2) testWrongFile(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)java.security.AccessControlException: access denied (java.io.FilePermission C:/cludev/jagtmp/autoderbyN_regression/suitesAll_30/log/system/foo/file-3.log read)3) testFileOverMethod(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)java.security.AccessControlException: access denied (java.io.FilePermission C:/cludev/jagtmp/autoderbyN_regression/suitesAll_30/log/system/file-8.log read)4) testFileOverField(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)java.security.AccessControlException: access denied (java.io.FilePermission C:/cludev/jagtmp/autoderbyN_regression/suitesAll_30/log/system/file-9.log read)5) testFileOverMethodAndField(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)java.security.AccessControlException: access denied (java.io.FilePermission C:/cludev/jagtmp/autoderbyN_regression/suitesAll_30/log/system/file-10.log read)1) testDefault(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)junit.framework.AssertionFailedError: File C:/cludev/jagtmp/autoderbyN_regression/suitesAll_30/log/system/derby.log could not be deleted2) testMethod(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)junit.framework.AssertionFailedError: assertNotEmpty failed:C:/cludev/jagtmp/autoderbyN_regression/suitesAll_30/log/system/method-4.logsuitesAll fail *************************************************************1) testFile(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)java.security.AccessControlException: access denied (java.io.FilePermission C:/cludev/jagtmp/autoderbyN_regression/suitesAll_30/log/system/file-2.log read) at java.security.AccessControlContext.checkPermission(AccessControlContext.java:323) at java.security.AccessController.checkPermission(AccessController.java:546) at java.lang.SecurityManager.checkPermission(SecurityManager.java:532) at java.lang.SecurityManager.checkRead(SecurityManager.java:871) at java.io.File.exists(File.java:731) at java.io.Win32FileSystem.canonicalize(Win32FileSystem.java:402) at java.io.File.getCanonicalPath(File.java:559) at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest.testFile(ErrorStreamTest.java:140) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95)++,1,0
Optimizer can see negative cost estimates when pulling Optimizables from the join order.,When iterating through join order permutations for a query the optimizer places 'Optimizables' (FromTables) into a join order  estimates the cost  then 'pulls' Optimizables out of the join order and re-places them in different positions. For details see: http://wiki.apache.org/db-derby/JoinOrderPermutationsAs optimizables are added to the join order the optimizer keeps track of the accumulated cost estimate for the join order. Then when an Optimizable is removed ('pulled') from the join order  the optimizer substracts that Optimizable's cost from the total accumulated cost.In certain cases (esp. with very large queries) it's possible that the cost for some Optimizable OPT_A is so large that adding it to the accumulated cost of the join order leads to loss of the previous sum. This happens due to normal Java addition of double values  see 'doubleAdd.java' attached.As an example  assume our current join order is: { OPT_0  OPT_1  -- }and that the estimated costs for OPT_0 and OPT_1 are 700 and 800  respectively. The accumulated cost for OPT_0 and OPT_1 is then 700 + 800 = 1500. Then assume we place OPT_A into the final position in the join order: { OPT_0  OPT_1  OPT_A }If the cost of OPT_A is something that is orders of magnitude larger than 1500  then by adding it to 1500 we will effectively 'lose' the 1500. Let's say the cost of OPT_A is estimated to be 3.14E50 (which is actually possible  esp. as a result of DERBY-1905). The size of OPT_A's cost makes the cost of OPT_0 + OPT_1 insignificant when using Java doubles (see attached doubleAdd.java): 1500 + 3.14E50 = 3.14E50So the total accumulated cost for the join order is now 3.14E50. Later  when we go to pull OPT_A from the join order  we'll subtract its cost from the accumulated cost  yielding: 3.14E50 - 3.14E50 = 0Notice how the accumulated cost  which is supposed to represent the cost of OPT_0 plus the cost of OPT_1  is now ZERO. And our join order goes back to: { OPT_0  OPT_1  -- }Next we pull OPT_1 from the join order  which means we have to subtract it's cost from the accumulated cost: 0 - 800 = -800So we end up with a negative accumulated cost  which is WRONG. (Actually  the ZERO accumulated cost in the previous step was wrong; this is just a side effect).As it turns out  there is code in OptimizerImpl that tries to account for negative costs when the negative value comes from normal imprecise arithmetic. In particular we see the following in the code that pulls Optimizables: double newCost = currentCost.getEstimatedCost(); if (pullCostEstimate != null) { pullCost = pullCostEstimate.getEstimatedCost(); newCost -= pullCost; /* ** It's possible for newCost to go negative here due to ** loss of precision. */ if (newCost &lt; 0.0) newCost = 0.0; ... }This code hides the error mentioned above because when it sees '-800' it assumes that the negative stems from normal loss of precision. So the cost for the plan is incorrectly set to '0'  which makes it cheaper than any other plan thus far (and probably cheaper than anything to come)  and therefore the optimizer will probably choose the wrong plan.I think the check for negative newCost is only valid if the join position that we're pulling is 0-i.e. if we just pulled the first optimizable in the join order. In that case the accumulated cost should be zero  so checking for a negative value and setting it to zero is fine-we're just accounting for the loss of precision that is mentioned in the current code comments.Note that the same issue also exists for 'sort avoidance costs'  but in that code there is (currently) no check for negative costs. So if a situation as described above occurs in the current code when the cost of OPT_A is for a sort avoidance plan  the code will throw an ASSERTION failure because the cost should be non-negative.I noticed this behavior somewhat accidentally while testing out a fix for DERBY-3023: with my attempted fix applied  the query 'new-style-sql.txt' was failing with an ASSERTION failure due to the negative cost estimate. Hence this jira.,0,1
ErrorStreamTest failing on ibm j9 jvm,Getting the following junit tests failures on just on the j9 jvm platform running on windows:There were 11 failures:1) testDefault(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)junit.framework.AssertionFailedError: shutdown engine not implemened at org.apache.derbyTesting.junit.DataSourceConnector.shutEngine(DataSourceConnector.java:130) at org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1091) at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest.testDefault(ErrorStreamTest.java:128) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at &lt;unknown class&gt;.&lt;unknown method&gt;(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95)2) testFile(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)junit.framework.AssertionFailedError: shutdown engine not implemened at org.apache.derbyTesting.junit.DataSourceConnector.shutEngine(DataSourceConnector.java:130) at org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1091) at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest.testFile(ErrorStreamTest.java:141) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at &lt;unknown class&gt;.&lt;unknown method&gt;(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95)3) testWrongFile(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)junit.framework.AssertionFailedError: shutdown engine not implemened at org.apache.derbyTesting.junit.DataSourceConnector.shutEngine(DataSourceConnector.java:130) at org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1091) at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest.testWrongFile(ErrorStreamTest.java:160) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at &lt;unknown class&gt;.&lt;unknown method&gt;(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95)4) testMethod(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)junit.framework.AssertionFailedError: shutdown engine not implemened at org.apache.derbyTesting.junit.DataSourceConnector.shutEngine(DataSourceConnector.java:130) at org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1091) at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest.testMethod(ErrorStreamTest.java:179) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at &lt;unknown class&gt;.&lt;unknown method&gt;(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95)5) testWrongMethod(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)junit.framework.AssertionFailedError: shutdown engine not implemened at org.apache.derbyTesting.junit.DataSourceConnector.shutEngine(DataSourceConnector.java:130) at org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1091) at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest.testWrongMethod(ErrorStreamTest.java:198) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at &lt;unknown class&gt;.&lt;unknown method&gt;(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95)6) testField(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)junit.framework.AssertionFailedError: shutdown engine not implemened at org.apache.derbyTesting.junit.DataSourceConnector.shutEngine(DataSourceConnector.java:130) at org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1091) at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest.testField(ErrorStreamTest.java:217) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at &lt;unknown class&gt;.&lt;unknown method&gt;(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95)7) testWrongField(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)junit.framework.AssertionFailedError: shutdown engine not implemened at org.apache.derbyTesting.junit.DataSourceConnector.shutEngine(DataSourceConnector.java:130) at org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1091) at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest.testWrongField(ErrorStreamTest.java:236) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at &lt;unknown class&gt;.&lt;unknown method&gt;(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95)8) testFileOverMethod(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)junit.framework.AssertionFailedError: shutdown engine not implemened at org.apache.derbyTesting.junit.DataSourceConnector.shutEngine(DataSourceConnector.java:130) at org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1091) at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest.testFileOverMethod(ErrorStreamTest.java:257) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at &lt;unknown class&gt;.&lt;unknown method&gt;(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95)9) testFileOverField(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)junit.framework.AssertionFailedError: shutdown engine not implemened at org.apache.derbyTesting.junit.DataSourceConnector.shutEngine(DataSourceConnector.java:130) at org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1091) at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest.testFileOverField(ErrorStreamTest.java:278) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at &lt;unknown class&gt;.&lt;unknown method&gt;(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95)10) testFileOverMethodAndField(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)junit.framework.AssertionFailedError: shutdown engine not implemened at org.apache.derbyTesting.junit.DataSourceConnector.shutEngine(DataSourceConnector.java:130) at org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1091) at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest.testFileOverMethodAndField(ErrorStreamTest.java:302) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at &lt;unknown class&gt;.&lt;unknown method&gt;(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95)11) testMethodOverField(org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest)junit.framework.AssertionFailedError: shutdown engine not implemened at org.apache.derbyTesting.junit.DataSourceConnector.shutEngine(DataSourceConnector.java:130) at org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1091) at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest.testMethodOverField(ErrorStreamTest.java:326) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at &lt;unknown class&gt;.&lt;unknown method&gt;(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95),0,0
Group by query with many aggregate columns and case statements fails with: ERROR XSDA7: Restore of a serializable or SQLData object of class   attempted to read more data than was originally stored,using the attached database (v10.3) - ' select * from pivotview ' fails with the stack trace below. A view (pivotview_ok) created on a subset of the columns in pivotview executes fine. Adding one column back into pivotview_ok causes failures most of the time. See attached for view definitions.2007-11-21 00:58:49.421 GMT Thread&#91;main 5 main&#93; (XID = 2734422)  (SESSIONID = 0)  (DATABASE = pivotview)  (DRDAID = null)  Failed Statement is: select * from pivotviewERROR XSDA7: Restore of a serializable or SQLData object of class   attempted to read more data than was originally stored at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.impl.store.raw.data.StreamFileContainer.fetchNext(Unknown Source) at org.apache.derby.impl.store.raw.data.StreamFileContainerHandle.fetchNext(Unknown Source) at org.apache.derby.impl.store.access.sort.MergeScan.mergeARow(Unknown Source) at org.apache.derby.impl.store.access.sort.MergeScan.init(Unknown Source) at org.apache.derby.impl.store.access.sort.MergeSort.openSortScan(Unknown Source) at org.apache.derby.impl.store.access.RAMTransaction.openSortScan(Unknown Source) at org.apache.derby.impl.sql.execute.GroupedAggregateResultSet.loadSorter(Unknown Source) at org.apache.derby.impl.sql.execute.GroupedAggregateResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source) at org.apache.derby.impl.tools.ij.Main14.main(Unknown Source) at org.apache.derby.tools.ij.main(Unknown Source)Caused by: java.io.EOFException at java.io.DataInputStream.readBoolean(DataInputStream.java:248) at org.apache.derby.impl.sql.execute.MaxMinAggregator.readExternal(Unknown Source) at org.apache.derby.iapi.services.io.FormatIdInputStream.readObject(Unknown Source) at org.apache.derby.iapi.types.UserType.readExternal(Unknown Source) ... 22 more============= begin nested exception  level (1) ===========java.io.EOFException at java.io.DataInputStream.readBoolean(DataInputStream.java:248) at org.apache.derby.impl.sql.execute.MaxMinAggregator.readExternal(Unknown Source) at org.apache.derby.iapi.services.io.FormatIdInputStream.readObject(Unknown Source) at org.apache.derby.iapi.types.UserType.readExternal(Unknown Source) at org.apache.derby.impl.store.raw.data.StreamFileContainer.fetchNext(Unknown Source) at org.apache.derby.impl.store.raw.data.StreamFileContainerHandle.fetchNext(Unknown Source) at org.apache.derby.impl.store.access.sort.MergeScan.mergeARow(Unknown Source) at org.apache.derby.impl.store.access.sort.MergeScan.init(Unknown Source) at org.apache.derby.impl.store.access.sort.MergeSort.openSortScan(Unknown Source) at org.apache.derby.impl.store.access.RAMTransaction.openSortScan(Unknown Source) at org.apache.derby.impl.sql.execute.GroupedAggregateResultSet.loadSorter(Unknown Source) at org.apache.derby.impl.sql.execute.GroupedAggregateResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source) at org.apache.derby.impl.tools.ij.Main14.main(Unknown Source) at org.apache.derby.tools.ij.main(Unknown Source)============= end nested exception  level (1) ===========Cleanup action completed,0,0
'java.sql.SQLException: The conglomerate (-5) requested does not exist.' from Derby 10.3.1.4 embedded within Eclipse 3.3 and RAD 7.0,We are getting an SQLException when several prepared statement deletes are done upon an existing database. As far as we can tell this exception should never occur unless (evil) things like deleting the database or editing files occurs. This is using the embedded driver within a plug-in inside RAD 7.0 (and Eclipse 3.3).I'm not sure what else to submit that might be helpful.java.sql.SQLException: The conglomerate (-5) requested does not exist. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(Unknown Source) at sun.reflect.GeneratedMethodAccessor12.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source) at java.lang.reflect.Method.invoke(Unknown Source) at com.surelogic.sierra.jdbc.LazyPreparedStatementConnection$LazyPreparedStatement.invoke(Unknown Source) at $Proxy1.execute(Unknown Source) at com.surelogic.sierra.jdbc.finding.FindingManager.delete(Unknown Source) at com.surelogic.sierra.jdbc.finding.ClientFindingManager.updateLocalFindings(Unknown Source) at com.surelogic.sierra.jdbc.project.ClientProjectManager.synchronizeProject(Unknown Source) at com.surelogic.sierra.client.eclipse.jobs.SynchronizeJob.synchronize(Unknown Source) at com.surelogic.sierra.client.eclipse.jobs.SynchronizeJob.run(Unknown Source) at org.eclipse.core.internal.jobs.Worker.run(Unknown Source)Caused by: ERROR XSAI2: The conglomerate (-5) requested does not exist. at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.impl.store.access.RAMTransaction.findExistingConglomerate(Unknown Source) at org.apache.derby.impl.store.access.RAMTransaction.openScan(Unknown Source) at org.apache.derby.impl.sql.execute.TemporaryRowHolderResultSet.getNextRowCore(Unknown Source) at org.apache.derby.impl.sql.execute.TemporaryRowHolderResultSet.getNextRow(Unknown Source) at org.apache.derby.impl.sql.execute.IndexChanger.finish(Unknown Source) at org.apache.derby.impl.sql.execute.IndexSetChanger.finish(Unknown Source) at org.apache.derby.impl.sql.execute.RowChangerImpl.finish(Unknown Source) at org.apache.derby.impl.sql.execute.UpdateResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) ... 14 more,0,0
'CollationTest' fails with ' expected: but was:' in testPolishCollation(CollationTest.java:402),See http://dbtg.thresher.com/derby/test/10.3Branch/jvm1.6/testing/Limited/testSummary-597152.html : sol.There was 1 failure:1) testPolishCollation(org.apache.derbyTesting.functionTests.tests.lang.CollationTest)junit.framework.AssertionFailedError: expected:&lt;1&gt; but was:&lt;0&gt; at org.apache.derbyTesting.functionTests.tests.lang.CollationTest.commonTestingForTerritoryBasedDB(CollationTest.java:1141) at org.apache.derbyTesting.functionTests.tests.lang.CollationTest.testPolishCollation(CollationTest.java:402) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25),0,0
testSysinfoLocale fails if derbyTools.jar is first in the classpath,) testSysinfoLocale(org.apache.derbyTesting.functionTests.tests.tools.SysinfoLocaleTest)junit.framework.AssertionFailedError: expected:&lt;false&gt; but was:&lt;true&gt; at org.apache.derbyTesting.functionTests.tests.tools.SysinfoLocaleTest.testSysinfoLocale(SysinfoLocaleTest.java:209) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:85) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:58) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:60) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)3) testSysinfoLocale(org.apache.derbyTesting.functionTests.tests.tools.SysinfoLocaleTest)junit.framework.AssertionFailedError: expected:&lt;false&gt; but was:&lt;true&gt; at org.apache.derbyTesting.functionTests.tests.tools.SysinfoLocaleTest.testSysinfoLocale(SysinfoLocaleTest.java:209) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:85) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:58) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:60) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)4) testSysinfoLocale(org.apache.derbyTesting.functionTests.tests.tools.SysinfoLocaleTest)junit.framework.AssertionFailedError: expected:&lt;true&gt; but was:&lt;false&gt; at org.apache.derbyTesting.functionTests.tests.tools.SysinfoLocaleTest.testSysinfoLocale(SysinfoLocaleTest.java:204) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:85) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:58) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:60) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)5) testSysinfoLocale(org.apache.derbyTesting.functionTests.tests.tools.SysinfoLocaleTest)junit.framework.AssertionFailedError: expected:&lt;true&gt; but was:&lt;false&gt; at org.apache.derbyTesting.functionTests.tests.tools.SysinfoLocaleTest.testSysinfoLocale(SysinfoLocaleTest.java:204) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:85) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:58) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:60) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)6) testSysinfoLocale(org.apache.derbyTesting.functionTests.tests.tools.SysinfoLocaleTest)junit.framework.AssertionFailedError: expected:&lt;false&gt; but was:&lt;true&gt; at org.apache.derbyTesting.functionTests.tests.tools.SysinfoLocaleTest.testSysinfoLocale(SysinfoLocaleTest.java:209) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:85) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:58) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:60) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)7) testSysinfoLocale(org.apache.derbyTesting.functionTests.tests.tools.SysinfoLocaleTest)junit.framework.AssertionFailedError: expected:&lt;true&gt; but was:&lt;false&gt; at org.apache.derbyTesting.functionTests.tests.tools.SysinfoLocaleTest.testSysinfoLocale(SysinfoLocaleTest.java:204) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:85) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:58) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:60) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:95) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23),0,0
Selecting data from a Table raises Error XN008: Query processing has been terminated due to an error on the server,I got a table (PCLASS) in my database where I cannot select the data via a simple select statement: If I execute 'select * from PCLASS': XN008: Query processing has been terminated due to an error on the server If I execute 'select * from PCLASS order by CLASSNAME': it works If I add or remove only one row to/from the table: it worksIf I use the embedded driver everything works fine. But as soon as I use the derby network client to access the database  this problem occurs.This is very odd. I spent a lot of time to do some research on this behavior because I could not believe that the network client produces errors depending on the data contained in a table. But after all it looks like I managed to fill the table with an exact amount of data that causes this error to arise.To reproduce the problem download the attached file and follow these instructions: extract test.rar to $derby.system.home$ start derby network server start ji utility and execute the following commands:  connect to database test using client driver: connect 'jdbc:derby://localhost/test;user=ZOL;password=zol'; select content of table PCLASS select * from PCLASS;--&gt; Error XN008: Query processing has been terminated due to an error on the server      disconnect from database disconnect; shutdown database 'test' connect 'jdbc:derby://localhost/test;user=ZOL;password=zol;shutdown=true'; connect to database 'test' using embedded driver: connect 'jdbc:derby:test;user=ZOL;password=zol'; select content of table PCLASS select * from PCLASS;--&gt; everything o.k.,0,0
NullPointerException in ....B2IRowLocking3.searchLeftAndLockPreviousKey,The last week(48) we have seen a large number of this failure.It was categorized as DERBY-2589 but these instances all have the NPE.Exception while trying to insert row number: 52ERROR XJ001: Java exception: ': java.lang.NullPointerException'.java.sql.SQLException: Java exception: ': java.lang.NullPointerException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(Unknown Source) at org.apache.derbyTesting.functionTests.tests.store.OnlineCompressTest.createAndLoadTable(OnlineCompressTest.java:140) at org.apache.derbyTesting.functionTests.tests.store.OnlineCompressTest.deleteAllRows(OnlineCompressTest.java:494) at org.apache.derbyTesting.functionTests.tests.store.OnlineCompressTest.test1(OnlineCompressTest.java:913) at org.apache.derbyTesting.functionTests.tests.store.OnlineCompressTest.testList(OnlineCompressTest.java:1500) at org.apache.derbyTesting.functionTests.tests.store.OnlineCompressTest.main(OnlineCompressTest.java:1520)Caused by: java.lang.NullPointerException at org.apache.derby.impl.store.access.btree.index.B2IRowLocking3.searchLeftAndLockPreviousKey(Unknown Source) at org.apache.derby.impl.store.access.btree.index.B2IRowLocking3.lockNonScanPreviousRow(Unknown Source) at org.apache.derby.impl.store.access.btree.BTreeController.doIns(Unknown Source) at org.apache.derby.impl.store.access.btree.BTreeController.insert(Unknown Source) at org.apache.derby.impl.store.access.btree.index.B2IController.insert(Unknown Source) at org.apache.derby.impl.sql.execute.IndexChanger.insertAndCheckDups(Unknown Source) at org.apache.derby.impl.sql.execute.IndexChanger.doInsert(Unknown Source) at org.apache.derby.impl.sql.execute.IndexChanger.insert(Unknown Source) at org.apache.derby.impl.sql.execute.IndexSetChanger.insert(Unknown Source) at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(Unknown Source) at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(Unknown Source) at org.apache.derby.impl.sql.execute.InsertResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) ... 8 moreThe error statistics shows the occurrences:(http://dbtg.thresher.com/derby/test/stats_today.html / http://dbtg.thresher.com/derby/test/stats_newest.html )http://dbtg.thresher.com/derby/test/statistics/2589_48.html :JIRA: 2589  Week: 48 600335-598009598009 Daily jvm1.4 vista598009 Daily jvm1.6 lin598341 Daily jvm1.6 solN+1598341 Daily jvm1.6 sparc598354 10.3Branch jvm1.5 lin598376 trunk16 jvmAll JDK16Jvm1.5SunOS-5.10_i86pc-i386598692 Daily jvm1.6 sol598729 trunk16 jvmAll JDK16Jvm1.6SunOS-5.10_i86pc-i386599062 Daily jvm1.5 lin599088 trunk15 jvm1.5 SunOS-5.10_i86pc-i386599088 trunk15 jvm1.5 SunOS-5.10_sun4u-sparc599088 trunk16 jvmAll JDK16Jvm1.5SunOS-5.10_i86pc-i386600335 Daily jvm1.4 linMon Dec 3 09:36:11 CET 2007http://dbtg.thresher.com/derby/test/statistics/2589_47.html seems to be the first occurence:JIRA: 2589  Week: 47 597885-597885597885 Daily jvm1.6 linMon Dec 3 09:36:13 CET 2007All are seen on trunk except one on the 10.3 branch (598354 10.3Branch jvm1.5 lin).,0,0
Minor cleanup in the Derby JUnit classes,Several of the JUnit classes have grown/developed and need various types of cleanup; remove unused imports improve/add JavaDoc remove unused methods etc...This issue is basically a placeholder for the patches.,0,0
NullPointer Exception (NPE) from query with IN predicate containing two values and joining a view with a large table.  ERROR 38000: The exception 'java.lang.NullPointerException' was thrown while evaluating an expression.,With a single value in the IN clause the query does not fail. &gt; Run the following query in the attached database (v 10.3 db). SELECT A.TIMESTAMP  B.F_NAMEADDR  B.TOTAL_F B.TOTAL_FS  B.TOTAL_FT  B.TOTAL_FXFROM TIME A  THE_VIEW BWHERE B.T_ID = A.T_ID AND B.F_NAMEADDR IN ('one.two.three.oscar' 'one.two.three.kathy')ORDER BY A.TIMESTAMP ASC;&gt; resultERROR 38000: The exception 'java.lang.NullPointerException' was thrown while evaluating an expression.ERROR XJ001: Java exception: ': java.lang.NullPointerException'.Stack trace: Failed Statement is: SELECT A.TIMESTAMP  B.F_NAMEADDR  B.TOTAL_F B.TOTAL_FS  B.TOTAL_FT  B.TOTAL_FXFROM TIME A  THE_VIEW BWHERE B.T_ID = A.T_ID AND B.F_NAMEADDR IN ('one.two.three.oscar' 'one.two.three.kathy')ORDER BY A.TIMESTAMP ASCERROR 38000: The exception 'java.lang.NullPointerException' was thrown while evaluating an expression. at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.iapi.error.StandardException.unexpectedUserException(Unknown Source) at org.apache.derby.impl.services.reflect.DirectCall.invoke(Unknown Source) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(Unknown Source) at org.apache.derby.impl.sql.execute.NestedLoopJoinResultSet.getNextRowCore(Unknown Source) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(Unknown Source) at org.apache.derby.impl.sql.execute.SortResultSet.getRowFromResultSet(Unknown Source) at org.apache.derby.impl.sql.execute.SortResultSet.getNextRowFromRS(Unknown Source) at org.apache.derby.impl.sql.execute.SortResultSet.loadSorter(Unknown Source) at org.apache.derby.impl.sql.execute.SortResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source) at org.apache.derby.impl.tools.ij.Main14.main(Unknown Source) at org.apache.derby.tools.ij.main(Unknown Source)Caused by: java.lang.NullPointerException at org.apache.derby.exe.ac601a400fx0116xa813xc2f7x00000010a3602.e8(Unknown Source) ... 21 more============= begin nested exception  level (1) ===========java.lang.NullPointerException at org.apache.derby.exe.ac601a400fx0116xa813xc2f7x00000010a3602.e8(Unknown Source) at org.apache.derby.impl.services.reflect.DirectCall.invoke(Unknown Source) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(Unknown Source) at org.apache.derby.impl.sql.execute.NestedLoopJoinResultSet.getNextRowCore(Unknown Source) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(Unknown Source) at org.apache.derby.impl.sql.execute.SortResultSet.getRowFromResultSet(Unknown Source) at org.apache.derby.impl.sql.execute.SortResultSet.getNextRowFromRS(Unknown Source) at org.apache.derby.impl.sql.execute.SortResultSet.loadSorter(Unknown Source) at org.apache.derby.impl.sql.execute.SortResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source) at org.apache.derby.impl.tools.ij.Main14.main(Unknown Source) at org.apache.derby.tools.ij.main(Unknown Source)============= end nested exception  level (1) ===========Schema info:CREATE TABLE TIME ('T_ID' BIGINT NOT NULL  'TIMESTAMP' TIMESTAMP NOT NULL  'DAY' INTEGER NOT NULL  'WEEK' INTEGER NOT NULL  'MONTH' INTEGER NOT NULL  'YEAR_COL' INTEGER NOT NULL);CREATE TABLE F ('F_ID' BIGINT NOT NULL  'T_ID' BIGINT NOT NULL  'F_NAMEADDR' VARCHAR(250) NOT NULL  'TOTAL_F' BIGINT NOT NULL  'TOTAL_FS' BIGINT NOT NULL  'TOTAL_FT' BIGINT NOT NULL  'TOTAL_FX' BIGINT NOT NULL);CREATE VIEW the_view AS SELECT T.T_ID AS T_ID   T.F_NAMEADDR AS F_NAMEADDR  T.TOTAL_F AS TOTAL_F  T.TOTAL_FS AS TOTAL_FS  T.TOTAL_FT AS TOTAL_FT   T.TOTAL_FX AS TOTAL_FX  FROM F AS T  WHERE T.T_ID = (SELECT MAX(T_ID) FROM F);,0,0
NullPointerException caused by race condition in GenericActivationHolder,I have a stress test using Derby 10.3.1.4 which is executing the same PreparedStatement using multiple threads concurrently and I consistently get the following NPE after several hours of running:2007-12-07 00:48:10.914 GMT Thread&#91;pool-5-thread-25 5 main&#93; (XID = 1219661)  (SESSIONID = 377)  (DATABASE = /usr/ironhide/var/db/opera/derby)  (DRDAID = null)  Failed Statement is: select rdbmsvaria0_.GUID_AND_INDEX as GUID1_3_0_  rdbmsvaria0_.VALUE2 as VALUE2_3_0_  rdbmsvaria0_.HOLDER_GUID as HOLDER3_3_0_  rdbmsvaria0_.VALUE_TYPE as VALUE4_3_0_  rdbmsvaria0_.VALUE_GUID as VALUE5_3_0_  rdbmsvaria0_.DELETED as DELETED3_0_ from VARIABLE rdbmsvaria0_ where rdbmsvaria0_.GUID_AND_INDEX=? with 1 parameters begin parameter #1: 9C202AB9E8356288A9320C9C383A4D2F-11 :end parameterjava.lang.NullPointerException at org.apache.derby.impl.sql.GenericActivationHolder.execute(GenericActivationHolder.java:271) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:368) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1203) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1652) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeQuery(EmbedPreparedStatement.java:275) at org.hibernate.jdbc.AbstractBatcher.getResultSet(AbstractBatcher.java:186) at org.hibernate.loader.Loader.getResultSet(Loader.java:1787) at org.hibernate.loader.Loader.doQuery(Loader.java:674) at org.hibernate.loader.Loader.doQueryAndInitializeNonLazyCollections(Loader.java:236) at org.hibernate.loader.Loader.loadEntity(Loader.java:1860) at org.hibernate.loader.entity.AbstractEntityLoader.load(AbstractEntityLoader.java:48) at org.hibernate.loader.entity.AbstractEntityLoader.load(AbstractEntityLoader.java:42) at org.hibernate.persister.entity.AbstractEntityPersister.load(AbstractEntityPersister.java:3044) at org.hibernate.event.def.DefaultLoadEventListener.loadFromDatasource(DefaultLoadEventListener.java:395) at org.hibernate.event.def.DefaultLoadEventListener.doLoad(DefaultLoadEventListener.java:375) at org.hibernate.event.def.DefaultLoadEventListener.load(DefaultLoadEventListener.java:139) at org.hibernate.event.def.DefaultLoadEventListener.proxyOrLoad(DefaultLoadEventListener.java:179) at org.hibernate.event.def.DefaultLoadEventListener.onLoad(DefaultLoadEventListener.java:103) at org.hibernate.impl.SessionImpl.fireLoad(SessionImpl.java:878) at org.hibernate.impl.SessionImpl.get(SessionImpl.java:815) at org.hibernate.impl.SessionImpl.get(SessionImpl.java:808) at sun.reflect.GeneratedMethodAccessor69.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.hibernate.context.ThreadLocalSessionContext$TransactionProtectionWrapper.invoke(ThreadLocalSessionContext.java:301) at $Proxy41.get(Unknown Source) at com.approuter.maestro.opera.rdbms.RdbmsContextHolder.getRdbmsVariable(RdbmsContextHolder.java:108) at com.approuter.maestro.opera.rdbms.RdbmsContextHolder.getVariable(RdbmsContextHolder.java:94) at com.approuter.maestro.vm.Frame.getParameter(Frame.java:218) at com.approuter.maestro.vm.Task.getParameter(Task.java:1267) at com.approuter.maestro.vm.CallContextImpl.setOutputParameter(CallContextImpl.java:195) at com.approuter.maestro.vm.CallContextImpl.getOutputParameterWriter(CallContextImpl.java:264) at com.approuter.maestro.sdk.mpi.DynamicExecutableActivity$3$1.getWriter(DynamicExecutableActivity.java:249) at com.approuter.module.xml.XmlSerializeTextActivity$XmlSerializeTextActivityInstance.serialize(XmlSerializeTextActivity.java:43) at sun.reflect.GeneratedMethodAccessor161.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at com.approuter.maestro.sdk.mpi.DynamicExecutableActivity.execute(DynamicExecutableActivity.java:332) at com.approuter.maestro.activities.Invoke.call(Invoke.java:199) at sun.reflect.GeneratedMethodAccessor157.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at com.approuter.maestro.activities.Instruction.call(Instruction.java:22) at com.approuter.maestro.vm.Program.call(Program.java:456) at com.approuter.maestro.vm.Task.run(Task.java:580) at com.approuter.maestro.vm.Task.run(Task.java:531) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441) at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303) at java.util.concurrent.FutureTask.run(FutureTask.java:138) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:98) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:207) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:885) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907) at java.lang.Thread.run(Thread.java:619)Cleanup action completedHere is the relevant code from GenericActivationHolder.java // synchronized (ps) { /* Has the activation class changed? */ if (gc != ps.getActivationClass()) { // ensure the statement is valid by rePreparing it. ps.rePrepare(getLanguageConnectionContext()); // &lt;-- line 260 /*   If we get here  it means the PreparedStatement has been recompiled. Get a new Activation and check whether the parameters are compatible. If so  transfer the parameters from the old Activation to the new one  and make that the current Activation. If not  throw an exception. */ GeneratedClass newGC = ps.getActivationClass();   BaseActivation newAC = (BaseActivation) newGC.newInstance(lcc); // &lt;-- line 271 DataTypeDescriptor[] newParamTypes = ps.getParameterTypes();As you can see  the activation class returned by the ExecPreparedStatement is null as of line 271  even after having called a rePrepare(...) on the prepared statement (line 260). This is most likely due to a race condition. Also note that the containing block was formerly synchronized  but has since been commented out. From browsing the source in previous versions  the synchronized statement appears to have been commented out since before 10.0.2.1. It appears the fix is to reintroduce the synchronized block  or at least make the block inside the if statement synchronized.,0,0
Not possible for non-db-owner to create a temporary table. 'Get ERROR 42507: User 'USERB' can not perform the operation in schema 'SESSION'.',It seems that only the owner of a database may create tempoary tables in that db.This is not helpful as many other users may want to run a query on that db that relies upon the creation of temporary tables.I would expect non-db-owners to be able create temporay tables.The problem is demonstrated with:derby.properties like this:derby.connection.requireAuthentication=truederby.authentication.provider=BUILTINderby.database.sqlAuthorization=TRUEderby.user.usera=pwdderby.fullAccessUsers=useraderby.drda.host=192.168.1.50Start the network server and run up 'ij'.ij&gt;connect 'jdbc:derby://192.168.1.50:1527/TEST1;user=usera;password=pwd;create=true;';ij&gt; declare global temporary table t11(a int) on commit preserve rowsnot logged;0 rows inserted/updated/deletedAll good so far.Now try this (while still connected as usera):ij&gt; call SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY('derby.user.userb' 'pwd');Statement executed.ij&gt; call SYSCS_UTIL.SYSCS_SET_USER_ACCESS('userb' 'FULLACCESS');Statement executed.ij&gt; disconnect;ij&gt; connect 'jdbc:derby://192.168.1.50:1527/TEST1;user=userb;password=pwd;';ij&gt; declare global temporary table t1(a int) on commit preserve rows not logged;ERROR 42507: User 'USERB' can not perform the operation in schema 'SESSION'.SYSINFO:========------------------ Java Information ------------------Java Version: 1.6.0_02-eaJava Vendor: Sun Microsystems Inc.Java home: /usr/java/jdk1.6.0_02/jreJava classpath: /home/ajvok/derby/db-derby-10.3.1.4-bin/lib/derby.jar:/home/ajvok/derby/db-derby-10.3.1.4-bin/lib/derbynet.jar:/home/ajvok/derby/db-derby-10.3.1.4-bin/lib/derbytools.jar:/home/ajvok/derby/db-derby-10.3.1.4-bin/lib/derbyclient.jar:/home/ajvok/derby/local/sp1.jarOS name: LinuxOS architecture: i386OS version: 2.6.17-5mdvJava user name: ajvokJava user home: /home/ajvokJava user dir: /home/ajvok/derby/localjava.specification.name: Java Platform API Specificationjava.specification.version: 1.6--------- Derby Information --------JRE - JDBC: Java SE 6 - JDBC 4.0&#91;/home/ajvok/derby/db-derby-10.3.1.4-bin/lib/derby.jar&#93; 10.3.1.4 - (561794)&#91;/home/ajvok/derby/db-derby-10.3.1.4-bin/lib/derbytools.jar&#93; 10.3.1.4 - (561794)&#91;/home/ajvok/derby/db-derby-10.3.1.4-bin/lib/derbynet.jar&#93; 10.3.1.4 - (561794)&#91;/home/ajvok/derby/db-derby-10.3.1.4-bin/lib/derbyclient.jar&#93; 10.3.1.4 - (561794)----------------------------------------------------------------------- Locale Information -----------------Current Locale : [English/United Kingdom &#91;en_GB&#93;]Found support for locale: &#91;cs&#93; version: 10.3.1.4 - (561794)Found support for locale: &#91;de_DE&#93; version: 10.3.1.4 - (561794)Found support for locale: &#91;es&#93; version: 10.3.1.4 - (561794)Found support for locale: &#91;fr&#93; version: 10.3.1.4 - (561794)Found support for locale: &#91;hu&#93; version: 10.3.1.4 - (561794)Found support for locale: &#91;it&#93; version: 10.3.1.4 - (561794)Found support for locale: &#91;ja_JP&#93; version: 10.3.1.4 - (561794)Found support for locale: &#91;ko_KR&#93; version: 10.3.1.4 - (561794)Found support for locale: &#91;pl&#93; version: 10.3.1.4 - (561794)Found support for locale: &#91;pt_BR&#93; version: 10.3.1.4 - (561794)Found support for locale: &#91;ru&#93; version: 10.3.1.4 - (561794)Found support for locale: &#91;zh_CN&#93; version: 10.3.1.4 - (561794)Found support for locale: &#91;zh_TW&#93; version: 10.3.1.4 - (561794)------------------------------------------------------,1,0
Delayed (on-demand) creation of current user schema makes select from view belonging to other schema fail.,The enclosed repro fails with error 42Y07 'Schema BILL does not exist'  even thoughthe query does not reference that schema; it selects from joe.myview.,0,0
Derby 10.3.X ignores ORDER BY DESC when target column has an index and is used in an OR clause or an IN list.,Running the following produces the error seen in Derby 10.3.X but not in 10.2.X nor in 10.1.X.Don't know if this related to DERBY-3231.First query is incorrectly sorted whereas the second one is okay when there is an index on the table. If the table is not indexed  the sort works correctly in DESC order.------create table CHEESE ( CHEESE_CODE VARCHAR(5)  CHEESE_NAME VARCHAR(20)  CHEESE_COST DECIMAL(7 4));create index cheese_index on CHEESE (CHEESE_CODE DESC  CHEESE_NAME DESC  CHEESE_COST DESC);INSERT INTO CHEESE ( CHEESE_CODE  CHEESE_NAME  CHEESE_COST)VALUES ('00000'  'GOUDA'  001.1234)  ('00000'  'EDAM'  002.1111)  ('54321'  'EDAM'  008.5646)  ('12345'  'GORGONZOLA'  888.2309)  ('AAAAA'  'EDAM'  999.8888)  ('54321'  'MUENSTER'  077.9545);SELECT * FROM CHEESE WHERE (CHEESE_CODE='00000' OR CHEESE_CODE='54321') AND CHEESE_NAME='EDAM'ORDER BY CHEESE_CODE DESC  CHEESE_NAME DESC  CHEESE_COST DESC;SELECT * FROM CHEESE WHERE (CHEESE_CODE='AAAAA' OR CHEESE_CODE='54321') AND CHEESE_NAME='EDAM'ORDER BY CHEESE_CODE DESC  CHEESE_NAME DESC  CHEESE_COST DESC;,0,0
Uniqueness violation error (23505) occurs after dropping a PK constraint if there exists a foreign key on the same columns.,When there are multiple constraints on a single table and the constraints have the same set of columns (in the same order)  Derby tries to optimize things by re-using a single backing index for all of the relevant constraints. See the 'executeConstantAction()' method of CreateIndexConstantAction.java (search for 'duplicate').But there is a bug in Derby where  if one of the constraints is unique and is dropped  the uniqueness 'attribute' of the backing index is not updated accordingly. This means that uniqueness may be incorrectly enforced where it is not required.Take the following example ('Case 2' from DERBY-2204): ALTER TABLE NEWORDERS ADD CONSTRAINT NEWORDERS_PK PRIMARY KEY(NO_W_ID  NO_D_ID  NO_O_ID); ALTER TABLE NEWORDERS ADD CONSTRAINT NO_O_FK FOREIGN KEY (NO_W_ID  NO_D_ID  NO_O_ID) REFERENCES ORDERS;For these statements Derby will use a single backing index for both the primary constraint NEWORDERS_PK and the foreign key constraint NO_O_FK. That backing index will be unique because the primary key must itself be unique.If later we drop the primary key: ALTER TABLE NEWORDERS DROP CONSTRAINT NEWORDERS_PK;then the backing index needs to be converted from a unique index to a non-unique index (because a foreign key is not inherently unique). But in Derby the uniqueness attribute remains unchanged  so attempts to insert a duplicate (NO_W_ID  NO_D_ID  NO_O_ID) row into NEWORDERS will fail with error 23505  when it should really succeed.I tried this out on 10.1.3.1 and the same behavior occurs there  so marking 'Affects' versions for everything back to that...,0,0
Incorrect result from query with nested EXIST,Derby returns unexpected results from a query with embedded EXIST clauses. The query SQL is generated by the JPOX jdo implementation and is supposed to return all of the PERSONS and PROJECTS where there is an entry in the join table. This query works as expected when using MySQL.Here's the query:SELECT UNBOUND_E.PERSONID  UNBOUND_P.PROJID FROM applicationidentity0.DEPARTMENTS THIS   applicationidentity0.PERSONS UNBOUND_E   applicationidentity0.PROJECTS UNBOUND_P WHERE EXISTS (  SELECT 1 FROM applicationidentity0.PERSONS THIS_EMPLOYEES_E  WHERE EXISTS (  SELECT 1 FROM applicationidentity0.PROJECT_MEMBER THIS_EMPLOYEES_E_PROJECTS_P  WHERE THIS_EMPLOYEES_E_PROJECTS_P.'MEMBER' = THIS_EMPLOYEES_E.PERSONID  AND THIS_EMPLOYEES_E_PROJECTS_P.'MEMBER' = THIS_EMPLOYEES_E.PERSONID  AND THIS_EMPLOYEES_E.DEPARTMENT = THIS.ID  AND THIS_EMPLOYEES_E.DEPARTMENT = THIS.ID  AND UNBOUND_P.PROJID = THIS_EMPLOYEES_E_PROJECTS_P.PROJID  AND UNBOUND_E.PERSONID = THIS_EMPLOYEES_E.PERSONID)  );PERSONID |PROJID -----------------------3 |1 5 |3 4 |3 2 |1 1 |1 5 rows selectedI'm expecting 7 rows to be returned here  one row for each row in the join table. Here's the schema:CREATE TABLE departments ( ID INTEGER NOT NULL  NAME VARCHAR(32) NOT NULL  EMP_OF_THE_MONTH INTEGER  COMPANYID INTEGER  DISCRIMINATOR VARCHAR(255)  CONSTRAINT DEPTS_COMP_FK FOREIGN KEY (COMPANYID) REFERENCES companies  CONSTRAINT DEPTS_PK PRIMARY KEY (ID));CREATE TABLE persons ( PERSONID INTEGER NOT NULL  FIRSTNAME VARCHAR(32) NOT NULL  LASTNAME VARCHAR(32) NOT NULL  MIDDLENAME VARCHAR(32)  BIRTHDATE TIMESTAMP NOT NULL  ADDRID INTEGER  STREET VARCHAR(64)  CITY VARCHAR(64)  STATE CHAR(2)  ZIPCODE CHAR(5)  COUNTRY VARCHAR(64)  HIREDATE TIMESTAMP  WEEKLYHOURS REAL  DEPARTMENT INTEGER  FUNDINGDEPT INTEGER  MANAGER INTEGER  MENTOR INTEGER  HRADVISOR INTEGER  SALARY REAL  WAGE REAL  DISCRIMINATOR varchar(255) NOT NULL  CONSTRAINT PERS_DEPT_FK FOREIGN KEY (DEPARTMENT) REFERENCES departments  CONSTRAINT PERS_FUNDDEPT_FK FOREIGN KEY (FUNDINGDEPT) REFERENCES departments  CONSTRAINT PERS_MANAGER_FK FOREIGN KEY (MANAGER) REFERENCES persons  CONSTRAINT PERS_MENTOR_FK FOREIGN KEY (MENTOR) REFERENCES persons  CONSTRAINT PERS_HRADVISOR_FK FOREIGN KEY (HRADVISOR) REFERENCES persons  CONSTRAINT EMPS_PK PRIMARY KEY (PERSONID));CREATE TABLE projects ( PROJID INTEGER NOT NULL  NAME VARCHAR(32) NOT NULL  BUDGET DECIMAL(11 2) NOT NULL  DISCRIMINATOR VARCHAR(255)  CONSTRAINT PROJS_PK PRIMARY KEY (PROJID));CREATE TABLE project_member ( PROJID INTEGER REFERENCES projects NOT NULL  MEMBER INTEGER REFERENCES persons NOT NULL);ij&gt; connect 'jdbc:derby:/Users/clr/apache/jdo/trunk/tck2/target/database/derby/jdotckdb';ij&gt; set schema applicationidentity0;0 rows inserted/updated/deletedij&gt; select * from persons;PERSONID |FIRSTNAME |LASTNAME |MIDDLENAME |BIRTHDATE |ADDRID |STREET |CITY |STA&amp;|ZIPC&amp;|COUNTRY |HIREDATE |WEEKLYHOURS |DEPARTMENT |FUNDINGDEPT|MANAGER |MENTOR |HRADVISOR |SALARY |WAGE |DISCRIMINATOR -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------1 |emp1First |emp1Last |emp1Middle |1970-06-09 21:00:00.0 |NULL |NULL |NULL |NULL|NULL |NULL |1998-12-31 21:00:00.0 |40.0 |NULL |NULL |NULL |NULL |NULL |20000.0 |NULL |org.apache.jdo.tck.pc.company.FullTimeEmployee 2 |emp2First |emp2Last |emp2Middle |1975-12-21 21:00:00.0 |NULL |NULL |NULL |NULL|NULL |NULL |2003-06-30 21:00:00.0 |40.0 |NULL |NULL |NULL |NULL |NULL |10000.0 |NULL |org.apache.jdo.tck.pc.company.FullTimeEmployee 3 |emp3First |emp3Last |emp3Middle |1972-09-04 21:00:00.0 |NULL |NULL |NULL |NULL|NULL |NULL |2002-08-14 21:00:00.0 |19.0 |NULL |NULL |NULL |NULL |NULL |NULL |15.0 |org.apache.jdo.tck.pc.company.PartTimeEmployee 4 |emp4First |emp4Last |emp4Middle |1973-09-05 21:00:00.0 |NULL |NULL |NULL |NULL|NULL |NULL |2001-04-14 21:00:00.0 |0.0 |NULL |NULL |NULL |NULL |NULL |NULL |13.0 |org.apache.jdo.tck.pc.company.PartTimeEmployee 5 |emp5First |emp5Last |emp5Middle |1962-07-04 21:00:00.0 |NULL |NULL |NULL |NULL|NULL |NULL |1998-08-14 21:00:00.0 |0.0 |NULL |NULL |NULL |NULL |NULL |45000.0 |NULL |org.apache.jdo.tck.pc.company.FullTimeEmployee 5 rows selectedij&gt; select * from projects;PROJID |NAME |BUDGET |DISCRIMINATOR -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------1 |orange |2500000.99 |org.apache.jdo.tck.pc.company.Project 2 |blue |50000.00 |org.apache.jdo.tck.pc.company.Project 3 |green |2000.99 |org.apache.jdo.tck.pc.company.Project 3 rows selectedij&gt; select * from project_member;PROJID |MEMBER -----------------------2 |3 1 |3 2 |2 3 |5 3 |4 1 |2 1 |1 7 rows selected,0,0
NullPointerException during recovery of database with territory-based collation,When logical undo is performed on a database with territory-based collation  you may get a NullPointerException in SQLChar.getCollationKey() because SQLChar.getLocaleFinder() returns null.This bug was reported on derby-user: http://thread.gmane.org/gmane.comp.apache.db.derby.user/8253,0,0
ArrayIndexOutOfBoundsException at MergeSort.compare,Derby throws ArrayIndexOutOfBoundsException when I try to execute SQL query shown below.This is a regression  since Derby 10.2.2.0 executes this query without problems.Attached are DDL statements to create DB tables  and database itself (with data).2008-01-08 12:32:34.461 GMT Thread&#91;DRDAConnThread_5 6 derby.daemons&#93; (XID = 1497)  (SESSIONID = 0)  (DATABASE = InventorizacijaDB)  (DRDAID = NF000001.G46A-666250070078662256{1})  Failed Statement is: select MAX(preke0_.BARKODAS) as col_0_0_  MAX(preke0_.PAVADINIMAS) as col_1_0_  MAX(preke0_.KIEKIS) as col_2_0_  SUM(irasas1_.FAKTINIS_KIEKIS) as col_3_0_ from PREKE preke0_  IRASAS irasas1_  IRASU_BLOKAS irasubloka2_ where irasas1_.IRASU_BLOKAS=irasubloka2_.ID and preke0_.UNIKALUS_KODAS=irasas1_.UNIKALUS_KODAS and irasubloka2_.INVENTORIZACIJA=? group by irasas1_.UNIKALUS_KODAS order by abs(SUM(irasas1_.FAKTINIS_KIEKIS)-MAX(preke0_.KIEKIS)) DESC with 1 parameters begin parameter #1: 1 :end parameter java.lang.ArrayIndexOutOfBoundsException: 5 at org.apache.derby.impl.store.access.sort.MergeSort.compare(Unknown Source) at org.apache.derby.impl.store.access.sort.SortBuffer.insert(Unknown Source) at org.apache.derby.impl.store.access.sort.MergeInserter.insert(Unknown Source) at org.apache.derby.impl.sql.execute.SortResultSet.loadSorter(Unknown Source) at org.apache.derby.impl.sql.execute.SortResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.drda.DRDAStatement.execute(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source),0,0
Explicit commit inside a java procedure makes a dynamic result sets passed out unavailable,Repro (Main.java) that shows changed behavior after svn 602991(the patch committed for this issue). It seems a regression: (originally from Dag H. Wanvik attached to DERBY-1585)An explicit commit inside a stored procedure makes a dynamic result sets passed out unavailable  even if the commit is executed prior to the result set; as in the repro.,0,0
Embedded ResultSet.getStatement() returns incorrect reference for dynamic result sets,ResultSets returned as dynamic results sets  ie. those created in a java procedure and returned via the java.sql.Statement that executed the call of the procedure  do not return the correct statement reference for getStatement. Need to return reference to statement that executed the CALL and returned the ResultSet instead of the statement that performed the executeQuery.,0,0
Client ResultSet.getHoldabilty will return incorrect value when the ResultSet is obtained from a procedure call,Fixing DERBY-3305 (aka DERBY-1111) exposes that the holdability for a result set sent over DRDA is being obtained from the Statement that created the JDBC ResultSet  not its actual holdability. The two can be different when the result set is dynamic result set from a procedure.jdbc4.ResultSetTest.getHoldability fails in client mode.,0,0
Leak in client if ResultSet not closed,If I run the attached program RepeatStatement.java with 32M of heap I will get an OutOfMemory error in the client.java -Xmx32M RepeatStatementException in thread 'main' java.lang.OutOfMemoryError: Java heap space at org.apache.derby.client.am.Cursor.allocateCharBuffer(Cursor.java:1260) at org.apache.derby.client.net.NetStatementReply.parseSQLDTARDarray(NetStatementReply.java:1356) at org.apache.derby.client.net.NetStatementReply.parseQRYDSC(NetStatementReply.java:1207) at org.apache.derby.client.net.NetStatementReply.parseOpenQuery(NetStatementReply.java:479) at org.apache.derby.client.net.NetStatementReply.parseOPNQRYreply(NetStatementReply.java:223) at org.apache.derby.client.net.NetStatementReply.readOpenQuery(NetStatementReply.java:64) at org.apache.derby.client.net.StatementReply.readOpenQuery(StatementReply.java:50) at org.apache.derby.client.net.NetStatement.readOpenQuery_(NetStatement.java:153) at org.apache.derby.client.am.Statement.readOpenQuery(Statement.java:1396) at org.apache.derby.client.am.Statement.flowExecute(Statement.java:2001) at org.apache.derby.client.am.Statement.executeQueryX(Statement.java:421) at org.apache.derby.client.am.Statement.executeQuery(Statement.java:406) at RepeatStatement.testInsertAndSelect(RepeatStatement.java:31) at RepeatStatement.main(RepeatStatement.java:10)If I close the ResultSet or Statement it does not leak. This occurs on trunk and 10.2.1.6. It does however not run out of memory on 10.1.3.1  so appears to be a regression.,0,1
Logical connections do not check if a transaction is active on close,If you call close on a logical connection  for instance as obtained through a PooledConnection  it does not check if there is an active transaction.The close of the logical connection is allowed  and even the close of the parent PooledConnection is allowed in the client driver. This can/will cause resources to be left on the server  and later operations might fail (typically with lock timeouts because the 'closed' transaction is still holding locks).I do not know if gc will solve this eventually  but I would say the current behavior of the client driver is wrong in any case.There is difference in the behavior between the embedded and the client driver  and there also seems to be a bug in the embedded driver.The analysis above is a bit sketchy  so it might be required to look into the issue a bit more...I will attach a repro (JDBC usage should be verified as well  is it legal / as intended?),0,1
Database creation and boot should fail if collation=TERRITORY_BASED and the selected locale is not supported,A problem I've discovered when testing with the phoneME advanced platform is that the collationtests expect other locales than Locale.US to be available on the platform that is used for the test  and for phoneME advanced (when compiled as foundation profile) only Locale.US is available. From the jdk1.6 javadoc of Collator.getAvailableLocales() I see that only Locale.US is strictly required:public static Locale[] getAvailableLocales() Returns an array of all locales for which the getInstance methods of this class can return localized instances. The returned array represents the union of locales supported by the Java runtime and by installed CollatorProvider implementations. It must contain at least a Locale instance equal to Locale.US. Returns: An array of locales for which localized Collator instances are available.This led me to thinking about how Derby should behave if created/booted with collation=TERRITORY_BASED and territory=&lt;some unsupported locale&gt;. I'm not sure what the consequences could be if the database is first created on a platform that supports whatever locale is set and later booted with one that doesn't  or created on a platform missing support and later booted with one that has. In any case I think it may confuse a user needlessly to see the database boot successfully with his collation setting and later behave in a way he does not expect.Opinions voiced on the derby-dev list are that both database creation and boot should fail if collation=TERRITORY_BASED and the selected locale is not supported.If a change like this is implemented  the collationtests should be changed to verify correct behavior also if they are executed in an environment were some of the tested locales are not supported.,0,0
provide support for unique constraint over keys that include one or more nullable columns.,Allow unique constraint over keys which include one or more nullable fields. Prior to this change Derby only supported unique constraints on keys that included no nullable columns. The new constraint will allow unlimited inserts of any key with one more null columns  but will limit insert of keys with no null columns to 1 unique value per table.There is no change to existing or newly created unique indexes on null columns (as opposed to unique constraints on null columns). Also there is no change to existing or newly created constraints on keys with no nullable columns.,0,0
jdbcapi/derbyStress.java no longer runs with low memory heap so does not provide testing for leak scenarios,This was raised as an issue in DERBY-3316  but it seems to make most sense to raise it as a separate issue. When derbyStress ran in derbyall it ran with 64MB heap so that it could test fixes for various memory leaks. When moved to JDBCHarnessJavaTest it started running with the full 512MB heap used for suites.All so no longer tests for those leaks. There are two options presented so far1) Move it back to derbyall 2) add it to the junit-all target For the adding it to the junit-all target option I think a few things have to happen for it to be run as part of the nightlies. 1) Convert derbyStress.java to junit. 2) create a junit-lomem target and make it part of junit-all. 3) Fix junit-all so that it can run with the nightlies. DERBY-2045 + distribute ant to the testing machines make nightly script changes etc.Myrna expressed some misgivings to relying on junit-all because ant is not available on all the platforms where she tests. I think the best course of action is to at least temporarily move the test back to derbyall and then open separate task(s) for the junit conversion effort.,0,0
Nested WHERE EXISTS queries need improved testing,DERBY-3301 reported an error in subquery flattening of nested WHERE EXISTS clauses  or WHERE EXISTS subqueries. The query returned the wrong number of rows. There is currently some tests for WHERE EXISTS  but none for nested WHERE EXISTS clauses.See DERBY-3301 for a full sql repro.,0,0
Invalid method java.lang.Integer >> void (short) because java.lang.NoSuchMethodException: java.lang.Integer.(short),Invalid method java.lang.Integer &gt;&gt; void &lt;init&gt;(short) because java.lang.NoSuchMethodException: java.lang.Integer.&lt;init&gt;(short)True  but I believe  not a helpful observation FN_MATCHES(A.f  C.d) returns short/SMALLINTrelated to DERBY-3310 ? But this is on the 10.3 branch &#91;10.3.2.2 - (616244M)&#93;DEBUG 68421 &#91;Main&#93; (Template.java:69) - SQL: SELECT A.a  D.b  B.c  C.d FROM C JOIN A ON C.e = 'I' AND A.f IS NOT NULL AND A.g = C.g AND FN_MATCHES(A.f  C.d) &lt;&gt; 1 JOIN B ON B.h = A.g JOIN D ON D.h = URID.hjava.lang.NoSuchMethodException: java.lang.Integer.&lt;init&gt;(short) at java.lang.Class.getConstructor0(Class.java:2706) at java.lang.Class.getConstructor(Class.java:1657) at org.apache.derby.impl.services.bytecode.d_BCValidate.checkMethod(d_BCValidate.java:115) at org.apache.derby.impl.services.bytecode.BCMethod.callMethod(BCMethod.java:745) at org.apache.derby.impl.services.bytecode.BCMethod.pushNewComplete(BCMethod.java:779) at org.apache.derby.impl.sql.compile.StaticMethodCallNode.generateExpression(StaticMethodCallNode.java:995) at org.apache.derby.impl.sql.compile.JavaToSQLValueNode.generateExpression(JavaToSQLValueNode.java:167) at org.apache.derby.impl.sql.compile.BinaryOperatorNode.generateExpression(BinaryOperatorNode.java:599) at org.apache.derby.impl.sql.compile.BinaryLogicalOperatorNode.generateExpression(BinaryLogicalOperatorNode.java:157) at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1484) at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1302) at org.apache.derby.impl.sql.compile.JoinNode.getJoinArguments(JoinNode.java:1579) at org.apache.derby.impl.sql.compile.JoinNode.generateCore(JoinNode.java:1555) at org.apache.derby.impl.sql.compile.JoinNode.generate(JoinNode.java:1479) at org.apache.derby.impl.sql.compile.JoinNode.getJoinArguments(JoinNode.java:1577) at org.apache.derby.impl.sql.compile.JoinNode.generateCore(JoinNode.java:1555) at org.apache.derby.impl.sql.compile.JoinNode.generate(JoinNode.java:1479) at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1440) at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1302) at org.apache.derby.impl.sql.compile.ScrollInsensitiveResultSetNode.generate(ScrollInsensitiveResultSetNode.java:109) at org.apache.derby.impl.sql.compile.CursorNode.generate(CursorNode.java:564) at org.apache.derby.impl.sql.compile.StatementNode.generate(StatementNode.java:347) at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:447) at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:88) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:746) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(EmbedPreparedStatement.java:129) at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&lt;init&gt;(EmbedPreparedStatement20.java:82) at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&lt;init&gt;(EmbedPreparedStatement30.java:63) at org.apache.derby.impl.jdbc.EmbedPreparedStatement40.&lt;init&gt;(EmbedPreparedStatement40.java:40) at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Driver40.java:105) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:923) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:751) &#91;..&#93; at org.apache.derby.exe.ac12564092x0117xc525x43e4xffffbce342b018.g0(Unknown Source) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(ReflectMethod.java:46) at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(CallStatementResultSet.java:74) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:173) at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80) at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278) at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1163) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:497) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:173) at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80) at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278) at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1163) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:497) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1203) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1652) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:299) at org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:101) at org.springframework.jdbc.core.JdbcTemplate$2.doInPreparedStatement(JdbcTemplate.java:745) at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:538) at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:739) at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:797) at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:801) at org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate.update(NamedParameterJdbcTemplate.java:218)Invalid method java.lang.Integer &gt;&gt; void &lt;init&gt;(short) because java.lang.NoSuchMethodException: java.lang.Integer.&lt;init&gt;(short)DEBUG 70472 &#91;Main&#93; (Template.java:120) - java.sql.SQLException: Java exception: 'ASSERT FAILED Invalid method java.lang.Integer &gt;&gt; void &lt;init&gt;(short) because java.lang.NoSuchMethodException: java.lang.Integer.&lt;init&gt;(short): org.apache.derby.shared.common.sanity.AssertFailure'.ERROR 70500 &#91;Main&#93; (TransactionTemplate.java:163) - Application exception overridden by rollback exceptionorg.springframework.jdbc.UncategorizedSQLException: PreparedStatementCallback; uncategorized SQLException for SQL [ &lt;Statement that fires trigger removed&gt; ]; SQL state &#91;XJ001&#93;; error code &#91;0&#93;; Java exception: ': java.lang.NullPointerException'.; nested exception is java.sql.SQLException: Java exception: ': java.lang.NullPointerException'.Caused by: java.sql.SQLException: Java exception: ': java.lang.NullPointerException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88) at org.apache.derby.impl.jdbc.Util.javaException(Util.java:245) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:1573) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1294) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1652) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:299) at org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:101) at org.springframework.jdbc.core.JdbcTemplate$2.doInPreparedStatement(JdbcTemplate.java:745) at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:538) at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:739) at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:797) at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:801) at org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate.update(NamedParameterJdbcTemplate.java:218)Caused by: java.sql.SQLException: Java exception: ': java.lang.NullPointerException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:135) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70) ... 29 moreCaused by: java.lang.NullPointerException at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:217) at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80) at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278) at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1163) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:497) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:173) at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80) at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278) at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1163) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:497) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1203) ... 22 moreFATAL 70508 &#91;Main&#93; (Start.java:153) - Start FAILEDorg.springframework.transaction.TransactionSystemException: Could not roll back JDBC transaction; nested exception is java.sql.SQLNonTransientConnectionException: No current connection.Caused by: java.sql.SQLNonTransientConnectionException: No current connection. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:76) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:104) at org.apache.derby.impl.jdbc.Util.noCurrentConnection(Util.java:208) at org.apache.derby.impl.jdbc.EmbedConnection.checkIfClosed(EmbedConnection.java:1548) at org.apache.derby.impl.jdbc.EmbedConnection.setupContextStack(EmbedConnection.java:1759) at org.apache.derby.impl.jdbc.EmbedConnection.rollback(EmbedConnection.java:1142) at org.apache.commons.dbcp.DelegatingConnection.rollback(DelegatingConnection.java:265) at org.apache.commons.dbcp.PoolingDataSource$PoolGuardConnectionWrapper.rollback(PoolingDataSource.java:288) at org.springframework.jdbc.datasource.DataSourceTransactionManager.doRollback(DataSourceTransactionManager.java:259) at org.springframework.transaction.support.AbstractPlatformTransactionManager.processRollback(AbstractPlatformTransactionManager.java:742) at org.springframework.transaction.support.AbstractPlatformTransactionManager.rollback(AbstractPlatformTransactionManager.java:719) at org.springframework.transaction.support.TransactionTemplate.rollbackOnException(TransactionTemplate.java:160) at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:138) Caused by: java.sql.SQLException: No current connection. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:135) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70) ... 21 morederby.logorg.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED Invalid method java.lang.Integer &gt;&gt; void &lt;init&gt;(short) because java.lang.NoSuchMethodException: java.lang.Integer.&lt;init&gt;(short) at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:162) at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:147) at org.apache.derby.impl.services.bytecode.d_BCValidate.checkMethod(d_BCValidate.java:190) at org.apache.derby.impl.services.bytecode.BCMethod.callMethod(BCMethod.java:745) at org.apache.derby.impl.services.bytecode.BCMethod.pushNewComplete(BCMethod.java:779) at org.apache.derby.impl.sql.compile.StaticMethodCallNode.generateExpression(StaticMethodCallNode.java:995) at org.apache.derby.impl.sql.compile.JavaToSQLValueNode.generateExpression(JavaToSQLValueNode.java:167) at org.apache.derby.impl.sql.compile.BinaryOperatorNode.generateExpression(BinaryOperatorNode.java:599) at org.apache.derby.impl.sql.compile.BinaryLogicalOperatorNode.generateExpression(BinaryLogicalOperatorNode.java:157) at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1484) at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1302) at org.apache.derby.impl.sql.compile.JoinNode.getJoinArguments(JoinNode.java:1579) at org.apache.derby.impl.sql.compile.JoinNode.generateCore(JoinNode.java:1555) at org.apache.derby.impl.sql.compile.JoinNode.generate(JoinNode.java:1479) at org.apache.derby.impl.sql.compile.JoinNode.getJoinArguments(JoinNode.java:1577) at org.apache.derby.impl.sql.compile.JoinNode.generateCore(JoinNode.java:1555) at org.apache.derby.impl.sql.compile.JoinNode.generate(JoinNode.java:1479) at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1440) at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1302) at org.apache.derby.impl.sql.compile.ScrollInsensitiveResultSetNode.generate(ScrollInsensitiveResultSetNode.java:109) at org.apache.derby.impl.sql.compile.CursorNode.generate(CursorNode.java:564) at org.apache.derby.impl.sql.compile.StatementNode.generate(StatementNode.java:347) at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:447) at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:88) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:746) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(EmbedPreparedStatement.java:129) at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&lt;init&gt;(EmbedPreparedStatement20.java:82) at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&lt;init&gt;(EmbedPreparedStatement30.java:63) at org.apache.derby.impl.jdbc.EmbedPreparedStatement40.&lt;init&gt;(EmbedPreparedStatement40.java:40) at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Driver40.java:105) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:923) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:751)&#91;our trigger stored proc java code&#93; at org.apache.derby.exe.ac12564092x0117xc525x43e4xffffbce342b018.g0(Unknown Source) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(ReflectMethod.java:46) at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(CallStatementResultSet.java:74) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:173) at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80) at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278) at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1163) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:497) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:173) at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80) at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278) at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1163) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:497) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1203) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1652) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:299) at org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:101) at org.springframework.jdbc.core.JdbcTemplate$2.doInPreparedStatement(JdbcTemplate.java:745) at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:538) at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:739) at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:797) at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:801) at org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate.update(NamedParameterJdbcTemplate.java:218)Cleanup action completed2008-01-29 10:44:58.980 GMT Thread&#91;Main 5 main&#93; Cleanup action startingjava.lang.NullPointerException at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:217) at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80) at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278) at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1163) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:497) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:173) at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80) at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278) at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1163) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:497) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1203) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1652) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:299) at org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:101) at org.springframework.jdbc.core.JdbcTemplate$2.doInPreparedStatement(JdbcTemplate.java:745) at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:538) at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:739) at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:797) at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:801) at org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate.update(NamedParameterJdbcTemplate.java:218)2008-01-29 10:44:58.987 GMT Thread&#91;Main 5 main&#93; Equally severe exception raised during cleanup (ignored) nulljava.lang.NullPointerException at org.apache.derby.impl.sql.compile.CompilerContextImpl.initRequiredPriv(CompilerContextImpl.java:698) at org.apache.derby.impl.sql.compile.CompilerContextImpl.resetContext(CompilerContextImpl.java:158) at org.apache.derby.impl.sql.compile.CompilerContextImpl.cleanupOnError(CompilerContextImpl.java:107) at org.apache.derby.iapi.services.context.ContextManager.cleanupOnError(ContextManager.java:327) at org.apache.derby.impl.jdbc.TransactionResourceImpl.cleanupOnError(TransactionResourceImpl.java:419) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:337) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:1573) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1294) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1652) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:299) at org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:101) at org.springframework.jdbc.core.JdbcTemplate$2.doInPreparedStatement(JdbcTemplate.java:745) at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:538) at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:739) at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:797) at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:801) at org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate.update(NamedParameterJdbcTemplate.java:218)Cleanup action completed,0,0
Replication failover implementation must be modified to fail at the master after slave has been stopped,Jorgen says...I tried to run the failover command on the master  which seems to work fine as long as the master and slave are still connected. If the slave has been stopped for some reason  however  failover hangs on MasterController#startFailover here: ack = transmitter.readMessage();,0,0
Various formatting erros in L10N property files,There are a number of formatting errors in the localization property files: DRDA_InvalidValue.U appears twice in the drda property files (english and translations) Spurious linefeed for XCL21.S in messages_zh_TW.properties Quadruple single quote rather than double single quote for contraction apostrophes in messages_it.properties,0,0
Adjust demos build.xml to avoid re-compiling SimpleApp and SimpleMobileApp,I propose to adjust the java/demo/build.xml file to change the 'srcdir' and 'includes'values on the javac task that compiles SimpleApp.java and SimpleMobileApp.java.Since these two Java programs are not inside of a package  Ant is happiest ifwe specify their srcdir directories directly  see:http://ant.apache.org/faq.html#always-recompiles The change to java/demo/build.xml will beIndex: java/demo/build.xml===================================================================&#8212; java/demo/build.xml (revision 616784)+++ java/demo/build.xml (working copy)@@ -86 9 +86 8 @@ optimize='${optimize}' proceed='${proceed}' verbose='${verbose}' srcdir='${derby.demo.src.dir}'- destdir='${out.dir}'- includes='simple/* simplemobile/*'&gt;+ srcdir='${derby.demo.src.dir}/simple:${derby.demo.src.dir}/simplemobile'+ destdir='${out.dir}'&gt; &lt;classpath&gt; &lt;pathelement location='${javasrc.dir};${jcc}'/&gt; &lt;pathelement path='${java14compile.classpath};${jcc}'/&gt;,0,0
Test case in GrantRevokeDDLTest looks to be accidentally commented out...,In lang/GrantRevokeDDLTest.java  beginning at line 8057 (at time of writing)  there looks to be a test case that was inadvertently commented out: // set connection user1 //ij(USER3)&gt; &#8211; test multiple FKs DERBY-1589?set // connection user1drop table user3.rt3drop table // user2.rt2drop table user1.rt1create table rt1 (c1 int // primary key not null  c2 int)insert into rt1 values // (1 1)  (2 2)grant references on rt1 to PUBLIC  user2  // user3set connection user2 XJ001 occurred at create table // rt2...create table rt2 (c1 int primary key not null  // constraint rt2fk foreign key(c1) references // user1.rt1)insert into rt2 values (1)  (2)grant // references on rt2 to PUBLIC  user3set connection // user3create table rt3 (c1 int primary key not null  // constraint rt3fk1 foreign key(c1) references // user1.rt1  constraint rt3fk2 foreign key(c1) references // user1.rt2)insert into rt3 values (1)  (2)set connection // user1 rt3fk1 should get dropped.revoke references on rt1 // from PUBLICrevoke references on rt1 from user3set // connection user2revoke references on rt2 from PUBLIC // expect errorinsert into rt2 values (3)set connection // user3 expect error  use user3 references privilege  // rt3fk2 still in effectinsert into rt3 values (3)set // connection user2revoke references on rt2 from user3set // connection user3 ok  rt3fk2 should be dropped.insert // into rt3 values (3)Based on the format of the comment  my guess is that this JUnit test was created using the conversion script attached to DERBY-2151  and that the script somehow messed up the conversion.The first line of the comment mentions DERBY-1589  but a) there is a question mark after it  and b) the commit for that issue does not appear to include the aforementioned lines.If the test case is supposed to be commented out  then some explanatory comments explaining why might be nice...,0,0
Replication: Slave must inform master if DBs are out of sync.,If I copy the database to the slave before booting the master  slave will be out of sync with the master since new log records are created during booting. The slave will then stop replication  but the master will not be notified.If I then try to stop or failover the master the master will hang.,0,1
The -ca option should be removed from ij and from the ij command usage line,The ij tool gives the following help output:Usage: java org.apache.derby.tools.ij &#91;-p propertyfile&#93; &#91;-ca connectionAttributePropertyFile&#93; &#91;inputfile&#93;The -ca connectionAttributePropertyFile option is no longer needed and is deprecated  so it is not documented in the Tools Guide. The option should also be removed from the usage statement.,0,0
Inconsistency in JDBC autogen APIs between Connection.prepareStatement(...) and Statement.execute(...),In EmbedStatement.java the execute(String  String[])  execute(String  int[])  executeUpdate(String  String[])  and executeUpdate(String  int[]) methods treat a 0-length array to mean NO_GENERATED_KEYS. But in EmbedConnection.java the prepareStatement(String  String[]) and prepareStatement(String  int[]) methods treat a 0-length array to mean RETURN_GENERATED_KEYS. For the sake of consistency  the two classes should treat 0-length arrays in the same way--which probably means changing EmbedConnection to match EmbedStatement.,0,0
DatabaseMetaData.getConnection returns the wrong connection when using connection pooling,The connection returned from DatabaseMetaData.getConnection is not the same as the connection used to create the meta data object when the client driver is used with connection pooling enabled.For trunk  the embedded driver/ds does the right thing.,0,0
Register a network port for replication,Register a network port at IANA which will be the default port for Derby Replication.,0,0
Allow SQL query text to be null in StatementKey,Because the SQL isn't checked before the cache is queried  StatementKey should allow the SQL query text to be null.This simplifies handling this exceptional situations  hopefully without complications.What will happen is  the cache is queried  null is returned (no match) and then prepare will fail in the driver. Because the statement is never prepared  it will never be inserted into the cached  nor (incorrectly) fetched from the cache in the first step.Of course  one could also explicitly check for null in either the Logical(Prepared|Callable)Statement&#91;40&#93;  StatementKeyFactory or StatementCacheInteractor.However  the proposed change is small  isolated to one class and makes the exceptional case be handled by the normal code path.,0,0
Move replication methods from org.apache.derby.database.Database to org.apache.derby.iapi.db.Database,,0,0
Simple column names specified as part of 'AS' clause in a table expression are ignored if the table expression is a view.,Simple repro as follows:create table t1 (i int  j int);insert into t1 values (1  1)  (1  -1)  (2  2)  (3  -3)  (4  4);create view v1 as select j  i from t1;create view v2 (x y z) as select j  i  i+j from t1;&#8211; OK: Returns column names specified in AS clause.select * from t1 as x(a b);&#8211; OK: Returns column names for the viewsselect * from v1;select * from v2;&#8211; WRONG: Ignores column names specified in AS clause for the views.select * from v1 x(a b);select * from v2 as x(a b c);I observed this as far back as 10.0.2.1  so this is not a regression.,0,0
Changed/unexpected query plan when running test 'lang/predicatePushdown.sql',Seen in tinderbox since r631930.See e.g. http://dbtg.thresher.com/derby/test/tinderbox_trunk16/jvm1.6/testing/testlog/SunOS-5.10_i86pc-i386/631932-derbyall_diff.txt :     Start: predicatePushdown jdk1.6.0_04 derbyall:derbylang 2008-02-28 14:02:49 ***9285 del&lt; Rows seen from the left = 209285a9285&gt; Rows seen from the left = 109297 del&lt; Rows seen from the right = 209297a9297&gt; Rows seen from the right = 109299 del&lt; Rows returned = 209299a9299&gt; Rows returned = 10...,0,0
Error message XRE04 does not include the right port number.,If the master is not able to connect to the slave  the error messages does not include the right port number:ij&gt; connect 'jdbc:derby:masterDB;user=oystein;password=pass;startMaster=true;slaveHost=localhost;slavePort=9901';ERROR XRE04: Could not establish a connection to the peer of the replicated database 'masterDB' on address 'localhost:-1'.,0,0
When the replication log buffer becomes full  the chunk of log that should be appended is to the buffer is discarded,In MasterController#appendLog  log is force-sent to the slave if the replication log buffer becomes full. However  the log chunk that should have been appended is discarded:try { logBuffer.appendLog(greatestInstant  log  logOffset  logLength);} catch (LogBufferFullException lbfe) { try { logShipper.forceFlush(); } catch (IOException ioe) {...}The log chunk must be added after freeing a log buffer by calling forceFlush,0,0
Move the setup of NormalizeResultSetNode into the NormalizeResultSetNode,In DERBY-3310 Dan suggested ...Setting up a NormalizeResultSetNode is spread over three locations  the class itself (very little  it's almost acting like a C struct) the genNormalizeResultSetNode method and then copyLengthsAndTypesToSource. A good O-O implementation would havethe logic to create a NormalizeResultSetNode self-contained in NormalizeResultSetNode.Since the ResultColumnList of the original ResultSetNode correctly describes the desired outcome  it's not clear tome why NormalizeResultSetNode can't just refer to the same list and use it for its processing. They may be some chancethat this would cause recursion at some point  where a NormalizeResultSetNode would think it needed to be wrappedin a NormalizeResultSetNode since the types of its columns and expression don't match (i.e. when it is handled as a regular ResultSetNode).I think moving the setup of a NormalizeResultSetNode into the class itself  so that its inputs are just the ResultSetNode to wrapwould help clear up the code  especially if comments were added indicating why certain actions were being taken.I am separating this task out into a separate issue  so that it can be worked on independently of DERBY-3310.,0,0
CallableStatement with output parameter leaves cursor open after execution,When executing a CallableStatement which has an output parameter  the language result set is left open and makes subsequent calls to Connection.setTransactionIsolation() fail with 'ERROR X0X03: Invalid transaction state - held cursor requires same isolation level'.,0,0
OOME at slave during replication,After deleting and inserting more than 1 million records during replication  I got java.lang.OutOfMemoryError: Java heap space.The heap dump shows that almost the entire heap is byte arrays  and it seems most of them are referred to by ReplicationMessage objects. An inspection of the heap dump in VisualVM it seems that it is references rooted in SocketConnection#objInputStream that keeps them from being garbage collected.,0,1
startNetworkServer and stopNetworkServer don't pass arguments,The help scripts $DERBY_HOME/bin/startNetworkServer and $DERBY_HOME/bin/stopNetworkServer don't pass arguments (as '-h' or '-p') to class org.apache.derby.drda.NetworkServerControl.Solution: append command line with '$@'before:derby_exec_command='exec /'$JAVACMD/' $DERBY_OPTS -classpath /'$LOCALCLASSPATH/' org.apache.derby.drda.NetworkServerControl start'after:derby_exec_command='exec /'$JAVACMD/' $DERBY_OPTS -classpath /'$LOCALCLASSPATH/' org.apache.derby.drda.NetworkServerControl start $@',0,0
The replication log shipper is not notified when a new replication transmitter is instantiated in MC#handleException.,In MasterController#handleException  a new ReplicationMessageTransmit object is created if the exception is IOException. However  the logShipper is not notified that the new transmitter should be used. A possible solution would be to add a setTransmitter method to AsynchronousLogShipper. Note that the logShipper may contain state information that cannot be discarded  so it cannot be reinstantiated.,0,0
specialCollation() and noSpecialCollation() in TableFunctionTest fail with weme6.1.,The 'specialCollation()' and 'noSpecialCollation()' fixtures in TableFunctionTest fail when run with weme6.1. I have not explicitly confirmed but it looks like this may be related to svn # 636004. The stack trace is:noSpecialCollation(o.a.dTesting.functionTests.tests.lang.TableFunctionTest)java.sql.SQLException: An attempt was made to get a data value of type 'java.lang.Object' from a data value of type 'DECIMAL'. at o.a.d.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at o.a.d.impl.jdbc.Util.generateCsSQLException(Unknown Source) at o.a.d.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at o.a.d.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at o.a.d.impl.jdbc.EmbedConnection.handleException(Unknown Source) at o.a.d.impl.jdbc.ConnectionChild.handleException(Unknown Source) at o.a.d.impl.jdbc.EmbedResultSet.closeOnTransactionError(Unknown Source) at o.a.d.impl.jdbc.EmbedResultSet.movePosition(Unknown Source) at o.a.d.impl.jdbc.EmbedResultSet.next(Unknown Source) at o.a.dTesting.functionTests.tests.lang.TableFunctionTest.assertResults(TableFunctionTest.java:1935) at o.a.dTesting.functionTests.tests.lang.TableFunctionTest.assertResults(TableFunctionTest.java:1776) at o.a.dTesting.functionTests.tests.lang.TableFunctionTest.assertResults(TableFunctionTest.java:1762) at o.a.dTesting.functionTests.tests.lang.TableFunctionTest.allLegalDatatypesVTIResults(TableFunctionTest.java:1178) at o.a.dTesting.functionTests.tests.lang.TableFunctionTest.tableFunctionTest(TableFunctionTest.java:921) at o.a.dTesting.functionTests.tests.lang.TableFunctionTest.noSpecialCollation(TableFunctionTest.java:897) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205) at o.a.dTesting.junit.BaseTestCase.runBare(BaseTestCase.java:101)Caused by: ERROR 22005: An attempt was made to get a data value of type 'java.lang.Object' from a data value of type 'DECIMAL'. at o.a.d.iapi.error.StandardException.newException(Unknown Source) at o.a.d.iapi.types.DataType.dataTypeConversion(Unknown Source) at o.a.d.iapi.types.DataType.getObject(Unknown Source) at o.a.d.impl.sql.execute.VTIResultSet.cast(Unknown Source) at o.a.d.impl.sql.execute.VTIResultSet.populateFromResultSet(Unknown Source) at o.a.d.impl.sql.execute.VTIResultSet.getNextRowCore(Unknown Source) at o.a.d.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(Unknown Source)Comments from RIck on derby-dev (in response to DERBY-3341 inquiry): 'The handling of DECIMAL on the small device platform is different. The test may need some special logic so that it calls the correct method for the small device environment.',0,0
NullPointerException during execution for query with LEFT OUTER JOIN whose inner table selects all constants.,For a query having a LEFT OUTER JOIN such that the right  or 'inner'  table is a SELECT subquery whose result column list consists entirely of constants  Derby may throw an execution-time NPE while trying to apply the join predicate. I say 'may' because it depends on which join strategy the optimizer chooses.Using optimizer overrides I was able to reproduce this problem against trunk with the following (admittedly nonsense) query: create table t1 (i int  j int); insert into t1 values (-1  -2)  (-2  -4)  (-3  -9); select * from t1 left outer join (select -1 a  1 b from t1) x0 --DERBY-PROPERTIES joinStrategy=NESTEDLOOP on x0.a = t1.i;I |J |A |B------------------------------------------------1 |-2 |-1 |1-1 |-2 |-1 |1-1 |-2 |-1 |1ERROR 38000: The exception 'java.lang.NullPointerException' was thrown while evaluating an expression.ERROR XJ001: Java exception: ': java.lang.NullPointerException'.Running the same query also failed with the same NPE on 10.0.2.1  even though optimizer overrides don't exist there. So I'm marking all known releases to be affected by this issue.Note: while this particular query may not make much sense  I have seen a user with a very large  auto-generated query that  when executed  fails due to this problem. So it is worth investigating...,0,0
If NetworkServer fails to shutdown when run as a separate process by NetworkServerTestSetup  test run will hang,If the NetworkServer fails to shutdown for some reason  we do not clean up the process but will just hang the tests. We should kill off the process if the server fails to shutdown and continue. To reproduce try runnning the test derbynet.SecureServerTest with 10.3 derbyTesting.jar and 10.4 jars. See DERBY-3534 for details.,0,1
Unable to start slave mode after authentication failure on a previous startSlave attempt,Trying a startSlave after an initial startSlave fails due to an authentication failure throws an errorsaying that the database has already been bootedvn@vn-laptop:~/work/workspaces/freshworkspace/slave$ java org.apache.derby.tools.ijij version 10.5ij&gt; connect 'jdbc:derby:mydb;startSlave=true;slaveHost=localhost;slavePort=8001';ERROR 08004: Connection authentication failure occurred. Reason: Invalid authentication..ij&gt; connect 'jdbc:derby:mydb;startSlave=true;user=oystein;password=pass;slaveHost=localhost;slavePort=8001';ERROR XRE09: Cannot start replication slave mode for database 'mydb'. The database has already been booted. ij&gt;,1,0
Change Collation test to run DatabaseMetaDataTest  BatchUpdateTest GroupByExpressionTest  and UpdateableResultSetTest for only one locale,Currently CollationTest runs DatabaseMetaDataTest  BatchUpdateTest GroupByExpressionTest  and UpdateableResultSetTest for multiple locales and territory based collation. It would be sufficient for these to run with a single locale and would save some time running tests.,0,0
regression test failure in testDerbyJarAttributeAlpha - Security Exception,I am getting 41 errors in this test of the following form  all security exceptions from the management test suite. I can post othersif necessary.2) testDerbyJarAttributeAlpha(org.apache.derbyTesting.functionTests.tests.management.VersionMBeanTest)javax.management.RuntimeMBeanException: java.lang.SecurityException: Access denied (org.apache.derby.security.SystemPermission engine monitor) at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.rethrow(DefaultMBeanServerInterceptor.java:856) at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.rethrowMaybeMBeanException(DefaultMBeanServerInterceptor.java:869) at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getAttribute(DefaultMBeanServerInterceptor.java:670) at com.sun.jmx.mbeanserver.JmxMBeanServer.getAttribute(JmxMBeanServer.java:638) at org.apache.derbyTesting.functionTests.tests.management.MBeanTest$4.run(MBeanTest.java:382) at java.security.AccessController.doPrivileged(AccessController.java:251) at org.apache.derbyTesting.functionTests.tests.management.MBeanTest.getAttribute(MBeanTest.java:379) at org.apache.derbyTesting.functionTests.tests.management.MBeanTest.checkBooleanAttributeValue(MBeanTest.java:431) at org.apache.derbyTesting.functionTests.tests.management.VersionMBeanTest.testDerbyJarAttributeAlpha(VersionMBeanTest.java:120) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:45) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:101) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)Caused by: java.lang.SecurityException: Access denied (org.apache.derby.security.SystemPermission engine monitor) at org.apache.derby.iapi.services.info.Version.checkMonitor(Version.java:70) at org.apache.derby.iapi.services.info.Version.isAlpha(Version.java:121) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:45) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:93) at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:27) at com.sun.jmx.mbeanserver.MBeanIntrospector.invokeM(MBeanIntrospector.java:208) at com.sun.jmx.mbeanserver.PerInterface.getAttribute(PerInterface.java:65) at com.sun.jmx.mbeanserver.MBeanSupport.getAttribute(MBeanSupport.java:216) at javax.management.StandardMBean.getAttribute(StandardMBean.java:358) at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getAttribute(DefaultMBeanServerInterceptor.java:666) ... 40 more,1,0
Alter column set data type not allowed in soft upgrade with unique constraint,In 10.3 I can do this:ij&gt; create table t0 (i int not null  v varchar(1) not null  constraint uq unique(v i));0 rows inserted/updated/deletedij&gt; alter table t0 alter v set data type varchar(2);0 rows inserted/updated/deletedij&gt;In 10.4 soft upgrade mode I cannot:ij&gt; create table t0 (i int not null  v varchar(1) not null  constraint uq unique(v i));0 rows inserted/updated/deletedij&gt; alter table t0 alter v set data type varchar(2);ERROR 42Z20: Column 'V' cannot be made nullable. It is part of a primary key or unique constraint  which cannot have anynullable columns.ij&gt;,0,0
LOB locators are not released if the LOB columns are not accessed by the client,If the client creates a result set containing LOB locator columns and iterates through it without actually accessing the LOB columns  the locators are not released.The amount of locators and their associated LOB objects causes the server to consume large amounts of memory and it eventually gets an OOME.There are a few workarounds for this bug: a) Access and/or properly close the LOBs (i.e. Blob.free). This is partly dependent on DERBY-2892. b) Invoke Connection.commit (or rollback) periodically  which causes all locators on the connection to be released.,0,1
Remove unused method Connection.resetConnection(LogWriter  String  Properties),The method Connection.resetConnection(LogWriter  String  Properties) in package org.apache.derby.client.am isn't used and can be removed.There is another resetConnection-method that is being used.,0,0
Changing certain properties on client DataSource objects causes existing connections to reflect the new values,The client driver has code propagating changes made to the DataSource to existing connections created by that DataSource.There is some discussion of this in the thread http://www.nabble.com/ConnectionPoolDataSource-properties-td15740457.html  and there is also an example of what can happen due to this 'feature'.Besides from being a bug with the potential to cause strange errors in deployment  the issue also makes the client driver code harder to read and understand.As far as I can see  there is also some related code in other parts of the client driver  for instance for 'fully' resetting statements. There is mention of dynamic versus static sections in the comments (this one from am.Statement): // If a dataSource is passed into resetClientConnection()  then we will assume // properties on the dataSource may have changed  and we will need to go through // the open-statement list on the connection and do a full reset on all statements  // including preparedStatement's and callableStatement's. This is because property // change may influence the section we allocate for the preparedStatement  and // also the cursor attributes  i.e. setCursorSensitivity(). // If no dataSource is passed into resetClientConnection()  then we will do the // minimum reset required for preparedStatement's and callableStatement's.Note that the reset code for statements is also invoked when ClientPooledConnection.getConnection() is invoked. I do not understand why we should reset statements when we get a new logical connection.Further  I also suspect the concept of a deferred reset has been introduced because of the feature/bug described by this Jira issue. A deferred reset seems to be a mechanism to avoid a round-trip to validate the newly changed DataSource properties (typically user  password and security mechanism).I will look into removing code related to deferred resets as well. If you have historic information about these parts of the driver  I would appreciate if you share it with the community if possible.Just to be clear  it is my opinion that changed DataSource properties should take effect when one of the following methods is invoked: DataSource.getConnection() ConnectionPoolDataSource.getPooledConnection() XADataSource.getXAConnection()All of the methods above returns a physical connection. Properties like user name and password are associated with the physical connection  and thus requests to obtain a logical connection should not cause any of these properties to change.,0,0
Remove am.Connection.reset(LogWriter ClientBaseDataSource boolean) and called methods,am.Connection.reset(LogWriter ClientBaseDataSource boolean) isn't called and can be removed.,0,0
suites.All fails to run on Jvm 1.5 when built with JDK 1.5 (Failed to invoke suite(): .jdbc4._Suite),Further  the following methods are only called from the reset(3):,0,0
TableFunctionTest.SpecialCollation and NoSpecialCollation fail with IBM iseries in checkGetXXXCalls,abstract Connection.reset_(3) and impl NetConnection.reset_(3),0,0
Creation of logical connections from a pooled connection causes resource leak on the server,NetConnection.resetNetConnection(3),0,1
'IN' clause ignores valid results  incorrect qualifier handling suspected,All these methods have cousins taking 4 arguments  which are being used by on one occasion: ClientPooledConnection.getConnection().,0,0
SELECT DISTINCT field FROM TABLE_NAME GROUP BY field   field2,Ӓ_x001F_芚ꡲ柅櫽组祘伊쑥收헄縐뎒ꥺ딁ꧢ擺鱁ʱ긓樥字⟈,0,0
TableFunctionTest fails under Ubuntu 7.10,When running the test org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest  it fails with the output shown below. This test blocks the proper execution of suites.All and it was tested under Ubuntu 7.10 (also tested on Windows Vista and it doesn't throw an error there).There were 2 errors:1) noSpecialCollation(org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest)java.sql.SQLException: The exception 'java.lang.ClassNotFoundException: ERROR XBM0U: No class was registered for identifier 495.' was thrown while evaluating an expression. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:87) at org.apache.derby.impl.jdbc.Util.seeNextException(Util.java:223) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:398) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2125) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) at org.apache.derby.impl.jdbc.EmbedResultSet.closeOnTransactionError(EmbedResultSet.java:4320) at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:463) at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:367) at org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest.assertResults(TableFunctionTest.java:1935) at org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest.assertResults(TableFunctionTest.java:1776) at org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest.assertResults(TableFunctionTest.java:1762) at org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest.simpleVTIResults(TableFunctionTest.java:1079) at org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest.tableFunctionTest(TableFunctionTest.java:920) at org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest.noSpecialCollation(TableFunctionTest.java:897) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:103)Caused by: java.sql.SQLException: Java exception: 'ERROR XBM0U: No class was registered for identifier 495.: java.lang.ClassNotFoundException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:87) at org.apache.derby.impl.jdbc.Util.javaException(Util.java:244) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403) ... 29 moreCaused by: java.lang.ClassNotFoundException: ERROR XBM0U: No class was registered for identifier 495. at org.apache.derby.iapi.services.io.FormatIdInputStream.readObject(FormatIdInputStream.java:129) at org.apache.derby.catalog.types.TypeDescriptorImpl.readExternal(TypeDescriptorImpl.java:491) at org.apache.derby.iapi.services.io.FormatIdInputStream.readObject(FormatIdInputStream.java:126) at org.apache.derby.impl.sql.execute.VTIResultSet.thawReturnType(VTIResultSet.java:696) at org.apache.derby.impl.sql.execute.VTIResultSet.getReturnColumnTypes(VTIResultSet.java:670) at org.apache.derby.impl.sql.execute.VTIResultSet.populateFromResultSet(VTIResultSet.java:559) at org.apache.derby.impl.sql.execute.VTIResultSet.getNextRowCore(VTIResultSet.java:347) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(BasicNoPutResultSetImpl.java:460) at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:423) ... 23 more2) specialCollation(org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest)java.sql.SQLException: The exception 'java.lang.ClassNotFoundException: ERROR XBM0U: No class was registered for identifier 495.' was thrown while evaluating an expression. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:87) at org.apache.derby.impl.jdbc.Util.seeNextException(Util.java:223) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:398) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2125) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) at org.apache.derby.impl.jdbc.EmbedResultSet.closeOnTransactionError(EmbedResultSet.java:4320) at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:463) at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:367) at org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest.assertResults(TableFunctionTest.java:1935) at org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest.assertResults(TableFunctionTest.java:1776) at org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest.assertResults(TableFunctionTest.java:1762) at org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest.simpleVTIResults(TableFunctionTest.java:1079) at org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest.tableFunctionTest(TableFunctionTest.java:920) at org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest.specialCollation(TableFunctionTest.java:907) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:103) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)Caused by: java.sql.SQLException: Java exception: 'ERROR XBM0U: No class was registered for identifier 495.: java.lang.ClassNotFoundException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:87) at org.apache.derby.impl.jdbc.Util.javaException(Util.java:244) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403) ... 45 moreCaused by: java.lang.ClassNotFoundException: ERROR XBM0U: No class was registered for identifier 495. at org.apache.derby.iapi.services.io.FormatIdInputStream.readObject(FormatIdInputStream.java:129) at org.apache.derby.catalog.types.TypeDescriptorImpl.readExternal(TypeDescriptorImpl.java:491) at org.apache.derby.iapi.services.io.FormatIdInputStream.readObject(FormatIdInputStream.java:126) at org.apache.derby.impl.sql.execute.VTIResultSet.thawReturnType(VTIResultSet.java:696) at org.apache.derby.impl.sql.execute.VTIResultSet.getReturnColumnTypes(VTIResultSet.java:670) at org.apache.derby.impl.sql.execute.VTIResultSet.populateFromResultSet(VTIResultSet.java:559) at org.apache.derby.impl.sql.execute.VTIResultSet.getNextRowCore(VTIResultSet.java:347) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(BasicNoPutResultSetImpl.java:460) at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:423) ... 39 moreFAILURES!!!Tests run: 2  Failures: 0  Errors: 2,0,0
testfailure in storetests/st_derby715 with ibm 1.5 on iseries machine; one deadlock message missing,I saw this fail once; a couple of reruns didn't duplicate the problem.The only difference appears to be that one of the deadlock messages is missing from the output.4 del&lt; Got a Deadlock.,0,0
Cannot use row_number() in ORDER BY clause,The following query works correctly:select abs(a)  row_number() over ()from twhere a &gt; 100 and a &lt; 111order by abs(a)I expected the following query to also work  but it raised an exception:select abs(a)  row_number() over ()from twhere a &gt; 100 and a &lt; 111order by row_number() over ()This is the error I saw: 'ERROR 42X01: Syntax error: Encountered 'over' at line 5  column 23'.Here are the reasons why I think that this syntax is supposed to be supported:According to my reading of the 2003 SQL spec  the ORDER BY clause should be able to sort on any expression in the SELECT list. That includes OLAP expressions. I believe this is so because  according to part 2  section 10.10 (&lt;sort specification&gt;)  a &lt;sort key&gt; can be any &lt;value expression&gt; and if you follow the grammar for &lt;value expression&gt;  it can resolve to be a &lt;value expression primary&gt; (see section 6.3)  which can in turn resolve to be a &lt;window function&gt;. This reasoning is supported by tracing the hotlinks on the following page which lays out the SQL 2003 BNF: http://savage.net.au/SQL/sql-2003-2.bnf.html This interpretation is further supported by the example of an ORDER BY clause referencing an OLAP expression which is provided on page 23 of the introduction to OLAP written by Fred Zemke  Krishna Kulkarni  Andy Witkowski  and Bob Lyle: www.cse.iitb.ac.in/dbms/Data/Papers-Other/SQL1999/OLAP-99-154r2.pdf,0,0
Derby does not follow the SQL Standard when trying to map SQL routines to Java methods.,I have only tested this in the 10.5 trunk. However  I suspect that this affects all previous releases of Derby as well.In resolving method signatures for function/procedure invocations  the SQL standard makes the following definitions in part 13  section 4.5 (parameter mapping). These definitions  in turn  refer to tables B-1 and B-3 in JDBC 3.0 Specification  Final Release  October 2001 (&#91;JDBC&#93;). Simply mappable - This refers to the correspondence of SQL and Java types described in &#91;JDBC&#93; table B-1. This is the table which defines the mapping of SQL types to Java primitives. Object mappable - This refers to the correspondence of SQL and Java types described in &#91;JDBC&#93; table B-3. This is the table which defines the mapping of SQL types to Java wrapper objects. Output mappable - For OUT and INOUT parameters  this refers to a single element array whose cell is simply mappable or object mappable. E.g. Integer[] or float[]. Mappable - This means simply  object  or output mappable. Result set mappable - This means a single element array whose cell is a type which implements either java.sql.ResultSet or sqlj.runtime.ResultSetIterator.Putting all of this together  section 4.5 continues: 'A Java method with M parameters is mappable (to SQL) if and only if  for some N  0 (zero) &lt;= N &lt;= M  the data types of the first N parameters are mappable  the last M - N parameters are result set mappable  and the result type is either simply mappable  object mappable  or void.'Section 8.6 gives more detailed rules  but they are hard to follow. According to section 8.6  when resolving a routine invocation  Derby should expect to find one and only one static mappable method with the expected external name (Java class + method name).I believe that this is a fair description of the rules. This  at least  is what some other databases appear to do. See  for instance  http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.help.ase_15.0.java/html/java/java126.htm and http://www.service-architecture.com/database/articles/mapping_sql_and_java_data_types.htmlWe do not have a regression test which verifies that Derby applies the SQL standard resolution rules. There may be several divergences from the standard. This JIRA is a place to track those discrepancies. Here is one that I have noticed:The following SQL signature( a int ) returns intshould be mappable to any of the following Java signaturespublic static int f( int a )public static int f( Integer a )public static Integer f( int a )public static Integer f( Integer a )However  I observe that Derby is only able to resolve the first and third signatures (the ones with primitive arguments). I will attach a test case showing this problem.I will also attach an html table summarizing the simply and object mappable rules.,0,0
errror in nightly regression test: LobStreamsTest:encryptedjunit.framework.AssertionFailedError: f:/jartest/JarResults.2008-04-29/ibm16_suites.All/system/singleUse/oneuse1e/tmp/lob6165.tmp,There was 1 failure:1) LobStreamsTest:encryptedjunit.framework.AssertionFailedError: f:/jartest/JarResults.2008-04-29/ibm16_suites.All/system/singleUse/oneuse1e/tmp/lob6165.tmp at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDir(DropDatabaseSetup.java:130) at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDir(DropDatabaseSetup.java:128) at org.apache.derbyTesting.junit.DropDatabaseSetup.access$000(DropDatabaseSetup.java:35) at org.apache.derbyTesting.junit.DropDatabaseSetup$1.run(DropDatabaseSetup.java:105) at java.security.AccessController.doPrivileged(AccessController.java:202) at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDirectory(DropDatabaseSetup.java:102) at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDirectory(DropDatabaseSetup.java:98) at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDatabase(DropDatabaseSetup.java:91) at org.apache.derbyTesting.junit.DropDatabaseSetup.tearDown(DropDatabaseSetup.java:77) at junit.extensions.TestSetup$1.protect(TestSetup.java:20) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23),0,0
Comment in template security policy incorrectly says that JMX is not enabled by default,The template policy located at $DERBY_HOME/demo/templates/server.policy (release distributions) and $trunk/java/drda/org/apache/derby/drda/template.policy (source tree) contains a comment relating to JMX permissions which says:// JMX management of Derby is NOT enabled by default; see also DERBY-1387.This was no longer true after DERBY-3429 was fixed  which includes the 10.4.1.3 release. JMX monitoring and management is enabled by default given that the JVM includes the required APIs  and that the security policy allows JMX features to come up. The comment should have been removed  but this has not happened. The same applies to the default server policy  server.policy  which also should be corrected (this policy's comments are however not exposed to users in the same way as the template).Note that no code or actual permissions need to change as a result of this; it is merely an outdated comment that needs to be removed in order not to give users a false impression.,1,0
LOBStateTracker should not use SYSIBM.CLOBRELEASELOCATOR when the database is soft-upgraded from 10.2,Reported by Daniel Noll on derby-user: http://thread.gmane.org/gmane.comp.apache.db.derby.user/9107To reproduce: 1. Create a database with Derby 10.2.2.0 2. Create a table with a clob column and insert some data 3. Access that database with client+server at version 10.4.1.3 and iterate through the rows in the tableYou'll see an error message like this:ERROR 42Y03: 'SYSIBM.CLOBRELEASELOCATOR' is not recognized as a function or procedure.,0,0
'ALTER TABLE' is not allowed on the System table ''SYSCS_DIAG'.'TRANSACTION_TABLE'' in derbyall - store/TransactionTable.sql,See e.g. http://dbtg.thresher.com/derby/test/tinderbox_trunk16/jvm1.6/testing/testlog/SunOS-5.10_i86pc-i386/655989-derbyall_diff.txt&lt;method&gt;store/TransactionTable.sql&lt;/method&gt;&lt;signature&gt;268 del&lt; 0 rows inserted/updated/deleted268a268 269&gt; ERROR 38000: The exception 'java.sql.SQLException: 'ALTER TABLE' is not allowed on the System table ''SY/SCS_DIAG'.'TRANSACTION_TABLE''.' was thrown while evaluating an expression.&gt; ERROR X0Y56: 'ALTER TABLE' is not allowed on the System table ''SYSCS_DIAG'.'TRANSACTION_TABLE''.&lt;/signature&gt;,0,0
SYSCS_BULK_INSERT doesn't quote identifiers or strings properly,Discovered by Mamta A. Satoor in DERBY-1062.SYSCS_BULK_INSERT builds an insert statement in which it doesn't quote the schema name or the table name. It also takes string parameters that are inserted into the statement text with single quotes around them  but that won't work if those strings contain single quote characters.,0,0
NullPointerException when invoking statement event listeners if one of the listeners is null,If PooledConnection.addStatementEventListener() is called with a null argument  the client driver throws a NullPointerException when the listeners are invoked. Embedded does not throw an exception.,0,0
If an IOException is encountered during establishment of the connection  Network Server should print the root exception to the console instead of a generic message,In working on DERBY-3701  I noticed that when the FileNotFound exception caused the connection to fail it just printed out a generic exception  not the IOException that caused the error.That is because of this code in ClientThread. catch (IOException ioe) { // IOException causes this thread to stop. No // console error message if this was caused by a // shutdown synchronized (parent.getShutdownSync()) { if (!parent.getShutdown()) { parent.consolePropertyMessage('DRDA_UnableToAccept.S'); } }In the event of an unexpected IOException the actual exception should print and the client socket should be closed if it has been established.,0,0
In Net Client mode  negative values for stream length are accepted without an exception for PreparedStatement.setAsciiStream(),This is related to Cloudscape bug 4250.Pass negative length as the stream length for various setXXXStream methods should throw an exception. But in Net Client mode  passing a negative value as stream length to PreparedStatement.setAsciiStream() doesn't throw an exception.e.g. //from store/StreamingColumnPreparedStatement ps = prepareStatement('insert into ' + 'testLongVarCharInvalidStreamLength11 values(?  ?  ?)'); ps.setInt(1  100); try { println('===&gt; testing using setAsciiStream with -2 as length'); ps.setAsciiStream(2  fileIn  -2); // should throw exception here but doesn't. }This issue has been fixed for embedded mode  but not for client mode.,0,0
setting tracedirectory from the command line does not work,I triedjava org.apache.derby.drda.NetworkServerControl tracedirectory /tmpand got:Trace directory changed to /tmp.java org.apache.derby.drda.NetworkServerControl trace onTrace turned on for all sessions.Trace turned on for all sessions.And the trace output was not redirected to the /tmp directory. The tracedirectory command seemed to be ignored.Setting tracedirectory with the system property derby.drda.traceDirectory or with the NetworkServerControl api seems to work ok.,0,0
NPE when firing a trigger,NullPointerException raised when firing a trigger. Originally reported by Thiyagu P on the Derby user list: http://www.nabble.com/Trigger-function-broken-in-10.4.1.3--td17760208.html#a17760208 Thiyagu reports that the same script works fine in 10.3.3.0. Here's the script:CREATE TABLE TRADE( ID INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1000)  BUYID INT NOT NULL  QTY FLOAT(2) NOT NULL ); CREATE TABLE TOTAL(BUYID INT NOT NULL  TOTALQTY FLOAT(2) NOT NULL); CREATE TRIGGER TRADE_INSERT AFTER INSERT ON TRADE REFERENCING NEW AS NEWROW FOR EACH ROW MODE DB2SQL UPDATE TOTAL SET TOTALQTY = NEWROW.QTY WHERE BUYID = NEWROW.BUYID; INSERT INTO TOTAL VALUES (1  0); INSERT INTO TRADE VALUES(1  1  10);Here's the stack trace:java.lang.NullPointerException at org.apache.derby.iapi.types.DataTypeDescriptor.getNull(DataTypeDescriptor.java:1008) at org.apache.derby.iapi.types.DataTypeDescriptor.normalize(DataTypeDescriptor.java:645) at org.apache.derby.impl.sql.execute.NormalizeResultSet.normalizeRow(NormalizeResultSet.java:329) at org.apache.derby.impl.sql.execute.NormalizeResultSet.getNextRowCore(NormalizeResultSet.java:189) at org.apache.derby.impl.sql.execute.DMLWriteResultSet.getNextRowCore(DMLWriteResultSet.java:127) at org.apache.derby.impl.sql.execute.UpdateResultSet.collectAffectedRows(UpdateResultSet.java:424) at org.apache.derby.impl.sql.execute.UpdateResultSet.open(UpdateResultSet.java:246) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:384) at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:159) at org.apache.derby.impl.sql.execute.RowTriggerExecutor.fireTrigger(RowTriggerExecutor.java:111) at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:269) at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1150) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:487) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:384) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:625) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:555) at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:329) at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:508) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:350) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:248) at org.apache.derby.impl.tools.ij.Main.go(Main.java:215) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181) at org.apache.derby.impl.tools.ij.Main.main(Main.java:73) at org.apache.derby.tools.ij.main(ij.java:59),0,0
'...replication.buffer.LogBufferFullException' causes failover to fail w/ 'XRE07  SQLERRMC: Could not perform operation because the database is not in replication master mode.',With the patch for DERBY-3709  derby-3709_p1-v2.diff.txt  I was able to provoke this error twice in 30 test runs on this platform (On another platform I saw none in 100 test runs.)I will upload the full test run log dir.'Summary':1) testReplication_Local_StateTest_part2(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part2)junit.framework.ComparisonFailure: Unexpected SQL state. expected:&lt;XRE&#91;20&#93;&gt; but was:&lt;XRE&#91;07&#93;&gt;Master derby.log:--------------------------------------------- BEGIN REPLICATION ERROR MESSAGE (6/10/08 4:08 PM) ----Exception occurred during log shipping.org.apache.derby.impl.store.replication.buffer.LogBufferFullException at org.apache.derby.impl.store.replication.buffer.ReplicationLogBuffer.switchDirtyBuffer(ReplicationLogBuffer.java:357) at org.apache.derby.impl.store.replication.buffer.ReplicationLogBuffer.appendLog(ReplicationLogBuffer.java:146) at org.apache.derby.impl.store.replication.master.MasterController.appendLog(MasterController.java:428) at org.apache.derby.impl.store.raw.log.LogAccessFile.writeToLog(LogAccessFile.java:787) at org.apache.derby.impl.store.raw.log.LogAccessFile.flushDirtyBuffers(LogAccessFile.java:534) at org.apache.derby.impl.store.raw.log.LogAccessFile.flushLogAccessFile(LogAccessFile.java:574) at org.apache.derby.impl.store.raw.log.LogAccessFile.writeLogRecord(LogAccessFile.java:332) at org.apache.derby.impl.store.raw.log.LogToFile.appendLogRecord(LogToFile.java:3759) at org.apache.derby.impl.store.raw.log.FileLogger.logAndDo(FileLogger.java:370) at org.apache.derby.impl.store.raw.xact.Xact.logAndDo(Xact.java:1193) at org.apache.derby.impl.store.raw.data.LoggableActions.doAction(LoggableActions.java:221) at org.apache.derby.impl.store.raw.data.LoggableActions.actionUpdate(LoggableActions.java:85) at org.apache.derby.impl.store.raw.data.StoredPage.doUpdateAtSlot(StoredPage.java:8463) at org.apache.derby.impl.store.raw.data.StoredPage.updateOverflowDetails(StoredPage.java:8336) at org.apache.derby.impl.store.raw.data.StoredPage.updateOverflowDetails(StoredPage.java:8319) at org.apache.derby.impl.store.raw.data.BasePage.insertAllowOverflow(BasePage.java:808) at org.apache.derby.impl.store.raw.data.BasePage.insert(BasePage.java:653) at org.apache.derby.impl.store.access.heap.HeapController.doInsert(HeapController.java:307) at org.apache.derby.impl.store.access.heap.HeapController.insert(HeapController.java:575) at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(RowChangerImpl.java:457) at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1011) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:487) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:384) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1652) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(EmbedPreparedStatement.java:1307) at org.apache.derby.impl.drda.DRDAStatement.execute(DRDAStatement.java:672) at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLSTTobjects(DRDAConnThread.java:4197) at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLSTT(DRDAConnThread.java:4001) at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:991) at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:278)-------------------- END REPLICATION ERROR MESSAGE ---------------------Slave derby.log:-------------------------------------------------------------------------------------------2008-06-10 14:05:56.408 GMT Thread&#91;DRDAConnThread_3 5 main&#93; (DATABASE = /export/home/tmp/os136789/testingInMyDerbySandbox/12/db_slave/wombat)  (DRDAID = {2})  Replication slave mode started successfully for database '/export/home/tmp/os136789/testingInMyDerbySandbox/12/db_slave/wombat'. Connection refused because the database is in replication slave mode. Replication slave role was stopped for database '/export/home/tmp/os136789/testingInMyDerbySandbox/12/db_slave/wombat'.------------ BEGIN SHUTDOWN ERROR STACK -------------ERROR XSLA7: Cannot redo operation null in the log. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:296) at org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1525) at org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:920) at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:334) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:427) at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:427) at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:780) at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:196) at org.apache.derby.impl.db.SlaveDatabase.bootBasicDatabase(SlaveDatabase.java:424) at org.apache.derby.impl.db.SlaveDatabase.access$000(SlaveDatabase.java:70) at org.apache.derby.impl.db.SlaveDatabase$SlaveDatabaseBootThread.run(SlaveDatabase.java:311) at java.lang.Thread.run(Thread.java:619)Caused by: ERROR 08006: Database '{0}' shutdown. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:276) at org.apache.derby.impl.store.raw.log.LogToFile.stopReplicationSlaveRole(LogToFile.java:5142) at org.apache.derby.impl.store.replication.slave.SlaveController.stopSlave(SlaveController.java:266) at org.apache.derby.impl.store.replication.slave.SlaveController.access$500(SlaveController.java:64) at org.apache.derby.impl.store.replication.slave.SlaveController$SlaveLogReceiverThread.run(SlaveController.java:531)============= begin nested exception  level (1) ===========ERROR 08006: Database '{0}' shutdown. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:276) at org.apache.derby.impl.store.raw.log.LogToFile.stopReplicationSlaveRole(LogToFile.java:5142) at org.apache.derby.impl.store.replication.slave.SlaveController.stopSlave(SlaveController.java:266) at org.apache.derby.impl.store.replication.slave.SlaveController.access$500(SlaveController.java:64) at org.apache.derby.impl.store.replication.slave.SlaveController$SlaveLogReceiverThread.run(SlaveController.java:531)============= end nested exception  level (1) ===========------------ END SHUTDOWN ERROR STACK -------------,0,0
Don't call RAFContainer.padFile() from instances of RAFContainer4,In this thread on derby-dev  http://mail-archives.apache.org/mod_mbox/db-derby-dev/200806.mbox/%3c48530848.3020501@sbcglobal.net%3e it was mentioned that RAFContainer4 calls padFile() when creating a container. Since padFile() uses old I/O calls and the rest of RAFContainer4 uses NIO  it could possibly cause similar issues as those seen in DERBY-3347. Although we haven't verified that this is a problem  we should try to avoid mixing old I/O and NIO to be on the safe side.,0,0
Improve error information reported when encountering 'ERROR XSDB3: Container information cannot change once written: was 103  now 80',Improve the text associated with ERROR XSDB3: Container information cannot change once written: was 103  now 80. It would be nice to know whichdatabase and container at least  and possibly any other info that may have changed. Maybe page/hex dumps to track down overlapping I/O errors on page 0.Here is a stack trace reported as part of DERBY-3607  as encountered by a back ground thread:2008-06-12 08:53:12.421 GMT Thread&#91;derby.rawStoreDaemon 5 derby.daemons&#93; Cleanup action starting^MERROR XSDB3: Container information cannot change once written: was 103  now 80^M at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)^M at org.apache.derby.impl.store.raw.data.AllocPage.WriteContainerInfo(Unknown Source)^M at org.apache.derby.impl.store.raw.data.FileContainer.writeHeader(Unknown Source)^M at org.apache.derby.impl.store.raw.data.RAFContainer.writeRAFHeader(Unknown Source)^M at org.apache.derby.impl.store.raw.data.RAFContainer.clean(Unknown Source)^M at org.apache.derby.impl.services.cache.ConcurrentCache.cleanAndUnkeepEntry(Unknown Source)^M at org.apache.derby.impl.services.cache.ConcurrentCache.cleanEntry(Unknown Source)^M at org.apache.derby.impl.services.cache.BackgroundCleaner.performWork(Unknown Source)^M at org.apache.derby.impl.services.daemon.BasicDaemon.serviceClient(Unknown Source)^M at org.apache.derby.impl.services.daemon.BasicDaemon.work(Unknown Source)^M at org.apache.derby.impl.services.daemon.BasicDaemon.run(Unknown Source)^M at java.lang.Thread.run(Unknown Source)^M,0,0
Fix error handling in PrivilegedFileOpsForTests,The exception handling in this utility class is unclear and can in some cases cause ClassCastException to be thrown.Note that SecurityException is a runtime exception.Potential issues to be fixed: 1) Avoid possibility of ClassCastException in 'getFileInputStream' 2) Don't include SecurityException in the signature (throws clause) 3) Document SecurityException in JavaDoc.Points 2 and 3 leads to the option of not catching SecurityException  which allows the code to be written more concisely and we can use PrivilegedAction instead of PrivilegedExceptionAction in some cases.There is also a missing character in the class name in the header  and an invalid JavaDoc tag in the class JavaDoc.,0,0
Improve calculation of refSize in ClassSize.java,java/engine/org/apache/derby/iapi/services/cache/ClassSize.java has a static code block which calculates the size of a reference for the architecture. This code could be improved by adding garbage collection before measuring memory  to give a consistent reading. Also there have been suggestions that we use os.arch or sun.arch.data.model to make the measurement more reliable  especially on 64bit machines.,0,1
SQL Length function materializes BLOB  into memory,Currently the SQL length function materializes the entire lob into memory. In SQLBinary.getLength() we have public final int getLength() throws StandardException { if (stream != null) { if (streamValueLength != -1) return streamValueLength; } return (getBytes() == null) ? 0 : getBytes().length; }Which actually is doubly bad because we call getBytes twice and materialize it twice.It would be good to read the length from the stream if available and otherwise stream the value to get the length  rather than materializing it into memory.To reproduce  run the attached repro.java -Xmx16M LengthLargeLobIt gives an out of memory exceptionCaused by: java.lang.OutOfMemoryError: Java heap space at org.apache.derby.iapi.types.SQLBinary.readFromStream(SQLBinary.java:415) at org.apache.derby.iapi.types.SQLBinary.readExternal(SQLBinary.java:318) at org.apache.derby.iapi.types.SQLBinary.getValue(SQLBinary.java:220) at org.apache.derby.iapi.types.SQLBinary.getBytes(SQLBinary.java:210) at org.apache.derby.iapi.types.SQLBinary.getLength(SQLBinary.java:250) at org.apache.derby.impl.sql.execute.BaseActivation.getDB2Length(BaseActivation.java:1684) at org.apache.derby.exe.acf81e0010x011axa317x5db8x0000003d9dc81.e1(Unknown Source) at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:141) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.doProjection(ProjectRestrictResultSet.java:497) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:291) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(BasicNoPutResultSetImpl.java:460) at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:423) ... 2 more[,0,0
Incorrect position calculation in PositionedStoreStream with read(byte[] ...),A bug in the methods 'read(byte[])' and 'read(byte[] int int)' in PositionedStoreStream can cause the position variable to be set to an incorrect value.The bug is only triggered if one of the two read methods is invoked after EOF of the underlying stream has been reached.If the bug is triggered  the position will be decreased by one because the underlying stream returns -1. Subsequent reads will further decrease the position. This can cause EOF-exceptions (during repositioning) or incorrect data being returned in subsequent calls.,0,0
Revoking a column level privilege from a user  a prepared statement relying on that privilege can still be executed,When a table level SELECT privilege is revoked  a dependent prepared statement is invalidated and can no longer be executed  but in the case of a column level privilegeSELECT privilege  the dependent prepared statement can still be executed.This works as expected in 10.2  but does not work in all 10.3 and 10.4 releases.,1,0
Add more tests for legal/illegal commands in the different replication states,Adding new replication state tests: ... testReplication_Local_3_p1_StateNegativeTests  testReplication_Local_3_p2_StateTests_bigInsert_immediateStopMaster  testReplication_Local_3_p2_StateTests_smallInsert_immediateStopMaster_DISABLED (Due to DERBY-3617) testReplication_Local_3_p2_StateTests_bigInsert_sleepBeforeStopMaster testReplication_Local_3_p2_StateTests_smallInsert_sleepBeforeStopMaster testReplication_Local_3_p3_StateNegativeTests  testReplication_Local_3_p4_StateNegativeTestsplus refactoring and cleanup.,0,0
Revoking EXECUTE privilege on a function if used in a CHECK constraint: implementation problem,The docs say that REVOKE EXECUTE ... RESTRICT should fail if there is a dependent constraint:'The RESTRICT clause specifies that the EXECUTE privilege cannot be revoked if the specified routine is used in a view  trigger  or constraint  and the privilege is being revoked from the owner of the view  trigger  or constraint.' Revoking the privilege will be correctly restricted  but possibly for the wrong reason.,1,0
Derby can leak classloaders in an app server environment,A user reported potential class loader leaks in Derby...The first one looks like Derby created a long-runningthread and copying the context class loader. To fix  thecontext class loader should be saved/set/restored around thecreation of the new thread so that it copies some benign classloader instead (e.g.  null or getClass().getClassLoader()): 0x42278e58 java/lang/Thread@302e302e &#91;truncating at running thread LEAK&#93;Object: 0x42278e58 java/lang/Thread@302e302eChildren: 0x42278ee0 java/lang/String@303f303f 0x4226e558 java/lang/ThreadGroup@6f2e6f2e 0x42278e40org/apache/derby/impl/services/monitor/AntiGC@603a603a 0x419cfac0The second is another long running thread. The same applies: 0x426fe7a0 java/lang/Thread@19901990 &#91;truncating at running thread LEAK&#93;Object: 0x426fe7a0 java/lang/Thread@19901990Parents: 0x4226e5a8 [Ljava/lang/Thread;@6f386f38 0x426fe548org/apache/derby/iapi/services/context/ContextManager@19421942Children: 0x426fe838 java/lang/String@19a319a3 0x4226e558 java/lang/ThreadGroup@6f2e6f2e 0x426fe4f8org/apache/derby/impl/services/daemon/BasicDaemon@19381938 0x419cfac0The third is a TimerThread owneed   which is created when aTimer is created. The same applies: 0x425ac538 java/util/Timer$TimerImpl@6b8a6b8a &#91;truncating at running thread LEAK&#93;Object: 0x425ac538 java/util/Timer$TimerImpl@6b8a6b8aParents: 0x41faaf58 [Ljava/lang/Thread;@3c583c58Object: 0x425ac510 java/util/Timer@6b856b85Parents: 0x425ac500org/apache/derby/impl/services/timer/SingletonTimerFactory@56e256e2For more info  see thread at:http://www.nabble.com/ClassLoader-leaks--td18121374.html,1,0
Rename BaseJDBCTestCase.usingDerbyNet,The names of the methods 'usingDerbyNet' and 'usingDerbyNetClient' in BaseJDBCTestCase are confusing.I propose we change the one used to tell if we are using the DB2 client driver (JCC).,0,0
Create a utility class for skipping data in an InputStream,The contract of InputStream.skip is somewhat difficult  some would even say broken.See http://java.sun.com/javase/6/docs/api/java/io/InputStream.html#skip(long))A utility class should be created to ensure that we use the same skip procedure throughout the Derby code base.Suggested functionality: long skipFully(InputStream) : skips until EOF  returns number of bytes skipped void skipFully(InputStream long) : skips requested number of bytes  throws EOFException if there is too few bytes in the streamI know of two different approaches  both skipping in a loop: a) Verify EOF with a read call when skip returns zero. b) Throw EOFException if skip returns zero before requested number of bytes have been skipped.There's related code in iapi.util.UTF8Util. Maybe this class  say StreamUtil  could be put in the same package?,0,0
ImportExportLobTest failed on Zos  Clobs differ at index 1 expected: but was:,testImportDataExportQueryLobsInExtFile(org.apache.derbyTesting.functionTests.tests.tools.ImportExportLobTest)junit.framework.AssertionFailedError: Clobs differ at index 1 expected:&lt;99&gt; but was:&lt;196&gt; at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertEquals(BaseJDBCTestCase.java:693) at org.apache.derbyTesting.junit.JDBC.assertSameContents(JDBC.java:1139) at org.apache.derbyTesting.functionTests.tests.tools.ImportExportLobTest.verifyData(ImportExportLobTest.java:534) at org.apache.derbyTesting.functionTests.tests.tools.ImportExportLobTest.testImportDataExportQueryLobsInExtFile(ImportExportLobTest.java:341) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:59) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:39) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:101) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)I ran on Windows with -Dfile.encoding='UTF-16' and got a different error.1) testImportDataExportQueryLobsInExtFile(org.apache.derbyTesting.functionTests.tests.tools.ImportExportLobTest)java.sql.SQLException: The exception 'java.sql.SQLException: Column 'COLUMN4' is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE statement then 'COLUMN4' is not a column in the target table.' was thrown while evaluating an expression. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:87) at org.apache.derby.impl.jdbc.Util.seeNextException(Util.java:223) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:398) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2183) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1325) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1652) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(EmbedPreparedStatement.java:1307) at org.apache.derbyTesting.functionTests.tests.tools.ImportExportBaseTest.doImportDataLobsFromExtFile(ImportExportBaseTest.java:258) at org.apache.derbyTesting.functionTests.tests.tools.ImportExportLobTest.testImportDataExportQueryLobsInExtFile(ImportExportLobTest.java:339) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:104) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)Caused by: java.sql.SQLException: The exception 'java.sql.SQLException: Column 'COLUMN4' is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE statement then 'COLUMN4' is not a column in the target table.' was thrown while evaluating an expression. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70) ... 36 moreCaused by: java.sql.SQLException: Column 'COLUMN4' is either not in any table in the FROM list or appears within a joinspecification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE statement then 'COLUMN4' is not a column in the target table. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:201) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:391) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2183) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(EmbedPreparedStatement.java:146) at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&lt;init&gt;(EmbedPreparedStatement20.java:82) at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&lt;init&gt;(EmbedPreparedStatement30.java:63) at org.apache.derby.impl.jdbc.EmbedPreparedStatement40.&lt;init&gt;(EmbedPreparedStatement40.java:40) at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Driver40.java:105) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1533) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1361) at org.apache.derby.impl.load.Import.performImport(Import.java:274) at org.apache.derby.impl.load.Import.importData(Import.java:166) at org.apache.derby.catalog.SystemProcedures.SYSCS_IMPORT_DATA_LOBS_FROM_EXTFILE(SystemProcedures.java:1538) at org.apache.derby.exe.acaa7ac093x011bx0970x9cd2x00003dcd3cb42.g0(Unknown Source) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(ReflectMethod.java:46) at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(CallStatementResultSet.java:76) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:384) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235) ... 29 moreCaused by: ERROR 42X04: Column 'COLUMN4' is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE statement then 'COLUMN4' is not a column in the target table. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286) at org.apache.derby.impl.sql.compile.ColumnReference.bindExpression(ColumnReference.java:354) at org.apache.derby.impl.sql.compile.ResultColumn.bindExpression(ResultColumn.java:588) at org.apache.derby.impl.sql.compile.ResultColumnList.bindExpressions(ResultColumnList.java:693) at org.apache.derby.impl.sql.compile.SelectNode.bindExpressions(SelectNode.java:443) at org.apache.derby.impl.sql.compile.SelectNode.bindExpressionsWithTables(SelectNode.java:578) at org.apache.derby.impl.sql.compile.DMLStatementNode.bindExpressionsWithTables(DMLStatementNode.java:251) at org.apache.derby.impl.sql.compile.DMLStatementNode.bindResultSetsWithTables(DMLStatementNode.java:175) at org.apache.derby.impl.sql.compile.InsertNode.bindStatement(InsertNode.java:242) at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:314) at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:88) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:794) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(EmbedPreparedStatement.java:128) ... 47 more2) testImportDataExportQueryLobsInExtFile(org.apache.derbyTesting.functionTests.tests.tools.ImportExportLobTest)java.sql.SQLException: The exception 'java.sql.SQLException: Column 'COLUMN4' is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE statement then 'COLUMN4' is not a column in the target table.' was thrown while evaluating an expression. at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:96) at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:362) at org.apache.derby.client.am.PreparedStatement.execute(PreparedStatement.java:1588) at org.apache.derbyTesting.functionTests.tests.tools.ImportExportBaseTest.doImportDataLobsFromExtFile(ImportExportBaseTest.java:258) at org.apache.derbyTesting.functionTests.tests.tools.ImportExportLobTest.testImportDataExportQueryLobsInExtFile(ImportExportLobTest.java:339) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:104) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)Caused by: org.apache.derby.client.am.SqlException: The exception 'java.sql.SQLException: Column 'COLUMN4' is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE statement then 'COLUMN4' is not a column in the target table.' was thrown while evaluating an expression. at org.apache.derby.client.am.Statement.completeExecute(Statement.java:1601) at org.apache.derby.client.net.NetStatementReply.parseEXCSQLSTTreply(NetStatementReply.java:322) at org.apache.derby.client.net.NetStatementReply.readExecuteCall(NetStatementReply.java:106) at org.apache.derby.client.net.StatementReply.readExecuteCall(StatementReply.java:75) at org.apache.derby.client.net.NetStatement.readExecuteCall_(NetStatement.java:179) at org.apache.derby.client.am.Statement.readExecuteCall(Statement.java:1567) at org.apache.derby.client.am.PreparedStatement.flowExecute(PreparedStatement.java:2151) at org.apache.derby.client.am.PreparedStatement.executeX(PreparedStatement.java:1594) at org.apache.derby.client.am.PreparedStatement.execute(PreparedStatement.java:1579) ... 38 moreCaused by: org.apache.derby.client.am.SqlException: Column 'COLUMN4' is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and isnot in the GROUP BY list. If this is a CREATE or ALTER TABLE statement then 'COLUMN4' is not a column in the target table. ... 47 more,0,0
jdbc4/ClobTest fails on Zos with AssertionFailedError: Streams differ at index 0 expected: but was:,testGetAsciiStreamCreateClob(org.apache.derbyTesting.functionTests.tests.jdbc4.ClobTest)junit.framework.AssertionFailedError: Streams differ at index 0 expected:&lt;200&gt; but was:&lt;72&gt; at org.apache.derbyTesting.junit.BaseTestCase.assertEquals(BaseTestCase.java:341) at org.apache.derbyTesting.functionTests.tests.jdbc4.ClobTest.testGetAsciiStreamCreateClob(ClobTest.java:575) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:59) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:39) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:101) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)I was able to reproduce this on Windows with slightly different errors running with -Dfile.encoding='UTF-16'There were 2 errors:) testGetCharacterStreamClobUpdates(org.apache.derbyTesting.functionTests.tests.jdbc4.ClobTest)java.sql.SQLException: Te position argument '53' exceeds the size of the BLOB/CLOB. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:87) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:93) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:172) at org.apache.derby.impl.jdbc.EmbedClob.setString(EmbedClob.java:559) at org.apache.derby.impl.jdbc.EmbedClob.setString(EmbedClob.java:525) at org.apache.derbyTesting.functionTests.tests.jdbc4.ClobTest.testGetCharacterStreamClobUpdates(ClobTest.java:69) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:104) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)aused by: java.sql.SQLException: The position argument '53' exceeds the size of the BLOB/CLOB. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:11) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70) ... 34 more) testGetCharacterStreamClobUpdates(org.apache.derbyTesting.functionTests.tests.jdbc4.ClobTest)java.sql.SQLException: Te position argument '53' exceeds the size of the BLOB/CLOB. at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:96) at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:362) at org.apache.derby.client.am.Clob.setString(Clob.java:588) at org.apache.derbyTesting.functionTests.tests.jdbc4.ClobTest.testGetCharacterStreamClobUpdates(ClobTest.java:69) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:104) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)aused by: org.apache.derby.client.am.SqlException: The position argument '53' exceeds the size of the BLOB/CLOB. at org.apache.derby.client.am.Clob.setStringX(Clob.java:624) at org.apache.derby.client.am.Clob.setString(Clob.java:579) ... 38 morehere were 2 failures:) testGetAsciiStreamCreateClob(org.apache.derbyTesting.functionTests.tests.jdbc4.ClobTest)junit.framework.AssertionFaildError: Streams differ at index 0 expected:&lt;254&gt; but was:&lt;72&gt; at org.apache.derbyTesting.junit.BaseTestCase.assertEquals(BaseTestCase.java:343) at org.apache.derbyTesting.functionTests.tests.jdbc4.ClobTest.testGetAsciiStreamCreateClob(ClobTest.java:575) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:104) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)) testGetAsciiStreamCreateClob(org.apache.derbyTesting.functionTests.tests.jdbc4.ClobTest)junit.framework.AssertionFaildError: Streams differ at index 0 expected:&lt;254&gt; but was:&lt;72&gt; at org.apache.derbyTesting.junit.BaseTestCase.assertEquals(BaseTestCase.java:343) at org.apache.derbyTesting.functionTests.tests.jdbc4.ClobTest.testGetAsciiStreamCreateClob(ClobTest.java:575) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:104) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)FAILURES!!!Tests run: 22  Failures: 2  Errors: 2,0,0
SecureServerTest  SSLTest are failed on Zos with exit code 143 starting network server,,1,0
PositionedStoreStream.reposition(pos) with pos greater than length leaves the stream object in an inconsistent state,PositionedStoreStream.reposition(pos) with pos greater than the stream length leaves the stream object in an inconsistent state  causing subsequent calls to fail or the state to remain inconsistent (which can cause the wrong data to be returned).The problem is that the position variable gets out of sync with the underlying stream.There are at least two ways to fix this (assuming the positioned store stream does not know the length of the underlying stream): a) Reset stream to position zero. b) Let the stream be positioned at EOF and update the internal position variable.Option b) leaves the stream in an unusable state  and the next request will cause option a) to be performed. It also require a slight rewrite of 'PositionedStoreStream.skipFully' and 'PositionedStoreStream.reposition' to be able to determine the position of the stream (the length in this case).Option a) will cause the first page of the stream to be read into the cache (if not already there)  but taken the reason for doing this is an error condition it seems acceptable.A correct value of the position variable is required for correct/valid operation of PositionedStoreStream.,0,0
Client Configuration.java imports engine class  org.apache.derby.iapi.services.info.JVMInfo,The client code (org.apache.derby.client.am.Configuration) imports the engine class org.apache.derby.iapi.services.info.JVMInfo.This will make two copies of the class in derby.jar and derbyclient.jar which can cause problems if mixed version jars are used and I think may cause jar sealing issues as well.Until we have a good framework for sharing code between engine and client  the client shouldn't import engine classes.,0,0
LOBStreamControl shouldn't throw SQLException,LOBStreamControl throws three types of exceptions: IOException  SQLException and StandardException.All the SQLException are generated/thrown from the code in LOBStreamControl.At this level of the code  SQLException should not be thrown  as it is more tedious to handle both SQLException and StandardException at higher levels.I propose to replace SQLException with StandardException in LOBStreamControl. The purpose of this change is consistency  and also results it slightly less code at higher levels.,0,0
ImportExportTest doesn't detect lack of expected errors,I observed that ImportExportTest contains many test cases which do try/catch/assertSQLException  but none of them call fail() at the end of the try block. Example: public void testEarlyEndOfFile() throws Exception { Connection c = getConnection(); try { doImportFromFile(c  'extin/EndOfFile.txt'   'T4'   null   null   null  0); } catch (SQLException e) { assertSQLState('XIE0E'  e); } }I think this means that if the expected exception isn't thrown the test still passes.,0,0
NullPointerException when accessing a clob through a pooled connection,After returning a pooled connection to the pool and getting it again a NullPointerException is thrown when a clob field is accessed again. This may be related to the following post: http://mail-archives.apache.org/mod_mbox/db-derby-user/200803.mbox/%3C47CD3431.5020205@sun.com%3EHere is the stack trace:java.lang.NullPointerException at org.apache.derby.client.am.PreparedStatement.setIntX(Unknown Source) at org.apache.derby.client.am.CallableLocatorProcedures.clobGetLength(Unknown Source) at org.apache.derby.client.am.Clob.getLocatorLength(Unknown Source) at org.apache.derby.client.am.Lob.sqlLength(Unknown Source) at org.apache.derby.client.am.Clob.length(Unknown Source) at org.apache.derby.client.am.Cursor.getString(Unknown Source) at org.apache.derby.client.am.ResultSet.getString(Unknown Source) at derbyerr.Main.main(Main.java:65)Here is the code to reproduce the problem:package derbyerr;import java.sql.Connection;import java.sql.PreparedStatement;import java.sql.ResultSet;import java.sql.SQLException;import javax.sql.PooledConnection;import org.apache.derby.jdbc.ClientConnectionPoolDataSource;public class Main { public static void main (String[] args) { org.apache.derby.tools.sysinfo.main (args) ; ClientConnectionPoolDataSource creator = new ClientConnectionPoolDataSource () ; // There should be an empty db named testdb creator.setDatabaseName ('testdb') ; try { PooledConnection pc = creator.getPooledConnection () ; Connection c = pc.getConnection () ; PreparedStatement ps ; ResultSet rs ; String s ; // Drop the table 'test'  if it exsists try { ps = c.prepareStatement ('drop table test') ; ps.execute () ; ps.close () ; } catch (Exception e) { } // Create a test table with a clob field ps = c.prepareStatement ('create table test (pkey varchar(255) not null primary key  value clob)') ; ps.execute () ; ps.close () ; // Insert a record ps = c.prepareStatement ('insert into test values ('123'  'abc')') ; ps.execute () ; ps.close () ; // Query the record and... ps = c.prepareStatement ('select * from test') ; rs = ps.executeQuery () ; rs.next () ; // ...access the clob field - this works s = rs.getString (2) ; assert s.equals ('abc') ; rs.close () ; ps.close () ; // Simulate connection pooling: close the connection and get it again c.close () ; c = pc.getConnection () ; // Now again query the record... ps = c.prepareStatement ('select * from test') ; rs = ps.executeQuery () ; rs.next () ; // ...and access the clob - this fails s = rs.getString (2) ; assert s.equals ('abc') ; rs.close () ; ps.close () ; } catch (Exception e) { e.printStackTrace () ; } }},0,0
Add a SHOW FUNCTIONS command to ij,Currently  the ij SHOW command can give you information on a number of schema objects  including procedures. It should be fairly easy to add SHOW FUNCTIONS as well. This request surfaced on the user list: http://www.nabble.com/How-can-i-see-my-self-defined-functions--td18773980.html#a18773980,0,0
NullPointerException in stress.multi test,I saw the following NPE in stress.multi running on 10.3 with derbyclient.java.lang.NullPointerException at org.apache.derby.impl.jdbc.EmbedPreparedStatement.getMetaData(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.writeSQLDARD(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)Cleanup action completed,0,1
StoreStreamClob.getReader(charPos) performs poorly,StoreStreamClob.getReader(charPos) performs poorly because it resets the underlying stream and skips data until it reached the requested character position. Not only does the data has to be skipped  it also has to be decoded (UTF-8).The problem is exposed through EmbedClob.getSubString  which causes extremely bad performance for the client driver because the locator based Clob implementation uses this method.For the record  there is another read buffer size issue that exaggerates the problem (it will probably be handled under DERBY-3769  and also DERBY-3818).,0,1
Convert derbynet/sysinfo and derbynet/sysinfo_with_properties to JUnit,I'm guessing these two can be combined into one file,0,0
need to test getting appropriate error message when os files are read-only,We don't currently have a way to test what happens when a database is on read-only media (e.g. a cd  floppy).Without user involvement (i.e. inserting a disk somewhere etc) it's hard to fully test  but a test that simulates this by making the files on the OS read-only would give some coverage.,0,0
The test code executes java processes by just executing java instead of using a full path. This may cause the wrong java to be picked up.,There are places in the code where we execute a java process. e.g. BaseTestCase.assertExecJavaCmdAsExpected where we execcute a java process and just call 'java'. In windows at least the new shell created for the exec'ed process does not share the parent process path but rather picks up the path from the Windows System variables. This can cause the wrong java to be picked up. Also the method does not work for j9 because it calls 'java' instead of the actual executable name. Perhaps we should have a method: public static final String getJavaExecutableName() { String vmname = getSystemProperty('com.ibm.oti.vm.exe'); if (vmname == null) vmname = getSystemProperty('java.home') + File.pathSeparator + 'java'; return vmname; }There are also issues with this in NetworkServerControlApiTest. NetworkServerTestSetup and the replication tests and maybe others as well.,0,0
Behaviour of setTypeMap() differs between embedded and client,On the embedded driver  Connection.setTypeMap() behaves like this (when the connection is not closed): if the map argument is null  throw an SQLException with SQLState XJ081 if the map is not null and not empty  throw an SQLException with SQLState 0A000 if the map is not null and empty  do nothingThe behaviour on the client driver is this: always throw an SQLException with SQLState 0A000We should try to make the two drivers behave the same way when setTypeMap() is called. (This would also allow us to simplify some of the tests in J2EEDataSourceTest).,0,0
difference between Embedded vs DerbyNetClient in format of return from timestamp(cast(? as varchar(32))),There is a slight difference in how Embedded vs. DerbyNetClient return a specific cast.This showed up during conversion of the test lang/datetime.sql which before was only run with Embedded...The following sql: prepare dateTimePS as 'values( date(cast(? as integer)) timestamp(cast(? as varchar(32))))';execute dateTimePS using 'values(cast(1 as integer)  ''2003-03-05-17.05.43.111111'')';gives: 1 |2  -------------------------------------Embedded: 1970-01-01|2003-03-05-17.05.43.111111DerbyNetClient: 1970-01-01|2003-03-05 17:05:43.111111(in Embedded there's a '-' between date and time part  with DerbyNetClient a space; with Embedded the separator between time elements is .  with DerbyNetClient :. Embedded reflects the data as passed in  with DerbyNetClient it seems to be the default timestamp format).I am not sure which is correct at this point  but I confirmed the behavior is like this in latest builds of trunk and 10.3 and 10.4 branches.,0,0
tools/ide is not included in the source tarball,The tools/ide directory is not part of the source tarball (checked the 10.4.1.3 release and the 10.4.2.0 release candidate). It should be included to make it easier for people to open the source code in an IDE.,0,0
NPE in testSemantics(.....lang.RolesTest) on JavaME / CVM,See http://dbtg.thresher.com/derby/test/Daily/javaME/testing/testlog/ubuntu/691643-suitesAll_diff.txt1) testSemantics(org.apache.derbyTesting.functionTests.tests.lang.RolesTest)junit.framework.AssertionFailedError: java.lang.NullPointerException:  at org.apache.derbyTesting.junit.JDBCDataSource.getDataSourceObject(Ljava/lang/String;Ljava/util/HashMap;)Ljava/lang/Object;(JDBCDataSource.java:176) at org.apache.derbyTesting.junit.J2EEDataSource.getConnectionPoolDataSource(Lorg/apache/derbyTesting/junit/TestConfiguration;Ljava/util/HashMap;)Ljavax/sql/ConnectionPoolDataSource;(J2EEDataSource.java:58) at org.apache.derbyTesting.junit.J2EEDataSource.getConnectionPoolDataSource()Ljavax/sql/ConnectionPoolDataSource;(J2EEDataSource.java:42) at org.apache.derbyTesting.functionTests.tests.lang.RolesTest.testCurrentRoleIsReset()V(RolesTest.java:711) at org.apache.derbyTesting.functionTests.tests.lang.RolesTest.testSemantics()V(RolesTest.java:647) at org.apache.derbyTesting.junit.BaseTestCase.runBare()V(BaseTestCase.java:104) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(Ljunit/framework/TestResult;)V(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(Ljunit/framework/TestResult;)V(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(Ljunit/framework/TestResult;)V(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at sun.misc.CVM.runMain()V(CVM.java:514),0,0
intermittent hang pinging  server on Linux,am looking at a intermittent hang with IBM 1.6 on Linux with the ping command. I am not entirely sure it is a jvm issue  but I have not been able to reproduce the hang with other jvms. The trace is3XMTHREADINFO 'main' TID:0x08072500  j9thread_t:0x08057AF4  state:R  prio=53XMTHREADINFO1 (native thread ID:0x1E05  native priority:0x5  native policy:UNKNOWN)4XESTACKTRACE at java/net/SocketInputStream.socketRead0(Native Method)4XESTACKTRACE at java/net/SocketInputStream.read(SocketInputStream.java:140)4XESTACKTRACE at java/net/SocketInputStream.read(SocketInputStream.java:101)4XESTACKTRACE at org/apache/derby/impl/drda/NetworkServerControlImpl.fillReplyBuffer(NetworkServerControlImpl.java:2764)4XESTACKTRACE at org/apache/derby/impl/drda/NetworkServerControlImpl.readResult(NetworkServerControlImpl.java:2708)4XESTACKTRACE at org/apache/derby/impl/drda/NetworkServerControlImpl.pingWithNoOpen(NetworkServerControlImpl.java:1169)4XESTACKTRACE at org/apache/derby/impl/drda/NetworkServerControlImpl.ping(NetworkServerControlImpl.java:1144(Compiled Code))4XESTACKTRACE at org/apache/derby/drda/NetworkServerControl.ping(NetworkServerControl.java:395(Compiled Code))4XESTACKTRACE at Repro.pingForServerUp(Repro.java:38(Compiled Code))4XESTACKTRACE at Repro.startAndShutdown(Repro.java:20)The client has sent the ping  but there is no corresponding session on the server side to process thecommand. The full thread dump is in.javacore.20080903.183815.7684.0001.txtThe program Repro.java shows the problem. It repeatedly starts the server  pings until it comes up  and then shuts down.In the derby.log I see a startup error  that the address is already in use  so presumably the shutdown is not complete before we start the server and then perhaps it shuts down mid ping causing the hang?2008-09-04 01:37:51.048 GMT : Could not listen on port 1527 on host 127.0.0.1: java.net.BindException: Address already in useAn exception was thrown during network server startup. DRDA_ListenPort.S:Could not listen on port 1527 on host 127.0.0.1: java.net.BindException: Address already in usejava.lang.reflect.InvocationTargetException at sun.reflect.GeneratedMethodAccessor3.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37) at java.lang.reflect.Method.invoke(Method.java:599) at org.apache.derby.iapi.jdbc.DRDAServerStarter.run(DRDAServerStarter.java:236) at java.lang.Thread.run(Thread.java:735)Caused by: java.lang.Exception: DRDA_ListenPort.S:Could not listen on port 1527 on host 127.0.0.1: java.net.BindException: Address already in use at java.lang.Throwable.&lt;init&gt;(Throwable.java:67) at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessageWork(NetworkServerControlImpl.java:3179) at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessage(NetworkServerControlImpl.java:1861) at org.apache.derby.impl.drda.NetworkServerControlImpl.blockingStart(NetworkServerControlImpl.java:731) ... 5 moreFull log is attached as derby.log,0,1
Concurrent Inserts of rows with XML data results in an exception,We insert rows into a table using the following prepared statement (through JDBC):INSERT INTO USER1.PSTORE values(? ?  XMLPARSE(document CAST (? AS CLOB) preserve whitespace))where each of the ?'s are replaced with a string.One thread runs fine. Two or more result in the following exception: org.apache.derby.client.am.SqlException: Java exception: 'FWK005 parse may not be called while parsing.: org.xml.sax.SAXException'. at org.apache.derby.client.am.SqlException.&lt;init&gt;(Unknown Source) at org.apache.derby.client.am.SqlException.&lt;init&gt;(Unknown Source)We believe that this comes from the dBuilder.parse(InputSource) method.,0,0
Replication: stopSlave does not close serversocket when master has crashed.,The stopSlave command (connection URL attribute) fails to close the ServerSocket when called after master database has crashed. Because of this  the same Derby instance cannot later start a slave on the same port. The problem is in ReplicationMessageReceive#tearDown and SocketConnection#tearDown:SC#tearDown:When objOutputStream is closed  the stream's flush method is called. Flush throws an exception  and socket.close is not called.RMR#tearDown:When socketCon.teardown throws an exception  serverSocket.close is not called.Suggested fix: add try/catch/finally blocks so that vital code (socket.close and serverSocket.close) is always called.Note that the stop slave command can also come from the master (if stopMaster connection URL is called)  in which case this bug will not materialize.,0,1
LOBStreamControl.replaceBytes() leaves temporary files open,I haven't seen any problems as a result of this  but the code that closes and deletes the old temporary file in LOBStreamControl.replaceBytes() looks wrong to me.When replaceBytes() is called on a lob that has been materialized into a temporary file  it will create a new file and copy the relevant parts from the old file. But the old file is only closed and deleted if the block that is replaced ends before the last byte of the lob. I believe that the old file should be closed and deleted also when we replace a block that ends at or after the last byte of the original lob.,0,1
Embedded Derby fails under JBoss because of JMX-related conflicts,I'm trying to use embedded Derby as datasource for JBoss and found that it fails with error.See stacktrace below.It looks like JMX module in Derby conflicts with JBoss JMX.After I have disabled Derby JMX removing 'derby.module.mgmt.jmx=org.apache.derby.impl.services.jmx.JMXManagementService' line from org/apache/derby/modules.properties file in derby.jar JAR  the bug disappears.How to reproduce the issue:1). Install JBoss2). Copy jboss/docs/examples/varia/derby-plugin.jar into jboss/server/default/lib3). Copy Derby JAR (derby.jar) into jboss/server/default/lib4). Copy datasource file into jboss/server/default/lib5). Start JBoss using bin/run.batDatasource file (zzzzz-ds.xml):==={{{&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;!DOCTYPE datasources PUBLIC '-//JBoss//DTD JBOSS JCA Config 1.5//EN' 'http://www.jboss.org/j2ee/dtd/jboss-ds_1_5.dtd'&gt;&lt;datasources&gt; &lt;local-tx-datasource&gt; &lt;jndi-name&gt;zzzzzDatasource&lt;/jndi-name&gt; &lt;driver-class&gt;org.apache.derby.jdbc.EmbeddedDriver&lt;/driver-class&gt; &lt;!--connection-url&gt;jdbc:derby:${jboss.server.data.dir}{/}derby{/}zzzzz;create=true&lt;/connection-url--&gt; &lt;connection-url&gt;jdbc:derby:IGNORED&lt;/connection-url&gt; &lt;user-name&gt;IGNORED&lt;/user-name&gt; &lt;password&gt;IGNORED&lt;/password&gt; &lt;min-pool-size&gt;5&lt;/min-pool-size&gt; &lt;max-pool-size&gt;20&lt;/max-pool-size&gt; &lt;idle-timeout-minutes&gt;5&lt;/idle-timeout-minutes&gt; &lt;track-statements/&gt; &lt;depends&gt;jboss:service=zzzzzDerbyDB&lt;/depends&gt; &lt;/local-tx-datasource&gt; &lt;!-- Don't forget to install derby-plugin.jar and derby*.jar into jboss/server/default/lib --&gt; &lt;mbean code='org.jboss.jdbc.DerbyDatabase' name='jboss:service=zzzzzDerbyDB'&gt; &lt;attribute name='Database'&gt;zzzzz&lt;/attribute&gt; &lt;attribute name='User'&gt;sa&lt;/attribute&gt; &lt;attribute name='Password'&gt;&lt;/attribute&gt; &lt;/mbean&gt;&lt;/datasources&gt;===}}}Part of JBoss log with error and stacktrace:==={{{02:40:28 031 INFO &#91;DerbyDatabase&#93; starting derby jdbc:derby:C:/opt/jboss-4.2.3.GA/server/default/data/derby/zzzzz;create=true02:40:28 468 WARN &#91;ServiceController&#93; Problem starting service jboss:service=zzzzzDerbyDBjava.lang.ExceptionInInitializerError at java.lang.Class.forName0(Native Method) at java.lang.Class.forName(Class.java:247) at org.jboss.jdbc.DerbyDatabase.getConnection(DerbyDatabase.java:222) at org.jboss.jdbc.DerbyDatabase.startService(DerbyDatabase.java:189) at org.jboss.system.ServiceMBeanSupport.jbossInternalStart(ServiceMBeanSupport.java:289) at org.jboss.system.ServiceMBeanSupport.jbossInternalLifecycle(ServiceMBeanSupport.java:245) at sun.reflect.GeneratedMethodAccessor3.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.jboss.mx.interceptor.ReflectedDispatcher.invoke(ReflectedDispatcher.java:155) at org.jboss.mx.server.Invocation.dispatch(Invocation.java:94) at org.jboss.mx.server.Invocation.invoke(Invocation.java:86) at org.jboss.mx.server.AbstractMBeanInvoker.invoke(AbstractMBeanInvoker.java:264) at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:659) at org.jboss.system.ServiceController$ServiceProxy.invoke(ServiceController.java:978) at $Proxy0.start(Unknown Source) at org.jboss.system.ServiceController.start(ServiceController.java:417) at sun.reflect.GeneratedMethodAccessor9.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.jboss.mx.interceptor.ReflectedDispatcher.invoke(ReflectedDispatcher.java:155) at org.jboss.mx.server.Invocation.dispatch(Invocation.java:94) at org.jboss.mx.server.Invocation.invoke(Invocation.java:86) at org.jboss.mx.server.AbstractMBeanInvoker.invoke(AbstractMBeanInvoker.java:264) at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:659) at org.jboss.mx.util.MBeanProxyExt.invoke(MBeanProxyExt.java:210) at $Proxy4.start(Unknown Source) at org.jboss.deployment.SARDeployer.start(SARDeployer.java:304) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.jboss.mx.interceptor.ReflectedDispatcher.invoke(ReflectedDispatcher.java:155) at org.jboss.mx.server.Invocation.dispatch(Invocation.java:94) at org.jboss.mx.interceptor.AbstractInterceptor.invoke(AbstractInterceptor.java:133) at org.jboss.mx.server.Invocation.invoke(Invocation.java:88) at org.jboss.mx.interceptor.ModelMBeanOperationInterceptor.invoke(ModelMBeanOperationInterceptor.java:142) at org.jboss.mx.server.Invocation.invoke(Invocation.java:88) at org.jboss.mx.server.AbstractMBeanInvoker.invoke(AbstractMBeanInvoker.java:264) at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:659) at org.jboss.mx.util.MBeanProxyExt.invoke(MBeanProxyExt.java:210) at $Proxy42.start(Unknown Source) at org.jboss.deployment.XSLSubDeployer.start(XSLSubDeployer.java:197) at org.jboss.deployment.MainDeployer.start(MainDeployer.java:1025) at org.jboss.deployment.MainDeployer.deploy(MainDeployer.java:819) at org.jboss.deployment.MainDeployer.deploy(MainDeployer.java:782) at sun.reflect.GeneratedMethodAccessor21.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.jboss.mx.interceptor.ReflectedDispatcher.invoke(ReflectedDispatcher.java:155) at org.jboss.mx.server.Invocation.dispatch(Invocation.java:94) at org.jboss.mx.interceptor.AbstractInterceptor.invoke(AbstractInterceptor.java:133) at org.jboss.mx.server.Invocation.invoke(Invocation.java:88) at org.jboss.mx.interceptor.ModelMBeanOperationInterceptor.invoke(ModelMBeanOperationInterceptor.java:142) at org.jboss.mx.server.Invocation.invoke(Invocation.java:88) at org.jboss.mx.server.AbstractMBeanInvoker.invoke(AbstractMBeanInvoker.java:264) at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:659) at org.jboss.mx.util.MBeanProxyExt.invoke(MBeanProxyExt.java:210) at $Proxy9.deploy(Unknown Source) at org.jboss.deployment.scanner.URLDeploymentScanner.deploy(URLDeploymentScanner.java:421) at org.jboss.deployment.scanner.URLDeploymentScanner.scan(URLDeploymentScanner.java:634) at org.jboss.deployment.scanner.AbstractDeploymentScanner$ScannerThread.doScan(AbstractDeploymentScanner.java:263) at org.jboss.deployment.scanner.AbstractDeploymentScanner.startService(AbstractDeploymentScanner.java:336) at org.jboss.system.ServiceMBeanSupport.jbossInternalStart(ServiceMBeanSupport.java:289) at org.jboss.system.ServiceMBeanSupport.jbossInternalLifecycle(ServiceMBeanSupport.java:245) at sun.reflect.GeneratedMethodAccessor3.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.jboss.mx.interceptor.ReflectedDispatcher.invoke(ReflectedDispatcher.java:155) at org.jboss.mx.server.Invocation.dispatch(Invocation.java:94) at org.jboss.mx.server.Invocation.invoke(Invocation.java:86) at org.jboss.mx.server.AbstractMBeanInvoker.invoke(AbstractMBeanInvoker.java:264) at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:659) at org.jboss.system.ServiceController$ServiceProxy.invoke(ServiceController.java:978) at $Proxy0.start(Unknown Source) at org.jboss.system.ServiceController.start(ServiceController.java:417) at sun.reflect.GeneratedMethodAccessor9.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.jboss.mx.interceptor.ReflectedDispatcher.invoke(ReflectedDispatcher.java:155) at org.jboss.mx.server.Invocation.dispatch(Invocation.java:94) at org.jboss.mx.server.Invocation.invoke(Invocation.java:86) at org.jboss.mx.server.AbstractMBeanInvoker.invoke(AbstractMBeanInvoker.java:264) at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:659) at org.jboss.mx.util.MBeanProxyExt.invoke(MBeanProxyExt.java:210) at $Proxy4.start(Unknown Source) at org.jboss.deployment.SARDeployer.start(SARDeployer.java:304) at org.jboss.deployment.MainDeployer.start(MainDeployer.java:1025) at org.jboss.deployment.MainDeployer.deploy(MainDeployer.java:819) at org.jboss.deployment.MainDeployer.deploy(MainDeployer.java:782) at org.jboss.deployment.MainDeployer.deploy(MainDeployer.java:766) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.jboss.mx.interceptor.ReflectedDispatcher.invoke(ReflectedDispatcher.java:155) at org.jboss.mx.server.Invocation.dispatch(Invocation.java:94) at org.jboss.mx.interceptor.AbstractInterceptor.invoke(AbstractInterceptor.java:133) at org.jboss.mx.server.Invocation.invoke(Invocation.java:88) at org.jboss.mx.interceptor.ModelMBeanOperationInterceptor.invoke(ModelMBeanOperationInterceptor.java:142) at org.jboss.mx.server.Invocation.invoke(Invocation.java:88) at org.jboss.mx.server.AbstractMBeanInvoker.invoke(AbstractMBeanInvoker.java:264) at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:659) at org.jboss.mx.util.MBeanProxyExt.invoke(MBeanProxyExt.java:210) at $Proxy5.deploy(Unknown Source) at org.jboss.system.server.ServerImpl.doStart(ServerImpl.java:482) at org.jboss.system.server.ServerImpl.start(ServerImpl.java:362) at org.jboss.Main.boot(Main.java:200) at org.jboss.Main$1.run(Main.java:508) at java.lang.Thread.run(Thread.java:619)Caused by: javax.management.JMRuntimeException: Failed to load MBeanServerBuilder class org.jboss.mx.server.MBeanServerBuilderImpl: java.lang.ClassNotFoundException: org/jboss/mx/server/MBeanServerBuilderImpl at javax.management.MBeanServerFactory.checkMBeanServerBuilder(MBeanServerFactory.java:480) at javax.management.MBeanServerFactory.getNewMBeanServerBuilder(MBeanServerFactory.java:511) at javax.management.MBeanServerFactory.newMBeanServer(MBeanServerFactory.java:298) at javax.management.MBeanServerFactory.createMBeanServer(MBeanServerFactory.java:213) at javax.management.MBeanServerFactory.createMBeanServer(MBeanServerFactory.java:174) at sun.management.ManagementFactory.createPlatformMBeanServer(ManagementFactory.java:302) at java.lang.management.ManagementFactory.getPlatformMBeanServer(ManagementFactory.java:504) at org.apache.derby.impl.services.jmx.JMXManagementService$3.run(Unknown Source) at org.apache.derby.impl.services.jmx.JMXManagementService$3.run(Unknown Source) at java.security.AccessController.doPrivileged(Native Method) at org.apache.derby.impl.services.jmx.JMXManagementService.findServer(Unknown Source) at org.apache.derby.impl.services.jmx.JMXManagementService.boot(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(Unknown Source) at org.apache.derby.impl.services.monitor.TopService.bootModule(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(Unknown Source) at org.apache.derby.iapi.services.monitor.Monitor.startSystemModule(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.runWithState(Unknown Source) at org.apache.derby.impl.services.monitor.FileMonitor.&lt;init&gt;(Unknown Source) at org.apache.derby.iapi.services.monitor.Monitor.startMonitor(Unknown Source) at org.apache.derby.iapi.jdbc.JDBCBoot.boot(Unknown Source) at org.apache.derby.jdbc.EmbeddedDriver.boot(Unknown Source) at org.apache.derby.jdbc.EmbeddedDriver.&lt;clinit&gt;(Unknown Source) ... 110 moreCaused by: java.lang.ClassNotFoundException: org/jboss/mx/server/MBeanServerBuilderImpl at java.lang.Class.forName0(Native Method) at java.lang.Class.forName(Class.java:169) at javax.management.MBeanServerFactory.loadBuilderClass(MBeanServerFactory.java:427) at javax.management.MBeanServerFactory.checkMBeanServerBuilder(MBeanServerFactory.java:465) ... 131 more02:40:29 250 INFO &#91;ConnectionFactoryBindingService&#93; Bound ConnectionManager 'jboss.jca:service=DataSourceBinding name=DefaultDS' to JNDI name 'java:DefaultDS'02:40:29 562 INFO &#91;A&#93; Bound to JNDI name: queue/A02:40:29 562 INFO &#91;B&#93; Bound to JNDI name: queue/B02:40:29 562 INFO &#91;C&#93; Bound to JNDI name: queue/C02:40:29 562 INFO &#91;D&#93; Bound to JNDI name: queue/D02:40:29 578 INFO &#91;ex&#93; Bound to JNDI name: queue/ex02:40:29 593 INFO &#91;testTopic&#93; Bound to JNDI name: topic/testTopic02:40:29 593 INFO &#91;securedTopic&#93; Bound to JNDI name: topic/securedTopic02:40:29 609 INFO &#91;testDurableTopic&#93; Bound to JNDI name: topic/testDurableTopic02:40:29 609 INFO &#91;testQueue&#93; Bound to JNDI name: queue/testQueue02:40:29 656 INFO &#91;UILServerILService&#93; JBossMQ UIL service available at : /127.0.0.1:809302:40:29 703 INFO &#91;DLQ&#93; Bound to JNDI name: queue/DLQ02:40:29 875 INFO &#91;ConnectionFactoryBindingService&#93; Bound ConnectionManager 'jboss.jca:service=ConnectionFactoryBinding name=JmsXA' to JNDI name 'java:JmsXA'02:40:30 093 INFO &#91;TomcatDeployer&#93; deploy  ctxPath=/jmx-console  warUrl=.../deploy/jmx-console.war/02:40:30 250 ERROR &#91;URLDeploymentScanner&#93; Incomplete Deployment listing:&#8212; MBeans waiting for other MBeans &#8212;ObjectName: jboss:service=zzzzzDerbyDB State: FAILED Reason: java.lang.ExceptionInInitializerError Depends On Me: jboss.jca:service=ManagedConnectionFactory name=zzzzzDatasource&#8212; MBEANS THAT ARE THE ROOT CAUSE OF THE PROBLEM &#8212;ObjectName: jboss:service=zzzzzDerbyDB State: FAILED Reason: java.lang.ExceptionInInitializerError Depends On Me: jboss.jca:service=ManagedConnectionFactory name=zzzzzDatasource02:40:30 656 INFO &#91;Http11AprProtocol&#93; Starting Coyote HTTP/1.1 on http-127.0.0.1-808002:40:30 687 INFO &#91;AjpAprProtocol&#93; Starting Coyote AJP/1.3 on ajp-127.0.0.1-800902:40:30 703 INFO &#91;Server&#93; JBoss (MX MicroKernel) &#91;4.2.3.GA (build: SVNTag=JBoss_4_2_3_GA date=200807181439)&#93; Started in 23s:375ms,0,0
LOBStreamControl.truncate() doesn't delete temporary files,If LOBStreamControl.truncate() reduces the size of the lob so that it fits in the internal buffer  it closes the temporary file  but it doesn't remove it. See the attached Java class (TruncateClob.java) which fills the tmp directory with temporary lob files  even if each lob is explicitly freed.,0,0
SQLSessionContext not correctly initialized in some non-method call nested contexts,In some contexts  beside calling stored routines containing SQL  Derbyuses nested execution contexts  wehere we have two nested activations but no nested connections.In such cases  currently a new SQLSessionContext is constructed  butnot initialized correctly. This leads to the session variablesCURRENT_ROLE/CURRENT_SCHEMA not being set correctly in these contexts(they should inherited from the parent context  cf DERBY-3327).For method calls  this is being handled by generating a call tolcc.setupNestedSessionContext (seeStaticMethodCallNode#generateSetupNestedSessionContext)In some of these nested contexts  one or both of the session variablesCURRENT_ROLE/CURRENT_SCHEMA can be referenced  in othersnot. Obviously  if they can  this will lead to errors. The followingcontexts will have this problem: ALTER TABLE ADD COLUMN &lt;colname&gt; &lt;coltype&gt; DEFAULT CURRENT_ROLE In the AlterTableConstantAction  a nested UPDATE statement is used to give existing rows the new column its default value. This execution context is nested  cf. AlterTableConstantAction#executeUpdate TRIGGER body execution may reference CURRENT_ROLE/CURRENT_SCHEMA. The body executes in a nested context  cf. GenericTriggerExecutor#executeSPS.In other cases  the session variables can not be referenced  so thisnot a problem:  CHECK constraint execution when executed as part of an ALTER TABLE EmbedResultSet.insertRow  .deleteRow  .updateRowThe session context should not be changed (pushed) for these nestedexecutions  since there is no nested connection (SQL 2003  4.37.1: 'AnSQL-session is associated with an SQL-connection.'),0,0
Blob.setBytes differs between embedded and client driver when the specified length is invalid,Blob.setBytes behaves differently with the embedded driver and the client driver.Assume a 1 byte array and a specified length of 2: Blob.setBytes(1  new byte[] {0x69}  0  2)Embedded: IndexOutOfBoundsException (from java.io.RandomAccessFile.writeBytes or System.arraycopy)Client: succeeds  returns insertion count 1The behavior should be made consistent  but what is the correct behavior?From the Blob.setBytes JavaDoc:'Writes all or part of the given byte array to the BLOB value that this Blob object represents and returns the number of bytes written. Writing starts at position pos in the BLOB value; len bytes from the given byte array are written. The array of bytes will overwrite the existing bytes in the Blob object starting at the position pos. If the end of the Blob value is reached while writing the array of bytes  then the length of the Blob value will be increased to accomodate the extra bytes.',0,0
some messages are referenced but never used - MessageBundleTest output,MessageBundleTest was taken out of derbyall because it only ran with classes  not with jars  and it was decided that it would be better to make this into a build check rather than a test...However  the build check - DERBY-1458 - was never implemented  and so  the test has not been run.When I ran  I got the following output:testSQLStateOrphanedIds ERROR: Message id 22003.S.4 in SQLState.java was not found in messages_en.propertiesERROR: Message id XCL32.S in SQLState.java was not found in messages_en.propertiesERROR: Message id X0RQ3.C in SQLState.java was not found in messages_en.propertiesERROR: Message id XSAX1 in SQLState.java was not found in messages_en.propertiesused 188 ms .testMessageIdOrphanedIds used 0 ms .testMessageBundleOrphanedMessages WARNING: Message id 22004.S.4 in messages_en.properties is not referenced in either SQLState.java or MessageId.javaWARNING: Message id J106 in messages_en.properties is not referenced in either SQLState.java or MessageId.javaWARNING: Message id J107 in messages_en.properties is not referenced in either SQLState.java or MessageId.javaWARNING: Message id J108 in messages_en.properties is not referenced in either SQLState.java or MessageId.javaWARNING: Message id J109 in messages_en.properties is not referenced in either SQLState.java or MessageId.javaWARNING: Message id 08000.S.1 in messages_en.properties is not referenced in either SQLState.java or MessageId.javaWARNING: Message id XCL17.S in messages_en.properties is not referenced in either SQLState.java or MessageId.javaWARNING: Message id XJ102.S in messages_en.properties is not referenced in either SQLState.java or MessageId.javaused 0 ms Some of these are known issues  e.g. XCL32 - it's been in MessageBundleTest.out for a long time...XSAX1 looks like a assumption mismatch in MessageBundleTest  see DERBY-1413....But others need some minor code changes/cleanup  for instance  looks like the need for J106 was removed during DERBY-2692  see http://svn.apache.org/viewvc?view=rev&amp;revision=543428  and should probably get removed from messages_en.properties/messages.xml.Needs further checking.,0,0
Failed tests should save the database off to the fail directory,Currently failed tests save the derby.log to the fail directory for that test. It would be useful to save the database as well.,0,0
mismatch between error XCL30 and 22003.S.4 and parameters in usage,I found a script  trunk/tools/testing/i18nTestGenerator/generateClientMessageTest.sh  intended to create a test to verify correctness of client error messages(trunk/java/testing/org/apache/derbyTesting/functionTests/tests/i18n/TestClientMessages.java ). The script is broken (see DERBY-1567) but after fixing up the resulting test and running it  it did show two messages which look a little odd in their usage (plus some messages for which the usage looked fine):XCL30 - LANG_STREAMING_COLUMN_I_O_EXCEPTION: messages.xml:  &lt;msg&gt; &lt;name&gt;XCL30.S&lt;/name&gt; &lt;text&gt;An IOException was thrown when reading a '{0}' from an InputStream.&lt;/text&gt; &lt;arg&gt;value&lt;/arg&gt; &lt;/msg&gt;apparently correct number of parameters  but odd...doesn't look like ioe fits the usage in the message text.EmbedBlob: } catch (IOException ioe) { throw StandardException.newException( SQLState.LANG_STREAMING_COLUMN_I_O_EXCEPTION  ioe); }has a second parameter:client.am.Lob: throw new SqlException(null  new ClientMessageId( SQLState.LANG_STREAMING_COLUMN_I_O_EXCEPTION)  typeDesc  ioe );looks like second parameter fits the {0}:SQLBinary:  throw StandardException. newException(SQLState.LANG_STREAMING_COLUMN_I_O_EXCEPTION  ioe  getTypeName());SQLChar: throw StandardException. newException(SQLState.LANG_STREAMING_COLUMN_I_O_EXCEPTION  ioe  getTypeName()); throw StandardException.newException( SQLState.LANG_STREAMING_COLUMN_I_O_EXCEPTION   ioe   'java.sql.String');--------------------------------------------------------------22003.S.4 - CLIENT_LENGTH_OUTSIDE_RANGE_FOR_DATATYPE &lt;msg&gt; &lt;name&gt;22003.S.4&lt;/name&gt; &lt;text&gt;The length ({0}) exceeds the maximum length for the data type ({1}).&lt;/text&gt; &lt;arg&gt;number&lt;/arg&gt; &lt;arg&gt;datatypeName&lt;/arg&gt; &lt;/msg&gt;correct number of parameters  but new Integer(Integer.MAX_VALUE) returns a number  not a datatype name: client.am.PreparedStatement: throw new SqlException( agent_.logWriter_  new ClientMessageId( SQLState.CLIENT_LENGTH_OUTSIDE_RANGE_FOR_DATATYPE)  new Long(length)  new Integer(Integer.MAX_VALUE) ).getSQLException();client.am.ResultSet: throw new SqlException(agent_.logWriter_  new ClientMessageId(SQLState.CLIENT_LENGTH_OUTSIDE_RANGE_FOR_DATATYPE)  new Long(length)  new Integer(Integer.MAX_VALUE)).getSQLException(); throw new SqlException(agent_.logWriter_  new ClientMessageId(SQLState.CLIENT_LENGTH_OUTSIDE_RANGE_FOR_DATATYPE)  new Long(length)  new Integer(Integer.MAX_VALUE)).getSQLException();  throw new SqlException(agent_.logWriter_  new ClientMessageId(SQLState.CLIENT_LENGTH_OUTSIDE_RANGE_FOR_DATATYPE)  new Long(length)  new Integer(Integer.MAX_VALUE)).getSQLException();-------------------------------------------,0,0
testMetaDataQueryRunInSYScompilationSchema(.....upgradeTests.Changes10_4) fails on CVM/phoneME,Seen since ~svn r703509. See e.g. http://dbtg.thresher.com/derby/test/Daily/javaME/testing/Limited/testSummary-708609.htmlhttp://dbtg.thresher.com/derby/test/Daily/javaME/testing/testlog/ubuntu/708609-suitesAll_diff.txt4) testMetaDataQueryRunInSYScompilationSchema(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_4)java.sql.SQLException: Failed to create database 'singleUse/oneuse2d'  see the next exception for details. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Ljava/lang/String;Ljava/lang/String;Ljava/sql/SQLException;ILjava/lang/Throwable;[Ljava/lang/Object;)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Ljava/lang/String;[Ljava/lang/Object;Ljava/sql/SQLException;ILjava/lang/Throwable;)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.Util.seeNextException(Ljava/lang/String;[Ljava/lang/Object;Ljava/sql/SQLException;)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.createDatabase(Ljava/lang/String;Ljava/util/Properties;)Lorg/apache/derby/iapi/db/Database;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(Lorg/apache/derby/jdbc/InternalDriver;Ljava/lang/String;Ljava/util/Properties;)V(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection30.&lt;init&gt;(Lorg/apache/derby/jdbc/InternalDriver;Ljava/lang/String;Ljava/util/Properties;)V(Unknown Source) at org.apache.derby.jdbc.Driver169.getNewEmbedConnection(Ljava/lang/String;Ljava/util/Properties;)Lorg/apache/derby/impl/jdbc/EmbedConnection;(Unknown Source) at org.apache.derby.jdbc.InternalDriver.connect(Ljava/lang/String;Ljava/util/Properties;)Ljava/sql/Connection;(Unknown Source) at org.apache.derby.jdbc.EmbeddedSimpleDataSource.getConnection(Ljava/lang/String;Ljava/lang/String;)Ljava/sql/Connection;(Unknown Source) at org.apache.derby.jdbc.EmbeddedSimpleDataSource.getConnection()Ljava/sql/Connection;(Unknown Source) at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_4.testMetaDataQueryRunInSYScompilationSchema()V(Changes10_4.java:113) at org.apache.derbyTesting.junit.BaseTestCase.runBare()V(BaseTestCase.java:105) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(Ljunit/framework/TestResult;)V(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(Ljunit/framework/TestResult;)V(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(Ljunit/framework/TestResult;)V(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(Ljunit/framework/TestResult;)V(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(Ljunit/framework/TestResult;)V(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(Ljunit/framework/TestResult;)V(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at sun.misc.CVM.runMain()V(CVM.java:514)Caused by: java.sql.SQLException: Collator support not available from the JVM for the database's locale 'no'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Ljava/lang/String;Ljava/lang/String;Ljava/sql/SQLException;ILjava/lang/Throwable;[Ljava/lang/Object;)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Lorg/apache/derby/iapi/error/StandardException;)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Ljava/lang/Throwable;)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Ljava/lang/Throwable;ZZ)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Ljava/lang/Throwable;)Ljava/sql/SQLException;(Unknown Source) ... 99 moreCaused by: ERROR XBM04: Collator support not available from the JVM for the database's locale 'no'. at org.apache.derby.iapi.error.StandardException.newException(Ljava/lang/String;Ljava/lang/Object;)Lorg/apache/derby/iapi/error/StandardException;(Unknown Source) at org.apache.derby.iapi.types.DataValueFactoryImpl.verifyCollatorSupport()Ljava/text/RuleBasedCollator;(Unknown Source) at org.apache.derby.iapi.types.DataValueFactoryImpl.boot(ZLjava/util/Properties;)V(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(Ljava/lang/Object;ZLjava/util/Properties;)V(Unknown Source) at org.apache.derby.impl.services.monitor.TopService.bootModule(ZLjava/lang/Object;Lorg/apache/derby/impl/services/monitor/ProtocolKey;Ljava/util/Properties;)Ljava/lang/Object;(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(ZLjava/lang/Object;Ljava/lang/String;Ljava/lang/String;Ljava/util/Properties;)Ljava/lang/Object;(Unknown Source) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(ZLjava/lang/Object;Ljava/lang/String;Ljava/util/Properties;)Ljava/lang/Object;(Unknown Source) at org.apache.derby.impl.db.BasicDatabase.boot(ZLjava/util/Properties;)V(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(Ljava/lang/Object;ZLjava/util/Properties;)V(Unknown Source) at org.apache.derby.impl.services.monitor.TopService.bootModule(ZLjava/lang/Object;Lorg/apache/derby/impl/services/monitor/ProtocolKey;Ljava/util/Properties;)Ljava/lang/Object;(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(Lorg/apache/derby/iapi/services/monitor/PersistentService;Ljava/lang/String;Ljava/lang/String;Ljava/util/Properties;Z)Ljava/lang/Object;(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.createPersistentService(Ljava/lang/String;Ljava/lang/String;Ljava/util/Properties;)Ljava/lang/Object;(Unknown Source) at org.apache.derby.iapi.services.monitor.Monitor.createPersistentService(Ljava/lang/String;Ljava/lang/String;Ljava/util/Properties;)Ljava/lang/Object;(Unknown Source) ... 99 more,0,0
Incorrect ORDER BY caused by index,I think I found a bug in Derby that is triggered by an index on a large column: VARCHAR(1024). I know it is generally not a good idea to have an index on such a large column.I have a table (table2) with a column 'value'  my query orders on this column but the result is not sorted. It is sorted if I remove the index on that column.The output of the attached script is as follows (results should be ordered on the middle column):ID |VALUE |VALUE----------------------------------------------2147483653 |000002 |218572147483654 |000003 |218574294967297 |000001 |21857While I would expect:ID |VALUE |VALUE----------------------------------------------4294967297 |000001 |218572147483653 |000002 |218572147483654 |000003 |21857This is the definition:CREATE TABLE table1 (id BIGINT NOT NULL  PRIMARY KEY(id));CREATE INDEX key1 ON table1(id);CREATE TABLE table2 (id BIGINT NOT NULL  name VARCHAR(40) NOT NULL  value VARCHAR(1024)  PRIMARY KEY(id  name));CREATE UNIQUE INDEX key2 ON table2(id  name);CREATE INDEX key3 ON table2(value);This is the query:SELECT table1.id  m0.value  m1.valueFROM table1  table2 m0  table2 m1WHERE table1.id=m0.idAND m0.name='PageSequenceId'AND table1.id=m1.idAND m1.name='PostComponentId'AND m1.value='21857'ORDER BY m0.value;The bug can be reproduced by just executing the attached script with the ij-tool.Note that the result of the query becomes correct when enough data is changed. This prevented me from creating a smaller example.See the attached file 'derby-reproduce.zip' for sysinfo  derby.log and script.sql.Michael Segel pointed out:'It looks like its hitting the index ordering on id name from table 2 and is ignoring the order by clause.',0,0
GeneratedColumnsTest fails with ''F_MINUS' is not recognized as a function or procedure.' on cvm/phoneME,See http://dbtg.thresher.com/derby/test/Daily/javaME/testing/Limited/testSummary-708941.html / http://dbtg.thresher.com/derby/test/Daily/javaME/testing/testlog/ubuntu/708941-suitesAll_diff.txt3) test_008_basicForeignKeys(org.apache.derbyTesting.functionTests.tests.lang.GeneratedColumnsTest)java.sql.SQLException: 'F_MINUS' is not recognized as a function or procedure. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Ljava/lang/String;Ljava/lang/String;Ljava/sql/SQLException;ILjava/lang/Throwable;[Ljava/lang/Object;)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Lorg/apache/derby/iapi/error/StandardException;)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Ljava/lang/Throwable;)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Ljava/lang/Throwable;ZZ)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Ljava/lang/Throwable;)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Ljava/lang/Throwable;)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(Lorg/apache/derby/impl/jdbc/EmbedConnection;Ljava/lang/String;ZIIII[I[Ljava/lang/String;)V(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement169.&lt;init&gt;(Lorg/apache/derby/impl/jdbc/EmbedConnection;Ljava/lang/String;ZIIII[I[Ljava/lang/String;)V(Unknown Source) at org.apache.derby.jdbc.Driver169.newEmbedPreparedStatement(Lorg/apache/derby/impl/jdbc/EmbedConnection;Ljava/lang/String;ZIIII[I[Ljava/lang/String;)Ljava/sql/PreparedStatement;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Ljava/lang/String;IIII[I[Ljava/lang/String;)Ljava/sql/PreparedStatement;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Ljava/lang/String;)Ljava/sql/PreparedStatement;(Unknown Source) at org.apache.derbyTesting.functionTests.tests.lang.GeneratedColumnsTest.chattyPrepare(Ljava/sql/Connection;Ljava/lang/String;)Ljava/sql/PreparedStatement;(GeneratedColumnsTest.java:991) at org.apache.derbyTesting.functionTests.tests.lang.GeneratedColumnsTest.goodStatement(Ljava/sql/Connection;Ljava/lang/String;)V(GeneratedColumnsTest.java:977) at org.apache.derbyTesting.functionTests.tests.lang.GeneratedColumnsTest.test_008_basicForeignKeys()V(GeneratedColumnsTest.java:834) at org.apache.derbyTesting.junit.BaseTestCase.runBare()V(BaseTestCase.java:105) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(Ljunit/framework/TestResult;)V(BaseTestSetup.java:57) at sun.misc.CVM.runMain()V(CVM.java:514)Caused by: ERROR 42Y03: 'F_MINUS' is not recognized as a function or procedure. at org.apache.derby.iapi.error.StandardException.newException(Ljava/lang/String;Ljava/lang/Object;)Lorg/apache/derby/iapi/error/StandardException;(Unknown Source) at org.apache.derby.impl.sql.compile.StaticMethodCallNode.bindExpression(Lorg/apache/derby/impl/sql/compile/FromList;Lorg/apache/derby/impl/sql/compile/SubqueryList;Ljava/util/Vector;)Lorg/apache/derby/impl/sql/compile/JavaValueNode;(Unknown Source) at org.apache.derby.impl.sql.compile.JavaToSQLValueNode.bindExpression(Lorg/apache/derby/impl/sql/compile/FromList;Lorg/apache/derby/impl/sql/compile/SubqueryList;Ljava/util/Vector;)Lorg/apache/derby/impl/sql/compile/ValueNode;(Unknown Source) at org.apache.derby.impl.sql.compile.GenerationClauseNode.bindExpression(Lorg/apache/derby/impl/sql/compile/FromList;Lorg/apache/derby/impl/sql/compile/SubqueryList;Ljava/util/Vector;)Lorg/apache/derby/impl/sql/compile/ValueNode;(Unknown Source) at org.apache.derby.impl.sql.compile.TableElementList.bindAndValidateGenerationClauses(Lorg/apache/derby/impl/sql/compile/FromList;)V(Unknown Source) at org.apache.derby.impl.sql.compile.CreateTableNode.bindStatement()V(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepMinion(Lorg/apache/derby/iapi/sql/conn/LanguageConnectionContext;Z[Ljava/lang/Object;Lorg/apache/derby/iapi/sql/dictionary/SchemaDescriptor;Z)Lorg/apache/derby/iapi/sql/PreparedStatement;(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepare(Lorg/apache/derby/iapi/sql/conn/LanguageConnectionContext;Z)Lorg/apache/derby/iapi/sql/PreparedStatement;(Unknown Source) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Lorg/apache/derby/iapi/sql/dictionary/SchemaDescriptor;Ljava/lang/String;ZZ)Lorg/apache/derby/iapi/sql/PreparedStatement;(Unknown Source) ... 32 more4) test_007_basicTriggers(org.apache.derbyTesting.functionTests.tests.lang.GeneratedColumnsTest)java.sql.SQLException: 'F_MINUS' is not recognized as a function or procedure. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Ljava/lang/String;Ljava/lang/String;Ljava/sql/SQLException;ILjava/lang/Throwable;[Ljava/lang/Object;)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Lorg/apache/derby/iapi/error/StandardException;)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Ljava/lang/Throwable;)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Ljava/lang/Throwable;ZZ)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Ljava/lang/Throwable;)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Ljava/lang/Throwable;)Ljava/sql/SQLException;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(Lorg/apache/derby/impl/jdbc/EmbedConnection;Ljava/lang/String;ZIIII[I[Ljava/lang/String;)V(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement169.&lt;init&gt;(Lorg/apache/derby/impl/jdbc/EmbedConnection;Ljava/lang/String;ZIIII[I[Ljava/lang/String;)V(Unknown Source) at org.apache.derby.jdbc.Driver169.newEmbedPreparedStatement(Lorg/apache/derby/impl/jdbc/EmbedConnection;Ljava/lang/String;ZIIII[I[Ljava/lang/String;)Ljava/sql/PreparedStatement;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Ljava/lang/String;IIII[I[Ljava/lang/String;)Ljava/sql/PreparedStatement;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Ljava/lang/String;)Ljava/sql/PreparedStatement;(Unknown Source) at org.apache.derbyTesting.functionTests.tests.lang.GeneratedColumnsTest.chattyPrepare(Ljava/sql/Connection;Ljava/lang/String;)Ljava/sql/PreparedStatement;(GeneratedColumnsTest.java:991) at org.apache.derbyTesting.functionTests.tests.lang.GeneratedColumnsTest.goodStatement(Ljava/sql/Connection;Ljava/lang/String;)V(GeneratedColumnsTest.java:977) at org.apache.derbyTesting.functionTests.tests.lang.GeneratedColumnsTest.test_007_basicTriggers()V(GeneratedColumnsTest.java:661) at org.apache.derbyTesting.junit.BaseTestCase.runBare()V(BaseTestCase.java:105) at junit.extensions.TestDecorator.basicRun(Ljunit/framework/TestResult;)V(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect()V(TestSetup.java:21) at junit.extensions.TestSetup.run(Ljunit/framework/TestResult;)V(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(Ljunit/framework/TestResult;)V(BaseTestSetup.java:57) at sun.misc.CVM.runMain()V(CVM.java:514)Caused by: ERROR 42Y03: 'F_MINUS' is not recognized as a function or procedure. at org.apache.derby.iapi.error.StandardException.newException(Ljava/lang/String;Ljava/lang/Object;)Lorg/apache/derby/iapi/error/StandardException;(Unknown Source) at org.apache.derby.impl.sql.compile.StaticMethodCallNode.bindExpression(Lorg/apache/derby/impl/sql/compile/FromList;Lorg/apache/derby/impl/sql/compile/SubqueryList;Ljava/util/Vector;)Lorg/apache/derby/impl/sql/compile/JavaValueNode;(Unknown Source) at org.apache.derby.impl.sql.compile.JavaToSQLValueNode.bindExpression(Lorg/apache/derby/impl/sql/compile/FromList;Lorg/apache/derby/impl/sql/compile/SubqueryList;Ljava/util/Vector;)Lorg/apache/derby/impl/sql/compile/ValueNode;(Unknown Source) at org.apache.derby.impl.sql.compile.GenerationClauseNode.bindExpression(Lorg/apache/derby/impl/sql/compile/FromList;Lorg/apache/derby/impl/sql/compile/SubqueryList;Ljava/util/Vector;)Lorg/apache/derby/impl/sql/compile/ValueNode;(Unknown Source) at org.apache.derby.impl.sql.compile.TableElementList.bindAndValidateGenerationClauses(Lorg/apache/derby/impl/sql/compile/FromList;)V(Unknown Source) at org.apache.derby.impl.sql.compile.CreateTableNode.bindStatement()V(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepMinion(Lorg/apache/derby/iapi/sql/conn/LanguageConnectionContext;Z[Ljava/lang/Object;Lorg/apache/derby/iapi/sql/dictionary/SchemaDescriptor;Z)Lorg/apache/derby/iapi/sql/PreparedStatement;(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepare(Lorg/apache/derby/iapi/sql/conn/LanguageConnectionContext;Z)Lorg/apache/derby/iapi/sql/PreparedStatement;(Unknown Source) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Lorg/apache/derby/iapi/sql/dictionary/SchemaDescriptor;Ljava/lang/String;ZZ)Lorg/apache/derby/iapi/sql/PreparedStatement;(Unknown Source) ... 32 more,0,0
Add tests of generated columns when sql authorization is turned on,Add tests of generated columns under sql authorization. For instance  we need to verify the current_role cannot appear in generation clauses.,0,0
Improve performance of reading modified Clobs,The performance of reading modified Clobs is poor  which is demonstrated by running a test program selecting a 10 MB Clob and then getting the contents using getSubString: unmodified Clob (StoreStreamClob) : ~1 300 ms modified Clob (TemporaryClob): ~156 000 msIn this case  the Clob was modified by changing the first character.A number of subtasks will be created to handle the various issues  which will be related to both performance and code cleanup.For a brief overview  see http://www.nabble.com/Suggestion-for-improving-ClobUpdatableReader-and-related-code-to20308303.html,0,1
Generation clauses which mention user-coded functions may produce different resuls depending on who performs the triggering INSERT/UPDATE,This is similar to DERBY-3944. The compiler uses the current schema in order to resolve unqualifed function names when preparing INSERT/UPDATE statement. This means that a generation clause may evaluate differently depending on who invokes the triggering INSERT/UPDATE statement. This violates the requirement that generation clause should be deterministic (see part 2 of the ANSI/ISO standard  section 4.16.Hopefully  the same patch will fix both DERBY-3944 and this issue.,0,0
Cannot insert 994 character long string into indexed column,Inserting a 994 character string into a varchar(1000) column with an index fails.These steps1. 'create table t (x varchar(1000) primary key)'2. 'insert into t values ' where ? holds a 994 character stringproduce the following error:ERROR XSCB6: Limitation: Record of a btree secondary index cannot be updated or inserted due to lack of space on the page. Use the parameters derby.storage.pageSize and/or derby.storage.pageReservedSpace to work around this limitation. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:276) at org.apache.derby.impl.store.access.btree.BTreeController.doIns(BTreeController.java:845) at org.apache.derby.impl.store.access.btree.BTreeController.insert(BTreeController.java:1264) at org.apache.derby.impl.store.access.btree.index.B2IController.insert(B2IController.java:210) at org.apache.derby.impl.sql.execute.IndexChanger.insertAndCheckDups(IndexChanger.java:439) at org.apache.derby.impl.sql.execute.IndexChanger.doInsert(IndexChanger.java:383) at org.apache.derby.impl.sql.execute.IndexChanger.insert(IndexChanger.java:589) at org.apache.derby.impl.sql.execute.IndexSetChanger.insert(IndexSetChanger.java:268) at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(RowChangerImpl.java:453) at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1011) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:487) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:372) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235)The page size should be set sufficiently high at index creation time to hold columns with the specified maximum size.,0,0
Don't allow references to generated columns in the NEW transition variables of triggered actions of BEFORE triggers,Thanks to Dag for finding this restriction in the SQL Standard  part 2  section 11.39  SR 12 c) I see this provision: 12) If BEFORE is specified  then: : c) The &lt;triggered action&gt; shall not contain a &lt;field reference&gt; that references a field in the new transition variable corresponding to a generated column of T.,0,0
PositionedStoreStream doesn't initialize itself properly,When a PositionedStoreStream is created on top of a stream from store  it must properly initialize itself.Proper initialization consists of initializing and resetting the stream to make sure the states of the streams are in sync.A case of out of sync stream states was detected in a test where the Clob reference wasn't kept  but a new Clob object was created for each operation  i.e: rs.getClob(1).length(); rs.getClob(1).getSubString(...);A symptom of out of sync stream states is EOFException on a valid request.I don't think the access style above is supposed to work  but the proper initialization should be performed anyway.,0,0
Clob.truncate(long) in the client driver doesn't update the cached Clob length,The client driver caches the Clob length  but doesn't update it when Clob.truncate is called.I will attach a few regression tests  where one of them demonstrates the issue. The fix is also very simple; update the cached length.,0,0
Add a facility to override the default set of old versions to be tested in the upgrade tests.,In my testing I have seen a need for performing upgrade testing from local/internal non-public 'versions' of Derby.That is  having local/internal changes to some older branch and allowing upgrade testing from this (not yet public) version.One solution is to locally modify the 'VERSIONS' table of the upgradetests '_Suite'  but this means modifying the source for each such case.A more flexible solution is to override the default versions (given in 'VERSIONS') by using a property giving a file which lists the versions to test upgrade from. The location to local version jars can currently be given by the 'derbyTesting.oldReleasePath' property. The list of versions could be given by a property 'derbyTesting.oldVersionsPath'.This will also easily allow us to skip testing upgrade from a specific version. (This can already be done by not having the version jars available.)The list of versions given via the property should be used whether versions (jars) are available locally (as given by the 'derbyTesting.oldReleasePath' property or fetched from the Apache Derby svn repository ('http://svn.apache.org/repos/asf/db/derby/jars').I have a patch for this which I will submit for review.,0,0
ResultSetStreamTest fails on case sensitive file systems  and isn't run as part of any suite,ResultSetStreamTest fails on case sensitive file systems  and it isn't run as part of any suite.I believe this should be easy to fix  and can be a nice issue to work on for people wanting to get more familiar with the basics of the Derby test framework (including JUnit).Assuming the test works once the first obstacle has been removed,0,0
With IBM 1.6 T_RawStoreFactory fails with There should be 0 observers  but we still have 1 observers on Win 2K,On Win2K T_RawStoreFactory fails consistently with java version '1.6.0'Java(TM) SE Runtime Environment (build pwi3260sr3-20081106_07(SR3))IBM J9 VM (build 2.4  J2RE 1.6.0 IBM J9 2.4 Windows XP x86-32 jvmwi3260-20081105_25433 (JIT enabled  AOT enabled)J9VM - 20081105_025433_lHdSMrJIT - r9_20081031_1330GC - 20081027_AB)JCL - 20081106_01     Start: T_RawStoreFactory jdk1.6.0 2008-12-17 09:37:49 ***2 del&lt; &#8211; Unit Test T_RawStoreFactory finished2 add&gt; There should be 0 observers  but we still have 1 observers.&gt; Shutting down due to unit test failure.Test Failed.    I have seen the same failure on Linux and Windows XP intermittently with IBM 1.6.,0,0
ORDER BY causes column to be returned,The ORDER BY is causing the ordered column to be retrieved even though it is not part of the SELECT clause. Here is a script to create a table  insert a row  and perform the select:CREATE TABLE 'REVIEWS'.'GEOFF_REVIEWS_REVIEW'( PK INTEGER PRIMARY KEY not null  numstars BIGINT  body VARCHAR(32672)  title VARCHAR(32672)  authoremail VARCHAR(32672));INSERT INTO 'REVIEWS'.'GEOFF_REVIEWS_REVIEW' (PK numstars body title authoremail) VALUES (0 /not nullable/ 0 's' 's' 's');SELECT 'review'.'numstars'FROM 'GEOFF_REVIEWS_REVIEW' AS 'review'WHERE 'review'.'PK' = 1ORDER BY 'review'.PK,0,0
ALTER COLUMN ... WITH DEFAULT NULL does not change the default,Reported on derby-user.http://mail-archives.apache.org/mod_mbox/db-derby-user/200901.mbox/%3c21349727.post@talk.nabble.com%3eij&gt; create table t (x varchar(5) default 'abc');0 rows inserted/updated/deletedij&gt; alter table t alter column x with default null;0 rows inserted/updated/deletedij&gt; insert into t values default;1 row inserted/updated/deletedij&gt; select * from t;X abc 1 row selected,0,0
ArrayIndexOutOfBoundsException in TopService.inService under heavy multithreaded use of EmbeddedDriver,I have created a test program that reproduces this issue. The program pounds on Derby by running jobs on a pool of 10 threads. Each job creates a new Derby database  a schema  a table  and an index. Then it shuts down the database and finishes. The program runs until an error occurs or until 1000 jobs have finished.The problem is very intermittent  and related I think to multithreaded access of a vector 'moduleInstances' in TopService.java. I am seeing the error on my machine about half the time I run the test program. Sometimes it happens after 100 or 200 jobs...but sometimes not until 500 or more  or not at all.I am using the 10.4.2 derby.jar downloaded from http://db.apache.org/derby/releases/release-10.4.2.0.cgi  without any modifications on my part.I will attach the test program plus output from a run that failed with the ArrayIndexOutOfBoundsException. (The actual exception thrown to the application from Derby is SQLException  but the underlying cause is an ArrayIndexOutOfBoundsException.) BE AWARE that if you run this test program it can use up a GByte or more of disk space in your Java tmp directory.,0,0
Remove dependency of junit targets on deprecated jdk16 variable,The junit target for running the jdbc4 tests depends on the jdk16 variable being set in your ant.properties. For the build  this variable has been deprecated. We should be able to make the jdbc4 tests depend on whether the environment is Java 6 instead.,0,0
Improve length caching in TemporaryClob,TemporaryClob doesn't save the known length of the Clob in all situations.The following places in the code should be improved (some easier than others): a) TemporaryClob(String ConChild) b) copyClobContent(InternalClob long) (non-static) c) copyClobContent(InternalClob) (non-static)There might be additional places to fix too.,0,1
Replace felix.jar file with the felix sources,In order to bundle Derby with popular linux distributions like Debian and Ubuntu  it must be possible to build Derby from sources and existing linux components. By replacing Felix jar with the corresponding sources  we move another step closer to being able to bundle Derby with linux distributions.,0,0
An attempt was made to access an out of range slot on a page,When running our application we get the following error message:An attempt was made to access an out of range slot on a page:INSERT INTO orders (operation  receptacle  vehicle_id  iata_origin  icao_origin  sta  eta  ata  pta  onb  arr_stand_id  arr_gate  arr_flight_no  arr_remarks  flight_no  icao_flight_no  icao_callsign  iata_destination  icao_destination  std  etd  atd  ofb  stand_id  pit_code  gate  aircraft_subtype_code  aircraft_registration  fuel_request  canceled  delay_ind  remarks  ptd  slot_request_code  slot_request  slot_granted  terminal  customer_name  customer_type  supplier_id  carnet_no  carnet_expiry  contract_id  authorization_reference  service_level  standby_at  started_at  completed_at  status  comment  meter1_start_volume_automatic  meter1_start_volume_manual  meter1_stop_volume_automatic  meter1_stop_volume_manual  meter2_start_volume_automatic  meter2_start_volume_manual  meter2_stop_volume_automatic  meter2_stop_volume_manual  temperature  density  created_at  updated_at  fuel_on_board  id) VALUES('FUELLING'  NULL  NULL  NULL  NULL  '2009-01-22 07:25:00'  '2009-01-22 07:30:00'  '2009-01-22 07:27:00'  '2009-01-22 07:27:00'  '2009-01-22 07:29:46'  'anAEBO3yqr3zaaabxfoB_Q'  NULL  'DY 0201'  NULL  'DY 0242'  'NAX0242'  'NAX242'  'TOS'  'ENTC'  '2009-01-22 07:50:00'  NULL  '2009-01-22 08:13:00'  '2009-01-22 08:06:08'  'anAEBO3yqr3zaaabxfoB_Q'  NULL  '18'  '733'  'LNKHA'  7200  0  'X'  NULL  '2009-01-22 08:13:00'  NULL  NULL  NULL  '1'  NULL  NULL  NULL  NULL  NULL  NULL  NULL  NULL  NULL  NULL  NULL  NULL  NULL  NULL  NULL  NULL  NULL  NULL  NULL  NULL  NULL  NULL  NULL  '2009-01-21 08:04:54'  '2009-01-22 13:24:59'  0  'aV9HYQ55ir3B9DabxfoB_Q')The error occurs several times per day on different systems. It started yesterday,0,0
On Z/OS store/access.sql fails with encryptionAES and encryptionDES,On Z/OS access.sql fails for encryptionAES and encryptionDES. The diff is big but I can't quite make out what the problem is. Maybe just a change of query plans.,1,0
org.apache.derby.impl.load.Import needs to escape single quotes,The code that builds the SQL statement that invokes the Import VTI doesn't properly escape single quotes. This causes problems for users  see: http://mail-archives.apache.org/mod_mbox/db-derby-user/200901.mbox/%3c21754463.post@talk.nabble.com%3eImport.performImport() is the method that needs to be fixed.,0,0
Use helper methods from IdUtil to quote SQL identifiers in EmbedResultSet,EmbedResultSet has two methods quoteSqlIdentifier() and getFullBaseTableName() which should be replaced with IdUtil.normalToDelimited() and IdUtil.mkQualifiedName()  respectively.,0,0
Multithreaded clob update causes growth in table that does not get reclaimed,Doing a multithreaded update of a Clob table causes table growth that does not get reclaimed except by compressing the table. The reproduction has a table with two threads. One thread updates row 1 repeatedly with 33 000 character clob. The other thread updates row 2 with a small clob  'hello'. The problem occurs back to 10.2 but seems much worse on trunk than 10.2. The trunk database grew to 273MB on trunk after 10000 updates of each row. The 10.2 database grew only to 25MB. If the update is synchronized there is no growth.I will attach the repro.,0,0
InputStream returned from Blob.getBinaryStream(long  long) terminates the stream by returning 0  should return -1,Take the following code to copy a sub-stream from a BLOB:Blob blob = rs.getBlob(1);InputStream stream = blob.getBinaryStream(1000  2000);try { IOUtils.copy(stream  out);} finally { stream.close();}This will loop forever in IOUtils.copy  as the InputStream is returning 0 at end of stream instead of -1. It probably should return -1 to comply with the Javadoc for InputStream.Notes:I have not yet checked Blob.getBinaryStream()  or any of the Clob methods  or the client driver. So some of these may have a similar issue.,0,0
ClientConnectionPoolDataSource.getPooledConnection and ClientXADataSource.getXAConnection ignore connection attributes,The methods CCPDS.getPooledConnection and CXADS.getXAConnection fail to pick up attributes set with setConnectionAttributes(String).The current regression tests fail to detect this  because they obtain a connection using getConnection(). I'm not sure if this method should be present in a XADataSource at all  but this problem should be addressed by a separate issue.,0,0
shutdown with incorrect permission on log files shows java.lang.NullPointerException  at org.apache.derby.impl.store.raw.log.LogToFile.flush(LogToFile.java:3964).  Should give bettter message.,I recently saw case where a user was seeing the following error in the derby.log when trying to shutdown their database.New exception raised during cleanup nulljava.lang.NullPointerException at org.apache.derby.impl.store.raw.log.LogToFile.flush(LogToFile.java:3964) at org.apache.derby.impl.store.raw.log.LogToFile.flush(LogToFile.java:1781) at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.flush(BaseDataFileFa at org.apache.derby.impl.store.raw.data.CachedPage.writePage(CachedPage.java:761 at org.apache.derby.impl.store.raw.data.CachedPage.clean(CachedPage.java:610) at org.apache.derby.impl.services.cache.ConcurrentCache.cleanAndUnkeepEntry(Conc at org.apache.derby.impl.services.cache.ConcurrentCache.cleanCache(ConcurrentCac at org.apache.derby.impl.services.cache.ConcurrentCache.cleanAll(ConcurrentCache at org.apache.derby.impl.services.cache.ConcurrentCache.shutdown(ConcurrentCache at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.stop(BaseDataFileFac at org.apache.derby.impl.services.monitor.TopService.stop(TopService.java:405) at org.apache.derby.impl.services.monitor.TopService.shutdown(TopService.java:34 at org.apache.derby.impl.services.monitor.BaseMonitor.shutdown(BaseMonitor.java: at org.apache.derby.impl.db.DatabaseContextImpl.cleanupOnError(DatabaseContextIm at org.apache.derby.iapi.services.context.ContextManager.cleanupOnError(ContextM at org.apache.derby.impl.jdbc.TransactionResourceImpl.cleanupOnError(Transaction at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(EmbedConnection.java:584) at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:68) at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:238) at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:119) at java.sql.DriverManager.getConnection(DriverManager.java:316) at java.sql.DriverManager.getConnection(DriverManager.java:273)It ended up that some of the log files did not have proper write permissions because some operation on the database had been performed by root. They had subsequently deleted their db.lck file so the database did not boot READ ONLY as it would if the root owned db.lck file still existed and the symptom was that they got this error on shutdown.Clearly this was user error  but it would have been good if we gave a better error message. To reproduce on Linux:As a user with umask 0022  run the program java MakeDBthis will make the databases wombat and create a table.su rootwith umask 0022  run the program to insert data and remove the db.lck file:java InsertALotrm wombat/db.lckgo back to the original userrun the program:java ConnectAndShutdownThe application gets the normal shutdown exception but if you look in derby.log you will see the exception.java.lang.NullPointerException at org.apache.derby.impl.store.raw.log.LogToFile.flush(LogToFile.java:3964) ...I will attach the files.,1,0
BTreeController.comparePreviousRecord() may fail to release latch on left-most leaf,If comparePreviousRecord() is called on some other leaf page than the left-most leaf  and all the rows to the left of the current position are deleted so that the position is moved all the way to slot 0 on the left-most leaf  comparePreviousRecord() will return without releasing the latch on the left-most leaf. Only the leaf on which comparePreviousRecord() is called should be latched when the method returns.Since comparePreviousRecord() currently fails to continue after finding a deleted row  this bug is not possible to expose until DERBY-4028 is fixed.,0,0
BTreeScan.delete() throws AM_RECORD_NOT_FOUND if record is found,The code below is from BTreeScan.delete(). If the call to reposition() manages to position on the row  an exception is raised indicating that the row could not be found. If the row is not found  no exception is raised  but code later in the method will probably throw a NullPointerException because scan_position.current_leaf is set to null by reposition(). I believe that 'if (reposition(...))' should be changed to 'if (!reposition(...))'. According to the test coverage reports  this code is not exercised by any of the existing tests. if (latch_released) { // lost latch on page in order to wait for row lock. // Because we have scan lock on page  we need only // call reposition() which will use the saved record // handle to reposition to the same spot on the page. // We don't have to search the // tree again  as we have the a scan lock on the page // which means the current_rh is valid to reposition on. if (reposition(scan_position  false)) { throw StandardException.newException( SQLState.AM_RECORD_NOT_FOUND  new Long(err_containerid)  new Long(scan_position.current_rh.getId())); } } },0,0
It should be possible to run unit tests right after 'ant all',Right now  the property 'derby.junit.classpath' is empty by default. There should be an ant target which sets the correct classpath to run all tests after an initial checkout and 'ant all'.The current situation is very confusing to beginners and people who try to build Derby for the first time. For example  when running the tests  I got this exception:java.lang.ClassNotFoundException: org.apache.derbyTesting.junit.EnvTestbut that class was there  the file was there  everything was correct. Googling for the error didn't turn anything up  either. It took me a while to believe that build.xml just wouldn't try to setup a classpath for the tests.,0,0
Trigger  fails with ERROR 38000: The exception 'java.sql.SQLException: ResultSet not open  during VTIResultSet.getNextRowCore(),I don't have a reproduction without the user database yet  but it seems that recompiling the trigger stored prepared statements on upgrade is causing a result set to get closed and is causing the following error when firing a trigger in a global transaction. The holdability in an XA transaction is CLOSE_CURSORS_AT_COMMIT so it may be that there is a commit occurring as part of the process that is causing the problem. I haven't tried yet with a regular transaction and using default holdability CLOSE_CURSORS_AT_COMMIT. The error comes on a delete which fires an after delete statement trigger to insert some values into another table.Here is the stack trace:2009-03-13 14:10:49.375 GMT Thread&#91;main 5 main&#93; (XID = 1853834)  (SESSIONID = 1)  (DATABASE = derby/wpsdb)  (DRDAID = null)  Cleanup action starting2009-03-13 14:10:49.375 GMT Thread&#91;main 5 main&#93; (XID = 1853834)  (SESSIONID = 1)  (DATABASE = derby/wpsdb)  (DRDAID = null)  Failed Statement is: DELETE FROM XXX WHERE WSID=9ERROR 38000: The exception 'java.sql.SQLException: ResultSet not open. Operation 'next' not permitted. Verify that autocommit is OFF.' was thrown while evaluating an expression. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:294) at org.apache.derby.iapi.error.StandardException.unexpectedUserException(StandardException.java:554) at org.apache.derby.impl.sql.execute.VTIResultSet.getNextRowCore(VTIResultSet.java:326) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:255) at org.apache.derby.impl.sql.execute.NestedLoopJoinResultSet.getNextRowCore(NestedLoopJoinResultSet.java:116) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:255) at org.apache.derby.impl.sql.execute.NormalizeResultSet.getNextRowCore(NormalizeResultSet.java:186) at org.apache.derby.impl.sql.execute.DMLWriteResultSet.getNextRowCore(DMLWriteResultSet.java:127) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:496) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:173) at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80) at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278) at org.apache.derby.impl.sql.execute.DeleteResultSet.fireAfterTriggers(DeleteResultSet.java:479) at org.apache.derby.impl.sql.execute.DeleteResultSet.open(DeleteResultSet.java:167) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1203) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:596) at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(EmbedStatement.java:176) at org.apache.derby.iapi.jdbc.BrokeredStatement.executeUpdate(BrokeredStatement.java:113) at ReproRSClosed.main(ReproRSClosed.java:20)Caused by: java.sql.SQLException: ResultSet not open. Operation 'next' not permitted. Verify that autocommit is OFF. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:94) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:173) at org.apache.derby.impl.jdbc.EmbedConnection.newSQLException(EmbedConnection.java:2244) at org.apache.derby.impl.jdbc.ConnectionChild.newSQLException(ConnectionChild.java:151) at org.apache.derby.impl.jdbc.EmbedResultSet.checkIfClosed(EmbedResultSet.java:4280) at org.apache.derby.impl.jdbc.EmbedResultSet.checkExecIfClosed(EmbedResultSet.java:4292) at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:404) at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:388) at org.apache.derby.impl.sql.execute.VTIResultSet.getNextRowCore(VTIResultSet.java:308) ... 18 moreCaused by: java.sql.SQLException: ResultSet not open. Operation 'next' not permitted. Verify that autocommit is OFF. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:135) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70) ... 28 more============= begin nested exception  level (1) ===========java.sql.SQLException: ResultSet not open. Operation 'next' not permitted. Verify that autocommit is OFF. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:94) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:173) at org.apache.derby.impl.jdbc.EmbedConnection.newSQLException(EmbedConnection.java:2244) at org.apache.derby.impl.jdbc.ConnectionChild.newSQLException(ConnectionChild.java:151) at org.apache.derby.impl.jdbc.EmbedResultSet.checkIfClosed(EmbedResultSet.java:4280) at org.apache.derby.impl.jdbc.EmbedResultSet.checkExecIfClosed(EmbedResultSet.java:4292) at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:404) at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:388) at org.apache.derby.impl.sql.execute.VTIResultSet.getNextRowCore(VTIResultSet.java:308) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:255) at org.apache.derby.impl.sql.execute.NestedLoopJoinResultSet.getNextRowCore(NestedLoopJoinResultSet.java:116) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:255) at org.apache.derby.impl.sql.execute.NormalizeResultSet.getNextRowCore(NormalizeResultSet.java:186) at org.apache.derby.impl.sql.execute.DMLWriteResultSet.getNextRowCore(DMLWriteResultSet.java:127) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:496) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:173) at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80) at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278) at org.apache.derby.impl.sql.execute.DeleteResultSet.fireAfterTriggers(DeleteResultSet.java:479) at org.apache.derby.impl.sql.execute.DeleteResultSet.open(DeleteResultSet.java:167) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1203) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:596) at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(EmbedStatement.java:176) at org.apache.derby.iapi.jdbc.BrokeredStatement.executeUpdate(BrokeredStatement.java:113) at ReproRSClosed.main(ReproRSClosed.java:20)Caused by: java.sql.SQLException: ResultSet not open. Operation 'next' not permitted. Verify that autocommit is OFF. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:135) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70) ... 28 more============= end nested exception  level (1) ======================== begin nested exception  level (2) ===========java.sql.SQLException: ResultSet not open. Operation 'next' not permitted. Verify that autocommit is OFF. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:135) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:94) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:173) at org.apache.derby.impl.jdbc.EmbedConnection.newSQLException(EmbedConnection.java:2244) at org.apache.derby.impl.jdbc.ConnectionChild.newSQLException(ConnectionChild.java:151) at org.apache.derby.impl.jdbc.EmbedResultSet.checkIfClosed(EmbedResultSet.java:4280) at org.apache.derby.impl.jdbc.EmbedResultSet.checkExecIfClosed(EmbedResultSet.java:4292) at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:404) at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:388) at org.apache.derby.impl.sql.execute.VTIResultSet.getNextRowCore(VTIResultSet.java:308) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:255) at org.apache.derby.impl.sql.execute.NestedLoopJoinResultSet.getNextRowCore(NestedLoopJoinResultSet.java:116) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:255) at org.apache.derby.impl.sql.execute.NormalizeResultSet.getNextRowCore(NormalizeResultSet.java:186) at org.apache.derby.impl.sql.execute.DMLWriteResultSet.getNextRowCore(DMLWriteResultSet.java:127) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:496) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:173) at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80) at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278) at org.apache.derby.impl.sql.execute.DeleteResultSet.fireAfterTriggers(DeleteResultSet.java:479) at org.apache.derby.impl.sql.execute.DeleteResultSet.open(DeleteResultSet.java:167) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1203) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:596) at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(EmbedStatement.java:176) at org.apache.derby.iapi.jdbc.BrokeredStatement.executeUpdate(BrokeredStatement.java:113) at ReproRSClosed.main(ReproRSClosed.java:20)============= end nested exception  level (2) ===========Cleanup action completed,0,0
'testMixedInsertDelete(org.apache.derbyTesting.functionTests.tests.lang.NullableUniqueConstraintTest)org.apache.derby.client.am.BatchUpdateException',Seen twice....See http://dbtg.thresher.com/derby/test/trunk15/jvm1.5/testing/testlog/SunOS-5.9_sun4u-sparc/754716-org.apache.derbyTesting.functionTests.suites.All_diff.txthttp://dbtg.thresher.com/derby/test/trunk15/jvm1.5/testing/testlog/SunOS-5.10_i86pc-i386/753342-org.apache.derbyTesting.functionTests.suites.All_diff.txt1) testMixedInsertDelete(org.apache.derbyTesting.functionTests.tests.lang.NullableUniqueConstraintTest)org.apache.derby.client.am.BatchUpdateException: Non-atomic batch failure. The batch was submitted  but at least one exception occurred on an individual member of the batch. Use getNextException() to retrieve the exceptions for specific batched elements. at org.apache.derby.client.am.Agent.endBatchedReadChain(Unknown Source) at org.apache.derby.client.am.PreparedStatement.executeBatchRequestX(Unknown Source) at org.apache.derby.client.am.PreparedStatement.executeBatchX(Unknown Source) at org.apache.derby.client.am.PreparedStatement.executeBatch(Unknown Source) at org.apache.derbyTesting.functionTests.tests.lang.NullableUniqueConstraintTest.testMixedInsertDelete(NullableUniqueConstraintTest.java:481) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:105) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57),0,0
Provide a way to drop statistics information,Now that DERBY-269 has been resolved  users can update statistics  but once they do  they are committed to using and maintaining the statistics  even if it doesn't improve performance or they have difficulty maintaining the statistics on a regular basis. It would be good to have a way to drop statistics information so that users could revert to the prior behavior if needed.,0,0
SYSCS_UTIL.SYSCS_UPDATE_STATISTICS should update the store estimated row count for the table,When SYSCS_UTIL.SYSCS_UPDATE_STATISTICS is run  it doesn't update the store estimated row count. The program oldSelectivity.java attached to DERBY-3955 shows that the statistics are not updated.See discussions in DERBY-3955https://issues.apache.org/jira/browse/DERBY-3955?focusedCommentId=12688789&amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12688789https://issues.apache.org/jira/browse/DERBY-3955?focusedCommentId=12688813&amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12688813,0,0
derbyclient.jar is not a complete OSGi bundle,The manifest in derbyclient.jar is incomplete for usage in OSGi. There are no packages exported. This appears to only be a problem in standalone equinox (outside of eclipse). Note that I did not try other OSGi containers.The fix is relatively simple. Adding the Export-Package manifest header should take care of the problem.,0,0
The in-memory storage back end doesn't work on Windows,Bug reported by Knut Magne Solem  see DERBY-646.Using the in-memory storage back end fails on Windows (i.e. connect 'jdbc:derby:memory:MyDbTest;create=true'; from ij):ERROR XJ001: Java exception: 'ASSERT FAILED serviceName = memory:C:/Documents and Settings/user/workspace/derby/MyDbTest;storageFactory.getCanonicalName() = C:/Documents and Settings/user/workspace/derby/MyDbTest: org.apache.derby.shared.common.sanity.AssertFailure'.With an insane build  the error messages will look like this:ERROR XJ041: Failed to create database 'memory:myDB'  see the next exception for details.ERROR XBM01: Startup failed due to an exception. See next exception for details.ERROR XSTB2: Cannot log transaction changes  maybe trying to write to a read only database.The error occurs during boot  which means Windows users are unable to use the in-memory back end at all.,0,1
'testTableFunctionInJar' fails w/ 'The class 'DummyVTI' does not exist or is inaccessible...' on jvm1.4,Seen in tests on jvm1.4 since ~ svn rev. 759509See e.g.http://dbtg.thresher.com/derby/test/Daily/jvm1.4/testing/Limited/testSummary-759509.htmlE.g.:1) testTableFunctionInJar(org.apache.derbyTesting.functionTests.tests.lang.DatabaseClassLoadingTest)java.sql.SQLException: The class 'DummyVTI' does not exist or is inaccessible. This can happen if the class is not public. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.seeNextException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeQuery(Unknown Source) at org.apache.derbyTesting.functionTests.tests.lang.DatabaseClassLoadingTest.testTableFunctionInJar(DatabaseClassLoadingTest.java:1045) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:105) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)Caused by: java.sql.SQLException: Java exception: 'DummyVTI : DummyVTI (Unsupported major.minor version 49.0): java.lang.ClassNotFoundException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) ... 38 moreCaused by: java.lang.ClassNotFoundException: DummyVTI : DummyVTI (Unsupported major.minor version 49.0) at org.apache.derby.impl.services.reflect.DatabaseClasses.loadApplicationClass(Unknown Source) at org.apache.derby.iapi.services.loader.ClassInspector.getClass(Unknown Source) at org.apache.derby.iapi.services.loader.ClassInspector.accessible(Unknown Source) at org.apache.derby.impl.sql.compile.QueryTreeNode.verifyClassExist(Unknown Source) at org.apache.derby.impl.sql.compile.StaticMethodCallNode.bindExpression(Unknown Source) at org.apache.derby.impl.sql.compile.JavaToSQLValueNode.bindExpression(Unknown Source) at org.apache.derby.impl.sql.compile.ResultColumn.bindExpression(Unknown Source) at org.apache.derby.impl.sql.compile.ResultColumnList.bindExpressions(Unknown Source) at org.apache.derby.impl.sql.compile.RowResultSetNode.bindExpressions(Unknown Source) at org.apache.derby.impl.sql.compile.DMLStatementNode.bindExpressions(Unknown Source) at org.apache.derby.impl.sql.compile.DMLStatementNode.bind(Unknown Source) at org.apache.derby.impl.sql.compile.CursorNode.bindStatement(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source) ... 34 more,0,0
java.lang.VerifyError causing java.sql.SQLException: Cannot create an instance of generated class ... in lang.GeneratedColumnsTest and GeneratedColumnsPermsTest  on IBM iseries,This results in 22 errors.Here's the stack trace with an insane build:1) test_005_basicInsert(org.apache.derbyTesting.functionTests.tests.lang.GeneratedColumnsTest)java.sql.SQLException: Cannot create an instance of generated class org.apache.derby.exe.acd83d18d1x0120x62bdx2dffxffffb19003081. at java.lang.Throwable.&lt;init&gt;(Throwable.java:196) at java.lang.Exception.&lt;init&gt;(Exception.java:41) at java.sql.SQLException.&lt;init&gt;(SQLException.java:40) at org.apache.derby.impl.jdbc.EmbedSQLException.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.seeNextException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&lt;init&gt;(Unknown Source) at org.apache.derby.jdbc.Driver30.newEmbedPreparedStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source) at org.apache.derbyTesting.functionTests.tests.lang.GeneratedColumnsHelper.chattyPrepare(GeneratedColumnsHelper.java:147) at org.apache.derbyTesting.functionTests.tests.lang.GeneratedColumnsHelper.goodStatement(GeneratedColumnsHelper.java:125) at org.apache.derbyTesting.functionTests.tests.lang.GeneratedColumnsTest.test_005_basicInsert(GeneratedColumnsTest.java:427) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:105) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)Caused by: java.sql.SQLException: Java exception: 'org/apache/derby/exe/acd83d18d1x0120x62bdx2dffxffffb19003081 0000 0000 : java.lang.VerifyError'. at java.lang.Throwable.&lt;init&gt;(Throwable.java:196) at java.lang.Exception.&lt;init&gt;(Exception.java:41) at java.sql.SQLException.&lt;init&gt;(SQLException.java:40) at org.apache.derby.impl.jdbc.EmbedSQLException.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) ... 43 moreCaused by: java.lang.VerifyError: org/apache/derby/exe/acd83d18d1x0120x62bdx2dffxffffb19003081 0000 0000  at java.lang.Throwable.&lt;init&gt;(Throwable.java:196) at java.lang.Error.&lt;init&gt;(Error.java:49) at java.lang.VerifyError.&lt;init&gt;(VerifyError.java:34) at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39) at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27) at java.lang.reflect.Constructor.newInstance(Constructor.java:494) at org.apache.derby.iapi.services.loader.ClassInfo.getNewInstance(Unknown Source) at org.apache.derby.impl.services.reflect.LoadedGeneratedClass.newInstance(Unknown Source) at org.apache.derby.impl.services.reflect.ReflectGeneratedClass.newInstance(Unknown Source) at org.apache.derby.impl.sql.GenericActivationHolder.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.getActivation(Unknown Source) ... 39 more,0,0
NullPointerException in system.sttest run with 10.5.1.0,I see the following stack trace on line 22615 of the redirected output:Thread finished: 1complete initial datatotal memory: 50713600 free: 3130088 Tue Mar 31 23:39:47 PDT 2009java.lang.NullPointerException at org.apache.derbyTesting.system.sttest.utils.Datatypes.update_one_row(Datatypes.java:612) at org.apache.derbyTesting.system.sttest.Sttest.run(Sttest.java:387)Exception in thread 'Thread-9' java.lang.NullPointerException at org.apache.derbyTesting.system.sttest.Sttest.run(Sttest.java:435)java.lang.NullPointerException at org.apache.derbyTesting.system.sttest.utils.Datatypes.update_one_row(Datatypes.java:612) at org.apache.derbyTesting.system.sttest.Sttest.run(Sttest.java:387)Exception in thread 'Thread-10' java.lang.NullPointerException at org.apache.derbyTesting.system.sttest.Sttest.run(Sttest.java:435)java.lang.NullPointerException at org.apache.derbyTesting.system.sttest.utils.Datatypes.update_one_row(Datatypes.java:612) at org.apache.derbyTesting.system.sttest.Sttest.run(Sttest.java:387)Exception in thread 'Thread-11' java.lang.NullPointerException at org.apache.derbyTesting.system.sttest.Sttest.run(Sttest.java:435)quantity in pick_some is: 10 rows deletedMatching this up with the derby.log - the first entry in derby.log is 2009-04-01 03:01:52.432 GMT  and ls -al shows 2009-03-31 20:01 PDT for the creation of testDB  so time diff was 7 hours - shows nothing of interest. The last entry in derby.log is at 2009-04-01 06:52:15.595 GMT  so only 3 hours later.I've seen the same thing 3 times - this needs to be analyzed further.I will also run on another machine  and run with sane jars to see if we get any stack trace of other help from derby.log.,0,0
Create a test to verify that virgin metadata is identical to hard-upgraded metadata,We should write a test to verify that the metadata is correct for each release for all hard-upgrade trajectories which terminate in that release. The test should examine all system tables. Note that if there are N releases  then there will (2&lt;sup&gt;N&lt;/sup&gt; - N) - 1 trajectories to examine.,0,0
improvements to the mailjdbc test,When recently working with the mailjdbc system test org.apache.derbyTesting.system.mailjdbc on DERBY-4152 I noticed some potential improvements that might be good for the test. We should probably hold off on these improvements however until the root cause of DERBY-4152 is established  however  so we don't muddy the waters with that issue by changing the test.1) DbTasks.moveToFolders may throw an IllegalArgumentException. There is a line: message_id = Rn.nextInt(count - 1); if count is 1 the argument to nextInt() might be 0 which is not allowed. I hit this once but lost the stack trace  but it is apparent that when there is only one row in the table this can occur.2) Allow/implement multiple attachments per message and cleanup DbTasks.insertMail() logic. Remove the attach_id column from INBOX to allow multiple attachments. -Make the attachment insert part of the message for loop in insertMail. Use getGeneratedKeys() to get the id of the inserted message. When attachments are inserted  insert (1-4) attachments and give them a corresponding attach_id from 1-4.This will allow for removal of the select statements used to determine id and attach_id. I'll file another issue for these improvements if folks agree that they are sensible.A detailed description of the current implementation of insertMail is described at https://issues.apache.org/jira/secure/attachment/12405685/insertMailSummary.txt3) DbTasks.databaseSize calculation is wrong. It doesn't match du -sk. The method does not recurse into subdirectories and includes the length() on directory files which is undefined accourding to the file.length() javadoc.,0,0
'No method was found that matched the method call ....' in testPayment and testSubmitter (org.apache.derbyTesting.system.oe.test.OperationsTester) on 10.5.1.1 (RC2),Seen when running testPayment(org.apache.derbyTesting.system.oe.test.OperationsTester) with 10.5.1.1 (RC2).The test passed with no failures on 10.4.2.0.1) testPayment(org.apache.derbyTesting.system.oe.test.OperationsTester)java.sql.SQLSyntaxErrorException: No method was found that matched the method call org.apache.derbyTesting.system.oe.routines.Data.dataForBadCredit(java.lang.String  short  short  short  short  int  java.math.BigDecimal)  tried all combinations of object and primitive types and any possible type conversion for any parameters the method call may have. The method might exist but it is not public and/or static  or the parameter types are not method invocation convertible. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement40.&lt;init&gt;(Unknown Source) at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source) at org.apache.derbyTesting.system.oe.direct.StatementHelper.prepareStatement(StatementHelper.java:76) at org.apache.derbyTesting.system.oe.direct.Standard.paymentById(Standard.java:420) at org.apache.derbyTesting.system.oe.direct.Standard.payment(Standard.java:375) at org.apache.derbyTesting.system.oe.test.OperationsTester.testPayment(OperationsTester.java:134) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:105) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)2) testSubmitter(org.apache.derbyTesting.system.oe.test.OperationsTester)java.sql.SQLSyntaxErrorException: No method was found that matched the method call org.apache.derbyTesting.system.oe.routines.Data.dataForBadCredit(java.lang.String  short  short  short  short  int  java.math.BigDecimal)  tried all combinations of object and primitive types and any possible type conversion for any parameters the method call may have. The method might exist but it is not public and/or static  or the parameter types are not method invocation convertible. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement40.&lt;init&gt;(Unknown Source) at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source) at org.apache.derbyTesting.system.oe.direct.StatementHelper.prepareStatement(StatementHelper.java:76) at org.apache.derbyTesting.system.oe.direct.Standard.paymentById(Standard.java:420) at org.apache.derbyTesting.system.oe.direct.Standard.payment(Standard.java:395) at org.apache.derbyTesting.system.oe.client.Submitter.runPayment(Submitter.java:437) at org.apache.derbyTesting.system.oe.client.Submitter.runTransaction(Submitter.java:316) at org.apache.derbyTesting.system.oe.test.OperationsTester.testSubmitter(OperationsTester.java:259) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:105) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)Related to DERBY-1483  DERBY-3119  DERBY-2179  DERBY-3652?,0,0
Connections to on-disk db go to in-memory db if in-memory db with same name is booted,When an in-memory database has been booted  subsequent attempts to connect to an ordinary (on-disk) database with the same name as the in-memory database will connect to the in-memory db.ij version 10.5ij&gt; connect 'jdbc:derby:memory:MyDB;create=true'; &#8211; with subprotocol memoryij&gt; create table t (x varchar(30));0 rows inserted/updated/deletedij&gt; insert into t values 'This is the in-memory backend';1 row inserted/updated/deletedij&gt; connect 'jdbc:derby:MyDB;create=true'; --without subprotocol memory  should create disk dbWARNING 01J01: Database 'MyDB' not created  connection made to existing database instead.ij(CONNECTION1)&gt; select * from t;X ------------------------------This is the in-memory backend 1 row selected,0,0
Javadoc for BTreeLockingPolicy should not mention 'scan lock' anymore,The javadoc for BTreeLockingPolicy still talks about scan locks  although the scan lock is no longer in use after DERBY-2991. The javadoc should be updated so that it reflects the current state of the code.,0,0
bootLock.java fails with missing exception on z/OS with  pmz3160sr2ifix-20081021_01(SR2+IZ32776+IZ33456)  and Windows Vista,I saw this diff in store/bootLock.java. I did not see it with the 64bit jvm run on 10.5.1.0 RC1     Start: bootLock jdk1.6.0 storeall:storemore 2009-04-21 19:10:18 ***2 4d1&lt; expected exception&lt; SQLSTATE(XJ040):&lt; SQLSTATE(XSDB6):Test Failed. End: bootLock jdk1.6.0 storeall:storemore 2009-04-21 19:11:00 ***    The test passed on rerun when run independently.,0,0
Convert altertable.sql to JUnit,Converting altertable.sql harness test to JUnit,0,0
When using the FOR UPDATE OF clause with SUR (Scroll-insensive updatable result sets)  the updateRow() method crashes,This problem occurs on both Client/Server and Embedded.With the Embedded driver  the JVM crashes with the following error:------------------------------------8&lt;-----------------------------------1) testReproduction(org.apache.derbyTesting.functionTests.tests.store.ReproHoldCursorBug)org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED statementContext is not expected to equal statementContexts&#91;0&#93; at org.apache.derby.shared.common.sanity.SanityManager.ASSERT(SanityManager.java:120) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.popStatementContext(GenericLanguageConnectionContext.java:2286) at org.apache.derby.impl.jdbc.EmbedResultSet.updateRow(EmbedResultSet.java:3740) at org.apache.derbyTesting.functionTests.tests.store.ReproHoldCursorBug.testReproduction(ReproHoldCursorBug.java:71) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:105) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)-----------------------------------8&lt;--------------------------------------------(It shows a stack trace after this  but I'm attaching the result folders since those are more thorough.)&#91;1&#93;On the client driver  the JVM does not crash but it also errors out:1) testReproduction(org.apache.derbyTesting.functionTests.tests.store.ReproHoldCursorBug)java.sql.SQLException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XJ001  SQLERRMC: java.lang.NullPointerExceptionXJ001.U(more detail on the log files)&#91;2&#93;The error does not show as long as the 'OF DATA' isn't specified. It also won't show if the whole FOR UPDATE clause is omitted.I would also like some comments and advice on how to proceed on converting holdCursorJDBC30.sql as it is affected by this problem. The original test does an update on a cursor with the 'FOR UPDATE OF DATA' clause  and this isn't working on the Java version of the test. Do I go around it by removing the FOR UPDATE clause or should I wait for this bug to get fixed?Attachments:&#91;1&#93; - ErrorOutput_Embedded.tar.gz - Error output files of the Embedded run&#91;2&#93; - ErrorOutput_Client.tar.gz - Error output files of the Client/Server run&#91;3&#93; - ReproHoldCursorBug.java - The reproduction of the errors,0,0
SecureServerTest AssertionFailedError: Timed out waiting for network server to start,I saw this failure in the nightly run on 4/27 on the 10.5 branch - 10.5.1.2 - (769232). I have not seen it in previous runs on the same machine. There were actually two failures in the test. I think the second one failed because of the first so am not reporting a separate issue for that.There were 2 failures:1) SecureServerTest( Opened = false  Authenticated= false  CustomDerbyProperties= null  WildCardHost= null )junit.framework.AssertionFailedError: Timed out waiting for network server to start:Spawned SpawnedNetworkServer exitCode=0 at org.apache.derbyTesting.junit.NetworkServerTestSetup.setUp(NetworkServerTestSetup.java:200) at junit.extensions.TestSetup$1.protect(TestSetup.java:18) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)2) SecureServerTest( Opened = false  Authenticated= false  CustomDerbyProperties= functionTests/tests/derbynet/SecureServerTest.derby.properties  WildCardHost= null )junit.framework.AssertionFailedError: directory trace does not exist at org.apache.derbyTesting.functionTests.tests.derbynet.SecureServerTest.setTraceDirectory(SecureServerTest.java:386) at org.apache.derbyTesting.functionTests.tests.derbynet.SecureServerTest.testServerStartup(SecureServerTest.java:358) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:85) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:58) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java(Compiled Code)) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:105) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23),1,0
'Table/View 'MAX_SCAN' does not exist' in org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest,See e.g. http://dbtg.thresher.com/derby/test/trunk15/jvm1.5/testing/testlog/Linux-2.6.9-34.ELsmp_x86_64-x86_64/772381-org.apache.derbyTesting.functionTests.suites.All_diff.txtThere were 2 errors:1) testMultipleLastKeyWaitsInMaxScan(org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest)java.sql.SQLException: Table/View 'MAX_SCAN' does not exist. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(Unknown Source) at org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest$3.doWork(IndexSplitDeadlockTest.java:590) at org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest$AsyncThread.run(IndexSplitDeadlockTest.java:769) at java.lang.Thread.run(Thread.java:595)Caused by: ERROR 42X05: Table/View 'MAX_SCAN' does not exist. at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.impl.sql.compile.DMLModStatementNode.verifyTargetTable(Unknown Source) at org.apache.derby.impl.sql.compile.InsertNode.bindStatement(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.rePrepare(Unknown Source) ... 6 more2) testMultiplePrevKeyWaitsInForwardScan(org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest)java.sql.SQLException: Table/View 'FW_SCAN' does not exist. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(Unknown Source) at org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest$4.doWork(IndexSplitDeadlockTest.java:665) at org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest$AsyncThread.run(IndexSplitDeadlockTest.java:769) at java.lang.Thread.run(Thread.java:595)Caused by: ERROR 42X05: Table/View 'FW_SCAN' does not exist. at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.impl.sql.compile.DMLModStatementNode.verifyTargetTable(Unknown Source) at org.apache.derby.impl.sql.compile.InsertNode.bindStatement(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.rePrepare(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) ... 6 moreor http://dbtg.thresher.com/derby/test/Daily/jvm1.5/testing/testlog/lin/772336-suitesAll_diff.txt or http://dbtg.thresher.com/derby/test/Daily/jvm1.5/testing/testlog/sles/772336-suitesAll_diff.txt or http://dbtg.thresher.com/derby/test/Daily/javaME/testing/testlog/ubuntu/772336-suitesAll_diff.txt,0,0
Remove unused pre-i18n constructors in BatchUpdateException,client.am.BatchUpdateException contains a number of unused constructors. There is a comment saying that they should be removed when i18n is complete. Since the i18n work on the client driver has been completed  and the constructors are no longer used  they should be removed.,0,0
XAResource.setTransactionTimeout() makes XAResource.start() fail with the client driver,Got below error message when running an XA prolgram with derby. org.apache.derby.client.am.XaException: XAER_PROTO : Error executing a XAResource.start()  server returned XAER_PROTO. at org.apache.derby.client.net.NetXAResource.throwXAException(Unknown Source) at org.apache.derby.client.net.NetXAResource.start(Unknown Source) at TestDerbyXA.process(TestDerbyXA.java:186) at TestDerbyXA.main(TestDerbyXA.java:43)Caused by: org.apache.derby.client.am.SqlException: Error executing a XAResource.start()  server returned XAER_PROTO. at org.apache.derby.client.net.NetXAResource.xaRetValErrorAccumSQL(Unknown Source) ... 3 moreBelow is the example program I used. Note: The program will succeed if comment out line 147 - setTransactionTimeout. Does that means call XAResource.setTransactionTimeout() caused the failure?I use Apache Derby Network Server - 10.4.2.0 - (689064). The same program works fine with another version Apache Derby Network Server - 10.2.2.0 - (485682). It looks like there is a regression between the two versions.import java.sql.Connection;import java.sql.PreparedStatement;import java.sql.SQLException;import java.sql.Statement;import javax.sql.XAConnection;import javax.transaction.xa.XAException;import javax.transaction.xa.XAResource;import javax.transaction.xa.Xid;import org.apache.derby.jdbc.ClientXADataSource;public class TestDerbyXA { ClientXADataSource xaDSLocal = null; ClientXADataSource xaDSRemote = null; public TestDerbyXA() { // Create two XA data sources. xaDSLocal = new ClientXADataSource(); xaDSLocal.setServerName('localhost'); xaDSLocal.setPortNumber(1527); xaDSLocal.setDatabaseName('testdb'); xaDSLocal.setUser('app'); xaDSLocal.setPassword('derby'); xaDSRemote = new ClientXADataSource(); xaDSRemote.setServerName('localhost'); xaDSRemote.setPortNumber(1527); xaDSRemote.setDatabaseName('testdb'); xaDSRemote.setUser('app'); xaDSRemote.setPassword('derby'); // xaDSRemote = xaDSLocal; } public static void main(String[] args) throws Exception { TestDerbyXA testObj = new TestDerbyXA(); testObj.dropTable('tablea'); testObj.createTable('CREATE TABLE tablea (col1 INT  col2 VARCHAR(32))'); testObj.dropTable('tableb'); testObj.createTable('CREATE TABLE tableb (col1 INT  col2 VARCHAR(32))'); testObj.process(); } public void dropTable(String tableName) throws Exception { Connection conn = null; Statement stmt = null; try { conn = xaDSLocal.getConnection(); stmt = conn.createStatement(); stmt.executeUpdate('DROP TABLE ' + tableName); System.out.println('Drop table ' + tableName + ' succeed.'); } catch (SQLException sqle) { System.out.println('Drop table ' + tableName + ' failed.'); sqle.printStackTrace(); } finally { // ============ Close JDBC objects  including the connection ======= if (stmt != null) { try { stmt.close(); stmt = null; } catch (SQLException e) { } } if (conn != null) { try { conn.close(); conn = null; } catch (SQLException e) { } } } } public void createTable(String DDL) throws Exception { Connection conn = null; Statement stmt = null; try { conn = xaDSLocal.getConnection(); stmt = conn.createStatement(); stmt.executeUpdate(DDL); System.out.println(DDL + ' succeed.'); } catch (SQLException sqle) { System.out.println(DDL + ' failed.'); sqle.printStackTrace(); } finally { // ============ Close JDBC objects  including the connection ======= if (stmt != null) { try { stmt.close(); stmt = null; } catch (SQLException e) { } } if (conn != null) { try { conn.close(); conn = null; } catch (SQLException e) { } } } } public void process() throws Exception { Connection connLocal = null; Connection connRemote = null; int rows = 0; PreparedStatement pstmtLocal = null; PreparedStatement pstmtRemote = null; XAConnection xaConnLocal = null; XAConnection xaConnRemote = null; XAResource xarLocal = null; XAResource xarRemote = null; Xid xidLocal = null; Xid xidRemote = null; try { xaConnLocal = xaDSLocal.getXAConnection(); xaConnRemote = xaDSRemote.getXAConnection(); connLocal = xaConnLocal.getConnection(); connRemote = xaConnRemote.getConnection(); xarLocal = xaConnLocal.getXAResource(); xarRemote = xaConnRemote.getXAResource(); // Create the Xids // Create the global ID byte[] globalTransactionId1 = new byte[64]; globalTransactionId1[0] = (byte) 1; byte[] globalTransactionId2 = new byte[64]; globalTransactionId2[0] = (byte) 2; // Create the local branch ID byte[] branchQualifierLocal = new byte[64]; branchQualifierLocal[0] = (byte) 1; xidLocal = new XidImpl(globalTransactionId1  branchQualifierLocal  0x1234); // Create the remote branch ID byte[] branchQualifierRemote = new byte[64]; branchQualifierRemote[0] = (byte) 2; xidRemote = new XidImpl(globalTransactionId2  branchQualifierRemote  0x1234); // Database operations on the local branch  suspend local branch xarLocal.setTransactionTimeout(500); //!!! The failure will disappear if comment out this line. connLocal.setAutoCommit(false); xarLocal.start(xidLocal  XAResource.TMNOFLAGS); pstmtLocal = connLocal .prepareStatement('INSERT INTO tablea (col1  col2) VALUES (?  ?)'); pstmtLocal.setInt(1  1); pstmtLocal.setString(2  'insert first rec to tablea'); rows = pstmtLocal.executeUpdate(); System.out.println(rows + ' rows inserted to tablea'); pstmtLocal.close(); pstmtLocal = null; xarLocal.end(xidLocal  XAResource.TMSUCCESS); connLocal.setAutoCommit(true); // Database operation on the remote branch  commit remote branch xarRemote.setTransactionTimeout(500); connRemote.setAutoCommit(false); xarRemote.start(xidRemote  XAResource.TMNOFLAGS); pstmtRemote = connRemote .prepareStatement('INSERT INTO tableb (col1  col2) VALUES (?  ?)'); pstmtRemote.setInt(1  2); pstmtRemote.setString(2  'insert second rec to tableb'); rows = pstmtRemote.executeUpdate(); System.out.println(rows + ' rows inserted to tableb'); pstmtRemote.close(); pstmtRemote = null; xarRemote.end(xidRemote  XAResource.TMSUCCESS); connRemote.setAutoCommit(true); System.out.println('commit remote branch'); xarRemote.commit(xidRemote  true); // Resume the local branch and do some database operation  commit local branch xarLocal.setTransactionTimeout(500); connLocal.setAutoCommit(false); xarLocal.start(xidLocal  XAResource.TMJOIN); pstmtLocal = connLocal .prepareStatement('INSERT INTO tablea (col1  col2) VALUES (?  ?)'); pstmtLocal.setInt(1  3); pstmtLocal.setString(2  'insert third rec to tablea'); rows = pstmtLocal.executeUpdate(); System.out.println(rows + ' rows inserted to tablea'); pstmtLocal.close(); pstmtLocal = null; xarLocal.end(xidLocal  XAResource.TMSUCCESS); connLocal.setAutoCommit(true); System.out.println('commit local branch'); xarLocal.commit(xidLocal  true); // Close the resources connLocal.close(); connLocal = null; connRemote.close(); connRemote = null; xaConnLocal.close(); xaConnLocal = null; xaConnRemote.close(); xaConnRemote = null; } catch (SQLException e) { System.err.println('SQL Error: ' + e.getMessage()); e.printStackTrace(); } catch (XAException e) { System.err.println('XA Error: ' + e.getMessage()); e.printStackTrace(); } finally { if (pstmtLocal != null) try { pstmtLocal.close(); pstmtLocal = null; } catch (SQLException ignore) { } if (pstmtRemote != null) try { pstmtRemote.close(); pstmtRemote = null; } catch (SQLException ignore) { } if (connLocal != null) try { connLocal.close(); connLocal = null; } catch (SQLException ignore) { } if (connRemote != null) try { connRemote.close(); connRemote = null; } catch (SQLException ignore) { } if (xaConnLocal != null) try { xaConnLocal.close(); xaConnLocal = null; } catch (SQLException ignore) { } if (xaConnRemote != null) try { xaConnRemote.close(); xaConnRemote = null; } catch (SQLException ignore) { } } }},0,0
Improve transition from read-only to writable Clob representation,When a store stream Clob is going to be modified  it will be written out to the temporary area of Derby and represented as a TemporaryClob.The transfer of the data is done in a sub-optimal manner for two reasons; o for transfer of the complete Clob  the copy method operates on the byte level and we're not able to save the character length. o for transfer of parts of the Clob (i.e. truncation)  we have to first decode the UTF-8 encoding to find the byte count and then transfer the same bytes.I intend to do the following two changes; 1) Add a getCharLengthIfKnow-method to InternalClob. 2) Add a UTF-8 aware copy method to LOBStreamControl.When a complete Clob is to be copied  code like this will be executed; cachedCharLength = internalClob.getLengthIfKnown(); if (cachedCharLength &gt; 0) // use existing byte-oriented copy method for best performance (copy until EOF) else cachedCharLength = control.copyUTF8Data()When parts of a Clob is to be copied  we always use the UTF-8 aware copy method  but we also do a cheap range check. cachedCharLength = internalClob.getLengthIfKnown(); if (cachedCharLength &gt; 0 &amp;&amp; requestedLength &gt; cachedCharLength) throw EOFException(); if (cachedCharLength == requestedLength) // use existing byte-oriented copy method for best performance (copy until EOF) else cachedCharLength = control.copyUTF8Data(requestedLength);Adding the UTF-8 aware copy method was started under DERBY-4023  including comments on the first revision of a patch.,0,1
convert checkConstraint.sql to JUnit,Converting CheckConstraint.sql to JUnit under supervision of Bryan Pendleton.,0,0
PropertySetter isn't able to recognize JDK without version number in path,With empty ant.properties and JDK 6 installed in /tmp/jdk as the only JDK on the system  PropertySetter complains that it's not able to set java16compile.classpath: ---- &#91;setJdkProperties&#93; &#91;setJdkProperties&#93; PropertySetter environment = &#91;setJdkProperties&#93; &#91;setJdkProperties&#93; java.vendor = Sun Microsystems Inc. &#91;setJdkProperties&#93; java.home = /tmp/jdk/jre &#91;setJdkProperties&#93; java.version = 1.6.0_13 &#91;setJdkProperties&#93; os.name = SunOS &#91;setJdkProperties&#93; j14lib = null &#91;setJdkProperties&#93; j15lib = null &#91;setJdkProperties&#93; j16lib = null &#91;setJdkProperties&#93; BUILD FAILED /code/derby/trunk0/build.xml:203: Don't know how to set java15compile.classpath  java16compile.classpath using this environment: java.vendor = Sun Microsystems Inc. java.home = /tmp/jdk/jre java.version = 1.6.0_13 os.name = SunOS j14lib = null j15lib = null j16lib = null'----Since it is able to detect both that the version of the default JDK is 1.6.0_13 and where it is installed  setting java16compile.classpath should be trivial.If the name of the JDK directory is changed from /tmp/jdk to /tmp/jdk1.6.0  Derby is built successfully.,0,0
A lock could not be obtained within the time requested error in testBTreeForwardScan_fetchRows_resumeAfterWait_nonUnique_split,I recently merged changes for DERBY-3926 into 10.5.1.2 codeline (revision 784809) and I ran the junit tests on the merged code. The tests finished with one 'A lock could not be obtained within the time requested'. Knut suggested that I open a new jira entry for this issue. Copying his comment from DERBY-2991 here 'Yes  that test was added for DERBY-2991.. It requires some coordination between two threads  so my first guess would be that there is a timing issue in the test. Please file a separate JIRA issue for this failure. Thanks. 'Following is the stack track for the failureThere was 1 error: 1) testBTreeForwardScan_fetchRows_resumeAfterWait_nonUnique_split(org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest)java.sql.SQLException: A lock could not be obtained within the time requested  at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)  at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:201)  at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:391)  at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)  at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2201)  at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)  at org.apache.derby.impl.jdbc.EmbedResultSet.closeOnTransactionError(EmbedResultSet.java:4338)  at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:467)  at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:371)  at org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest.testBTreeForwardScan_fetchRows_resumeAfterWait_nonUnique_split(IndexSplitDeadlockTest.java:489)  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:79)  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)  at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:106)  at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)  at junit.extensions.TestSetup$1.protect(TestSetup.java:19)  at junit.extensions.TestSetup.run(TestSetup.java:23)  at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)  at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)  at junit.extensions.TestSetup$1.protect(TestSetup.java:19)  at junit.extensions.TestSetup.run(TestSetup.java:23)  at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) Caused by: ERROR 40XL1: A lock could not be obtained within the time requested at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:276)  at org.apache.derby.impl.services.locks.ConcurrentLockSet.lockObject(ConcurrentLockSet.java:602)  at org.apache.derby.impl.services.locks.ConcurrentLockSet.zeroDurationLockObject(ConcurrentLockSet.java:855)  at org.apache.derby.impl.services.locks.AbstractPool.zeroDurationlockObject(AbstractPool.java:297)  at org.apache.derby.impl.store.raw.xact.RowLocking2nohold.lockRecordForRead(RowLocking2nohold.java:89)  at org.apache.derby.impl.store.access.heap.HeapController.lockRow(HeapController.java:520)  at org.apache.derby.impl.store.access.heap.HeapController.lockRow(HeapController.java:638)  at org.apache.derby.impl.store.access.btree.index.B2IRowLocking3.lockRowOnPage(B2IRowLocking3.java:309)  at org.apache.derby.impl.store.access.btree.index.B2IRowLocking3._lockScanRow(B2IRowLocking3.java:599)  at org.apache.derby.impl.store.access.btree.index.B2IRowLockingRR.lockScanRow(B2IRowLockingRR.java:105)  at org.apache.derby.impl.store.access.btree.BTreeForwardScan.fetchRows(BTreeForwardScan.java:305)  at org.apache.derby.impl.store.access.btree.BTreeScan.fetchNextGroup(BTreeScan.java:1585)  at org.apache.derby.impl.sql.execute.BulkTableScanResultSet.reloadArray(BulkTableScanResultSet.java:327)  at org.apache.derby.impl.sql.execute.BulkTableScanResultSet.getNextRowCore(BulkTableScanResultSet.java:282)  at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(BasicNoPutResultSetImpl.java:460)  at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:427)  ... 34 more FAILURES!!! Tests run: 9258  Failures: 0  Errors: 1,0,0
SYSCS_UPDATE_STATISTICS takes unnecessary table lock,I'm using SYSCS_UTIL.SYSCS_UPDATE_STATISTICS in an application and see deadlocks similar to this one from time to time:Caused by: java.sql.SQLTransactionRollbackException: A lock could not be obtained due to a deadlock  cycle of locks and waiters is:Lock : ROW  SYSSTATISTICS  (2 20) Waiting XID : {20137  S}   APP  SELECT CS.REVISION  A.NAME  CS.TIME  CS.MESSAGE  F2.PATH FROM CHANGESETS CS  FILECHANGES FC  REPOSITORIES R  FILES F  AUTHORS A  FILECHANGES FC2  FILES F2 WHERE R.PATH = ? AND F.PATH LIKE ? ESCAPE '#' AND F.REPOSITORY = R.ID AND A.REPOSITORY = R.ID AND CS.ID = FC.CHANGESET AND R.ID = CS.REPOSITORY AND FC.FILE = F.ID AND A.ID = CS.AUTHOR AND CS.ID = FC2.CHANGESET AND FC2.FILE = F2.ID ORDER BY CS.ID DESC Granted XID : {20134  X} Lock : TABLE  CHANGESETS  Tablelock Waiting XID : {20134  X}   APP  alter table 'APP'.'CHANGESETS' all update statistics  Granted XID : {20137  IS} . The selected victim is XID : 20137.Here  a select statement is being re-prepared because update statistics has invalidated it  but it has to wait for update statistics to finish in order to read the new statistics from SYSSTATISTICS. Then update statistics attempts to obtain an exclusive lock on the table whose indexes are being updated  but it has to wait because the select statement is holding an intention lock on the table. Both transactions wait for each other  so we have a deadlock.Since SYSCS_UPDATE_STATISTICS does not update the table  only its entries in SYSSTATISTICS  there is no need to take an exclusive table lock. If it didn't lock the table exclusively  this deadlock situation would go away.,0,0
Update demo's to remove references to com.ibm.db2.jcc.DB2Driver,SimpleApp.java is still refering to DB2 JDBC driver. I think it should be take out to reflect DB2 driver is no longer supported.There are also some typos in SimpleApp.java. i.e. noone  retreiving  etc.example.html that should be updated as well.Kathey mention nserverdemo also has references to the DB2 driver. This issue will address that as well.,1,0
10.6 Upgrade test fails: SYSCS_UTIL.SYSCS_SET_XPLAIN_SCHEMA is not recognized as a function,The 10.6 upgrade tests are currently commented out. When the 10.6 upgrade test is enabled  it fails with the following exception:Caused by: java.sql.SQLException: 'SYSCS_UTIL.SYSCS_SET_XPLAIN_SCHEMA' is not recognized as a function or procedure. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70) ... 98 moreCaused by: ERROR 42Y03: 'SYSCS_UTIL.SYSCS_SET_XPLAIN_SCHEMA' is not recognized as a function or procedure. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286) at org.apache.derby.impl.sql.compile.StaticMethodCallNode.bindExpression(StaticMethodCallNode.java:216) at org.apache.derby.impl.sql.compile.JavaToSQLValueNode.bindExpression(JavaToSQLValueNode.java:246) at org.apache.derby.impl.sql.compile.CallStatementNode.bindStatement(CallStatementNode.java:145) at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:316) at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:88) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:822) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:606) ... 92 more,0,0
All Columns become Nullable when Using left join,Consider following:-create table person ( id varchar(20) not null  name varchar(100) not null);create table car ( id varchar(20) not null  person_id varchar(20) not null  model varchar(100) not null  plat_no varchar(100) not null);When select :-selectp.name c.model c.plat_nofrom person pleft join car c on (p.id = c.person_id);From the ResultSet  get the ResultSetMetaData and inspect each column's isNullable() value  which is always = 1 (always nullable). Expected : column 'p.name' isNullable = 0 (not nullable)  but I get 'p.name' isNullable = 1 (nullable),0,0
creation of FileInputStream in org.apache.derby.impl.tools.ij.Main not wrapped in privilege  block which can cause problems running under SecurityManager,org.apache.derby.impl.tools.ij.Main has this code where the call to FileInputStream is not wrapped in a privilege block: try { in1 = new FileInputStream(file); if (in1 != null) { in1 = new BufferedInputStream(in1  utilMain.BUFFEREDFILESIZE); in = langUtil.getNewInput(in1); } } catch (FileNotFoundException e) { if (Boolean.getBoolean('ij.searchClassPath')) { in = langUtil.getNewInput(util.getResourceAsStream(file)); }This can cause issues when running under SecurityManager,1,0
Mutable public static variables,There are quite a few instances of public static fields which appear to be intended to be constant  but which are not final.The code would be safer if all the constant fields were made final.Patch to follow for some of the problem fields.The following also ought to be fixed:org.apache.derby.iapi.services.property.PropertyUtil.servicePropertyList (e.g. use an accessor to lookup the values)org.apache.derby.iapi.types.JSQLType.primitiveNames (ditto),1,0
'compilation time did not compute (0 0 0 0) expected: but was:' in testGroupBySortProps(....tests.lang.XplainStatisticsTest),Seen inhttp://dbtg.thresher.com/derby/test/trunk15/jvm1.5/testing/testlog/CYGWIN_NT-5.1_i686-unknown/790694-org.apache.derbyTesting.functionTests.suites.All_diff.txtThere was 1 failure:1) testGroupBySortProps(org.apache.derbyTesting.functionTests.tests.lang.XplainStatisticsTest)junit.framework.AssertionFailedError: compilation time did not compute (0 0 0 0) expected:&lt;16&gt; but was:&lt;0&gt; at org.apache.derbyTesting.functionTests.tests.lang.XplainStatisticsTest.verifySensibleStatementTimings(XplainStatisticsTest.java:707) at org.apache.derbyTesting.functionTests.tests.lang.XplainStatisticsTest.testGroupBySortProps(XplainStatisticsTest.java:1011) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57),0,0
SQLException XJ215 on insert  with setCharacterStream() and autocommit off in mailjdbc test,I am running the 10.5 maildbc test on Linux with network server and the 10.5.2.0 release candidate and an updated derbyTesting.jar to have just Lily's change to change the backup user: I see in the test output early and often  this error inserting data into the table:SQLState: XJ215Severity: 20000Message: You cannot invoke other java.sql.Clob/java.sql.Blob methods after calling the free() method or afterClob's transaction has been committed or rolled back.java.sql.SQLException: You cannot invoke other java.sql.Clob/java.sql.Blob methods after calling the free() mter the Blob/Clob's transaction has been committed or rolled back. at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.client.am.SqlException.getSQLException(Unknown Source) at org.apache.derby.client.am.Lob.checkValidity(Unknown Source) at org.apache.derby.client.am.Clob.length(Unknown Source) at org.apache.derby.client.net.NetStatementRequest.computeProtocolTypesAndLengths(Unknown Source) at org.apache.derby.client.net.NetStatementRequest.buildSQLDTAcommandData(Unknown Source) at org.apache.derby.client.net.NetStatementRequest.writeExecute(Unknown Source) at org.apache.derby.client.net.NetPreparedStatement.writeExecute_(Unknown Source) at org.apache.derby.client.am.PreparedStatement.writeExecute(Unknown Source) at org.apache.derby.client.am.PreparedStatement.flowExecute(Unknown Source) at org.apache.derby.client.am.PreparedStatement.executeUpdateX(Unknown Source) at org.apache.derby.client.am.PreparedStatement.executeUpdate(Unknown Source) at org.apache.derbyTesting.system.mailjdbc.utils.DbTasks.insertMail(DbTasks.java:447) at org.apache.derbyTesting.system.mailjdbc.tasks.Refresh.insertMail(Refresh.java:99) at org.apache.derbyTesting.system.mailjdbc.tasks.Refresh.doWork(Refresh.java:75) at org.apache.derbyTesting.system.mailjdbc.tasks.Refresh.run(Refresh.java:51)Caused by: org.apache.derby.client.am.SqlException: You cannot invoke other java.sql.Clob/java.sql.Blob metholling the free() method or after the Blob/Clob's transaction has been committed or rolled back.The interesting thing is that the test itself is not using any Clob methods it uses setCharacterStream and also autocommit is off.Below is a code excerpt and conn.setAutoCommit(false); PreparedStatement insertFirst = conn.prepareStatement( Statements.insertStr  Statement.RETURN_GENERATED_KEYS); String name = new String('ABCD'); String l_name = new String('WXYZ'); long s_insert = System.currentTimeMillis(); for (int i = 0; i &lt; num; i++) { String new_name = new String(increment(name  60)); String new_lname = new String(decrement(l_name  60)); insertFirst.setString(1  new_name); insertFirst.setString(2  new_lname); insertFirst.setTimestamp(3  new Timestamp(System .currentTimeMillis())); name = new_name; l_name = new_lname; try { // to create a stream of random length between 200 bytes and 3MB int clobLength = Rn.nextInt(3078000 - 200 + 1) + 200; streamReader = new LoopingAlphabetReader(clobLength  CharAlphabet.modernLatinLowercase()); insertFirst.setCharacterStream(4  streamReader  clobLength); } catch (Exception e) { MailJdbc.logAct.logMsg(LogFile.ERROR + thread_name + ' : ' + 'File not found Exception : ' + e.getMessage()); errorPrint(e); throw e; } int rand_num = Rn.nextInt(10 - 1); if (i == rand_num) { ResultSet rs = stmt .executeQuery('select count from REFRESH.INBOX where attach_id&gt;0'); while (rs.next()) { id_count = rs.getInt(1); insertFirst.setInt(5  rs.getInt(1) + 1); } rs.close(); conn.setTransactionIsolation(Connection.TRANSACTION_READ_COMMITTED); } else insertFirst.setInt(5  0); insertFirst .setString( 6  'This column is used only to by pass the space problem. If the problem still exists  then we are going to ' + 'have a serious issue here.*****************************************************************************************************'); int result = insertFirst.executeUpdate();if I connect with ij I do see some rows in the INBOX  so some inserts do seem to be happening. Kristian pointed out that this looks similar to DERBY-4224 with setAsciiStream() but this looks far more serious as autocommit is off and there does not appear to be a commit  so there is no obvious workaround. I assume this is also a regression. We shouldn't be throwing this error if the user did not use any Clob methods. I will try to narrow down the reproduction and track down where the issue was introduced. Knut said DERBY-4224 goes all the way back to 10.3.1.4 with DERBY-208. I don't know if it is the same case with this one.,0,0
With derby client setTransactionIsolation executes and commits even if isolation has not changed,With in EmbedConnection.setIsolation() we have a check to see if the isolation level is the same and if so just return without doing a commit: public void setTransactionIsolation(int level) throws SQLException { if (level == getTransactionIsolation()) return;with org.apache.derby.client.am.Connection we have no such check. It would be good if the client driver acted like embedded.,0,1
Attempt to reuse streams in client on insert gives protocol exception and inserts wrong data,If a user attempts to reuse a stream set as a parameter to a prepared statement  the statement execution should fail with SQL State XJ001. Instead client fails with a protocol error and inserts wrong data. See the attached java program ReproReuseStream.java for a reproduction.&#91;C:/kmarsden/repro/reusestream&#93; java ReproReuseStreamInsert row 1Try to insert row 2 with reused streamsjava.sql.SQLException: Network protocol error: end of stream prematurely reached  parameter #4. Remaining data has been padded with 0x0. at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:96) at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:358) at org.apache.derby.client.am.PreparedStatement.executeUpdate(PreparedStatement.java:399) at ReproReuseStream.main(ReproReuseStream.java:41)Caused by: org.apache.derby.client.am.SqlException: Network protocol error: end of stream prematurely reached  parameter #4. Remaining data has been padded with 0x0. at org.apache.derby.client.net.Request.writePlainScalarStream(Request.java:490) at org.apache.derby.client.net.Request.writeScalarStream(Request.java:264) at org.apache.derby.client.net.NetStatementRequest.buildEXTDTA(NetStatementRequest.java:951) at org.apache.derby.client.net.NetStatementRequest.writeExecute(NetStatementRequest.java:147) at org.apache.derby.client.net.NetPreparedStatement.writeExecute_(NetPreparedStatement.java:178) at org.apache.derby.client.am.PreparedStatement.writeExecute(PreparedStatement.java:1801) at org.apache.derby.client.am.PreparedStatement.flowExecute(PreparedStatement.java:2031) at org.apache.derby.client.am.PreparedStatement.executeUpdateX(PreparedStatement.java:404) at org.apache.derby.client.am.PreparedStatement.executeUpdate(PreparedStatement.java:390) ... 1 moreGo ahead and commit so we can see the wrong data.ID |MNAMEMVALUE BYTEDATACHARDATA--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------1 |mname0 6363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636&amp;ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc&amp;2 mname0 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&amp; &amp;To workaround the issue users should not attempt to reuse streams but we should give a better message and not insert wrong data.The code was extracted from StreamingColumnTest testDerby500 but the commits were removed.,0,0
hang in suites.all with ibm 1.5 on AIX after ttestDefaultProperties,The test run for 10.5.2.0 hung in suites.All. The console output (the run was with -Dderby.tests.trace=true) showed ttestDefaultProperties had successfully completed but the run was halted.ps -eaf | grep java showed the process that kicked off suites.All  and a networkserver process with the following flags: classpath &lt;classpath including derby.jar  derbytools.jar  derbyclient.jar  derbynet.jar  derbyTesting.jar  derbyrun.jar  derbyTesting.jar and junit.jar&gt; -Dderby.drda.logConnections= -Dderby.drda.traceAll= -Dderby.drda.traceDirectory= -Dderby.drda.keepAlive= -Dderby.drda.timeSlice= -Dderby.drda.host= -Dderby.drda.portNumber= -derby.drda.minThreads= -Dderby.drda.maxThreads= -Dderby.drda.startNetworkServer= -Dderby.drda.debug= org.apache.derby.drda.NetworkServerControl start -h localhost -p 1527This process had been sitting for 2 days.After killing the NetworkServerControl process  the test continued successfully (except for DERBY-4186  fixed in trunk)  but the following was put out to the console: START-SPAWNED:SpawnedNetworkServer STANDARD OUTPUT: exit code=1372009-07-18 03:16:07.157 GMT : Security manager installed using the Basic serversecurity policy.2009-07-18 03:16:09.169 GMT : Apache Derby Network Server - 10.5.2.0 - (794445)started and ready to accept connections on port 1527END-SPAWNED :SpawnedNetworkServer STANDARD OUTPUT:,0,1
test nstest generates errors XBM06 re reencryption and 22003 re value outside range for decimal/numeric,The test nstest (both in embedded and networkserver) ran into a JVM-bug-related error the last few times I tried it; but with a newer jvm I notice it's generating an XBM06 error:XBM06: Startup failed. An encrypted database cannot be accessed without the correct boot password. From the test's README.txt it shows it is indeed attempting to re-encrypt  but this is failing.The test needs to be tightened up so it doesn't show unusual errors.The test also generates:22003: The resulting value is outside the range for the data type DECIMAL/NUMERIC(5 0)The test's readme and comments don't indicate this is a negative test  so this too should get tightened/cleaned up.,1,0
hang on winvista with IBM 1.6 SR5 in NSSecurityMechanismTest,This is stopping my platform testing on winvista with ibm 1.6 SR5.During the initial run of suites.All  I got:-------------------------------- testNetworkServerSecurityMechanism java.net.SocketException: Connection reset by peer: setsockopt at java.net.PlainSocketImpl.socketSetOption(Native Method) at java.net.PlainSocketImpl.setOption(PlainSocketImpl.java:283) at java.net.Socket.setKeepAlive(Socket.java:1171) at org.apache.derby.impl.drda.ClientThread.run(Unknown Source)--------------------------------Rerunning suites.All gave the same error.There is only 1 java process active &amp; hanging.Running just the test itself also results in a hang but there was (so far - it's been sitting unchanged for 4 hours) java.net.SocketException.,1,1
SQLSTATE 38000 (NullPointerException) at inner self join and value(x1  x2...),create table xyz (c1 int  c2 int);insert into xyz values(1 2);select * from xyz t1 inner join xyz t2 on t1.c1 = t2.c1 where value(t1.c1  t1.c2) = 1;causes the following error:FEHLER 38000: Bei der Auswertung eines Ausdrucks wurde die Ausnahme 'java.lang.NullPointerException' ausgeloest.FEHLER XJ001: Java-Ausnahme: ': java.lang.NullPointerException'.,0,0
ASSERT FAILED calling setTransactionIsolation checking isolation_ == level   on  pooled connection,For DERBY-4314  I thought I would do a little testing to understand the server round trips in various scenarios for pooled connections. So I wrote the small attached program ConnReuse.java and hit this assertion in client:Exception in thread 'main' org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED at org.apache.derby.shared.common.sanity.SanityManager.ASSERT(SanityManager.java:98) at org.apache.derby.client.am.Connection.setTransactionIsolationX(Connection.java:987) at org.apache.derby.client.am.Connection.setTransactionIsolation(Connection.java:915) at org.apache.derby.client.am.LogicalConnection.setTransactionIsolation(LogicalConnection.java:253) at TestConnReuse.main(TestConnReuse.java:32)---------------To run the program on trunk:java org.apache.derby.drda.NetworkServerControl startjava TestConnReuse.This needs more investigation  but I thought I would go ahead and log the bug. I tried this only on trunk. I have not yet Tried it on the branches. Tried it with Lily's DERBY-4314 patch. Tried it with embedded. Tried actually doing something with the prior logical connection which might be related.,0,0
Copy table content with 'INSERT INTO table SELECT FROM (...)' statement leads to corrupt data,I had to change a the primary key of a table and used ddlutils to do so. Ddlutils recreated the table to perform this task.After the schema conversion the row data of the changed table were corrupted. The values of the last table column were filled with values from other rows!After performing a few tests I could break down the problem to the SQL statement 'INSERT INTO table SELECT FROM (...)'To reprocude the effect do the following:1. unpack attached database 'rmdb.zip'2. connect to the database with embedded driver  User: IGEL Password: test 3. read data of an example row from database select * from stringrangenew where classname = 'x.xserver%.colordepth';result is  x.xserver%.colordepth 2 &#91;16&#93; &#91;24&#93; &#91;32&#93;4. now copy the data to the second table (column INSTANCENR has been added to this table) INSERT INTO STRINGRANGENEW_ (CLASSNAME FIRMWAREID RVALUE) SELECT CLASSNAME FIRMWAREID RVALUE FROM STRINGRANGENEW;5. select data of example row from second table select * from stringrangenew_ where classname = 'x.xserver%.colordepth';result is  x.xserver%.colordepth 2 -1 &#91;CCW&#93;&#91;CW&#93;&#91;XX&#93;-&gt; value of last column is not the same as in orignal table!Here some additional information i worked out during my tests: if you change the copy statement to include the additional column INSTANCENR  the copied data are correct. delete from STRINGRANGENEW_; INSERT INTO STRINGRANGENEW_ (CLASSNAME FIRMWAREID  INSTANCENR  RVALUE) SELECT CLASSNAME FIRMWAREID  -1  RVALUE FROM STRINGRANGENEW; if you select the rows only 'SELECT CLASSNAME FIRMWAREID RVALUE FROM STRINGRANGENEW'  the result shows correct dataNote: The effect is not restricted to this row but also applies to other rows. But it's always the same rows  that get corrupted.,0,0
Implement CROSS JOIN,Implement the CROSS JOIN syntaxSELECT * from t1 CROSS JOIN t2;as an alternative syntax toSELECT * FROM t1  t2; This should be pretty straight forward and ease the migration of SQL code to Derby.,0,0
TableFunctions provide no information to limit underlying query,The API specification for TableFunctions cannot provide information to the implementer of the TableFunction about the details of the query. For example: (a) I defined a table function named MyFunction with columns a b  &amp; c(b) I bind the table function properly using the CREATE FUNCTION SQL.User executes the following SQL:select a b from table ( MyFunction() ) where c = 123Without passing the column list and/or where clause as arguments to the table function  my implementation can not know that it only needs two of the three columns  and only rows where c = 123.For TableFunctions that are built to integrate distant/legacy data  the cost of the query can be prohibitive. It would be better if information regarding the columns in the select and restrictions from the where clause could be passed to the developer.,0,1
NullPointerException when preparing LEFT OUTER JOIN between VALUES statements,ij version 10.5ij&gt; connect 'jdbc:derby:db;create=true';ij&gt; select a.* from (values ('a') ('b') (null)) a left outer join (values ('c') ('d')) b on 1=1;ERROR XJ001: Java exception: ': java.lang.NullPointerException'.,0,0
Replace Utils.min and Utils.max in the client driver with standard methods in java.lang.Math,The client has a utility class implementing functions for choosing the smallest and the largest int. These functions are already defined in java.lang.Math  and should be used instead because they are more familiar and because there is no need to duplicate the functionality.,0,0
Wrong result for simple join when index is created,In the example below  the first SELECT has correct result. After the index is created  the second SELECT gives wrong result.ij&gt; CREATE TABLE t1 (i1 INT  j1 INT);0 rows inserted/updated/deletedij&gt; CREATE TABLE t2 (i2 INT  j2 INT);0 rows inserted/updated/deletedij&gt; INSERT INTO t1 VALUES (8  8) (NULL  8);2 rows inserted/updated/deletedij&gt; INSERT INTO t2 VALUES (8  8);1 row inserted/updated/deletedij&gt; SELECT * FROM t1 INNER JOIN t2 ON (t2.j2 = t1.i1) OR (t2.j2 = t1.j1);I1 |J1 |I2 |J2 -----------------------------------------------8 |8 |8 |8 NULL |8 |8 |8 2 rows selectedij&gt; CREATE INDEX ix2 ON t2(j2);0 rows inserted/updated/deletedij&gt; SELECT * FROM t1 INNER JOIN t2 ON (t2.j2 = t1.i1) OR (t2.j2 = t1.j1);I1 |J1 |I2 |J2 -----------------------------------------------8 |8 |8 |8 1 row selected,0,0
JavaDoc warnings in several classes in impl/sql/execute/rts,A 'raw non-ASCII' character was introduced in several classes as part of a commit for DERBY-2487.These should be removed to get rid of the JavaDoc warnings.I plan to enable JavaDoc warnings reporting in the Hudson Derby build job.,0,0
Infinite loop in PredicateList.joinClauseTransitiveClosure(),This sequence of statements triggers an infinite loop in PredicateList.joinClauseTransitiveClosure() and never completes:create table c (a int  b int  c int);create table cc (aa int);select * from cc t1  c t2  cc t3 where t3.aa = t2.a and t3.aa = t2.b and t3.aa = t2.c;,0,0
NullPointerException in RIGHT JOIN with NOT BETWEEN,ij&gt; create table t1(x int);0 rows inserted/updated/deletedij&gt; create table t2(x int);0 rows inserted/updated/deletedij&gt; insert into t2 values (1);1 row inserted/updated/deletedij&gt; select * from t1 right join t2 on t1.x = t2.x where t1.x not between 0 and 4;X |X -----------------------ERROR 38000: The exception 'java.lang.NullPointerException' was thrown while evaluating an expression.ERROR XJ001: Java exception: ': java.lang.NullPointerException'.,0,0
NullPointerException when comparing indexed column with result from a set operation,I'm reporting this issue on behalf of Bernt M. Johnsen.If an indexed column is compared with a UNION query (or some other set operation)  a NullPointerException is raised  as can be seen by this sequence of statements in ij:ij&gt; create table t(a int not null primary key  b int);0 rows inserted/updated/deletedij&gt; select * from t where a &lt; (values 4 union values 4);ERROR XJ001: Java exception: ': java.lang.NullPointerException'.,0,0
Transformation to inner join not performed for certain three-way joins,In the CROSS JOIN section in the reference manual (http://db.apache.org/derby/docs/dev/ref/rrefsqljcrossjoin.html) there are three examples that are supposed to be equivalent. However  the performance differs significantly between the different queries.The queries use the tours db and look like this:(1)SELECT * FROM CITIES LEFT OUTER JOIN (FLIGHTS CROSS JOIN COUNTRIES) ON CITIES.AIRPORT = FLIGHTS.ORIG_AIRPORT WHERE COUNTRIES.COUNTRY_ISO_CODE = 'US'(2)SELECT * FROM CITIES LEFT OUTER JOIN FLIGHTS INNER JOIN COUNTRIES ON 1=1 ON CITIES.AIRPORT = FLIGHTS.ORIG_AIRPORT WHERE COUNTRIES.COUNTRY_ISO_CODE = 'US'(3)SELECT * FROM CITIES LEFT OUTER JOIN (SELECT * FROM FLIGHTS  COUNTRIES) S ON CITIES.AIRPORT = S.ORIG_AIRPORT WHERE S.COUNTRY_ISO_CODE = 'US'When executed in ij  (1) and (2) need 6 seconds to complete  whereas (3) completes in 50 ms.The query plans for (1) and (2) use nested loop joins and table scans. (3) uses a combination of hash join and nested loop join  and index scans as well as table scans.It looks like (3) has been rewritten from a left outer join to an inner join internally. This is fine because all rows that have the right-side columns filled with NULLs will be filtered out by the predicate S.COUNTRY_ISO_CODE='US'  so the extra rows generated by the outer join will not be returned.This optimization should also be possible for (1) and (2). We should improve the logic so that those joins are transformed too. The transformation happens in HalfOuterJoinNode.transformOuterJoins().,0,1
NullPointerException when USING clause contains all columns in both join tables,ij&gt; create table t(x int);0 rows inserted/updated/deletedij&gt; select t1.  t2. from t t1 join t t2 using ;ERROR XJ001: Java exception: ': java.lang.NullPointerException'.This statement should have raised an exception because both t1.* and t2.* expand to no columns. See DERBY-4407.,0,0
Scalar subquery erroneously rejected for not returning exactly one row,This sequence of statements causes an error because the scalar sub-query supposedly doesn't return exactly one row  even though it does return exactly one row:ij&gt; create table t (x int unique  y int);0 rows inserted/updated/deletedij&gt; insert into t values (1 2);1 row inserted/updated/deletedij&gt; select * from t where x &gt; (values 1 union select y from t where 1=0);ERROR 21000: Scalar subquery is only allowed to return a single row.ij&gt; values 1 union select y from t where 1=0;1 -----------1 1 row selectedBefore DERBY-4391  the problematic statement would have caused a NullPointerException.,0,0
Make getNegation() abstract in BinaryComparisonOperatorNode and UnaryComparisonOperatorNode,Both BinaryComparisonOperatorNode and UnaryComparisonOperatorNode have a method called getNegation() with the following code: /* Keep the compiler happy - this method should never be called. We should always be calling the method in a sub-class. */ if (SanityManager.DEBUG) SanityManager.ASSERT(false  'expected to call getNegation() for subclass ' + getClass().toString()); return this;Instead of relying on asserts to detect missing method overrides at run-time  we should make the methods abstract so that such errors are detected by the compiler.,0,0
NullPointerException with JOIN...USING and invalid table name in select list,ij version 10.6ij&gt; connect 'jdbc:derby:memory:db;create=true';ij&gt; create table t(a int  b int  c int);0 rows inserted/updated/deletedij&gt; select t.* from t t1 join t t2 using (a);ERROR XJ001: Java exception: ': java.lang.NullPointerException'.java.sql.SQLException: Java exception: ': java.lang.NullPointerException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142) at org.apache.derby.impl.jdbc.Util.javaException(Util.java:299) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2204) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:614) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:555) at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:329) at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:521) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:363) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:261) at org.apache.derby.impl.tools.ij.Main.go(Main.java:229) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:184) at org.apache.derby.impl.tools.ij.Main.main(Main.java:75) at org.apache.derby.tools.ij.main(ij.java:59)Caused by: java.sql.SQLException: Java exception: ': java.lang.NullPointerException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70) ... 16 moreCaused by: java.lang.NullPointerException at org.apache.derby.impl.sql.compile.JoinNode.getAllResultColumns(JoinNode.java:431) at org.apache.derby.impl.sql.compile.FromList.expandAll(FromList.java:474) at org.apache.derby.impl.sql.compile.ResultColumnList.expandAllsAndNameColumns(ResultColumnList.java:1598) at org.apache.derby.impl.sql.compile.ResultColumnList.bindExpressions(ResultColumnList.java:686) at org.apache.derby.impl.sql.compile.SelectNode.bindExpressions(SelectNode.java:451) at org.apache.derby.impl.sql.compile.DMLStatementNode.bindExpressions(DMLStatementNode.java:227) at org.apache.derby.impl.sql.compile.DMLStatementNode.bind(DMLStatementNode.java:140) at org.apache.derby.impl.sql.compile.CursorNode.bindStatement(CursorNode.java:249) at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:319) at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:88) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:824) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:606) ... 9 moreThe query is expected to fail (because the table name in t.* does not match any of the joined tables)  but not with a NullPointerException. A similar query with ON instead of USING fails more gracefully:ij&gt; select t.* from t t1 join t t2 on t1.a=t2.a;ERROR 42X10: 'T' is not an exposed table name in the scope in which it appears.,0,0
Add proper delete mechanism for in-memory databases,The current mechanism for deleting in-memory databases isn't good enough  and a proper one must be added.It is also important to be able to delete in-memory databases  since they occupy valuable main memory that should be discarded when the database is no longer needed.I intend to implement the mechanism by using the JDBC connection URL:'jdbc:derby:memory:myDatabase;delete=true&#91;;user=X;password=Y&#93;The connection attempt will throw an exception in any case  either because the request failed or because it succeeded.Reasons for a failure can be invalid user and/or password  lacking encryption attributes  or conflicting attributes.For the time being  only the database owner will be allowed to delete databases (note: do we have a way to control/limit in-memory database creation?),0,0
Memory leak when attempting to boot non-existing database with the in-memory back end,When attempting to boot a non-existing database with the in-memory back end  a DataStore is created and referenced by a map. Since the database doesn't exist  Derby won't use the DataStore again and it will hang around indefinitely in VFMemoryStorageFactory (or until the same database is actually created  in which case the data store will be used).FYI  storage factory instances are instantiated liberally  including for the same service (i.e. six instances of VFMemoryStorageFactory may be created to boot 'jdbc:derby:memory:myDB').,0,1
'Table/View 'T1' already exists in Schema 'APP'' in lang.DropTableTest on phoneME/cvm,See http://dbtg.foundry.sun.com/derby/test/Daily/javaME/testing/Limited/testSummary-833084.htmlhttp://dbtg.foundry.sun.com/derby/test/Daily/javaME/FailReports/833084_bySig.html same signature as DERBY-4392 : org.apache.derbyTesting.functionTests.tests.lang.DropTableTest &#91;org.apache.derbyTesting.functionTests.tests.lang.CheckConstraintTest&#93;: DERBY-4392 Closed - signature&#91;1&#93;Caused by test not cleaning up and phoneME/cvm executing tests in a different order than other jvms Introduced by r833055 / DERBY-4423.I am testing a fix.,0,0
Evaluation of default value and identity in an INSERT result set evaluated too early.,In contrast to generated column  which are evaluated when the next row from the result set to be inserted  currently default values and identity columns are generated 'early'  that is as part of avaluating the subquery (SELECT or VALUES as the case may be). This does not currently cause a user visible bug in Derby  but it lies behind DERBY-3 and the effect Bryan observed in DERBY-4.Additionally  'early' computation has given rise to much special handling and ensuing bugs  cf. DERBY-1644  DERBY-4413  DERBY-4419  DERBY-4425 and others.DERBY-4397 requires this fix for correct behaviour with INSERT.See alsohttps://issues.apache.org/jira/browse/DERBY-4413?focusedCommentId=12769532&amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12769532,0,0
Wrap rollback in exception handlers in try-catch,Avoid this pattern everywhere: }catch(SQLException se){ //issue a rollback on any errors conn.rollback(); throw se; }because an error in rollback will shadow the original exception.,0,0
Prepared statement failure with CLOB: Stream has already been read and end-of-file reached and cannot be re-used.,Possibly related to #4332?We have encountered an error when using Prepared Statements and CLOBs. I have read:http://db.apache.org/derby/papers/JDBCImplementation.html#setAsciiStream%2CsetBinaryStream%2CsetCharacterStreamBut it does not seem applicable  as we are not re-using a stream.The environment is this:1. Java 62. Derby 10.5.3.03. Bitronix JTA 1.3.3We're actually using Hibernate  but I eliminated it from the equation (and the problem persists).A summary of the failure flow is this:1. Start a transaction2. Obtain a connection from a pool of connections (for this test  the pool size is pinned at 1)3. Prepare a statement that inserts a CLOB.4. Set the parameters5. Add the prepared statement to a batch (but we only batch 1 &#8211; this is to emulate what hibernate is doing as closely as possible).6. Execute the batch.Everything up to this point works.7. Repeat steps 1-6. But this time  the connection will be reused from the pool  and the statement will be gotten from a prepared statement cache (maintained by bitronix). I.e. the prepared statement is re-used.8. Observe the following failure:org.apache.derby.client.am.BatchUpdateException: Non-atomic batch failure. The batch was submitted  but at least one exception occurred on an individual member of the batch. Use getNextException() to retrieve the exceptions for specific batched elements. at org.apache.derby.client.am.Agent.endBatchedReadChain(Unknown Source) at org.apache.derby.client.am.PreparedStatement.executeBatchRequestX(Unknown Source) at org.apache.derby.client.am.PreparedStatement.executeBatchX(Unknown Source) at org.apache.derby.client.am.PreparedStatement.executeBatch(Unknown Source) at bitronix.tm.resource.jdbc.JdbcPreparedStatementHandle.executeBatch(JdbcPreparedStatementHandle.java:248) at org.dancernetworks.TestFailure.doInsert(TestFailure.java:134) at org.dancernetworks.TestFailure.doPrepared(TestFailure.java:110) at org.dancernetworks.TestFailure.main(TestFailure.java:55)Nov 30  2009 10:29:31 PM bitronix.tm.BitronixTransactionManager shutdownINFO: shutting down Bitronix Transaction ManagerAn IOException was thrown when reading a 'java.sql.String' from an InputStream.java.sql.SQLException: An IOException was thrown when reading a 'java.sql.String' from an InputStream. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.seeNextException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedResultSet.noStateChangeException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.transferParameters(Unknown Source) at org.apache.derby.jdbc.XAStatementControl.getRealPreparedStatement(Unknown Source) at org.apache.derby.iapi.jdbc.BrokeredPreparedStatement.getPreparedStatement(Unknown Source) at org.apache.derby.iapi.jdbc.BrokeredPreparedStatement.getStatement(Unknown Source) at org.apache.derby.iapi.jdbc.BrokeredStatement.close(Unknown Source) at org.apache.derby.impl.drda.DRDAStatement.close(Unknown Source) at org.apache.derby.impl.drda.Database.close(Unknown Source) at org.apache.derby.impl.drda.Session.close(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.closeSession(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)Caused by: java.sql.SQLException: An IOException was thrown when reading a 'java.sql.String' from an InputStream. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source) ... 15 moreCaused by: java.sql.SQLException: Java exception: 'Stream has already been read and end-of-file reached and cannot be re-used.: java.io.EOFException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) ... 12 moreCaused by: java.io.EOFException: Stream has already been read and end-of-file reached and cannot be re-used. at org.apache.derby.iapi.types.ReaderToUTF8Stream.read(Unknown Source) at java.io.DataInputStream.readUnsignedShort(DataInputStream.java:320) at org.apache.derby.iapi.types.SQLChar.readExternal(Unknown Source) at org.apache.derby.iapi.types.SQLChar.getString(Unknown Source) at org.apache.derby.iapi.types.SQLChar.setFrom(Unknown Source) at org.apache.derby.iapi.types.DataType.setValue(Unknown Source) at org.apache.derby.impl.sql.GenericParameterValueSet.transferDataValues(Unknown Source) at org.apache.derby.impl.sql.execute.BaseActivation.setParameters(Unknown Source) at org.apache.derby.impl.sql.GenericActivationHolder.setParameters(Unknown Source) ... 10 moreAttached is an archived Eclipse project of a self-contained reproduction. It includes everything needed to run  including the Bitronix 1.3.3 jar.,0,0
Forbid ordering operations on UDTs,Knut has provided an example of an ordering operation which succeeds on a UDT in his Dec. 11  2009 comment on DERBY-651.,0,0
Use helper methods from IdUtil instead of TupleDescriptor.quoteProtectName(),TupleDescriptor.quoteProtectName() duplicates functionality provided by the o.a.d.iapi.util.IdUtil class. The method should be removed  and its callers should use IdUtil.normalToDelimited() or IdUtil.mkQualifiedName() instead.,0,0
Selecting / projecting a column whose value is represented by a stream more than once fails,Selecting / projecting a column whose value is represented as a stream more than once crashes Derby  i.e.:ResultSet rs = stmt.executeQuery('SELECT clobValue AS clobOne  clobValue AS clobTwo FROM mytable');rs.getString(1);rs.getString(2);After having looked at the class of bugs having to do with reuse of stream data types  I now have a possible fix. It fixes DERBY-3645  DERBY-3646 and DERBY-2349 (there may be more Jiras).The core of the fix is cloning certain DVDs being selected/projected in multiple columns. There are two types of cloning: A) materializing clone B) stream clone(A) can be implemented already  (B) requires code to clone a stream without materializing it. Note that the streams I'm talking about are streams originating from the store.Testing revealed the following: the cost of the checks performed to figure out if cloning is required seems acceptable (negligible?) in some cases (A) has better performance than (B) because the raw data only has to be decoded once stream clones are preferred when the data value is above a certain size for several reasons: avoids potential out-of-memory errors (and in case of a server environment  it lowers the memory pressure) avoids decoding the whole value if the JDBC streaming APIs are used to access only parts of the value avoids decoding overall in cases where the value isn't accessed by the client / user (this statement conflicts with the performance observation above)We don't always know the size of a value  and since the fix code deals with all kinds of data types  it is slightly more costly to try to obtain the size.What do people think about the following goal statement?Goals:----- Phase 1 1) No crashes or wrong results due to stream reuse when executing duplicate column selections (minus goal 4) 2) Minimal performance degradation for non-duplicate column selections 3) Only a minor performance degradation for duplicate [&#91;LONG&#93; VAR]CHAR &#91;FOR BIT DATA&#93; column selections----- Phase 2 4) No out-of-memory exceptions during execution of duplicate column selections of BLOB/CLOB 5) Optimize BLOB/CLOB cloningI think phase 1 can proceed by reviewing and discussing the prototype patch. Phase 2 requires more discussion and work (see DERBY-3650).A note about the bug behavior facts:Since this issue is the underlying cause for several other reported issues  I have decided to be liberal when setting the bug behavior facts. Depending on where the duplicate column selection is used  it can cause both crashes  wrong results and data corruption.,0,0
Use AtomicLong for XactFactory.tranId,Dyre Tjeldvoll posted some results on DERBY-3092 that indicated that some types of load might cause contention on XactFactory.tranId (a shared long)  and suggested that it was replaced with a java.util.concurrent.atomic.AtomicLong on the platforms that support java.util.concurrent.*.I'm splitting this issue out from DERBY-3092 so that the two possible improvements reported there can be addressed independently.,0,1
Add import/export support for UDTs.,Import/export should work on UDTs.,0,0
Nullpointer when performing INSERT INTO,To replicate  execute the following 4 queries:CREATE TABLE feed (fst INTEGER  snd VARCHAR(50)  UNIQUE(fst))INSERT INTO feed VALUES (1  'fst')CREATE TABLE tbl (col1 INTEGER  col2 INTEGER NOT NULL REFERENCES feed (fst) ON DELETE RESTRICT ON UPDATE RESTRICT)INSERT INTO tbl(col1) SELECT 1 FROM feedThe result of the last INSERT INTO query is:java.lang.NullPointerException at org.apache.derby.impl.store.access.btree.BTreeScan.initScanParams(Unknown Source) at org.apache.derby.impl.store.access.btree.BTreeScan.reopenScan(Unknown Source) at org.apache.derby.impl.sql.execute.TableScanResultSet.reopenScanController(Unknown Source) at org.apache.derby.impl.sql.execute.TableScanResultSet.reopenScanController(Unknown Source) at org.apache.derby.impl.sql.execute.TableScanResultSet.reopenCore(Unknown Source) at org.apache.derby.impl.sql.execute.BulkTableScanResultSet.reopenCore(Unknown Source) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.reopenCore(Unknown Source) at org.apache.derby.impl.sql.execute.NormalizeResultSet.reopenCore(Unknown Source) at org.apache.derby.impl.sql.execute.InsertResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(Unknown Source),0,0
Column list size mismatch with ORDER BY in INSERT statement,I see this error on trunk (revision 894516):ij&gt; create table t(x varchar(100));0 rows inserted/updated/deletedij&gt; insert into t select * from (select * from sysibm.sysdummy1 order by length(ibmreqd)) t1;ERROR 42X32: The number of columns in the derived column list must match the number of columns in table 'T1'.The statement succeeds if I remove the ORDER BY clause:ij&gt; insert into t select * from (select * from sysibm.sysdummy1) t1;1 row inserted/updated/deleted,0,0
j2ME test failures relating to runtimeStatisticsParser,After my change for DERBY-4038 to the runtimeStatisticsParser  the IBM tests show 44 errors and the Sun tests 48 - because I've used the String.split method which isn't available with j2ME.For example: 1) testDynamicLikeOptimization(org.apache.derbyTesting.functionTests.tests.lang.DynamicLikeOptimizationTest)java.lang.NoSuchMethodError: java/lang/String.split(Ljava/lang/String[Ljava/lang/String; at org.apache.derbyTesting.junit.RuntimeStatisticsParser.getStartPosition(RuntimeStatisticsParser.java:421) at org.apache.derbyTesting.junit.RuntimeStatisticsParser.&lt;init&gt;(RuntimeStatisticsParser.java:81) at org.apache.derbyTesting.junit.SQLUtilities.getRuntimeStatisticsParser(SQLUtilities.java:125) at org.apache.derbyTesting.functionTests.tests.lang.DynamicLikeOptimizationTest.testDynamicLikeOptimization(DynamicLikeOptimizationTest.java:547) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:195) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)The runtimeStatisticsParser code needs to be adjusted.,0,0
Document and clarify the use of DataValueDescriptor.setValue(InputStream int),The usage of the method DataValueDescriptor.setValue(InputStream stream  int length) is unclear. The intended use seems to be to pass on the known length of an input stream set from the JDBC-layer (i.e. setBinaryStream).There seems to be two distinct cases: the logical length of the stream is known the logical length of the stream is not knownUsing -1 when the length is not known seems to be an established pattern.,0,0
Refactor and extend data type cloning facilities,With the increased use of streams to represent data values  the cloning facilities needs to be improved.Unless I get pushback  I will proceed by producing patches to reach the following goals: move the functionality provided by CloneableObject into DataValueDescriptor (all classes implementing CloneableObject also implements DataValueDescriptor) introduce the cloning methods cloneValue  cloneState and cloneHolder (all in DataValueDescriptor  see description below) Note that they all return a usable DVD. I'm all ears for better names for the clone methods (another suggestion mentioned is cloneDeep  cloneHalfDeep  and cloneShallow).NOTE: See comment below  the method names changed during the course of development.cloneValue &lt;deep&gt; (new method  functionality was present through combined calls to the DVD public interface)  a DVD obtained through cloneValue is independent of other DVDs and the state of the Derby store the data value will be materializedcloneState &lt;halfDeep&gt; (~= DataValueDescriptor.getClone) a DVD obtained through cloneState is independent of other DVDs  but may depend on the state of the Derby store (due to references to store streams) the data value will be materialized if the value is represented by a non-cloneable stream or if Derby believes materializing the value is more appropriate than keeping the stream representationcloneHolder &lt;shallow&gt; (~= CloneableObject.cloneObject) a DVD obtained through cloneHolder is dependent on the original DVD and its clones made through cloneHolder. If one of the DVDs changes its state  all of them will be affected. Will also be dependent on the state of the Derby store if there are references to store streams. the data value will never be materialized due to cloneHolder being invokedFor many of the data types  cloneState and cloneHolder will forward to cloneValue.cloneState will be used the most. cloneValue is currently only required in the sorter. cloneHolder is required (for performance reasons and maybe to avoid OOME) when DVDs pass through temporary holders (BackingStoreHashtable  TemporaryRowHolderImpl). I have not gone through all the usages of cloneState to see if any of them can be  or has to be  replaced with another clone-call.The ability to clone store streams will be added by Mike's patch attached to DERBY-3650. New method names:It turned out that using only two methods was sufficient:cloneHolder &lt;shallow&gt; (as above)cloneValue(boolean forceMaterialization) &lt;halfDeep or deep&gt;Basically  cloneValue(false) equals cloneState() above  and cloneValue(true) equals cloneValue() above.,0,0
If the CREATE TRIGGER does not have the REFERENCING clause  then there is no need to keep before and after values for the triggering table,In order for the trigger action to have access to before and after values of the triggering table  the CREATE TRIGGER should use the REFERENCING clause. Without the REFERENCING clause  old and new values of triggering table can't be accessed by the trigger action. Based on this  we can improve Derby memory utilization by not keeping old and new values if REFERENCING clause is missing. It will be good to see if the code already does this optimization and if not  then introducing this optimization will definitely be very useful when the triggering table could have LOB columns.,0,1
Make it possible to put the optional clauses of a CREATE SEQUENCE statement in the arbitrary order allowed by the SQL Standard,The current syntax for CREATE SEQUENCE requires that the optional clauses appear in a fixed order. The SQL Standard is more flexible here.,0,0
Avoid materialization where possible when cloning CollatorSQLClob,Cloning a CollatorSQLClob results in always materializing the value. Since CLOBs can be very large  this should be avoided. There should now be sufficient functionality to do this  see SQLClob.,0,0
test_11_tableFunctionColumns fails with weme (J2ME) with 'java.lang.NoClassDefFoundError: java.sql.DriverManager',Starting Friday Feb 3  testing svn 907159  IBM weme 6.2 fails as follows.http://people.apache.org/~myrnavl/derby_test_results/main/windows/testlog/weme6.2/907159-suites.All_diff.txtIt would appear that either the test needs to be disabled for J2ME or DriverManager use needs to be removed from the test.1) test_11_tableFunctionColumns(org.apache.derbyTesting.functionTests.tests.lang.UDTTest)java.sql.SQLException: The exception 'java.lang.NoClassDefFoundError: java.sql.DriverManager' was thrown while evaluating an expression. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.seeNextException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeQuery(Unknown Source) at org.apache.derbyTesting.functionTests.tests.lang.GeneratedColumnsHelper.assertResults(GeneratedColumnsHelper.java:335) at org.apache.derbyTesting.functionTests.tests.lang.UDTTest.test_11_tableFunctionColumns(UDTTest.java:814) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:195) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)Caused by: java.sql.SQLException: Java exception: 'java.sql.DriverManager: java.lang.NoClassDefFoundError'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) ... 41 moreCaused by: java.lang.NoClassDefFoundError: java.sql.DriverManager at org.apache.derbyTesting.functionTests.tests.lang.UDTTest.hashmapReader(UDTTest.java:854) at org.apache.derby.exe.ac8b55d5f4x0126xa337xbefex00001d5b55d51.g0(Unknown Source) at java.lang.reflect.AccessibleObject.invokeL(AccessibleObject.java:203) at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(Unknown Source) at org.apache.derby.impl.sql.execute.VTIResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) ... 37 more,0,0
would like an alternative location for ant.properties,The current build.xml directs ant to look for a file ant.properties in user.home. This can get confusing when you have multiple versions on the same machine.I've worked around this in the past by pointing ant at other directories with -Duser.home=...  but it would be easier to have another place set up - I don't really like changing user.home.We could add another line to build.xml  e.g.  for trunk's current build.xml:@@ -20 6 +20 7 @@ &lt;!-- Set Properties --&gt; &lt;!-- User settings --&gt;+ &lt;property file='ant.properties'/&gt; &lt;property file='${user.home}/ant.properties'/&gt; &lt;!-- Set property lib dir --&gt; &lt;property name='properties.dir' value='tools/ant/properties'/&gt;This would make ant look first for ant.properties in the same directory as the top level build.xml  and secondly for the one in user.home.If the community agrees this would be ok  I'd like to make this change and backport it all the way to 10.0.By having an additional place we'd not cause incompatibilities to other build processes (except if someone has put an ant.properties file in the top of the checked out tree).If we do this  I think it's up to the developers to ensure that there's not 2 ant.properties files that are conflicting.,0,0
NPE in JBitSet,A NPE occurs at org.apache.derby.iapi.util.JBitSet.or().A NPE occured at the same location before: http://issues.apache.org/jira/browse/DERBY-1574The bug was confirmed by Bryan Pendleton to show in the HEAD as well: http://mail-archives.apache.org/mod_mbox/db-derby-user/201002.mbox/%3C4B79F74E.1000005@amberpoint.com%3ETo reproduce:----------------------CREATE TABLE ABC (ID int PRIMARY KEY NOT NULL);CREATE TABLE DEF (ID int PRIMARY KEY NOT NULL);SELECT * FROM ABC t1WHERE (SELECT DISTINCT t2.ID FROM DEF t2)  IN (SELECT t3.ID FROM DEF t3) ----------------------Leads to error message: Error: DERBY SQL error: SQLCODE: -1  SQLSTATE: XJ001  SQLERRMC: java.lang.NullPointerExceptionXJ001.USQLState: XJ001ErrorCode: -1Stacktrace:java.lang.NullPointerException at org.apache.derby.iapi.util.JBitSet.or(Unknown Source) at org.apache.derby.impl.sql.compile.OptimizerImpl.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.sql.compile.Level2OptimizerImpl.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.sql.compile.Level2OptimizerFactoryImpl.getOptimizerImpl(Unknown Source) at org.apache.derby.impl.sql.compile.OptimizerFactoryImpl.getOptimizer(Unknown Source) at org.apache.derby.impl.sql.compile.ResultSetNode.getOptimizer(Unknown Source) at org.apache.derby.impl.sql.compile.SelectNode.optimize(Unknown Source) at org.apache.derby.impl.sql.compile.SubqueryNode.optimize(Unknown Source) at org.apache.derby.impl.sql.compile.SubqueryList.optimize(Unknown Source) at org.apache.derby.impl.sql.compile.SelectNode.optimize(Unknown Source) at org.apache.derby.impl.sql.compile.DMLStatementNode.optimizeStatement(Unknown Source) at org.apache.derby.impl.sql.compile.CursorNode.optimizeStatement(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement40.&lt;init&gt;(Unknown Source) at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source) at org.apache.derby.impl.drda.DRDAStatement.prepare(Unknown Source) at org.apache.derby.impl.drda.DRDAStatement.explicitPrepare(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.parsePRPSQLSTT(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)Cleanup action completed,0,0
Allow database user to execute stored procedures with same permissions as database owner and/or routine definer,Curretnly there is no way to hide data and database structure in embedded derby from the end user. One way to accomplish the above requirement is as follows:1. Create encrypted database so data is protected2. Enable authentication and sql authorization in database3. Create two users  dbUser and dbOwner4. Store application logic as stored procedure in the databse so dbUser does not know what tables are accecced by the application logic  thus hiding table structure5. Revoke select permission from dbUser so he cannot describe tables thus protecting table structures6. Give only Execute permissions on stored procedures to dbUserThe above steps will ensure that data and data structure is hidden when application is delivered to end user.The problem is  if user does not have select permission  the stored procedures will not execute. So I am requesting the following enhancement to Derby:If dbOwner has given Execure permission to stored procecure to a dbUser  then allow stored procedure to execute even if the dbUser has no select permission. In otherwords  When dbUser calls stored procedure  database will use dbOwners authorization to execute stored procedure rather than dbUsers. This may be implemented by creating new permission called RunAsDbOwner.DbOwner can then grant permission to dbUser to execute a stored procedure with RunAsDbOwner.If this is implemented  applications can be created which will truely hide the database structure and data from end users. Database will behave as a blackbox with only in/out data exposed in stored procedures.,1,0
Remove lang/scrollCursors1.sql,lang/scrollCursors1.sql was converted to JUnit in DERBY-2542. The canons were removed  but the original sql test file is still in the code. The sql file should also be removed.,0,0
Complation of prepared statement results in Syntax Error,In attempting to upgrade our product from Derby 10.3.1.4 to 10.5.3.0  I simply replaced the derby jars - no change to java environment or code. I now experience a Syntax Error when preparing a statement that previously worked correctly.This statement:SELECT Offset  CMFragmentOID  CMContentOID  FragmentLength  Fragment FROM CMFragment  WHERE CMContentOID = ? AND Offset BETWEEN  (SELECT Offset FROM CMFragment WHERE CMContentOID = ? AND Offset &lt;= ? AND Offset + FragmentLength &gt; ?)  AND (SELECT Offset FROM CMFragment WHERE CMContentOID = ? AND Offset &lt; ? AND Offset + FragmentLength &gt;= ?) ORDER BY Offset ASCWhich should evaluate to the following after the parameters are provided:SELECT Offset  CMFragmentOID  CMContentOID  FragmentLength  Fragment FROM CMFragment  WHERE CMContentOID = -6915303484809802281 AND Offset BETWEEN  (SELECT Offset FROM CMFragment WHERE CMContentOID = -6915303484809802281 AND Offset &lt;= 0 AND Offset + FragmentLength &gt; 0)  AND (SELECT Offset FROM CMFragment WHERE CMContentOID = -6915303484809802281 AND Offset &lt; 131072 AND Offset + FragmentLength &gt;= 131072) ORDER BY Offset ASCFails with:Caused by: java.sql.SQLSyntaxErrorException: Syntax error: Encountered 'Offset' at line 1  column 202. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement40.&lt;init&gt;(Unknown Source) at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source) at com.paisley.foundation.sql.decorator.BaseConnectionDecorator.prepareStatement(BaseConnectionDecorator.java:349) at com.paisley.foundation.sql.decorator.batchvalidator.BatchValidatorConnection.prepareStatement(BatchValidatorConnection.java:152) at com.paisley.foundation.sql.decorator.BaseConnectionDecorator.prepareStatement(BaseConnectionDecorator.java:349) at com.paisley.foundation.database.connection.DatabaseConnection.prepareStatement(DatabaseConnection.java:960) at com.paisley.foundation.persistent.sql.PersistentQuery.execute(PersistentQuery.java:236) at com.paisley.rnj.content.model.CMFragment.load(CMFragment.java:254) ... 25 moreCaused by: java.sql.SQLException: Syntax error: Encountered 'Offset' at line 1  column 202. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source) ... 44 moreCaused by: ERROR 42X01: Syntax error: Encountered 'Offset' at line 1  column 202. at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.impl.sql.compile.ParserImpl.parseStatement(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source) ... 38 moreThe failure position indicated is in this clause: AND Offset + FragmentLength &gt; ?This statement does work correctly in 10.3.1.4. It also works as a direct SQL statement  if I don't use a prepared statement  but execute the SQL above.,0,0
failures in ij2 test with cdc/foundation (ibm's weme 6.2),The test ij2.sql from derbyall is failing for weme6.2 like so:     Start: ij2 jdkWECE J2ME Foundation Specification v1.1 derbyall:derbytools 2010-02-25 04:11:05 ***31 del&lt; IJ ERROR: Unable to establish prepared statement S31a31&gt; IJ ERROR: Unable to establish prepared statement S@CONNECTION0Test Failed. End: ij2 jdkWECE J2ME Foundation Specification v1.1 derbyall:derbytools 2010-02-25 04:11:15 ***    I think this is expected after the change: ------------------------------------------------------------------------r916014 | rhillegas | 2010-02-24 14:39:49 -0800 (Wed  24 Feb 2010) | 1 lineDERBY-4550: Commit Sylvain Leroux's patch which adds qualified identifiers to ij.------------------------------------------------------------------------Looks like all that's needed is an update of java/testing/org/apache/derbyTesting/functionTests/master/j9_foundation/ij2.out.,0,0
Cannot use dblook on soft-upgraded database: Table/View 'SYS.SYSSEQUENCES' does not exist.,I tried to use dblook on trunk to dump the schema of a database created with Derby 10.5. dblook printed the following message:&#8211; Timestamp: 2010-03-12 15:45:50.836&#8211; Source database is: db&#8211; Connection URL is: jdbc:derby:db&#8211; appendLogs: false&#8211; Note: At least one unexpected error/warning message was&#8211; encountered during DDL generation. See dblook.log&#8211; to review the message(s).In dblook.log  I saw an exception with this message:java.sql.SQLSyntaxErrorException: Table/View 'SYS.SYSSEQUENCES' does not exist.,0,0
Corrupted database prevents startup and should be automatically repaired perhaps,I have found a database in my application that prevents startup due to it being corrupted. The driver reports that the database does not exist  even though it does. Then when my app tries to create the database using ;create=true; on the URL it fails.I think this happened due to the app being killed in Task Manager while it was creating the database.I have the database saved so that you can reproduce the problem. (I'm not sure if I can attach it yet),0,0
10 failures and 11 errors with IBM weme6.2/j9/cdc-foundation after revision 922304 for DERBY-4483,Since March 12 there's been 10 failures and 11 errors in the nightly test run with IBM's j2ME/CDC-foundation profile implementation  see: http://people.apache.org/~myrnavl/derby_test_results/main/windows/testSummary-922467.html. Things were ok on March 10  see: http://people.apache.org/~myrnavl/derby_test_results/main/windows/testSummary-921667.html.I believe these were the effect of the following checkin for DERBY-4483:r922304 | kahatlen | 2010-03-12 08:01:20 -0800 (Fri  12 Mar 2010) | 8 linesDERBY-4483: Provide a way to change the hash algorithm used by BUILTIN authenticationI'll attach the full failure stacks in a separate file  but I believe perhaps new tests have been added that need to be excluded from the run  because the provider doesn't support the intended mechanism.I'd also be interested to know if these same failures occur with Sun's/Oracle's phoneME.This is the top of the first error:-------------------1) testVariousBuiltinAlgorithms(org.apache.derbyTesting.functionTests.tests.jdbcapi.AuthenticationTest)java.sql.SQLException: The message digest algorithm 'SHA-256' is not supported by any of the available cryptography providers. Please install a cryptography provider that supports that algorithm  or specify another algorithm in the derby.authentication.builtin.algorithm property. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.seeNextException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedCallableStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(Unknown Source) at org.apache.derbyTesting.functionTests.tests.jdbcapi.AuthenticationTest.setDatabaseProperty(AuthenticationTest.java:1208) at org.apache.derbyTesting.functionTests.tests.jdbcapi.AuthenticationTest.setDatabaseProperty(AuthenticationTest.java:1218) at org.apache.derbyTesting.functionTests.tests.jdbcapi.AuthenticationTest.testVariousBuiltinAlgorithms(AuthenticationTest.java:1118)------------------The failures are likely a result of this - the stack shows issues like no cleaning up of databases etc.,1,0
test testBuiltinAuthenticationWithConfigurableHash fails from upgradeTests.Changes10_6 with ibm's j9,With the patch for DERBY-4602 I saw one error with IBM's weme 6.2:1) testBuiltinAuthenticationWithConfigurableHash(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_6)java.sql.SQLException: The message digest algorithm 'SHA-256' is not supported by any of the available cryptography providers. Please install a cryptography provider that supports that algorithm  or specify another algorithm in the derby.authentication.builtin.algorithm property. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142) at org.apache.derby.impl.jdbc.Util.seeNextException(Util.java:278) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:398) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2269) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1321) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1673) at org.apache.derby.impl.jdbc.EmbedCallableStatement.executeStatement(EmbedCallableStatement.java:117) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(EmbedPreparedStatement.java:1328) at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_6.setPasswords(Changes10_6.java:442) at org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_6.testBuiltinAuthenticationWithConfigurableHash(Changes10_6.java:384) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:195) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)Caused by: java.sql.SQLException: Java exception: 'SHA-256: java.security.NoSuchAlgorithmException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142) at org.apache.derby.impl.jdbc.Util.javaException(Util.java:299) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403) ... 111 moreCaused by: java.security.NoSuchAlgorithmException: SHA-256 at java.lang.Throwable.&lt;init&gt;(Throwable.java:67) at java.security.MessageDigest.getInstance(MessageDigest.java:204) at org.apache.derby.impl.jdbc.authentication.AuthenticationServiceBase.encryptPasswordConfigurableScheme(AuthenticationServiceBase.java:549) at org.apache.derby.impl.jdbc.authentication.AuthenticationServiceBase.encryptUsingDefaultAlgorithm(AuthenticationServiceBase.java:615) at org.apache.derby.impl.jdbc.authentication.AuthenticationServiceBase.map(AuthenticationServiceBase.java:411) at org.apache.derby.iapi.services.property.PropertyValidation.doValidateApplyAndMap(PropertyValidation.java:81) at org.apache.derby.impl.store.access.PropertyConglomerate.validateApplyAndMap(PropertyConglomerate.java:384) at org.apache.derby.impl.store.access.PropertyConglomerate.setProperty(PropertyConglomerate.java:513) at org.apache.derby.impl.store.access.RAMTransaction.setProperty(RAMTransaction.java:1795) at org.apache.derby.iapi.db.PropertyInfo.setDatabaseProperty(PropertyInfo.java:108) at org.apache.derby.catalog.SystemProcedures.SYSCS_SET_DATABASE_PROPERTY(SystemProcedures.java:686) at org.apache.derby.exe.ac75629305x0127xb63ax3d55xfffff5235db30.g0(Unknown Source) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:195) at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(ReflectMethod.java:46) at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(CallStatementResultSet.java:75) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:436) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:317) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1232),0,0
PropertySetter fails due to an empty jre/lib directory,If a JDK directory with an empty jre/lib directory is chosen by the old algorithm for detecting JDKs on the build system  the build fails because the classpath is set to the empty string instead of the default (stubs and the higher level JDK classpath).The situation causing this problem can arise if a JDK with extension libs is uninstalled. Depending on the packaging system  this may leave the jre/lib/ext directory behind.,0,0
Invalid conversion from Timestamp to String when calling setTimestamp() with Calendar,If you set a VARCHAR parameter with setTimestamp()  the string will be formatted differently depending on whether a Calendar is specified or not  even if the default calendar is used.Take for example this statement: VALUES CAST(? AS VARCHAR(30))I executed this statement twice with the same Timestamp instance. First like this: ps.setTimestamp(1  ts);and then like this ps.setTimestamp(1  ts  Calendar.getInstance());In this example  both of the methods should use the default Calendar to convert the timestamp to a string. However  I see that they generate different strings:2010-04-20 15:17:36.0 vs 2010-04-20 03:17:36Note there are two differences:1) The method that takes a Calendar object does not show the fraction part (.0)2) The method that takes a Calendar object is 12 hours off (03 instead of 15),0,0
Broken logic for avoiding testing across midnight in TimestampArithTest,TimestampArithTest's decorator has this code to avoid failures in case the test starts close to midnight: /* Make sure that we are not so close to midnight that TODAY might be yesterday before we are finished using it. */ while (calendar.get(Calendar.HOUR) == 23 &amp;&amp; calendar.get(Calendar.MINUTE) &gt;= 58) Unknown macro: { try { Thread.sleep((60 - calendar.get(Calendar.SECOND)) * 1000); } catch (InterruptedException ie) { // ignore it } } There are at least three problems with this code:1) (calendar.get(Calendar.HOUR) == 23) never evaluates to true  because calendar.get(Calendar.HOUR) returns values in the range 0-11. Calendar.HOUR_OF_DAY should be used instead.2) If the current time is after 23:58 and before 23:59  the code sleeps until 23:59  the test will wait until 23:59 before it starts  making it even more likely that it will cross midnight while running.3) The code is executed after the Calendar object has been initialized  so if this code is ever triggered and waits until after midnight  the TODAY field is guaranteed to be yesterday when the test starts executing.,0,0
Expose names of top-level test suites for easier scripting,I sometimes run each of the top-level JUnit test suites individually so that they can be run in parallel and complete faster. It would be useful if AllPackages could expose the list of suites to allow scripting of such tasks without needing to change the script when a new suite is added.,0,0
BaseTestCase.execJavaCmd() does not work with weme 6.2,Spawning a java process with BaseTestCase.execJavaCmd() does not work with weme 6.2  I think because the boot classpath does not get passed. This issue came up in DERBY-4179. After this issue is fixed  BootLockTest should be enabled for weme.The error is actually.JVMJ9VM011W Unable to load jclfoun10_24: The specified module could not be found.JVMEXEX013E Internal VM error: Failed to create Java VMJVMEXEX014I Run C:/cygwin/ibmsvn/ntsoftware/weme6.2/bin/j9.exe -help for usageexecJavaProcess does pick up the j9 executable but does not pass on the other settings.This is how my script invokes the test with j9. It probably has a lot of legacy system properties not needed  but I suppose execJavaCmd should just pass along all system properties  but I don't know how it would get the bootclasspath. Perhaps -Dbootcp was a way to pass it on in the old harness.c:/cygwin/ibmsvn/ntsoftware/weme6.2/bin/j9 -jcl:foun11 -DderbyTesting.serverhost=localhost -DderbyTesting.clienthost=localhost -Demma.active= -Xbootclasspath/a:c:/cygwin/ibmsvn/ntsoftware/weme6.2/lib/jdbc.jar -Dbootcp=c:/cygwin/ibmsvn/ntsoftware/weme6.2/lib/jdbc.jar junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.store.BootLockTest Otherwise  currently I think the method is only used in replication and network server  but am not sure.,0,0
Hidden assumptions in FromVTI.makeRestriction(),FromVTI.makeRestriction() has this code to strip away Boolean constants from AND and OR expressions: // strip off trailing vacuous constant if present if ( andOperator.getRightOperand() instanceof BooleanConstantNode ) { return makeRestriction( andOperator.getLeftOperand()  columnNameMap ); }and // strip off trailing vacuous constant if present if ( orOperator.getRightOperand() instanceof BooleanConstantNode ) { return makeRestriction( orOperator.getLeftOperand()  columnNameMap ); }The code for AND will only work as expected if the right operand is TRUE. The code for OR only works correctly if the right operand is FALSE.I'm not sure if this can ever result in user-visible bugs  since Boolean constants are usually removed before we get to this point in the code. The predicate has probably been transformed to conjunctive normal form  in which Boolean constants in the right operand of an AndNode or an OrNode in fact is always TRUE or FALSE  respectively.I think this code either should be changed to work regardless of the value of the constant in the right operand  or the assumption that the predicate is on conjunctive normal form should be documented in the comments (and perhaps also checked in an assert statement).,0,0
Reduce size of encoding buffer for short character values,When inserting character values Derby converts from Java char to an on-disk encoding of UTF-8. To to this  the user stream is read and the resulting bytes after conversion are placed in a 'translation buffer'. The default size of the buffer is 32 KB. When inserting a lot of short values  the pressure on the Java garbage collector is unnecessary high and the allocation/GC also causes a somewhat higher CPU usage.This effect of this issue can easily be reduced by sizing the buffer in the appropriate cases.,0,1
Write a regression test to verify the behavior of ResultSet.getBoolean(),The JDBC spec partially defines the expected behavior of ResultSet.getBoolean(). It would be good to have a regression test which tracks Derby's actual implementation. For the moment  it appears that Derby conforms to the defined behavior  does something reasonable in the undefined cases  and behaves the same way in the embedded and client drivers.The behavior of ResultSet.getBoolean() does not appear to have been defined until JDBC 4. Here is the JDBC 4 javadoc:'If the designated column has a datatype of CHAR or VARCHAR and contains a '0' or has a datatype of BIT  TINYINT  SMALLINT  INTEGER or BIGINT and contains a 0  a value of false is returned. If the designated column has a datatype of CHAR or VARCHAR and contains a '1' or has a datatype of BIT  TINYINT  SMALLINT  INTEGER or BIGINT and contains a 1  a value of true is returned.' The behavior for those datatypes is not specified if the actual value is not 0 or 1. However  in a private communication I have the following statement of intent from Lance Andersen  the JDBC spec lead:'Note: Please refer to your driver documentation for the return value when the designated column contains a values other than '0'  0  '1' or 1.'In addition  the behavior for other datatypes is not specified. Some day it might be good if Derby's documentation described our behavior in the unspecified cases. Here it is:1) ResultSet.getBoolean() on LONG VARCHAR behaves like CHAR and VARCHAR2) ResultSet.getBoolean() on DECIMAL  REAL  DOUBLE  and NUMERIC behaves like INTEGER.3) Derby raises an exception if you call ResultSet.getBoolean() on BLOB  CHAR FOR BIT DATA  CLOB  DATE  LONG VARCHAR FOR BIT DATA  TIME  TIMESTAMP  or VARCHAR FOR BIT DATA.4) You can't even directly select an XML value.,0,0
Unidiomatic error handling in TimestampArithTest,TimestampArithTest contains some error handling code that prevents the underlying error from being reported to the JUnit framework  and it may even terminate the JVM running the tests on some errors. Examples:This code prints the stack trace of the underlying error to the terminal  but it won't be included in the report from the JUnit framework: printStackTrace(sqle); fail('Unexpected exception from statement '' + sql + ''');This code terminates the JVM on error  preventing subsequent tests from running  and also preventing the JUnit framework to report the results from the tests that did run: } catch (Exception e) { System.out.println(s + ' is not a proper timestamp string.'); System.out.println(e.getClass().getName() + ': ' + e.getMessage()); e.printStackTrace(); System.exit(1); return null; },0,0
Dead/unreachable code in OpenConglomerate.lockPositionForWrite(),OpenConglomerate.lockPositionForWrite() contains this code twice: if (!waitForLock) { // throw lock timeout error. throw StandardException.newException(SQLState.LOCK_TIMEOUT); }The second occurrence of this code can never end up throwing an exception  since waitForLock is guaranteed to be true there because of the identical check a couple of lines above. (Judging by the similar method lockPositionForRead()  it is probably the first check that should be removed  so that the latch on the page is released before the exception is thrown.)Also  the method is always called with forInsert==false  so the forInsert parameter can be removed. (I also suspect that the method doesn't work correctly if ever used in an insert operation  since it calls latchPage(RowPosition) which will unlatch the page if the row isn't found on the page  and I assume that a row that is about to be inserted does not exist yet.),0,0
Too few arguments when generating AM_RECORD_NOT_FOUND error,The message for AM_RECORD_NOT_FOUND has three parameters  but all the methods that generate an exception with that message  only use two of them. So the generated message ends up looking like this:ERROR XSAM6: Record {2} on page 7 in container 625 not found.whereas it should have looked like this:ERROR XSAM6: Record 7 on page 1 in container 625 not found.I don't know if these messages ever make it all the way up to the application  since they are typically caught by this code block in TableScanResultSet: if (se.getMessageId().equals(SQLState.AM_RECORD_NOT_FOUND)) { // Somehow the row got deleted between the above // doesCurrentPositionQualify() call and here (one way is if // this scan is read uncommitted isolation level). return null; }But they may be logged in derby.log if the log severity level is set appropriately.,0,0
Unions between BOOLEAN and non-BOOLEAN datatypes should be rejected,DERBY-4684 fixed problems in implicit casts to BOOLEAN. However  the query which created the implicit casts should raise an error for other reasons:select isindex from sys.sysconglomerates where conglomeratename = 'foo'unionvalues ( 'true' )This should fail because if either of the datatypes being UNIONed is BOOLEAN  then both should be BOOLEAN. Here is my reasoning  copied from the related discussion on DERBY:1) The rules for determining whether two datatypes are union compatible are stated in the SQL Standard in part 2  section 7.3 (&lt;query expression&gt;)  syntax rule 20.b.ii.2) That  in turn  refers the reader to section 9.3 (Result of data type combinations).3) Section 9.3  syntax rule 3.g says that if either of two values to be merged is BOOLEAN  then both must be BOOLEAN.,0,0
column rename looses 'identity' attribute.,renaming an identity column causes the column to loose its 'identity' attribute.you can reproduce the problem as follows:CREATE TABLE njr_version ( id INTEGER generated always as identity  databaseVersion INTEGER);insert into njr_version (databaseVersion) values (10);&#8211; column inserted successfully.rename column njr_version.id to idVersion;insert into njr_version (databaseVersion) values (10);Error: Column 'IDVERSION' cannot accept a NULL value.To compound this problem there is no way to restore the renamed column's identity attribute as the alter command doesn't let you set an identity attribute. The only work around is to create a new table and copy the data across.,0,0
Internal assignment of tablenumer  columnnumber looks wrong in query tree  although no ill effects are seen.,While looking into derby-4679  I also looked at the query inderby-2526 to validate that my changes also worked for that variant ofthe problem.During inspection of the query trees after the bind phase  I found oneinstance in which the pair (tablenumber  columnnumber) of a columnreference was wrong. Although it did not seem to impact the queryresult  I note it here as as something we should probably investiateas it may be a symptom an underlying problem  or a potential forfuture problems.The query looks like this:select b3.* from b3 join bvw on (b3.c8 = bvw.c5) join b4 on (bvw.c1 = b4.c7) where b4.c4 = 42'and the underlying DDL is this:create table b2 (c1 int  c2 int  c3 char(1)  c4 int  c5 int  c6 int);create table b4 (c7 int  c4 int  c6 int);create table b3 (c8 int  c9 int  c5 int  c6 int);create table b (c1 int  c2 int  c3 char(1)  c4 int  c5 int  c6 int);create view bvw (c5  c1  c2  c3  c4) asselect c5  c1  c2  c3  c4 from b2 unionselect c5  c1  c2  c3  c4 from b;create view bvw2 (c1  c2  c3  c4  c5) asAfter the bind phase  the join clause 'bvw.c1 = b4.c7' has thefollowing entry for the column reference bvw.C1: tableNumber: 1 columnNumber: 6The problem is that the node with tablenumber 1 is bvw  which is theview with the subquery for the union  which has only 5 resultingcolumns  so 6 must be wrong. Although both the view participant tables(b  b2) both have six column  the view does not. In any case  C1 iscolumn 2 in the view and column 2 in the two union selects from both band b2.C1 is however  column 6 of the join node resulting from 'select b3.*from b3 join bvw on (b3.c8 = bvw.c5)'  but the correct table number forthat would be 5  not 1.So  it would seem the table number has been bound to the bvw view'sresult set  but the column number has been bound to the innermost joinnode's result set. This looks worrying to me.See derby.log attached for the full dump of the query tree after thebind phase.sourceResultSet:  org.apache.derby.impl.sql.compile.FromSubquery@12789d2 correlation Name: BVW null tableNumber 1 &lt;------------------------------------------- Note! level 0 resultSetNumber: 0 referencedTableMap: null statementResultSet: false resultColumns:  org.apache.derby.impl.sql.compile.ResultColumnList@c943d1 indexRow: false orderBySelect: 0 &#91;0&#93;:  org.apache.derby.impl.sql.compile.ResultColumn@d3c6a3 **truncated** &#91;1&#93;:  org.apache.derby.impl.sql.compile.ResultColumn@18352d8 exposedName: C1 name: C1 tableName: null isDefaultColumn: false wasDefaultColumn: false isNameGenerated: false sourceTableName: B2 type: INTEGER columnDescriptor: null isGenerated: false isGeneratedForUnmatchedColumnInInsert: false isGroupingColumn: false isReferenced: true isRedundant: false virtualColumnId: 2 resultSetNumber: -1 dataTypeServices: INTEGER expression:  org.apache.derby.impl.sql.compile.VirtualColumnNode@b40ec4 dataTypeServices: null sourceColumn:  org.apache.derby.impl.sql.compile.ResultColumn@1d95da8 **truncated** sourceResultSet:  org.apache.derby.impl.sql.compile.UnionNode@14d7745 **truncated** &#91;2&#93;:  org.apache.derby.impl.sql.compile.ResultColumn@13576a2 exposedName: C2 name: C2 tableName: null isDefaultColumn: false wasDefaultColumn: false isNameGenerated: false sourceTableName: B2 type: INTEGER columnDescriptor: null isGenerated: false isGeneratedForUnmatchedColumnInInsert: false isGroupingColumn: false isReferenced: true isRedundant: false virtualColumnId: 3 resultSetNumber: -1 dataTypeServices: INTEGER expression:  org.apache.derby.impl.sql.compile.VirtualColumnNode@ff8c74 dataTypeServices: null sourceColumn:  org.apache.derby.impl.sql.compile.ResultColumn@61736e **truncated** sourceResultSet:  org.apache.derby.impl.sql.compile.UnionNode@14d7745 **truncated** &#91;3&#93;:  org.apache.derby.impl.sql.compile.ResultColumn@15e2ccd exposedName: C3 name: C3 tableName: null isDefaultColumn: false wasDefaultColumn: false isNameGenerated: false sourceTableName: B2 type: CHAR(1) columnDescriptor: null isGenerated: false isGeneratedForUnmatchedColumnInInsert: false isGroupingColumn: false isReferenced: true isRedundant: false virtualColumnId: 4 resultSetNumber: -1 dataTypeServices: CHAR(1) expression:  org.apache.derby.impl.sql.compile.VirtualColumnNode@1cf7491 dataTypeServices: null sourceColumn:  org.apache.derby.impl.sql.compile.ResultColumn@11946c2 **truncated** sourceResultSet:  org.apache.derby.impl.sql.compile.UnionNode@14d7745 **truncated** &#91;4&#93;: &lt;----------------------------------------- highest column number is 5 (index is zero-based) org.apache.derby.impl.sql.compile.ResultColumn@edf730 exposedName: C4 name: C4 tableName: null isDefaultColumn: false wasDefaultColumn: false isNameGenerated: false sourceTableName: B2 type: INTEGER columnDescriptor: null isGenerated: false isGeneratedForUnmatchedColumnInInsert: false isGroupingColumn: false isReferenced: true isRedundant: false virtualColumnId: 5 resultSetNumber: -1 dataTypeServices: INTEGER expression:  org.apache.derby.impl.sql.compile.VirtualColumnNode@ff94b1 dataTypeServices: null sourceColumn:  org.apache.derby.impl.sql.compile.ResultColumn@17a4989 **truncated** sourceResultSet:  org.apache.derby.impl.sql.compile.UnionNode@14d7745 **truncated** subquery:  org.apache.derby.impl.sql.compile.UnionNode@14d7745 **truncated**,0,0
Add method to obtain a bogus port in TestConfiguration,In some cases one needs to obtain a port number on which there is no Derby network server.Today this is solved in an ad-hoc way  for instance by using the current port minus one. When running tests in parallel  there is a chance that a port where there actually is a Derby network server listening is picked.As a start  I suggest that the bogus port is allocated to the last port in the port range configured for the run: baseport + MAX_PORTS_USED -1.,0,0
Complex nested joins problems,I ran a randomized test for nested joins against PostgreSQL  Derby  and H2  and found some problems with Derby. The queries below throw NullPointerExceptions; the last query an assertion. The test case is here: http://code.google.com/p/h2database/source/browse/trunk/h2/src/test/org/h2/test/db/TestNestedJoins.java . There are probably shorter queries that are problematic  but I can't test it because Derby closes the connection after the assertion.create table t0(x int);create table t1(x int);create table t2(x int);create table t3(x int);create table t4(x int);insert into t4 values(0);insert into t4 values(1);insert into t4 values(2);insert into t4 values(3);create table t5(x int);insert into t5 values(0);insert into t5 values(1);insert into t5 values(2);insert into t5 values(3);insert into t5 values(4);create table t6(x int);insert into t6 values(0);insert into t6 values(1);insert into t6 values(2);insert into t6 values(3);insert into t6 values(4);insert into t6 values(5);create table t7(x int);insert into t7 values(0);insert into t7 values(1);insert into t7 values(2);insert into t7 values(3);insert into t7 values(4);insert into t7 values(5);insert into t7 values(6);create table t8(x int);insert into t8 values(0);insert into t8 values(1);insert into t8 values(2);insert into t8 values(3);insert into t8 values(4);insert into t8 values(5);insert into t8 values(6);insert into t8 values(7);create table t9(x int);insert into t9 values(0);insert into t9 values(1);insert into t9 values(2);insert into t9 values(3);insert into t9 values(4);insert into t9 values(5);insert into t9 values(6);insert into t9 values(7);insert into t9 values(8);insert into t0 values(1);insert into t1 values(2);insert into t0 values(3);insert into t1 values(3);insert into t2 values(4);insert into t0 values(5);insert into t2 values(5);insert into t1 values(6);insert into t2 values(6);insert into t0 values(7);insert into t1 values(7);insert into t2 values(7);insert into t3 values(8);insert into t0 values(9);insert into t3 values(9);insert into t1 values(10);insert into t3 values(10);insert into t0 values(11);insert into t1 values(11);insert into t3 values(11);insert into t2 values(12);insert into t3 values(12);insert into t0 values(13);insert into t2 values(13);insert into t3 values(13);insert into t1 values(14);insert into t2 values(14);insert into t3 values(14);insert into t0 values(15);insert into t1 values(15);insert into t2 values(15);insert into t3 values(15);select t0.x   t1.x   t2.x   t3.x   t4.x   t5.x   t6.x   t7.x   t8.x from (((t0 inner join ((t1 right outer join (t2 inner join t3 on t2.x = t3.x ) on t1.x = t2.x ) left outer join (t4 inner join t5 on t4.x = t5.x ) on t1.x = t4.x ) on t0.x = t2.x ) left outer join (t6 inner join t7 on t6.x = t7.x ) on t1.x = t6.x ) inner join t8 on t5.x = t8.x );select t0.x   t1.x   t2.x   t3.x   t4.x   t5.x   t6.x   t7.x from ((t0 right outer join t1 on t0.x = t1.x ) inner join (((t2 inner join (t3 left outer join t4 on t3.x = t4.x ) on t2.x = t3.x ) right outer join t5 on t2.x = t5.x ) left outer join (t6 inner join t7 on t6.x = t7.x ) on t4.x = t6.x ) on t0.x = t5.x );select t0.x   t1.x   t2.x   t3.x   t4.x   t5.x   t6.x   t7.x from ((((t0 left outer join t1 on t0.x = t1.x ) right outer join t2 on t0.x = t2.x ) right outer join t3 on t0.x = t3.x ) inner join ((t4 inner join t5 on t4.x = t5.x ) right outer join (t6 right outer join t7 on t6.x = t7.x ) on t4.x = t6.x ) on t1.x = t4.x );select t0.x   t1.x   t2.x   t3.x   t4.x   t5.x from (((t0 inner join t1 on t0.x = t1.x ) right outer join (t2 right outer join t3 on t2.x = t3.x ) on t0.x = t2.x ) inner join (t4 left outer join t5 on t4.x = t5.x ) on t1.x = t4.x );select t0.x   t1.x   t2.x   t3.x   t4.x   t5.x   t6.x from ((t0 right outer join (t1 right outer join (t2 left outer join (t3 left outer join t4 on t3.x = t4.x ) on t2.x = t3.x ) on t1.x = t3.x ) on t0.x = t1.x ) left outer join (t5 inner join t6 on t5.x = t6.x ) on t2.x = t5.x );,0,0
Enable BOOLEAN typed columns,Allow tables to have boolean columns.,0,0
add more information to the XACT_PROTOCOL_VIOLATION returned from store.,Improve the following message:ERROR 40XT0: An internal error was identified by RawStore module.At least add the state variables. Originally it wasn't expected that this error would ever fire  but it often does. It usuallyis caused by some previous bug and then something going wrong with the cleanup after the bug in an XA transaction.,0,0
StringIndexOutOfBoundsException on syntax error (invalid COMMIT),Start the network server on port 1527 on localhost.Run ant on the following:&lt;project default='all'&gt;  &lt;property environment='env' /&gt;  &lt;path id='derby.classpath.id'&gt;  &lt;fileset dir='${env.DERBY_LIB'&gt;  &lt;include name='derbynet.jar' /&gt;  &lt;include name='derbyclient.jar' /&gt;  &lt;/fileset&gt;  &lt;/path&gt;  &lt;target name='all'&gt;  &lt;sql driver='org.apache.derby.jdbc.ClientDriver' url='jdbc:derby://localhost:1527/derbyDB;create=true;user=derbyuser;passsword=derbypwd'  userid='derbyuser'  password='derbypwd'  classpathref='derby.classpath.id'  onerror='continue'&gt;create table mytable1 (mycol varchar(255)); commit;  &lt;/sql&gt;  &lt;/target&gt; &lt;/project&gt; On 10.5.3  I get &#91;sql&#93; Executing commands  &#91;sql&#93; Failed to execute: commit  &#91;sql&#93; java.sql.SQLSyntaxErrorException: Syntax error: Encountered 'commit'  at line 1  column 1.  &#91;sql&#93; 1 of 2 SQL statements executed successfully but on 10.6.1  I get &#91;sql&#93; Executing commands BUILD FAILED java.lang.StringIndexOutOfBoundsException: String index out of range: 6  at java.lang.String.charAt(String.java:686)  at org.apache.derby.client.am.Statement.isolateAnyInitialIdentifier(Unknown Source)  at org.apache.derby.client.am.Statement.getStatementToken(Unknown Source)  at org.apache.derby.client.am.Statement.parseSqlAndSetSqlModes(Unknown Source) ....,0,0
CheapDateFormatter returns incorrect and invalid date strings,CheapDateFormatter has multiple problems. These are the ones I'm aware of:1) On the boundary between non-leap years and leap years it will return first day of thirteenth month in previous year (for instance  2011-13-01 instead of 2012-01-01)2) It treats all years divisible by four as leap years. Those divisible by 100 and not by 400 are not leap years. It attempts to adjust for that (see the snippet below) but it always ends up setting leapYear=true if (year%4)==0. // It's a leap year if divisible by 4  unless divisible by 100  // unless divisible by 400. if ((year % 4L) == 0) { if ((year % 100L) == 0) { if ((year % 400L) == 0) { leapYear = true; } } leapYear = true; }3) More leap year trouble. To find out which year it is  it calculates the number of four year periods that have elapsed since 1970-01-01. A four year period is considered 365*3+366 days. Although most four year periods are of that length  some are shorter  so we'll get one day off starting from year 2100  two days off from year 2200  and so on.,0,0
DERBY-4601 added a new message to derby.log during engine shutdown and it changed the database shutdown message. Need to update docs with that information,DERBY-4601 added a new message to derby.log during engine shutdown and it changed the database shutdown message. Need to update docs with that information. I have found 2 places in our docs where we show examples of shutdown messages1)In Getting started Guide  under Creating a Derby database and running SQL statements section  we show a typical startup and shutdown message. That section will need to change2)In Derby Developer's Guide  under section Derby System -&gt; Shutting down the systemAn eg of engine shutdown message in derby.log is2010-07-23 18:59:24.078 GMT Thread&#91;main 5 main&#93; :Shutting down Derby EngineAn eg of database shutdown message is as follows2010-07-20 17:23:55.171 GMT:Shutting down instance 80220011-0129-f0e1-f479-0000000c5ef0 on database directory C:/p4clients/svnmain/client2/trunk/systest/out142/dbs/tours3 with class loader sun.misc.Launcher$AppClassLoader@3f6e3f6e (Notice that this message includes the name of the db getting shutdown. Before the changes for DERBY-4601 went in  we didn't include the name of the database),0,0
test failure in derbynet/testProtocol.java with ibm jvms,On Friday  I saw this failure:     Start: testProtocol jdk1.6.0 DerbyNetClient derbynetmats:derbynetmats 2010-07-31 00:18:53 ***308 add&gt; Test UNICODEMGR at level 1208 while sending UTF8 characters in RDBNAM&gt; PASSED&gt; Test UNICODEMGR at level 1208 while sending UTF8 characters in USRID and PASSWORD&gt; PASSED&gt; Test setting RDBNAM at ACCSEC *and* at SECCHK&gt; PASSEDTest Failed.    I assume it's related to the check-in for DERBY-4746 (revision 980800).,0,0
Files with missing ASF license headers,There are some files (consisting of creative works) without license headers in the repository. Some files are also using a different text for the Apache License header then the other files.I plan to add the license header after having verified that the files were uploaded to Jira with the grant license to ASF bullet ticked.The list of files I have identified so far  grouped based on the assumed action required.&#8212; Add license headerjava/testing/org/apache/derbyTesting/functionTests/tests/memory/TriggerTests.javajava/engine/org/apache/derby/impl/sql/catalog/XPLAINStatementDescriptor.javajava/engine/org/apache/derby/impl/sql/catalog/XPLAINScanPropsDescriptor.javajava/engine/org/apache/derby/impl/sql/catalog/XPLAINResultSetDescriptor.javajava/engine/org/apache/derby/impl/sql/catalog/XPLAINStatementTimingsDescriptor.javajava/engine/org/apache/derby/impl/sql/catalog/XPLAINSortPropsDescriptor.javajava/engine/org/apache/derby/impl/sql/catalog/XPLAINResultSetTimingsDescriptor.javajava/engine/org/apache/derby/impl/sql/catalog/XPLAINTableDescriptor.javajava/engine/org/apache/derby/impl/sql/execute/xplain/XPLAINSystemTableVisitor.javajava/engine/org/apache/derby/impl/sql/execute/xplain/XPLAINDefaultVisitor.javajava/engine/org/apache/derby/impl/sql/execute/xplain/XPLAINFactory.javajava/engine/org/apache/derby/impl/sql/execute/xplain/XPLAINUtil.javajava/engine/org/apache/derby/iapi/sql/execute/xplain/XPLAINFactoryIF.javajava/engine/org/apache/derby/iapi/sql/execute/xplain/XPLAINable.javajava/engine/org/apache/derby/iapi/sql/execute/xplain/XPLAINVisitor.javajava/tools/org/apache/derby/tools/PlanExporter.javajava/tools/org/apache/derby/impl/tools/planexporter/TreeNode.javajava/tools/org/apache/derby/impl/tools/planexporter/AccessDatabase.javajava/tools/org/apache/derby/impl/tools/planexporter/CreateHTMLFile.javajava/tools/org/apache/derby/impl/tools/planexporter/CreateXMLFile.java&#8212; Update license headerjava/engine/org/apache/derby/impl/services/jmxnone/NoManagementService.javajava/engine/org/apache/derby/impl/services/jmx/JMXManagementService.javajava/engine/org/apache/derby/iapi/services/jmx/ManagementService.java&#8212; Consider adding headerjava/shared/org/apache/derby/shared/common/sanity/SanityState.javajava/shared/org/apache/derby/shared/common/sanity/SanityState.tmpljava/tools/org/apache/derby/impl/tools/planexporter/resources/advancedViewXSL.xsljava/tools/org/apache/derby/impl/tools/planexporter/resources/vanilla_html.xsljava/tools/org/apache/derby/impl/tools/planexporter/resources/advancedViewXSL2.xslThe SanityState classes seem to come from somewhere. Does anyone have the history? Can we add the ASF license header?The xsl files also look like creative works to me. Any objections on that?,0,0
NPE while inserting into a table which has a generated column and an insert trigger,The following script generates an NPE on the concluding insert:connect 'jdbc:derby:memory:dummy;create=true';create function getRegion( v int )returns varchar( 20 )language java parameter style java deterministic no sqlexternal name 'java.lang.Integer.toString';create table orders( orderID bigint primary key  salesPrice int not null  region generated always as ( getRegion( salesPrice ) ));create table dummy( a int );create trigger newOrderTriggerafter insert on ordersfor each rowinsert into dummy( a ) values ( 1 );insert into orders( orderID  salesPrice ) values ( 1  2 );------------------------Here is the NPE:java.lang.NullPointerException at org.apache.derby.impl.sql.execute.DMLWriteResultSet.objectifyStreams(Unknown Source) at org.apache.derby.impl.sql.execute.DMLWriteResultSet.getNextRowCore(Unknown Source) at org.apache.derby.impl.sql.execute.InsertResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source) at org.apache.derby.impl.tools.ij.Main.main(Unknown Source) at org.apache.derby.tools.ij.main(Unknown Source),0,0
Missing escape for apostrophes in many messages,The properties file format requires that single-quote characters are escaped with an extra single-quote. A number of messages don't follow this rule.Take this example from the Italian localization:42X34=Esiste un parametro ? nell'elenco di selezione. Ci/u00F2 non /u00E8 consentito.Note that there's only a single apostrophe in 'nell'elenco' above. When this message is printed  the apostrophe will be omitted:$ LC_ALL=it_IT.UTF-8 java -jar derbyrun.jar ijVersione ij 10.6ij&gt; connect 'jdbc:derby:db;create=true';ij&gt; select ? from sys.systables;ERRORE 42X34: Esiste un parametro ? nellelenco di selezione. Ciﾃｲ non ﾃｨ consentito.We should go through the message files and add extra apostrophes where they are missing.,0,0
Sequences do not work in INSERT/SELECT,Using sequence in SELECT works fine whereas the same SELECT query used in INSERT/SELECT results in 'The statement references the following sequence more than once' error. This happens even though the SELECT in question returns exactly 1 row of data.The Reference Manual states 1. ' NEXT VALUE FOR expression may occur in the following places: SELECT statement: As part of the expression defining a returned column in a SELECT list' and 2. ' NEXT VALUE expression may not appear in any of these situations: CASE expression  WHERE clause  ORDER BY clause  Aggregate expression  ROW_NUMBER function  DISTINCT select list'.Nowhere a restriction on INSERT/SELECT is mentioned. Additionally  other databases (i.e. Oracle) support use of sequences in INSERT/SELECT.Therefore  I consider it a bug.,0,0
setTimestamp() methods don't agree on trailing zeros,With the statement VALUES CAST(? AS VARCHAR(29))PreparedStatement.setTimestamp(int Timestamp) and PreparedStatement.setTimestamp(int Timestamp Calendar) don't agree on what to do with trailing zeros in the nanosecond component. The method that doesn't take a Calendar argument  removes trailing zeros. The method that takes a Calendar object appends zeros so that the nanosecond component always has nine digits. (Both methods have a special case when nanoseconds is zero  and they agree on adding just a single zero after the decimal point in that case.)The format used by PreparedStatement.setTimestamp(int Timestamp) matches what java.sql.Timestamp.toString() returns (in fact  it uses Timestamp.toString() internally to produce the string representation)  and I think it would be reasonable to use that format for both the methods.,0,0
ReplicationMessageTransmit run does not unwrap PrivilegedActionException which can lead to failure of replicationTests.ReplicationRun_Local_StateTest_part1_1,One of our nightly tests failed with the exception (db path slightly edited) below.Looking at the source of org.apache.derby.impl.store.replication.net.ReplicationMessageTransmit.run  it seems that the code does not completely unwrap the PrivilegedActionException (compared to how this is done in for example org.apache.derbyTesting.functionTests.util.PrivilegedFileOpsForTests.getFileInputStream()).It could be that the test is looking for the java.io.IOException  which it doesn't get (it gets the PrivilegedActionException instead).----------------------1) testReplication_Local_StateTest_part1_1(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_1)junit.framework.AssertionFailedError: Got -1 XRE42 DERBY SQL error: SQLCODE: -1  SQLSTATE: XRE42  SQLERRMC: Replicated database '/test/results/db_slave/wombat' shutdown.. Expected XRE41 at java.lang.Throwable.&lt;init&gt;(Throwable.java:67) at junit.framework.AssertionFailedError.&lt;init&gt;(AssertionFailedError.java:11) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.assertException(ReplicationRun.java:3427) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_1._testPostStartedMasterAndSlave_StopSlave(ReplicationRun_Local_StateTest_part1_1.java:150) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_1.testReplication_Local_StateTest_part1_1(ReplicationRun_Local_StateTest_part1_1.java:134) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:48) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:201) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16)----------------------The exception in the db_master-derby.log was:------------------------Database Class Loader started - derby.database.classpath=''---- BEGIN REPLICATION ERROR MESSAGE (9/13/10 9:40 AM) ----Replication slave got a fatal error for database '/test/results/db_master/wombat'. Replication will be stopped.ERROR XRE04: Could not establish a connection to the peer of the replicated database '/test/results/db_master/wombat' on address 'localhost:8888'. at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.impl.store.replication.master.MasterController.setupConnection(Unknown Source) at org.apache.derby.impl.store.replication.master.MasterController.startMaster(Unknown Source) at org.apache.derby.impl.store.raw.RawStore.startReplicationMaster(Unknown Source) at org.apache.derby.impl.store.access.RAMAccessManager.startReplicationMaster(Unknown Source) at org.apache.derby.impl.db.BasicDatabase.startReplicationMaster(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleStartReplicationMaster(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(Unknown Source) at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Unknown Source) at org.apache.derby.jdbc.InternalDriver.connect(Unknown Source) at org.apache.derby.jdbc.AutoloadedDriver.connect(Unknown Source) at org.apache.derby.impl.drda.Database.makeConnection(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.getConnFromDatabaseName(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.verifyUserIdPassword(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.parseSECCHK(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.parseDRDAConnection(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)Caused by: java.security.PrivilegedActionException: java.net.ConnectException: Connection refused at java.security.AccessController.doPrivileged(AccessController.java:255) at org.apache.derby.impl.store.replication.net.ReplicationMessageTransmit.initConnection(Unknown Source) ... 17 moreCaused by: java.net.ConnectException: Connection refused at java.net.PlainSocketImpl.socketConnect(Native Method) at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:352) at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:214) at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:201) at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:378) at java.net.Socket.connect(Socket.java:528) at org.apache.derby.impl.store.replication.net.ReplicationMessageTransmit$1.run(Unknown Source) at java.security.AccessController.doPrivileged(AccessController.java:251) ... 18 more============= begin nested exception  level (1) ===========java.security.PrivilegedActionException: java.net.ConnectException: Connection refused at java.security.AccessController.doPrivileged(AccessController.java:255) at org.apache.derby.impl.store.replication.net.ReplicationMessageTransmit.initConnection(Unknown Source) at org.apache.derby.impl.store.replication.master.MasterController.setupConnection(Unknown Source) at org.apache.derby.impl.store.replication.master.MasterController.startMaster(Unknown Source) at org.apache.derby.impl.store.raw.RawStore.startReplicationMaster(Unknown Source) at org.apache.derby.impl.store.access.RAMAccessManager.startReplicationMaster(Unknown Source) at org.apache.derby.impl.db.BasicDatabase.startReplicationMaster(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleStartReplicationMaster(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(Unknown Source) at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Unknown Source) at org.apache.derby.jdbc.InternalDriver.connect(Unknown Source) at org.apache.derby.jdbc.AutoloadedDriver.connect(Unknown Source) at org.apache.derby.impl.drda.Database.makeConnection(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.getConnFromDatabaseName(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.verifyUserIdPassword(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.parseSECCHK(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.parseDRDAConnection(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)Caused by: java.net.ConnectException: Connection refused at java.net.PlainSocketImpl.socketConnect(Native Method) at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:352) at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:214) at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:201) at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:378) at java.net.Socket.connect(Socket.java:528) at org.apache.derby.impl.store.replication.net.ReplicationMessageTransmit$1.run(Unknown Source) at java.security.AccessController.doPrivileged(AccessController.java:251) ... 18 more============= end nested exception  level (1) ======================== begin nested exception  level (2) ===========java.net.ConnectException: Connection refused at java.net.PlainSocketImpl.socketConnect(Native Method) at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:352) at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:214) at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:201) at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:378) at java.net.Socket.connect(Socket.java:528) at org.apache.derby.impl.store.replication.net.ReplicationMessageTransmit$1.run(Unknown Source) at java.security.AccessController.doPrivileged(AccessController.java:251) at org.apache.derby.impl.store.replication.net.ReplicationMessageTransmit.initConnection(Unknown Source) at org.apache.derby.impl.store.replication.master.MasterController.setupConnection(Unknown Source) at org.apache.derby.impl.store.replication.master.MasterController.startMaster(Unknown Source) at org.apache.derby.impl.store.raw.RawStore.startReplicationMaster(Unknown Source) at org.apache.derby.impl.store.access.RAMAccessManager.startReplicationMaster(Unknown Source) at org.apache.derby.impl.db.BasicDatabase.startReplicationMaster(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleStartReplicationMaster(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(Unknown Source) at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Unknown Source) at org.apache.derby.jdbc.InternalDriver.connect(Unknown Source) at org.apache.derby.jdbc.AutoloadedDriver.connect(Unknown Source) at org.apache.derby.impl.drda.Database.makeConnection(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.getConnFromDatabaseName(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.verifyUserIdPassword(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.parseSECCHK(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.parseDRDAConnection(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source) at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)============= end nested exception  level (2) ===========,0,0
Override mechanism for modules.properties works backwards,It is possible to override the properties in org/apache/derby/modules.properties by putting your own version of it somewhere on the classpath. BaseMonitor.getDefaultModuleProperties() apparently intends to use values from the first modules.properties file that mentions a property: String key = (String) newKeys.nextElement(); if( moduleList.contains( key)) // RESOLVE how do we localize messages before we have finished initialization? report( 'Ignored duplicate property ' + key + ' in ' + modulesPropertiesURL.toString()); else moduleList.setProperty( key  otherList.getProperty( key));However  moduleList.contains(key) doesn't look for a key in moduleList  it looks for a property value. This code should have used containsKey() instead.Beacuse of this  the last modules.properties on the classpath will take precedence over the ones earlier on the classpath. So if you for example have two different versions of derby.jar in the classpath  the engine will use the classes from the first jar and modules.properties from the last jar.,0,0
Errors should be displayed if using wrong CLASSPATH to make documentation target for release,When making Derby documentation for 10.6.2.1 release  no error was prompt when wrong version of java is being used or wrong value for CLASSPATH.In order to make Derby documentation  the release manager has to set CLASSPATH to include: fop.jar  avalon-framework-cvs-20020806.jar  and batik.jar files located in %DOC_ROOT%/trunk/lib/ for PDF output. When using wrong CLASSPATH to build pdf documentation  no error was prompt and no PDF output was created. Error will be more intuitive that the build was not successful.,0,0
Re-compilation may cause duplicate entries in the XPLAIN table,If happening at the right moment  a re-compilation request may cause duplicate entries in the XPLAIN statement tables.I have only confirmed this for the SYSXPLAIN_STATEMENTS table  and I do not know if the other XPLAIN tables are affected.The error is highly intermittent  and so far I have only been able to trigger it when testing the automatic index statistics update prototype.See the attached stack-trace for some more details.,0,0
Missing doPrivileged in DatabaseClasses.WriteClassFile(),One of my test runs failed with the following error:1) testAllUncommittedReclaim(org.apache.derbyTesting.functionTests.tests.store.AccessTest)java.sql.SQLException: Java exception: 'access denied (java.io.FilePermission /export/home/tmp/kh160127/derbyall/system/ac72985692x012bxc9d4x9594xffffa08cb27a0.class write): java.security.AccessControlException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)(...)Caused by: java.security.AccessControlException: access denied (java.io.FilePermission /export/home/tmp/kh160127/derbyall/system/ac72985692x012bxc9d4x9594xffffa08cb27a0.class write) at java.security.AccessControlContext.checkPermission(AccessControlContext.java:323) at java.security.AccessController.checkPermission(AccessController.java:546) at java.lang.SecurityManager.checkPermission(SecurityManager.java:532) at java.lang.SecurityManager.checkWrite(SecurityManager.java:962) at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:169) at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:131) at org.apache.derby.impl.services.reflect.DatabaseClasses.WriteClassFile(Unknown Source) at org.apache.derby.impl.services.reflect.DatabaseClasses.loadGeneratedClass(Unknown Source)(...)I think the underlying error is an OutOfMemoryError  because I have seen tests running out of permgen space with the same configuration lately. But that error never gets all the way out to the test framework because of the above file permission error.When DatabaseClasses.loadGeneratedClass() fails with a LinkageError or a VirtualMachineError (the super-class of OutOfMemoryError)  it attempts to dump the generated class to disk. But since the tests run under a security manager  and the code writes the class to disk isn't wrapped in a privileged block  the dumping of extra debug info fails and hides the original error.,1,1
Simplify SYSCS_BULK_INSERT with IdUtil.mkQualifiedName(),SystemProcedures.SYSCS_BULK_INSERT contains this piece of code: String entityName = IdUtil.normalToDelimited(tableName); if (schemaName != null) { entityName = IdUtil.normalToDelimited(schemaName) + '.' + entityName; }The helper method IdUtil.mkQualifiedName() could do the exact same in one line.,0,0
NullPointerException in testBoundaries with ibm jvm 1.6,With the line skipping the testBoundaries fixture of the InternationalConnectTest commented out  I get the following stack when I run the test with ibm 1.6:1) testBoundaries(org.apache.derbyTesting.functionTests.tests.jdbcapi.InternationalConnectTest)java.sql.SQLException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XJ001  SQLERRMC: java.lang.NullPointerExceptionXJ001.U at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:96) at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:358) at org.apache.derby.jdbc.ClientDriver.connect(ClientDriver.java:149) at java.sql.DriverManager.getConnection(DriverManager.java:322) at java.sql.DriverManager.getConnection(DriverManager.java:273) at org.apache.derbyTesting.functionTests.tests.jdbcapi.InternationalConnectTest.testBoundaries(InternationalConnectTest.java:111) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:48) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)Caused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XJ001  SQLERRMC: java.lang.NullPointerExceptionXJ001.U at org.apache.derby.client.am.Connection.completeSqlca(Connection.java:2117) at org.apache.derby.client.net.NetConnectionReply.parseRdbAccessFailed(NetConnectionReply.java:541) at org.apache.derby.client.net.NetConnectionReply.parseAccessRdbError(NetConnectionReply.java:434) at org.apache.derby.client.net.NetConnectionReply.parseACCRDBreply(NetConnectionReply.java:297) at org.apache.derby.client.net.NetConnectionReply.readAccessDatabase(NetConnectionReply.java:121) at org.apache.derby.client.net.NetConnection.readSecurityCheckAndAccessRdb(NetConnection.java:846) at org.apache.derby.client.net.NetConnection.flowSecurityCheckAndAccessRdb(NetConnection.java:769) at org.apache.derby.client.net.NetConnection.flowUSRIDONLconnect(NetConnection.java:601) at org.apache.derby.client.net.NetConnection.flowConnect(NetConnection.java:408) at org.apache.derby.client.net.NetConnection.&lt;init&gt;(NetConnection.java:218) at org.apache.derby.client.net.NetConnection40.&lt;init&gt;(NetConnection40.java:77) at org.apache.derby.client.net.ClientJDBCObjectFactoryImpl40.newNetConnection(ClientJDBCObjectFactoryImpl40.java:269) at org.apache.derby.jdbc.ClientDriver.connect(ClientDriver.java:140) ... 35 moreThis is after the latest check in for DERBY-4836 (revision 1028035).I'll attach derby.log.,0,0
Unchecked warnings in JMXManagementService and VTI demos,These warnings I only see if java15compile.classpath points to Java 6 class libraries (either set explicitly in ant.properties  or implicitly by the property setter): &#91;javac&#93; /code/derby/trunk2/java/engine/org/apache/derby/impl/services/jmx/JMXManagementService.java:215: warning: &#91;unchecked&#93; unchecked conversion &#91;javac&#93; found : java.lang.Class &#91;javac&#93; required: java.lang.Class&lt;java.lang.Object&gt; &#91;javac&#93; new StandardMBean(bean  beanInterface) { &#91;javac&#93; ^ &#91;javac&#93; /code/derby/trunk2/java/engine/org/apache/derby/impl/services/jmx/JMXManagementService.java:215: warning: &#91;unchecked&#93; unchecked method invocation: &lt;T&gt;StandardMBean(T java.lang.Class&lt;T&gt;) in javax.management.StandardMBean is applied to (java.lang.Object java.lang.Class) &#91;javac&#93; new StandardMBean(bean  beanInterface) { &#91;javac&#93; ^ &#91;javac&#93; 2 warnings &#91;javac&#93; /code/derby/trunk2/java/demo/vtis/java/org/apache/derbyDemo/vtis/core/QueryVTIHelper.java:185: warning: &#91;unchecked&#93; unchecked call to getMethod(java.lang.String java.lang.Class&lt;?&gt;...) as a member of the raw type java.lang.Class &#91;javac&#93; ( methodName  new Class[] { String.class } ); &#91;javac&#93; ^ &#91;javac&#93; /code/derby/trunk2/java/demo/vtis/java/org/apache/derbyDemo/vtis/core/XmlVTI.java:253: warning: &#91;unchecked&#93; unchecked call to getMethod(java.lang.String java.lang.Class&lt;?&gt;...) as a member of the raw type java.lang.Class &#91;javac&#93; ( methodName  new Class[] { String.class } ); &#91;javac&#93; ^ &#91;javac&#93; /code/derby/trunk2/java/demo/vtis/java/org/apache/derbyDemo/vtis/core/XmlVTI.java:260: warning: &#91;unchecked&#93; unchecked call to getConstructor(java.lang.Class&lt;?&gt;...) as a member of the raw type java.lang.Class &#91;javac&#93; ( new Class[] { String.class  String.class  String[].class } ); &#91;javac&#93; ^ &#91;javac&#93; /code/derby/trunk2/java/demo/vtis/java/org/apache/derbyDemo/vtis/snapshot/Subscription.java:278: warning: &#91;unchecked&#93; unchecked call to getMethod(java.lang.String java.lang.Class&lt;?&gt;...) as a member of the raw type java.lang.Class &#91;javac&#93; ( methodName  new Class[] {} ); &#91;javac&#93; ^ &#91;javac&#93; 4 warnings,0,0
ClassCastException when calling boolean meta-data functions with 10.7 client against 10.6 server,I noticed that DESCRIBE didn't work when I tried to connect to a 10.6 server with ij/client driver at version 10.7.ij&gt; describe t;JAVA ERROR: java.lang.ClassCastException: java.lang.Integer cannot be cast to java.lang.Booleanjava.lang.ClassCastException: java.lang.Integer cannot be cast to java.lang.Boolean at org.apache.derby.client.am.DatabaseMetaData.getMetaDataInfoBoolean(DatabaseMetaData.java:2401) at org.apache.derby.client.am.DatabaseMetaData.storesLowerCaseIdentifiers(DatabaseMetaData.java:191) at org.apache.derby.impl.tools.ij.ij.caIdentifier(ij.java:3040) at org.apache.derby.impl.tools.ij.ij.DescTableStatement(ij.java:1624) at org.apache.derby.impl.tools.ij.ij.ijStatement(ij.java:1121) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:341) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:261) at org.apache.derby.impl.tools.ij.Main.go(Main.java:229) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:184) at org.apache.derby.impl.tools.ij.Main.main(Main.java:75) at org.apache.derby.tools.ij.main(ij.java:59) at org.apache.derby.iapi.tools.run.main(run.java:53),0,0
Thread local TableDescriptor#referencedColumnMap is not removed from app threads when Derby is shut down,&gt; This has been seen to cause error messages in TomCat  cf. this quote from a mail on derby-user:&gt; &gt; http://mail-archives.apache.org/mod_mbox/db-derby-user/201011.mbox/%3C7800E37B639BC345BC2AB40980B7C529180FB525@MERCMBX03R.na.SAS.com%3E&gt; &gt; SEVERE: The web application &#91;/MyApp&#93; created a ThreadLocal with key of type [org.apache.derby.iapi.sq/&gt; l.dictionary.TableDescriptor$1] (value &#91;org.apache.derby.iapi.sql.dictionary.TableDescriptor$1@d133a3&#93;)/&gt; and a value of type &#91;java.util.WeakHashMap&#93; (value [{={1  2  3  4}  =null  =null}]) but failed to remo/&gt; ve it when the web application was stopped. This is very likely to create a memory leak.,0,1
Refactor access to primary structures in AlterTableConstantAction,Many of the private methods in impl.sql.execute.AlterTableConstantAction take the activation (and sometimes a number of references obtained through it) as an argument. This seems unnecessary  and it clutters the code with argument passing  boilerplate code and variable hiding.,0,0
EmbeddedXADataSource with ;create=true attribute set in setDatabaseName fails with java.sql.SQLException: Database not available,Setting the ;create=true attribute in setDatabaseName with EmbededXADataSource and EmbeddedXADataSource40 fails with $ java TestDerbyCreateException in thread 'main' java.sql.SQLException: Database not available at org.apache.derby.jdbc.EmbeddedXADataSource.setupResourceAdapter(EmbededXADataSource.java:175) at org.apache.derby.jdbc.EmbeddedXADataSource.getXAConnection(EmbeddedXDataSource.java:101) at TestDerbyCreate.main(TestDerbyCreate.java:18)using the create attributie in databaseName works fine with EmbeddedDataSource. Using setCreateDatabase('create') with EmbeddedXADataSource is a good work around and I think generally preferable.import java.sql.*;import javax.sql.*;public class TestDerbyCreate{ public static void main(String[] args) throws Throwable { org.apache.derby.jdbc.EmbeddedXADataSource ds = new org.apache.derby.jdbc.EmbeddedXADataSource(); ds.setDatabaseName('TestDB;create=true'); ds.setUser('dbuser1'); ds.setPassword('dbpwd1'); PooledConnection pooledConn = ds.getXAConnection(); Connection conn = pooledConn.getConnection(); System.out.println('Database product: ' + conn.getMetaData().getDatabaseProductName()); System.out.println('Database version: ' + conn.getMetaData().getDatabaseProductVersion()); System.out.println('Driver name: ' + conn.getMetaData().getDriverName()); System.out.println('Driver version: ' + conn.getMetaData().getDriverVersion()); System.out.println('JDBC driver major ve,0,0
Four replication tests fail on z/OS with junit.framework.AssertionFailedError: startMaster did not succeed.,Four replication tests failed with junit.framework.AssertionFailedError: startMaster did not succeed. running on the 64bit JVM on z/OS:ReplicationRun_Local_3_p2 ReplicationRun_Local_StateTest_part1ReplicationRun_Local_3_p3 ReplicationRun_Local_StateTest_part1_2Below are the stack traces. I will attach the fail directory.There were 4 failures:1) testReplication_Local_StateTest_part1(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1)junit.framework.AssertionFailedError: startMaster did not succeed. at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster_direct(ReplicationRun.java:1072) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster(ReplicationRun.java:906) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1._testPreStartedMaster(ReplicationRun_Local_StateTest_part1.java:375) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1.testReplication_Local_StateTest_part1(ReplicationRun_Local_StateTest_part1.java:136) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:48) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:207) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16)2) testReplication_Local_StateTest_part1_2(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_2)junit.framework.AssertionFailedError: startMaster did not succeed. at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster_direct(ReplicationRun.java:1072) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster(ReplicationRun.java:906) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_2.testReplication_Local_StateTest_part1_2(ReplicationRun_Local_StateTest_part1_2.java:128) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:48) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:207) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16)3) testReplication_Local_3_p2_StateTests_bigInsert_sleepBeforeStopMaster(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p2)junit.framework.AssertionFailedError: startMaster did not succeed. at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster_direct(ReplicationRun.java:1072) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster(ReplicationRun.java:906) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p2.replication_Local_3_p2_StateTests(ReplicationRun_Local_3_p2.java:128) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p2.testReplication_Local_3_p2_StateTests_bigInsert_sleepBeforeStopMaster(ReplicationRun_Local_3_p2.java:248) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:48) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:207) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16)4) testReplication_Local_3_p3_StateNegativeTests(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p3)junit.framework.AssertionFailedError: startMaster did not succeed. at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster_direct(ReplicationRun.java:1072) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.startMaster(ReplicationRun.java:906) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p3.testReplication_Local_3_p3_StateNegativeTests(ReplicationRun_Local_3_p3.java:128) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:48) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:207) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16)FAILURES!!!Tests run: 13032  Failures: 4  Errors: 0,0,0
restoreIntrFlagIfSeen may throw ShutdownException causing confusing console stack trace at server shutdown,Exception in thread 'DRDAConnThread_508'org.apache.derby.iapi.error.ShutdownException: at org.apache.derby.iapi.services.context.ContextManager.checkInterrupt(ContextManager.java:437) at org.apache.derby.iapi.services.context.ContextManager.getContext(ContextManager.java:155) at org.apache.derby.iapi.services.context.ContextService.getContextOrNull(ContextService.java:249) at org.apache.derby.iapi.util.InterruptStatus.restoreIntrFlagIfSeen(InterruptStatus.java:158) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:356) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2284) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:82) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.closeActions(EmbedPreparedStatement.java:261) at org.apache.derby.impl.jdbc.EmbedStatement.close(EmbedStatement.java:307) at org.apache.derby.impl.drda.DRDAStatement.close(DRDAStatement.java:1027) at org.apache.derby.impl.drda.Database.close(Database.java:364) at org.apache.derby.impl.drda.Session.close(Session.java:115) at org.apache.derby.impl.drda.DRDAConnThread.closeSession(DRDAConnThread.java:8289) at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:315),0,0
Instability in Derby2017LayerBTest,Seen on 10.7 RC1:testFailedStreamInsertBinaryAutoCommitRollbackOnError(org.apache.derbyTesting.functionTests.tests.jdbc4.Derby2017LayerBTest) FAILURE:junit.framework.AssertionFailedError: Column value mismatch @ column 'B'  row 1: Expected: &gt;5468697320697320726f772031&lt; Found: &gt;5468697320697320726f772036&lt; at junit.framework.Assert.fail(Assert.java:47) at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1213) at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1125) at org.apache.derbyTesting.junit.JDBC.assertFullResultSetMinion(JDBC.java:1012) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:935) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:892) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:850) at org.apache.derbyTesting.functionTests.tests.jdbc4.Derby2017LayerBTest.doInsertTest(Derby2017LayerBTest.java:493) at org.apache.derbyTesting.functionTests.tests.jdbc4.Derby2017LayerBTest.testFailedStreamInsertBinaryAutoCommitRollbackOnError(Derby2017LayerBTest.java:315),0,0
test failure in OSReadOnlyTest in assertDirectoryDeleted,I've seen the assert flag a failure for deleteing a log file last night  and a seg0 file the night before.This is one stack trace:1) testOSReadOnly(org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest)junit.framework.AssertionFailedError: Failed to delete 2 files (root=F:/test/JarResults.2010-11-23/ibm16_suites.All/system/singleUse/readWrite: F:/test/JarResults.2010-11-23/ibm16_suites.All/system/singleUse/readWrite/log (isDir=true  canRead=true  canWrite=true  size=0)  F:/jartest/JarResults.2010-11-23/ibm16_suites.All/system/singleUse/readWrite (isDir=true  canRead=true  canWrite=true  size=0) at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertDirectoryDeleted(BaseJDBCTestCase.java:1421) at org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest.moveDatabaseOnOS(OSReadOnlyTest.java:295) at org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest.testOSReadOnly(OSReadOnlyTest.java:160) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:48) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16)This is another:1) testOSReadOnly(org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest)junit.framework.AssertionFailedError: Failed to delete 2 files (root=F:/test/JarResults.2010-11-22/ibm16_suites.All/system/singleUse/readOnly: F:/test/JarResults.2010-11-22/ibm16_suites.All/system/singleUse/readOnly/seg0 (isDir=true  canRead=true  canWrite=true  size=0)  F:/jartest/JarResults.2010-11-22/ibm16_suites.All/system/singleUse/readOnly (isDir=true  canRead=true  canWrite=true  size=0) at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertDirectoryDeleted(BaseJDBCTestCase.java:1421) at org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest.moveDatabaseOnOS(OSReadOnlyTest.java:295) at org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest.testOSReadOnly(OSReadOnlyTest.java:152) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:48) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16)This is on a machine that I've been able to arrange for a windows machine on which to run the tests for 10.7 nightly  but this is not a new machine. So perhaps the disk - being older - is a little slow in deleting? Perhaps the check can be delayed  or redone if failed first time. I'm still investigating  checking on hardware settings. The disk scan showed up healthy  and multithreading is not on.,0,0
suites.All stuck in RAFContainer4.awaitRestoreChannel(),I have suites.All running on trunk  and it seems to be stuck in a call to RAFContainer4.awaitRestoreChannel(). Here's the stack for the waiting thread:'main' prio=3 tid=0x08070800 nid=0x2 waiting on condition &#91;0xfe61e000&#93; java.lang.Thread.State: TIMED_WAITING (sleeping) at java.lang.Thread.sleep(Native Method) at org.apache.derby.impl.store.raw.data.RAFContainer4.awaitRestoreChannel(RAFContainer4.java:698) at org.apache.derby.impl.store.raw.data.RAFContainer4.writePage(RAFContainer4.java:593) at org.apache.derby.impl.store.raw.data.CachedPage.writePage(CachedPage.java:787) at org.apache.derby.impl.store.raw.data.CachedPage.clean(CachedPage.java:610) at org.apache.derby.impl.services.cache.ConcurrentCache.cleanAndUnkeepEntry(ConcurrentCache.java:551) at org.apache.derby.impl.services.cache.ConcurrentCache.cleanCache(ConcurrentCache.java:509) at org.apache.derby.impl.services.cache.ConcurrentCache.cleanAll(ConcurrentCache.java:460) at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.checkpoint(BaseDataFileFactory.java:1211) at org.apache.derby.impl.store.raw.log.LogToFile.checkpointWithTran(LogToFile.java:1710) at org.apache.derby.impl.store.raw.log.LogToFile.checkpoint(LogToFile.java:1507) at org.apache.derby.impl.store.raw.RawStore.stop(RawStore.java:368) at org.apache.derby.impl.services.monitor.TopService.stop(TopService.java:442) at org.apache.derby.impl.services.monitor.TopService.shutdown(TopService.java:393) at org.apache.derby.impl.services.monitor.BaseMonitor.shutdown(BaseMonitor.java:229) at org.apache.derby.impl.services.monitor.BaseMonitor.shutdown(BaseMonitor.java:199) at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:231) at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:119) at java.sql.DriverManager.getConnection(DriverManager.java:582) at java.sql.DriverManager.getConnection(DriverManager.java:154) at org.apache.derbyTesting.junit.DriverManagerConnector.getConnectionByAttributes(DriverManagerConnector.java:137) at org.apache.derbyTesting.junit.DriverManagerConnector.shutEngine(DriverManagerConnector.java:120) at org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1599) at org.apache.derbyTesting.junit.SystemPropertyTestSetup.setUp(SystemPropertyTestSetup.java:83) at junit.extensions.TestSetup$1.protect(TestSetup.java:20) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.textui.TestRunner.doRun(TestRunner.java:121) at junit.textui.TestRunner.start(TestRunner.java:185) at junit.textui.TestRunner.main(TestRunner.java:143),0,1
Embedded Derby does not start when derby.jar is dynamically uploaded / added to the classpath,Hi  For our workflow-system  we can use a variety of DBMS as the store engine. Derby is one of them especially popularfor test and development purposes. During setup of our system  we allow to upload a jar file with the JDBC-Driver for the DBMS.In case of derby  we use the embedded mode and upload derby.jar. After that we add the jar to the repositories of our class loaderand call Class drc = Class.forName('org.apache.derby.jdbc.EmbeddedDriver'  true  ourclassloader);Driver drv = (Driver)drc.newInstance();this worked perfectly for many years up to version 10.6.1.0  but ceased to work in 10.6.2.1; i assume the unreleased future versions are affected  toowhen derby.jar is placed in the classpath manually before starting our setup  everything works fine regardless of the derby version.investigations lead to the following conclusion: since rev. 982370 this is broken  in the immediate predecessor rev. 980035 it worked. rev. 982370 in the org.apache.derby.impl.store.raw.data.BaseDataFileFactory class introduced a new method private static String jarClassPath(final Class cls) which tries to find the jarfile from which derby was loaded. it contains the following lines: if ( cs == null ) return null;URL result = cs.getLocation();return result.toString();  but in the case  when we dynamically load derby   cs is not null but cs.getLocation() is null. so i propose to change the line with the if to:...if ( cs == null || cs.getLocation()==null) return null;...or maybe it would be better to surround the whole body of the method with a try catch  since it is not essential  and a null return value is also ok?thank you for your efforts concerning derby at large  Michael,0,0
Backward  confusing error message when you use the wrong ResultSet.getXXX() method in the client driver,If you try to get a Time value out of an INTEGER column  the client driver gives this error. I believe that similar nonsense comes back when you try other mismatched getters on other datatypes: 'An attempt was made to get a data value of type 'java.sql.Types 4' from a data value of type 'java.sql.Time'.'The exception is a java.sql.SQLDataException with SQLState 22005. The embedded driver returns a better message: 'An attempt was made to get a data value of type 'java.sql.Time' from a data value of type INTEGER'.'I recommend two improvements to the utility method which generates these exceptions:1) Flip the order of the type names.2) Use the ResultSetMetaData to look up the source data type name.,0,0
AccessControlException when running AssertFailureTest from Ant,Seen when running 'ant junit-all': &#91;junit&#93; Running org.apache.derbyTesting.unitTests.junit._Suite &#91;junit&#93; Exception in thread 'main' java.security.AccessControlException: access denied (java.io.FilePermission /code/derby/trunk0/junit_20101222_2349/junitvmwatcher3394322945027170783.properties write) &#91;junit&#93; at java.security.AccessControlContext.checkPermission(AccessControlContext.java:323) &#91;junit&#93; at java.security.AccessController.checkPermission(AccessController.java:546) &#91;junit&#93; at java.lang.SecurityManager.checkPermission(SecurityManager.java:532) &#91;junit&#93; at java.lang.SecurityManager.checkWrite(SecurityManager.java:962) &#91;junit&#93; at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:169) &#91;junit&#93; at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:70) &#91;junit&#93; at java.io.FileWriter.&lt;init&gt;(FileWriter.java:46) &#91;junit&#93; at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.registerTestCase(JUnitTestRunner.java:939) &#91;junit&#93; at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.access$000(JUnitTestRunner.java:68) &#91;junit&#93; at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner$2.startTest(JUnitTestRunner.java:808) &#91;junit&#93; at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner$3.startTest(JUnitTestRunner.java:1004) &#91;junit&#93; at junit.framework.TestResult.startTest(TestResult.java:151) &#91;junit&#93; at junit.framework.TestResult.run(TestResult.java:103) &#91;junit&#93; at junit.framework.TestCase.run(TestCase.java:120) &#91;junit&#93; at junit.framework.TestSuite.runTest(TestSuite.java:230) &#91;junit&#93; at junit.framework.TestSuite.run(TestSuite.java:225) &#91;junit&#93; at junit.framework.TestSuite.runTest(TestSuite.java:230) &#91;junit&#93; at junit.framework.TestSuite.run(TestSuite.java:225) &#91;junit&#93; at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:420) &#91;junit&#93; at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:911) &#91;junit&#93; at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:768) &#91;junit&#93; Running org.apache.derbyTesting.unitTests.junit._Suite &#91;junit&#93; Tests run: 1  Failures: 0  Errors: 1  Time elapsed: 0 sec &#91;junit&#93; Test org.apache.derbyTesting.unitTests.junit._Suite FAILED (crashed),0,0
Race condition in FileContainer#allocCache when reopening RAFContainer after interrupt,The symptom is an ArrayIndexOutOfBoundsException:java.lang.ArrayIndexOutOfBoundsException: -1 at org.apache.derby.impl.store.raw.data.AllocationCache.validate(AllocationCache.java:581) at org.apache.derby.impl.store.raw.data.AllocationCache.getLastPageNumber(AllocationCache.java:122) at org.apache.derby.impl.store.raw.data.FileContainer.pageValid(FileContainer.java:2067) at org.apache.derby.impl.store.raw.data.FileContainer.getUserPage(FileContainer.java:2522) at org.apache.derby.impl.store.raw.data.FileContainer.getInsertablePage(FileContainer.java:2867) at org.apache.derby.impl.store.raw.data.FileContainer.getPageForInsert(FileContainer.java:3017) at org.apache.derby.impl.store.raw.data.BaseContainerHandle.getPageForInsert(BaseContainerHandle.java:372) at org.apache.derby.impl.store.access.heap.HeapController.doInsert(HeapController.java:244) at org.apache.derby.impl.store.access.heap.HeapController.insertAndFetchLocation(HeapController.java:599) at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(RowChangerImpl.java:452) at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1028) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:505) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:436) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:317) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1241) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1686) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:308) at InterruptTest$WorkerThread.run(InterruptTest.java:261This can only happen if another thread has called allocCache.reset while the thread above is in the loop in validate  so as to set numExtents to 0.The synchronization of allocCache is documented in the Javadoc of the FileContainer class: all accesses to allocCache should synchronize.This is omitted when we reopen: FileContainer#openContainer calls readHeader -&gt; readHeaderFromArray -&gt; allocCache.reset,0,0
Replication tests lose derby.log for slave,After running ReplicationRun_Local_3_p1 I notice that of the two directories created  db_master and db_slave  only db_master contains a derby.log file. This is not so nice  since the log file is sometimes needed for test debugging,0,0
Retrying after interrupts in store pops a bug in derbyall/storeall/storeunit/T_RawStoreFactory in some cases,Cf Myrna's comment on DERBY-4741:'I think the latest check-in has caused the following tinderbox failure:derbyall/storeall/storeall.fail:unit/T_RawStoreFactory.unitsee: http://dbtg.foundry.sun.com/derby/test/tinderbox_trunk16/jvm1.6/testing/testlog/SunOS-5.10_i86pc-i386/1061516-derbyall_diff.txt:                 Diff file derbyall/storeall/storeunit/T_RawStoreFactory.diff             Start: T_RawStoreFactory jdk1.6.0_18 storeall:storeunit 2011-01-20 23:22:23 ***2 del&lt; &#8211; Unit Test T_RawStoreFactory finished2 add&gt; ran out of time&gt; Exit due to time bombTest Failed. End: T_RawStoreFactory jdk1.6.0_18 storeall:storeunit 2011-01-21 00:22:54 ***'It failed in the nightly runs with ibm 1.6 also (and 1.4.2 and 1.5).,0,0
failure in jdbcapi.StatementJdbc20Test:testCompletionClosure_jdbc4_1 with j9 (j2ME/CDC),After revision 1061824 for DERBY-4869  there is the following failure in the tests when run with ibm's j9:1) testCompletionClosure_jdbc4_1(org.apache.derbyTesting.functionTests.tests.jdbcapi.StatementJdbc20Test)java.sql.SQLException: The exception 'java.lang.NoClassDefFoundError: java.sql.DriverManager' was thrown while evaluating an expression. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.seeNextException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derbyTesting.functionTests.tests.jdbcapi.StatementJdbc20Test.vetClosedCall(StatementJdbc20Test.java:357) at org.apache.derbyTesting.functionTests.tests.jdbcapi.StatementJdbc20Test.vetClosure(StatementJdbc20Test.java:317) at org.apache.derbyTesting.functionTests.tests.jdbcapi.StatementJdbc20Test.testCompletionClosure_jdbc4_1(StatementJdbc20Test.java:309) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:195) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)Caused by: java.sql.SQLException: Java exception: 'java.sql.DriverManager: java.lang.NoClassDefFoundError'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) ... 33 moreCaused by: java.lang.NoClassDefFoundError: java.sql.DriverManager at org.apache.derbyTesting.functionTests.tests.jdbcapi.StatementJdbc20Test.dynamicResults(StatementJdbc20Test.java:449) at org.apache.derby.exe.acdf1940dax012dxb95exf375xffffd1bbe3d70.g0(Unknown Source) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:195) at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(Unknown Source) at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) ... 29 moreNote  that there is no record of how this test would fare with the phoneME - those tests haven't been running since mid-September 2010 (http://dbtg.foundry.sun.com/derby/test/Daily/javaME/testing/Full/index_all.html).,0,0
ALTER TABLE DROP COLUMN may leave triggers invalid even if they are not using the column getting dropped.,While doing testing for DERBY-4887  I found a case where ALTER TABLE DROP COLUMN will leave triggers in invalid state even if those triggers are not using the column getting dropped. egCREATE TABLE tab (  element_id INTEGER NOT NULL   altered_id VARCHAR(30) NOT NULL); insert into tab values(1 'aa');&#8211; Create a trigger against the table CREATE TRIGGER mytrig  AFTER UPDATE OF altered_id ON tab  REFERENCING NEW AS newt OLD AS oldt  FOR EACH ROW MODE DB2SQL  SELECT newt.altered_id from tab;--Drop the first column in the table. This will cause the column positions to be recalculated within the tablealter table tab drop column element_id; --mytrig is still looking for column altered_id at position 2 but drop column has changed it's position within the table to 1update tab set altered_id='bb';As shown in the example above  table 'TAB' only has 2 columns. The trigger 'MYTRIG' uses the 2nd column in it's trigger action through the REFERENCING clause. During trigger action sql parsing  every column referenced through REFERENCING clause gets transformed into a reference to the column through it's column position in the trigger table(this change to look for columns based on their column positions rather than the name went in as revision 397959 with following commit comments DERBY-1258 Change the generated code for a new/old column in a row trigger to access columns by position and not name to avoid the case-insensitive name lookup specified by JDBC.) When in the script above  we drop the column in position 1  the trigger 'MYTRIG' ends up becoming invalid because column being used in the trigger action is no more in column position 2.One possible solution is to regenerate the SPSDescriptor associated with the trigger action for all the triggers defined on the table whose column is getting dropped. We could be little smarter and only regenerate the SPSDescriptor for the triggers who use the REFERENCING clause. But we need to do more testing to make sure that triggers without REFERENCING clause do not get impacted by a drop of column which is not the last column of the table. This optimization of recognizing the right triggers may not be worth it since performance may not be that big a criteria for an ALTER TABLE DROP COLUMN which should be a rare operation in a production system.An interim solution to this problem is obviously to drop and recreate the triggers,0,0
BootLockTest can fail with ERROR XCY03: Required property 'derby.serviceProtocol' has not been set  with slow configurations,If derby tests are running with JVM options that slow things down substantially  it can fail with:1) testBootLock(org.apache.derbyTesting.functionTests.tests.store.BootLockTest)junit.framework.ComparisonFailure: Dual boot not detected: check BootLockMinion.log expected:&lt;...SDB6&gt; but was:&lt;...CY03&gt; at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDBCTestCase.java:769) at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDBCTestCase.java:804) at org.apache.derbyTesting.functionTests.tests.store.BootLockTest.testBootLock(BootLockTest.java:145) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)Caused by: java.sql.SQLException: Required property 'derby.serviceProtocol' hasnot been set. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:256) at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:2723) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(EmbedConnection.java:384) at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:68) at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:238) at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:128) at java.sql.DriverManager.getConnection(DriverManager.java:322) at java.sql.DriverManager.getConnection(DriverManager.java:297) at org.apache.derbyTesting.junit.DriverManagerConnector.openConnection(DriverManagerConnector.java:81) at org.apache.derbyTesting.junit.DriverManagerConnector.openConnection(DriverManagerConnector.java:43) at org.apache.derbyTesting.junit.TestConfiguration.openDefaultConnection(TestConfiguration.java:1538) at org.apache.derbyTesting.junit.BaseJDBCTestCase.openDefaultConnection(BaseJDBCTestCase.java:428) at org.apache.derbyTesting.junit.BaseJDBCTestCase.getConnection(BaseJDBCTestCase.java:110) at org.apache.derbyTesting.functionTests.tests.store.BootLockTest.testBootLock(BootLockTest.java:136) ... 31 moreCaused by: java.sql.SQLException: Required property 'derby.serviceProtocol' hasnot been set. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70) ... 45 moreCaused by: ERROR XCY03: Required property 'derby.serviceProtocol' has not been set. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286) at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1679) at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(BaseMonitor.java:1560) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:979) at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:550) at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:2686) ... 43 moreThe test waits for the spawned process to create db.lck and service.properties and then waits three seconds more to make sure the properties have been written  but this might not be enough time.Although I have not seen this myself with unchanged code   I can simulate it on windows by changing StorageFactoryService.saveServiceProperties() to have a sleep between creating the service.properties file and writing the properties out  e.g. try { os = servicePropertiesFile.getOutputStream(); try { Thread.sleep(10000); } catch (Exception e) {} properties.store( os  serviceName + MessageService.getTextMessage(MessageId.SERVICE_PROPERTIES_DONT_EDIT));,0,0
Release notes should specify which Java version is needed to run Derby,Since 10.3  it appears we no longer include information about what Java version is needed to run Derby  at least not on the release notes published on the web site  cf.http://db.apache.org/derby/releases/release-10.7.1.1.html and others.In the 10.2 release notes  we see:JDK/JDBC support: JDK 1.3  1.4  1.5  and J2ME J2ME/CDC/Foundation Profile JSR-169  JDBC 2.1  and JDBC 3.0 supportI think this type of information should still be readily available from the release notes  does anybody know why we stopped doing that?,0,0
Intermittent bug in InterruptResilienceTest,Knut saw an error on the nightly test on Windows 2003: apparently an interrupt happened when waiting for a lock. Cf. enclosure test.log.,0,0
[patch] fix npe in error condition,LogToFile#switchLogFile: In the cleanup code that handles failure of initLogFile  we seecode nulls out a variable and then access it: push the nulling down to the end.,0,0
[patch] Client driver lexer to determine statement type: fix bad attempt at incrementing a variable,In the client driver lexer to determine statement type  we look for token 'select'  'update'  'values' etc. The lexer used to has a bug in itshandling of end-of-line comments '--'.code doesidx = idx++;but this does absolutely nothing,0,0
[patch] remove erroneous throws clauses on non derivable methods that don't throw,various constructors/private methods declare throwing exceptions that they don't in fact throw. This causes calling methods to handle these exceptions  for no reason. patch removes.,0,0
[patch] override equals correctly,code implements equals w/o an Object parm. Calling code that doesn't have first class signature of FormatableBitSet will not work as expected. Properly override equals to fix.,0,0
Cannot find Ant libraries when building from NetBeans,Building Derby doesn't work out of the box in NetBeans. The wiki page http://wiki.apache.org/db-derby/BuildingDerby instructs NetBeans users to specify the ant.library.dir property in order to get the build working.The Ant documentation says the following about the ant.library.dir property: 'The following property is only set if Ant is started via the Launcher class (which means it may not be set inside IDEs either)' - http://ant.apache.org/manual/properties.htmlSince the property is not guaranteed to be set  I suggest that we replace references to '${ant.library.dir}/ant.jar' with references to '${ant.core.lib}' in the build scripts. According to the above mentioned Ant manual page the ant.core.lib property should always be available and point to ant.jar. Changing this makes it possible to build Derby from NetBeans with no special customization.,0,0
UpdateStatisticsTest fails after we enabled the automatic calculation of index statistics.,After enabling the automatic calculation of statistics  we see the following error in UpdateStatisticsTest in the tinderbox run. See  for instance  http://dbtg.foundry.sun.com/derby/test/tinderbox_trunk16/jvm1.6/testing/Limited/testSummary-1069761.html :1) testUpdateStatistics(org.apache.derbyTesting.functionTests.tests.lang.UpdateStatisticsTest)junit.framework.AssertionFailedError at org.apache.derbyTesting.functionTests.tests.lang.UpdateStatisticsTest.testUpdateStatistics(UpdateStatisticsTest.java:164) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)2) testUpdateStatistics(org.apache.derbyTesting.functionTests.tests.lang.UpdateStatisticsTest)junit.framework.AssertionFailedError at org.apache.derbyTesting.functionTests.tests.lang.UpdateStatisticsTest.testUpdateStatistics(UpdateStatisticsTest.java:164) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57),0,0
[patch] derived InternalXact attempts (and fails) to override a method from base,RawTransaction implementspublic void checkLogicalOperationOk() throws StandardException {}which is attempted to be overridden in derived class InternalXact  but is not done so because of a case problem in InternalXact public void checkLogicalOperationOK() throws StandardException { throw StandardException.newException( SQLState.XACT_NOT_SUPPORTED_IN_INTERNAL_XACT);}Code that calls this method thru the parent will not get the overridden method called.,0,0
[patch] System.arraycopy  being native  is more performant,various places in the code  manual loops are used to copy one array to another  switch with System.arraycopy for better performance.,0,1
[patch] bad field masking makes non functional rowsInput evaluation,RealDistinctScalarAggregateStatistics derives from RealScalarAggregateStatisticsRealDistinctScalarAggregateStatistics takes a constructor parm of rowsInput and forwards it to the super class's constructor  where it is stored for use by the class.However  the subclass mistakenly added a masked rowsInput field that is never set  and thus interferes with the proper use of the super class's rowsInput field.patch removed the erroneous subclass's field.,0,0
ResultSet.updateBoolean() on new BOOLEAN type throws exception,I am encountering an error trying to update a BOOLEAN type through anupdatable ResultSet. My table looks like this:CREATE TABLE file_store ( path VARCHAR(255) NOT NULL  network VARCHAR(32) NOT NULL  file_blob BLOB  file_md5 VARCHAR(32)  is_directory BOOLEAN NOT NULL DEFAULT false  PRIMARY KEY (path  network));My SQL looks like this:SELECT path  network  is_directory FROM file_storeWHERE path=? AND network=? AND is_directory=true FOR UPDATE OF path  network  is_directoryMy Java code looks like this:...resultSet.moveToInsertRow();resultSet.updateString('path'  dirPath);resultSet.updateString('network'  network);resultSet.updateBoolean('is_directory'  true);resultSet.insertRow();An exception is thrown in the call to updateBoolean() as follows:java.sql.SQLException: An attempt was made to put a data value of type 'byte' into a data value of type 'BOOLEAN'.It's a shame  I was looking forward to using the new BOOLEAN type before I roll out the next version of our software. For now I will fallback to SMALLINT. Does/will ALTER TABLE support a change from SMALLINT to BOOLEAN?,0,0
Assert failures in UpdateStatisticsTest,I saw these failures when running suites.All against revision 1070949 + the 1b patch attached to DERBY-642:junit.framework.AssertionFailedError: Index statistics for &lt;ALL TABLES&gt;1: {tableId=94a458d3-012e-2a1f-d23d-ffff93077fa3  tableName=&lt;n/a&gt;  indexName=&lt;n/a&gt;  lcols=1  rows=160  unique/card=160  created=2011-02-15 17:31:00.951} expected:&lt;0&gt; but was:&lt;1&gt; at org.apache.derbyTesting.junit.IndexStatsUtil.assertStats(IndexStatsUtil.java:132) at org.apache.derbyTesting.junit.IndexStatsUtil.assertNoStats(IndexStatsUtil.java:109) at org.apache.derbyTesting.functionTests.tests.lang.UpdateStatisticsTest.testUpdateStatistics(UpdateStatisticsTest.java:91) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:23) at junit.extensions.TestSetup.run(TestSetup.java:27) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:23) at junit.extensions.TestSetup.run(TestSetup.java:27) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)junit.framework.AssertionFailedError: Index statistics for &lt;ALL TABLES&gt;1: {tableId=94a458d3-012e-2a1f-d23d-ffff93077fa3  tableName=&lt;n/a&gt;  indexName=&lt;n/a&gt;  lcols=1  rows=160  unique/card=160  created=2011-02-15 17:31:00.951} expected:&lt;0&gt; but was:&lt;1&gt; at org.apache.derbyTesting.junit.IndexStatsUtil.assertStats(IndexStatsUtil.java:132) at org.apache.derbyTesting.junit.IndexStatsUtil.assertNoStats(IndexStatsUtil.java:109) at org.apache.derbyTesting.functionTests.tests.lang.UpdateStatisticsTest.testUpdateStatistics(UpdateStatisticsTest.java:91) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:23) at junit.extensions.TestSetup.run(TestSetup.java:27) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:23) at junit.extensions.TestSetup.run(TestSetup.java:27) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:23) at junit.extensions.TestSetup.run(TestSetup.java:27) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:23) at junit.extensions.TestSetup.run(TestSetup.java:27) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57),0,0
Intermittent assert failure in AutomaticIndexStatisticsTest.testStatisticsCorrectness,An assert on timestamps in the test AutomaticIndexStatisticsTest.testStatisticsCorrectnes is unstable  and fails on sufficiently fast machines and/or operating systems with lower resolution timers.,0,0
[patch] Bad name collision causes non functional method,ijMultipleResultSetResult has this method /** Create a ijResultImpl that represents multiple result set. */ public ijMultipleResultSetResult(List resultSets) throws SQLException { resultSets = new ArrayList(); resultSets.addAll(resultSets); }due to the name collision  this does nothing... patch fixes with this. prefixing.,0,0
[patch] reduce superfluous boxing histrionics,code converts strings to primitives using excessive boxing patterns. patch reduces.,0,0
Embedded driver allows updateBytes() on BOOLEAN column,The following code inserts the value TRUE into the table T on the embedded driver: Statement s = c.createStatement(ResultSet.TYPE_FORWARD_ONLY  ResultSet.CONCUR_UPDATABLE); s.execute('create table t(b boolean)'); ResultSet rs = s.executeQuery('select b from t'); rs.moveToInsertRow(); rs.updateBytes(1  'this is a test'.getBytes()); rs.insertRow();The client driver fails:java.sql.SQLException: An attempt was made to put a data value of type 'byte[]' into a data value of type 'BOOLEAN'.I believe the client driver is correct  and embedded should be changed to match it.,0,0
[patch] remove unused fetching of data dictionary,code fetches data dictionary for no reason.,0,0
[patch] use string buffers when building strings in loops,Various spots in code builds up strings in loops. This causes n extra StringBuffer allocations and n extra String allocationspatch replaces with direct StringBuffer use.,0,1
test failure(s) with IBM 1.4.2 in store.InterruptResilienceTest.testRAFWriteInterrupted: java.sql.SQLException: The exception 'junit.framework.AssertionFailedError: interrupt flag lost' was thrown while evaluating an expression.,Since February 17  I see this failure:1) testRAFWriteInterrupted(org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest) java.sql.SQLException: The exception 'junit.framework.AssertionFailedError: interrupt flag lost' was thrown while evaluating an expression. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.seeNextException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(Unknown Source) at org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest.testRAFWriteInterrupted(InterruptResilienceTest.java:204) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code)) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code)) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java(Compiled Code)) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java(Compiled Code)) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)Caused by: java.sql.SQLException: Java exception: 'interrupt flag lost: junit.framework.AssertionFailedError'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) ... 46 moreCaused by: junit.framework.AssertionFailedError: interrupt flag lost at org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest.tstRAFwriteInterrupted(InterruptResilienceTest.java(Compiled Code)) at org.apache.derby.exe.ac0b5b0099x012ex376dx55e3x00000a2ef4be0.g0(Unknown Source) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code)) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code)) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java(Compiled Code)) at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(Unknown Source) at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) ... 42 moretwice (February 20 and February 25) this was followed by a second test failure:2) testRAFReadWriteMultipleThreads(org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest)java.sql.SQLException: The exception 'junit.framework.AssertionFailedError: Column value mismatch @ column '1'  row 1: Expected: &gt;30000&lt; Found: &gt;29999&lt;' was thrown while evaluating an expression. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.seeNextException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(Unknown Source) at org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest.testRAFReadWriteMultipleThreads(InterruptResilienceTest.java:515) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code)) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code)) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java(Compiled Code)) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java(Compiled Code)) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)Caused by: java.sql.SQLException: Java exception: 'Column value mismatch @ column '1'  row 1: Expected: &gt;30000&lt; Found: &gt;29999&lt;: junit.framework.AssertionFailedError'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) ... 46 moreCaused by: junit.framework.AssertionFailedError: Column value mismatch @ column '1'  row 1: Expected: &gt;30000&lt; Found: &gt;29999&lt; at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java(Compiled Code)) at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java(Inlined Compiled Code)) at org.apache.derbyTesting.junit.JDBC.assertFullResultSetMinion(JDBC.java(Compiled Code)) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java(Inlined Compiled Code)) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java(Inlined Compiled Code)) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java(Inlined Compiled Code)) at org.apache.derbyTesting.junit.JDBC.assertSingleValueResultSet(JDBC.java(Compiled Code)) at org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest.tstRAFReadWriteMultipleThreads(InterruptResilienceTest.java:265) at org.apache.derby.exe.ac070a00b0x012ex46e5x5b33x0000368ebfa60.g0(Unknown Source) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code)) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code)) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java(Compiled Code)) at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(Unknown Source) at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) ... 42 moreSee for instance: http://people.apache.org/~myrnavl/derby_test_results/main/linux/testlog/ibm142/1071866-suites.All_diff.txtand:http://people.apache.org/~myrnavl/derby_test_results/main/linux/testlog/ibm142/1072825-suites.All_diff.txtI can reproduce the first failure on my laptop with Windows XP with ibm 1.4.2 (in fact  I got the same failure twice  I assume once with NetworkServer/client  once with embedded) by just running the test.This popping up on the 17th is because this test didn't run with ibm 1.4.2 for a while before revision 1071754 (see DERBY-4463  but this is a different problem.)I marked this 'store'  but this test doesn't fail with Sun's 1.4.2 jvm  judging from the results at http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.4/testing/Limited/   so it's possible there's a jvm issue here.,0,0
[patch] move instanceof check up above where casts occur,code does an instanceof check on Diagnosable much after multiple casts to Diagnosable occurs above it.Move the instanceof check up before the first cast  so that it does some good.,0,0
[patch] remove non productive instanceof checks,various places in code does instanceof checks where the outcome can be determined statically to be always true or always false.removed these checks as they do nothing.,0,0
Incorrect list of compatible JRE versions in client trace,When running with client side tracing enabled  these lines appear first in the trace file:&#91;derby&#93; BEGIN TRACE_DRIVER_CONFIGURATION&#91;derby&#93; Driver: Apache Derby Network Client JDBC Driver 10.8.0.0 alpha - (1075248P)&#91;derby&#93; Compatible JRE versions: { 1.3  1.4 }The list of compatible JRE versions is wrong. The client driver doesn't work on 1.3  and 1.5 and 1.6 are missing from the list.,0,0
DERBY-4984 caused a regression which will not allow users to drop a table if the table was involved in a trigger action rebind during ALTER TABLE DROP COLUMN,The fix for DERBY-4984 has introduced a regression which adds rows into SYSDEPENDS which are incorrect. The error I think was caused when before doing a rebind of trigger action  I made the trigger table as the current dependent in the dependency system and hence all the dependencies required by the trigger action got associated with that trigger table and hence causing the errorneous behavior. I will work on this asap. The fix went into trunk and 10.7. I will add a test case for this in the jira and will also add a test case in our junit test,0,0
ShutdownException in ContextManager.checkInterrupt() during shutdown,When running the attached repro script  I often (but not always) see a ShutdownException in ContextManager.checkInterrupt() when ij exits and shuts down the Derby engine. ij expects an exception here  but it expects an SQLException  not a ShutdownException.,0,0
After specifying deregister=false on the engine shutdown URL  Derby forgets that the default behavior is deregister=true,If you shutdown the engine specifying deregister=false  then get a new connection  then shutdown the engine again without specifying any value for the deregister attribute  Derby acts as though you specified deregister=false again. I will attach a test program which shows this problem.,0,0
Disable istat logging by default,The automatic index statistics daemon will by default log what it's doing. That means messages like these ones will be written to derby.log during normal operation:Wed Mar 02 13:36:22 CET 2011 Thread&#91;main 5 main&#93; {istat} 'APP'.'T': update scheduled - 23ce809c-012e-7691-6c29-000003480128 reason=&#91;no stats  row-estimate=36167&#93; (queueSize=1)Wed Mar 02 13:36:22 CET 2011 Thread&#91;index-stat-thread 5 main&#93; {istat} 'APP'.'T': generating index statisticsWed Mar 02 13:36:23 CET 2011 Thread&#91;index-stat-thread 5 main&#93; {istat} 'APP'.'T': generation complete (509 ms)Wed Mar 02 13:36:23 CET 2011 Thread&#91;main 5 main&#93; {istat} stopping daemon  active=false  work/age=510/14736 &#91;q/p/s=0/1/1 err:k/u/c=0/0/0 rej:f/d/o=0/0/0&#93;Although these messages may be helpful in diagnosing bugs  they may also be a source of confusion since users probably only expect errors/problems to be logged by default. Also  for some workloads  large quantities of log may be produced and take up disk space. Therefore  I think we should disable the logging before the 10.8 release  and instead instruct users who experience problems to enable logging manually with the derby.storage.indexStats.log property.,0,0
NPE in istat daemon when encountering critical exception during shutdown,If the istat daemon encounters a critical error during shutdown and the data dictionary module has been stopped  it will run into a NPE.This bug is highly timing-dependent in two ways: the data dictionary module must have been stopped first  and then the istat daemon must encounter a critical error 'at the right time'.I have seen this bug once on my laptop.,0,0
[patch] avoid Boolean allocations for rowset data in client cursor,code allocates a new Boolean for every row value of a boolean column  creating needless garbage. Patch switches to use immutable Boolean.TRUE and Boolean.FALSE values.,0,1
[patch] avoid Integer allocations fetching client meta data info,code needlessly generates Integer objects (garbage) in loops looking for meta data information  patch removes these allocations,0,1
GetCurrentPropertiesTest depends on implicit ordering of test cases,The test cases in GetCurrentPropertiesTest must run in the order in which they are defined in the source file. If for example the test case testPropertiesTraceOn runs first  the test will fail with the following stack trace:1) testPropertiesTraceOn(org.apache.derbyTesting.functionTests.tests.derbynet.GetCurrentPropertiesTest)junit.framework.ComparisonFailure: expected:&lt;&#91;tru&#93;e&gt; but was:&lt;&#91;fals&#93;e&gt; at org.apache.derbyTesting.functionTests.tests.derbynet.GetCurrentPropertiesTest.testPropertiesTraceOn(GetCurrentPropertiesTest.java:206) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112)(...)Seen in the nightly tests  for example here: http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/testlog/vista-64/1076682-suitesAll_diff.txt,0,0
ProcedureInTriggerTest depends on implicit ordering of test cases,If for example the test case testTriggerContainsSql is executed as the first test case  it will fail with the following error:1) testTriggerContainsSql(org.apache.derbyTesting.functionTests.tests.lang.ProcedureInTriggerTest)junit.framework.AssertionFailedError: expected:&lt;2&gt; but was:&lt;0&gt; at org.apache.derbyTesting.functionTests.tests.lang.ProcedureInTriggerTest.checkAndResetGetConnectionProcCount(ProcedureInTriggerTest.java:514) at org.apache.derbyTesting.functionTests.tests.lang.ProcedureInTriggerTest.testTriggerContainsSql(ProcedureInTriggerTest.java:120) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)The test should either make the order of the test cases explicit or make the test cases independent of the order in which they run.Seen in the nightly tests  for example here: http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/testlog/lin/1076682-suitesAll_diff.txt,0,0
Lacking cleanup in CheckConstraintTest.testJira4282(),The test case testJira4282 in CheckConstraintTest doesn't drop the table it creates. The table itself has a unique name that doesn't conflict with any other test case  but it also has a constraint with a generic name (CK1) that is in conflict with constraints created in testCheckConstraints and testPositionalUpdate. If testJira4282 runs before any of those test cases  the test will fail.Example from the nightly tests:http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/testlog/lin/1076682-suitesAll_diff.txt1) testCheckConstraints(org.apache.derbyTesting.functionTests.tests.lang.CheckConstraintTest)java.sql.SQLException: Constraint 'CK1' already exists in Schema 'APP'. at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.client.am.SqlException.getSQLException(Unknown Source) at org.apache.derby.client.am.Statement.executeUpdate(Unknown Source) at org.apache.derbyTesting.functionTests.tests.lang.CheckConstraintTest.testCheckConstraints(CheckConstraintTest.java:243),0,0
Assert failure in SavepointJdbc30Test.testReleaseSqlSavepointAndRollback,Seen in nightly testing on Java 7:http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/testlog/vista-64/1078855-suitesAll_diff.txt23) testReleaseSqlSavepointAndRollback(org.apache.derbyTesting.functionTests.tests.jdbcapi.SavepointJdbc30Test)junit.framework.AssertionFailedError: expected:&lt;6&gt; but was:&lt;0&gt; at org.apache.derbyTesting.functionTests.tests.jdbcapi.SavepointJdbc30Test.testReleaseSqlSavepointAndRollback(SavepointJdbc30Test.java:775) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112),0,0
ParameterMetaDataJdbc30Test fails with ''DUMMYINT' is not recognized as a function or procedure',ParameterMetaDataJdbc30Test has failed a couple of times in the nightly tests on Java 7.http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/testlog/lin/1078310-suitesAll_diff.txt1) testMetatdataAfterProcRecompile(org.apache.derbyTesting.functionTests.tests.jdbcapi.ParameterMetaDataJdbc30Test)java.sql.SQLSyntaxErrorException: 'DUMMYINT' is not recognized as a function or procedure. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedCallableStatement.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedCallableStatement20.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedCallableStatement30.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedCallableStatement40.&lt;init&gt;(Unknown Source) at org.apache.derby.jdbc.Driver40.newEmbedCallableStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareCall(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareCall(Unknown Source) at org.apache.derbyTesting.junit.BaseJDBCTestCase.prepareCall(BaseJDBCTestCase.java:317) at org.apache.derbyTesting.functionTests.tests.jdbcapi.ParameterMetaDataJdbc30Test.testMetatdataAfterProcRecompile(ParameterMetaDataJdbc30Test.java:524),0,0
testQualifiers(org.apache.derbyTesting.functionTests.tests.store.AccessTest)java.sql.SQLException: Table/View 'FOO' already exists in Schema 'APP'.,1) testQualifiers(org.apache.derbyTesting.functionTests.tests.store.AccessTest)java.sql.SQLException: Table/View 'FOO' already exists in Schema 'APP'. at java.lang.Throwable.&lt;init&gt;(Throwable.java:80) at java.sql.SQLException.&lt;init&gt;(SQLException.java:153) at java.sql.SQLException.&lt;init&gt;(SQLException.java:176) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(Unknown Source) at org.apache.derbyTesting.functionTests.tests.store.AccessTest.testQualifiers(AccessTest.java:1807) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:51) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16)Caused by: java.sql.SQLException: Table/View 'FOO' already exists in Schema 'APP'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source) ... 47 moreCaused by: ERROR X0Y32: Table/View 'FOO' already exists in Schema 'APP'. at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.duplicateDescriptorException(Unknown Source) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.addDescriptor(Unknown Source) at org.apache.derby.impl.sql.execute.CreateTableConstantAction.executeConstantAction(Unknown Source) at org.apache.derby.impl.sql.execute.MiscResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) ... 41 moreNote this was followed by another failure DERBY-4550. Not sure if the failure to create the table might have impacted that test.,0,0
nightly test failure in derbyall/storeall/storemore/SpaceTable,http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.4/testing/testlog/lin/1081468-derbyall_diff.txtFailure Details:                 Diff file derbyall/storeall/storemore/SpaceTable.diff             Start: SpaceTable jdk1.4.2_02 storeall:storemore 2011-03-15 11:50:03 ***145 del&lt; PLATYPUS |0 |1 |20 |4096 |81920 145a145&gt; PLATYPUS |0 |2 |19 |4096 |77824 Test Failed. End: SpaceTable jdk1.4.2_02 storeall:storemore 2011-03-15 11:50:13 ***------------------------------------------------------,0,0
Incomplete quoting of SQL identifiers in AlterTableConstantAction,AlterTableConstantAction generates SQL statements various places. Identifiers (schema names  table names  column names) are surrounded with double quotes in case they contain special characters. This is not enough if the identifiers contain double quotes  as can be seen with this example:ij&gt; create table t(x int);0 rows inserted/updated/deletedij&gt; alter table t add column '''' int default 42;ERROR 42X01: Syntax error: Encountered '/'' at line 1  column 22.I've found three places where AlterTableConstantAction generates SQL statements: updateNewColumnToDefault()  updateNewAutoincrementColumn()  getColumnMax(). All three places suffer from this problem.,0,0
ParameterMetaDataJdbc30Test fails with ''PMDD' is not recognized as a function or procedure',Seen in nightly testing on Java 7:http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/testlog/sol32/1085472-suitesAll_diff.txt1) testParameterMetadataWithLITERALParameters(org.apache.derbyTesting.functionTests.tests.jdbcapi.ParameterMetaDataJdbc30Test)java.sql.SQLSyntaxErrorException: 'PMDD' is not recognized as a function or procedure. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedCallableStatement.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedCallableStatement20.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedCallableStatement30.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedCallableStatement40.&lt;init&gt;(Unknown Source) at org.apache.derby.jdbc.Driver40.newEmbedCallableStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareCall(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareCall(Unknown Source) at org.apache.derbyTesting.junit.BaseJDBCTestCase.prepareCall(BaseJDBCTestCase.java:317) at org.apache.derbyTesting.functionTests.tests.jdbcapi.ParameterMetaDataJdbc30Test.testParameterMetadataWithLITERALParameters(ParameterMetaDataJdbc30Test.java:743) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)Caused by: java.sql.SQLException: 'PMDD' is not recognized as a function or procedure. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source) ... 47 moreCaused by: ERROR 42Y03: 'PMDD' is not recognized as a function or procedure. at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.impl.sql.compile.StaticMethodCallNode.bindExpression(Unknown Source) at org.apache.derby.impl.sql.compile.JavaToSQLValueNode.bindExpression(Unknown Source) at org.apache.derby.impl.sql.compile.CallStatementNode.bindStatement(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source) ... 41 moreLooks like a problem with the ordering of the test cases. testParameterMetadataWithDECIMALParameters() creates the procedure PMDD  and testParameterMetadataWithLITERALParameters() calls it and drops it. If the test cases run in the opposite order  testParameterMetadataWithLITERALParameters() cannot find the procedure and fails.,0,0
Cannot rollback after syntax error in internal statement,To reproduce  execute the statements below in ij. Can only be reproduced this way before DERBY-5157. I don't know how to reproduce it when that bug is fixed.ij version 10.7ij&gt; connect 'jdbc:derby:db;create=true';ij&gt; autocommit off;ij&gt; create table t(x int);0 rows inserted/updated/deletedij&gt; alter table t add column '''' int default 42;ERROR 42X01: Syntax error: Encountered '/'' at line 1  column 22.Issue the 'help' command for general information on IJ command syntax.Any unrecognized commands are treated as potential SQL commands and executed directly.Consult your DBMS server reference documentation for details of the SQL syntax supported by your server.ij&gt; rollback;ERROR X0Y67: Cannot issue rollback in a nested connection when there is a pending operation in the parent connection.The error message implies that we've called rollback() on a nested transaction  whereas we're in fact called it on the parent transaction.Expected result: The rollback statement should abort the transaction without raising any errors.,0,0
CLOB INOUT arg set to NULL by procedure does not preserve NULL value when re-invoked,If a procedure sets an INOUT CLOB arg to NULL and is then re-invoked  the NULL is not preserved. Instead  the procedure sees the same CLOB that it saw in the last invocation. This bug was disclosed during the testing of the fix for DERBY-2515. I will attach a repro.,0,0
[patch] fix up sql cleanup handling,When a sql exception occurs  don't allow potential cascading sql problems when closing sql objects from masking the original cause of the exception.Also make sure statements get closed.,0,0
PropertySetter should ignore GCJ installations,Many Linux platforms come with GCJ installed. GCJ implements most of the Java SE API  but not all of it  so it cannot be used to build Derby. Unfortunately  PropertySetter sometimes get confused by it and constructs a compile classpath using GCJ's libraries.For example  on a machine running Debian 6.0.1  I have the sun-java6-jdk package as well as the gcj-jdk package installed. When running ant to build Derby (with no ~/ant.properties)  I get these compile classpaths constructed:printCompilerProperties: &#91;echo&#93; After setting properties: compilerPropsAlreadySet = true &#91;echo&#93; After setting properties: compilerLevel16 = 1.6 &#91;echo&#93; After setting properties: jsr169compile.classpath = /home/kah/derby/trunk/classes/stubs/jsr169:/usr/lib/jvm/java-1.5.0-gcj-4.4/jre/lib/rt.jar &#91;echo&#93; After setting properties: j14lib = ${j14lib} &#91;echo&#93; After setting properties: java14compile.classpath = /usr/lib/jvm/java-1.5.0-gcj-4.4/jre/lib/rt.jar &#91;echo&#93; After setting properties: j15lib = ${j15lib} &#91;echo&#93; After setting properties: java15compile.classpath = /usr/lib/jvm/java-1.5.0-gcj-4.4/jre/lib/rt.jar &#91;echo&#93; After setting properties: j16lib = ${jdk16}/jre/lib &#91;echo&#93; After setting properties: java16compile.classpath = /usr/lib/jvm/java-6-sun-1.6.0.24/jre/lib/alt-rt.jar:/usr/lib/jvm/java-6-sun-1.6.0.24/jre/lib/alt-string.jar:/usr/lib/jvm/java-6-sun-1.6.0.24/jre/lib/charsets.jar:/usr/lib/jvm/java-6-sun-1.6.0.24/jre/lib/deploy.jar:/usr/lib/jvm/java-6-sun-1.6.0.24/jre/lib/javaws.jar:/usr/lib/jvm/java-6-sun-1.6.0.24/jre/lib/jce.jar:/usr/lib/jvm/java-6-sun-1.6.0.24/jre/lib/jsse.jar:/usr/lib/jvm/java-6-sun-1.6.0.24/jre/lib/management-agent.jar:/usr/lib/jvm/java-6-sun-1.6.0.24/jre/lib/plugin.jar:/usr/lib/jvm/java-6-sun-1.6.0.24/jre/lib/resources.jar:/usr/lib/jvm/java-6-sun-1.6.0.24/jre/lib/rt.jarSince java15compile.classpath is based on GCJ  and GCJ lacks some classes in the javax.management.remote package  the build fails when it gets to the JMX tests:compile_jdk15: &#91;javac&#93; Compiling 14 source files to /home/kah/derby/trunk/classes &#91;javac&#93; /home/kah/derby/trunk/java/testing/org/apache/derbyTesting/functionTests/tests/management/JMXConnectionDecorator.java:26: cannot find symbol &#91;javac&#93; symbol : class JMXServiceURL &#91;javac&#93; location: package javax.management.remote &#91;javac&#93; import javax.management.remote.JMXServiceURL; &#91;javac&#93; ^(...) &#91;javac&#93; /home/kah/derby/trunk/java/testing/org/apache/derbyTesting/functionTests/tests/management/RemoteConnectionGetter.java:73: cannot find symbol &#91;javac&#93; symbol : class JMXConnector &#91;javac&#93; location: class org.apache.derbyTesting.functionTests.tests.management.RemoteConnectionGetter &#91;javac&#93; JMXConnector jmxc = conns.remove(jmxConnection); &#91;javac&#93; ^ &#91;javac&#93; 17 errorsBUILD FAILED/home/kah/derby/trunk/build.xml:596: The following error occurred while executing this line:/home/kah/derby/trunk/java/testing/build.xml:80: The following error occurred while executing this line:/home/kah/derby/trunk/java/testing/org/apache/derbyTesting/functionTests/tests/management/build.xml:53: Compile failed; see the compiler error output for details.Total time: 1 minute 30 secondsPropertySetter should ignore GCJ installations to prevent this problem. If it hadn't found GCJ  it would have constructed java15compile.classpath from java16compile.classpath  and the build would have succeeded.,0,0
Setting up network server for management tests hangs intermittently,I've seen on three occurrences with the 10.8.1.0 and 10.8.1.1 release candidates that suites.All has been stuck when setting up the network server decorator for the management test suite. Here's what I see at the end of the console output (running with derby.tests.trace=true): &#91;junit&#93; test_jdbc4_1 used 0 ms  &#91;junit&#93; test_jdbc4_1 used 0 ms  &#91;junit&#93; test_notBooted used 1623 ms java.net.SocketException: Connection reset &#91;junit&#93; at java.net.SocketInputStream.read(SocketInputStream.java:189) &#91;junit&#93; at java.net.SocketInputStream.read(SocketInputStream.java:121) &#91;junit&#93; at java.net.SocketInputStream.read(SocketInputStream.java:107) &#91;junit&#93; at org.apache.derby.impl.drda.NetworkServerControlImpl.fillReplyBuffer(Unknown Source) &#91;junit&#93; at org.apache.derby.impl.drda.NetworkServerControlImpl.readResult(Unknown Source) &#91;junit&#93; at org.apache.derby.impl.drda.NetworkServerControlImpl.pingWithNoOpen(Unknown Source) &#91;junit&#93; at org.apache.derby.impl.drda.NetworkServerControlImpl.ping(Unknown Source) &#91;junit&#93; at org.apache.derby.drda.NetworkServerControl.ping(Unknown Source) &#91;junit&#93; at org.apache.derbyTesting.junit.NetworkServerTestSetup.pingForServerUp(NetworkServerTestSetup.java:567) &#91;junit&#93; at org.apache.derbyTesting.junit.NetworkServerTestSetup.pingForServerStart(NetworkServerTestSetup.java:636) &#91;junit&#93; at org.apache.derbyTesting.junit.NetworkServerTestSetup.setUp(NetworkServerTestSetup.java:196) &#91;junit&#93; at junit.extensions.TestSetup$1.protect(TestSetup.java:20) &#91;junit&#93; at junit.framework.TestResult.runProtected(TestResult.java:124) &#91;junit&#93; at junit.extensions.TestSetup.run(TestSetup.java:25) &#91;junit&#93; at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) &#91;junit&#93; at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) &#91;junit&#93; at junit.extensions.TestSetup$1.protect(TestSetup.java:21) &#91;junit&#93; at junit.framework.TestResult.runProtected(TestResult.java:124) &#91;junit&#93; at junit.extensions.TestSetup.run(TestSetup.java:25) &#91;junit&#93; at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) &#91;junit&#93; at junit.extensions.TestSetup$1.protect(TestSetup.java:21) &#91;junit&#93; at junit.framework.TestResult.runProtected(TestResult.java:124) &#91;junit&#93; at junit.extensions.TestSetup.run(TestSetup.java:25) &#91;junit&#93; at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) &#91;junit&#93; at junit.framework.TestSuite.runTest(TestSuite.java:230) &#91;junit&#93; at junit.framework.TestSuite.run(TestSuite.java:225) &#91;junit&#93; at junit.framework.TestSuite.runTest(TestSuite.java:230) &#91;junit&#93; at junit.framework.TestSuite.run(TestSuite.java:225) &#91;junit&#93; at junit.framework.TestSuite.runTest(TestSuite.java:230) &#91;junit&#93; at junit.framework.TestSuite.run(TestSuite.java:225) &#91;junit&#93; at junit.framework.TestSuite.runTest(TestSuite.java:230) &#91;junit&#93; at junit.framework.TestSuite.run(TestSuite.java:225) &#91;junit&#93; at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:518) &#91;junit&#93; at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:1052) &#91;junit&#93; at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:906)The exception trace is just printed to the console  but it doesn't make any test fail. (The exception printed on FreeBSD was different  it said 'DRDA_InvalidReplyTooShort.S:Invalid reply from network server: Insufficient data.' The other two looked like the one above.)All the hangs have happened on VirtualBox instances  though with different guest operating systems and JVMs. Probably the timing is different from what we have on physical machines.,0,1
Interrupt of create table or index (i.e. a container) will throw XSDF1 under NIO - connection survives,Cf the enclosed repro. It would be good to make Derby ignore the interrupt here. Cf DERBY-4741. Note that this is less serious than in the cases referred to in DERBY-4741: here the database does not get shut down  even the connection survives  cf the repro. So  this can be considered a follow-up to DERBY-4741 to further improve Derby's robustness under interrupts.,0,0
Client driver silently truncates strings that exceed 32KB,Can be seen with this JUnit test case that retrieves a VARCHAR value with 20000 characters. With the client driver  the string is truncated to 10900 characters (32700 bytes when encoded in UTF-8). public void testLongColumn() throws SQLException { PreparedStatement ps = prepareStatement( 'values cast(? as varchar(20000))'); char[] chars = new char[20000]; Arrays.fill(chars  '/u4e10'); String str = new String(chars); ps.setString(1  str); JDBC.assertSingleValueResultSet(ps.executeQuery()  str); },0,0
Remove usages of DriverManager to obtain an Embedded Connection in Derby Server,The Derby Network Server appears to look up the Derby Embedded Driver from the java.sql.DriverManager in a couple of places in order to get the connection to the actual database.This means the network server cannot operate in environments where for whatever reason it is not OK to access the embedded driver from the DriverManager. Just in general this behavior is unexpected as it should be possible to directly load the embedded driver.I've observed this issue in 10.6.1.0 and checked that the relevant usages are unchanged in trunk.,0,0
assert failure in test testRAFReadWriteMultipleThreads: interrupted flag cleared,This is another instance of an interrupted thread losing its interrupted flag after calling Derby  but I believe this is distinct from other we have seen.1) testRAFReadWriteMultipleThreads(org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest)java.sql.SQLException: The exception 'junit.framework.AssertionFailedError: WorkerThread 0' was thrown while evaluating an expression. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.seeNextException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(Unknown Source) at org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest.testRAFReadWriteMultipleThreads(InterruptResilienceTest.java:532) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)Caused by: java.sql.SQLException: Java exception: 'WorkerThread 0: junit.framework.AssertionFailedError'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) ... 45 moreCaused by: junit.framework.AssertionFailedError: WorkerThread 0 at org.apache.derbyTesting.junit.BaseTestCase.fail(BaseTestCase.java:771) at org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest.tstRAFReadWriteMultipleThreads(InterruptResilienceTest.java:323) at org.apache.derby.exe.ac070a00b0x0130x06edxad12x000062ebfce90.g0(Unknown Source) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(Unknown Source) at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) ... 41 moreCaused by: junit.framework.AssertionFailedError at org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest$WorkerThread.run(InterruptResilienceTest.java:430),0,0
DatabaseMetaData.getColumns(null  null  tableName  null) does not return the columns meta for a SYNONYM,DatabaseMetaData.getColumns(null  null  tableName  null) does not return the columns meta for a SYNONYM.Sample java code use for testing./** ListColumns.java */import java.sql.*;import java.util.Properties;public class ListColumns { public static void main(String[] args) { Connection con = null; try { Class.forName('org.apache.derby.jdbc.ClientDriver'); Properties connectionProps = new Properties(); connectionProps.put('user'  'app'); connectionProps.put('password'  'app'); con = DriverManager.getConnection( 'jdbc:derby://localhost:1527/northwind'  connectionProps); String tableName = 'V1'; DatabaseMetaData meta = con.getMetaData(); System.out.println('Database Product Version' + meta.getDatabaseProductVersion()); ResultSet res = meta.getColumns(null  null  tableName  null); System.out.println('List of columns for ' + tableName); while (res.next()) { System.out.println(' ' + res.getString('TABLE_SCHEM') + '  ' + res.getString('TABLE_NAME') + '  ' + res.getString('COLUMN_NAME') + '  ' + res.getString('TYPE_NAME') + '  ' + res.getInt('COLUMN_SIZE') + '  ' + res.getString('NULLABLE')); } res.close(); con.close(); } catch (java.lang.ClassNotFoundException e) { System.err.println('ClassNotFoundException: ' + e.getMessage()); } catch (SQLException e) { System.err.println('SQLException: ' + e.getMessage()); } }},0,0
Simplify bytecode generation for concatenation operator,ConcatenationOperatorNode generates bytecode that ensures the result object is not null before calling the method that implements the operator. This breaks the pattern used by other operators (which ensures that the result object is not null inside the method that implements the operator  not in the generated bytecode)  and it unnecessarily complicates the code in BinaryOperatorNode.The comments indicate that the current approach was chosen to prevent the null check from happening at execution time  but the generated bytecode does perform the null check at execution time  so generating byte code for it shouldn't have any real benefit over writing Java code for it. In general  implementing as much as possible of the execution time code as Java code is preferred to implementing it directly as bytecode because it's easier to read and debug Java code  and because the generated bytecode cannot be shared between execution plans and take more memory.,0,0
Warnings regarding XPath displayed when generating JavaDoc,When generating JavaDocs for Derby. the following warnings are displayed: &#91;javadoc&#93; Constructing Javadoc information... &#91;javadoc&#93; /home/kw160128/derby/commits/10.8/java/engine/org/apache/derby/iapi/types/SqlXmlUtil.java:51: package org.w3c.dom.xpath does not exist &#91;javadoc&#93; import org.w3c.dom.xpath.XPathEvaluator; &#91;javadoc&#93; ^ &#91;javadoc&#93; /home/kw160128/derby/commits/10.8/java/engine/org/apache/derby/iapi/types/SqlXmlUtil.java:52: package org.w3c.dom.xpath does not exist &#91;javadoc&#93; import org.w3c.dom.xpath.XPathExpression; &#91;javadoc&#93; ^ &#91;javadoc&#93; /home/kw160128/derby/commits/10.8/java/engine/org/apache/derby/iapi/types/SqlXmlUtil.java:53: package org.w3c.dom.xpath does not exist &#91;javadoc&#93; import org.w3c.dom.xpath.XPathResult; &#91;javadoc&#93; ^ &#91;javadoc&#93; /home/kw160128/derby/commits/10.8/java/engine/org/apache/derby/iapi/types/SqlXmlUtil.java:128: cannot find symbol &#91;javadoc&#93; symbol : class XPathExpression &#91;javadoc&#93; location: class org.apache.derby.iapi.types.SqlXmlUtil &#91;javadoc&#93; private XPathExpression query;,0,0
A table created with 10.0.2.1 with constraints cannot be dropped with 10.5 due to NullPointerException with insane build or ASSERT FAILED Failed to find sharable conglomerate descriptor for index conglomerate  with sane build,In 10.0.2.1 there was some bug that caused a duplicate entry in sys.sysconglomerates.After running the attached repro_create.sql with 10.0.2.1  you will see two rows returned instead of one with:select c.constraintname  c.constraintid  cong.conglomerateid  cong.conglomeratename from sys.sysconglomerates cong  sys.syskeys k  sys.sysconstraints c where c.constraintname = 'PK_RS' and c.constraintid =k.constraintid and k.conglomerateid = cong.conglomerateid ;I am not sure what practical impact this has with 10.0 as you can still drop the table s.rs with that version.On connecting to the database with 10.5  either soft or hard upgrade with 10.5.3.2 - 1103924DROP TABLE S.RS fails with:Caused by: java.sql.SQLException: Java exception: 'ASSERT FAILED Failed to findsharable conglomerate descriptor for index conglomerate # 785: org.apache.derby.shared.common.sanity.AssertFailure'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70) ... 17 moreCaused by: org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED Failed to find sharable conglomerate descriptor for index conglomerate # 785 at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:162) at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:147) at org.apache.derby.iapi.sql.dictionary.ConglomerateDescriptor.describeSharedConglomerate(ConglomerateDescriptor.java:638) at org.apache.derby.iapi.sql.dictionary.ConglomerateDescriptor.drop(ConglomerateDescriptor.java:428) at org.apache.derby.iapi.sql.dictionary.ConstraintDescriptor.drop(ConstraintDescriptor.java:738) at org.apache.derby.impl.sql.execute.DDLSingleTableConstantAction.dropConstraint(DDLSingleTableConstantAction.java:144) at org.apache.derby.impl.sql.execute.DDLSingleTableConstantAction.dropConstraint(DDLSingleTableConstantAction.java:107) at org.apache.derby.impl.sql.execute.DropTableConstantAction.dropAllConstraintDescriptors(DropTableConstantAction.java:315) at org.apache.derby.impl.sql.execute.DropTableConstantAction.executeConstantAction(DropTableConstantAction.java:222) at org.apache.derby.impl.sql.execute.MiscResultSet.open(MiscResultSet.java:61) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:416) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:297) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235) ... 10 moreand with an insane build with a NullPointerException:java.lang.NullPointerException  at  org.apache.derby.iapi.sql.dictionary.ConglomerateDescriptor.drop(Unknown  Source)  at  org.apache.derby.iapi.sql.dictionary.ConstraintDescriptor.drop(Unknown  Source)  at  org.apache.derby.impl.sql.execute.DDLSingleTableConstantAction.dropConst  raint(Unknown Source)  at  org.apache.derby.impl.sql.execute.DDLSingleTableConstantAction.dropConst  raint(Unknown Source)  at  org.apache.derby.impl.sql.execute.DropTableConstantAction.dropAllConstra  intDescriptors(Unknown Source)  at  org.apache.derby.impl.sql.execute.DropTableConstantAction.executeConstan  tAction(Unknown Source)  at org.apache.derby.impl.sql.execute.MiscResultSet.open(Unknown  Source)  at  org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown  Source)  at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown  Source)  at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown  Source)  at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)  at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(Unknown  Source) Still need to figure out the exact versions affected  when the dup row was fixed  and when the drop stopped working.To reproduce connect to a database with 10.0.2.1 (can be accessed at http://svn.apache.org/repos/asf/db/derby/jars/10.0.2.1)run the attached script repro_create.sql;connect with the latest on the trunk or 10.5 branchDROP TABLE S.RS;The table will not drop. The work around is to drop the table with the old version 10.0.2.1,0,0
Engine code references org.apache.derby.shared.common.sanity.SanityManager,Derby engine code is importing org.apache.derby.shared.common.sanity.SanityManager  causing sealing violations. See DERBY-4669 why this fix is inadequate.Even though this won't fix the/all problems  using shared.common.sanity.SanityManager on the client and iapi.services.sanity.SanityManager in the engine code is a simple rule to follow. Violations are also easily addressed.,0,0
Intermittent OutOfMemoryErrors in BasicSetup.testTriggersWithLOBcolumns(),Seen many times in the JDK 7 tests lately  and also in the Tinderbox. First occurrence was here: http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/testlog/sol32/1134678-suitesAll_diff.txt(There had been no commits in the last two days before this test run  so it's difficult to say if a recent change caused it.)The test case has a comment that says that it should never read the LOB into memory  but according to the stack trace  that's exactly what's happening:Caused by: java.lang.OutOfMemoryError: Java heap space at org.apache.derby.iapi.types.SQLBinary.readFromStream(Unknown Source) at org.apache.derby.iapi.types.SQLBinary.readExternal(Unknown Source) at org.apache.derby.iapi.types.SQLBinary.getValue(Unknown Source) at org.apache.derby.iapi.types.SQLBinary.loadStream(Unknown Source) at org.apache.derby.impl.sql.execute.UpdateResultSet.objectifyStream(Unknown Source) at org.apache.derby.impl.sql.execute.UpdateResultSet.collectAffectedRows(Unknown Source) at org.apache.derby.impl.sql.execute.UpdateResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(Unknown Source) at org.apache.derbyTesting.functionTests.tests.upgradeTests.BasicSetup.testTriggersWithLOBcolumns(BasicSetup.java:854),0,0
Large batch of DDL in a database procedure dies on a transaction severity error.,The batch of DDL run by the procedure which registers database metadata functions now dies with the following error:ERROR 40XC0: Dead statement. This may be caused by catching a transaction severity error inside this statement.A process of binary search shows that this problem was introduced by revision 1086920 as part of the work on DERBY-5161.The bug can be reproduced by compiling the DBMDWrapper class attached to DERBY-3973 and then running the following script:connect 'jdbc:derby:memory:db;create=true'; create procedure registerPublicStaticMethods( in connectionURL varchar( 200 )  in printSQL boolean )language java parameter style java modifies sql dataexternal name 'DBMDWrapper.registerPublicStaticMethods';call registerPublicStaticMethods( 'jdbc:default:connection'  false );If you change the second argument to registerPublicStaticMethods to true  then you will see all of the DDL being issued by the database procedure. The procedure runs fine in 10.7 but fails with this error in 10.8.,0,0
Update tools/ide/netbeans directory,The tools/ide directory contains projects for two versions of NetBeans (5.5 and 6.0). Since they haven't been updated for newer versions of NetBeans  I suppose it means they aren't used much. Also  since there are two of them  NetBeans gets confused as to which of the projects to use  and I have experienced that it often uses a mix of the 5.5 and 6.0 projects for the open source files  which causes problems for navigation and debugging. The problem with having multiple NetBeans projects pointing to the same source is described here: http://wiki.netbeans.org/FaqSourceRootOverlapTo prevent these problems  we should either remove the tools/ide/netbeans directory and let NetBeans users create their own projects (there a pretty good description on the wiki: http://wiki.apache.org/db-derby/BuildingDerby#Using_NetBeans_to_Build_Derby )  or provide an updated project and remove the old ones.(The project files aren't really tied to a particular version of NetBeans and can be opened by newer versions. But the projects still need to be updated to be usable  I think. For example  they should have project-specific formatting settings (added in NB 6.5  I think) which set tab size to 4  since setting tab size globally to 4 as you would have to with the current projects  only works if Derby is the only project you're working on in NetBeans.),0,0
Unable to boot 10.5.1.1 database - fails during soft/hard upgrade process for a new version number while trying to drop jdbc metadata,I have been unable to get Derby 10.7.1.1 and 10.8.1.2 to boot the attached 10.5.1.1 database. Derby 10.6.1.0 is however able to use the DB.I'm not sure if this is a backwards compatibility bug or the result of corruption to the database. Running SYSCS_CHECK_TABLE and SYSCS_COMPRESS_TABLE under 10.6.1.0 found no problems with the database.NOTE: I have had to remove all data and non-essential tables/columns/triggers/etc prior to attaching this database.Output when connecting to the DB using ij:ERROR XJ040: Failed to start database 'C:/Users/BMASON/Sandbox/InternalDB' with class loader sun.misc.Launcher$AppClassLoader@11b86e7  see the next exception for details.ERROR XSDA7: Restore of a serializable or SQLData object of class   attempted to read more data than was originally storedFull exception from our application:java.sql.SQLException: Failed to start database 'C:/Users/BMASON/Sandbox/InternalDB' with class loader sun.misc.Launcher$AppClassLoader@93dee9  see the next exception for details. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.seeNextException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection30.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection40.&lt;init&gt;(Unknown Source) at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Unknown Source) at org.apache.derby.jdbc.InternalDriver.connect(Unknown Source) at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(Unknown Source) at org.apache.derby.jdbc.EmbeddedDataSource.getConnection(Unknown Source) at com.ADInstruments.LTS.util.DerbyUtils.exists(DerbyUtils.java:86) at com.ADInstruments.LTS.InternalDB.InternalDbUtilities.cacheInternalDbVersion(InternalDbUtilities.java:117) at com.ADInstruments.LTCS.InternalDB.InternalDbStartup.initialiseDatabase(InternalDbStartup.java:23) at com.ADInstruments.LTCS.StartupTasks$StartupRunnable.initDatabases(StartupTasks.java:35) at com.ADInstruments.LTCS.StartupTasks$StartupRunnable.run(StartupTasks.java:52) at java.lang.Thread.run(Thread.java:662)Caused by: java.sql.SQLException: Failed to start database 'C:/Users/BMASON/Sandbox/InternalDB' with class loader sun.misc.Launcher$AppClassLoader@93dee9  see the next exception for details. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source) ... 17 moreCaused by: java.sql.SQLException: Restore of a serializable or SQLData object of class   attempted to read more data than was originally stored at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source) ... 14 moreCaused by: ERROR XSDA7: Restore of a serializable or SQLData object of class   attempted to read more data than was originally stored at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.impl.store.raw.data.StoredPage.readRecordFromArray(Unknown Source) at org.apache.derby.impl.store.raw.data.StoredPage.restoreRecordFromSlot(Unknown Source) at org.apache.derby.impl.store.raw.data.BasePage.fetchFromSlot(Unknown Source) at org.apache.derby.impl.store.access.conglomerate.GenericScanController.fetchRows(Unknown Source) at org.apache.derby.impl.store.access.heap.HeapScan.fetchNext(Unknown Source) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaHeap(Unknown Source) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getAllSPSDescriptors(Unknown Source) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.dropJDBCMetadataSPSes(Unknown Source) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.updateMetadataSPSes(Unknown Source) at org.apache.derby.impl.sql.catalog.DD_Version.handleMinorRevisionChange(Unknown Source) at org.apache.derby.impl.sql.catalog.DD_Version.upgradeIfNeeded(Unknown Source) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.loadDictionaryTables(Unknown Source) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.boot(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(Unknown Source) at org.apache.derby.impl.services.monitor.TopService.bootModule(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(Unknown Source) at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Unknown Source) at org.apache.derby.impl.db.BasicDatabase.boot(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(Unknown Source) at org.apache.derby.impl.services.monitor.TopService.bootModule(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(Unknown Source) at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Unknown Source) ... 14 moreCaused by: java.io.EOFException at java.io.DataInputStream.readInt(DataInputStream.java:375) at org.apache.derby.iapi.sql.dictionary.TriggerDescriptor.readExternal(Unknown Source) at org.apache.derby.iapi.services.io.FormatIdInputStream.readObject(Unknown Source) at org.apache.derby.iapi.services.io.ArrayUtil.readArrayItems(Unknown Source) at org.apache.derby.impl.sql.execute.TriggerInfo.readExternal(Unknown Source) at org.apache.derby.iapi.services.io.FormatIdInputStream.readObject(Unknown Source) at org.apache.derby.impl.sql.execute.WriteCursorConstantAction.readExternal(Unknown Source) at org.apache.derby.impl.sql.execute.UpdateConstantAction.readExternal(Unknown Source) at org.apache.derby.iapi.services.io.FormatIdInputStream.readObject(Unknown Source) at org.apache.derby.impl.sql.GenericStorablePreparedStatement.readExternal(Unknown Source) at org.apache.derby.iapi.services.io.FormatIdInputStream.readObject(Unknown Source) at org.apache.derby.iapi.types.UserType.readExternal(Unknown Source) ... 39 more,0,0
test failure: NullPointerException with J2ME (weme 6.2) in testDerby4137_TransactionTimeoutSpecifiedNotExceeded(org.apache.derbyTesting.functionTests.tests.memory.XAMemTest),See: http://people.apache.org/~myrnavl/derby_test_results/main/windows/testlog/weme6.2/1136748-suites.All_diff.txt(until cleaned up).This test started failing after the following three changes were committed:-----------------------------------------------------------r1136397 | kahatlen | 2011-06-16 05:21:07 -0700 (Thu  16 Jun 2011) | 3 linesDERBY-5239: Remove usages of DriverManager to obtain an Embedded Connection in Derby ServerRemove import of DriverManager now that it's not used.------------------------------------------------------------------------r1136371 | kahatlen | 2011-06-16 03:54:33 -0700 (Thu  16 Jun 2011) | 6 linesDERBY-5274: getColumns() doesn't work with auto generated identitycolumns that start with large numbersRemoved hard-coded maximum length for the start value and increment inthe meta-data query.------------------------------------------------------------------------r1136363 | kristwaa | 2011-06-16 03:22:46 -0700 (Thu  16 Jun 2011) | 10 linesDERBY-4137: OOM issue using XA with timeouts Reduce the memory footprint when executing successful XA transactions thathave a timeout set by nulling out the reference to the XATransactionStateobject in the timer task. The timer task will stay around in the timer queueuntil reaching the scheduled time - even if the task is canceled.Added a regression test (run as part of 'ant junit-lowmem').Patch file: derby-4137-2a-reduce_memory_footprint.diff-----------------------------------------------------------The stack trace is like so:---------------------------------------------1) testDerby4137_TransactionTimeoutSpecifiedNotExceeded(org.apache.derbyTesting.functionTests.tests.memory.XAMemTest)junit.framework.AssertionFailedError: java.lang.NullPointerException at org.apache.derbyTesting.junit.JDBCDataSource.getDataSourceObject(JDBCDataSource.java:182) at org.apache.derbyTesting.junit.J2EEDataSource.getXADataSource(J2EEDataSource.java:98) at org.apache.derbyTesting.junit.J2EEDataSource.getXADataSource(J2EEDataSource.java:69) at org.apache.derbyTesting.functionTests.tests.memory.XAMemTest.testDerby4137_TransactionTimeoutSpecifiedNotExceeded(XAMemTest.java:65) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:195) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)Likely this test just needs to not run if (JDBC.vmSupportsJSR169()).,0,0
SQLAuthorisation and views,Hi in some cases there seem to be issues with SQLAuthorisation in conjunction with database VIEWS.Please see attached files as repro (script.txt has only the SQL I executed  output is the output resulting when running the script). I would think identical results should be returned in all cases and independent on how the view has been defined  but this to my surprise not being the case:1) Trying to select from view appl.'VW_MyTasks' - which is a simple view defined on just one table - leads to expected results  i.e. 'my' tasks are being returned.2) Trying to select from view appl.'VW_MyPriorityTasks - which is a view defined on two joined tables without using an inner join clause - leads to expected results  i.e. 'my' priority tasks are being returned.3) Trying to select from view appl.'VW2_MyPriorityTasks - which is the same view but now the two tables joined using an inner join clause - leads to an error and no tasks returned (when the same results as in 2) above were expected).4) Trying to select from view appl.'VW3_MyPriorityTasks' - which is a view defined using a subselect - also unexpectedly leads to an error.Note: While I could rewrite each inner join clause with changing the syntax like in 2) above  this provides a simple work-around for such cases. May be there is a work-around for subselects also (not sure if every subselect could be rewritten to a join?). However when depending on using EXISTS constructs in the query there unfortunately is no way (I would know of) to get around this problem. Unfortuanetly a view that makes use of EXISTS is also one I would need to define in my data base...Thanks,1,0
Change derby.tests.trace to print the class as well as fixture name,I was thinking it would be good for the test output with -Dderby.tests.trace=true to have the class name as well as the fixture as I think if I had a nickel for every time I grepped for a fixture name to find out what class it is in  I would have a pretty big piggy bank.It could print the full class name  like this:org.apache.derbyTesting.functionTests.tests.lang.SimpleTest.testBasicOperations used 844 ms .or strip off the org.apache.derbyTesting.functionTests for less output like:tests.lang.SimpleTest.testBugFixes used 6265 ms .Any preferences?,0,0
Remove dead methods (June 2011),Unused methods should be removed.,0,0
Assert failure with CASE expression in GROUP BY clause,I see the following assert failure with debug jars on 10.5.3.0 and later (doesn't fail on 10.5.1.1 and earlier):ij&gt; create table t(x int);0 rows inserted/updated/deletedij&gt; insert into t values 1;1 row inserted/updated/deletedij&gt; select case when a=1 then 1 else 2 end from t t1(a) join t t2(b) on a=b group by case when a=1 then 1 else 2 end;ERROR XJ001: Java exception: 'ASSERT FAILED retVN expected to be instanceof ColumnReference  not org.apache.derby.impl.sql.compile.ConditionalNode: org.apache.derby.shared.common.sanity.AssertFailure'.,0,0
Incorrect use of CharsetEncoder in DDMWriter,DDMWriter has two calls to CharsetEncoder.encode()  in writeLDString() and writeString(). According to the javadoc for CharsetEncoder  one should call reset() before one calls encode()  and flush() after on. DDMWriter doesn't call reset() or flush(). I'm not aware of any problems that happen because of it  but we should follow the spec to avoid surprises.,0,0
Repeated database creation causes OutOfMemoryError,Repeatedly creating  querying  updating  and shutting down a database or databases eventually causes OutOfMemoryError.Java source reproducing the problem is attached.,0,1
Starting 7/13/2011 weme 6.2 upgrade tests started failing with 213 failures 127 errors with java.lang.IllegalAccessException,Starting on 7/13/2011 weme 6.2 upgrade tests started failing with many failures and errors.The first Error is a java.lang.IllegalAccessException with stack trace below. It is probably related to this checkin.r1145973 | kahatlen | 2011-07-13 05:28:39 -0700 (Wed  13 Jul 2011) | 3 linesDERBY-5316: Unload old JDBC drivers when done with them in the upgrade testsAt first glance it looks like a JVM issue as the native method shoudln't get an IllegalAccessException.Probably best to work around it short term and disable the fix for weme. I think it just impacts the tests and not the product.Time: 11 927.828There were 127 errors:1) 10.1.1.0 Upgrade Phase: CREATE java.lang.IllegalAccessException at java.lang.reflect.Field.setImpl(Native Method) at java.lang.reflect.Field.set(Field.java:431) at org.apache.derbyTesting.functionTests.tests.upgradeTests.PhaseChanger.clearField(PhaseChanger.java:228) at org.apache.derbyTesting.functionTests.tests.upgradeTests.PhaseChanger.clearDerby23ThreadLocals(PhaseChanger.java:264) at org.apache.derbyTesting.functionTests.tests.upgradeTests.PhaseChanger.tearDown(PhaseChanger.java:153) at junit.extensions.TestSetup$1.protect(TestSetup.java:20) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23)2) testUnimplementedSQLObjectAttributes(org.apache.derbyTesting.functionTests.tests.jdbcapi.DatabaseMetaDataTest)SQL Exception: Feature not implemented: no details. at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.notImplemented(Unknown Source) at org.apache.derby.impl.jdbc.EmbedDatabaseMetaData.getAttributes(Unknown Source) at org.apache.derbyTesting.functionTests.tests.jdbcapi.DatabaseMetaDataTest.testUnimplementedSQLObjectAttributes(DatabaseMetaDataTest.java:944) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:195) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:23),0,0
URLCheck fails on phoneME,I see this failure on phoneME:org.apache.derbyTesting.functionTests.tests.tools.ToolScripts.URLCheck (from org.apache.derbyTesting.functionTests.suites.All)junit.framework.ComparisonFailure: Output at line 19 expected:&lt;&#91;ij(CONNECTION1)&gt; -- Find an unknown attribute.&#93;&gt; but was:&lt;&#91;JAVA ERROR: java.lang.NoClassDefFoundError: java.sql.Driver&#93;&gt; at org.apache.derbyTesting.functionTests.util.CanonTestCase.compareCanon(Unknown Source) at org.apache.derbyTesting.functionTests.util.ScriptTestCase.runTest(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(Unknown Source) at junit.extensions.TestDecorator.basicRun(Unknown Source) at junit.extensions.TestSetup$1.protect(Unknown Source) at junit.extensions.TestSetup.run(Unknown Source) at org.apache.derbyTesting.junit.BaseTestSetup.run(Unknown Source) at sun.misc.CVM.runMain(Unknown Source)The original test was excluded on Foundation because it required java.sql.Driver.,0,0
ij3Test fails on phoneME,org.apache.derbyTesting.functionTests.tests.tools.ij3Test.ij3 (from org.apache.derbyTesting.functionTests.suites.All)junit.framework.ComparisonFailure: Output at line 1 expected:&lt;ij&#91;(CONNECTION1)&#93;&gt; --&gt; but was:&lt;ij[]&gt; --&gt; at org.apache.derbyTesting.functionTests.util.CanonTestCase.compareCanon(Unknown Source) at org.apache.derbyTesting.functionTests.util.ScriptTestCase.runTest(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(Unknown Source) at junit.extensions.TestDecorator.basicRun(Unknown Source) at junit.extensions.TestSetup$1.protect(Unknown Source) at junit.extensions.TestSetup.run(Unknown Source) at junit.extensions.TestDecorator.basicRun(Unknown Source) at junit.extensions.TestSetup$1.protect(Unknown Source) at junit.extensions.TestSetup.run(Unknown Source) at org.apache.derbyTesting.junit.BaseTestSetup.run(Unknown Source) at sun.misc.CVM.runMain(Unknown Source),0,0
Restricted Table Function support should pass NOT EQUAL restrictions to initScan,Restricted Table Function support should pass NOT EQUAL restrictions to initScan. Currently any '!=' or '&lt;&gt;' constraints on the SQL used in the WHERE clause of a SELECT on a Restricted Table Funtion are not passed to the initScan method. These can be useful depending on how the Restricted Table Function is implemented.,0,1
AssertionFailedError in testCaseCS4595B_NonUniqueIndex in AccessTest,There was 1 failure:1) testCaseCS4595B_NonUniqueIndex(org.apache.derbyTesting.functionTests.tests.store.AccessTest)junit.framework.AssertionFailedError at org.apache.derbyTesting.functionTests.tests.store.AccessTest.assertStatsOK(AccessTest.java:402) at org.apache.derbyTesting.functionTests.tests.store.AccessTest.doTestCaseCS4595B(AccessTest.java:1720) at org.apache.derbyTesting.functionTests.tests.store.AccessTest.testCaseCS4595B_NonUniqueIndex(AccessTest.java:1830) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)Cf. http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/Limited/testSummary-1154534.html,0,0
NPE in BasicDatabase.stop in replication slave mode (dd.clearSequenceCaches),To reproduce  set up a replication pair and then stop the master (I used 'stopMaster=true').From derby.log on the slave:Replication slave role was stopped for database 'replicDB'.java.lang.NullPointerException at org.apache.derby.impl.db.BasicDatabase.stop(Unknown Source) at org.apache.derby.impl.db.SlaveDatabase.stop(SlaveDatabase.java:167) at org.apache.derby.impl.services.monitor.TopService.stop(TopService.java:443) at org.apache.derby.impl.services.monitor.TopService.shutdown(TopService.java:394) at org.apache.derby.impl.services.monitor.BaseMonitor.shutdown(BaseMonitor.java:229) at org.apache.derby.impl.db.DatabaseContextImpl.cleanupOnError(DatabaseContextImpl.java:77) at org.apache.derby.iapi.services.context.ContextManager.cleanupOnError(ContextManager.java:343) at org.apache.derby.impl.jdbc.TransactionResourceImpl.cleanupOnError(TransactionResourceImpl.java:437) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:339) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2290) at org.apache.derby.impl.jdbc.EmbedConnection.internalStopReplicationSlave(EmbedConnection.java:1034) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(EmbedConnection.java:353) at org.apache.derby.impl.jdbc.EmbedConnection30.&lt;init&gt;(EmbedConnection30.java:73) at org.apache.derby.impl.jdbc.EmbedConnection40.&lt;init&gt;(EmbedConnection40.java:51) at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:70) at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:248) at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:144) at org.apache.derby.impl.db.SlaveDatabase.handleShutdown(SlaveDatabase.java:428) at org.apache.derby.impl.db.SlaveDatabase.access$200(SlaveDatabase.java:72) at org.apache.derby.impl.db.SlaveDatabase$SlaveDatabaseBootThread.run(SlaveDatabase.java:328) at java.lang.Thread.run(Thread.java:722)The reason is that there is no data dictionary available when the database is in replication slave mode.Note that the exception is caught and simply printed to derby.log.,0,0
By default  only the DBO should be allowed to run several of the diagnostic VTIs.,Only the DBO should be allowed to run the following VTIs: syscs_diag.statement_cache syscs_diag.transaction_table syscs_diag.error_log_reader( ) syscs_diag.statement_duration(),1,0
Intermittent failures in CompressTableTest and TruncateTableTest,The test cases CompressTableTest.testConcurrentInvalidation() and TruncateTableTest.testConcurrentInvalidation() fail intermittently with errors such as:ERROR XSAI2: The conglomerate (2 720) requested does not exist.The problem has been analyzed in the comments on DERBY-4275  and a patch attached to that issue (invalidation-during-compilation.diff) fixes the underlying race condition. However  that patch only works correctly together with the fix for DERBY-5161  which was backed out because it caused the regression DERBY-5280.We will therefore need to find a way to fix DERBY-5161 without reintroducing DERBY-5280 in order to resolve this issue.,0,0
MemoryLeakFixesTest.testRepeatedDatabaseCreationWithAutoStats() fails on phoneME: java.lang.InternalError: Number of class names exceeds vm limit.,Seen when running MemoryLeakFixesTest  both with trunk and with the 10.8.2.1 release candidate:1) testRepeatedDatabaseCreationWithAutoStats(org.apache.derbyTesting.functionTests.tests.memory.MemoryLeakFixesTest)java.lang.InternalError: Number of class names exceeds vm limit. at java.lang.ClassLoader.findLoadedClass0(Native Method) at java.lang.ClassLoader.findLoadedClass(Unknown Source) at java.lang.ClassLoader.loadClass(Unknown Source) at sun.misc.Launcher$AppClassLoader.loadClass(Unknown Source) at java.lang.ClassLoader.loadClass(Unknown Source) at java.util.ResourceBundle.loadBundle(Unknown Source) at java.util.ResourceBundle.findBundle(Unknown Source) at java.util.ResourceBundle.getBundleImpl(Unknown Source) at java.util.ResourceBundle.getBundle(Unknown Source) at org.apache.derby.iapi.services.i18n.MessageService.getBundleWithEnDefault(Unknown Source) at org.apache.derby.iapi.services.i18n.MessageService.getBundleForLocale(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.getBundle(Unknown Source) at org.apache.derby.iapi.services.i18n.MessageService.getBundle(Unknown Source) at org.apache.derby.iapi.services.i18n.MessageService.getCompleteMessage(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection30.&lt;init&gt;(Unknown Source) at org.apache.derby.jdbc.Driver169.getNewEmbedConnection(Unknown Source) at org.apache.derby.jdbc.InternalDriver.connect(Unknown Source) at org.apache.derby.jdbc.EmbeddedSimpleDataSource.getConnection(Unknown Source) at org.apache.derby.jdbc.EmbeddedSimpleDataSource.getConnection(Unknown Source) at org.apache.derbyTesting.functionTests.tests.memory.MemoryLeakFixesTest.testRepeatedDatabaseCreationWithAutoStats(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(Unknown Source) at junit.extensions.TestDecorator.basicRun(Unknown Source) at junit.extensions.TestSetup$1.protect(Unknown Source) at junit.extensions.TestSetup.run(Unknown Source) at org.apache.derbyTesting.junit.BaseTestSetup.run(Unknown Source) at sun.misc.CVM.runMain(Unknown Source),0,1
SysDiagVTIMappingTest.test_5391() failed: java.text.ParseException: Unparseable date: 'Thu Sep 15 14:00:16 CEST 2011',Seen when testing the 10.8.2.1 release candidate on Windows 7:http://dbtg.foundry.sun.com/derby/test/10.8.2.1_RC/logs/jvm1.6/win7/suitesAll/report.txtThere were 2 errors:1) test_5391(org.apache.derbyTesting.functionTests.tests.lang.SysDiagVTIMappingTest)java.text.ParseException: Unparseable date: 'Thu Sep 15 14:00:16 CEST 2011' at java.text.DateFormat.parse(DateFormat.java:337) at org.apache.derbyTesting.functionTests.tests.lang.SysDiagVTIMappingTest.vetTimestamp(SysDiagVTIMappingTest.java:744) at org.apache.derbyTesting.functionTests.tests.lang.SysDiagVTIMappingTest.test_5391(SysDiagVTIMappingTest.java:728) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)2) test_5391(org.apache.derbyTesting.functionTests.tests.lang.SysDiagVTIMappingTest)java.text.ParseException: Unparseable date: 'Thu Sep 15 14:00:16 CEST 2011' at java.text.DateFormat.parse(DateFormat.java:337) at org.apache.derbyTesting.functionTests.tests.lang.SysDiagVTIMappingTest.vetTimestamp(SysDiagVTIMappingTest.java:744) at org.apache.derbyTesting.functionTests.tests.lang.SysDiagVTIMappingTest.test_5391(SysDiagVTIMappingTest.java:728) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25),0,0
Make Derby run on Oracle Java ME Embedded Client,I tried running Derby on Oracle Java ME Embedded Client 1.0  and booting the engine failed:Caused by: java.lang.NoClassDefFoundError: java.nio.channels.OverlappingFileLockException at org.apache.derby.impl.io.DirStorageFactory4.newPersistentFile(DirStorageFactory4.java:57) at org.apache.derby.impl.io.DirStorageFactory.newStorageFile(DirStorageFactory.java:58) at org.apache.derby.impl.services.monitor.StorageFactoryService$1.run(StorageFactoryService.java:96) at java.security.AccessController.doPrivileged(Compiled Method)(AccessController.java:351) at java.security.AccessController.doPrivileged(AccessController.java:320) at org.apache.derby.impl.services.monitor.StorageFactoryService.&lt;init&gt;(StorageFactoryService.java:86) at org.apache.derby.impl.services.monitor.BaseMonitor.getPersistentService(BaseMonitor.java:1630) at org.apache.derby.impl.services.monitor.BaseMonitor.access$100(BaseMonitor.java:99) at org.apache.derby.impl.services.monitor.BaseMonitor$ProviderEnumeration.getNextStorageFactory(BaseMonitor.java:2146) at org.apache.derby.impl.services.monitor.BaseMonitor$ProviderEnumeration.hasMoreElements(BaseMonitor.java:2159) at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(BaseMonitor.java:1516) at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:979) at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:550) at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:2697) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(EmbedConnection.java:385)This seems to happen because Derby recognizes it as a Java 1.4 platform  whereas it's actually a CDC/FP 1.1.2 platform.,0,1
On z/OS testConnectWrongSubprotocolWithSystemProperty(org.apache.derbyTesting.functionTests.tests.tools.ConnectWrongSubprotocolTest)junit.framework.Asserti ailedError,With the release candidate 10.8.2.1 - (1170221) I saw the following two failures on z/OS in testConnectWrongSubprotoctestolWithoutSystemPropertyThere were 2 failures:1) testConnectWrongSubprotocolWithSystemProperty(org.apache.derbyTesting.functionTests.tests.tools.ConnectWrongSubprotocolTest)junit.framework.AssertionFailedError at org.apache.derbyTesting.functionTests.tests.tools.ConnectWrongSubprotocolTest.checkConnectWrongSubprotocol(ConnectWrongSubprotocolTest.java:82) at org.apache.derbyTesting.functionTests.tests.tools.ConnectWrongSubprotocolTest.testConnectWrongSubprotocolWithSystemProperty(ConnectWrongSubprotocolTest.java:68) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16)2) testConnectWrongSubprotoctestolWithoutSystemProperty(org.apache.derbyTesting.functionTests.tests.tools.ConnectWrongSubprotocolTest)junit.framework.AssertionFailedError at org.apache.derbyTesting.functionTests.tests.tools.ConnectWrongSubprotocolTest.checkConnectWrongSubprotocol(ConnectWrongSubprotocolTest.java:82) at org.apache.derbyTesting.functionTests.tests.tools.ConnectWrongSubprotocolTest.testConnectWrongSubprotoctestolWithoutSystemProperty(ConnectWrongSubprotocolTest.java:76) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.extensions.TestSetup.run(TestSetup.java:16)FAILURES!!!Tests run: 13984  Failures: 2  Errors: 0The test is newly converted with DERBY-5084 so not likely a regression  but probably more likely an encoding issue related to this test: String ijResult = runIjScript(ijScript  useSystemProperties);  assertTrue(ijResult.indexOf('08001') &gt; -1);,0,0
Unauthorized shutdown should not generate thread dump and javacore. AuthenticationTest dumps over 20 javacores with IBM JVM for normal user errors,If jdbcapi.AuthenticationTest is run without changing the derby.stream.error.extendedDiagSeverityLevel as is done in the test  it generates thread dumps and javacores for IBM jvms. I beleive the errors in this test are expected user errors and not crashes so they should not generate a thread dump or javacore. To reproduce remove this line from test: //Derby-4856 set the property to avoid thread dump and diagnostic info sysprops.put('derby.stream.error.extendedDiagSeverityLevel' '50000');Until fixed  users can work around the issue by setting derby.stream.error.extendedDiagSeverityLevel to 50000 as is done in the test.,1,0
Empty MAPS table in toursdb,The toursdb that's bundled with 10.7.1.1 and 10.8.1.2 (and the 10.8.2.1 release candidate) has no rows in the MAPS table. Version 10.6.2.1 had three rows in that table:ij&gt; select * from maps;MAP_ID |MAP_NAME |REGION |AREA |PHOTO_FORMAT |PICTURE --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------1 |North Ocean |Cup Island |1776.1100 |gif |4749463839613601fe00f70000000000800000008000808000000080800080008080808080c0c0c0ff000000ff00ffff000000ffff00ff00ffffffffff00000&amp;2 |Middle Ocean |Small Island |1166.7700 |gif |47494638396192008e00f70000000000800000008000808000000080800080008080808080c0c0c0ff000000ff00ffff000000ffff00ff00ffffffffff00000&amp;3 |South Ocean |Witch Island |9117.9000 |gif |474946383961f602f301f70000000000800000008000808000000080800080008080808080c0c0c0ff000000ff00ffff000000ffff00ff00ffffffffff00000&amp;3 rows selectedBuilding it on a clean trunk and looking at generated/toursdb/toursdb.out gives the following hint:FAIL &#8211; unexpected exception: java.sql.SQLException: Database 'toursDB' not found.java.sql.SQLException: Database 'toursDB' not found. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:98) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:148) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:227) at org.apache.derby.impl.jdbc.EmbedConnection.newSQLException(EmbedConnection.java:3085) at org.apache.derby.impl.jdbc.EmbedConnection.handleDBNotFound(EmbedConnection.java:735) at org.apache.derby.impl.jdbc.EmbedConnection.&lt;init&gt;(EmbedConnection.java:414) at org.apache.derby.impl.jdbc.EmbedConnection30.&lt;init&gt;(EmbedConnection30.java:73) at org.apache.derby.impl.jdbc.EmbedConnection40.&lt;init&gt;(EmbedConnection40.java:51) at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:70) at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:248) at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:146) at java.sql.DriverManager.getConnection(DriverManager.java:582) at java.sql.DriverManager.getConnection(DriverManager.java:207) at toursdb.insertMaps.main(insertMaps.java:51)Caused by: java.sql.SQLException: Database 'toursDB' not found. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71) ... 14 moreI suspect this was introduced by the changes in DERBY-3986 when the destination directory for toursdb was changed.,0,0
SpawnedProcess.complete may fail to destroy the process when a timeout is specified,The logic in SpawnedProcess has a weakness that may result in the wrapped process not being destroyed if the destroy variable is false and a timeout is specified.The problem is that the while condition will shortcut the if condition in the catch clause (where destroy is set to true if the timeout is exceeded).,0,0
ERROR 40001 deadlock in nstest on select max(serialkey),nstest with 10.8.2 (both 10.8.2.1 RC2 (revision 1170221) and builds off the 10.8. tree at 10.8.2.2 level after backing out re DERBY-5448) show deadlock errors like the following:Caused by: ERROR 40001: A lock could not be obtained due to a deadlock  cycle of at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedResultSet.closeOnTransactionError(Unknown Source) at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(Unknown Source) at org.apache.derby.impl.jdbc.EmbedResultSet.next(Unknown Source) at org.apache.derbyTesting.system.nstest.utils.DbUtil.pick_one(DbUtil.java:491) at org.apache.derbyTesting.system.nstest.utils.DbUtil.delete_one_row(DbUtil.java:418) at org.apache.derbyTesting.system.nstest.tester.TesterObject.doIUDOperation(TesterObject.java:175) at org.apache.derbyTesting.system.nstest.tester.Tester2.startTesting(Tester2.java:109) at org.apache.derbyTesting.system.nstest.NsTest.run(NsTest.java:555)Caused by: java.sql.SQLException: A lock could not be obtained due to a deadlock  cycle of locks and waiters is:Lock : ROW  NSTESTTAB  (619 15) Waiting XID : {104564  S}   NSTEST  select max(serialkey) from nstesttab where serialkey &gt; ? Granted XID : {104179  X}Lock : ROW  NSTESTTAB  (619 16) Waiting XID : {104179  S}   NSTEST  select max(serialkey) from nstesttab where serialkey &gt; ? Granted XID : {104564  X}. The selected victim is XID : 104564. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source) ... 14 moreFor more examples  see comments on DERBY-5448.,0,0
Problems running SecureServerTest and replication tests on Open JDK 7 for Mac OS X,I see the following errors when I run the JUnit tests on Open JDK 7 for Mac OS X:sanity is sane..START-SPAWNED:sysinfo STANDARD OUTPUT: exit code=1Tue Oct 11 10:15:02 PDT 2011 : Error getting SysInfo information.END-SPAWNED :sysinfo STANDARD OUTPUT:FSTART-SPAWNED:SpawnedNetworkServer STANDARD OUTPUT: exit code=143Tue Oct 11 10:14:54 PDT 2011 : Security manager installed using the Basic server security policy.Tue Oct 11 10:15:01 PDT 2011 : Warning: UnknkownHostException: richard-hillegas-computer.local: richard-hillegas-computer.local: nodename nor servname provided  or not known.Tue Oct 11 10:15:01 PDT 2011 : Apache Derby Network Server - 10.8.2.2 - (1181258) started and ready to accept connections on port 1527Tue Oct 11 10:15:02 PDT 2011 : host: localhost is not local to the server running on 0.0.0.0  so cannot be used for NetworkServerControl commands Tue Oct 11 10:15:02 PDT 2011 : host: localhost is not local to the server running on 0.0.0.0  so cannot be used for NetworkServerControl commands END-SPAWNED :SpawnedNetworkServer STANDARD OUTPUT:E.START-SPAWNED:sysinfo STANDARD OUTPUT: exit code=1Tue Oct 11 10:15:50 PDT 2011 : Error getting SysInfo information.END-SPAWNED :sysinfo STANDARD OUTPUT:FSTART-SPAWNED:SpawnedNetworkServer STANDARD OUTPUT: exit code=143Tue Oct 11 10:15:43 PDT 2011 : Security manager installed using the Basic server security policy.Tue Oct 11 10:15:50 PDT 2011 : Warning: UnknkownHostException: richard-hillegas-computer.local: richard-hillegas-computer.local: nodename nor servname provided  or not known.Tue Oct 11 10:15:50 PDT 2011 : Apache Derby Network Server - 10.8.2.2 - (1181258) started and ready to accept connections on port 1527Tue Oct 11 10:15:50 PDT 2011 : host: localhost is not local to the server running on 0.0.0.0  so cannot be used for NetworkServerControl commands Tue Oct 11 10:15:50 PDT 2011 : host: localhost is not local to the server running on 0.0.0.0  so cannot be used for NetworkServerControl commands END-SPAWNED :SpawnedNetworkServer STANDARD.START-SPAWNED:SpawnedNetworkServer ERROR OUTPUT:Error: Exception thrown by the agent : java.net.MalformedURLException: Local host name unknown: java.net.UnknownHostException: richard-hillegas-computer.local: richard-hillegas-computer.local: nodename nor servname provided  or not knownEND-SPAWNED :SpawnedNetworkServer ERROR OUTPUT:F.START-SPAWNED:SpawnedNetworkServer ERROR OUTPUT:Error: Exception thrown by the agent : java.net.MalformedURLException: Local host name unknown: java.net.UnknownHostException: richard-hillegas-computer.local: richard-hillegas-computer.local: nodename nor servname provided  or not knownEND-SPAWNED :SpawnedNetworkServer ERROR OUTPUT:F.START-SPAWNED:SpawnedNetworkServer ERROR OUTPUT:Error: Exception thrown by the agent : java.net.MalformedURLException: Local host name unknown: java.net.UnknownHostException: richard-hillegas-computer.local: richard-hillegas-computer.local: nodename nor servname provided  or not knownEND-SPAWNED :SpawnedNetworkServer ERROR OUTPUT:F.START-SPAWNED:SpawnedNetworkServer ERROR OUTPUT:Error: Exception thrown by the agent : java.net.MalformedURLException: Local host name unknown: java.net.UnknownHostException: richard-hillegas-computer.local: richard-hillegas-computer.local: nodename nor servname provided  or not knownEND-SPAWNED :SpawnedNetworkServer ERROR OUTPUT:F.....START-SPAWNED:SpawnedNetworkServer ERROR OUTPUT:Error: Exception thrown by the agent : java.net.MalformedURLException: Local host name unknown: java.net.UnknownHostException: richard-hillegas-computer.local: richard-hillegas-computer.local: nodename nor servname provided  or not knownEND-SPAWNED :SpawnedNetworkServer ERROR OUTPUT:F......................START-SPAWNED:SpawnedNetworkServer ERROR OUTPUT:Error: Exception thrown by the agent : java.net.MalformedURLException: Local host name unknown: java.net.UnknownHostException: richard-hillegas-computer.local: richard-hillegas-computer.local: nodename nor servname provided  or not knownEND-SPAWNED :SpawnedNetworkServer ERROR OUTPUT:F.E.E.E.F.E.E.E.E.E.E.E.E.E.E.E.E.E.E.ETime: 5 033.075There were 20 errors:1) SecureServerTest( Opened = false  Authenticated= true  CustomDerbyProperties= null  WildCardHost= 0.0.0.0 )java.lang.Exception: DRDA_NeedLocalHost.S:host: localhost is not local to the server running on 0.0.0.0  so cannot be used for NetworkServerControl commands  at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessageWork(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessage(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.readResult(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.shutdown(Unknown Source) at org.apache.derby.drda.NetworkServerControl.shutdown(Unknown Source) at org.apache.derbyTesting.junit.NetworkServerTestSetup.tearDown(NetworkServerTestSetup.java:379) at junit.extensions.TestSetup$1.protect(TestSetup.java:22) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)2) SecureServerTest( Opened = false  Authenticated= true  CustomDerbyProperties= null  WildCardHost= 0.00.000.0 )java.lang.Exception: DRDA_NeedLocalHost.S:host: localhost is not local to the server running on 0.0.0.0  so cannot be used for NetworkServerControl commands  at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessageWork(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessage(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.readResult(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.shutdown(Unknown Source) at org.apache.derby.drda.NetworkServerControl.shutdown(Unknown Source) at org.apache.derbyTesting.junit.NetworkServerTestSetup.tearDown(NetworkServerTestSetup.java:379) at junit.extensions.TestSetup$1.protect(TestSetup.java:22) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)3) testReplication_Local_LogFilesSynched(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local)java.sql.SQLException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XSAI2  SQLERRMC: 384XSAI2.S at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.client.am.SqlException.getSQLException(Unknown Source) at org.apache.derby.client.am.Statement.execute(Unknown Source) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.bootMasterDatabase(ReplicationRun.java:868) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local.testReplication_Local_LogFilesSynched(ReplicationRun_Local.java:195) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:206) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)Caused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XSAI2  SQLERRMC: 384XSAI2.S at org.apache.derby.client.am.Statement.completeSqlca(Unknown Source) at org.apache.derby.client.net.NetStatementReply.parsePrepareError(Unknown Source) at org.apache.derby.client.net.NetStatementReply.parsePRPSQLSTTreply(Unknown Source) at org.apache.derby.client.net.NetStatementReply.readPrepare(Unknown Source) at org.apache.derby.client.net.StatementReply.readPrepare(Unknown Source) at org.apache.derby.client.net.NetStatement.readPrepare_(Unknown Source) at org.apache.derby.client.am.Statement.readPrepare(Unknown Source) at org.apache.derby.client.am.Statement.flowExecute(Unknown Source) at org.apache.derby.client.am.Statement.executeX(Unknown Source) ... 32 more4) testReplication_Local_1_InsertUpdateDeleteOnMaster(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_1)java.sql.SQLException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XSAI2  SQLERRMC: 384XSAI2.S at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.client.am.SqlException.getSQLException(Unknown Source) at org.apache.derby.client.am.Statement.execute(Unknown Source) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.bootMasterDatabase(ReplicationRun.java:868) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_1.testReplication_Local_1_InsertUpdateDeleteOnMaster(ReplicationRun_Local_1.java:77) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:206) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)Caused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XSAI2  SQLERRMC: 384XSAI2.S at org.apache.derby.client.am.Statement.completeSqlca(Unknown Source) at org.apache.derby.client.net.NetStatementReply.parsePrepareError(Unknown Source) at org.apache.derby.client.net.NetStatementReply.parsePRPSQLSTTreply(Unknown Source) at org.apache.derby.client.net.NetStatementReply.readPrepare(Unknown Source) at org.apache.derby.client.net.StatementReply.readPrepare(Unknown Source) at org.apache.derby.client.net.NetStatement.readPrepare_(Unknown Source) at org.apache.derby.client.am.Statement.readPrepare(Unknown Source) at org.apache.derby.client.am.Statement.flowExecute(Unknown Source) at org.apache.derby.client.am.Statement.executeX(Unknown Source) ... 32 more5) testReplication_Local_1_Indexing(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_1Indexing)java.sql.SQLException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XSAI2  SQLERRMC: 384XSAI2.S at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.client.am.SqlException.getSQLException(Unknown Source) at org.apache.derby.client.am.Statement.execute(Unknown Source) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.bootMasterDatabase(ReplicationRun.java:868) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.makeReadyForReplication(ReplicationRun.java:2518) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_1Indexing.testReplication_Local_1_Indexing(ReplicationRun_Local_1Indexing.java:70) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:206) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)Caused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XSAI2  SQLERRMC: 384XSAI2.S at org.apache.derby.client.am.Statement.completeSqlca(Unknown Source) at org.apache.derby.client.net.NetStatementReply.parsePrepareError(Unknown Source) at org.apache.derby.client.net.NetStatementReply.parsePRPSQLSTTreply(Unknown Source) at org.apache.derby.client.net.NetStatementReply.readPrepare(Unknown Source) at org.apache.derby.client.net.StatementReply.readPrepare(Unknown Source) at org.apache.derby.client.net.NetStatement.readPrepare_(Unknown Source) at org.apache.derby.client.am.Statement.readPrepare(Unknown Source) at org.apache.derby.client.am.Statement.flowExecute(Unknown Source) at org.apache.derby.client.am.Statement.executeX(Unknown Source) ... 33 more6) testReplication_Local_StateTest_part1_1(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_1)java.sql.SQLException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XSAI2  SQLERRMC: 384XSAI2.S at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.client.am.SqlException.getSQLException(Unknown Source) at org.apache.derby.client.am.Statement.execute(Unknown Source) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.bootMasterDatabase(ReplicationRun.java:868) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_1.testReplication_Local_StateTest_part1_1(ReplicationRun_Local_StateTest_part1_1.java:96) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:206) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)Caused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XSAI2  SQLERRMC: 384XSAI2.S at org.apache.derby.client.am.Statement.completeSqlca(Unknown Source) at org.apache.derby.client.net.NetStatementReply.parsePrepareError(Unknown Source) at org.apache.derby.client.net.NetStatementReply.parsePRPSQLSTTreply(Unknown Source) at org.apache.derby.client.net.NetStatementReply.readPrepare(Unknown Source) at org.apache.derby.client.net.StatementReply.readPrepare(Unknown Source) at org.apache.derby.client.net.NetStatement.readPrepare_(Unknown Source) at org.apache.derby.client.am.Statement.readPrepare(Unknown Source) at org.apache.derby.client.am.Statement.flowExecute(Unknown Source) at org.apache.derby.client.am.Statement.executeX(Unknown Source) ... 32 more7) testReplication_Local_StateTest_part1_2(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_2)java.sql.SQLException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XSAI2  SQLERRMC: 384XSAI2.S at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.client.am.SqlException.getSQLException(Unknown Source) at org.apache.derby.client.am.Statement.execute(Unknown Source) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.bootMasterDatabase(ReplicationRun.java:868) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_2.testReplication_Local_StateTest_part1_2(ReplicationRun_Local_StateTest_part1_2.java:104) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:206) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)Caused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XSAI2  SQLERRMC: 384XSAI2.S at org.apache.derby.client.am.Statement.completeSqlca(Unknown Source) at org.apache.derby.client.net.NetStatementReply.parsePrepareError(Unknown Source) at org.apache.derby.client.net.NetStatementReply.parsePRPSQLSTTreply(Unknown Source) at org.apache.derby.client.net.NetStatementReply.readPrepare(Unknown Source) at org.apache.derby.client.net.StatementReply.readPrepare(Unknown Source) at org.apache.derby.client.net.NetStatement.readPrepare_(Unknown Source) at org.apache.derby.client.am.Statement.readPrepare(Unknown Source) at org.apache.derby.client.am.Statement.flowExecute(Unknown Source) at org.apache.derby.client.am.Statement.executeX(Unknown Source) ... 32 more8) testReplication_Local_StateTest_part1_3(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_3)java.sql.SQLException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XSAI2  SQLERRMC: 384XSAI2.S at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.client.am.SqlException.getSQLException(Unknown Source) at org.apache.derby.client.am.Statement.execute(Unknown Source) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.bootMasterDatabase(ReplicationRun.java:868) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_3.testReplication_Local_StateTest_part1_3(ReplicationRun_Local_StateTest_part1_3.java:95) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:206) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)Caused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XSAI2  SQLERRMC: 384XSAI2.S at org.apache.derby.client.am.Statement.completeSqlca(Unknown Source) at org.apache.derby.client.net.NetStatementReply.parsePrepareError(Unknown Source) at org.apache.derby.client.net.NetStatementReply.parsePRPSQLSTTreply(Unknown Source) at org.apache.derby.client.net.NetStatementReply.readPrepare(Unknown Source) at org.apache.derby.client.net.StatementReply.readPrepare(Unknown Source) at org.apache.derby.client.net.NetStatement.readPrepare_(Unknown Source) at org.apache.derby.client.am.Statement.readPrepare(Unknown Source) at org.apache.derby.client.am.Statement.flowExecute(Unknown Source) at org.apache.derby.client.am.Statement.executeX(Unknown Source) ... 32 more9) testReplication_Local_StateTest_part2(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part2)java.sql.SQLException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XSAI2  SQLERRMC: 384XSAI2.S at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.client.am.SqlException.getSQLException(Unknown Source) at org.apache.derby.client.am.Statement.execute(Unknown Source) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.bootMasterDatabase(ReplicationRun.java:868) at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part2.testReplication_Local_StateTest_part2(ReplicationRun_Local_StateTest_part2.java:97) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at org.apache.derbyTesting.functi,0,0
ant release should not modify drdamaint version,ant release automatically sets drdamaint version to 0 in release.properties.However  on the 10.8 branch  drdamaint version had been increased to trigger a difference in behavior with vs. without a particular check in; ant release caused this to get reset thus breaking the fix.ant release should somehow assess the value of drdamaint.,0,0
Speed up message splitting in build,On a slow machine I sometimes use to build Derby  running the org.apache.derbyBuild.splitmessages tool takes 30 seconds and accounts for 15% of the total time needed to run 'ant -q buildsource' (which builds the engine  the network server and the client  but not the tests or demos). The tool is invoked 15 times  and each time a new Java process is started because the Ant target has specified fork='yes'. By changing it to run the splitmessages tool in the same Java process as the one running Ant  the time is reduced to 3-4 seconds on the same machine.,0,1
Speed up creation of bin scripts,The binscripts build target takes around 3 seconds in the environments I use for building Derby. It looks like most of the time is spent running the chmod Ant task on the generated scripts. There are six invocations of the chmod task  one for each script. The chmod task can operate on multiple files  so one invocation should be enough (and one invocation on six files seems to have about the same cost as one invocation on a single file).A related problem is that the scripts are always regenerated in incremental builds  even when there's nothing to do  so the binscripts target accounts for a significant part of the time it takes to run an incremental build.,0,1
Don't run MessageVetter unless messages have changed,Continuing my series of patches micro-optimizing the build scripts...MessageVetter is always run as part of the build  also in incremental builds when nothing has changed. Since it needs to go through more than 800 files  it may take a while (just half a second on the fastest machine I tested  so not a big deal  but that's still a significant portion of the total time in an incremental build). We should skip the message check in incremental builds if none of the messages have changed.,0,0
Reduce number of jar invocations in the buildjars target,When building derby.jar  derbytools.jar and derbynet.jar  the build script runs the jar target twice for each of the jars. The first jar invocation creates the jar and adds some files  and the second one updates the jars with some more files. It would be simpler to create each of the jar files in a single invocation  and it would also cut off a few seconds on the time to build the jars.,0,0
Restrictive file permissions: permissions removed also for owner on NTFS if Acl does not contain explicit entry for owner,It turns out that the file owner does not necessarily get an explicit AclEntry; this depends on whether the created file has sufficient permissions already through  say  a permission for everybody to write. The present logic removes all AclEntries except those granted to the file's owner  erroneously presuming there would be such an entry always. This led to all AclEntries being removed. This error is seen in Oracle's nightly regressions for Windows  but did not reproduced when running manually on Windows. This was due to different default inherited permissions on the directories in which the regression tests were run.,1,0
Same value returned by successive calls to a sequence generator.,The following script shows the same value being returned from a sequence generator by two successive NEXT VALUE FOR calls. Thanks to Knut for finding this:connect 'jdbc:derby:memory:db;create=true';create table t (x int);create sequence s;autocommit off;select count from sys.syssequences with rs;values next value for s;drop table t;rollback;&#8211; same value as previous callvalues next value for s;,0,0
ClosedByInterruptException in AuthenticationTest,AuthenticationTest failed with this error on trunk (intermittent error  passed when I reran suites.All):java.sql.SQLException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XJ040  SQLERRMC: Failed to start database 'singleUse/oneuse2c' with class loader sun.misc.Launcher$AppClassLoader@1ff5ea7  see the next exception for details.::SQLSTATE: XJ001Java exception: 'ASSERT FAILED Unable to Acquire Exclusive Lock on /export/home/hudsond/.hudson/jobs/Derby-JUnit/workspace/test/system/singleUse/oneuse2c/dbex.lck: org.apache.derby.shared.common.sanity.AssertFailure'.::SQLSTATE: XJ001Java exception: ': java.nio.channels.ClosedByInterruptException'. at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:99) at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:364) at org.apache.derby.jdbc.ClientDriver.connect(ClientDriver.java:166) at java.sql.DriverManager.getConnection(DriverManager.java:579) at java.sql.DriverManager.getConnection(DriverManager.java:190) at org.apache.derbyTesting.junit.DriverManagerConnector.openConnection(DriverManagerConnector.java:81) at org.apache.derbyTesting.junit.DriverManagerConnector.openConnection(DriverManagerConnector.java:43) at org.apache.derbyTesting.junit.TestConfiguration.openDefaultConnection(TestConfiguration.java:1574) at org.apache.derbyTesting.junit.BaseJDBCTestSetup.getConnection(BaseJDBCTestSetup.java:72) at org.apache.derbyTesting.junit.DatabasePropertyTestSetup.tearDown(DatabasePropertyTestSetup.java:280) at junit.extensions.TestSetup$1.protect(TestSetup.java:24) at junit.extensions.TestSetup.run(TestSetup.java:27) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:23) at junit.extensions.TestSetup.run(TestSetup.java:27) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:23) at junit.extensions.TestSetup.run(TestSetup.java:27) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:23) at junit.extensions.TestSetup.run(TestSetup.java:27) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:23) at junit.extensions.TestSetup.run(TestSetup.java:27) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:23) at junit.extensions.TestSetup.run(TestSetup.java:27) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:23) at junit.extensions.TestSetup.run(TestSetup.java:27)Caused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1  SQLSTATE: XJ040  SQLERRMC: Failed to start database 'singleUse/oneuse2c' with class loader sun.misc.Launcher$AppClassLoader@1ff5ea7  see the next exception for details.::SQLSTATE: XJ001Java exception: 'ASSERT FAILED Unable to Acquire Exclusive Lock on /export/home/hudsond/.hudson/jobs/Derby-JUnit/workspace/test/system/singleUse/oneuse2c/dbex.lck: org.apache.derby.shared.common.sanity.AssertFailure'.::SQLSTATE: XJ001Java exception: ': java.nio.channels.ClosedByInterruptException'. at org.apache.derby.client.am.Connection.completeSqlca(Connection.java:2125) at org.apache.derby.client.net.NetConnectionReply.parseRdbAccessFailed(NetConnectionReply.java:538) at org.apache.derby.client.net.NetConnectionReply.parseAccessRdbError(NetConnectionReply.java:431) at org.apache.derby.client.net.NetConnectionReply.parseACCRDBreply(NetConnectionReply.java:294) at org.apache.derby.client.net.NetConnectionReply.readAccessDatabase(NetConnectionReply.java:121) at org.apache.derby.client.net.NetConnection.readSecurityCheckAndAccessRdb(NetConnection.java:826) at org.apache.derby.client.net.NetConnection.flowSecurityCheckAndAccessRdb(NetConnection.java:762) at org.apache.derby.client.net.NetConnection.flowUSRIDPWDconnect(NetConnection.java:591) at org.apache.derby.client.net.NetConnection.flowConnect(NetConnection.java:406) at org.apache.derby.client.net.NetConnection.&lt;init&gt;(NetConnection.java:220) at org.apache.derby.client.net.NetConnection40.&lt;init&gt;(NetConnection40.java:74) at org.apache.derby.client.net.ClientJDBCObjectFactoryImpl40.newNetConnection(ClientJDBCObjectFactoryImpl40.java:269) at org.apache.derby.jdbc.ClientDriver.connect(ClientDriver.java:157)The server side log was not preserved because the failure happened inside a decorator.,1,0
Subquery is only allowed to return a single column - When using derby with hibernate (or JPA) queries are created per JPA spec. For tables with multi-column PK  subqueries are created with two columns in select clause.,ERROR: Subquery is only allowed to return a single column.PROBLEM: When using derby with hibernate (or JPA) queries are created by the JPA engine per JPA spec. For tables with multi-column PK  subqueries are created with two columns in select clause (see select colofassig6_.activityID  colofassig6_.assigneeID from Assignment in the query below).Without this support  I can not use Derby with JPA.Hibernate: select distinct activitybe0_.activityID as activityID69_  activitybe0_.createdBy as createdBy69_  activitybe0_.createdOn as createdOn69_  activitybe0_.lastModifiedBy as lastModi4_69_  activitybe0_.lastModifiedOn as lastModi5_69_  activitybe0_.activityDate as activity6_69_  activitybe0_.activityTypeHierarchyID as activity7_69_  activitybe0_.activityTypeID as activity8_69_  activitybe0_.campaignID as campaignID69_  activitybe0_.comments as comments69_  activitybe0_.description as descrip11_69_  activitybe0_.inputID as inputID69_  activitybe0_.inputTypeID as inputTy13_69_  activitybe0_.name as name69_  activitybe0_.notes as notes69_  activitybe0_.organizationID as organiz16_69_  activitybe0_.parentActivityTypeID as parentA17_69_ from Activity activitybe0_  Activity activitybe1_ inner join ActivitySchedule colofactiv2_ on activitybe1_.activityID=colofactiv2_.activityID inner join ActivityScheduleStatus colofactiv3_ on colofactiv2_.activityScheduleID=colofactiv3_.activityScheduleID inner join ActivityScheduleStatusType activitysc4_ on colofactiv3_.activityScheduleStatusTypeID=activitysc4_.activityScheduleStatusTypeID  ActivityTypeHierarchy activityty5_ where activitybe0_.activityTypeHierarchyID=activityty5_.activityTypeHierarchyID and activityty5_.activityTypeHierarchyID=? and not (exists (select colofassig6_.activityID  colofassig6_.assigneeID from Assignment colofassig6_ where activitybe0_.activityID=colofassig6_.activityID)) and (activitybe0_.activityID&lt;&gt;activitybe1_.activityID or activitysc4_.name&lt;&gt;'Route')2011-11-14 11:41:13 413 ERROR &#91;org.hibernate.util.JDBCExceptionReporter&#93; (EJB-Timer-1321288405420&#91;target=jboss.j2ee:ear=oecrm1.6.3RC1-derby-jboss.ear jar=builder-ejb.jar name=WorkflowActivatorBean service=EJB3&#93;) Subquery is only allowed to return a single column.,0,0
SecureServerTest  Driver40UnbootedTest and replication tests not prepared for space in java.home,SecureServerTest  Driver40UnbootedTest and the replication tests fork JVMs by calling Runtime.exec() methods that take the command as a String parameter  not a String[]. This causes problems like the ones seen in DERBY-5490 when there's a space in ${java.home}.The tests should be rewritten to use the helper method BaseTestCase.execJavaCmd()  which handles this case correctly.,0,0
XATransactionTest: Table/View 'DERBY1016' already exists,Cf the test report on trunk.http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/Limited/testSummary-1211980.htmlIt looks like the ordering between testForgetExceptionDerby1016PROTO and testForgetExceptionDerby1016NOTA is inversed in this run on Windows  and the test currently requires testForgetExceptionDerby1016PROTO to be run ahead of testForgetExceptionDerby1016NOTA. JDK 7 can/will reorder the fixtures.,0,0
SQLChar.getCollationKey NPE in index-stat-thread,With this JDBC connection url is : jdbc:derby:directory:db_name;territory=fr_FR;collation=TERRITORY_BASED:PRIMARY;create=trueI get a NullPointerException in index-stat-threadSun Dec 11 19:33:11 CET 2011 Thread&#91;pool-3-thread-1 5 main&#93; {istat} 'PROXIFLEX'.'IDAXX_RES': update scheduled  reason=&#91;no stats  row-estimate=375&#93; (queueSize=1)Sun Dec 11 19:33:11 CET 2011 Thread&#91;index-stat-thread 5 main&#93; {istat trace@26130360} worker thread started (xid=12049) &#91;q/p/s=1/0/1 err:k/u/c=0/0/0 rej:f/d/o=0/0/0&#93;Sun Dec 11 19:33:11 CET 2011 Thread&#91;index-stat-thread 5 main&#93; {istat trace@26130360} processing 'PROXIFLEX'.'IDAXX_RES' Sun Dec 11 19:33:11 CET 2011 Thread&#91;index-stat-thread 5 main&#93; {istat} runtime exception during normal operationjava.lang.NullPointerException at org.apache.derby.iapi.types.SQLChar.getCollationKey(Unknown Source) at org.apache.derby.iapi.types.WorkHorseForCollatorDatatypes.stringCompare(Unknown Source) at org.apache.derby.iapi.types.CollatorSQLVarchar.stringCompare(Unknown Source) at org.apache.derby.iapi.types.SQLChar.compare(Unknown Source) at org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl$KeyComparator.compareWithPrevKey(Unknown Source) at org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.updateIndexStatsMinion(Unknown Source) at org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.generateStatistics(Unknown Source) at org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.processingLoop(Unknown Source) at org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.run(Unknown Source) at java.lang.Thread.run(Thread.java:662)Sun Dec 11 19:33:11 CET 2011 Thread&#91;index-stat-thread 5 main&#93; {istat trace@26130360} worker thread exit &#91;q/p/s=0/0/1 err:k/u/c=0/0/0 rej:f/d/o=0/0/0&#93;If I remove territory and collation parameters I don't have the exception.In case you want to disable automatic statistics  set derby property : derby.storage.indexStats.auto to false.,0,0
Harden password hashing in the builtin authentication service,The Open Web Application Security Project has some suggestions on how to make it harder for an attacker to crack hashed passwords: https://www.owasp.org/index.php/Hashing_JavaThe builtin authentication service doesn't follow all the suggestions. In particular  it doesn't add a random salt  and it only performs the hash operation once.I propose that we add two new properties that makes it possible to configure builtin to use a random salt and run multiple iterations of the hash operation: derby.authentication.builtin.saltLength - the length of the random salt to add (in bytes) derby.authentication.builtin.iterations - the number of times to perform the hash operationI'd also suggest that we set the defaults so that random salt and multiple iterations are used by default. The OWASP page mentions 64 bits of salt (8 bytes) and a minimum of 1000 iterations. I consulted a security expert who thought that these recommendations sounded OK  but he believed the recommended salt length was likely to be revised and suggested 16 bytes instead. The only price we pay by going from 8 to 16 bytes  is that we'll need to store 8 bytes extra per user in the database  so I don't see any reason not to set the default for derby.authentication.builtin.saltLength as high as 16. Setting the default for derby.authentication.builtin.iterations to 1000 will make authentication of a user somewhat slower (which is the point  really)  but experiments on my machine suggest that running our default hash function (SHA-256) 1000 times takes around 1 ms. Since authentication only happens when establishing a new connection to the database  that would be a negligible cost  I think.If saltLength is set to 0 and iterations is set to 1  the hashing will be done in the exact same way as in previous versions.Both of the properties should only be respected when the data dictionary version is 10.9 or higher  so that users in soft-upgraded databases can still log in after a downgrade.,1,0
Call initCause() and getCause() without reflection in BaseJDBCTestCase,BaseJDBCTestCase uses reflection to call Throwable.initCause() and Throwable.getCause(). This was needed when running the tests on Java 1.3 and on Foundation Profile 1.0  but those platforms aren't supported any more. Now we should call the methods directly.,0,0
Remove unnecessary field rwsOK in DirStorageFactory4,DirStorageFactory4 has a field called rwsOK defined like this: private static final boolean rwsOK = JVMInfo.JDK_ID &gt;= JVMInfo.J2SE_142;The only supported platform whose JVMInfo.JDK_ID is less than JVMInfo.J2SE_142  is FP/CDC. But DirStorageFactory4 is not used on FP/CDC because it depends on NIO. This means that the field will always have the value true  and it can be eliminated.,0,0
NSSecurityMechanismTest fixture testNetworkServerSecurityMechanism fails intermittentlyt,There's an intermittent failure in NSSecurityMechanismTest fixture testNetworkServerSecurityMechanism  which I couldn't find was logged separately.This is the stack trace:1) testNetworkServerSecurityMechanism(org.apache.derbyTesting.functionTests.tests.derbynet.NSSecurityMechanismTest)junit.framework.AssertionFailedError: Timed out waiting for network server to start at org.apache.derbyTesting.junit.NetworkServerTestSetup.waitForServerStart(NetworkServerTestSetup.java:577) at org.apache.derbyTesting.functionTests.tests.derbynet.NSSecurityMechanismTest.setSecurityMechanism(NSSecurityMechanismTest.java:430) at org.apache.derbyTesting.functionTests.tests.derbynet.NSSecurityMechanismTest.testNetworkServerSecurityMechanism(NSSecurityMechanismTest.java:327) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:79) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:116) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)The test output printed out this in the console:(net)derbynet.NSSecurityMechanismTest.testNetworkServerSecurityMechanism java.net.SocketException: Connection reset at java.net.SocketInputStream.read(SocketInputStream.java:197) at java.net.SocketInputStream.read(SocketInputStream.java:116) at org.apache.derby.impl.drda.NetworkServerControlImpl.fillReplyBuffer(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.readResult(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.pingWithNoOpen(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.ping(Unknown Source) at org.apache.derby.drda.NetworkServerControl.ping(Unknown Source) at org.apache.derbyTesting.junit.NetworkServerTestSetup.pingForServerUp(NetworkServerTestSetup.java:625) at org.apache.derbyTesting.junit.NetworkServerTestSetup.pingForServerStart(NetworkServerTestSetup.java:694) at org.apache.derbyTesting.junit.NetworkServerTestSetup.waitForServerStart(NetworkServerTestSetup.java:576) at org.apache.derbyTesting.functionTests.tests.derbynet.NSSecurityMechanismTest.setSecurityMechanism(NSSecurityMechanismTest.java:430) at org.apache.derbyTesting.functionTests.tests.derbynet.NSSecurityMechanismTest.testNetworkServerSecurityMechanism(NSSecurityMechanismTest.java:327) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:79) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:618) at junit.framework.TestCase.runTest(TestCase.java:164) at junit.framework.TestCase.runBare(TestCase.java:130) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:116) at junit.framework.TestResult$1.protect(TestResult.java:106) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.framework.TestResult.run(TestResult.java:109) at junit.framework.TestCase.run(TestCase.java:120) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.textui.TestRunner.doRun(TestRunner.java:121) at junit.textui.TestRunner.start(TestRunner.java:185) at junit.textui.TestRunner.main(TestRunner.java:143)java.net.SocketException: Connection reset at java.net.SocketInputStream.read(SocketInputStream.java:197) at java.net.SocketInputStream.read(SocketInputStream.java:116) at org.apache.derby.impl.drda.NetworkServerControlImpl.fillReplyBuffer(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.readResult(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.pingWithNoOpen(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.ping(Unknown Source) at org.apache.derby.drda.NetworkServerControl.ping(Unknown Source) at org.apache.derbyTesting.junit.NetworkServerTestSetup.pingForServerUp(NetworkServerTestSetup.java:625) at org.apache.derbyTesting.junit.NetworkServerTestSetup.pingForServerStart(NetworkServerTestSetup.java:694) at org.apache.derbyTesting.junit.NetworkServerTestSetup.waitForServerStart(NetworkServerTestSetup.java:576) at org.apache.derbyTesting.functionTests.tests.derbynet.NSSecurityMechanismTest.setSecurityMechanism(NSSecurityMechanismTest.java:430) at org.apache.derbyTesting.functionTests.tests.derbynet.NSSecurityMechanismTest.testNetworkServerSecurityMechanism(NSSecurityMechanismTest.java:327) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:79) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:618) at junit.framework.TestCase.runTest(TestCase.java:164) at junit.framework.TestCase.runBare(TestCase.java:130) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:116) at junit.framework.TestResult$1.protect(TestResult.java:106) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.framework.TestResult.run(TestResult.java:109) at junit.framework.TestCase.run(TestCase.java:120) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.textui.TestRunner.doRun(TestRunner.java:121) at junit.textui.TestRunner.start(TestRunner.java:185) at junit.textui.TestRunner.main(TestRunner.java:143)I've looked through my nightly test records for earlier occurrences on trunk/linux (this apparently has not happened on windows)   and found the following occurrences:2011-12-02 (ibm15)Slightly different stack traces were seen in other runs:2011-09-22 (ibm15)2011-10-09 (ibm15)2011-10-21 (ibm15)2011-10-31 (ibm16)2011-11-10 (ibm15)2011-12-12 (ibm16)2011-12-14 (ibm15),1,0
Derby threads hanging when using ClientXADataSource and a deadlock or lock timeout occurs,The issue arrives when multiple XA transactions are done in parallel and there is either a lock timeout or a lock deadlock detected. When this happens the connection is leaked in the Glassfish connection pool and the client thread hangs in 'org.apache.derby.client.netReply.fill(Reply.java:172)'. Shutting down the app server fails because the thread has a lock in 'org.apache.derby.client.net.NetConnection40' and another task is calling 'org.apache.derby.client.ClientPooledConnection.close(ClientPooledConnection.java:214)' which is waiting for the lock.Killing the appsever using 'kill' and then attempting to shutdown Derby network server causes the Network Server to hang. One of the threads hangs waiting for a lock at 'org.apache.derby.impl.drda.NeworkServerControlImpl.removeFromSessionTable(NetworkServerControlImpl.java:1525)' and the 'main' thread has this locked at 'org.apache.derby.impl.drda.NetworkServerControlImpl.executeWork(NetworkServerControlImpl.java:2242)' and it itself is waiting for a lock which belongs to a thread that is stuck at 'org.apache.derby.impl.services.locks.ActiveLock.waitForGrant(ActiveLock.java:118) which is in the TIMED_WAITING state.Only by killing the Network Server using 'kill' is possible at this point.There are transactions left even though all clients have been removed.,0,1
NullPointerException in generated VTI code,With the latest 10.8.2.2 binary distribution  the following short script produces a NullPointerException:java -Dij.exceptionTrace=true org.apache.derby.tools.ijij&gt; connect 'jdbc:derby:brydb;create=true';ij&gt; create table t1 (a int);ij&gt; SELECT T2.  systabs.  syscgs.conglomeratenumber FROM  SYS.SYSTABLES systabs  sys.sysconglomerates syscgs  TABLE (SYSCS_DIAG.SPACE_TABLE(systabs.tablename)) AS T2 WHERE systabs.tabletype = 'T' and systabs.tableid = syscgs.tableid;The exception trace is pasted below:ERROR 38000: The exception 'java.lang.NullPointerException' was thrown while evaluating an expression.java.sql.SQLException: The exception 'java.lang.NullPointerException' was thrown while evaluating an expression. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.seeNextException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source) at org.apache.derby.impl.tools.ij.Main.main(Unknown Source) at org.apache.derby.tools.ij.main(Unknown Source)Caused by: java.sql.SQLException: The exception 'java.lang.NullPointerException' was thrown while evaluating an expression. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source) ... 18 moreCaused by: java.sql.SQLException: Java exception: ': java.lang.NullPointerException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) ... 15 moreCaused by: java.lang.NullPointerException at org.apache.derby.exe.acf81e0010x0134x6972x0511x0000033820000.g0(Unknown Source) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:616) at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(Unknown Source) at org.apache.derby.impl.sql.execute.VTIResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.JoinResultSet.openRight(Unknown Source) at org.apache.derby.impl.sql.execute.JoinResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.JoinResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) ... 11 moreERROR XJ001: Java exception: ': java.lang.NullPointerException'.java.sql.SQLException: Java exception: ': java.lang.NullPointerException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source) at org.apache.derby.impl.tools.ij.Main.main(Unknown Source) at org.apache.derby.tools.ij.main(Unknown Source)Caused by: java.sql.SQLException: Java exception: ': java.lang.NullPointerException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source) ... 19 moreCaused by: java.lang.NullPointerException at org.apache.derby.exe.acf81e0010x0134x6972x0511x0000033820000.g0(Unknown Source) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:616) at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(Unknown Source) at org.apache.derby.impl.sql.execute.VTIResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.JoinResultSet.openRight(Unknown Source) at org.apache.derby.impl.sql.execute.JoinResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.JoinResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(Unknown Source) at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) ... 11 more,0,0
AssertFailures (7  or 8) with ibm 1.6 and 1.5 on Windows XP in lang.NativeAuthProcs fixture testAll,Since revision 1221569  on windows XP I see some failures in the nightly test like this:1) testAll(org.apache.derbyTesting.functionTests.tests.lang.NativeAuthProcs)junit.framework.AssertionFailedError at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthProcs.vetResetPassword(NativeAuthProcs.java:364) at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthProcs.resetPasswordTests(NativeAuthProcs.java:332) at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthProcs.testAll(NativeAuthProcs.java:189) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:116) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)See for instance: http://people.apache.org/~myrnavl/derby_test_results/main/windows/testlog/ibm15/1222901-suites.All_diff.txtThere might be an intermittent issue here  one of the runs lists only 7 failures. But mostly there's 8.This does not occur on Linux with the same jvm versions.The changes between this run and the previous one when these failures did not occur: ================SUBVERSION LOG FROM 1221076 TO 1221569:------------------------------------------------------------------------r1221456 | rhillegas | 2011-12-20 11:35:44 -0800 (Tue  20 Dec 2011) | 1 lineDERBY-866: Add regression tests for GRANT/REVOKE on new procedures supporting NATIVE authentication.------------------------------------------------------------------------r1221434 | rhillegas | 2011-12-20 10:59:09 -0800 (Tue  20 Dec 2011) | 1 lineDERBY-866: Adjust RolesTest to account for new tuple in SYSROUTINEPERMS.------------------------------------------------------------------------r1221423 | rhillegas | 2011-12-20 10:44:33 -0800 (Tue  20 Dec 2011) | 1 lineDERBY-866: Add syscs_reset_password() and syscs_modify_password() system procedures.================derby.log in the failed directory only shows a start and shutdown.,0,0
Java deadlock between LogicalConnection40 and ClientXAConnection40 (patch attached),There is a Java deadlock between LogicalConnection40 and ClientXAConnection40. The order of calls that cause the deadlock are:Thread 1LogicalConnection.closeClientPooledConnection.recycleConnectionThread 2ClientPooledConnection.closeLogicalConnection.nullPhysicalConnectionThread 1 acquires a lock on the LogicalConnection and attempts to acquire a lock on the ClientPooledConnectionThread 2 acquires a lock on the ClientPooledConnection and attempts to acquire a lock on the LogicalConnectionIn production this occurs when one thread is committing a transaction and another thread is trying to close the connection. This occurred because the Glassfish connection pool is setup to close all connections on any error on any connection and an error has been detected on another connection in the pool.,0,1
Race conditions in LogicalConnection checking for a null physical connection,There are race conditions with checkForNullPhysicalConnection calls in LogicalConnection. checkForNullPhysicalConnection is not synchronized and it checks for the member 'phsyicalConnection' which can be cleared by 'nullPhsyicalConnection' (which is synchronized) and 'close' (which is synchronized) and 'closeWithoutRecyclingToPool' (which is synchronized).This affects 'nativeSQL'  'getAutoCommit'  'getTransactionIsolation'  'getWarnings'  'isReadOnly'  'getCatalog'  'getTypeMap'  'createStatement'  'prepareCall'  'prepareStatement'  'setHoldability'  'getHoldability'  'setSavePoint'  'rollBack'  'releaseSavePoint'  'getSchema'  'setSchema'.All of these call 'checkForNullPhysicalConnection' and then use the member 'physicalConnection' after that call returns. Because these methods are not synchronized  between the time 'checkForNullPhysicalConnectoin' returns and 'physicalConnection' is used  the 'physicalConnection' member could be set to null and then a NPE occurs.Probably all of these methods should be changed to synchronized.,0,0
Network Server should reject client connections that are not Derby Network Client,Since there have been no other network clients besides Derby Network Client tested or supported with Derby since 10.1 and since any protocol based client needs to understand Derby's DRDA extensions  deviations  and stored procedure usage. I think it would be a good idea in 10.9 for Network Server to outright reject any network clients that are not Derby Network Client.This would eliminate confusion up front for those that might not be aware that the DB2 Universal JDBC Driver and DB2 Runtime Client are not supported. They would get a clean reasonable error instead of hitting various protocol errors.Also it would mean if someone does want to add support for some network client in the future they would at least need to add the one or two lines of code in AppRequester to identify it  which I think would be a good thing.I think the code change would not be hard but the biggest impact might be anyone who still runs tests with JCC on trunk would need to disable those tests. There is a separate issue DERBY-4785 that Jayaram is working on to complete remove the JCC related code from the tests and test infrastructure.,1,0
AlterTableTest#testDropColumn fails: drop view cannot be performed due to dependency,Saw this when running suitesAll on 10.8.2.2:1) testDropColumn(org.apache.derbyTesting.functionTests.tests.lang.AlterTableTest)java.sql.SQLException: Operation 'DROP VIEW' cannot be performed on object 'ATDC_VW_5A_1' because VIEW 'ATDC_VW_5A_2' is dependent on that object. at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(Unknown Source) at org.apache.derby.client.am.SqlException.getSQLException(Unknown Source) at org.apache.derby.client.am.Statement.executeUpdate(Unknown Source) at org.apache.derbyTesting.functionTests.tests.lang.AlterTableTest.testDropColumn(AlterTableTest.java:2465) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)Caused by: org.apache.derby.client.am.SqlException: Operation 'DROP VIEW' cannot be performed on object 'ATDC_VW_5A_1' because VIEW 'ATDC_VW_5A_2' is dependent on that object. at org.apache.derby.client.am.Statement.completeSqlca(Unknown Source) at org.apache.derby.client.am.Statement.completeExecuteImmediate(Unknown Source) at org.apache.derby.client.net.NetStatementReply.parseEXCSQLIMMreply(Unknown Source) at org.apache.derby.client.net.NetStatementReply.readExecuteImmediate(Unknown Source) at org.apache.derby.client.net.StatementReply.readExecuteImmediate(Unknown Source) at org.apache.derby.client.net.NetStatement.readExecuteImmediate_(Unknown Source) at org.apache.derby.client.am.Statement.readExecuteImmediate(Unknown Source) at org.apache.derby.client.am.Statement.flowExecute(Unknown Source) at org.apache.derby.client.am.Statement.executeUpdateX(Unknown Source) ... 55 morePrior to this  though  I saw this on the console  but no error/failure. Probably not related  I believe we have seen this before:java.lang.Exception: DRDA_InvalidReplyTooShort.S:Invalid reply from network server: Insufficient data. at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessageWork(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessage(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.fillReplyBuffer(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.readResult(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.pingWithNoOpen(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.ping(Unknown Source) at org.apache.derby.drda.NetworkServerControl.ping(Unknown Source) at org.apache.derbyTesting.junit.NetworkServerTestSetup.pingForServerUp(NetworkServerTestSetup.java:567) at org.apache.derbyTesting.functionTests.tests.derbynet.ServerPropertiesTest.canPingServer(ServerPropertiesTest.java:280) at org.apache.derbyTesting.functionTests.tests.derbynet.ServerPropertiesTest.ttestSetPortPriority(ServerPropertiesTest.java:472) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at junit.framework.TestCase.runTest(TestCase.java:164) at junit.framework.TestCase.runBare(TestCase.java:130) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at junit.framework.TestResult$1.protect(TestResult.java:106) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.framework.TestResult.run(TestResult.java:109) at junit.framework.TestCase.run(TestCase.java:120) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.textui.TestRunner.doRun(TestRunner.java:121) at junit.textui.TestRunner.start(TestRunner.java:185) at junit.textui.TestRunner.main(TestRunner.java:143),0,0
AssertionFailedError: Should not hold locks after commit in ResultSetMiscTest,Saw this failure when running the 10.8.2.2 regression tests on Java 7u4-b06:1) testBug4810(org.apache.derbyTesting.functionTests.tests.jdbcapi.ResultSetMiscTest)junit.framework.AssertionFailedError: Should not hold locks after commit at org.apache.derbyTesting.functionTests.tests.jdbcapi.ResultSetMiscTest.checkLocksForAutoCommitSelect(ResultSetMiscTest.java:695) at org.apache.derbyTesting.functionTests.tests.jdbcapi.ResultSetMiscTest.testBug4810(ResultSetMiscTest.java:478) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57),0,0
NativeAuthenticationServiceTest getting multiple errors trying to delete files/directories during teardown,Multiple errors during teardown while trying to delete files/directories of the test databases on vista against sun jdk16 on vista  but passed against same jvm on sun nightly runs againstlinux and solaris.As of time of this report the tests against other sun jvms had not finished. Errors were also seen in ibm nightly runs  I'll rerport those in following comments.The following checkin that was included in the reported test failures changed the Native authentication tests  so seems likely to have caused the issues:r1233377 | rhillegas | 2012-01-19 14:51:13 +0100 (Thu  19 Jan 2012) | 1 lineFirst version of NATIVE authentication service  including first tranche of tests for it.vista run had 6 errors:http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.6/testing/testlog/vista/1233467-suitesAll_diff.txt1) testAll(org.apache.derbyTesting.functionTests.tests.lang.NativeAuthenticationServiceTest)junit.framework.AssertionFailedError: Failed to delete 77 files (root=C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d): C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/db.lck (isDir=false  canRead=true  canWrite=true  size=38)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/log/log1.dat (isDir=false  canRead=true  canWrite=true  size=1048576)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/log (isDir=true  canRead=true  canWrite=true  size=0)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c10.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c101.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c111.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c121.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c130.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c141.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c150.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c161.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c171.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c180.dat (isDir=false  canRead=true  canWrite=true  size=36864)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c191.dat (isDir=false  canRead=true  canWrite=true  size=16384)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c1a1.dat (isDir=false  canRead=true  canWrite=true  size=16384)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c1b1.dat (isDir=false  canRead=true  canWrite=true  size=16384)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c1c0.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c1d1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c1e0.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c1f1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c20.dat (isDir=false  canRead=true  canWrite=true  size=28672)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c200.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c211.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c221.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c230.dat (isDir=false  canRead=true  canWrite=true  size=114688)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c241.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c251.dat (isDir=false  canRead=true  canWrite=true  size=20480)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c260.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c271.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c281.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c290.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c2a1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c2b1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c2c1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c2d0.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c2e1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c2f0.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c300.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c31.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c311.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c321.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c331.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c340.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c351.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c361.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c371.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c380.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c391.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c3a1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c3b1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c3c0.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c3d1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c3e1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c3f1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c400.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c41.dat (isDir=false  canRead=true  canWrite=true  size=16384)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c411.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c421.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c430.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c441.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c451.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c461.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c470.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c481.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c51.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c60.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c71.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c81.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/c90.dat (isDir=false  canRead=true  canWrite=true  size=20480)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/ca1.dat (isDir=false  canRead=true  canWrite=true  size=24576)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/cb1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/cc0.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/cd1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/ce1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0/cf0.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d/seg0 (isDir=true  canRead=true  canWrite=true  size=12288)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1d (isDir=true  canRead=true  canWrite=true  size=0) at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertDirectoryDeleted(BaseJDBCTestCase.java:1491) at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDir(DropDatabaseSetup.java:120) at org.apache.derbyTesting.junit.DropDatabaseSetup.access$000(DropDatabaseSetup.java:35) at org.apache.derbyTesting.junit.DropDatabaseSetup$1.run(DropDatabaseSetup.java:106) at java.security.AccessController.doPrivileged(Native Method) at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDirectory(DropDatabaseSetup.java:103) at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDirectory(DropDatabaseSetup.java:99) at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDatabase(DropDatabaseSetup.java:92) at org.apache.derbyTesting.junit.TestConfiguration$6.tearDown(TestConfiguration.java:828) at junit.extensions.TestSetup$1.protect(TestSetup.java:22) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)2) testAll(org.apache.derbyTesting.functionTests.tests.lang.NativeAuthenticationServiceTest)junit.framework.AssertionFailedError: Failed to delete 77 files (root=C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e): C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/db.lck (isDir=false  canRead=true  canWrite=true  size=38)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/log/log1.dat (isDir=false  canRead=true  canWrite=true  size=1048576)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/log (isDir=true  canRead=true  canWrite=true  size=0)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c10.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c101.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c111.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c121.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c130.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c141.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c150.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c161.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c171.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c180.dat (isDir=false  canRead=true  canWrite=true  size=36864)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c191.dat (isDir=false  canRead=true  canWrite=true  size=16384)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c1a1.dat (isDir=false  canRead=true  canWrite=true  size=16384)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c1b1.dat (isDir=false  canRead=true  canWrite=true  size=16384)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c1c0.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c1d1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c1e0.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c1f1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c20.dat (isDir=false  canRead=true  canWrite=true  size=28672)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c200.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c211.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c221.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c230.dat (isDir=false  canRead=true  canWrite=true  size=114688)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c241.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c251.dat (isDir=false  canRead=true  canWrite=true  size=20480)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c260.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c271.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c281.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c290.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c2a1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c2b1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c2c1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c2d0.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c2e1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c2f0.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c300.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c31.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c311.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c321.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c331.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c340.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c351.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c361.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c371.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c380.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c391.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c3a1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c3b1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c3c0.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c3d1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c3e1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c3f1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c400.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c41.dat (isDir=false  canRead=true  canWrite=true  size=16384)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c411.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c421.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c430.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c441.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c451.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c461.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c470.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c481.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c51.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c60.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c71.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c81.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/c90.dat (isDir=false  canRead=true  canWrite=true  size=20480)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/ca1.dat (isDir=false  canRead=true  canWrite=true  size=24576)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/cb1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/cc0.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/cd1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/ce1.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0/cf0.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e/seg0 (isDir=true  canRead=true  canWrite=true  size=12288)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1e (isDir=true  canRead=true  canWrite=true  size=0) at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertDirectoryDeleted(BaseJDBCTestCase.java:1491) at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDir(DropDatabaseSetup.java:120) at org.apache.derbyTesting.junit.DropDatabaseSetup.access$000(DropDatabaseSetup.java:35) at org.apache.derbyTesting.junit.DropDatabaseSetup$1.run(DropDatabaseSetup.java:106) at java.security.AccessController.doPrivileged(Native Method) at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDirectory(DropDatabaseSetup.java:103) at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDirectory(DropDatabaseSetup.java:99) at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDatabase(DropDatabaseSetup.java:92) at org.apache.derbyTesting.junit.TestConfiguration$5.tearDown(TestConfiguration.java:798) at junit.extensions.TestSetup$1.protect(TestSetup.java:22) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)3) testAll(org.apache.derbyTesting.functionTests.tests.lang.NativeAuthenticationServiceTest)junit.framework.AssertionFailedError: Failed to delete 77 files (root=C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1f): C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1f/db.lck (isDir=false  canRead=true  canWrite=true  size=38)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1f/log/log1.dat (isDir=false  canRead=true  canWrite=true  size=1048576)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1f/log (isDir=true  canRead=true  canWrite=true  size=0)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1f/seg0/c10.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1f/seg0/c101.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1f/seg0/c111.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1f/seg0/c121.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1f/seg0/c130.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1f/seg0/c141.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1f/seg0/c150.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1f/seg0/c161.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1f/seg0/c171.dat (isDir=false  canRead=true  canWrite=true  size=8192)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1f/seg0/c180.dat (isDir=false  canRead=true  canWrite=true  size=36864)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1f/seg0/c191.dat (isDir=false  canRead=true  canWrite=true  size=16384)  C:/cludev/jagtmp/autoderbyN_regression/suitesAll_7/log/system/singleUse/oneuse1f/seg0/c1a1.dat (isDir=false  canRead=true  canWrite=true  size=16384),0,0
Access denied (java.lang.RuntimePermission modifyThreadGroup) in IndexStatisticsDaemonImpl.schedule(),I user reported this exception with 10.8.2.3 - (1212722) when running regression tests against 10.8.As soon as the Index Statistics Thread was initialized they got the stack trace below.There was some discussion of this issue on the dev list:http://old.nabble.com/Report-of-security-manager-issue-with-10.8-and-ndexStatisticsDaemonImpl.schedule-to33137398.htmlI assume the failure is in  runningThread = new Thread(this  'index-stat-thread');Stack Trace:java.security.AccessControlException: Access denied(java.lang.RuntimePermission modifyThreadGroup) atjava.security.AccessController.checkPermission(AccessController.java:108) atjava.lang.SecurityManager.checkPermission(SecurityManager.java:544) atcom.ibm.ws.security.core.SecurityManager.checkPermission(SecurityManager.java:208) atcom.ibm.ws.security.core.SecurityManager.checkAccess(SecurityManager.java:407) at java.lang.ThreadGroup.checkAccess(ThreadGroup.java:226) at java.lang.Thread.initialize(Thread.java:345) at java.lang.Thread.&lt;init&gt;(Thread.java:281) at java.lang.Thread.&lt;init&gt;(Thread.java:179) atorg.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.schedule(UnknownSource) atorg.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepare(UnknownSource) atorg.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(UnknownSource) atorg.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(Unknown Source) atorg.apache.derby.impl.jdbc.EmbedPreparedStatement20.&lt;init&gt;(Unknown Source) atorg.apache.derby.impl.jdbc.EmbedPreparedStatement30.&lt;init&gt;(Unknown Source) atorg.apache.derby.impl.jdbc.EmbedPreparedStatement40.&lt;init&gt;(Unknown Source) atorg.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Unknown Source) atorg.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source) atorg.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source) at,1,0
Select statement with subqueries with group by and count distinct statements returns wrong number of results,Steps to reproduce:1. Create database  connect to database with any JDBC client2. create two tables:CREATE TABLE TEST_5 ( profile_id INTEGER NOT NULL  group_ref INTEGER NOT NULL  matched_count INTEGER NOT NULL ); CREATE TABLE TEST_6 ( profile_id INTEGER NOT NULL  group_ref INTEGER NOT NULL  matched_count INTEGER NOT NULL );3. Insert two records for each table:insert into test_5 values (1  10000 1);insert into test_5 values (2  10000  2);insert into test_6 values (1  10000 1);insert into test_6 values (2  10000  2);4. Run following statementSELECT *FROM (SELECT ps1.group_ref  COUNT(DISTINCT ps1.matched_count) AS matched_count FROM test_5 ps1 GROUP BY ps1.group_ref  ps1.profile_id ) a  (SELECT ps2.group_ref  COUNT( DISTINCT ps2.matched_count) AS matched_count FROM test_6 ps2 GROUP BY ps2.group_ref  ps2.profile_id ) bAs a result I've got 3 records instead of 4 - at least Oracle 10greturns 4 records for this statement. Maybe i'm doing something wrong.Do you have any suggestions / possible workarounds for this problem,0,0
[patch] access static constants with static references,code access static fields by fetching instances and getting the static variable from the object. Just use the class reference.,0,0
Prepare old test harness for running tests on Java 8,When running an old harness test with a Java 8 preview (available from http://jdk8.java.net/download.html)  it'll fail like this:$ java org.apache.derbyTesting.functionTests.harness.RunTest lang/supersimple.sql&#8211; listing properties &#8211;derby.locks.deadlockTimeout=3 derby.locks.waitTimeout=3WHOA  javavm is NULLProcess exception: java.lang.ClassNotFoundException: org.apache.derbyTesting.functionTests.harness.jdk18     Start: supersimple jdk1.8.0-ea 2012-02-08 20:29:59 ***Exception in thread 'main' java.lang.ClassNotFoundException: org.apache.derbyTesting.functionTests.harness.jdk18 at java.net.URLClassLoader$1.run(URLClassLoader.java:359) at java.net.URLClassLoader$1.run(URLClassLoader.java:348) at java.security.AccessController.doPrivileged(Native Method) at java.net.URLClassLoader.findClass(URLClassLoader.java:347) at java.lang.ClassLoader.loadClass(ClassLoader.java:423) at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308) at java.lang.ClassLoader.loadClass(ClassLoader.java:356) at java.lang.Class.forName0(Native Method) at java.lang.Class.forName(Class.java:181) at org.apache.derbyTesting.functionTests.harness.jvm.getJvm(jvm.java:217) at org.apache.derbyTesting.functionTests.harness.RunTest.buildTestCommand(RunTest.java:2267) at org.apache.derbyTesting.functionTests.harness.RunTest.testRun(RunTest.java:490) at org.apache.derbyTesting.functionTests.harness.RunTest.main(RunTest.java:360)    We need to add the org.apache.derbyTesting.functionTests.harness.jdk18 class to make the tests run on Java 8.,0,0
ServerPropertiesTest prints .java.net.SocketException: Connection reset to console but test passes,ServerPropertiesTest showed the below output when running. The ping retries and the test passes. I am not sure if in fact a Connection reset is a valid response if the server is not fully up and the test is just being too verbose or if it is real problem that we get this Error......................java.net.SocketException: Connection reset at java.net.SocketInputStream.read(SocketInputStream.java:168) at java.net.SocketInputStream.read(SocketInputStream.java:90) at org.apache.derby.impl.drda.NetworkServerControlImpl.fillReplyBuffer(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.readResult(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.pingWithNoOpen(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.ping(Unknown Source) at org.apache.derby.drda.NetworkServerControl.ping(Unknown Source) at org.apache.derbyTesting.junit.NetworkServerTestSetup.pingForServerUp(NetworkServerTestSetup.java:567) at org.apache.derbyTesting.functionTests.tests.derbynet.ServerPropertiesTest.canPingServer(ServerPropertiesTest.java:280) at org.apache.derbyTesting.functionTests.tests.derbynet.ServerPropertiesTest.shutdownServer(ServerPropertiesTest.java:309) at org.apache.derbyTesting.functionTests.tests.derbynet.ServerPropertiesTest.ttestSetPortPriority(ServerPropertiesTest.java:484) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:48) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:600) at junit.framework.TestCase.runTest(TestCase.java:154) at junit.framework.TestCase.runBare(TestCase.java:127) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at junit.framework.TestResult$1.protect(TestResult.java:106) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.framework.TestResult.run(TestResult.java:109) at junit.framework.TestCase.run(TestCase.java:118) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.framework.TestSuite.runTest(TestSuite.java:208) at junit.framework.TestSuite.run(TestSuite.java:203) at junit.framework.TestSuite.runTest(TestSuite.java:208) at junit.framework.TestSuite.run(TestSuite.java:203) at junit.textui.TestRunner.doRun(TestRunner.java:116) at junit.textui.TestRunner.start(TestRunner.java:172) at junit.textui.TestRunner.main(TestRunner.java:138)java.net.SocketException: Connection reset at java.net.SocketInputStream.read(SocketInputStream.java:168) at java.net.SocketInputStream.read(SocketInputStream.java:90) at org.apache.derby.impl.drda.NetworkServerControlImpl.fillReplyBuffer(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.readResult(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.pingWithNoOpen(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.ping(Unknown Source) at org.apache.derby.drda.NetworkServerControl.ping(Unknown Source) at org.apache.derbyTesting.junit.NetworkServerTestSetup.pingForServerUp(NetworkServerTestSetup.java:567) at org.apache.derbyTesting.functionTests.tests.derbynet.ServerPropertiesTest.canPingServer(ServerPropertiesTest.java:280) at org.apache.derbyTesting.functionTests.tests.derbynet.ServerPropertiesTest.shutdownServer(ServerPropertiesTest.java:309) at org.apache.derbyTesting.functionTests.tests.derbynet.ServerPropertiesTest.ttestSetPortPriority(ServerPropertiesTest.java:484) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:48) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:600) at junit.framework.TestCase.runTest(TestCase.java:154) at junit.framework.TestCase.runBare(TestCase.java:127) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at junit.framework.TestResult$1.protect(TestResult.java:106) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.framework.TestResult.run(TestResult.java:109) at junit.framework.TestCase.run(TestCase.java:118) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:23) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) at junit.extensions.TestSetup$1.protect(TestSetup.java:19) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:23) at junit.framework.TestSuite.runTest(TestSuite.java:208) at junit.framework.TestSuite.run(TestSuite.java:203) at junit.framework.TestSuite.runTest(TestSuite.java:208) at junit.framework.TestSuite.run(TestSuite.java:203) at junit.textui.TestRunner.doRun(TestRunner.java:116) at junit.textui.TestRunner.start(TestRunner.java:172) at junit.textui.TestRunner.main(TestRunner.java:138)....................,0,0
NPE in Store  when running SELECT in a read-only database accessed via the classpath subprotocol when authentication  authorization  and Java security are turned on,I get an NPE trying to select from a table on which I don't have select privilege. The database is stored in a jar file accessed via the classpath protocol. BUILTIN authentication and sql authorization are turned on in the database. Running under a Java security manager. I will attach a repro. Here is the NPE:Failed Statement is: select * from KIWI.tjava.lang.NullPointerException at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:661) at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(BaseDataFileFactory.java:591) at org.apache.derby.impl.store.raw.xact.Xact.openContainer(Xact.java:1316) at org.apache.derby.impl.store.access.btree.OpenBTree.init(OpenBTree.java:380) at org.apache.derby.impl.store.access.btree.BTreeController.init(BTreeController.java:1250) at org.apache.derby.impl.store.access.btree.index.B2IController.init(B2IController.java:140) at org.apache.derby.impl.store.access.btree.index.B2I.open(B2I.java:821) at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(RAMTransaction.java:476) at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(RAMTransaction.java:1308) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.debugGenerateInfo(DataDictionaryImpl.java:9584) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndexMinion(DataDictionaryImpl.java:9492) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndex(DataDictionaryImpl.java:9303) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getColumnDescriptorsScan(DataDictionaryImpl.java:2887) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getColumnDescriptorsScan(DataDictionaryImpl.java:2851) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.finishTableDescriptor(DataDictionaryImpl.java:2408) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getTableDescriptorIndex1Scan(DataDictionaryImpl.java:2277) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getUncachedTableDescriptor(DataDictionaryImpl.java:2293) at org.apache.derby.impl.sql.catalog.NameTDCacheable.setIdentity(NameTDCacheable.java:110) at org.apache.derby.impl.services.cache.ConcurrentCache.find(ConcurrentCache.java:295) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getTableDescriptor(DataDictionaryImpl.java:2224) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.faultInTabInfo(DataDictionaryImpl.java:9905) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getNonCoreTI(DataDictionaryImpl.java:9702) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getUncachedPermissionsDescriptor(DataDictionaryImpl.java:13712) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getUncachedTablePermsDescriptor(DataDictionaryImpl.java:13660) at org.apache.derby.impl.sql.catalog.PermissionsCacheable.setIdentity(PermissionsCacheable.java:71) at org.apache.derby.impl.services.cache.ConcurrentCache.find(ConcurrentCache.java:295) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getPermissions(DataDictionaryImpl.java:13364) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getTablePermissions(DataDictionaryImpl.java:13350) at org.apache.derby.iapi.sql.dictionary.StatementTablePermission.oneAuthHasPermissionOnTable(StatementTablePermission.java:239) at org.apache.derby.iapi.sql.dictionary.StatementTablePermission.hasPermissionOnTable(StatementTablePermission.java:160) at org.apache.derby.iapi.sql.dictionary.StatementColumnPermission.check(StatementColumnPermission.java:99) at org.apache.derby.impl.sql.conn.GenericAuthorizer.authorize(GenericAuthorizer.java:183) at org.apache.derby.exe.ac40348015x0135x7cc7x4621x0000040700000.fillResultSet(Unknown Source) at org.apache.derby.exe.ac40348015x0135x7cc7x4621x0000040700000.execute(Unknown Source) at org.apache.derby.impl.sql.GenericActivationHolder.execute(GenericActivationHolder.java:353) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:441) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:324) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1242) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:630) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:559) at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:367) at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:527) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:372) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:245) at org.apache.derby.impl.tools.ij.Main.go(Main.java:229) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:184) at org.apache.derby.impl.tools.ij.Main.main(Main.java:75) at org.apache.derby.tools.ij.main(ij.java:59)Cleanup action completed,1,0
System can run out of stack space while processing DropOnCommit requests.,The system currently recursively calls xact.notifyObservers() from DropOnCommit.update(). It does this because in some casesnew observers can be added while processing the list of notifyObservers and those were being missed before the change  causingAssertions in the tests and possibly files not properly dropped on commit.Multiple users on the Derby user list have had failures running SYSCS_UTIL.SYSCS_COMPRESS_TABLE()  running out of stack trackwith a heavily recursive stack trace of the form (see more detail from these reports in subsequent comments):Caused by: java.lang.StackOverflowErrorat java.lang.ThreadLocal.get(ThreadLocal.java:125)at java.lang.StringCoding.deref(StringCoding.java:46)at java.lang.StringCoding.encode(StringCoding.java:258)at java.lang.String.getBytes(String.java:946)at java.io.UnixFileSystem.getBooleanAttributes0(Native Method)at java.io.UnixFileSystem.getBooleanAttributes(UnixFileSystem.java:228)at java.io.File.exists(File.java:733)at org.apache.derby.impl.store.raw.data.StreamFileContainer.run(Unknown Source)at java.security.AccessController.doPrivileged(Native Method)at org.apache.derby.impl.store.raw.data.StreamFileContainer.privExists(Unknown Source)at org.apache.derby.impl.store.raw.data.StreamFileContainer.open(Unknown Source)at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openStreamContainer(Unknown Source)at org.apache.derby.impl.store.raw.xact.Xact.openStreamContainer(Unknown Source)at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.dropStreamContainer(Unknown Source)at org.apache.derby.impl.store.raw.xact.Xact.dropStreamContainer(Unknown Source)at org.apache.derby.impl.store.raw.data.DropOnCommit.update(Unknown Source)at java.util.Observable.notifyObservers(Observable.java:142)at org.apache.derby.iapi.store.raw.xact.RawTransaction.notifyObservers(Unknown Source)at org.apache.derby.impl.store.raw.data.DropOnCommit.update(Unknown Source)at java.util.Observable.notifyObservers(Observable.java:142)at org.apache.derby.iapi.store.raw.xact.RawTransaction.notifyObservers(Unknown Source)at org.apache.derby.impl.store.raw.data.DropOnCommit.update(Unknown Source)at java.util.Observable.notifyObservers(Observable.java:142)at org.apache.derby.iapi.store.raw.xact.RawTransaction.notifyObservers(Unknown Source)at org.apache.derby.impl.store.raw.data.DropOnCommit.update(Unknown Source)at java.util.Observable.notifyObservers(Observable.java:142),0,1
OutOfMemoryError in OCRecoveryTest on phoneME,http://dbtg.foundry.sun.com/derby/test/Daily/javaME/testing/Limited/testSummary-1298470.htmlThere was 1 failure:1) testOCRecovery(org.apache.derbyTesting.functionTests.tests.store.OCRecoveryTest)junit.framework.AssertionFailedError: expectedExitValue:0 does not match exitValue:1expected output strings: &#91;0&#93;OK (1 test) actual output:&lt;STDOUT&gt;.ETime: 4.432There was 1 error:1) launchOCRecovery_1(org.apache.derbyTesting.functionTests.tests.store.OCRecoveryTest)&lt;END STDOUT&gt;&lt;STDERR&gt;java.lang.OutOfMemoryError: [C at java.io.BufferedReader.&lt;init&gt;(Unknown Source) at java.io.BufferedReader.&lt;init&gt;(Unknown Source) at junit.runner.BaseTestRunner.getFilteredTrace(Unknown Source) at junit.textui.ResultPrinter.printDefectTrace(Unknown Source) at junit.textui.ResultPrinter.printDefect(Unknown Source) at junit.textui.ResultPrinter.printDefects(Unknown Source) at junit.textui.ResultPrinter.printErrors(Unknown Source) at junit.textui.ResultPrinter.print(Unknown Source) at sun.misc.CVM.runMain(Unknown Source)&lt;END STDERR&gt; expected:&lt;0&gt; but was:&lt;1&gt; at org.apache.derbyTesting.junit.BaseTestCase.assertExecJavaCmdAsExpected(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.assertLaunchedJUnitTestMethod(Unknown Source) at org.apache.derbyTesting.functionTests.tests.store.OCRecoveryTest.testOCRecovery(Unknown Source) at org.apache.derbyTesting.junit.BaseTestCase.runBare(Unknown Source) at junit.extensions.TestDecorator.basicRun(Unknown Source) at junit.extensions.TestSetup$1.protect(Unknown Source) at junit.extensions.TestSetup.run(Unknown Source) at org.apache.derbyTesting.junit.BaseTestSetup.run(Unknown Source) at junit.extensions.TestDecorator.basicRun(Unknown Source) at junit.extensions.TestSetup$1.protect(Unknown Source) at junit.extensions.TestSetup.run(Unknown Source) at sun.misc.CVM.runMain(Unknown Source),0,1
Get upgrade tests to pass on OJEC 1.1,The upgrade tests fail on OJEC 1.1 because Derby 10.3.1.4 cannot be loaded. That version is ignored on phoneME for the exact same reason. We should do the same for OJEC.,0,0
NATIVE warns about password expiry for DBO,The DBO's password cannot expire. Still  NATIVE warns that the password is about to expire.ij&gt; connect 'jdbc:derby:authdb;create=true;user=admin';ij&gt; call syscs_util.syscs_set_database_property('derby.authentication.native.passwordLifetimeMillis'  '100');0 rows inserted/updated/deletedij&gt; call syscs_util.syscs_create_user('ADMIN'  '%*$');0 rows inserted/updated/deletedij&gt; call syscs_util.syscs_set_database_property('derby.authentication.provider'  'NATIVE::LOCAL');0 rows inserted/updated/deletedij&gt; connect 'jdbc:derby:authdb;shutdown=true';ERROR 08006: Database 'authdb' shutdown.ij&gt; connect 'jdbc:derby:authdb;user=admin;password=%*$';WARNING 01J15: Your password will expire in 0 day(s). Please use the SYSCS_UTIL.SYSCS_MODIFY_PASSWORD procedure to change your password.,0,0
Rolling back a transaction leads to an inconsistent state,Rolling back a transaction can leave a table in an inconsistent state if the table has been previously altered through the addition of new columns. It appears that if newly added columns have not been changed from their default value  then when a transaction which sets new values for these columns is rolled back the new columns are not restored to their previous values.Attached is an ij script with fairly minimal steps to reproduce the problem on Derby 10.6.2.0 and 10.8.2.2 (Win7 x64  Sun 32-bit JRE 1.6.0.26). Expected and observed output also attached.Would appreciate any suggestions as to a workaround for this issue. Running SYSCS_UTIL.SYSCS_COMPRESS_TABLE on the table after adding the columns seems to avoid the problem but may be just masking the issue.,0,0
When a foreign key constraint on a table is dropped  the associated statistics row for the conglomerate is not removed,If you drop the foreign key constraint for a table  the statistics row does not get removed. This affects the indexStat daemon because it now finds these statistics row which always appear as out of date  causing an update to be scheduled.Here is how to get it to happen:set schema app;CREATE TABLE TEST_TAB_1( ID INTEGER PRIMARY KEY NOT NULL);CREATE TABLE TEST_TAB_2( ID INTEGER PRIMARY KEY NOT NULL);ALTER TABLE TEST_TAB_2ADD CONSTRAINT TEST_TAB_2_FK_1FOREIGN KEY (ID) REFERENCES TEST_TAB_1(ID);insert into app.TEST_TAB_1 values (1);insert into test_tab_2 values(1);call syscs_util.syscs_update_statistics('APP'  'TEST_TAB_2'  null);selectc.TABLEID c.CONGLOMERATENUMBER c.CONGLOMERATENAME c.ISINDEX c.ISCONSTRAINT c.CONGLOMERATEID t.TABLEID t.TABLENAME t.TABLETYPE s.STATID s.REFERENCEID s.TABLEID s.CREATIONTIMESTAMP s.TYPE s.VALID s.COLCOUNT CAST(STATISTICS AS VARCHAR(40)) as STATISTICSfrom sys.SYSCONGLOMERATES c join sys.SYSTABLES t on c.TABLEID = t.TABLEID join sys.SYSSTATISTICS s on s.TABLEID = t.TABLEIDwhere t.TABLENAME = 'TEST_TAB_2' and c.ISINDEX = false;&#8211; At this point there are two statistic rowsTABLEID CONGLOMERATENUMBER CONGLOMERATENAME ISINDEX ISCONSTRAINT CONGLOMERATEID TABLEID TABLENAME TABLETYPE STATID REFERENCEID TABLEID CREATIONTIMESTAMP TYPE VALID COLCOUNT STATISTICS84490209-0136-6999-c1b4-000065089f97 348432 84490209-0136-6999-c1b4-000065089f97 false false cccb420a-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 TEST_TAB_2 T edbc8255-0136-6999-c1b4-000065089f97 55410238-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 2012-03-31 17:36:49.629 I true 1 numunique= 1 numrows= 184490209-0136-6999-c1b4-000065089f97 348432 84490209-0136-6999-c1b4-000065089f97 false false cccb420a-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 TEST_TAB_2 T 05278254-0136-6999-c1b4-000065089f97 63454207-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 2012-03-31 17:36:49.628 I true 1 numunique= 1 numrows= 1&#8211; Now drop the constraintalter table TEST_TAB_2drop constraint TEST_TAB_2_FK_1;selectc.TABLEID c.CONGLOMERATENUMBER c.CONGLOMERATENAME c.ISINDEX c.ISCONSTRAINT c.CONGLOMERATEID t.TABLEID t.TABLENAME t.TABLETYPE s.STATID s.REFERENCEID s.TABLEID s.CREATIONTIMESTAMP s.TYPE s.VALID s.COLCOUNT CAST(STATISTICS AS VARCHAR(40)) as STATISTICSfrom sys.SYSCONGLOMERATES c join sys.SYSTABLES t on c.TABLEID = t.TABLEID join sys.SYSSTATISTICS s on s.TABLEID = t.TABLEIDwhere t.TABLENAME = 'TEST_TAB_2' and c.ISINDEX = false;&#8211; There are still two statistic rowsTABLEID CONGLOMERATENUMBER CONGLOMERATENAME ISINDEX ISCONSTRAINT CONGLOMERATEID TABLEID TABLENAME TABLETYPE STATID REFERENCEID TABLEID CREATIONTIMESTAMP TYPE VALID COLCOUNT STATISTICS84490209-0136-6999-c1b4-000065089f97 348432 84490209-0136-6999-c1b4-000065089f97 false false cccb420a-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 TEST_TAB_2 T edbc8255-0136-6999-c1b4-000065089f97 55410238-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 2012-03-31 17:36:49.629 I true 1 numunique= 1 numrows= 184490209-0136-6999-c1b4-000065089f97 348432 84490209-0136-6999-c1b4-000065089f97 false false cccb420a-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 TEST_TAB_2 T 05278254-0136-6999-c1b4-000065089f97 63454207-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 2012-03-31 17:36:49.628 I true 1 numunique= 1 numrows= 1&#8211; Add another rowinsert into app.TEST_TAB_1 values (2);insert into test_tab_2 values(2);&#8211; Update the statisticscall syscs_util.syscs_update_statistics('APP'  'TEST_TAB_2'  null);selectc.TABLEID c.CONGLOMERATENUMBER c.CONGLOMERATENAME c.ISINDEX c.ISCONSTRAINT c.CONGLOMERATEID t.TABLEID t.TABLENAME t.TABLETYPE s.STATID s.REFERENCEID s.TABLEID s.CREATIONTIMESTAMP s.TYPE s.VALID s.COLCOUNT CAST(STATISTICS AS VARCHAR(40)) as STATISTICSfrom sys.SYSCONGLOMERATES c join sys.SYSTABLES t on c.TABLEID = t.TABLEID join sys.SYSSTATISTICS s on s.TABLEID = t.TABLEIDwhere t.TABLENAME = 'TEST_TAB_2' and c.ISINDEX = false;&#8211; There are still two rows but now one show 1 row and one shows 2 rowsTABLEID CONGLOMERATENUMBER CONGLOMERATENAME ISINDEX ISCONSTRAINT CONGLOMERATEID TABLEID TABLENAME TABLETYPE STATID REFERENCEID TABLEID CREATIONTIMESTAMP TYPE VALID COLCOUNT STATISTICS84490209-0136-6999-c1b4-000065089f97 348432 84490209-0136-6999-c1b4-000065089f97 false false cccb420a-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 TEST_TAB_2 T edbc8255-0136-6999-c1b4-000065089f97 55410238-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 2012-03-31 17:36:49.629 I true 1 numunique= 1 numrows= 184490209-0136-6999-c1b4-000065089f97 348432 84490209-0136-6999-c1b4-000065089f97 false false cccb420a-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 TEST_TAB_2 T 18438274-0136-6999-c1b4-000065089f97 63454207-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 2012-03-31 17:41:19.164 I true 1 numunique= 2 numrows= 2&#8211; Add the constraint back onALTER TABLE TEST_TAB_2ADD CONSTRAINT TEST_TAB_2_FK_1FOREIGN KEY (ID) REFERENCES TEST_TAB_1(ID);&#8211; Insert another rowinsert into app.TEST_TAB_1 values (3);insert into test_tab_2 values(3);&#8211; Update the statisticscall syscs_util.syscs_update_statistics('APP'  'TEST_TAB_2'  null);selectc.TABLEID c.CONGLOMERATENUMBER c.CONGLOMERATENAME c.ISINDEX c.ISCONSTRAINT c.CONGLOMERATEID t.TABLEID t.TABLENAME t.TABLETYPE s.STATID s.REFERENCEID s.TABLEID s.CREATIONTIMESTAMP s.TYPE s.VALID s.COLCOUNT CAST(STATISTICS AS VARCHAR(40)) as STATISTICSfrom sys.SYSCONGLOMERATES c join sys.SYSTABLES t on c.TABLEID = t.TABLEID join sys.SYSSTATISTICS s on s.TABLEID = t.TABLEIDwhere t.TABLENAME = 'TEST_TAB_2' and c.ISINDEX = false;&#8211; Now there are 3 rowsTABLEID CONGLOMERATENUMBER CONGLOMERATENAME ISINDEX ISCONSTRAINT CONGLOMERATEID TABLEID TABLENAME TABLETYPE STATID REFERENCEID TABLEID CREATIONTIMESTAMP TYPE VALID COLCOUNT STATISTICS84490209-0136-6999-c1b4-000065089f97 348432 84490209-0136-6999-c1b4-000065089f97 false false cccb420a-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 TEST_TAB_2 T edbc8255-0136-6999-c1b4-000065089f97 55410238-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 2012-03-31 17:36:49.629 I true 1 numunique= 1 numrows= 184490209-0136-6999-c1b4-000065089f97 348432 84490209-0136-6999-c1b4-000065089f97 false false cccb420a-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 TEST_TAB_2 T 45eb02e8-0136-6999-c1b4-000065089f97 63454207-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 2012-03-31 17:46:00.211 I true 1 numunique= 3 numrows= 384490209-0136-6999-c1b4-000065089f97 348432 84490209-0136-6999-c1b4-000065089f97 false false cccb420a-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 TEST_TAB_2 T 0ea502e9-0136-6999-c1b4-000065089f97 7ab90278-0136-6999-c1b4-000065089f97 84490209-0136-6999-c1b4-000065089f97 2012-03-31 17:46:00.212 I true 1 numunique= 3 numrows= 3Note that dropping that recreating the constraint or compressing the table does not fix the problem.,0,0
Back out the concurrency improvements for identity columns introduced by derby-4437,DERBY-4437 attempted to improve the concurrency of identity columns by using SYSSEQUENCE-style sequence generators. These improvements caused NsTest to behave differently than it used to and they disclosed a problem in clearing the identity cache. The community lost confidence in this solution and it was backed out of the 10.8 branch under issue DERBY-5448. This new issue is filed to back the improvements out of the 10.9 trunk. Further useful discussion about how to improve the concurrency and correctness of identity columns has been taking place on DERBY-5443 and DERBY-5493.For the 10.9 release  identity columns will return to their old behavior of being ill-suited for high concurrency applications. Applications which need higher concurrency should be re-coded to use sequences rather than identity columns.,0,0
intermittent test failure in storetests/st_derby715.java,I am seeing an irregularly occurring failure with ibm 1.4.2 on one machine - which happens to be the only 4 CPU machine and the only one running Windows 2008...And I've got 10.8 nightly tests running on it.I have not seen this with other jvms on the same machine.It's possible this would also happen on trunk  but we stopped supporting 1.4.2 with trunk and so I do not run tests against trunk with (ibm) 1.4.2.When the test passes  the output contains 5 identical lines 'Got a Deadlock'.The test failures are of 2 kinds: 1 (or more?) of the 'Got a Deadlock' lines is missing we get a '40XL1' error (timeout) instead of a deadlock.As the second situation seems to match what DERBY-715 was about  I thought it worthwhile reporting as a separate JIRA. We should check it's not somehow a regression.,0,0
Authorization decorators don't null out connections when done,Some decorators used to test authorization don't close and null out references to Connection objects when they have completed. Since these tests often create/boot single-use databases  and the Connection objects have references to the database instance and  directly or indirectly  many of its modules  this prevents much garbage from being removed from the heap after the tests have completed and shut down their single-use databases. We should close the default connection and clear the reference to it when tearing down these decorators  so the space is released for subsequent tests to use.This problem affects decorators returned by the following methods:DatabasePropertyTestSetup.builtinAuthenticationNoTeardown()TestConfiguration.sqlAuthorizationDecorator()TestConfiguration.sqlAuthorizationDecoratorSingleUse()These methods return modified versions of DatabasePropertyTestSetup where the tearDown() method is a no-op.,0,1
Clean up statements in CreateTableFromQueryTest,CreateTableFromQueryTest has a Statement field that it closes  but doesn't null out  in tearDown(). Since the field isn't nulled out  it cannot be garbage collected  and one Statement per test case will be left on the heap after completion.,0,0
ResultSetFromPreparedStatementTest keeps references to non-default connections,ResultSetFromPreparedStatementTest keeps references to non-default connections in the fields c2 and c3. c2 is closed and nulled out in tearDown(). c3 is only closed. It should be nulled out too in order to allow gc of resources after test completion.,0,0
BigDataTest.tearDown() doesn't call super.tearDown(),BigDataTest's tearDown() method doesn't call super.tearDown()  causing it to leave statements and connections open and not eligible for gc.,0,0
CheckConstraintTest holds on to resources after completion,CheckConstraintTest keeps connections  statements and result sets in instance variables  but never clears the variables  so they are kept forever.,0,1
ColumnDefaultsTest holds on to resources after completion,ColumnDefaultsTest keeps connections  statements and result sets in instance variables  but never clears the variables  so they are kept forever.,0,1
InbetweenTest holds on to resources after completion,InbetweenTest keeps connections  statements and result sets in instance variables  but never clears the variables  so they are kept forever.,0,1
TimestampArithTest keeps references to statements after completion,TimestampArithTest keeps references to statements in static fields  but never closes them or clears the fields.,0,0
TableFunctionTest keeps reference to connection after completion,The test cases in TableFunctionTest store a DatabaseMetaData instance in an instance variable. The DatabaseMetaData instance references the default connection  and the connection can therefore not be gc'ed after the test has completed.,0,0
UngroupedAggregatesNegativeTest doesn't call super.tearDown(),public void tearDown() throws SQLException { dropTable('t1'); dropTable('t2'); }Should call super.tearDown() to close and release connection and statements.,0,0
ParameterMappingTest lacks call to super.tearDown(),ParameterMappingTest.tearDown() should call super.tearDown() to release connections/statements.,0,0
InternationalConnectTest forgets to call super.tearDown(),Its tearDown() method should call super.tearDown() to free resources.,0,0
EncryptionKeyTest sometimes keeps reference to connection,EncryptionKeyTest has this code to clean up the connection: if (con != null &amp;&amp; !con.isClosed()) { con.rollback(); con.close(); con = null; }If the connection is already closed  it won't null out the reference. It should set con to null unconditionally.,0,1
Replication tests keep references to connections after completion,The base class for the replication tests  ReplicationRun  keeps references to connections used during the test also after the test has completed. The connections are referenced from these fields: masterConn slaveConn startSlaveException (which references a connection indirectly via client.am.SqlException -&gt; client.am.Sqlca),0,1
ProtocolTest doesn't clean up its test resources,ProtocolTest doesn't clean up its test resources. A tearDown method should be added to make the referenced instances eligable for garbage collection. The test class instances currenlty retain more than 10 MB on the heap.,0,1
NullPointerException in GenericTriggerExecutor.executeSPS() caused by OutOfMemoryError,If I run TriggerTest with the flags -server and -Xmx150M passed to the JVM  I fairly consistently see a NPE being thrown:java.lang.NullPointerException at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:221) at org.apache.derby.impl.sql.execute.RowTriggerExecutor.fireTrigger(RowTriggerExecutor.java:114) at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:281) at org.apache.derby.impl.sql.execute.UpdateResultSet.fireAfterTriggers(UpdateResultSet.java:818) at org.apache.derby.impl.sql.execute.UpdateResultSet.open(UpdateResultSet.java:280) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:443) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:324) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1242) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1715) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(EmbedPreparedStatement.java:1370) at org.apache.derbyTesting.functionTests.tests.lang.TriggerTest.testBlobInTriggerTable(TriggerTest.java:880) at org.apache.derbyTesting.functionTests.tests.lang.TriggerTest.testBlobInTriggerTable(TriggerTest.java:779) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at junit.framework.TestCase.runTest(TestCase.java:164) at junit.framework.TestCase.runBare(TestCase.java:130) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at junit.framework.TestResult$1.protect(TestResult.java:106) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.framework.TestResult.run(TestResult.java:109) at junit.framework.TestCase.run(TestCase.java:120) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.textui.TestRunner.doRun(TestRunner.java:121) at junit.textui.TestRunner.start(TestRunner.java:185) at junit.textui.TestRunner.main(TestRunner.java:143)In derby.log  there is an OOME right before the NPE:java.lang.OutOfMemoryError: Java heap space at org.apache.derby.impl.jdbc.LOBStreamControl.updateData(LOBStreamControl.java:154) at org.apache.derby.impl.jdbc.LOBStreamControl.write(LOBStreamControl.java:247) at org.apache.derby.impl.jdbc.LOBStreamControl.&lt;init&gt;(LOBStreamControl.java:89) at org.apache.derby.impl.jdbc.EmbedBlob.&lt;init&gt;(EmbedBlob.java:189) at org.apache.derby.impl.jdbc.EmbedResultSet.getBlob(EmbedResultSet.java:4072) at org.apache.derby.impl.jdbc.EmbedResultSet.getObject(EmbedResultSet.java:1704) at org.apache.derby.exe.ac56961bb1x0137x0d04x3d17x00005ffb0f6356.e0(Unknown Source) at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:139) at org.apache.derby.impl.sql.execute.RowResultSet.getNextRowCore(RowResultSet.java:148) at org.apache.derby.impl.sql.execute.DMLWriteResultSet.getNextRowCore(DMLWriteResultSet.java:127) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:507) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:443) at org.apache.derby.impl.sql.GenericPreparedStatement.executeSubStatement(GenericPreparedStatement.java:313) at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:176) at org.apache.derby.impl.sql.execute.RowTriggerExecutor.fireTrigger(RowTriggerExecutor.java:114)(...)The code that fails with NPE  is this call to cleanupOnError() in a catch block in GenericTriggerExecutor.executeSPS(): /* retrieve the current active SC */ StatementContext sc = lcc.getStatementContext(); /* make sure that the cleanup is on the new SC */ if (active_sc != sc)  { sc.cleanupOnError(e); },0,1
Remove unsued code in AlterTableConstantaction.columnDroppedAndTriggerDependencies,The following code is executed  but the results are not used: CollectNodesVisitor visitor = new CollectNodesVisitor(ColumnReference.class); stmtnode.accept(visitor); Vector refs = visitor.getList(); &lt;--- never usedI plan to remove the code  but just want to record it here in case there are side-effects by using the visitor.,0,0
Native user authentication: improve wording of error message,This error message no longer has a correct string: XCY05(quote from English locale):Invalid setting of the derby.authentication.provider property. This property cannot be set to NATIVE::LOCAL unless credentials for the database owner have been stored in the database using the SYSCS_UTIL.SYSCS_CREATE_USER procedure.This property should no longer ever need to be set to NATIVE::LOCAL: it is done automatically when the first user is created via SYSCS_UTIL.SYSCS_CREATE_USER.The wording should be adjusted. Note: Now  the property should never be set manually for native authentication via SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY  this is only meaningful for LOCAL credentials db  but this is done automatically since version 7 of the spec.,1,0
Sending an empty string as table name to compress table procedure or empty string as index name to update statistics procedure makes the parser throw an exception.,When empty string is passed for the index name to the update statistics procedure  it throws following exception(passing an empty string for table to compress table procedure also gives simiar exception). The new stored procedure being created through DERBY-4115 for dropping the statistics also gave similar exceptionjava -Dij.exceptionTrace=true org.apache.derby.tools.ijconnect 'jdbc:derby:db1;create=true'; create table t1(c11 int  statistics int not null);call syscs_util.SYSCS_UPDATE_STATISTICS( 'APP'  'T1'  '' );ERROR 38000: The exception 'java.sql.SQLException: Syntax error: Encountered '/'' at line 1  column 42.' was thrown while evaluating an expression.java.sql.SQLException: The exception 'java.sql.SQLException: Syntax error: Encountered '/'' at line 1  column 42.' was thrown while evaluating an expression. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:98) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142) at org.apache.derby.impl.jdbc.Util.seeNextException(Util.java:278) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:431) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2360) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:82) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1334) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:630) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:559) at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:367) at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:527) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:369) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:245) at org.apache.derby.impl.tools.ij.Main.go(Main.java:229) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:184) at org.apache.derby.impl.tools.ij.Main.main(Main.java:75) at org.apache.derby.tools.ij.main(ij.java:59)Caused by: java.sql.SQLException: The exception 'java.sql.SQLException: Syntax error: Encountered '/'' at line 1  column 42.' was thrown while evaluating an expression. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:42) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71) ... 17 moreCaused by: java.sql.SQLException: Syntax error: Encountered '/'' at line 1  column 42. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:42) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:256) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:424) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2360) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:82) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(EmbedPreparedStatement.java:153) at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Driver40.java:107) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1685) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1513) at org.apache.derby.catalog.SystemProcedures.SYSCS_UPDATE_STATISTICS(SystemProcedures.java:753) at org.apache.derby.exe.acace4c0a3x0137x2f19xcc22x00000013e5704.g0(Unknown Source) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37) at java.lang.reflect.Method.invoke(Method.java:611) at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(ReflectMethod.java:46) at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(CallStatementResultSet.java:75) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:443) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:324) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1242) ... 10 moreCaused by: ERROR 42X01: Syntax error: Encountered '/'' at line 1  column 42. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:278) at org.apache.derby.impl.sql.compile.ParserImpl.parseStatement(ParserImpl.java:153) at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:357) at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:99) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:1103) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(EmbedPreparedStatement.java:134) ... 24 moreERROR 42X01: Syntax error: Encountered '/'' at line 1  column 42.java.sql.SQLSyntaxErrorException: Syntax error: Encountered '/'' at line 1  column 42. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:92) at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:256) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:424) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2360) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:82) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(EmbedPreparedStatement.java:153) at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Driver40.java:107) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1685) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1513) at org.apache.derby.catalog.SystemProcedures.SYSCS_UPDATE_STATISTICS(SystemProcedures.java:753) at org.apache.derby.exe.acace4c0a3x0137x2f19xcc22x00000013e5704.g0(Unknown Source) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37) at java.lang.reflect.Method.invoke(Method.java:611) at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(ReflectMethod.java:46) at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(CallStatementResultSet.java:75) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:443) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:324) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1242) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:630) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:559) at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:367) at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:527) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:369) at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:245) at org.apache.derby.impl.tools.ij.Main.go(Main.java:229) at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:184) at org.apache.derby.impl.tools.ij.Main.main(Main.java:75) at org.apache.derby.tools.ij.main(ij.java:59)Caused by: java.sql.SQLException: Syntax error: Encountered '/'' at line 1  column 42. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:42) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71) ... 30 moreCaused by: ERROR 42X01: Syntax error: Encountered '/'' at line 1  column 42. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:278) at org.apache.derby.impl.sql.compile.ParserImpl.parseStatement(ParserImpl.java:153) at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:357) at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:99) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:1103) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(EmbedPreparedStatement.java:134) ... 24 moreIssue the 'help' command for general information on IJ command syntax.Any unrecognized commands are treated as potential SQL commands and executed directly.Consult your DBMS server reference documentation for details of the SQL syntax supported by your server.ij&gt;,0,0
Missing argument in some XJ022 errors,EmbedBlob and EmbedClob some times wrap IOExceptions in an SQLException with SQLState XJ022 (SQLState.SET_STREAM_FAILURE)  but they don't always specify the message argument  so the error message ends up like this:java.sql.SQLException: Unable to set stream: '{0}'.(The detailed error message does appear in a chained exception  so it's not a very big problem  but it looks a bit odd.)I don't know of a way to expose these exceptions in a test. I just noticed it when I added some manual asserts to force a failure when investigating another issue.The fix should be simple: Use the helper method Util.setStreamFailure() that sets the message argument automatically.,0,0
Use TestNullOutputStream where possible,Derby's test framework provides a stream class  TestNullOutputStream  that discards all data written to it. Utf8CcsidManagerClientTest's constructor and BaseJDBCTestCase.runScript() create their own anonymous classes that provide the same functionality. They should be changed to reuse TestNullOutputStream.,0,0
Upgrade tests should  print full IOException stack trace when it fails to access old versions,When the Upgrade tests fail to access the oldVersions due to an IOException the message is not very clear as to what the IOException was. e g. can output ALARM: IOException msg: 'svn.apache.org'. Upgrade tests can NOT be run!ALARM: IOException msg: 'svn.apache.org'. Upgrade tests can NOT be run!ALARM: IOException msg: 'svn.apache.org'. Upgrade tests can NOT be run!ALARM: IOException msg: 'svn.apache.org'. Upgrade tests can NOT be run!ALARM: IOException msg: 'svn.apache.org'. Upgrade tests can NOT be run!ALARM: IOException msg: 'svn.apache.org'. Upgrade tests can NOT be run!ALARM: IOException msg: 'svn.apache.org'. Upgrade tests can NOT be run!ALARM: IOException msg: 'svn.apache.org'. Upgrade tests can NOT be run!ALARM: IOException msg: 'svn.apache.org'. Upgrade tests can NOT be run!ALARM: IOException msg: 'svn.apache.org'. Upgrade tests can NOT be run!ALARM: IOException msg: 'svn.apache.org'. Upgrade tests can NOT be run!ALARM: IOException msg: 'svn.apache.org'. Upgrade tests can NOT be run!ALARM: IOException msg: 'svn.apache.org'. Upgrade tests can NOT be run!ALARM: IOException msg: 'svn.apache.org'. Upgrade tests can NOT be run!ALARM: IOException msg: 'svn.apache.org'. Upgrade tests can NOT be run!Time: 0.008OK (0 tests)The code in OldVersions.getVersions() } } catch (IOException ioe) { alarm('Error reading from file: ' + oldVersionsPath + ioe.getMessage()); }should print the exception stack trace or possibly even fail on IOException.,0,0
Table functions should only accept arguments which are constant in their query block.,Derby lets you invoke a table function in the FROM list of a query  passing in arguments built out of columns in other tables in the FROM list. This syntax is illegal and the resulting queries have no meaning under the SQL Standard. See the discussion on DERBY-5554. We should forbid this syntax. Similar syntax involving correlated subqueries in the FROM list is already forbidden. Fixing this will create a backward incompatibility which requires a release note.,0,0
Remove duplicated code for starting remote processes in replication tests,ReplicationRun has two copies of each of the methods runUserCommand()  runUserCommandRemotely() and processOutput(). One variant takes an id parameter (used only in debug output)  and one doesn't. It would be sufficient to have one copy of each of these methods.,0,0
Replication tests should use BaseTestCase.execJavaCmd() to run local commands,The replication tests invoke Runtime.exec() directly in order to spawn processes. The sub-processes that run on the same host as the main test process  should instead be started with the helper method BaseTestCase.execJavaCmd(). Having all the tests use the helper method would make it easier if we for example want to pass specific flags to all sub-processes created in a test run.Note that the replication tests also have code for starting processes on a remote host via ssh. BaseTestCase.execJavaCmd() cannot do that  so only local processes can be started with the helper method. When the replication tests run as part of suites.All  all the spawned processes run locally.,0,0
Make it possible to turn off encryption on an already encrypted database.,Currently  you can encrypt an unencrypted database and you can change the encryption key on an already encrypted database. However  Derby does not expose a way to turn off (unencrypt) an already encrypted database.,1,0
Documentation in release doesn't include stylesheets,The documentation that is bundled with the Derby releases does not include the three .css stylesheets that are copied into the out/&lt;manual-name&gt; directory by the Ant task that builds the HTML files. These need to be included in the docs/html/&lt;manual-name&gt; directories for the releases.I believe this problem has existed from the beginning &#8211; it certainly goes back several releases.,0,0
Remove unused methods in client.am.DateTime,The DateTime class contains two unused methods: timestampToDateBytes() and timestampToTimeBytes(). These methods also contain calls to deprecated methods in the java.util.Date class  so it would be good to get rid of them.,0,0
AssertionFailedError in functionTests.tests.lang.UpdateStatisticsTest.testDisposableStatsEagerness,I noticed a test failure in UpdateStatisticsTest.testDisposableStatsEagerness.The link is: http://people.apache.org/~myrnavl/derby_test_results/main/windows/testlog/ibm16/1345812-suites.All_diff.txtThe stack trace: testDisposableStatsEagerness(org.apache.derbyTesting.functionTests.tests.lang.UpdateStatisticsTest)junit.framework.AssertionFailedError at org.apache.derbyTesting.functionTests.tests.lang.UpdateStatisticsTest.testDisposableStatsEagerness(UpdateStatisticsTest.java:594) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:424) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:441) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57),0,0
Disable i18n/JapanCodeConversion.sql on platforms that don't support EUC_JP or SJIS,I ran derbyall on Java SE for Embedded 7  which doesn't support the EUC_JP or SJIS encodings. i18n/JapanCodeConversion.sql failed because of this:                 Diff file derbyall/i18nTest/JapanCodeConversion.diff             Start: JapanCodeConversion jdk1.7.0_04-ea derbyall:i18nTest 2012-05-31 15:10:02 ***55 del&lt; 0 rows inserted/updated/deleted55a55 58&gt; ERROR 38000: The exception 'java.sql.SQLException: The exception 'java.lang.reflect.InvocationTargetException' was thrown while evaluating an expression.' was thrown while evaluating an expression.&gt; ERROR 38000: The exception 'java.lang.reflect.InvocationTargetException' was thrown while evaluating an expression.&gt; ERROR XJ001: Java exception: ': java.lang.reflect.InvocationTargetException'.&gt; ERROR XJ001: Java exception: 'java.io.UnsupportedEncodingException: EUC_JP'.59 74d61(...)    We should skip the test on platforms that don't support these encodings.,0,0
Remove unused class ExecProcUtil,The class living in java/testing/org/apache/derbyTesting/functionTests/util/ExecProcUtil.java isn't used and can be removed.,0,0
Add replicationTests.ReplicationSuite to junit-core ant target,The replication tests aren't run as part of the junit-core ant target (nor in any of the other relevant targets).I suggest adding the suite such that is is run as part of the top-level ant targets for testing Derby.Note that it would have been simpler to simply run suites.All  but the special logic for JDBC 4 code may still be relevant for some platforms (JSR169). It is also nice to get some more feedback as the test cycle proceeds. The downside of not using suites.All is that we may forget adding new suites to the ant target(s)  but we're adding so few new suites that it shouldn't be much of a problem.,0,0
testOSReadOnly fails with k.AssertionFailedError: expected an error indicating the db is readonly on HP java 1.6,This failure was reported running suites.All on HP. Read only database is apparently not read only.1) testOSReadOnly(org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest)junit.framework.AssertionFailedError: expected an error indicating the db is readonly at org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest.assertExpectedInsertBehaviour(OSReadOnlyTest.java:261) at org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest.testOSReadOnly(OSReadOnlyTest.java:139) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)2) testOSReadOnly(org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest)junit.framework.AssertionFailedError: Failed to copy directory from /local1/derbytest/test/system/singleUse/oneuse4b to /local1/derbytest/test/system/singleUse/readOnly at org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest.copyDatabaseOnOS(OSReadOnlyTest.java:282) at org.apache.derbyTesting.functionTests.tests.store.OSReadOnlyTest.testOSReadOnly(OSReadOnlyTest.java:131) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)FAILURES!!!Tests run: 11145  Failures: 2  Errors: 0bash-4.0#,1,0
Make DoubleProperties.propertyNames() thread-safe,As discussed in DERBY-4269  DoubleProperties.propertyNames() may throw a NullPointerException if properties are removed by another thread while the method is executing. Since DoubleProperties is a sub-class of  and used as a drop-in replacement for  java.util.Properties  it should be thread-safe just like the propertyNames() method in the parent class.,0,0
By using syscs_set_database_property  you can set the database version to a garbage string which prevents you from booting the database.,The following script shows this problem:connect 'jdbc:derby:db;create=true';values ( syscs_util.syscs_get_database_property( 'DataDictionaryVersion' ) );call syscs_util.syscs_set_database_property( 'DataDictionaryVersion'  'foobar' );values ( syscs_util.syscs_get_database_property( 'DataDictionaryVersion' ) );connect 'jdbc:derby:db;shutdown=true';&#8211; fails to bootconnect 'jdbc:derby:db';,0,0
Clean up IDE warnings in DRDAConnThread,When I open DRDAConnThread in NetBeans  I see 49 warnings. Most of them are harmless (like static fields accessed via an instance  suggestions about using StringBuilder instead of StringBuffer  or using System.arraycopy() instead of for loops). Others indicate real problems  like the use of != to compare SQL states in writeSQLDIAGGRP().We should clean up the warnings so that it's easier to notice new warnings about potential problems.,0,0
Remove unused methods in DDMReader and DDMWriter,Many of the methods in DDMReader and DDMWriter are not used anymore. Those methods could be removed.,0,0
Remove JDBC 3 constants from client.am.Statement,org.apache.derby.client.am.Statement defines three constants  CLOSE_CURRENT_RESULT  KEEP_CURRENT_RESULT and CLOSE_ALL_RESULTS  that are also defined in java.sql.Statement. Since client.am.Statement implements java.sql.Statement  we could remove those constants and let it inherit them instead. The only reason why these constants are defined in client.am.Statement  is to make the client compile on JDKs predating JDBC 3 (that is  Java 1.3 and earlier). Since we don't support those JDKs anymore  the constants can be removed now.,0,0
Prune the brokered class tree,The brokered class tree still separates between the JDBC 2.0 functionality and JDBC 3.0. This leads to unnecessarily many levels of classes (for example  BrokeredPreparedStatement -&gt; BrokeredPreparedStatement30 -&gt; BrokeredStatement40). Another consequence is that BrokeredCallableStatement30 and BrokeredPreparedStatement30 don't have a common base class that could hold shared JDBC 3.0 methods (their common base class is BrokeredPreparedStatement  which is JDBC 2.0)  and therefore new JDBC 3.0 PreparedStatement methods are duplicated in the two classes.We should fold the JDBC 3.0 classes into the JDBC 2.0 classes so that we can reduce the number of classes and the duplication of code in the brokered statement sub-tree.,0,0
Add message argument names  as comments  to English message file produced by MessageBuilder.,The MessageBuilder program turns messages.xml into two output files:1) The DITA source for the Reference Guide section on error messages.2) The messages_en.properties file of engine messages.All of the translators I have dealt with want to use (2) as the English input for their translations. I believe this is because translators have written their own tools and those tools expect to work on properties files.Messages may have arguments. Those arguments appear as sub-elements of the messages in messages.xml. The arguments turn up in (1) but are thrown away when MessageBuilder produces (2). We can help translators do a better job by also writing the arguments as comments in (2).,0,0
Simplify JSR-169 implementation class tree,The JSR-169 interface is a subset of JDBC 3.0  but still the JDBC 3.0 implementation classes do not extend the JSR-169 implementation classes. Instead  the JSR-169 and JDBC 3.0 implementation classes extend a common base class. The reason for this structure  is that the JSR-169 compile targets used to be optional  so the JDBC 3.0 classes could not depend on them.For example  the class javadoc comment for EmbedResultSet169 says: ResultSet implementation for JSR169. Adds no functionality to its (abstract) parent class. If Derby could be compiled against JSR169 that the parent class could be the concrete class for the environment. Just like for the JDBC 2.0 specific classes. Until that is possible (ie. easily downloadable J2ME/CDC/Foundation/JSR169 jar files  this class is required and is only compiled by an optional target.Since the JSR-169 code is no longer optional  we should do as the comment suggests  and use the base class directly instead. This would allow us to simplify the class tree.,0,0
The order of argument names in messages.xml is sometimes wrong when the arguments occur in the message out of sequence.,In most Derby messages  arguments appear in ascending order. That is  {0} occurs in the message first  then {1}  then {2}  and so on. Sometimes  however  arguments occur out of sequence. When this happens  the names in the &lt;arg&gt; sub-elements may not agree with the order that the arguments actually occur in the message. This causes MessageBuilder to garble the dita source for the Reference Guide page titled 'SQL error messages and exceptions'.For instance  here is the messages.xml element for SQLState 22014: &lt;msg&gt; &lt;name&gt;22014&lt;/name&gt; &lt;text&gt;The start position for LOCATE is invalid; it must be a positive integer. The index to start the search from is '{2}'. The string to search for is '{0}'. The string to search from is '{1}'. &lt;/text&gt; &lt;arg&gt;startIndex&lt;/arg&gt; &lt;arg&gt;searchString&lt;/arg&gt; &lt;arg&gt;fromString&lt;/arg&gt; &lt;/msg&gt;This gives rise to the following garbled text in the generated reference guide page:'The start position for LOCATE is invalid; it must be a positive integer. The index to start the search from is '&lt;fromString&gt;'. The string to search for is '&lt;startIndex&gt;'. The string to search from is '&lt;searchString&gt;'. 'We should re-order the &lt;arg&gt; sub-elements so that the first &lt;arg&gt; sub-lement corresponds to {0}  the second &lt;arg&gt; sub-element corresponds to {1}  and so on.,0,0
Broken handling of paths with special characters in compatibility/VersionCombinationConfigurator,Some of the code handling paths in compatibility/VersionCombinationConfigurator is broken.The issue is that the location of a given class is given as a URL. This means the path will be URL encoded  and  for instance  spaces will be encoded as '%20'.This bug typically shows itself as an NPE when invoking compatibility._Suite.,0,1
add ibm18 class to functionTests.harness,The 'old test harness'  in package java.org.apache.derbyTesting.functionTests.harness  needs an ibm18 class - similar to ibm17. I don't plan to run tests with this jvm against branches older than 10.8  but it will need to be backported to 10.9 and 10.8.,0,0
Incorrect list of compatible JRE versions in client trace #2,The list of compatible JRE versions is out of sync again. It currently says 1.4  1.5  and 1.6.For trunk I believe we must remove 1.4  and we should add 1.7.For 10.9  if we want to change it  I think we can keep 1.4? And 1.7 was out and supported before we released 10.9  right?This issue was logged as DERBY-5078 the previous time it was out of sync.,0,0
Add utility methods to query state of URL attributes in EmbedConnection,Add utility methods to determine whether URL attributes are set or have the value true.The motivation for the change is improved readability/formatting of the code.,0,0
Missing method exception raised when using Clobs with territory based collation,When using territory-based collation with Clobs  Derby raises an error trying to invoke a missing method. The following script shows this problem:connect 'jdbc:derby:memory:db;create=true;collation=TERRITORY_BASED';create function makeClob( contents varchar( 32672 ) ) returns cloblanguage java parameter style java no sql deterministicexternal name 'org.apache.derbyTesting.functionTests.tests.lang.UserDefinedAggregatesTest.makeClob';create table clobTable( a clob );&#8211; fails with a java.lang.NoSuchMethodError exceptioninsert into clobTable( a ) values ( makeClob( 'a' ) );connect 'jdbc:derby:memory:db1;create=true';create function makeClob( contents varchar( 32672 ) ) returns cloblanguage java parameter style java no sql deterministicexternal name 'org.apache.derbyTesting.functionTests.tests.lang.UserDefinedAggregatesTest.makeClob';create table clobTable( a clob );&#8211; succeedsinsert into clobTable( a ) values ( makeClob( 'a' ) );Here is the error:ERROR 38000: The exception 'java.lang.NoSuchMethodError: org.apache.derby.iapi.types.DataValueFactory.getClobDataValue(Ljava/sql/Clob;Lorg/apache/derby/iapi/types/StringDataValue;I)Lorg/apache/derby/iapi/types/StringDataValue;' was thrown while evaluating an expression.ERROR XJ001: Java exception: 'org.apache.derby.iapi.types.DataValueFactory.getClobDataValue(Ljava/sql/Clob;Lorg/apache/derby/iapi/types/StringDataValue;I)Lorg/apache/derby/iapi/types/StringDataValue;: java.lang.NoSuchMethodError'....and here is the stack trace:Tue Oct 16 08:27:23 PDT 2012 Thread&#91;main 5 main&#93; (XID = 172)  (SESSIONID = 1)  (DATABASE = memory:db)  (DRDAID = null)  Failed Statement is: &#8211; fails with a java.lang.NoSuchMethodError exceptioninsert into clobTable( a ) values ( makeClob( 'a' ) )ERROR 38000: The exception 'java.lang.NoSuchMethodError: org.apache.derby.iapi.types.DataValueFactory.getClobDataValue(Ljava/sql/Clob;Lorg/apache/derby/iapi/types/StringDataValue;I)Lorg/apache/derby/iapi/types/StringDataValue;' was thrown while evaluating an expression. at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.iapi.error.StandardException.unexpectedUserException(Unknown Source) at org.apache.derby.impl.services.reflect.DirectCall.invoke(Unknown Source) at org.apache.derby.impl.sql.execute.RowResultSet.getNextRowCore(Unknown Source) at org.apache.derby.impl.sql.execute.DMLWriteResultSet.getNextRowCore(Unknown Source) at org.apache.derby.impl.sql.execute.InsertResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source) at org.apache.derby.impl.tools.ij.Main.main(Unknown Source) at org.apache.derby.tools.ij.main(Unknown Source)Caused by: java.lang.NoSuchMethodError: org.apache.derby.iapi.types.DataValueFactory.getClobDataValue(Ljava/sql/Clob;Lorg/apache/derby/iapi/types/StringDataValue;I)Lorg/apache/derby/iapi/types/StringDataValue; at org.apache.derby.exe.ace50d80a4x013ax6a2fxb54bx00000467ed600.e0(Unknown Source) ... 17 more,0,0
NPE in SELECT involving subselects and windows functions,A user reports and I have verified an NPE on the following SELECT:connect 'jdbc:derby:memory:db;create=true';create table blah ( a int );insert into blah values (1)  (2)  (3)  (4)  (5)  (6)  (7);SELECT rn  (SELECT rn FROM (SELECT row_number() over() rn FROM blah ) as T2where T2.rn = T1.rn+1) rn2FROM (SELECT row_number() over() rn from blah) as T1;,0,0
Timestamp comparison failure in AutomaticIndexStatisticsTest.testStatisticsCorrectness,http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/testlog/lin/1402814-suitesAll_diff.txt1) testStatisticsCorrectness(org.apache.derbyTesting.functionTests.tests.store.AutomaticIndexStatisticsTest)junit.framework.AssertionFailedError at org.apache.derbyTesting.functionTests.tests.store.AutomaticIndexStatisticsTest.testStatisticsCorrectness(AutomaticIndexStatisticsTest.java:324) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:424) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:441) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)The failure is caused by this assert: assertTrue(s.created.before(now));It might be a coincidence  but it happened the same night as Europe was switching from DST.It may also be related to DERBY-5046  where a similar assert failed because poor clock resolution made the two timestamps equal.,0,0
Encryption  re-encryption  and un-encryption silently fail if the database is already booted.,If the database is already booted  then the DBO's attempt to re-encrypt or un-encrypt the database will silently fail. It will appear to the DBO that the re(un)encryption succeeded but in fact the database will not be changed. Derby should raise an error if the database is already booted when the DBO attempts re(un)encryption.,1,0
Grammar doesn't accept OR operator without parentheses,The grammar doesn't accept the OR operator without parentheses in some constructs.For example  in a select list:ij&gt; create table t(b1 boolean  b2 boolean);0 rows inserted/updated/deletedij&gt; select b1 or b2 from t;ERROR 42X01: Syntax error: Encountered 'or' at line 1  column 11. (errorCode = 30000)Issue the 'help' command for general information on IJ command syntax.Any unrecognized commands are treated as potential SQL commands and executed directly.Consult your DBMS server reference documentation for details of the SQL syntax supported by your server.However  it does not fail if OR is replaced by AND  or if parentheses are used around the OR expression:ij&gt; select (b1 or b2) from t;1 0 rows selectedij&gt; select b1 and b2 from t;1 0 rows selectedSimilar behaviour is seen in VALUES statements:ij&gt; values true or false;ERROR 42X01: Syntax error: Encountered 'or' at line 1  column 13. (errorCode = 30000)Issue the 'help' command for general information on IJ command syntax.Any unrecognized commands are treated as potential SQL commands and executed directly.Consult your DBMS server reference documentation for details of the SQL syntax supported by your server.ij&gt; values (true or false);1 true 1 row selectedij&gt; values true and false;1 false1 row selected,0,0
Stop producing byte code for non-existent qualifiers,For all result set nodes that have predicate lists  Derby's compiler lays out byte code for fields to hold qualifiers  and also code to reinitialize the values in those fields on every execution. It does this even if there are no qualifiers. See PredicateList.generateQualifiers(). That method does actually check whether there are qualifiers  and it skips some of the code generation if there are none. It should be changed so that it skips all the code generation if there are no qualifiers.For an example  see the decompiled generated class for a natural join attached to DERBY-5947: https://issues.apache.org/jira/secure/attachment/12549514/natural-join-after-3a.txtThat class contains three Qualifier[][] fields: private Qualifier[][] e1; private Qualifier[][] e3; private Qualifier[][] e4;Only one of them (e4) is ever set to a non-null value. Still  the reinit() method  which is called on every execution  has code for each of the fields: protected void reinit() throws StandardException { BaseActivation.reinitializeQualifiers(e1); BaseActivation.reinitializeQualifiers(e3); BaseActivation.reinitializeQualifiers(e4); },0,0
Use BaseTestCase.execJavaCmd() to start process from NetworkServerTestSetup,NetworkServerTestSetup invokes Runtime.exec(String[]) manually when it needs to start a sub-process. It should use BaseTestCase.execJavaCmd(). In addition to reducing the amount of code  it would make the server processes pick up the flags they need to work well with EMMA and JaCoCo.,0,0
Replication tests fail on CDC platforms without optional JSSE package,The replication code uses the javax.net.ServerSocketFactory class  which is not part of the core API defined by Foundation Profile 1.1. It is however part of an optional security package (JSSE) defined by the same specification  so it may or may not be available on the CDC platforms that Derby runs on.Running the replication tests on phoneME without said optional package  results in NoClassDefFoundError:Caused by: java.lang.NoClassDefFoundError: javax.net.SocketFactory at org.apache.derby.impl.store.replication.net.ReplicationMessageTransmit$1.run(Unknown Source) at java.security.AccessController.doPrivileged(Unknown Source) at java.security.AccessController.doPrivileged(Unknown Source) at org.apache.derby.impl.store.replication.net.ReplicationMessageTransmit.initConnection(Unknown Source) at org.apache.derby.impl.store.replication.master.MasterController.setupConnection(Unknown Source) at org.apache.derby.impl.store.replication.master.MasterController.startMaster(Unknown Source) at org.apache.derby.impl.store.raw.RawStore.startReplicationMaster(Unknown Source) at org.apache.derby.impl.store.access.RAMAccessManager.startReplicationMaster(Unknown Source) at org.apache.derby.impl.db.BasicDatabase.startReplicationMaster(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleStartReplicationMaster(Unknown Source)We might fix this by rewriting the replication code so that it's not dependent on optional packages on CDC. However  there have not been any user requests for this functionality on platforms without that package  as far as I'm aware  so I suggest we just skip the replication tests for now if that package is missing.The tests I've run on Oracle Java Micro Edition Embedded Client 1.1 (OJEC) have not revealed this problem  as OJEC comes with the optional JSSE package (it's version output lists 'JSSE JSR219' under the components section). And since the reports from the weme 6.2 test runs don't show this failure  I think it's included there as well.,0,0
ErrorMessageTest assert failure: Only one of the waiters should be aborted,I occasionally see this test failure on some ARM devices:junit.framework.AssertionFailedError: Only one of the waiters should be aborted at org.apache.derbyTesting.functionTests.tests.lang.ErrorMessageTest.testDeadlockTimeout(ErrorMessageTest.java:206) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:424) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:441) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)It's probably timing-dependent  since the failing test case runs two threads  and the devices where it's seen are slow compared to most other test servers.,0,0
NullPointerException in INSERT INTO ... SELECT FROM ... ORDER BY,A NullPointerException was reported by Harm-Jan Zwinderman on derby-user:http://mail-archives.apache.org/mod_mbox/db-derby-user/201211.mbox/%3C50B66527.5040906%40gmail.com%3EI've managed to reproduce it on 10.9.1.0 like this:ij version 10.9ij&gt; connect 'jdbc:derby:memory:db;create=true';ij&gt; create table t(x double);0 rows inserted/updated/deletedij&gt; insert into t values (0);1 row inserted/updated/deletedij&gt; prepare ps as 'insert into t select 1 from t order by x';ij&gt; execute ps;1 row inserted/updated/deletedij&gt; execute ps;2 rows inserted/updated/deletedij&gt; execute ps;4 rows inserted/updated/deletedij&gt; execute ps;ERROR XJ001: Java exception: ': java.lang.NullPointerException'.Full stack trace:java.lang.NullPointerException at org.apache.derby.impl.store.access.conglomerate.ConglomerateUtil.createFormatIds(Unknown Source) at org.apache.derby.impl.store.access.heap.Heap.create(Unknown Source) at org.apache.derby.impl.store.access.heap.HeapConglomerateFactory.createConglomerate(Unknown Source) at org.apache.derby.impl.store.access.RAMTransaction.createConglomerate(Unknown Source) at org.apache.derby.impl.sql.execute.TemporaryRowHolderImpl.insert(Unknown Source) at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(Unknown Source) at org.apache.derby.impl.sql.execute.InsertResultSet.open(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(Unknown Source) at org.apache.derby.impl.tools.ij.ij.ExecuteStatement(Unknown Source) at org.apache.derby.impl.tools.ij.ij.ijStatement(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source) at org.apache.derby.impl.tools.ij.Main.main(Unknown Source) at org.apache.derby.tools.ij.main(Unknown Source) at org.apache.derby.iapi.tools.run.main(Unknown Source),0,0
IN lists with mixed types may return wrong results,Given this table:ij&gt; connect 'jdbc:derby:memory:db;create=true';ij&gt; create table t(x bigint);0 rows inserted/updated/deletedij&gt; insert into t values 9223372036854775805  9223372036854775806  9223372036854775807;3 rows inserted/updated/deletedA query that uses an IN list that contains all the three values actually stored in the table  returns all three rows as expected:ij&gt; select * from t where x in (9223372036854775805  9223372036854775806  9223372036854775807);X --------------------9223372036854775805 9223372036854775806 9223372036854775807 3 rows selectedHowever  if we add a value whose type precedence is higher  like a DOUBLE value  and that value happens to be equal to the approximation of the other values in the IN list when they are cast from BIGINT to DOUBLE  only one row is returned:ij&gt; select * from t where x in (9223372036854775805  9223372036854775806  9223372036854775807  9.223372036854776E18);X --------------------9223372036854775805 1 row selectedI believe this query should return all three rows too.,0,0
Lift the arbitrary limit on the number of routine parameters.,The number of parameters to a Derby routine is arbitrarily limited to 90. This limit is causing difficulties for users (see http://apache-database.10148.n7.nabble.com/number-of-parameters-td126108.html). It ought to be safe to lift this limit. Changes need to be made to CreateAliasNode and to the corresponding dbManagerLimits.testMostParametersInStoredProcedures() test.,0,0
in list multi-probe by primary key not chosen on tables with >256 rows,I have a table with a long integer primary key field and 11 million rows. I seem to be unable to load large chunks of rows via id in a reasonably efficient manner. 1. If I do individual lookups via the primary key  then a fast indexed lookup occurs. However  if I do large numbers of such queries  then the time is overwhelmed by round-trip overhead which makes everything incredibly slow. 2. If I use a single query with a disjunction of the primary keys of interest  then a table scan is performed (even if the clause only contains 1-3 items)  which walks over 11 million rows...incredibly inefficient. 3. If I use an IN clause  then a table scan is performed (even if the clause only contains 1-3 items)  which walks over 11 million rows...incredibly inefficient.I'm guessing that this might have something to do with the fact that I'm using large integers and really big numbers that don't start anywhere at or about 1 for my keys. Could this possibly be confusing the optimizer?Here are the unlimited query plans for the 3 cases that I enumerated:*********************************************************************************************&#91;EL Fine&#93;: 2013-01-17 11:09:53.384-ServerSession(582235416)Connection(1430986883)Thread(Thread&#91;&quot;Initial Lisp Listener&quot; 5 SubL Thread Group&#93;)-SELECT TERM_ID  ARG0  ARG1  ARG2  ARG3  FORMULA_HASH  FORMULA_LENGTH  FORMULA_TYPE  KB_STATUS FROM KB.FORMULA_TERM WHERE (TERM_ID = ?) bind =&gt; &#91;2251799814033500&#93;Thu Jan 17 11:09:53 CST 2013 Thread&#91;&quot;Initial Lisp Listener&quot; 5 SubL Thread Group&#93; (XID = 4711079)  (SESSIONID = 3)  SELECT TERM_ID  ARG0  ARG1  ARG2  ARG3  FORMULA_HASH  FORMULA_LENGTH  FORMULA_TYPE  KB_STATUS FROM KB.FORMULA_TERM WHERE (TERM_ID = ?) ******* Project-Restrict ResultSet (3):Number of opens = 1Rows seen = 1Rows filtered = 0restriction = falseprojection = true constructor time (milliseconds) = 0 open time (milliseconds) = 0 next time (milliseconds) = 0 close time (milliseconds) = 0 restriction time (milliseconds) = 0 projection time (milliseconds) = 0 optimizer estimated row count: 1.00 optimizer estimated cost: 6.59Source result set: Index Row to Base Row ResultSet for FORMULA_TERM: Number of opens = 1 Rows seen = 1 Columns accessed from heap = {1  2  3  4  5  6  7  8} constructor time (milliseconds) = 0 open time (milliseconds) = 0 next time (milliseconds) = 0 close time (milliseconds) = 0 optimizer estimated row count: 1.00 optimizer estimated cost: 6.59 Index Scan ResultSet for FORMULA_TERM using constraint KB_FORMULA_TERM_TERM_ID_PK at read committed isolation level using share row locking chosen by the optimizer Number of opens = 1 Rows seen = 1 Rows filtered = 0 Fetch Size = 1 constructor time (milliseconds) = 0 open time (milliseconds) = 0 next time (milliseconds) = 0 close time (milliseconds) = 0 next time in milliseconds/row = 0 scan information: Bit set of columns fetched=All Number of columns fetched=2 Number of deleted rows visited=0 Number of pages visited=3 Number of rows qualified=1 Number of rows visited=1 Scan type=btree Tree height=-1 start position: &gt;= on first 1 column(s). Ordered null semantics on the following columns:  stop position: &gt; on first 1 column(s). Ordered null semantics on the following columns:  qualifiers: None optimizer estimated row count: 1.00 optimizer estimated cost: 6.59&#91;EL Fine&#93;: 2013-01-17 11:01:00.732-ServerSession(1237006689)Connection(927179828)Thread(Thread&#91;&quot;Initial Lisp Listener&quot; 5 SubL Thread Group&#93;)-SELECT TERM_ID  ARG0  ARG1  ARG2  ARG3  FORMULA_HASH  FORMULA_LENGTH  FORMULA_TYPE  KB_STATUS FROM KB.FORMULA_TERM WHERE (((TERM_ID = ?) OR (TERM_ID = ?)) OR (TERM_ID = ?)) bind =&gt; &#91;2251799814033500  2251799814033501  2251799814033499&#93;Thu Jan 17 11:01:10 CST 2013 Thread&#91;&quot;Initial Lisp Listener&quot; 5 SubL Thread Group&#93; (XID = 4711078)  (SESSIONID = 3)  SELECT TERM_ID  ARG0  ARG1  ARG2  ARG3  FORMULA_HASH  FORMULA_LENGTH  FORMULA_TYPE  KB_STATUS FROM KB.FORMULA_TERM WHERE (((TERM_ID = ?) OR (TERM_ID = ?)) OR (TERM_ID = ?)) ******* Project-Restrict ResultSet (3):Number of opens = 1Rows seen = 3Rows filtered = 0restriction = falseprojection = true constructor time (milliseconds) = 0 open time (milliseconds) = 0 next time (milliseconds) = 0 close time (milliseconds) = 0 restriction time (milliseconds) = 0 projection time (milliseconds) = 0 optimizer estimated row count: 1176730.30 optimizer estimated cost: 5931065.54Source result set: Project-Restrict ResultSet (2): Number of opens = 1 Rows seen = 11767298 Rows filtered = 11767295 restriction = true projection = false constructor time (milliseconds) = 0 open time (milliseconds) = 0 next time (milliseconds) = 0 close time (milliseconds) = 0 restriction time (milliseconds) = 0 projection time (milliseconds) = 0 optimizer estimated row count: 1176730.30 optimizer estimated cost: 5931065.54 Source result set: Table Scan ResultSet for FORMULA_TERM at read committed isolation level using instantaneous share row locking chosen by the optimizer Number of opens = 1 Rows seen = 11767298 Rows filtered = 0 Fetch Size = 16 constructor time (milliseconds) = 0 open time (milliseconds) = 0 next time (milliseconds) = 0 close time (milliseconds) = 0 next time in milliseconds/row = 0 scan information: Bit set of columns fetched=All Number of columns fetched=9 Number of pages visited=34358 Number of rows qualified=11767298 Number of rows visited=11767298 Scan type=heap start position: null stop position: null qualifiers: None optimizer estimated row count: 1176730.30 optimizer estimated cost: 5931065.54&#91;EL Fine&#93;: 2013-01-17 11:27:00.627-ServerSession(1237006689)Connection(1688096771)Thread(Thread&#91;&quot;Initial Lisp Listener&quot; 5 SubL Thread Group&#93;)-SELECT TERM_ID  ARG0  ARG1  ARG2  ARG3  FORMULA_HASH  FORMULA_LENGTH  FORMULA_TYPE  KB_STATUS FROM KB.FORMULA_TERM WHERE (TERM_ID IN (? ? ?)) bind =&gt; &#91;2251799814033500  2251799814033501  2251799814033499&#93;Thu Jan 17 11:47:26 CST 2013 Thread&#91;&quot;Initial Lisp Listener&quot; 5 SubL Thread Group&#93; (XID = 4711080)  (SESSIONID = 3)  SELECT TERM_ID  ARG0  ARG1  ARG2  ARG3  FORMULA_HASH  FORMULA_LENGTH  FORMULA_TYPE  KB_STATUS FROM KB.FORMULA_TERM WHERE (TERM_ID IN (? ? ?)) ******* Project-Restrict ResultSet (3):Number of opens = 1Rows seen = 3Rows filtered = 0restriction = falseprojection = true constructor time (milliseconds) = 0 open time (milliseconds) = 0 next time (milliseconds) = 0 close time (milliseconds) = 0 restriction time (milliseconds) = 0 projection time (milliseconds) = 0 optimizer estimated row count: 1176730.30 optimizer estimated cost: 5931065.54Source result set: Project-Restrict ResultSet (2): Number of opens = 1 Rows seen = 11767298 Rows filtered = 11767295 restriction = true projection = false constructor time (milliseconds) = 0 open time (milliseconds) = 0 next time (milliseconds) = 0 close time (milliseconds) = 0 restriction time (milliseconds) = 0 projection time (milliseconds) = 0 optimizer estimated row count: 1176730.30 optimizer estimated cost: 5931065.54 Source result set: Table Scan ResultSet for FORMULA_TERM at read committed isolation level using instantaneous share row locking chosen by the optimizer Number of opens = 1 Rows seen = 11767298 Rows filtered = 0 Fetch Size = 16 constructor time (milliseconds) = 0 open time (milliseconds) = 0 next time (milliseconds) = 0 close time (milliseconds) = 0 next time in milliseconds/row = 0 scan information: Bit set of columns fetched=All Number of columns fetched=9 Number of pages visited=34358 Number of rows qualified=11767298 Number of rows visited=11767298 Scan type=heap start position: null stop position: null qualifiers: None optimizer estimated row count: 1176730.30 optimizer estimated cost: 5931065.54,0,1
Failures in upgradeTests.Changes10_9 related to index cardinality statistics,The upgrade test fails when run with 10.8.3. The reason is that a fix has been backported to 10.8.3  and older branches back to 10.3  and this fix invalidates assumptions made in some of the tests in Changes10_9.Example of failures:https://builds.apache.org/job/Derby-10.9-suites.All/60/testReport/As a side note  I'm wondering if we don't have good enough routines to make sure we run the upgrade tests with maintenance releases on older branches before releasing them. I don't know if we can avoid this situation in general  that would at least require very careful consideration on how to write the upgrade test.,0,0
100's of errors in nightly test run on weme after jacoco property/priviledges checkin,100's of errors in nightly test  all seem to be a null pointer while processing policy files during setup. problem is in jvm code  and it seems specific to the weme6.2 jvm.The only change being tested in this run was  For instance:330) testAll(org.apache.derbyTesting.functionTests.tests.lang.NativeAuthenticationServiceTest)java.lang.NullPointerException at com.ibm.oti.util.DefaultPolicy.addGrant(DefaultPolicy.java:619) at com.ibm.oti.util.DefaultPolicy.readPolicy(DefaultPolicy.java:608) at com.ibm.oti.util.DefaultPolicy.getSystemPolicy(DefaultPolicy.java:922) at com.ibm.oti.util.DefaultPolicy.getPermissionsImpl(DefaultPolicy.java:114) at com.ibm.oti.util.DefaultPolicy$1.run(DefaultPolicy.java:67) at java.security.AccessController.doPrivileged(AccessController.java:204) at com.ibm.oti.util.DefaultPolicy.privateGetPermissions(DefaultPolicy.java:65) at com.ibm.oti.util.DefaultPolicy.getPermissions(DefaultPolicy.java:53) at java.security.Policy.getPermissions(Policy.java:131) at java.security.ProtectionDomain.implies(ProtectionDomain.java:177) at java.security.AccessController.checkPermission(AccessController.java:99) at java.lang.SecurityManager.checkPermission(SecurityManager.java:534) at java.lang.SecurityManager.checkPropertyAccess(SecurityManager.java:331) at java.lang.System.getProperty(System.java:384) at java.lang.System.getProperty(System.java:366) at org.apache.derbyTesting.junit.BaseTestCase$3.run(BaseTestCase.java:292) at java.security.AccessController.doPrivileged(AccessController.java:204) at org.apache.derbyTesting.junit.BaseTestCase.getSystemProperty(BaseTestCase.java:288) at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDatabase(DropDatabaseSetup.java:86) at org.apache.derbyTesting.junit.TestConfiguration$5.tearDown(TestConfiguration.java:868) at junit.extensions.TestSetup$1.protect(TestSetup.java:22) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)Here is link to all errors:http://people.apache.org/~myrnavl/derby_test_results/main/windows/testlog/weme6.2/1447575-suites.All_diff.txthttp://people.apache.org/~myrnavl/derby_test_results/main/windows/testlog/weme6.2/1447575-derbyall_diff.txt,0,0
Package javadoc publishedapi/jdbc4/index.html out of date,Quote: ' Derby runs on any J2SE 1.4.2 or higher virtual machine and supports Java ME/CDC/Foundation. Derby's database format is platform independent allowing databases to be copied to any machine type. 'I think we have dropped 1.4.2  so we could omit that  but also include JDK 8 Profile 2 here  since we do mention CDC.,0,0
testPositionAgressive(org.apache.derbyTesting.functionTests.tests.jdbcapi.BlobClob4BlobTest)j fails with : 'The handle is invalid.: java.io.IOException'.,There was 1 error:http://people.apache.org/~myrnavl/derby_test_results/main/windows/testlog/ibm15/1449432-suites.All_diff.txt1) testPositionAgressive(org.apache.derbyTesting.functionTests.tests.jdbcapi.BlobClob4BlobTest)java.sql.SQLException: Java exception: 'The handle is invalid.: java.io.IOException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.clearLOBMapping(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.commit(Unknown Source) at org.apache.derbyTesting.junit.BaseJDBCTestCase.commit(BaseJDBCTestCase.java:393) at org.apache.derbyTesting.functionTests.tests.jdbcapi.BlobClob4BlobTest.testPositionAgressive(BlobClob4BlobTest.java:1070) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:79) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:424) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:441) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)Caused by: java.io.IOException: The handle is invalid. at java.io.RandomAccessFile.close0(Native Method) at java.io.RandomAccessFile.close(RandomAccessFile.java:573) at org.apache.derby.impl.jdbc.LOBFile.close(Unknown Source) at org.apache.derby.impl.jdbc.EncryptedLOBFile.close(Unknown Source) ... 53 more,0,0
Upgrade tests fail on compact2,The upgrade tests fail on the compact2 profile because they use data sources to create databases with old Derby versions  and to shut down the old engines after the test. The data sources in Derby versions before 10.10 require JNDI to be present. Since JNDI is not present on compact2  the attempts to obtain data sources fail:1) 10.0.2.1 Upgrade Phase: CREATE java.lang.NoClassDefFoundError: javax/naming/Referenceable at java.lang.ClassLoader.defineClass1(Native Method) at java.lang.ClassLoader.defineClass(Unknown Source) at java.security.SecureClassLoader.defineClass(Unknown Source) at java.net.URLClassLoader.defineClass(Unknown Source) at java.net.URLClassLoader.access$100(Unknown Source) at java.net.URLClassLoader$1.run(Unknown Source) at java.net.URLClassLoader$1.run(Unknown Source) at java.security.AccessController.doPrivileged(Native Method) at java.net.URLClassLoader.findClass(Unknown Source) at java.lang.ClassLoader.loadClass(Unknown Source) at java.lang.ClassLoader.loadClass(Unknown Source) at java.lang.ClassLoader.defineClass1(Native Method) at java.lang.ClassLoader.defineClass(Unknown Source) at java.security.SecureClassLoader.defineClass(Unknown Source) at java.net.URLClassLoader.defineClass(Unknown Source) at java.net.URLClassLoader.access$100(Unknown Source) at java.net.URLClassLoader$1.run(Unknown Source) at java.net.URLClassLoader$1.run(Unknown Source) at java.security.AccessController.doPrivileged(Native Method) at java.net.URLClassLoader.findClass(Unknown Source) at java.lang.ClassLoader.loadClass(Unknown Source) at java.lang.ClassLoader.loadClass(Unknown Source) at java.lang.ClassLoader.loadClass(Unknown Source) at java.lang.Class.forName0(Native Method) at java.lang.Class.forName(Unknown Source) at org.apache.derbyTesting.junit.JDBCDataSource.getDataSourceObject(JDBCDataSource.java:162) at org.apache.derbyTesting.junit.JDBCDataSource.getDataSource(JDBCDataSource.java:108) at org.apache.derbyTesting.junit.JDBCDataSource.getDataSource(JDBCDataSource.java:93) at org.apache.derbyTesting.junit.JDBCDataSource.getDataSource(JDBCDataSource.java:47) at org.apache.derbyTesting.functionTests.tests.upgradeTests.PhaseChanger.setUp(PhaseChanger.java:93) at junit.extensions.TestSetup$1.protect(TestSetup.java:20) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)Caused by: java.lang.ClassNotFoundException: javax.naming.Referenceable at java.net.URLClassLoader$1.run(Unknown Source) at java.net.URLClassLoader$1.run(Unknown Source) at java.security.AccessController.doPrivileged(Native Method) at java.net.URLClassLoader.findClass(Unknown Source) at java.lang.ClassLoader.loadClass(Unknown Source) at java.lang.ClassLoader.loadClass(Unknown Source) ... 107 more,0,0
Investigate why setting a login timeout causes NativeAuthenticationServiceTest to fail when run in a suite,See DERBY-6094 for the details of this problem.,1,0
SSL Test (and network server )  can hang if serverSocket.accept() fails for something other than an IOException,In starting a server with SSL as in SSLTest if serverSocket.accept() fails for some reason other than an IOException it may just print the error to console and hang. In this case it was:java.security.AccessControlException: Access denied (java.util.PropertyPermissionI saw this when debugging a java issue in serverSocket.accept() but I think it could be simulated by adding an unwrapped System.getProperty() of some sort before serverSocket.accept() to force a permission error. e.g.  System.getProperty('derby.system.home'); return serverSocket.accept(); } catch (IOException acceptE) {I have not verified that would work.,1,1
Marshalling error in JDBCDriverTest as part of CompatibilityTest,Internal Oracle testing of RC 2 testing of 10.10 (Tendril Request 5574239 Tendril Task 3614491 ):                 Diff file derbyall/derbynetclientmats/DerbyNetClient/encodingTests/TestEnc.diff             Start: TestEnc jdk1.7.0 DerbyNetClient derbynetclientmats:encodingTests 2013-03-21 14:55:59 ***derbyTesting.encoding can only be used with jdk15  skipping test End: TestEnc jdk1.7.0 DerbyNetClient derbynetclientmats:encodingTests 2013-03-21 14:55:59 ***            Diff file derbyall/derbynetclientmats/DerbyNetClient/derbynetclientmats/CompatibilityTest.diff             Start: CompatibilityTest jdk1.7.0 DerbyNetClient derbynetclientmats:derbynetclientmats 2013-03-21 14:55:59 ***0 add&gt; .E.&gt; There was 1 error:&gt; 1) testJDBCDriver(org.apache.derbyTesting.functionTests.tests.junitTests.compatibility.JDBCDriverTest)java.sql.SQLException: Error marshalling or unmarshalling a user defined type: org.apache.derbyTesting.functionTests.tests.lang.Price; local class incompatible: stream classdesc serialVersionUID = 102726277789621992  local class serialVersionUID = 1827170030595550895&gt; Caused by: org.apache.derby.client.am.SqlException: Error marshalling or unmarshalling a user defined type: org.apache.derbyTesting.functionTests.tests.lang.Price; local class incompatible: stream classdesc serialVersionUID = 102726277789621992  local class serialVersionUID = 1827170030595550895&gt; ... 22 more&gt; Caused by: java.io.InvalidClassException: org.apache.derbyTesting.functionTests.tests.lang.Price; local class incompatible: stream classdesc serialVersionUID = 102726277789621992  local class serialVersionUID = 1827170030595550895&gt; ... 25 more&gt; FAILURES!!!&gt; Tests run: 2  Failures: 0  Errors: 1Test Failed. End: CompatibilityTest jdk1.7.0 DerbyNetClient derbynetclientmats:derbynetclientmats 2013-03-21 14:56:04 ***    Looking at the Price class I see it doesn't have an explicit serialVersionUID.,0,0
select from view with 'upper' and 'in' list throws a ClassCastException,the issue can be reproduced1. create table myTbl1 (name varchar(1000));2. create table myTbl2 (name varchar(1000));3. create view myView (name) as select t1.name from myTbl1 t1 union all select t2.name from myTbl2 t2;4. select name from myView where upper(name) in ('AA'  'BB');#4 failed with 'org.apache.derby.impl.sql.compile.SimpleStringOperatorNode incompatible with org.apache.derby.impl.sql.compile.ColumnReference: java.lang.ClassCastException'If the view is created as 'create myView (name) as select t1.name from myTbl1 t1'  the query worked fine.,0,0
nightly regression test failure  intermittent error : testStatisticsCorrectness(org.apache.derbyTesting.functionTests.tests.store.AutomaticIndexStatisticsTest)junit.framework.AssertionFailedError,failure in nightly regression test  candidate 10.10 branch  ibm17may be related to daylight savings time change  there were similar resolved bugs that were marked fixed so reporting new one in case this is different.http://people.apache.org/~myrnavl/derby_test_results/v10_10/windows/testlog/ibm17/1461391-suites.All_diff.txtThere was 1 failure:1) testStatisticsCorrectness(org.apache.derbyTesting.functionTests.tests.store.AutomaticIndexStatisticsTest)junit.framework.AssertionFailedError at org.apache.derbyTesting.functionTests.tests.store.AutomaticIndexStatisticsTest.testStatisticsCorrectness(AutomaticIndexStatisticsTest.java:332) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:88) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:55) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:424) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:441) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57),0,0
nightly regression test failure: testMultipleLastKeyWaitsInMaxScan(org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest)junit.framework.AssertionFailedError: Column value mismatch @ column '1',http://people.apache.org/~myrnavl/derby_test_results/v10_8/windows/testlog/ibm16/1461387-suites.All_diff.txt1) testMultipleLastKeyWaitsInMaxScan(org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest)junit.framework.AssertionFailedError: Column value mismatch @ column '1'  row 1: Expected: &gt;4&lt; Found: &gt;3&lt; at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1213) at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1125) at org.apache.derbyTesting.junit.JDBC.assertFullResultSetMinion(JDBC.java:1012) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:935) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:892) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:850) at org.apache.derbyTesting.junit.JDBC.assertSingleValueResultSet(JDBC.java:835) at org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest.testMultipleLastKeyWaitsInMaxScan(IndexSplitDeadlockTest.java:657) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:110) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)FAILURES!!!Tests run: 15197  Failures: 1  Errors: 0,0,0
Add automatic cleanup of connections opened with openDefaultConnection(),In JDBCBaseTestCase  the default connection is automatically rolled back and closed but connections opened with openDefaultConnection() can stay open and hold locks and affect other tests if the database can not be cleaned because locks are held. It would be good to clean up all the connections in tearDown().,0,1
Derby does not report warnings raised by table functions,If a table function raises warnings as the user loops through ResultSet.next()  those warnings are silently thrown away by Derby. Derby should return those warnings when the user calls ResultSet.getWarnings().,0,0
Simplify code that handles LOB files,When investigating DERBY-6092  I found some code that could be simplified/cleaned up. Will make those changes here.,1,0
Interrupt restarts clock for login timeout,If a login takes time  and the thread that's blocked in Driver20.timeLogin() is interrupted  it will call Future.get() again with the same timeout value. This means that interrupting a getConnection() call will not make it terminate faster  as one might expect. Instead  it restarts the timeout clock and makes it terminate later than if it had not been interrupted.,0,0
Clean up registered format ids,RegisteredFormatIds and StoredFormatIds contain identifiers for classes that implement the Formatable interfaces and are used when serializing/deserializing instances of those classes.Many of the classes referenced there do however not implement Formatable. The references to them could be removed. I've seen that many classes in the impl.sql.execute.rts package are there  none of which implement Formatable. There may be more.,0,0
AutoloadTest does not proprogate original jvm -D flags to spawned JVM  leading to LAB regression test failures,IBM lab nightly regression testing is seeing numerious intermittent errors while running theAutoloadTest. This regression testing often runs multiple runs of Suites.all on the same machine atthe same time and uses the -Dderby.tests.basePort=3500 option to the tests to insure networkserver is created on different ports and don't intefere.I think the following code in this test that spawn a process is not going pass that port info onto the networkserver startup and then lead to problems: /** Run {@code AutoloadTest} in a separate JVM. */ public void spawnProcess() throws Exception { String[] cmd = { 'junit.textui.TestRunner'  spawnedTestClass.getName() }; SpawnedProcess proc = new SpawnedProcess(execJavaCmd(cmd)  spawnedTestClass.getName()); if (proc.complete() != 0) { fail(proc.getFailMessage('Test process failed')); } },0,0
Cleanup suspect coding practices in org.apache.derby.iapi.error package,Similar to DERBY-6177.,0,0
Query against view  with 'where name LIKE 'Col1' ESCAPE '/' ' failed,The error can be reproduced 1) create table mytbl1 (name clob(10K));2) create table mytbl2 (name clob(10K));3) create view myview (name) as select t1.name from mytbl1 t1 union all select t2.name from mytbl2 t2;4) select name from myview where name LIKE 'Col1' ESCAPE '/';'4)' failed with error message 'ERROR 42818: Comparisons between 'CLOB (UCS_BASIC)' and 'CHAR (UCS_BASIC)' are not supported. Types must be comparable. String types must also have matching collation. If collation does not match  a possible solution is to cast operands to force them to the default collation (e.g. SELECT tablename FROM sys.systables WHERE CAST(tablename AS VARCHAR(128)) = 'T1') at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.impl.sql.compile.BinaryComparisonOperatorNode.bindComparisonOperator(Unknown Source) at org.apache.derby.impl.sql.compile.PredicateList.pushExpressionsIntoSelect(Unknown Source) at org.apache.derby.impl.sql.compile.UnionNode.pushExpressions(Unknown Source) at org.apache.derby.impl.sql.compile.UnionNode.pushExpressions(Unknown Source) at org.apache.derby.impl.sql.compile.ProjectRestrictNode.pushExpressions(Unknown Source) at org.apache.derby.impl.sql.compile.FromList.pushPredicates(Unknown Source) at org.apache.derby.impl.sql.compile.SelectNode.preprocess(Unknown Source) at org.apache.derby.impl.sql.compile.DMLStatementNode.optimizeStatement(Unknown Source) at org.apache.derby.impl.sql.compile.CursorNode.optimizeStatement(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source) ... 19 more,0,0
Cleanup suspect coding practices in org.apache.derby.iapi.services.io package,Similar to DERBY-6177.,0,0
Cleanup suspect coding practices in the org.apache.derby.impl.tools.planexporter package,Similar to DERBY-6177.,0,0
Cleanup suspect coding practices in the org.apache.derby.iapi.types package,Similar to DERBY-6177.,0,0
Cleanup suspect coding practices in the org.apache.derby.iapi.sql.dictionary package,Similar to DERBY-6177.,0,0
Cleanup suspect coding practices in misc Derby packages,Similar to DERBY-6177.,0,0
Make Optimizer trace logic pluggable.,Right now the trace logic in the optimizer is hard-coded to produce a stream of diagnostics. It would be good to be able to plug alternative trace logic into the optimizer. This would make the following possible:1) Plug in trace logic which produces formats which are easier to study and which can be analyzed mechanically. E.g.  xml formatted output.2) Plug in trace logic which can be used during unit testing to verify that the optimizer has picked the right plan. Over time this might make it easier to migrate canon-based tests to assertion-based tests.,0,0
NullPointerException when calling a procedure with sub-query as argument,ij version 10.10ij&gt; connect 'jdbc:derby:memory:db;create=true';ij&gt; call syscs_util.syscs_set_database_property('abc'  (values 'def'));ERROR XJ001: Java exception: ': java.lang.NullPointerException'. (errorCode = 0)The query should either compile and execute just fine  or it should raise a proper exception. It should not fail with a NullPointerException.,0,0
Issues with latest JDK 8 EA build because of missing SQLPermission,With the latest EA build of JDK 8 (build 1.8.0-ea-b89)  I see many failures in suites.All. For example:1) testStartNetworkServerFalse(org.apache.derbyTesting.functionTests.tests.derbynet.DerbyNetAutoStartTest)java.security.AccessControlException: access denied ('java.sql.SQLPermission' 'deregisterDriver') at java.security.AccessControlContext.checkPermission(AccessControlContext.java:364) at java.security.AccessController.checkPermission(AccessController.java:562) at java.lang.SecurityManager.checkPermission(SecurityManager.java:549) at java.sql.DriverManager.deregisterDriver(DriverManager.java:399) at org.apache.derby.jdbc.AutoloadedDriver.unregisterDriverModule(AutoloadedDriver.java:263) at org.apache.derby.jdbc.Driver20.stop(Driver20.java:105) at org.apache.derby.impl.services.monitor.TopService.stop(TopService.java:443) at org.apache.derby.impl.services.monitor.TopService.shutdown(TopService.java:394) at org.apache.derby.impl.services.monitor.BaseMonitor.shutdown(BaseMonitor.java:227) at org.apache.derby.impl.services.monitor.FileMonitor.shutdown(FileMonitor.java:44) at org.apache.derby.impl.services.monitor.BaseMonitor.shutdown(BaseMonitor.java:197) at org.apache.derby.impl.services.monitor.FileMonitor.shutdown(FileMonitor.java:44) at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:255) at org.apache.derby.jdbc.Driver20.connect(Driver20.java:246) at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:145) at java.sql.DriverManager.getConnection(DriverManager.java:661) at java.sql.DriverManager.getConnection(DriverManager.java:208) at org.apache.derbyTesting.junit.DriverManagerConnector.getConnectionByAttributes(DriverManagerConnector.java:204) at org.apache.derbyTesting.junit.DriverManagerConnector.shutEngine(DriverManagerConnector.java:171) at org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1822) at org.apache.derbyTesting.functionTests.tests.derbynet.DerbyNetAutoStartTest.setUp(DerbyNetAutoStartTest.java:82) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456)What's new in EA build 89 is that DriverManager.deregisterDriver() now requires an SQLPermission when running under a security manager. Most of suites.All runs under a security manager  and Derby's engine shutdown code calls deregisterDriver()  so this problem probably affects all tests that shut down the engine.,1,0
SecureServerTest assertion error on contents of stdout from subprocess,,1,0
Use the JVM's cache of Number instances in ReuseFactory,ReuseFactory has a cache of Byte  Short  Integer and Long instances to avoid excessive allocation of such instances.As of Java 5  the JVM has a cache of its own  available through static valueOf() methods in these classes.The JVM's cache is guaranteed to have at least all values in the range &#91;-128  127&#93;. ReuseFactory currently caches Integer instances in the range &#91;-1  18&#93; plus a few special values  and Byte  Short and Long instances in the range &#91;0  10&#93;.If we change ReuseFactory so that it uses the JVM's cache  the number of cache misses will be lower  and the code will become shorter.,0,1
Remove unnecessary checks for UnsupportedEncodingException in the client,Many methods in the client need handling of UnsupportedEncodingException  typically because they call String methods that take the name of the encoding as argument. Most of these methods have overloads that take a Charset instead of a String to describe the encoding  and those methods don't throw UnsupportedEncodingException as the encoding is known to be supported once we have a Charset instance for it. We should use the methods that take a Charset and simplify the exception handling.,0,0
XMLBindingTest fails on latest JDK 8 EA,java.sql.SQLDataException: Invalid XML Document: External DTD: Failed to read external DTD 'personal.dtd'  because 'file' access is not allowed. at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:79) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:148) at org.apache.derby.impl.jdbc.Util.seeNextException(Util.java:349) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:431) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2396) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:85) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1438) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1695) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(EmbedPreparedStatement.java:1379) at org.apache.derbyTesting.junit.XML.insertDocWithDTD(XML.java:240) at org.apache.derbyTesting.functionTests.tests.lang.XMLBindingTest$XBindTestSetup.setUp(XMLBindingTest.java:301) at junit.extensions.TestSetup$1.protect(TestSetup.java:22) at junit.extensions.TestSetup.run(TestSetup.java:27) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:23) at junit.extensions.TestSetup.run(TestSetup.java:27)Caused by: java.sql.SQLException: Invalid XML Document: External DTD: Failed to read external DTD 'personal.dtd'  because 'file' access is not allowed. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:42) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:126) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)Caused by: java.sql.SQLException: Java exception: 'External DTD: Failed to read external DTD 'personal.dtd'  because 'file' access is not allowed.: org.xml.sax.SAXException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:42) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:126) at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71) at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:148) at org.apache.derby.impl.jdbc.Util.javaException(Util.java:370) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:436) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:432)Caused by: org.xml.sax.SAXException: External DTD: Failed to read external DTD 'personal.dtd'  because 'file' access is not allowed.org.xml.sax.SAXParseException; lineNumber: 20; columnNumber: 119; External DTD: Failed to read external DTD 'personal.dtd'  because 'file' access is not allowed. at org.apache.derby.iapi.types.SqlXmlUtil$XMLErrorHandler.fatalError(SqlXmlUtil.java:767) at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.fatalError(ErrorHandlerWrapper.java:180) at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:441) at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:368) at com.sun.org.apache.xerces.internal.impl.XMLScanner.reportFatalError(XMLScanner.java:1388) at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$DTDDriver.dispatch(XMLDocumentScannerImpl.java:1158) at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$DTDDriver.next(XMLDocumentScannerImpl.java:1050) at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$PrologDriver.next(XMLDocumentScannerImpl.java:964) at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:606) at com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl.next(XMLNSDocumentScannerImpl.java:116) at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:509) at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:858) at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:787) at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:123) at com.sun.org.apache.xerces.internal.parsers.DOMParser.parse(DOMParser.java:237) at com.sun.org.apache.xerces.internal.jaxp.DocumentBuilderImpl.parse(DocumentBuilderImpl.java:329) at org.apache.derby.iapi.types.SqlXmlUtil$1.run(SqlXmlUtil.java:320) at org.apache.derby.iapi.types.SqlXmlUtil$1.run(SqlXmlUtil.java:317) at java.security.AccessController.doPrivileged(Native Method) at org.apache.derby.iapi.types.SqlXmlUtil.serializeToString(SqlXmlUtil.java:315) at org.apache.derby.iapi.types.XML.XMLParse(XML.java:632) at org.apache.derby.exe.acbfcc1aadx013exeff7x4f4fx000077cfc4780.e0(Unknown Source) at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:101) at org.apache.derby.impl.sql.execute.RowResultSet.getNextRowCore(RowResultSet.java:148) at org.apache.derby.impl.sql.execute.NormalizeResultSet.getNextRowCore(NormalizeResultSet.java:185) at org.apache.derby.impl.sql.execute.DMLWriteResultSet.getNextRowCore(DMLWriteResultSet.java:128) at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:520) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:453) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:334) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1346)Caused by: org.xml.sax.SAXParseException; lineNumber: 20; columnNumber: 119; External DTD: Failed to read external DTD 'personal.dtd'  because 'file' access is not allowed. at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:203) at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.fatalError(ErrorHandlerWrapper.java:177),0,0
updatelocksJDBC30 test failing in nightly regression tests,updatelocksJDBC30 test failed intermittently in nightly regression tests  trunk  ibm16http://people.apache.org/~myrnavl/derby_test_results/main/windows/testlog/ibm16/1488447-derbyall_diff.txt                 Diff file derbyall/encryptionAll/storemats/storemats/updatelocksJDBC30.diff             Start: updatelocksJDBC30 jdk1.6.0 storemats:storemats 2013-05-31 19:48:20 ***15110d15109&lt; APP |UserTransaction|ROW |1 |U |A |(1 7) |GRANT|ACTIVE 15112a15112&gt; APP |UserTransaction|ROW |2 |U |A |(1 7) |GRANT|ACTIVE 15125d15124&lt; APP |UserTransaction|ROW |1 |U |A |(1 7) |GRANT|ACTIVE 15129a15129&gt; APP |UserTransaction|ROW |2 |U |A |(1 7) |GRANT|ACTIVE 15138d15137&lt; APP |UserTransaction|ROW |1 |U |A |(1 7) |GRANT|ACTIVE 15142a15142&gt; APP |UserTransaction|ROW |2 |U |A |(1 7) |GRANT|ACTIVE Test Failed. End: updatelocksJDBC30 jdk1.6.0 storemats:storemats 2013-05-31 19:48:32 ***,0,0
Add ability to print a Derby execution ResultSet as xml.,Add a method for printing an org.apache.derby.iapi.sql.ResultSet as xml. The idea is to get a quick snapshot of a plan shape without all of the overhead of PlanExporter and runtimestatistics. This method could be used by our tests to verify plan shapes.,0,0
Add ability to compactly specify a complete query plan in an optimizer override.,It would be nice to be able to override the optimizer's choice and specify a complete query plan using the compact summary syntax output by XMLOptTrace. Given how the optimizer handles a statement  this would require binding a query plan at the query block level. Two obvious candidates for such a feature are:1) Extend the use of DERBY-PROPERTIES in the comments of a query.2) Add an extra clause to query blocks. The clause would have to be a clearly marked Derby extension.(1) might look like this (here we add a new 'fullQueryPlan' property):select tablename from sys.systables t  sys.syscolumns c  sys.sysaliases awhere t.tablename = c.columnname and c.columnname = a.alias&#8211; DERBY-PROPERTIES fullQueryPlan = (SYSCOLUMNS_HEAP # SYSALIASES_INDEX1) # SYSTABLES_INDEX1union allselect tablename from sys.systables t  sys.syscolumns c  sys.sysaliases a  sys.syssequences swhere t.tablename = c.columnname and c.columnname = a.alias and a.alias = s.sequencename&#8211; DERBY-PROPERTIES fullQueryPlan = ((SYSCOLUMNS_HEAP # SYSTABLES_INDEX1) # SYSALIASES_INDEX1) # SYSSEQUENCES_INDEX2;(2) might look like this (here we add a new 'using derby join order' clause):select tablename from sys.systables t  sys.syscolumns c  sys.sysaliases awhere t.tablename = c.columnname and c.columnname = a.aliasusing derby join order (SYSCOLUMNS_HEAP # SYSALIASES_INDEX1) # SYSTABLES_INDEX1union allselect tablename from sys.systables t  sys.syscolumns c  sys.sysaliases a  sys.syssequences swhere t.tablename = c.columnname and c.columnname = a.alias and a.alias = s.sequencenameusing derby join order ((SYSCOLUMNS_HEAP # SYSTABLES_INDEX1) # SYSALIASES_INDEX1) # SYSSEQUENCES_INDEX2;Here's a comparison of these approaches:(1)+ Portability: the same query text can be used against different RDBMSes. Parsing of DERBY-PROPERTIES happens outside the grammer.(2)+ Parsing happens in the parser. Not portable.I slightly prefer approach (1). If I pursue that approach  I would like to see if I can move the parsing into the parser.I am interested in other opinions about how to address this feature. Thanks.,0,1
NullPointerException when using more than one parameter in COALESCE,Calls to COALESCE fail with NullPointerExceptions if there are multiple ? parameters:ij version 10.10ij&gt; connect 'jdbc:derby:memory:db;create=true';ij&gt; prepare ps as 'values coalesce(? ? 1)';ERROR XJ001: Java exception: ': java.lang.NullPointerException'. (errorCode = 0)java.lang.NullPointerException at org.apache.derby.impl.sql.compile.ParameterNode.generateExpression(Unknown Source) at org.apache.derby.impl.sql.compile.CoalesceFunctionNode.generateExpression(Unknown Source) at org.apache.derby.impl.sql.compile.ResultColumn.generateExpression(Unknown Source) at org.apache.derby.impl.sql.compile.ResultColumnList.generateCore(Unknown Source) at org.apache.derby.impl.sql.compile.ResultColumnList.generate(Unknown Source) at org.apache.derby.impl.sql.compile.RowResultSetNode.generate(Unknown Source) at org.apache.derby.impl.sql.compile.ScrollInsensitiveResultSetNode.generate(Unknown Source) at org.apache.derby.impl.sql.compile.CursorNode.generate(Unknown Source) at org.apache.derby.impl.sql.compile.StatementNode.generate(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.&lt;init&gt;(Unknown Source) at org.apache.derby.impl.jdbc.EmbedPreparedStatement40.&lt;init&gt;(Unknown Source) at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(Unknown Source) at org.apache.derby.impl.tools.ij.ij.PrepareStatement(Unknown Source) at org.apache.derby.impl.tools.ij.ij.ijStatement(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source) at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.go(Unknown Source) at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source) at org.apache.derby.impl.tools.ij.Main.main(Unknown Source) at org.apache.derby.tools.ij.main(Unknown Source),0,0
Use Arrays.copyOf() in FormatableArrayHolder.getArray(),FormatableArrayHolder.getArray() creates an array of the correct type using reflection and copies it manually. Java 6 introduced a copyOf() method in java.util.Arrays that could do all of this automatically. Now that Java 6 is the minimum level on trunk  we could take advantage of the library method and simplify the code.,0,0
Allow tests to show detailed error when spawning new process fails,In recent versions of Java  Runtime.exec() will hide the underlying exception unless the code base is granted read permission on the executable file.Example:These two failures probably have the same cause:http://download.java.net/javadesktop/derby/javadb-5579292-report/javadb-task-3689381.htmlhttp://download.java.net/javadesktop/derby/javadb-5579170-report/javadb-task-3688261.htmlThe former  running on an older JVM  shows the real cause:java.io.IOException: Cannot run program '/localhome/tendril4.2/work/install/sun-jdk-7u10-fcs-bin-b31/jdk7_10/jdk1.7.0_10/jre/bin/java': error=12  Not enough spaceCaused by: java.io.IOException: error=12  Not enough spaceThe latter  running on a more recent JVM  hides the real failure behind an AccessControlException:java.io.IOException: Cannot run program '/localhome/tendril4.2/work/install/sun-jdk-8-ea-bin-b93/jdk8/jdk1.8.0/jre/bin/java'Caused by: java.security.AccessControlException: access denied ('java.io.FilePermission' '/localhome/tendril4.2/work/install/sun-jdk-8-ea-bin-b93/jdk8/jdk1.8.0/jre/bin/java' 'read')We should consider changing the following grant in derby_tests.policy to include 'read' in order to make it easier to see why a test is failing: // Tests need to be able to exec a java program. permission java.io.FilePermission '${java.home}${/}-'  'execute';,0,0
Simplify PropertyUtil using Properties.stringPropertyNames(),PropertyUtil should use Properties.stringPropertyNames() (new method in Java 6) instead of Properties.propertyNames() since a Set&lt;String&gt; view of the property names is easier to work with than an Enumeration&lt;?&gt;. The Set&lt;String&gt; view can be used with for-each loops and many of the helper methods in the standard library.,0,0
Intermittent failures in XplainStatisticsTest.testSimpleXplainOnly,XplainStatisticsTest.testSimpleXplainOnly fails intermittently.Examples:http://download.java.net/javadesktop/derby/javadb-5579342-report/javadb-task-3689858.html junit.framework.AssertionFailedError: Column value mismatch @ column '1'  row 1: Expected: &gt;1&lt; Found: &gt;2&lt; at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1278) at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1190) at org.apache.derbyTesting.junit.JDBC.assertFullResultSetMinion(JDBC.java:1077) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:1000) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:957) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:915) at org.apache.derbyTesting.junit.JDBC.assertSingleValueResultSet(JDBC.java:900) at org.apache.derbyTesting.functionTests.tests.lang.XplainStatisticsTest.testSimpleXplainOnly(XplainStatisticsTest.java:1148) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)http://download.java.net/javadesktop/derby/javadb-5579365-report/javadb-task-3690182.html junit.framework.AssertionFailedError: Column value mismatch @ column '1'  row 1: Expected: &gt;4&lt; Found: &gt;7&lt; at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1278) at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1190) at org.apache.derbyTesting.junit.JDBC.assertFullResultSetMinion(JDBC.java:1077) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:1000) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:957) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:915) at org.apache.derbyTesting.junit.JDBC.assertSingleValueResultSet(JDBC.java:900) at org.apache.derbyTesting.functionTests.tests.lang.XplainStatisticsTest.testSimpleXplainOnly(XplainStatisticsTest.java:1183) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57),0,0
XplainStatisticsTest.testSimpleQuery: BEGIN_COMP_TIME unexpectedly NULL,Seen on two platforms in nightly testing of trunk revision 1506904:http://download.java.net/javadesktop/derby/request_5579443/javadb-task-3691350.htmlhttp://download.java.net/javadesktop/derby/request_5579443/javadb-task-3691354.htmljunit.framework.AssertionFailedError: BEGIN_COMP_TIME unexpectedly NULL at org.apache.derbyTesting.functionTests.tests.lang.XplainStatisticsTest.getNonNullTimestamp(XplainStatisticsTest.java:1538) at org.apache.derbyTesting.functionTests.tests.lang.XplainStatisticsTest.verifySensibleStatementTimings(XplainStatisticsTest.java:1417) at org.apache.derbyTesting.functionTests.tests.lang.XplainStatisticsTest.testSimpleQuery(XplainStatisticsTest.java:1038) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57),0,0
Log a page dump to derby.log if ERROR nospc: nospc.U  is returned to the user,ERROR nospc: nospc.U should only be an internal error that is caught and handled. If returned to the user  it is likely a bug. It would be useful if this occurs to have a page dump printed to derby.log. Care should be taken to only do this if the error is returned to the user and not for the internal variety.,0,0
Fix incorrect @throws and @exception tags in javadoc,Many javadoc comments have @throws or @exception tags that either misspell the name of the exception class or name an exception that is not actually thrown from the method. We should fix those references.,0,0
DatabaseMetaData.getJDBCMinorVersion() should return 2 now that we've implemented JDBC 4.2,Now that the work on DERBY-6000 is done  DatabaseMetaData.getJDBCMinorVersion() should return 2 rather than 1. The following script shows that we're still returning 1:connect 'jdbc:derby:memory:db;create=true';call syscs_util.syscs_register_tool( 'databaseMetaData'  true );values getJDBCMajorVersion();values getJDBCMinorVersion();call syscs_util.syscs_register_tool( 'databaseMetaData'  false );,0,0
Simplify StringBuffer use  as they are mutable,code cleanup where code reasssigns StringBuffers for no reason. remove for easier code reading.,0,0
Remove Profile attribute from jar file manifests,DERBY-5955 added a Profile attribute to the jar file manifests. Starting with JDK 8 b105  the attribute has no effect and can be removed.See here: http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=8022921,0,0
failure in testConstraintDrops(org.apache.derbyTesting.functionTests.lang.ConglomerateSharingTest)junit.framework.AssertionFailedError: Error 23505 should have been caused by index/constraint...,Don't think this failure has been reported before.The url for failure is http://people.apache.org/~myrnavl/derby_test_results/v10_10/windows/testlog/weme6.2/1520721-suites.All_diff.txt1) testConstraintDrops(org.apache.derbyTesting.functionTests.tests.lang.ConglomerateSharingTest)junit.framework.AssertionFailedError: Error 23505 should have been caused by index/constraint 'DROPC_UIX2' but 'DROPC_UIX2' did not appear in the following error message: 'The statement was aborted because it would have caused a duplicate key value in a unique or primary key constraint or unique index identified by 'DROPC_UC1' defined on 'DROPC_T2'.' at org.apache.derbyTesting.functionTests.tests.lang.ConglomerateSharingTest.checkStatementError(ConglomerateSharingTest.java:762) at org.apache.derbyTesting.functionTests.tests.lang.ConglomerateSharingTest.testConstraintDrops(ConglomerateSharingTest.java:272) at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:195) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:442) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:459) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57),0,0
java.security.AccessControlException in i18n.LocalizedDisplayScriptTest,Seeing more test failures because of an intentional security change in TimeZone.setDefault(). Therefore need to wrap Timezone.setDefault in a priv block in the test. 5) LocalizedDisplay(org.apache.derbyTesting.functionTests.tests.i18n.LocalizedDisplayScriptTest)java.security.AccessControlException: Access denied ('java.util.PropertyPermission' 'user.timezone' 'write') at java.security.AccessController.throwACE(AccessController.java:100) at java.security.AccessController.checkPermission(AccessController.java:174) at java.lang.SecurityManager.checkPermission(SecurityManager.java:549) at java.util.TimeZone.hasPermission(TimeZone.java:756) at java.util.TimeZone.setDefault(TimeZone.java:778) at org.apache.derbyTesting.functionTests.tests.i18n.LocalizedDisplayScriptTest.setUp(LocalizedDisplayScriptTest.java:140) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)and:6) LocalizedDisplay(org.apache.derbyTesting.functionTests.tests.i18n.LocalizedDisplayScriptTest)java.security.AccessControlException: Access denied ('java.util.PropertyPermission' 'user.timezone' 'write') at java.security.AccessController.throwACE(AccessController.java:100) at java.security.AccessController.checkPermission(AccessController.java:174) at java.lang.SecurityManager.checkPermission(SecurityManager.java:549) at java.util.TimeZone.hasPermission(TimeZone.java:756) at java.util.TimeZone.setDefault(TimeZone.java:778) at org.apache.derbyTesting.functionTests.tests.i18n.LocalizedDisplayScriptTest.setUp(LocalizedDisplayScriptTest.java:140) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25),1,0
CREATE TRIGGER doesn't detect all illegal references to SESSION schema,The reference manual's section on the DECLARE GLOBAL TEMPORARY TABLE statement says: Temporary tables cannot be referenced in a triggered-SQL-statementIt detects most cases and reports:ERROR XCL51: The requested function can not reference tables in SESSION schema.However  some references are not detected if they are in a subquery. For example:ij version 10.10ij&gt; connect 'jdbc:derby:memory:db;create=true';ij&gt; declare global temporary table temptable(x int) not logged;0 rows inserted/updated/deletedij&gt; create table t1(x int);0 rows inserted/updated/deletedij&gt; create table t2(b boolean);0 rows inserted/updated/deletedij&gt; create trigger tr1 after insert on t1 insert into t2 values exists(select * from session.temptable);0 rows inserted/updated/deletedThis CREATE TRIGGER statement should have raised an error.,0,0
Errors in jdbc4.LobStreamTest if derbyclient.jar is first in the classpath,I see the following errors in jdbc4.LobStreamTest if derbyclient.jar is before derby.jar on trunk 10.11 Rev: 1533320There were 2 errors:1) testWriteWithInvalidParameterValues(org.apache.derbyTesting.functionTests.tests.jdbc4.LobStreamTest)java.lang.NoClassDefFoundError: org/apache/derby/iapi/error/ExceptionUtil at org.apache.derby.impl.jdbc.LOBStreamControl.write(LOBStreamControl.java:237) at org.apache.derby.impl.jdbc.LOBOutputStream.write(LOBOutputStream.java:108) at org.apache.derbyTesting.functionTests.tests.jdbc4.LobStreamTest.testWriteWithInvalidParameterValues(LobStreamTest.java:302) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)2) testReadWithInvalidParameterValues(org.apache.derbyTesting.functionTests.tests.jdbc4.LobStreamTest)java.lang.NoClassDefFoundError: org/apache/derby/iapi/error/ExceptionUtil at org.apache.derby.impl.jdbc.LOBInputStream.read(LOBInputStream.java:133) at org.apache.derbyTesting.functionTests.tests.jdbc4.LobStreamTest.testReadWithInvalidParameterValues(LobStreamTest.java:384) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25)There were 2 failures:1) testWriteWithInvalidParameterValues(org.apache.derbyTesting.functionTests.tests.jdbc4.LobStreamTest)junit.framework.AssertionFailedError: Expected IndexOutOfBoundException at org.apache.derbyTesting.functionTests.tests.jdbc4.LobStreamTest.testWriteWithInvalidParameterValues(LobStreamTest.java:305) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456)2) testReadWithInvalidParameterValues(org.apache.derbyTesting.functionTests.tests.jdbc4.LobStreamTest)junit.framework.AssertionFailedError: Expected IndexOutOfBoundException at org.apache.derbyTesting.functionTests.tests.jdbc4.LobStreamTest.testReadWithInvalidParameterValues(LobStreamTest.java:387) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456)I notice derbyclient.jar contains Mon Oct 21 13:30:14 PDT 2013 org/apache/derby/iapi/error/ExceptionUtil$1.classMon Oct 21 13:30:14 PDT 2013 org/apache/derby/iapi/error/ExceptionUtil.classwhich I think is only supposed to be in derby.jar,0,0
NullPointerException in DirFile,We got a NullPointerException trying to start a Derby database in embedded mode; the stacktrace indicated it happened in org.apache.derby.impl.io.DirFile.deleteAll(); that method got called from org.apache.derby.impl.io.BaseStorageFactory.createTempDir().After investigating  it appears that the deleteAll() method calls 'super.list()'  which according to the java.io.File specifications  can return null. But the deleteAll() method doesn't handle that case gracefully.,0,0
ClassCastException when launching derby from windows subst drive,When launching derby bundled with glassfish4 on a substed drive derby fails to startup and logs the following into the derby.log:Fri Nov 08 10:30:34 CET 2013 : Sicherheitsmanager mit einfacher Server-Sicherheitsrichtlinie installiert.java.lang.reflect.InvocationTargetException at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source) at java.lang.reflect.Method.invoke(Unknown Source) at com.sun.enterprise.admin.cli.optional.DerbyControl.invokeNetworkServerControl(DerbyControl.java:158) at com.sun.enterprise.admin.cli.optional.DerbyControl.main(DerbyControl.java:245)Caused by: java.lang.ExceptionInInitializerError at java.lang.Class.forName0(Native Method) at java.lang.Class.forName(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.startNetworkServer(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.blockingStart(Unknown Source) at org.apache.derby.impl.drda.NetworkServerControlImpl.executeWork(Unknown Source) at org.apache.derby.drda.NetworkServerControl.main(Unknown Source) ... 6 moreCaused by: java.lang.ClassCastException: java.nio.file.FileSystemException cannot be cast to java.lang.RuntimeException at org.apache.derby.iapi.services.io.FileUtil.limitAccessToOwnerViaACLs(Unknown Source) at org.apache.derby.iapi.services.io.FileUtil.limitAccessToOwner(Unknown Source) at org.apache.derby.impl.services.stream.SingleStream.PBmakeFileHPW(Unknown Source) at org.apache.derby.impl.services.stream.SingleStream.run(Unknown Source) at java.security.AccessController.doPrivileged(Native Method) at org.apache.derby.impl.services.stream.SingleStream.makeFileHPW(Unknown Source) at org.apache.derby.impl.services.stream.SingleStream.createDefaultStream(Unknown Source) at org.apache.derby.impl.services.stream.SingleStream.makeStream(Unknown Source) at org.apache.derby.impl.services.stream.SingleStream.boot(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(Unknown Source) at org.apache.derby.impl.services.monitor.TopService.bootModule(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(Unknown Source) at org.apache.derby.iapi.services.monitor.Monitor.startSystemModule(Unknown Source) at org.apache.derby.impl.services.monitor.BaseMonitor.runWithState(Unknown Source) at org.apache.derby.impl.services.monitor.FileMonitor.&lt;init&gt;(Unknown Source) at org.apache.derby.iapi.services.monitor.Monitor.startMonitor(Unknown Source) at org.apache.derby.iapi.jdbc.JDBCBoot.boot(Unknown Source) at org.apache.derby.jdbc.EmbeddedDriver.boot(Unknown Source) at org.apache.derby.jdbc.EmbeddedDriver.&lt;clinit&gt;(Unknown Source) ... 12 moreDerby was started via the glassfish command:$ asadmin start-databaseThe asadmin command only fails if it is launched from a substed windows drive. The substed drive was created with the following command:$ subst d: c:/dWhen derby is started from drive 'C' everything is fine.,0,0
Minimal select privilege should be checked in subqueries,DERBY-4191 added checks for minimal select privilege in cases where a SELECT query didn't access any actual column in the base table  such as SELECT COUNT FROM USER1.T and SELECT 1 FROM USER1.T. That privilege checking is only done for top-level SELECT statements. It should also be done for subqueries.Examples of queries where Derby does not currently check for minimal select privileges on the accessed tables (performed as USER2  which has no privileges on any of USER1's tables):SELECT * FROM (SELECT COUNT FROM USER1.T) SSELECT 1 FROM USER1.T UNION SELECT 2 FROM USER1.TINSERT INTO USER2.T SELECT 1 FROM USER1.TI believe that the above statements should have failed  but currently they succeed.,1,0
Incorrect handling when using an UPDATE to SET an identity column to DEFAULT,Derby violates the SQL Standard when an UPDATE statement SETs an identity column to the value DEFAULT. Derby does the right thing for INSERTs  however.For INSERTs  the 2011 Standard defines the meaning of DEFAULT in part 2  section 15.10 (Effect of inserting tables into base tables)  general rule 2. For INSERTs  the DEFAULT value is the next value of the sequence generator which defines the identity column.For UPDATEs  the 2011 Standard defines the meaning of DEFAULT in part 2  section 15.13 (Effect of replacing rows in base tables)  general rule 5. For UPDATEs  the DEFAULT value is also the next value of the sequence generator which defines the identity column.Note also that the 2011 Standard says that a GENERATED ALWAYS identity column can be SET to DEFAULT. Furthermore  that is the only explicit value accepted. See the 2011 Standard  part 2  section 14.15 (set clause list)  syntax rule 5:{'If &lt;set clause&gt; SC specifies an &lt;object column&gt; that references a column of which some underlying column is either a generated column or an identity column whose descriptor indicates that values are always generated  then the &lt;update source&gt; specified in SC shall consist of a &lt;default specification&gt;.'}What Derby actually does for UPDATEs is the following:1) If the column was declared GENERATED ALWAYS  then Derby raises a compile-time error saying that the value of an identity column can't be overridden.2) If the column was declared GENERATED BY DEFAULT  then Derby raises an execution time-error when trying to stuff a null into the column.Correcting this bug would result in backwardly incompatible behavior. However  I think that the incompatibility is minor: it would mean the successful run of statements which previously raised errors.I tripped across this problem while implementing the UPDATE action of the MERGE statement (DERBY-3155). If we decide to fix this bug  we will want to make sure that the UPDATE actions of MERGE statements also correctly handle DEFAULT values for identity columns.The following script shows this problem:connect 'jdbc:derby:memory:db;create=true';create table t1( a int generated always as identity  b int );create table t2( a int generated by default as identity  b int );insert into t1( a  b ) values ( default  100 );insert into t2( a  b ) values ( default  100 );update t1 set a = default;update t2 set a = default;select * from t1;select * from t2;,0,0
Incorrect privileges may be required for INSERT and DELETE statements.,This issue is a place to address problems with INSERT and DELETE statements similar to the problems affecting UPDATE statements recorded on DERBY-6429. In particular  DERBY-6432 and DERBY-6433 list some of the problems with INSERT statements.,1,0
Connections opened by ForeignTableVTI never get released,I noticed during a run of suites.All that one database instance never got garbage collected  even after it had been shut down. It turned out it could not get garbage collected because it was still referenced from the static HashMap _connections in ForeignTableVTI. Looking closer at ForeignTableVTI  it looks as if it only calls put() and get() on the HashMap  never remove()  so its memory footprint will keep increasing as it is used.It would be good to have some way (preferably automatic) of releasing the resources held by ForeignTableVTI when they are no longer needed.,0,1
ArrayIndexOutOfBoundsException when calling function from trigger,I'm having problems will calling functions from within a trigger.The problem seems to be with the outer function call (FLOOR() in this case  but it also happens with other functions). It works fine in the SELECT statement  but when used in the trigger it throws a ArrayIndexOutOfBoundsException.Remove the FLOOR() part from the trigger and it works fine.-- create source table and some dataCREATE TABLE foo (name VARCHAR(20)  val DOUBLE);INSERT INTO foo (name  val) VALUES ('A'  10)  ('A'  20)  ('B'  30)  ('C'  40);-- calling the function works fine hereSELECT name  FLOOR(AVG(LOG10(val)))  COUNT(*)FROM fooGROUP BY name;-- create target table for triggerCREATE TABLE summary (name VARCHAR(20)  aver DOUBLE  size INT);-- create the triggerCREATE TRIGGER trg_foo AFTER INSERT ON fooREFERENCING NEW TABLE AS changed FOR EACH STATEMENT MODE DB2SQLINSERT INTO summary (name  aver  size)SELECT name  FLOOR(AVG(LOG10(val)))  COUNT(*)FROM changedGROUP BY name;-- insert rows to cause trigger to fireINSERT INTO foo (name  val) VALUES ('A'  10)  ('A'  20)  ('B'  30)  ('C'  40);SELECT * FROM foo;SELECT * FROM summary;,0,0
Infinite loop in NetworkServerControlImpl.ensureDataInBuffer,NetworkServerControlImpl.ensureDataInBuffer missing check for return -1 (EOF) from 'clientIs.read'. When read returns -1 thread consumes 100% CPU. Method NetworkServerControlImpl.fillReplyBuffer correctly throw exception.Fix: add two lines: private void ensureDataInBuffer(int minimumBytesNeeded) throws Exception { // make sure the buffer is large enough while ((replyBufferCount - replyBufferPos) &lt; minimumBytesNeeded) { try { int bytesRead = clientIs.read(replyBuffer  replyBufferCount  replyBuffer.length - replyBufferCount);+ if (bytesRead == -1)+ consolePropertyMessage('DRDA_InvalidReplyTooShort.S'  true); replyBufferCount += bytesRead; } catch (IOException e) { clientSocketError(e); } } }StackTrace: java.lang.Thread.State: RUNNABLE at java.net.SocketInputStream.read(Unknown Source:-1) at org.apache.derby.impl.drda.NetworkServerControlImpl.ensureDataInBuffer(Unknown Source:-1) at org.apache.derby.impl.drda.NetworkServerControlImpl.readLDString(Unknown Source:-1) at org.apache.derby.impl.drda.NetworkServerControlImpl.readStringReply(Unknown Source:-1) at org.apache.derby.impl.drda.NetworkServerControlImpl.runtimeInfo(Unknown Source:-1) at org.apache.derby.drda.NetworkServerControl.getRuntimeInfo(Unknown Source:-1) at com.crcdata.dbadmin.server.DerbyEngine.getRuntimeInfo(DerbyEngine.java:134) at com.crcdata.dbadmin.server.DerbyEngine$DerbyServerMonitorTask.run(DerbyEngine.java:305) at java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source:-1) at java.util.concurrent.FutureTask$Sync.innerRun(Unknown Source:-1) at java.util.concurrent.FutureTask.run(Unknown Source:-1) at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source:-1) at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source:-1) at java.lang.Thread.run(Unknown Source:-1),0,1
NetworkServerControl API breaks when username or password contains non-ascii characters,If you pass a non-ascii username/password combination to a NetworkServerControl API command  such as java -jar derbynet.jar shutdown -user Bjﾃｸrn -password Dﾃｦhlieit will hang forever.The reason is that NetworkServerControlImpl.writeLDString() writes the length of the string in characters  whereas NetworkServerControlImpl.readLDString() expects the length to be in number of bytes.,0,1
Create a regression test which will fail if classes from one Derby jar file leak into another jar file,We should write a test so that we find out early on when a checkin breaks the separation between Derby jar files.,0,0
Revamp the vti demo to look and behave more like the other demos.,The VTI demo began as a set of classes which could not be compiled by the normal build because they used Java 5 features. We hooked these classes into the ordinary build later on (see DERBY-3684). But the VTI demo still sticks out like a sore thumb. We ought to be able to make the VTI demo behave like the other demos now.,0,0
Include SQLState in client exception messages,When the embedded driver raises an SQLException  it is linked to a iapi.error.StandardException whose toString() method adds the SQLState to the error message. An SQLException raised by the client driver is linked to a client.am.SqlException  which does not add the SQLState. Because of this  printStackTrace() gives more information when called on an embedded exception. You have to call getSQLState() on the client exception in order to see the SQLState.We should change client.am.SqlException's toString() method to work the same way as StandardException.toString().See also the discussion in DERBY-1997.,0,0
Optional tool registration may fail because the CompilerContext is not always available at execution time.,For reasons which elude me  the CompilerContext is sometimes available at execution time and sometimes not. When the CompilerContext is not available at execution time  optional tool loading fails on an NPE:Caused by: java.lang.NullPointerException at org.apache.derby.catalog.Java5SystemProcedures.SYSCS_REGISTER_TOOL(Java5SystemProcedures.java:104) at org.apache.derby.exe.ac4d3680a5x0144x93adx0136xffffe1d7aa3e0.g0(Unknown Source) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(ReflectMethod.java:46) at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(CallStatementResultSet.java:75) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:470) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:349) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1338),0,0
intermittent error in nightly regression tests: AutoIncrementTest,junit.framework.AssertionFailedError: Column value mismatch @ column 'COLUMNNAME'  row 1: Expected: &gt;A_ZERO&lt; Found: &gt;A_ONE&lt; at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1277) at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1189) at org.apache.derbyTesting.junit.JDBC.assertFullResultSetMinion(JDBC.java:1076) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:999) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:956) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:914) at org.apache.derbyTesting.functionTests.tests.lang.AutoIncrementTest.testderbyIncrementTest(AutoIncrementTest.java:167) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:118) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:442) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:459) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57),0,0
Starting network server on a network drive fails with JDK 7 on Windows,Starting a network server on a network drive with JDK 7 on Windows fails. The reported exception is a ClassCastException  but the underlying exception is the following:java.nio.file.AccessDeniedException: //host/path/derby.log at sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:83) at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:97) at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:102) at sun.nio.fs.WindowsAclFileAttributeView.setAcl(WindowsAclFileAttributeView.java:221) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:601) at org.apache.derby.iapi.services.io.FileUtil.limitAccessToOwnerViaACLs(FileUtil.java:897) at org.apache.derby.iapi.services.io.FileUtil.limitAccessToOwner(FileUtil.java:747) at org.apache.derby.impl.services.stream.SingleStream.PBmakeFileHPW(SingleStream.java:205) at org.apache.derby.impl.services.stream.SingleStream.run(SingleStream.java:401) at org.apache.derby.impl.services.stream.SingleStream.run(SingleStream.java:72) at java.security.AccessController.doPrivileged(Native Method) at org.apache.derby.impl.services.stream.SingleStream.makeFileHPW(SingleStream.java:394) at org.apache.derby.impl.services.stream.SingleStream.createDefaultStream(SingleStream.java:356) at org.apache.derby.impl.services.stream.SingleStream.makeStream(SingleStream.java:132) at org.apache.derby.impl.services.stream.SingleStream.boot(SingleStream.java:92) at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1991) at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:334) at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:541) at org.apache.derby.impl.services.monitor.FileMonitor.startModule(FileMonitor.java:44) at org.apache.derby.iapi.services.monitor.Monitor.startSystemModule(Monitor.java:362) at org.apache.derby.impl.services.monitor.BaseMonitor.runWithState(BaseMonitor.java:343) at org.apache.derby.impl.services.monitor.FileMonitor.&lt;init&gt;(FileMonitor.java:58) at org.apache.derby.iapi.services.monitor.Monitor.startMonitor(Monitor.java:285) at org.apache.derby.iapi.jdbc.JDBCBoot.boot(JDBCBoot.java:67) at org.apache.derby.jdbc.EmbeddedDriver.boot(EmbeddedDriver.java:199) at org.apache.derby.jdbc.EmbeddedDriver.&lt;clinit&gt;(EmbeddedDriver.java:95) at java.lang.Class.forName0(Native Method) at java.lang.Class.forName(Class.java:188) at org.apache.derby.impl.drda.NetworkServerControlImpl.startNetworkServer(NetworkServerControlImpl.java:1032) at org.apache.derby.impl.drda.NetworkServerControlImpl.blockingStart(NetworkServerControlImpl.java:732) at org.apache.derby.impl.drda.NetworkServerControlImpl.executeWork(NetworkServerControlImpl.java:2277) at org.apache.derby.drda.NetworkServerControl.main(NetworkServerControl.java:353),0,0
java.lang.NoSuchMethodError chaining a function and procedure,java.lang.NoSuchMethodError is raised when calling a procedure which takes an Integer argument and passing it the result of a function which returns an int. The error is raised in generated code.,0,0
Remove StorageFile.getURL() and its implementations,StorageFile.getURL() is only called from CPFile  which is an implementation of StorageFile. The getURL() method could therefore be removed from the StorageFile interface and all its implementation classes except for CPFile  and it could be made private in CPFile.,0,0
Remove storageFactory field from subclasses of InputStreamFile,The InputStreamFile class has a field called storageFactory which holds the BaseStorageFactory instance that created it. This field is accessible by all subclasses of InputStream. Still  each subclass has its own storageFactory field which shadows the field in the parent class and holds a reference to the exact same factory instance as the parent.I'd like to remove the extra fields in the subclasses in order to simply the code and silence IDE warnings about the shadowing.,0,0
Syntax error when reference to transition variable has whitespace around it,If a trigger action references a transition variable and has whitespace around the period sign that separates the transition variable name from the column name  it fails with a syntax error.For example:ij&gt; create table t1(x int);0 rows inserted/updated/deletedij&gt; create table t2(x int);0 rows inserted/updated/deletedij&gt; --failscreate trigger tr1 after insert on t1 referencing new as newfor each row insert into t1 select x from t2 where x = new . x;ERROR 42X01: Syntax error: Encountered 'x' at line 1  column 150.Issue the 'help' command for general information on IJ command syntax.Any unrecognized commands are treated as potential SQL commands and executed directly.Consult your DBMS server reference documentation for details of the SQL syntax supported by your server.ij&gt; --succeedscreate trigger tr2 after insert on t1 referencing new as newfor each row insert into t1 select x from t2 where x = new.x;0 rows inserted/updated/deletedThe only difference between the failing trigger definition and the successful one  is that the former says 'new . x' and the latter 'new.x'.Both should succeed.,0,0
Non-english locale flunks LuceneSupportTest,The following error surfaced in the nightly tests on a windows machine with a Swedish locale. See http://download.java.net/javadesktop/derby/request_5589934/ junit.framework.AssertionFailedError: Column value mismatch @ column '1'  row 1: Expected: &gt;en&lt; Found: &gt;sv&lt; at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1303) at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1215) at org.apache.derbyTesting.junit.JDBC.assertFullResultSetMinion(JDBC.java:1102) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:1025) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:982) at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:940) at org.apache.derbyTesting.functionTests.tests.lang.LuceneSupportTest.testCreateAndQueryIndex(LuceneSupportTest.java:75) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:118) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:440) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:457) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25),0,0
testDERBY5120NumRowsInSydependsForTrigger fails when the starting version of the upgrade trajectory is 10.10.2.0,When I run the upgrade tests with 10.10.2.0 as the starting point  I see the following error. I don't see this error when the starting point is 10.10.1.1. This may suggest that 10.10.2.0 has not been added as a starting point for the upgrade tests in the nightly/continuous-integration test runs.1) testDERBY5120NumRowsInSydependsForTrigger(org.apache.derbyTesting.functionTests.tests.upgradeTests.BasicSetup)junit.framework.AssertionFailedError: Expected error(s) ' 42802' but no error was thrown. at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertStatementErrorMinion(BaseJDBCTestCase.java:1194) at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertStatementError(BaseJDBCTestCase.java:1145) at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertStatementError(BaseJDBCTestCase.java:1228) at org.apache.derbyTesting.functionTests.tests.upgradeTests.BasicSetup.testDERBY5120NumRowsInSydependsForTrigger(BasicSetup.java:514) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:118) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:440) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:457) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:21) at junit.extensions.TestSetup.run(TestSetup.java:25),0,0
Sequence generator makes CREATE TRIGGER fail with internal error,I'm seeing this on trunk:ij version 10.11ij&gt; connect 'jdbc:derby:memory:db;create=true';ij&gt; create table t1(x int  y int  z int);0 rows inserted/updated/deletedij&gt; create table t2(x int  y int  z int);0 rows inserted/updated/deletedij&gt; create sequence seq;0 rows inserted/updated/deletedij&gt; values next value for seq;1 ------------21474836481 row selectedij&gt; create trigger tr1 after insert on t1 insert into t2(x) values (next value for seq);ERROR 40XT8: An internal error was identified by RawStore module. Internal state detail from the transaction is as follows: savedEndStatus = 0needSync = falsejustCreated = falsemyGlobalId = nullmyId = nullstate = 0inComplete = nullseenUpdates = falseinPostCommitProcessing = falselogStart = nulllogLast = nullrecoveryTransaction = falsepostCompleteMode = falsesanityCheck_xaclosed = falsetransName = UserTransactionreadOnly = falseflush_log_on_xact_end = truebackupBlocked = falsedontWaitForLocks = false,0,0
NOT elimination for CASE expressions is broken,NOT elimination for CASE expressions seems to be broken. Take this example:ij&gt; select * from sysibm.sysdummy1 where not ( case when ibmreqd = 'Y' then true else true end );IBM&amp;----Y 1 row selectedBoth branches of the CASE expression evaluate to TRUE  so one would expect the predicate 'not ( case ... )' to evaluate to FALSE  and the query should return an empty result.,0,0
ROW_NUMBER function throws NullPointerException in UPDATE statement,A NullPointerException is raised with this (possibly illegal?) UPDATE statement:ij version 10.10ij&gt; connect 'jdbc:derby:memory:db;create=true';ij&gt; create table t(x int);0 rows inserted/updated/deletedij&gt; insert into t values 1;1 row inserted/updated/deletedij&gt; update t set x = row_number() over ();ERROR XJ001: Java exception: ': java.lang.NullPointerException'.,0,0
Simplify handling of untyped nulls in CASE and NULLIF expressions,The parser translates both CASE and NULLIF expressions into ConditionalNodes  but it represents untyped NULLs differently in the two cases.In a CASE expression  any branch that is an untyped NULL  is translated into an UntypedNullConstantNode that's wrapped in a CastNode that casts the value to CHAR(1). The CastNode is replaced with a cast to the correct type during the bind phase.A NULLIF expression is turned into a CASE expression that has a THEN NULL clause. The parser simply creates an UntypedNullConstantNode for that clause  without wrapping it in a CastNode. A CastNode is instead added during the bind phase.This slight difference in how NULLs are represented by the parser in the two cases  means that ConditionalNode needs to handle the two cases differently during the bind phase. It would be better if the parser generated NULLs in the same way for the two cases  so that ConditionalNode didn't need to know if it was generated for a CASE expression or a NULLIF expression.,0,0
Incorrect nullability for CASE expression with parameter,This JUnit test code fails because it detects that the query returns null even though the result column is reported as not nullable: PreparedStatement ps = prepareStatement( 'values case when false then 1 else ? end'); ps.setNull(1  Types.INTEGER); JDBC.assertSingleValueResultSet(ps.executeQuery()  null);,0,0
add HoldForConnection ij command to match NoHoldForConnection,DERBY-6515 was created to document the NoHoldForConnection ij command  which was used in some of Derby's sql style tests.In subsequent comments  it was felt there should be a matching HoldForConnection ij command to set the value back to the default (ResultSet.HOLD_CURSORS_OVER_COMMIT).,0,0
CheckToursDBTest failed while updating sequence value on disk,I saw a failure in CheckToursDBTest while running the demo test suite on trunk. It was reported as an ArrayIndexOutOfBoundsException. The ArrayIndexOutOfBoundsException happened during cleanup and shadowed the original exception. The original exception in derby.log looked like this:ERROR XSTA2: A transaction was already active  when attempt was made to make another transaction active. at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:290) at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:285) at org.apache.derby.impl.store.raw.xact.XactFactory.pushTransactionContext(XactFactory.java:766) at org.apache.derby.impl.store.raw.xact.XactFactory.startCommonTransaction(XactFactory.java:293) at org.apache.derby.impl.store.raw.xact.XactFactory.startNestedUpdateUserTransaction(XactFactory.java:350) at org.apache.derby.impl.store.raw.RawStore.startNestedUpdateUserTransaction(RawStore.java:460) at org.apache.derby.impl.store.access.RAMTransaction.startNestedUserTransaction(RAMTransaction.java:2326) at org.apache.derby.impl.sql.catalog.SequenceUpdater.updateCurrentValueOnDisk(SequenceUpdater.java:486) at org.apache.derby.impl.sql.catalog.SequenceUpdater.clean(SequenceUpdater.java:218) at org.apache.derby.impl.sql.catalog.SequenceUpdater.clearIdentity(SequenceUpdater.java:257) at org.apache.derby.impl.services.cache.ConcurrentCache.removeEntry(ConcurrentCache.java:167) at org.apache.derby.impl.services.cache.ConcurrentCache.ageOut(ConcurrentCache.java:583) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.clearSequenceCaches(DataDictionaryImpl.java:8968) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.clearCaches(DataDictionaryImpl.java:8951) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.clearCaches(DataDictionaryImpl.java:8937) at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.doneReading(DataDictionaryImpl.java:1184) at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:519) at org.apache.derby.impl.sql.GenericStatement.prepareStorable(GenericStatement.java:687) at org.apache.derby.iapi.sql.dictionary.SPSDescriptor.compileStatement(SPSDescriptor.java:373) at org.apache.derby.iapi.sql.dictionary.SPSDescriptor.prepareAndRelease(SPSDescriptor.java:264) at org.apache.derby.iapi.sql.dictionary.SPSDescriptor.getPreparedStatement(SPSDescriptor.java:739) at org.apache.derby.iapi.sql.dictionary.SPSDescriptor.getPreparedStatement(SPSDescriptor.java:655) at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:171) at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeWhenClauseAndAction(GenericTriggerExecutor.java:346) at org.apache.derby.impl.sql.execute.RowTriggerExecutor.fireTrigger(RowTriggerExecutor.java:113) at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:272) at org.apache.derby.impl.sql.execute.UpdateResultSet.fireAfterTriggers(UpdateResultSet.java:831) at org.apache.derby.impl.sql.execute.UpdateResultSet.open(UpdateResultSet.java:282) at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:470) at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:349) at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1338) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:704) at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:631) at org.apache.derbyTesting.functionTests.tests.demo.CheckToursDBTest.doUpdate(CheckToursDBTest.java:163) at org.apache.derbyTesting.functionTests.tests.demo.CheckToursDBTest.testToursDB(CheckToursDBTest.java:108) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:483) at junit.framework.TestCase.runTest(TestCase.java:168) at junit.framework.TestCase.runBare(TestCase.java:134) at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:118) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:440) at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:457) at junit.framework.TestResult$1.protect(TestResult.java:110) at junit.framework.TestResult.runProtected(TestResult.java:128) at junit.framework.TestResult.run(TestResult.java:113) at junit.framework.TestCase.run(TestCase.java:124) at junit.framework.TestSuite.runTest(TestSuite.java:232) at junit.framework.TestSuite.run(TestSuite.java:227) at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24) at junit.extensions.TestSetup$1.protect(TestSetup.java:23) at junit.framework.TestResult.runProtected(TestResult.java:128) at junit.extensions.TestSetup.run(TestSetup.java:27) at junit.framework.TestSuite.runTest(TestSuite.java:232) at junit.framework.TestSuite.run(TestSuite.java:227) at junit.framework.TestSuite.runTest(TestSuite.java:232) at junit.framework.TestSuite.run(TestSuite.java:227) at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:518) at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:1052) at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:906),0,0
Broken link in API docs to derby.drda.keepAlive documentation,In the javadoc for NetworkServerMBean#getDrdaKeepAlive  there is a@see link which is broken. It points to:http://db.apache.org/derby/docs/dev/adminguide/radmindrdakeepalive.html,0,0
User procedures can call system procedures  circumventing SQL authorization.,System procedures are implemented as public static methods in org.apache.derby.catalog.SystemProcedures. These methods can be called by code in user-written procedures. This allows a user-written procedure to circumvent the SQL authorization checks which are supposed to limit some procedures to being called only by the DBO. I will attach a repro.,1,0
Use javax.xml.xpath interfaces for XPath support,Currently  Derby uses the interfaces in the org.w3c.dom.xpath package to implement XPath support. That package is not part of the Java SE specification. Even though the package is included as an internal API in some of the major Java runtimes  using the standard javax.xml.xpath package instead would be better. It would be more portable  and less likely to break in the future if JVM vendors remove the internal API.,0,0
Check type of user-supplied modules before creating instances,Derby allows users to specify names of classes to use for various pluggable modules.In some cases  it verifies that the class implements the expected interface before it creates an instance of the class. For example in SpecificAuthenticactionServiceImpl: Class sasClass = Class.forName(specificAuthenticationScheme); if (!UserAuthenticator.class.isAssignableFrom(sasClass)) { throw StandardException.newException(SQLState.AUTHENTICATION_NOT_IMPLEMENTED  specificAuthenticationScheme  'org.apache.derby.authentication.UserAuthenticator'); } UserAuthenticator aScheme = (UserAuthenticator) sasClass.newInstance();In other cases  it creates an instance without checking  and instead fails with a ClassCastException or some other exception when trying to use the instance of the incorrect type. Examples: Java5SystemProcedures SYSCS_REGISTER_TOOL()  JCECipherFactory  SequenceUpdater.makePreallocator().I think it would be good to have similar checks in these other cases too. That'll give clearer error messages which explain what the problem is  and it will be safer because it limits which constructors the users can force the Derby engine to invoke.,1,0
Support standard syntax for altering column nullability,Derby supports altering the nullability of a column via an ALTER TABLE statement  but the supported syntax is different from what the SQL:2011 standard defines. We should add support for the standard syntax as well.The standard syntax is ALTER TABLE t ALTER COLUMN c SET NOT NULL ALTER TABLE t ALTER COLUMN c DROP NOT NULL,0,0
Compilation error using a view as the source data set for a MERGE statement,Mamta found the following problem when using a view as the source data set of a MERGE statement:connect 'jdbc:derby:memory:db;create=true';CREATE TABLE employee (employee_id int first_name VARCHAR(20) last_name VARCHAR(20) dept_no int salary int);create view v1employee as select * from employee;CREATE TABLE bonuses (employee_id int  bonus int DEFAULT 100);create view v2bonuses as select * from bonuses;-- compiles without the viewMERGE INTO bonuses BUSING employee EON B.employee_id = E.employee_idWHEN MATCHED AND E.dept_no=20 THEN UPDATE SET B.bonus = E.salary * 0.1WHEN NOT MATCHED AND dept_no=20 THEN INSERT (employee_id  bonus) VALUES (E.employee_id  E.salary * 0.05);-- compilation error with the viewMERGE INTO bonuses BUSING v1employee EON B.employee_id = E.employee_idWHEN MATCHED AND E.dept_no=20 THEN UPDATE SET B.bonus = E.salary * 0.1WHEN NOT MATCHED AND dept_no=20 THEN INSERT (employee_id  bonus) VALUES (E.employee_id  E.salary * 0.05);,0,0
Rollback to savepoint allows violation of deferrable constraints,The bug is illustrated by the following code snippet: Connection c = DriverManager.getConnection('jdbc:derby:memory:db;create=true'); c.setAutoCommit(false); Statement s = c.createStatement(); s.execute('create table t1(x int primary key initially deferred)'); s.execute('insert into t1 values 1 1 1 1'); Savepoint sp = c.setSavepoint(); s.execute('drop table t1'); c.rollback(sp); // Since there are four identical rows in T1  this call should have // failed because the primary key was violated. c.commit(); // Instead  it succeeds  and all four rows are committed  as can // be seen here: ResultSet rs = s.executeQuery('select * from t1'); while (rs.next()) { System.out.println(rs.getInt(1)); } // Insert yet another row  so that we have five identical rows ... s.execute('insert into t1 values 1'); // ... and now commit complains ... c.commit();With auto-commit off  add duplicates into a deferred primary key. Then set a savepoint  drop the table  and roll back to the savepoint.Apparently  when you drop the table  information about any constraint violations seen on that table is lost  and that information is not restored when the drop table operation is undone by the rollback to savepoint.So when you commit the transaction after having rolled back the drop operation  no deferred checking of constraints happens  and the duplicates you have inserted are committed.,0,0
Allow Derby to rename tables referenced by foreign keys,Hi  I'm on the Apache Roller team and we use database migration scripts to update databases between Roller releases. (We have a common template (http://svn.apache.org/viewvc/roller/trunk/app/src/main/resources/sql/500-to-510-migration.vm?view=co) that is run through Velocity to create specific scripts for the several databases that we support.) One handicap with Derby that we're not seeing with other databases is its inability to rename tables that have FK's on them. Renaming one of our tables returns this error from Derby:rename table website to weblog;Error: Operation 'RENAME' cannot be performed on object 'SQL140718163851800' because CONSTRAINT 'WP_WEBSITEID_FK' is dependent on that object.SQLState: X0Y25ErrorCode: 30000Error: Operation 'RENAME' cannot be performed on object 'SQL140718163851800' because CONSTRAINT 'WE_WEBSITEID_FK' is dependent on that object.SQLState: X0Y25ErrorCode: 99999Error: Operation 'RENAME' cannot be performed on object 'SQL140718163851800' because CONSTRAINT 'WC_WEBSITEID_FK' is dependent on that object.SQLState: X0Y25ErrorCode: 99999Error: Operation 'RENAME' cannot be performed on object 'SQL140718163851800' because CONSTRAINT 'FO_WEBSITEID_FK' is dependent on that object.SQLState: X0Y25ErrorCode: 99999Error: Operation 'RENAME' cannot be performed on object 'SQL140718163851800' because CONSTRAINT 'MF_WEBSITEID_FK' is dependent on that object.SQLState: X0Y25ErrorCode: 99999Error: Operation 'RENAME' cannot be performed on object 'SQL140718163851800' because CONSTRAINT 'NF_WEBSITEID_FK' is dependent on that object.SQLState: X0Y25ErrorCode: 99999Error: Operation 'RENAME' cannot be performed on object 'SQL140718163851800' because CONSTRAINT 'AP_WEBSITEID_FK' is dependent on that object.SQLState: X0Y25ErrorCode: 99999This results in the migration scripts needing to be messy  first dropping all constraints before recreating them  for the one RDBMS that requires it. It would be great if a future release of Derby could be coded to support table renames regardless of the constraints defined on it. Thanks!,0,0
Permission problems when running JUnit tests with Ant 1.9.4,I saw many permission problems when I set up a build job for the 10.11 branch. See for example this log: https://builds.apache.org/job/Derby-10.11-suites.All/1/consoleFirst stack trace: [junit] Running org.apache.derby.PackagePrivateTestSuite [junit] Tests run: 67  Failures: 0  Errors: 0  Skipped: 0  Time elapsed: 5.662 sec [junit] Exception in thread 'main' java.security.AccessControlException: access denied ('java.io.FilePermission' '/home/jenkins/jenkins-slave/workspace/Derby-10.11-suites.All/10.11-head/junit_20140804_1122/TEST-org.apache.derby.PackagePrivateTestSuite.xml' 'write') [junit] at java.security.AccessControlContext.checkPermission(AccessControlContext.java:457) [junit] at java.security.AccessController.checkPermission(AccessController.java:884) [junit] at java.lang.SecurityManager.checkPermission(SecurityManager.java:549) [junit] at java.lang.SecurityManager.checkWrite(SecurityManager.java:979) [junit] at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:194) [junit] at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:156) [junit] at org.apache.tools.ant.taskdefs.optional.junit.FormatterElement$DelayedFileOutputStream.write(FormatterElement.java:381) [junit] at java.io.OutputStream.write(OutputStream.java:116) [junit] at sun.nio.cs.StreamEncoder.writeBytes(StreamEncoder.java:221) [junit] at sun.nio.cs.StreamEncoder.implFlushBuffer(StreamEncoder.java:291) [junit] at sun.nio.cs.StreamEncoder.implFlush(StreamEncoder.java:295) [junit] at sun.nio.cs.StreamEncoder.flush(StreamEncoder.java:141) [junit] at java.io.OutputStreamWriter.flush(OutputStreamWriter.java:229) [junit] at java.io.BufferedWriter.flush(BufferedWriter.java:254) [junit] at org.apache.tools.ant.util.DOMElementWriter.openElement(DOMElementWriter.java:371) [junit] at org.apache.tools.ant.util.DOMElementWriter.write(DOMElementWriter.java:209) [junit] at org.apache.tools.ant.util.DOMElementWriter.write(DOMElementWriter.java:222) [junit] at org.apache.tools.ant.util.DOMElementWriter.write(DOMElementWriter.java:222) [junit] at org.apache.tools.ant.taskdefs.optional.junit.XMLJUnitResultFormatter.endTestSuite(XMLJUnitResultFormatter.java:188) [junit] at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.fireEndTestSuite(JUnitTestRunner.java:840) [junit] at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:575) [junit] at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:1179) [junit] at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:1030) [junit] Running org.apache.derby.PackagePrivateTestSuite [junit] Tests run: 1  Failures: 0  Errors: 1  Skipped: 0  Time elapsed: 0 sec [junit] Test org.apache.derby.PackagePrivateTestSuite FAILED (crashed)I can reproduce these failures in my environment by running the junit-single target with Ant 1.9.4. For example:ant -Dderby.junit.testclass=org.apache.derbyTesting.unitTests.junit.FormatableBitSetTest junit-singleIf I use an older Ant version (I've tried 1.9.0 and 1.8.2) it does not fail.,1,0
ROW_NUMBER should not be allowed as argument in a procedure call,Fails with assert/NPE instead of proper error:ij&gt; call syscs_util.syscs_compress_table('APP'  'T'  row_number() over ());ERROR XJ001: Java exception: 'ASSERT FAILED cannot get interface without operand: org.apache.derby.shared.common.sanity.AssertFailure'.,0,0
Assert failure/ArrayIndexOutOfBoundsException when using COUNT in MERGE matching clause,This (meaningless) statement gives NPE in insane builds andassert failure in sane builds:s.execute('create table t2(x int)');s.execute('create table t1(x int)');s.execute('insert into t2 values 3 4');s.executeUpdate('merge into t1 using t2 on (t1.x=t2.x) ' + 'when not matched then insert values (count(*))');I see it also applies to other aggregates  e.g. MAX.stack trace (insane):Exception in thread 'main' java.sql.SQLException: Java exception: '-1: java.lang.ArrayIndexOutOfBoundsException'. at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) at org.apache.derby.impl.jdbc.Util.seeNextException(Unknown Source) at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeLargeUpdate(Unknown Source) at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(Unknown Source) at derby6565.Derby6565.main(Derby6565.java:46)Caused by: ERROR XJ001: Java exception: '-1: java.lang.ArrayIndexOutOfBoundsException'. at org.apache.derby.iapi.error.StandardException.newException(Unknown Source) at org.apache.derby.impl.jdbc.SQLExceptionFactory.wrapArgsForTransportAcrossDRDA(Unknown Source) ... 12 moreCaused by: java.lang.ArrayIndexOutOfBoundsException: -1 at org.apache.derby.impl.services.bytecode.BCMethod.popStack(Unknown Source) at org.apache.derby.impl.services.bytecode.BCMethod.callMethod(Unknown Source) at org.apache.derby.impl.sql.compile.ResultColumnList.generateEvaluatedRow(Unknown Source) at org.apache.derby.impl.sql.compile.MatchingClauseNode.generateInsertUpdateRow(Unknown Source) at org.apache.derby.impl.sql.compile.MatchingClauseNode.generate(Unknown Source) at org.apache.derby.impl.sql.compile.MergeNode.generate(Unknown Source) at org.apache.derby.impl.sql.compile.StatementNode.generate(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source) at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source) at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source) ... 4 more,0,0
OOME when running ConstraintCharacteristicsTest with smaller heap,When I ran suites.All on a device with little memory  so that I needed to reduce the heap (-Xmx160M)  it stopped and failed with an OOME when it came to ConstraintCharacteristicsTest.That test uses a memory database in order to speed it up. One of the test cases (testManySimilarDuplicates) has such a big data set that the database doesn't fit in the heap. It would be good if we could reduce the memory requirements of the test so that it passes on smaller devices to. Alternatively  we could add a switch that makes it easy to disable test cases that are known to have high memory requirements.,0,0
Add derbyoptionaltools.jar to the class paths of the scripts in the bin directory,The derbyoptionaltools.jar should be added to the class paths constructed by all of the scripts in the bin distros which include derby.jar. Otherwise  the Lucene plugin (and future features which we put in derbyoptionaltools.jar) won't be available when you use the scripts to run ij  the network server  and sysinfo.For instance  you will see information on this jar file if you run sysinfo this way...java -jar derbyrun.jar sysinfo窶ｦbut not if you run the sysinfo script in the bin directory of a Derby installation.,0,0
Add derbyoptionaltools.jar to the maven artifacts we publish,The new derbyoptionaltools.jar is not published to the maven repositories along with the other Derby jar files.,0,0
Cannot create a Lucene index if a key column's name is case-sensitive,The workaround is to create a view which gives the columns case-insensitive names. The following script shows this problem:connect 'jdbc:derby:memory:db;create=true';call syscs_util.syscs_register_tool( 'luceneSupport'  true );create schema 's';create table 's'.'t'( 'passageID' int  'text' varchar( 32672 ));-- fails because the trailing key id is case-sensitivecall luceneSupport.createIndex( ''s''  ''t''  ''text''  null  ''passageID'');create view 's'.'t_view' ( passageID  text ) as select * from 's'.'t';-- succeeds on a view with case-insensitive identifierscall luceneSupport.createIndex( ''s''  ''t_view''  'text'  null  'passageID');,0,0
The jacoco-junit target fails to store coverage data for some sub-suites,The console log for the code coverage test runs at https://builds.apache.org/job/Derby-JaCoCo/ shows that JaCoCo fails to write coverage data for the following test suites:langjdbcapistoreengineencryptionIt is caused by the following permissions-related exception: [junit] java.security.AccessControlException: access denied ('java.io.FilePermission' '/home/jenkins/jenkins-slave/workspace/Derby-JaCoCo/trunk/junit_20140912_1758/jacoco.exec' 'write') [junit] at java.security.AccessControlContext.checkPermission(AccessControlContext.java:372) [junit] at java.security.AccessController.checkPermission(AccessController.java:559) [junit] at java.lang.SecurityManager.checkPermission(SecurityManager.java:549) [junit] at java.lang.SecurityManager.checkWrite(SecurityManager.java:979) [junit] at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:203) [junit] at org.jacoco.agent.rt.internal_9dd1198.output.FileOutput.openFile(FileOutput.java:67) [junit] at org.jacoco.agent.rt.internal_9dd1198.output.FileOutput.writeExecutionData(FileOutput.java:53) [junit] at org.jacoco.agent.rt.internal_9dd1198.Agent.shutdown(Agent.java:143) [junit] at org.jacoco.agent.rt.internal_9dd1198.Agent$1.run(Agent.java:60)The result of this is that the coverage report shows lower coverage than what's actually covered by the tests.,1,0
For update statement  collect generated keys if Statement.RETURN_GENERATED_KEYS flag is supplied to the JDBC call.,DERBY-6414 is providing SQL support to update identity columns using DEFAULT keyword. This jira will look into collecting generated keys if Statement.RETURN_GENERATED_KEYS flag is supplied to the JDBC call for an UPDATE sql.,0,0
Remove need for db2jcc.jar for executing ij or upload it on ibiblio,I'm trying to automate loading DDL files with Maven/Maven2 and all the derby are available on ibiblio except db2jcc.jar...Thanks!,0,0
Fix hard-coded JDBC 4.0 type constants,The JDBC 4.0 driver has hard-coded type constants in JDBC40Translation. Some of these were changed in build 98 of jdk1.6 and should be updated. The nightly tests on jdk1.6 are failing because of this  see for instance http://www.multinet.no/~solberg/public/Apache/DerbyJDK16/testlog/JDK16Jvm1.6SunOS-5.10_i86pc-i386/440135-jdbc40_diff.txt.,0,0
In suites.All  certain test orders cause AccessControlException,While working on DERBY-2925  order of tests in suites/AllPackages.java causedjava.security.AccessControlException. For related derby-dev discussion please see:http://www.nabble.com/forum/ViewPost.jtp?post=11835420&amp;framed=y,0,0
Utilize JQL to fetch JIRA issue list for release notes generation,DERBY-4857 made it possible to use the JIRA SOAP API to fetch a list of issues fixed in a release. However  the release manager have to manually create a JIRA filter and feed the filter id to the tool.Now that the Apache JIRA instance has been updated to 4.x  we can use the JIRA Query Language (JQL) to avoid that manual step.,0,0
Remove unused parameter in splitmessages,splitmessages requires three parameters  but it only uses two of them. A comment in the class describing the parameters  only describe the first two of them: /** arg&#91;0&#93; is the destination directory arg&#91;1&#93; is the source file. */The third  unused parameter should be removed.,0,0
open Modal Window without AjaxRequestTarget,Wicket 1.2.2 included a new Modal Window component. However  this component can only be used with a valid AjaxRequestTarget. It would be useful if Modal Windows could be opened programmatically at any time without an AjaxRequestTarget.,0,0
missing base64/ URL encoding,yesterday i showed the concept of omponents to a friend and stumled into something i dont understand and think it might be a bug. I have a small panelcompoment that holds a searchform (textfield + submit) nothing special here  the code behind looks like:  @Override public void onSubmit()  { String suchFeld = getSuchfeld(); if(suchFeld.length()&gt;0) { PageParameters params = new PageParameters(); params.add('finde' suchFeld); setResponsePage(Suche.class params); } else { setResponsePage(getPage().getClass()); }  }the component is put into a 'BasePage': public BasePage() { ....  add(bar); add(new SuchPanel('SuchPanel')); .....}wich is then extended by the real page:public class Foo extends BasePage{ /** Creates a new instance of Zigarren */ public Foo() { }wich works all fine  however if the class name contains non ascii letters(e.g: ﾃｶ ﾃ､ ﾃｼ etc.) it gives me a bug if nothing is entered into the search and the partpublic class Zubehﾃｶr extends BasePage{ /** Creates a new instance of Zubehﾃｶr */ public Zubehﾃｶr() { }'setResponsePage(getPage().getClass());' comes to action  the trouble is that the page might have the URL:?wicket:bookmarkablePage=:de.pages.Zubeh%C3%B6rbut the form tries to go to : wicket:bookmarkablePage=:de.pages.Zubeh%F6rwich results in a CODE 404 in the App Server,0,0
Wrong source paths in build.xml,The paths used in the ant build.xml don't match the actual file structure. In particular  the following changes should be made:The following lines should be changed &lt;property name='src.main.dir' value='src/java' /&gt; &lt;property name='src.test.dir' value='src/test' /&gt;into+ &lt;property name='src.main.dir' value='src/main/java' /&gt;+ &lt;property name='src.test.dir' value='src/test/java' /&gt;,0,0
WicketTester fails when calling clickLink on a ResourceLink to a mounted resource,Basics of the testcase are:// in WebApplicationapplication.getSharedResources().add('mountedResource'  new MountedResource());ResourceReference mountedResourceRef = new ResourceReference('mountedResource');application.mountSharedResource('/mountedLink'  mountedResourceRef.getSharedResourceKey());// in WebPageadd(new ResourceLink('mountedResourceLink'  new ResourceReference('mountedResource')));// in testcase itselftester.startPage(LinksPage.class);tester.clickLink('mountedResourceLink'); I've attached an Eclipse generated project  it has a build.xml which should work on the command line  and uses TestNG for the tests.The .war (which can be built using Eclipse) has working links.,0,0
Make debug settings session dependent,Currently  the debug settings are global. i.e. everyone gets to see the ajax debug link  or nobody. For production systems it is not acceptable to generate the debug link for all users  but it might be beneficial to quickly see what is going wrong on a site if you can enable the debug link programmatically for a single user.I can imagine that other settings also benefit from this.,0,0
Support case insensitive mount paths,http://www.nabble.com/Non-case-sensitive-nice-URL-tf2643746.htmlI use nice URL to mount some page in the usual way :mountBookmarkablePage('/Organization'  Organization.class);That is great  but it will make an error if a user enter the url by hand and decide to not use case sensitive. I mean  I can mount organization without the capital letter  but it would make the same error if the user use Capital after that.Is there a way of using Nice URL that is not case sensitive?ThanksMarc,0,0
FormTester does not set request parameters for unchanged form fields,When using the FormTester  the Form is correctly having its field values  but FormTester does not call setFormComponentValue() for every field. Thus  the request parameters are not set for the next request  when submit() is called.The workaround is to call setValue() for every field.The attached patch fixes the problem for AbstractTextComponent. It also adds a new method getTextComponentValue() as a shortcut to access a field value.,0,0
NPE in Check.java,The Forms examples fails with an NPE in Check.java if (group.hasRawInput()) { String[] inputs = group.getInputAsArray(); for (String input : inputs) &lt;&lt;&lt;&lt;&lt;&lt; NPE { if (value.equals(input)) { tag.put('checked'  'checked'); } } }Juergen,0,0
Russian Application.properties,,0,0
extract IPageMap interface from PageMap,If we extract a IPageMap interface from PageMap  it will make it easier for clients to provide wrapped/ proxied implementions and gives them more options for implementing custom ISessionStores.,0,0
Lazy-registration fails for mounted resources.,If you mount a CSS resource which has background image url() links  the lazy-resolution code in SharedResourceRequestTarget doesn't search class aliases when it tries to locate the image  which is rather annoying.,0,0
Remove RequiredTextField from 2.0,To cut down on our API and remove some ultra-convenience stuff  Ipropose to remove RequiredTextField from our API. Requiredness iseasily achieved using 'setRequired(true)'  and therefore removes theneed for a special field.Vote was: 3 binding for removal only in 2.0,0,0
NullPointerException after deserialize wicket.util.concurrent.CopyOnWriteArrayList,wicket.feedback.FeedbackMessages by default using wicket.util.concurrent.CopyOnWriteArrayList for storage. however CopyOnWriteArrayList internally use a transient Object[] array_ without checking null and lazy initialization. This may cause NullPointerException after session replication or the like. Below is stack trace while testing terracotta session clustering :WicketMessage: unable to get object  model: Model:classname=&#91;wicket.feedback.FeedbackMessagesModel&#93;:attached=true  called with component [MarkupContainer &#91;Component id = messages  page = ngc.wicket.pages.MainPage   path = 7:globalFeedback:feedbackul:messages.FeedbackPanel$MessageListView  isVisible = true  isVersioned = false&#93;]Root cause:java.lang.NullPointerExceptionat wicket.util.concurrent.CopyOnWriteArrayList.size (CopyOnWriteArrayList.java:152)at wicket.feedback.FeedbackMessages.messages(FeedbackMessages.java:258)at wicket.feedback.FeedbackMessagesModel.onGetObject(FeedbackMessagesModel.java:101)at wicket.model.AbstractDetachableModel.getObject (AbstractDetachableModel.java:104)at wicket.Component.getModelObject(Component.java:990)at wicket.markup.html.panel.FeedbackPanel.updateFeedback(FeedbackPanel.java:234)at wicket.Page$2.component (Page.java:372)at wicket.MarkupContainer.visitChildren(MarkupContainer.java:744)at wicket.Page.renderPage(Page.java:368),0,0
wrong handling of exceptions for Resource#respond and ComponentResourceRequestTarget#respond,Resource's exception handling is too fragile. Currently (before fix) it looks like this: private final void respond(final IResourceStream resourceStream  final Response response) { try { final OutputStream out = response.getOutputStream(); try { Streams.copy(resourceStream.getInputStream()  out); } finally { resourceStream.close(); out.flush(); } } catch (Exception e) { Throwable throwable = e; boolean ignoreException = false; while (throwable != null) { if (throwable instanceof SocketException) { String message = throwable.getMessage(); ignoreException = message != null &amp;&amp; (message.indexOf('Connection reset by peer') != -1 || message .indexOf('Software caused connection abort') != -1); } else { ignoreException = throwable.getClass().getName() .indexOf('ClientAbortException') &gt;= 0; if (ignoreException) { if (log.isDebugEnabled()) { log.debug('Socket exception ignored for sending Resource ' + 'response to client (ClientAbort)'  e); } break; } } throwable = throwable.getCause(); } if (!ignoreException) { throw new WicketRuntimeException('Unable to render resource stream ' + resourceStream  e); } } }and ComponentResourceRequestTarget re-threw this exception  resulting in Wicket trying to render an error page. One problem with the above code is that it is simply does not cover all appservers/versions/os-ses  nor it that something we should want to support. For instance  an aborted request in Jetty on Linux/ OSX results in an IOException (or more concrete EofException).Besides the fact that this can get you weird behavior in general  handling the exception like we did there is never a good idea. We should never try to render an error page for any exception during a resource request but instead set an appropriate status code. I propose status code 500 (INTERNAL_SERVER_ERROR) for this and put that in ComponentResourceRequestTarget  and alter Resource so that it always re-throws any exception.,0,0
mounted URLs fail if filterPath is blank,The path in RequestParameters needs to begin with a '/' or it will not be found when checking against mounted paths. The slash is prefixed in WicketFilter line 545 when checking isWicketRequest()  but it is not prefixed later when looking for the request target. Proposed fix in patch (to be attached) performs this operation in ServletWebRequest.getPath(); I'm not sure if that is the ideal spot  but I've confirmed that it fixes the problem.,0,0
set session locale when constructing session object,Currently  we create the session objects like this:WebApplication#getSession:if (session == null){ // Create session using session factory session = getSessionFactory().newSession(request); // Set the client Locale for this session session.setLocale(request.getLocale());What I propose is to change the constructor from Session/ WebSession to take in a Locale parameter as well. That would make it possible for custom session classes to fix the locale by setting it in the constructor. Now that is only possible by overriding Session#getLocale,0,0
Access to init parameters through getServletContext.getInitParameter() not working,The command WebApplication.get().getServletContext.getInitParameter('param'); always returns null.The init parameters can only be accessed with the WicketFilter class. A getter in the WebApplication class on the wicketFilter field could work. The previous command could then be replaced with:WebApplication.get().getWicketFilter().getFilterConfig().getInitParameter('param');,0,0
Extend cases where the exception can be ignored due to an aborted request,We should either find more specific catches in Resource#respond or come up with some other way to ensure we can recognize a client abortion. For instance  Jetty 6 on unix-like platforms (tested here on OpenBSD/ OSX) throws EofExceptions which extend IOExceptions and thus are not marked as ignorable. The problem then is that a stack trace will be printed in ComponentResourceRequestTarget  and as many production systems will have some trigger installed that sends an error message/ SMS/ ... that can be quite annoying.Can't we instead of looking at the exception somehow look at the request/ response itself to figure out that a request was aborted? If that is possible  that seems like a much more robust way of solving this.,0,0
Default code for popups should always try to bring the popped up window to the top (focus),The default implementation of popups (the script generated by PopupSettings) should always try to focus on the popped up window.,0,0
While testing with FormTester: onSelectionChanged is not being invoked if DropDownChoice is enabled for notifications,Method DropDownChoice.onSelectionChanged is never called when testing a drop down by calling formTester.select('dropDownChoiceNotified'  0);In my page: form.add(new DropDownChoice('dropDownChoiceNotified'  candidateChoices  bookChoiceRenderer) { private static final long serialVersionUID = 1L; protected boolean wantOnSelectionChangedNotifications() { return true; } protected void onSelectionChanged(Object arg0) { super.onSelectionChanged(arg0); throw new RuntimeException('notification '+arg0); } });In my unit Test I do: formTester.select('dropDownChoiceNotified'  0);and the drop down component is not being notified.It works fine when testing in a container though.,0,0
table background='foo' url prefixing,For the src attribute of img tags in the html  the url is automatically prefixed by wicket.It would be nice if that happened for the background property of tables  too.,0,0
Component reAttach and versioning,I'm reAttaching a component doing something like: MyFooPanel p1 = new MyFooPanel(this  'panel'; MyBarPanel p2 = new MyBarPanel(this  'panel'); p1.reAttach(); When I try to restore to the initial page version I found that the component with id 'panel' is not a children component of the page. I have investigated it and I think it is because when the component is reAttached the order in which the changes are added to the ChangesList is:  Add p2. Remove p1.When the initial version is restored the undo functionality is done in reverse mode like   Add p1. Remove p2.The problem is p1 and p2 have the same id  so when p2 is removed what is removing is p1 that has just added. Oscar.,0,0
Uncaught exception guesing urls using CryptedUrlWebRequestCodingStrategy,When used the CryptedUrlWebRequestCodingStrategy strategy in my wicket application I get an uncaught exception when trying to hack urls in the browser address bar.Configuration: @Override protected IRequestCycleProcessor newRequestCycleProcessor() { return new CompoundRequestCycleProcessor(new CryptedUrlWebRequestCodingStrategy( new WebRequestCodingStrategy())  null  null  null  null); } // newRequestCycleProcessor Exception:java.lang.ArrayIndexOutOfBoundsException: 81 at wicket.util.crypt.Base64UrlSafe.decodeBase64(Base64UrlSafe.java:367) at wicket.util.crypt.AbstractCrypt.decryptUrlSafe(AbstractCrypt.java:87) at wicket.protocol.http.request.CryptedUrlWebRequestCodingStrategy.decodeURL(CryptedUrlWebRequestCodingStrategy.java:256) at wicket.protocol.http.request.CryptedUrlWebRequestCodingStrategy.decode(CryptedUrlWebRequestCodingStrategy.java:91) at wicket.Request.getRequestParameters(Request.java:163) at wicket.RequestCycle.step(RequestCycle.java:992) at wicket.RequestCycle.steps(RequestCycle.java:1084) at wicket.RequestCycle.request(RequestCycle.java:454) at wicket.protocol.http.WicketServlet.doGet(WicketServlet.java:219) at javax.servlet.http.HttpServlet.service(HttpServlet.java:697) at javax.servlet.http.HttpServlet.service(HttpServlet.java:810) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:96) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178) at org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:175) at org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:74) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105) at org.jboss.web.tomcat.tc5.jca.CachedConnectionValve.invoke(CachedConnectionValve.java:156) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869) at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664) at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527) at org.apache.tomcat.util.net.MasterSlaveWorkerThread.run(MasterSlaveWorkerThread.java:112) at java.lang.Thread.run(Thread.java:595)I'd except that this exception would be caught an a user is taken to a user friendly error page  possibly the default error page.,0,0
creating a mountBookmarkablePage with PageMap,from wicket-user@lists.sourceforge.net:On 1/18/07  Igor Vaynberg &lt;igor.vaynberg@gmail.com&gt; wrote:lol  yesi think someone got a bit overzealous with typesafety. please create a jira issue for it and we will change PageMap pageMap to String pageMapName-igorOn 1/17/07  Kadir Sener GUMUS &lt;chaoticknight@gmail.com&gt; wrote:Hi i want to mount a bookmarkablePage with custom pagemap parameter in Application.init() but as a normal result i am experiencing with no session error. Because PageMap.forName('') requires a session. so can i ask you what the method 'mountBookmarkablePage(String path  PageMap pageMap  Class bookmarkablePageClass)' is for? where do i have to define that? i couldnt find any usage description for the method. Thanks.Kadir,0,0
Removing comments from markup can fail,Markup with comments in it sometimes causes Wicket to crash with a nasty StringIndexOutOfBoundsException.,0,0
NPE in RequestLogger?,java.lang.NullPointerException at java.util.LinkedList.writeObject(LinkedList.java:755) at sun.reflect.GeneratedMethodAccessor41.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:585) at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:917) at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1339) at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1290) at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1079) at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1375) at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1347) at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1290) at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1079) at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:302) at wicket.util.lang.Objects.sizeof(Objects.java:1058) at wicket.Session.getSizeInBytes(Session.java:627) at wicket.protocol.http.RequestLogger.requestTime(RequestLogger.java:215) at wicket.RequestCycle.detach(RequestCycle.java:882) at wicket.RequestCycle.steps(RequestCycle.java:1118) at wicket.RequestCycle.request(RequestCycle.java:454) at wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:243) at wicket.protocol.http.WicketServlet.doGet(WicketServlet.java:136) at javax.servlet.http.HttpServlet.service(HttpServlet.java:689),0,0
WicketServlet deprecation and WicketFilter,Hi I'm one of the maintainer of ops4j-pax-wicket. Atm  I'm trying tomigrate pax-wicket to wicket-2.0 that can be found at(https://scm.ops4j.org/repos/ops4j/branches/pax/wicket-2.0).One of the problem that I found during migration is the fact thatWicketFilter uses reflection to instantiate application factory byusing the FilterConfig.getInitParam( 'applicationFactoryClassName' ).Since this is not advisable in OSGi (Due to problem of ensuringwhoever export the wicket bundle must have it's classloader be able toload the application factory) and HttpService does not support Filter.It would be better if the old pattern of WicketServlet is supported.&lt;code&gt;public class WicketServlet{ protected WicketFilter newWicketFilter() { return new WicketFilter(); } public void init() { wicketFilter = newWicketFilter(); filter.init(new FilterConfig() { ... }); }}&lt;/code&gt;This way  I would be able to override the instantiation ofWicketFilter without having to reimplement my FilterConfig.For example  my wicket servlet will look like like:&lt;code&gt;final class MyWicketServlet extends WicketServlet{ private final IWebApplicationFactory m_appFactory; MyWicketServlet( IWebApplicationFactory factory ) { m_appFactory = factory; } protected final WicketFilter newWicketFilter() { return new WicketFilter() { protected IWebApplicationFactory getApplicationFactory() { return MyWicketServlet.this.m_appFactory; } }; }}&lt;/code&gt;This way  reflection will not be used anymore in both instantiatingWebApplication (bypassing ContextParamWebApplicationFactory class) andIWebApplicationFactory.Regards Edward YakopNote:Can we please remove the log.info part to mark WicketServlet is deprecated.&lt;code&gt;public WicketServlet(){ // log warning log.info('********************************************'); log.info('DEPRECATED! Please use WicketFilter instead.'); log.info('********************************************');}&lt;/code&gt;Reply from Johan Compagner (jcompagner@gmail.com)We will remove the warnings about the deprication when we will release 1.3/2.0for now we want to point people as much as possible to the wicket filter.The wicket servlet will still be there.So you just want a factory method in wicket servlet where you can make the wicket filter?can you add a RFE for this:https://issues.apache.org/jira/secure/IssueNavigator.jspa?reset=true&amp;mode=hide&amp;pid=12310561&amp;sorter/order=DESC&amp;sorter/field=priority&amp;resolution=-1&amp;component=12311420then i will add the factory method asap.johan,0,0
Allow to set field values before submitting a form with Ajax in WicketTester,I have code to validate {{TextField}}s one by one with ajax. While the code works  I wasn't able to assert it working with WicketTester.The attached quickstart can be used to reproduce the problem on a 2.0 snapshot. The code works in a browser (validity gets toggled true / false when changing the input length)  but WicketTester fails. With WicketTester  the ajax event gets triggered (and it calls validate on the field)  but isValid always returns true.,0,0
pallete: ' is missing in HTML,Index: Palette.html===================================================================&#8212; Palette.html (revision 503672)+++ Palette.html (working copy)@@ -37 7 +37 7 @@ &lt;td class='buttons'&gt; &lt;button type='button' wicket:id='addButton' class='button add'&gt;&lt;img wicket:id='image' src='add.gif'/&gt;&lt;/button&gt;&lt;br/&gt; &lt;button type='button' wicket:id='removeButton' class='button remove'&gt;&lt;img wicket:id='image' src='remove.gif'/&gt;&lt;/button&gt;&lt;br/&gt; &lt;button type='button' wicket:id='moveUpButton' class button up'&gt;&lt;img wicket:id='image' src='up.gif'/&gt;&lt;/button&gt;&lt;br/&gt;+ &lt;button type='button' wicket:id='moveUpButton' class='button up'&gt;&lt;img wicket:id='image' src='up.gif'/&gt;&lt;/button&gt;&lt;br/&gt; &lt;button type='button' wicket:id='moveDownButton' class='button down'&gt;&lt;img wicket:id='image' src='down.gif'/&gt;&lt;/button&gt;&lt;br/&gt; &lt;/td&gt; &lt;td class='pane selection'&gt;,0,0
Calls to enabled and visibleInHierarchy should not be done in component resolving.,Currently  the check(s) on whether a component may receive a call is done too early  namely during resolving the request target. This is a problem when components depend on things being initialized in the page or component using detachement. There is also some code duplication. The proper place for this check is in RequestListenerInterface#invoke.,0,0
EmailAddressPatternValidator does not correctly identify TLDs with more than 3 letters,The following is already fixed in wicket-1.2  but doesn't seem to have made it into 2.0 yet. The following looks like a valid regex for this:^&#91;_A-Za-z0-9-&#93;(//.&#91;_A-Za-z0-9-&#93;)@&#91;A-Za-z0-9-&#93;(//.&#91;A-Za-z0-9-&#93;)((.&#91;A-Za-z&#93;{2 }){1}$),0,0
Remove IRequestTarget.getLock and the synchronize blocks using it,Synchronization is now done in Session#getPage  which is a better place and makes IRequestTarget#getLock redundant. We should remove that method and the code that depends on it.,0,1
PackageRequestTargetUrlCodingStrategy should interrupts the cycle and sends a 404 when a page/class cannot be found.,Using PackageRequestTargetUrlCodingStrategy and manually hacking the url in the browser will throw up a RuntimeException if it cannot load a corresponding page class. Same could happen if the bookmarkable page does not exist anymore  etc... see stacktrace below.The expected behavior is to interrupt the cycle and sends a 404.wicket.WicketRuntimeException: Unable to load class with name: com.mycompany.wicket.pages.xyzw at wicket.application.DefaultClassResolver.resolveClass(DefaultClassResolver.java:70) at wicket.request.target.coding.PackageRequestTargetUrlCodingStrategy.decode(PackageRequestTargetUrlCodingStrategy.java:80) at wicket.protocol.http.request.WebRequestCodingStrategy.targetForRequest(WebRequestCodingStrategy.java:363) at wicket.protocol.http.request.CryptedUrlWebRequestCodingStrategy.targetForRequest(CryptedUrlWebRequestCodingStrategy.java:154) at wicket.request.compound.DefaultRequestTargetResolverStrategy.resolve(DefaultRequestTargetResolverStrategy.java:84) at wicket.request.compound.AbstractCompoundRequestCycleProcessor.resolve(AbstractCompoundRequestCycleProcessor.java:47) at wicket.RequestCycle.step(RequestCycle.java:1008) at wicket.RequestCycle.steps(RequestCycle.java:1100) at wicket.RequestCycle.request(RequestCycle.java:454) at wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:243) at wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:122),0,0
Translation for Czech language,Hi  here is translation of Application properties for Czech language (for wicket-1.2.5)  file name Application_cs.properties.,0,0
AjaxEditableLabel on setModel does not update the labels model only the editors,The AjaxEditableLabel when you perform a setModel() it will go ahead and update the underlying model of the editor however  it does not update the underlying model of the Label,0,0
Download link does not set Content-Type and Content-Length headers,When using a wicket download link  response headers Content-Type and Content-Length headers are not set.,0,0
CheckBox incorrectly converts its model value when a custom Boolean converter is installed,When I use a custom localized Boolean converter (using my custom IConverterLocator) that converts 'Ano' to true and 'Ne' to false (Czech words for 'yes' and 'no') the CheckBox with 'true' getModelObject() will render unchecked. The problem is that CheckBox uses Strings.isTrue() to convert a value returned by getModelObjectAsString() which uses converters. The result is that true is incorrectly converted to false...true -&gt; convertToString() -&gt; 'Ano' -&gt; Strings.isTrue() -&gt; false,0,0
Inheritable model cannot be a wrap model,In the code of Component:initModel()  when it comes accross an IWrapModel  it always gets its nested model  not considering if this model itself might be an IInheritableModel. for (Component current = getParent(); current != null; current = current.getParent()) { // Get model IModel model = current.getModel(); if (model instanceof IWrapModel) { model = ((IWrapModel)model).getNestedModel(); } if (model instanceof IInheritableModel) { .... } }Would it be correct do make the following correction ? if (model instanceof IWrapModel &amp;&amp; !(model instanceof IInheritableModel)) { model = ((IWrapModel)model).getNestedModel(); },0,0
clock component doesn't display seconds in some Locales,The Clock component used in ajax Clock and WorldClock examples do not show the seconds with some locales (at least with french locale). This make the example less easy to see in action (updated only once a minute).Replacing:df = DateFormat.getDateTimeInstance(DateFormat.FULL  DateFormat.FULL);by:df = DateFormat.getDateTimeInstance(DateFormat.FULL  DateFormat.FULL  Locale.US);would make it behave the same whatever the default locale is.,0,0
BookmarkablePageLink only sets the target attribute when it exists in the markup,BookmarkablePageLink adds an attribute modifier to itself when setPageMap is called. However  it creates the attribute modifier in such a fashion that it is only applied when the target attribute is already in the markup. The initial goal to implement it like that was to make the change unobtrusive. I'm backtracking on that now though  as I now think it is actually half baked. I'd like to change the behavior so that it /always/ sets the target when you call setPageMap on it. This would mean that you'll popup another window if you try to link to a different page map in the same screen  but you shouldn't do that anyway.See http://www.nabble.com/Re%3A-Extending-wicket.markup.html.tree.Tree-p9273422.html for a problem this would fix.,0,0
Add ability to manage disabled items from subclasses of AbstractChoice,AbstractChoice does almost everything but disabled items. This patch adds that ability.This is my first patch to Wicket. I had some question about whether to include a default implementation for isDisabled()  but that would have required a Map to be supplied. Then I started wondering about whether four more ctors should be provided to pass in the map. Then I decided it was better managed by the subclass. It can always be improved later.,0,0
@SpringBean support of non-singleton beans,Two fixes:In wicket-spring: SpringBeanLocator got a new property called singletonBean  which is true if the bean is a singleton(the property is set in the constructor)In wicket-spring-annot:AnnotProxyFieldValueFactory is modified that if the bean is a non-singleton  then bypass the cache,0,0
Some components miss localization (NavigatorLabel  Palette),wicket.extensions.markup.html.repeater.data.table.NavigatorLabel should be localized. Now there's hard coded string Showing xxx to yyy of zzzwicket.extensions.markup.html.form.palette.Palette - method newAvailableHeader and newSelectedHeader. It think it should be better to use localized model instead of hardcoded strings 'Available' and 'Selected',0,0
Converter misusage/mangling in RadioChoice,1.x RadioChoice:433 is doing conversion. I don't think it should be.I think the default ChoiceRenderer should be doing the conversion  and that if you supply your own  no conversion should be done.,0,0
[Patch] do not serialize choices and select in palette.,It takes a long useless time,0,0
Wicket.Focus code utterly breaks AjaxEditableLabel,The Wicket.Focus javascript is nice and clever  but isn't clever enough - we've overlooked the use case where people want to set the focus in their AJAX callback to another component.This is particularly bad for the AjaxEditableLabel case  because onblur() on the text field that it pops up causes it to submit the value back to the server and finish the editing process and go away. So the text field pops up  and then wicket moves the focus somewhere else  so it goes away again immediately. Maybe a good stab at fixing 90% of the problem would be to see if the JS in the response has the word 'focus' in it  and not do the focusing if it does?Looking at the user list  I think Johan is the Wicket.Focus man  so I'm assigning this to him. Johan - if this isn't really your domain  obviously feel free to unassign and accept my apologies.,0,0
DropDownChoice  empty Model wrong default encoding of special chars,Iv the DDChoice is empty at first  you get a 'Bitte Auswﾃ､hlen' wich is wrongly decoded as 'Bitte Ausw?%len' - so the encoding needs to be checked that it gets correctly encoded according to HTML like &auml;,0,0
Using Borders with Markup Inheritance causes component resolution failures,If a Border is used by the BasePage in a markup inheritance implementation  Wicket is unable to resolve any of the components in the child page.I will attach a simple testcase for this.,0,0
Handle / servlet mapping or fail consistenly,See WICKET-395We should either handle the / mapping  or if it's too difficult  throw an exception in WicketFilter when / is met in web.xml.,0,0
Be able to add string arrays to configuration of DatePicker,As it stands the DatePicker doesnﾂｴt allow the user to configure anything but simple values as configuration for the YUI Calendar. This is problematic if you want to change the weekdays / month labels etc...,0,0
Ajax requests don't detach component models,After ajax request the component models are not detached. Page onDetach should detach those models  but since the page itself is not attached  the onDetach method is not called.It's necessary to always call page.detachModels after request. And we should only call page.detach from the request target. The ajax request target should not page.detach  as the behaviorrequesttarget should do that.,0,0
NullPointerException in MarkupFragmentFinder.find(),If ID of any component in MarkupStream is null (for example in ends with tags)  the method MarkupFragmentFinder.find() may crash. See patch...,0,0
improved reporting on locked page maps,It would be cool if we could log some more information on which request is locking another request when it times out. Currently  we get an error like:exception: After 1 minute the Pagemap null is still locked by: Thread&#91;Jetty thread-105 5 main&#93;  giving up trying to get the page for path: 0:1but Thread&#91;Jetty thread-105 5 main&#93; is hardly useful in a log. More useful would be e.g. the request target.,0,0
mvn jetty:run; maven-jetty-plugin not configured,maven-jetty-plugin not configured for wicket-quickstart.,0,0
Add global override to disable gzip compression (SAP double-compresses).,It should be possible to deactivate gzip compression. Sometimes gzip is already handled by a proxy server or gzip raises problems (like I experienced on SAP J2EE Enterprise Server).Default should be 'on'.It's always good to have an option.,0,1
Feedback is not cleaned up upon AJAX-requests,When doing validation with AjaxFormComponentUpdatingBehavior once an error message is attached to a component it gets sticky and is not refreshed upon new ajax requests. It seems as if feedback is not cleaned up so onEvent always takes the hasError branch  independently of validation results.,0,0
Investigate whether we can use component meta data for the storage of feedback messages,Investigate this. See also http://www.nabble.com/Re%3A-svn-commit%3A-r530991---in--incubator-wicket-trunk-jdk-1.4-wicket-src-main-java-org-apache-wicket%3A-Session.java-feedback-FeedbackMessages.java-p10119808.htmlAdvantages of doing this: it is a one-one mapping of the concept that you set a message on a component; you'll never have to worry about cleanup up; just clean up rendered messages  and leave unrendered for whenever they are request or until the component is garbage collected.Disadvantages: no central storage place  making it harder to track. probably less efficient in both storage and processing.,0,0
JavaScript comment stripping doesn't handle regexps,The following line is crippled when using javascript comment stripping(from jquery.js) // Handle the common XPath // expression if ( !t.indexOf('//') ) {it will be result in if ( !t.indexOf('the // inside the string quotes are taken as a comment instead of as a string...,0,0
Change name of IFormProcessingListener,See http://www.nabble.com/what-is-the-use-case-for-IFormProcessingListener-tf3635720.html#a10152501,0,0
ModalWindow does not function under Opera,Initial ModalWindow appears  but with the title: 'Blank Page'. The window remains unpopulated.,0,0
Better error message for problematic configuration,Useful when for example build fails to set up configuration.,0,0
HeaderContributions are missing if  is a Component.,&#8212; issue copy-pasted from mailing list &#8212;On 5/9/07  Peter Ertl &lt;peter.ertl@gmx.net&gt; wrote:Hi folks I try to setup a multi-language website like that:&lt;? xml version= '1.0' encoding ='UTF-8' ?&gt;&lt;! DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'&gt;&lt;html wicket:id='html' xmlns:wicket xmlns=' http://www.w3.org/1999/xhtml'xmlns:lang=&#91;current language&#93; lang=&#91;current language&#93;&gt;....However  accessing &lt;html&gt; using a wicket:id will fail:org.apache.wicket.WicketRuntimeException: Programmingerror: 'parent' should be a Page or a Border.changing the tag using a MarkupFilter will also fail as it requires tovalue of the current locale of WebSessionbut the markup filter seems to allow no access to it.It would be straightforward to just access html using a wicket:id...imho this would be a great enhancement!Can somebody think of a better solution?On 5/9/07  Johan Compagner &lt;jcompagner@gmail.com&gt; wrote:hmm this is because of the HtmlHeaderContainer that container wants a pageto be its parent.So you can't attach a wicket container to the html because then youencapsulate the complete page.i dont know immediantly how to solve this,0,0
Use WebRequestEncoder everywhere a query string is constructed,,0,0
LocalizedImageResource escapes ampersands twice (regression),urlFor returns escaped ampersands (apparently  a change) so LocalizedImageResource should not do it a second time.,0,0
tests should be test,In pom.xml for extension  the following is a typo: &lt;dependency&gt; &lt;groupId&gt;org.apache.wicket&lt;/groupId&gt; &lt;artifactId&gt;wicket&lt;/artifactId&gt; &lt;classifier&gt;tests&lt;/classifier&gt; &lt;scope&gt;tests&lt;/scope&gt;&lt;------------ should be &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt;Now when using mvn eclipse:eclipse and mvn war I get an extra unnecessary test jar,0,0
WicketTester does not bind created Session to SessionStore,The WicketTester constructor  via a call to MockWebApplication.createRequestCycle()  creates a new session but fails to bind it: this.wicketSession = (WebSession) Session.findOrCreate();This means that the session subsequently gets over-written by a new one created in a later call to WicketTester.startPage(). This causes problems for any unit tests which want to set up session data after instantiating a WicketTester  but before calling WicketTester.startPage().The MockWebApplication.createRequestCycle() should probably bind the session immediately after creating it: this.wicketSession = (WebSession) Session.findOrCreate(); getApplication().getSessionStore().bind(getWicketRequest()  wicketSession);Then subsequent calls to startPage() will use this session rather than create a new one.,0,0
TimeOfDay.next(Calendar) can return time on same day rather than next day,Currently code does: calendar.add(Calendar.DATE  1); return Time.valueOf(calendar  this);Because Time.valueOf(Calendar  TimeOfDay) always returns the time on the same day  the add is ignored. Instead this code should be the time of day today plus one day like this: return Time.valueOf(calendar  this).add(Duration.ONE_DAY);,0,0
AbstractTextComponent#setConvertEmptyInputStringToNull(true) does not work with IObjectClassAwareModels (affects TextField  etc.),The unit tests ought to cover this  but apparently don't. A TextField should convert empty strings to nulls if you call setConvertEmptyInputStringToNull(true) on it (which the constructors do by default).However  this doesn't currently work: AbstractTextComponent#getConvertEmptyInputStringToNull() is only called from AbstractTextComponent#convertValue(String[]). AbstractTextComponent#convertValue(String[]) is called from FormComponent#convert()  but only if the component doesn't have a type assigned to it. As soon as you use a PropertyModel (which implements IObjectClassAwareModel)  this means empty strings are no longer converted to nulls.This is obviously a great big blocker and needs fixing ASAP.,0,0
HeaderContributor forces relative URL,I consider this a bug  and was wondering if you do as well... If so  I will open a JIRA and attach a patch for it. Just let me know.In my 1.2.6 app  I have the following line:add(HeaderContributor.forCss('/resources/styles/global.css'));which generates this in the markup (correctly):&lt;link rel ='stylesheet' type='text/css' href='/resources/css/global.css' &gt;&lt;/link&gt;In 1.3  it generates this in the markup (incorrectly):&lt;link rel ='stylesheet' type='text/css' href='../../..//resources/styles/global.css' &gt;&lt;/link&gt;This is because of the change to have everything with relative URLs  I am assuming. But  I don't want a relative URL  I want an absolute one. I'm thinking that the following change would be appropriate:HeaderContributor.java (26)if (location.startsWith('http://') || location.startsWith('https://'))changed to:if (location.startsWith('http://') || location.startsWith('https://') || location.startsWith('/')),0,0
Prototype scoped Spring beans,I copied the following text from my discussion on wicket-user  and was asked to open an issue  so here it is:http://www.nabble.com/Prototype-scoped-Spring-beans-tf3849285.htmlFor a more complex form I wanted to use a 'stateful' Springbean  to which I applied scope='prototype'. The idea is to have one bean instance for every Form instance. I would access the bean with PropertyModels and direct method calls during construction (i.e. setting initial state from input parameters) and during events  which would alter the state. I inject the bean into the Form with @SpringBean annotation.This works somehow  but sometimes  especially after using the backbutton  I had the problem that the internal state was reset. So I analyzed the stack in the constructor of the bean implementation  and found out that it was called twice during construction of the Form. First  during the super() call  and then again in the next line during a method call on that bean. I appended both stacktraces below. The proxy itself does not change.This happens again after going back and e.g. submitting again. This results in a NPE  because the internal state is reset.I understand from reading the mailing list that the Wicket-Proxy does nothing but a lookup in the Application context  and does not know or care about spring scope.And here I'm a little stuck. I am already considering to put the state into the Form  and make the Bean a singleton without any internal state. As that would mean some heavy refactoring  I would prefer a way where the Spring acces would work as I want. Or is this a wrong way altogether?,0,0
WicketFilter tries to call setClassLoader() even if it's not changing the default - doesn't work on strict SecurityManagers.,As summary. Solution is to avoid setting the classloader if it's not actually changed.,0,0
Resource.getParameters() empty when resource is mounted,After migrating my application from 1.2.6 to 1.3.0-incubating-SNAPSHOT mounted shared resources (rss feeds  uploaded images) stopped working.DynamicWebResource.getParameters().getXXX() returns with null if the resource is mounted via Application.mountSharedResource but it works fine when the resource is not mounted.,0,1
wicket-examples grey-on-white colour scheme is very hard to read,The current wicket-examples colour scheme is light grey text on a white background. This is very low in contrast  and difficult to read.In the source code views  which unlike the rest  use a smaller serif font  this is especially noticeable.Even something as simple as switching to plain black on white would be an immediate benefit.,0,0
wicket-examples source code view is not resizable,The wicket-examples source code view is not resizable  and is rather small on larger screens.,0,0
fire onchange event of associated component after date selection,sometimes it's desirable to be notified after a date was selected.therefore the change event (onchange() method) of the associated component should be fired.to not break existing code  a second constructor should be added to specify whether the event should be fired  whereas the default behavior is to not fire the event.,0,0
enhance ichoicerenderer with id->choice object lookup,add object idtochoice(string id) to ichoicerenderer and add class choicerenderer implements ichoicerenderer that encapsulate the default linear searchthen we can remove method added in WICKET-348 to support a custom lookup,0,1
[PATCH] remove XX in firefox and palette,I know it is a firefox bug but we can workaround (at least into palette) this with the attach patch,0,0
AjaxEditableLabel needs Model for adding a IValidator,If you add a IValidator to a AjaxEditableLabel which has no model yet  one gets the following Exception:java.lang.IllegalStateException: No model found for this component  either pass one explicitly or make sure an inheritable model is available. This component is not added to a parent yet  so if this component is supposed to use the model of the parent (e.g. when it uses a compound property model)  add it first before further configuring the component calling methods like e.g. setType and addValidator. at org.apache.wicket.extensions.ajax.markup.html.AjaxEditableLabel.getParentModel(AjaxEditableLabel.java:450) at org.apache.wicket.extensions.ajax.markup.html.AjaxEditableLabel.getEditor(AjaxEditableLabel.java:310) at org.apache.wicket.extensions.ajax.markup.html.AjaxEditableLabel.add(AjaxEditableLabel.java:194)The error message is very clear. There should be a small hint in the JavaDoc for add(IValidator):/** Adds a validator to this form component. A model must be available for this component before Validators can be added. Either add this Component to its parent (already having a Model)  or provide one directly before this call via constructor {@link #AjaxEditableLabel(String IModel)} or {@link #setModel(IModel)}.  @param validator The validator @return This */,0,0
DateTextField is too session-heavy,org.apache.wicket.extensions.markup.html.form.DateTextField seems too heavy for http session - it holds SimpleDateFormat instance which in turn holds DateFormatSymbols instance which in turn has several arrays inside.,0,1
ReloadingWicketFilter not working with markup inheritance,This is happening for latest snapshot (2007-06-22). Last time I refreshed from Maven was 2007-06-06 when things were working fine.Problem occurs when I use the ReloadingWicketFilter  does not matter if in Wicket development mode or not.My login page is not using markup inheritance  it works fine. But after login success  next page (home page) causes this error:=========2007-06-22 22:46:15 531 &#91;btpool0-6&#93; DEBUG &#91;org.apache.wicket.application.ReloadingClassLoader&#93; - clzLocation=/E:/peter/jtrac-trunk/jtrac/target/jtrac/WEB-INF/classes/info/jtrac/wicket/BasePage.class2007-06-22 22:46:15 562 &#91;btpool0-6&#93; INFO &#91;org.apache.wicket.application.ReloadingClassLoader&#93; - Watching changes of class E:/peter/jtrac-trunk/jtrac/target/jtrac/WEB-INF/classes/info/jtrac/wicket/BasePage.class2007-06-22 22:46:15 562 &#91;btpool0-6&#93; DEBUG &#91;org.apache.wicket.application.ReloadingClassLoader&#93; - clzLocation=/E:/peter/jtrac-trunk/jtrac/target/jtrac/WEB-INF/classes/info/jtrac/wicket/DashboardPage.class2007-06-22 22:46:15 562 &#91;btpool0-6&#93; INFO &#91;org.apache.wicket.application.ReloadingClassLoader&#93; - Watching changes of class E:/peter/jtrac-trunk/jtrac/target/jtrac/WEB-INF/classes/info/jtrac/wicket/DashboardPage.class2007-06-22 22:46:15 562 &#91;btpool0-6&#93; ERROR &#91;org.apache.wicket.RequestCycle&#93; - Markup of type 'html' for component 'info.jtrac.wicket.DashboardPage' not found. Enable debug messages for org.apache.wicket.util.resource to get a list of all filenames tried:&#91;Page class = info.jtrac.wicket.DashboardPage  id = 1  version = 0&#93;org.apache.wicket.markup.MarkupNotFoundException: Markup of type 'html' for component 'info.jtrac.wicket.DashboardPage' not found. Enable debug messages for org.apache.wicket.util.resource to get a list of all filenames tried:&#91;Page class = info.jtrac.wicket.DashboardPage  id = 1  version = 0&#93; at org.apache.wicket.MarkupContainer.getAssociatedMarkupStream(MarkupContainer.java:342) at org.apache.wicket.markup.html.WebPage.onBeforeRender(WebPage.java:363) at org.apache.wicket.Component.beforeRender(Component.java:846) at org.apache.wicket.Page.renderPage(Page.java:885) at org.apache.wicket.request.target.component.BookmarkablePageRequestTarget.respond(BookmarkablePageRequestTarget.java:225)============Root cause:org.apache.wicket.WicketRuntimeException: Parameter clazz must be instance of containerat org.apache.wicket.markup.MarkupCache.getMarkup(MarkupCache.java:244)at org.apache.wicket.markup.loader.InheritedMarkupMarkupLoader.checkForMarkupInheritance(InheritedMarkupMarkupLoader.java:99)at org.apache.wicket.markup.loader.InheritedMarkupMarkupLoader.loadMarkup(InheritedMarkupMarkupLoader.java:65)at org.apache.wicket.markup.loader.DefaultMarkupLoader.loadMarkup(DefaultMarkupLoader.java:56)at org.apache.wicket.markup.MarkupCache.loadMarkup(MarkupCache.java:389)at org.apache.wicket.markup.MarkupCache.loadMarkupAndWatchForChanges(MarkupCache.java:462)at org.apache.wicket.markup.MarkupCache.getMarkup(MarkupCache.java:282)at org.apache.wicket.markup.MarkupCache.getMarkupStream(MarkupCache.java:188)at org.apache.wicket.MarkupContainer.getAssociatedMarkupStream(MarkupContainer.java:331)at org.apache.wicket.markup.html.WebPage.onBeforeRender(WebPage.java:363)at org.apache.wicket.Component.beforeRender(Component.java:846)at org.apache.wicket.Page.renderPage(Page.java:885)at org.apache.wicket.request.target.component.BookmarkablePageRequestTarget.respond(BookmarkablePageRequestTarget.java:225)===========Couple of other points  if I now type in the URL of another page which is bookmarkable  that works and from there if I go to the home page things are fine. Looks like now the class + markup gets cached etc.Another thing is if in my extension of ReloadingWicketFilter I exclude the class that is the base page for markup inheritance  things start working but I get a different class conflict error somewhere deep in the navigation and component hierarchy  let me know if you need me to send the lof for this also.If this is of any relevance  I am using a custom AuthorizationStrategy - so that is how the login page comes up in the first place: throw new RestartResponseAtInterceptPageException(LoginPage.class) - and then from Login page I do continueToOriginalDestination() - maybe this has something to do with it?,0,0
Border.resolve() should not attempt to render contents if bodyVisible is false,Border.resolve() should not attempt to render its nested components if setBorderBodyVisible(false) has been called. This way the behavior would be similar to Component.setVisible() - when the contents are not visible  wicket would not raise an exception if there are no corresponding components for the border's markup.,0,0
If the model is List  PropertyResolver doesn't try to find fields.,,0,0
AjaxEditableChoiceLabel doesn't work,AjaxEditableChoiceLabel doesn't init properly - it always creates DropDownChoice with null in the choices field. The newEditor() method is called from the AjaxEditableLabel constructor and at that time AjaxEditableChoiceLabel.choices is not initialized yet.,0,0
Invoking a request listener on a page returns an Expired Error page,The Page object being a Component should support the Wicket request listener mechanism. But invoking a request listener on page defined listener object it results in a 'Page Expired' error page. To reproduce it try the following code:public interface IHelloListener extends IRequestListener{ public static final RequestListenerInterface INTERFACE = new RequestListenerInterface(IHelloListener.class); void onHello();}public class HelloWorld extends WebPage implements IHelloListener{ public HelloWorld() { add(new Label('message'  'Hello World!')); WebMarkupContainer link = new WebMarkupContainer('link'); link.add(new SimpleAttributeModifier('href'  RequestCycle.get().urlFor(this  IHelloListener.INTERFACE))); add(link); } public void onHello() { RequestCycle.get().setRequestTarget(new IRequestTarget() { public void detach(RequestCycle requestCycle) { } public void respond(RequestCycle requestCycle) { requestCycle.getResponse().write('&lt;html&gt;&lt;body&gt;HELLO!&lt;/body&gt;&lt;/html&gt;'); } public Object getLock(RequestCycle requestCycle) { return null; } }); }},0,0
Unable to remove an IFormValidator from a Form,It seems that there is no way to remove an IFormValidator from a Form. Because the fields in my Form are inside Panels (only one of which is present at any given time)  the Form fields are not necessarily children of the Form. When one of the Form's IFormValidators receives a getDependentFormComponents call  it (correctly  I believe) returns the form components that it validates. An exception occurs when getParent is called on these components (in attempt to find the Form somewhere up the hierarchy) up the call stack. Since the change in the Panel that's present is made via an Ajax update  the same update would be able to remove the offending IFormValidator when its Panel is removed. (That is  if there was a method in Form to remove an IFormValidator.) For now  I've hacked it so that my IFormValidator checks whether all its Form Components all have parents before any of its methods return non-null values. (I'm not just changing the Panel visibility because then the hidden Panels would still get validated  and I don't want that to happen.),0,0
make getConvertedInput final again and remove final from convert  which should be renamed to convertInput,See http://www.nabble.com/Re%3A-Use-getConverterInput-rather-than-updateModel-in-FormComponentPanel-p11399356.html,0,0
make default maximum upload size an application setting,Current  the default maximum upload size is defined in Form as: /** Maximum size of an upload in bytes */ private Bytes maxSize = Bytes.MAX;It would be better to make this an application setting.,0,0
WicketTester cause SerializableChecker$WicketNotSerializableException,When turn on logger level to info  testing with wicketTester see lots of SerializableChecker$WicketNotSerializableException stacktrace:ERROR - Objects - Error serializing object class org.apache.wicket.util.tester.DummyHomePage [object=&#91;Page class = org.apache.wicket.util.tester.DummyHomePage  id = 0  version = 0&#93;]org.apache.wicket.util.io.SerializableChecker$WicketNotSerializableException: Unable to serialize class: org.apache.wicket.util.tester.WicketTesterTestField hierarchy is: 0 &#91;class=org.apache.wicket.util.tester.DummyHomePage  path=0&#93; private org.apache.wicket.util.tester.ITestPageSource org.apache.wicket.util.tester.DummyHomePage.testPageSource &#91;class=org.apache.wicket.util.tester.WicketTesterTest$1&#93; final org.apache.wicket.util.tester.WicketTesterTest org.apache.wicket.util.tester.WicketTesterTest$1.this$0 &#91;class=org.apache.wicket.util.tester.WicketTesterTest&#93; &lt;----- field that is not serializable at org.apache.wicket.util.io.SerializableChecker.check(SerializableChecker.java:347) at org.apache.wicket.util.io.SerializableChecker.checkFields(SerializableChecker.java:615)The cause of error is annoymous inner class ITestPageSource:tester.startPage(new ITestPageSource(){ private static final long serialVersionUID = 1L; public Page getTestPage() { Book mockBook = new Book('xxId'  'xxName'); return new ViewBook(mockBook); }});annonymous ITestPageSource instance reference to TestCase and TestCase is not serializable.To avoid serialize TestCase  we can make ITestPageSource field of DummyHomePage transient:public class DummyHomePage extends WebPage{ private transient ITestPageSource testPageSource;....},0,0
WicketTester could not handle Multipart form without upload,When testing the form that contains FileUploadField without upload  wicketTester throw exception with message: 'ServletRequest does not contain multipart content'// ex:public class FormTesterTest extends WicketTestCase{ /** Test that formTester deal with Multipart form correctly when no actual upload */ public void testSubmitWithoutUploadFile() { tester.startPage(MockFormFileUploadPage.class); MockFormFileUploadPage page = (MockFormFileUploadPage)tester.getLastRenderedPage(); Session.get().setLocale(Locale.US); FormTester formTester = tester.newFormTester('form'); // without file upload formTester.submit(); assertNull(page.getFileUpload()); tester.assertErrorMessages(new String[] { 'Field 'file' is required.' }); }}The cause is that Form contains FileUploadField is considered as multipart. But MockHttpServletRequest only generate Multipart contentType and contentLength when there is any upload file added via formTester.setFile(...). Thus without any file upload while testing  MultipartServletWebRequest throw exception.To solve this  I try to introduce a flag useMultiPartContentType in MockHttpServletRequest  so FormTester can change MockHttpServletRequest to generate correct contentType.attachment is patch,0,0
OnChangeAjaxBehavior does not work with  when using Safari,With the latest 1.3.0-SNAPSHOT  the following does not work with Safari 2.0.4. The handler is never invoked and the AJAX debug console shows absolutely no activity. The exact same code works with Firefox 2.0.0.4.import java.io.Serializable;import org.apache.wicket.ajax.AjaxRequestTarget;import org.apache.wicket.ajax.form.OnChangeAjaxBehavior;import org.apache.wicket.markup.html.WebPage;import org.apache.wicket.markup.html.form.Form;import org.apache.wicket.markup.html.form.TextArea;import org.apache.wicket.model.Model;import org.apache.wicket.model.PropertyModel;public class WicketBugPage extends WebPage { public WicketBugPage() { super(new Model(new Item())); Form form = new Form('form'); add(form); TextArea description = new TextArea('description'  new PropertyModel(getModel()  'description')); description.add(new OnChangeAjaxBehavior() { @Override protected void onUpdate(AjaxRequestTarget target) { Item item = (Item) getModelObject(); System.out.println(item.getDescription()); } }); form.add(description); } public static class Item implements Serializable { private String description; public void setDescription(String description) { this.description = description; } public String getDescription() { return description; } }}&lt;html&gt;&lt;body&gt; &lt;form wicket:id='form'&gt; &lt;textarea wicket:id='description'&gt;&lt;/textarea&gt; &lt;/form&gt;&lt;/body&gt;&lt;/html&gt;,0,0
Qualified resource key should take priority over unqualified one,Currently an unqualified resource key should take priority over a qualified one? eg  in a properties file:Required=The ${label} is missing!form.username.Required=You must provide your name!The first entry will take priority  while common intuition is that the first one is the default and the second one is overriding it.Please consider reversing it. Thanks!,0,0
setVisible(false) on Page throws NPE,Found this by accident while looking for a bug involving misplaced parenthesis add(..).setVisible(false) instead of add(.. .setVisible(false) );public class MyPage extends Page { MyPage() { ... setVisible(false); }...}GivesUnexpected RuntimeExceptionRoot cause:java.lang.NullPointerExceptionat org.apache.wicket.Component.render(Component.java:1977)at org.apache.wicket.Page.renderPage(Page.java:927)at org.apache.wicket.request.target.component.BookmarkablePageRequestTarget.respond(BookmarkablePageRequestTarget.java:225)at org.apache.wicket.request.AbstractRequestCycleProcessor.respond(AbstractRequestCycleProcessor.java:103)at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1037)at org.apache.wicket.RequestCycle.step(RequestCycle.java:1107)at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1176)at org.apache.wicket.RequestCycle.request(RequestCycle.java:499)at org.apache.wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:257)at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:127)at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1089)at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:365)at org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181)at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:712)at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:405)at org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114)at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:139)at org.mortbay.jetty.Server.handle(Server.java:285)at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:502)at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:821)at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:513)at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:208)at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:378)at org.mortbay.jetty.bio.SocketConnector$Connection.run(SocketConnector.java:226)at org.mortbay.thread.BoundedThreadPool$PoolThread.run(BoundedThreadPool.java:442),0,0
ServletWebRequest.getRelativePathPrefixToContextRoot generates wrong relative path if current page has URL-encoding in the params.,Actually  this is against 1.3.0-SNAPSHOT revision: 554607I have been trying to find a very annoying  seeminly sporadic  glitch where my images that are relative to the context wouldn't 'find' the image file. Looking at the source  they would have 11 sets of '..' versus the 5 sets that the other resources would have. Here is how I was trying to display the image:&lt;img src='images/find.png'/&gt; I was finally able to produce a scenario in a quickstart to prove the problem exists. It seems that getPath() and getServletPath() don't work the same way  in that I mean  getPath() had the '{' encoded as '%7B' whereas getServletPath() was not encoded.Therefore  this test fails and the path is not properly handled! if (servletPath.endsWith(path)),0,0
add support for localization,currently  the default language (english) of YUI calendar is used. this makes the datepicker in nonenglish applications quite unusable.i will soon submit a patch with a .properties-file approach.,0,0
Disable line-precise exceptions for component use check,vote here:http://www.nabble.com/-VOTE--disable-line-precise-error-reporting-by-default-tf4037146.html#a11469624while looking in the code i noticed that line-precise information is collected under the same setting as component-use-check. i think the exception part should be factored out into a separate setting. component use check is still very valuable without line-precise information and has no perceptible slow down like the line-precise exceptions.,0,1
default pagemap name of null is not always properly encoded into the url,when pagemap name happens to be the last url parameter and coding strategy is /param1/value1/ the url ends up looking like:/param1/value1/wicket:pageMapName/which when split on '/' produces{param1 value1 wicket:pageMapName}which causesjava.lang.IllegalStateException: URL fragment has unmatched key/value,0,0
Select doesn't validate 'Required',The Select-Component doesn't validate 'Required' if current user-selection points to an empty value in drop-down-mode.,0,0
Easy access to final rendered page source,I'd like a way to run pages through Wicket so that I can grab the final HTML and use it elsewhere (as an email body  for instance). I've been working on it and I've got a working solution  but there is still a snag.Spawned from this thread:http://www.nabble.com/How-to-get-HTML-source-code-from-a-wicket-page-tf3968790.html#a11265339Chunk of working code:http://www.nabble.com/How-to-get-HTML-source-code-from-a-wicket-page-tf3968790.html#a11548230Current existing hurdle:http://www.nabble.com/RequestCycle-goes-null-after-using-WicketTester-within-Wicket-page-tf4153591.htmlOnce I can get this simple bit to work  I'll add parameters and what not...,0,0
setresponsepage() does not properly redirect from ajax requests,if you are on a mounted page with parameters  lets say/context/page/param1/param2/and you call setresponsepage() from an NORMAL link on that page you will land on/context/?wicket:interface=...which is correct  however if you do it from an ajax link like so: onclick(ajaxrequesttarget target) { setresponsepage(new mypage()); } you will land on /context/page/param1/param2/?wicket:interface=...which is INCORRECTl. notice that the mount and params were not stripped. also now because wicket thinks url depth is 0 urls will break  for example a resource requested from that page will be:/context/page/param1/param2/resources/..... woopsiewhy this happens:when setresponsepage is called the ?wicket:interface:foo::: url is constructed and passed to webresponse.redirect(url) which in turn calls httpServletResponse.sendRedirect(url); for normal responses or httpServletResponse.addHeader('Ajax-Location'  url); for ajax responses. the big difference is how servletresponse handles this  and from the javadoc: This method can accept relative URLs; the servlet container will convert the relative URL to an absolute URL before sending the response to the client. so what needs to be done is that httpServletResponse.addHeader('Ajax-Location'  url); also needs to mangle the url and make it absolute.since you are the proxy guy and i dont know how this will play into that i am assigning it to you,0,0
upgrade to SLF4J to version 1.4.2,SLF4J 1.4.2 was released in July 2007. Can we upgrade SLF4J in the Maven pom?,0,0
MockHttpServletRequest.addFile does not work with binary files,http://www.nabble.com/Uploading-binary-files-via-MockHttpServletRequest-tf4192893.html#a11934991As stated in the thread  I can upload text (xml) files just fine but binary data does not work. I suspect there are some encoding issues which cause the binary data to be corrupted. buildRequest() looks like it is corrupting the binary data when it pushes the data into String format. I don't think this is right - you should treat the request as a byte array  not a String. I think the MIME or HTTP RFCs might have more info on how binary data is supposed to be packaged within an HTTP request.,0,0
Empty content inserted into Border - throws ugly exceptions,This can be easily reproduced wirth wicket-examples/template/templating using border.Please open: org.apache.wicket.examples.template.border.Page1ant cut ALL the contents inside span  wicket:id='border'It should look like this: &lt;span wicket:id='border'&gt;&lt;/span&gt;After this  the page renders nicely.But if you change it to look like this: &lt;span wicket:id='border' /&gt;there are tons of exceptions that do not say anything useful.I have spent 1 full day fighting with this before I found the reason in my little app.,0,0
Session id encoding problem in cookie-less mode,If I disable session cookies  the URL-encoding does not work. The problem appears in displaying 'page expired' when I click through 'wicket-exmples' . I discovered that HttpServletResponse.encodeUrl() called by WebRequestCodingStrategy.encode() does not encode the session id  if it is called with a relative URL like '?wicket:interface=:0:inputForm:IFormSubmitListener::'. i.e.. starting with '?'.,0,0
No scrolling behaviour of source code viewer in IE 6,The source code viewer does not display scroll bars in IE 6.,0,0
Ajax refresh fails when a fragment is included in the target,Attached there is a package to drop into a quickstart project. If contains a panel that is a fragment provider and which also includes an ajax link to refresh the fragment contents. The main page just shows this panel and the provided fragment. Following the link raises the following exception:WicketMessage: Unable to find the markup for the component. That may be due to transparent containers or components implementing IComponentResolver: &#91;Component id = fragmentContent  page = web.fragment.Consumer  path = 0:container:fragment:fragmentContent.Label  isVisible = true  isVersioned = true&#93;Root cause:org.apache.wicket.WicketRuntimeException: Unable to find the markup for the component. That may be due to transparent containers or components implementing IComponentResolver: &#91;Component id = fragmentContent  page = web.fragment.Consumer  path = 0:container:fragment:fragmentContent.Label  isVisible = true  isVersioned = true&#93;at org.apache.wicket.MarkupFragmentFinder.find(MarkupFragmentFinder.java:111)at org.apache.wicket.Component.locateMarkupStream(Component.java:3274),0,0
Use -DpackageName if it is specified,Hi Wicket's archetype (http://svn.apache.org/repos/asf/wicket/trunk/archetypes) uses 'groupId' as a placeholder for the package name. If someone specifies Maven's option -DpackageName then this option will be neglected and the produced project will not compile.The attached patch resolves this problem. It works either when -DpackageName is not specified (then -DgroupId is being used).P.S. I put this issue at wicket-quickstart component since there is no such for the archetype.Kind regardsMartin,0,0
AjaxFormChoiceComponentUpdatingBehavior not working,I think this is because of its own component field that is hiding that of AbstractAjaxBehavior. Try to run the attached example and you will get:WicketMessage: Exception in rendering component: [MarkupContainer &#91;Component id = _header_  page = com.livra.web.user.RegistrationPage  path = 12:_header_.HtmlHeaderContainer  isVisible = true  isVersioned = true&#93;]Root cause:java.lang.NullPointerExceptionat org.apache.wicket.ajax.form.AjaxFormChoiceComponentUpdatingBehavior.renderHead(AjaxFormChoiceComponentUpdatingBehavior.java:71)at org.apache.wicket.Component.renderHead(Component.java:2266)at org.apache.wicket.markup.html.internal.HtmlHeaderContainer$1.component(HtmlHeaderContainer.java:209)at org.apache.wicket.MarkupContainer.visitChildren(MarkupContainer.java:843)at org.apache.wicket.MarkupContainer.visitChildren(MarkupContainer.java:858)at org.apache.wicket.MarkupContainer.visitChildren(MarkupContainer.java:883),0,0
More problems with ajax and transparent containers,Attached is my attempt to get a list that is ajax refreshed just at the tail. It's implemented as a sort of linked list. There are two versions. 'list' implements each node as a Panel  having contents (a number) and a next container which is made visible and ajax refreshed when one new element is added to the list. 'list2' does the same but using a Fragment instead of a Panel. You guessed  panels works just fine  but for the fragments version I get the usual transparent containers exception when trying to append an element:WicketMessage: Unable to find the markup for the component. That may be due to transparent containers or components implementing IComponentResolver: [MarkupContainer &#91;Component id = nextContainer  page = web.list2.ListPage  path = 0:first:nextContainer.WebMarkupContainer  isVisible = true  isVersioned = true&#93;]Root cause:org.apache.wicket.WicketRuntimeException: Unable to find the markup for the component. That may be due to transparent containers or components implementing IComponentResolver: [MarkupContainer &#91;Component id = nextContainer  page = web.list2.ListPage  path = 0:first:nextContainer.WebMarkupContainer  isVisible = true  isVersioned = true&#93;]at org.apache.wicket.MarkupFragmentFinder.find(MarkupFragmentFinder.java:111)at org.apache.wicket.Component.locateMarkupStream(Component.java:3274)at org.apache.wicket.Component.renderComponent(Component.java:2087)at org.apache.wicket.ajax.AjaxRequestTarget.respondComponent(AjaxRequestTarget.java:772)at org.apache.wicket.ajax.AjaxRequestTarget.respondComponents(AjaxRequestTarget.java:672)at org.apache.wicket.ajax.AjaxRequestTarget.respond(AjaxRequestTarget.java:522)at org.apache.wicket.request.AbstractRequestCycleProcessor.respond(AbstractRequestCycleProcessor.java:103)at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1038),0,0
Javadocs for AbstractDefaultAjaxBehaviorPrecondition#getSuccessScript() and #getPreconditionScript() are swapped,Precondition and success description are swapped: /** @return javascript that will run when the ajax call finishes successfully */ protected CharSequence getPreconditionScript() { return null; } /** * @return an optional javacript expression that determines whether the request * will actually execute (in form of return XXX; */ protected CharSequence getSuccessScript() { return null; },0,0
DateField's/ DateTimeField's factory methods should pass in ids,A very stupid mistake  but factory method:protected DateTextField newDateTextField(PropertyModel dateFieldModel)should of course pass in the id that the child component should use:protected DateTextField newDateTextField(String id  PropertyModel dateFieldModel),0,0
NumberFormatException with UrlCompressingWebRequestProcessor in WicketTester,In my Application I use UrlCompressingWebRequestProcessor. Now I have a JUnit test case with WicketTester and that Application like this:tester.startPage(new ITestPageSource() { public Page getTestPage() { PageParameters params = new PageParameters(); params.add('0'  'param'); return new MyPage(params); }});I get an Exception:java.lang.NumberFormatException: For input string: 'testPage' at java.lang.NumberFormatException.forInputString(NumberFormatException.java:48) at java.lang.Integer.parseInt(Integer.java:447) at java.lang.Integer.parseInt(Integer.java:497) at org.apache.wicket.protocol.http.request.urlcompressing.UrlCompressor.getComponentAndInterfaceForUID(UrlCompressor.java:124) at org.apache.wicket.protocol.http.request.urlcompressing.UrlCompressingWebRequestProcessor.resolveListenerInterfaceTarget(UrlCompressingWebRequestProcessor.java:81) at org.apache.wicket.request.AbstractRequestCycleProcessor.resolveRenderedPage(AbstractRequestCycleProcessor.java:440) at org.apache.wicket.protocol.http.WebRequestCycleProcessor.resolve(WebRequestCycleProcessor.java:139) at org.apache.wicket.RequestCycle.step(RequestCycle.java:1091) at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1177) at org.apache.wicket.RequestCycle.request(RequestCycle.java:500) at org.apache.wicket.protocol.http.MockWebApplication.processRequestCycle(MockWebApplication.java:381) at org.apache.wicket.protocol.http.MockWebApplication.processRequestCycle(MockWebApplication.java:368) at org.apache.wicket.util.tester.BaseWicketTester.executeListener(BaseWicketTester.java:239) at org.apache.wicket.util.tester.BaseWicketTester.startPage(BaseWicketTester.java:224)I could work around this by using WebRequestCycleProcessor for my testing-application.,0,0
HttpServletResponse.encodeRedirectURL() missing in WicketFilter,In class org.apache.wicket.protocol.http.WicketFilter in method doGet a redirect URL is not encoded with HttpServletResponse.encodeRedirectUrl(): 168 // Special-case for home page - we redirect to add a trailing slash. if (relativePath.length() == 0 &amp;&amp; !Strings.stripJSessionId(servletRequest.getRequestURI()).endsWith('/')) { final String redirectUrl = servletRequest.getRequestURI() + '/';--------&gt; servletResponse.sendRedirect(redirectUrl); return; }From Wicket's perspective this seems to be not necessary here to support cookie-less mode. But notice that an application may depend on a session outside the wicket scope e.g. by including a ServletFilter in front of WicketFilter  which handles data in session scope.,0,0
Markup hirarchy gets messed up when value of  attribute 'background' is a relative path,$ svn diff -r HEADIndex: src/main/java/org/apache/wicket/quickstart/Index.java===================================================================&#8212; src/main/java/org/apache/wicket/quickstart/Index.java (Revision 568574)+++ src/main/java/org/apache/wicket/quickstart/Index.java (Arbeitskopie)@@ -17 6 +17 7 @@ package org.apache.wicket.quickstart; import org.apache.wicket.PageParameters;+import org.apache.wicket.markup.html.basic.Label; /** Basic bookmarkable index page.@@ -35 5 +36 6 @@ */ public Index(final PageParameters parameters) {+ this.add(new Label('myname'  'Whishing that this is not a bug.')); } }Index: src/main/java/org/apache/wicket/quickstart/Index.html===================================================================    src/main/java/org/apache/wicket/quickstart/Index.html (Revision 568574)+++ src/main/java/org/apache/wicket/quickstart/Index.html (Arbeitskopie)@@ -5 6 +5 9 @@ &lt;body&gt; &lt;h1&gt;QuickStart&lt;/h1&gt; &lt;p&gt;This is your first Wicket application.&lt;/p&gt;+ &lt;span background='images/bg.jpg'&gt;+ &lt;p wicket:id='myname'&gt;Hello&lt;/p&gt;+ &lt;/span&gt; &lt;/body&gt; &lt;/html&gt;,0,0
Typo in org.apache.wicket.markup.html.tree.res.tree.js causes AJAX tree node addition failures,There is a typo in the tree javascript which can sometimes cause node addition failures. Here is the patch:Index: tree.js===================================================================&#8212; tree.js (revision 568693)+++ tree.js (working copy)@@ -46 7 +46 7 @@ Wicket.Tree.createElement = function(elementId  afterId) { var existing = Wicket.$(elementId); if (typeof(existing) != 'undefined' &amp;&amp; exiting != null) {+ if (typeof(existing) != 'undefined' &amp;&amp; existing != null) { Wicket.Tree.askForReload(); },0,0
Option to align DatePicker to the left of icon,wicket-1.3.0-SNAPSHOTI'm using the wicket YUI DatePicker on a DateTextField in my application  and it works quite nicely. The problem is that my date field is on the far right-hand side of the page. When set to align with icon  the DatePicker appears so that the left edge of the calendar is lined up with the left edge of the icon. When I open the DatePicker  the calendar appears mostly offscreen  and the user has to scroll horizontally to interact with it.I wanted my DatePicker to line up the other way - with the calendar's right edge aligned with the right edge of the icon - so the user doesn't have to scroll. I made a RightAlignedDatePicker that does this  but it's not good enough to be a patch  since it duplicates a lot of code unnecessarily. I would like to see this as a standard setting on the wicket DatePicker if possible!I created RightAlignedDatePicker.java only so I could replace DatePicker.js with RightAlignedDatePicker.js. The rest of the code from renderHead() is copied from DatePicker directly. Similarly  I replaced RightAlignedDatePicker.js so that I could replace the showCalendar() method  and introduce my Wicket.DateTime.positionRelativeToLeft() method. The important code that had to be changed was:function showCalendar() { Wicket.DateTime.positionRelativeToLeft = function(subject  target) { targetPos = YAHOO.util.Dom.getXY(target); targetHeight = YAHOO.util.Dom.get(target).offsetHeight; targetWidth = YAHOO.util.Dom.get(target).offsetWidth; var calWidth = YAHOO.util.Dom.get(subject).offsetWidth; YAHOO.util.Dom.setX(subject  targetPos[0] + targetWidth - calWidth); YAHOO.util.Dom.setY(subject  targetPos[1] + targetHeight + 1); } Wicket.DateTime.showCalendar(YAHOO.wicket.${widgetId}DpJs  YAHOO.util.Dom.get('${componentId}').value  '${datePattern}');// if (${alignWithIcon}) Wicket.DateTime.positionRelativeTo(YAHOO.wicket.${widgetId}DpJs.oDomContainer  '${widgetId}Icon'); if (${alignWithIcon}) Wicket.DateTime.positionRelativeToLeft(YAHOO.wicket.${widgetId}DpJs.oDomContainer  '${widgetId}Icon'); }I tried introducing the positionRelativeToLeft method elsewhere  but I started running into javascript errors  so I left it here. There could be an extra (optional) parameter added to Wicket.DateTime.positionRelativeTo() instead.Hope this seems like a helpful addition. I think it won't be too bad to implement.-Russ,0,0
Add class or id to AjaxFallbackDefaultDataTable elements (NavigationToolbar  etc.) to facilitate CSS styling,It would be nice to have a CSS class or id assigned to various HTML elements of the more complex pre-fab components such as the AjaxFallbackDefaultDataTable. This would facilitate styling via CSS and increase re-usability.Link to mailing list archive here:http://www.nabble.com/forum/ViewPost.jtp?post=12321602&amp;framed=y,0,0
InlineFrame with null PageMap raises exception,This constructor public InlineFrame(final String id  final Page page) { this(id  null  new IPageLink()is calling this other public InlineFrame(final String id  final IPageMap pageMap  IPageLink pageLink) { super(id); this.pageMapName = pageMap.getName();which of course raises a null pointer exception at 'pageMap.getName();',0,0
Unable to find InlineFrames when inside ListViews,There is a simple example attached. Even if the list is reusing items (and even with a RefreshingView with reuseifmodelequal strategy) the problem persists.,0,0
If a form includes a DataTable with AjaxEditableLabels and the form should be refresh an exception occurs when a user switches between a changed label to another,A normal Form includes a DataTable which includes some AjaxEditableLabels.If the user changes the contens of a label and the label has an effect of the whole DataTable the complete from has to be refreshed. But if the user switches between one label to another  an exception occurs.UseCase:click on label and change the valueto leave the label click another labe in the DataTabel--&gt; an exception should occur,0,0
WicketServlet no longer sets application on current thread,The last changes made to WicketFilter (move Application.set(webApplication) from doGet() to doFilter()) have a side effect: if working with WicketServlet (due to OSGI)  the application is no longer set on the current thread  because it was moved to doFilter().Possible fixes: move Application.set() in WicketFilter back to doGet()  at the start if that's early enough expose the webApplication property  and add an extra Application.set() in the doGet() of WicketServlet,0,0
There is no way to specify what exceptions to log in RequestCycle,RequestCycle  line 1135 logs all exceptions except for PageExpiredException. This is not a wanted behavior for us (for example  it also logs AuthorizationException which is not a error).So we need some way to specify which exceptions should be treated as errors and which ones are just need to be handled by RequestCycleProcessor#respond(RuntimeException  RequestCycle).Maybe there is some way to globally catch application exceptions other than writing a custom RequestCycleProcessor. If so then tell me please.The possible solution is to move exception logging to RequestCycleProcessor#respond(RuntimeException  RequestCycle) because it can be overriden.,0,0
onBeforeRender not called on ModalWindow contents,ModalWindow.onBeforeRender contains the following code: super.onBeforeRender(); getContent().setOutputMarkupId(true); getContent().setVisible(shown);This has the consequence that the content of the modal windows is still invisible when its onBeforeRender() method is called. The default implementation of onBeforeRender delegates to the window's children beforeRender() method. However  the contents beforeRender() method first checks if the component is visible  which is not the case  so the onBeforeRender() call is not propagated down the component tree. This is a problem if the content of the modal window is something like a table  which populates itself in the onBeforeRender call.,0,0
Tree not 'redrawn' when resetting root node,I have a tree that I reset the root node when a user selects on another component (Component A). However  the tree is not 'redrawn' until I click on the tree (the previous tree contents are shown).Have called Tree.invalidateAll() andDefaultTreeModel.nodeStructureChanged(tnode )DefaultTreeModel.nodeChanged( tnode )DefaultTreeModel.reload(),0,0
inconsistent state after setting AjaxDebugModeEnabled to true in an AjaxRequest,when the application debugsetting AjaxDebugModeEnabled is changed from false to true in an AjaxRequest (e.g. via JMX)  the following two statements in AbstractDefaultAjaxBehavior#renderHead are executed:response.renderJavascript('wicketAjaxDebugEnable=true;'  'wicket-ajax-debug-enable');response.renderJavascriptReference(JAVASCRIPT_DEBUG);as soon as the client recieves the response  the first javascript statement is executed and code in wicket-ajax.js 'thinks' that ajax debug is enabled.well it is  but wicket-ajax-debug.js has not arrived (or at least has not been processed) yet  and thus Wicket.Log.info() and Wicket.Log.error() will fail  because these methods access an object which is defined in wicket-ajax-debug.js.This problem seems to be solved by changing the order of the statements in AbstractDefaultAjaxBehavior#renderHead  so that the ResourceReference JAVASCRIPT_DEBUG is rendered before wicketAjaxDebugEnable is set to true.,0,0
Minor patch in polish translation,The current PL translation is nice  just minor change to null value to give it universal meaning in some cases,0,0
embedded jetty configuration stops working on beta3,When using beta3 with embedded configuration  which means there is no web.xml  but wicket servlet instance is injected in jetty server context. During the startup application generates NPE in (DiskPageStore.java:486) which means that wicket servlet cannot retrieve temp dir... Adding the following line before string the application resolves the question:serverContext.setAttribute('javax.servlet.context.tempdir'  new File('.'));I am not sure if this is just treating effect and not the cause which can be related to recent WicketFilter/WicketServlet 'thread' questions ?Attached simple hello world application reproduce this...,0,0
BaseWicketTester support for SubmitLink,When the SubmitLink is used instead of the submit for forms  BaseWicketTester does not run through the onSubmit() code of the link.I have stepped through the debug of the test that's actually not getting called. All my validators on the text field are getting called as expected and in fact the form works as expected when deployed so I'm thinking that it might be a WicketTester issue or the more likely scenario that I'm doing something wrong?Things I've tried: debugging as mentioned  but this just shows me it's not getting called trying to call the link directly but I just get the below exception which I'm not really surpised about....,0,0
WebRequestCodingStrategy is not synchronized,The WebRequestCodingStrategy class uses a TreeMap to store mounted pages however there is no synchronization done. This will cause problems if pages are being mounted/unmounted by one thread while web requests are being served from a different one. It could also cause problems if two threads try to mount/unmount pages at the same time.I'll include a patch to fix this as well as a new version of the java file that you can use if you wantKeep up the good work,0,0
Default button does not provide button name,When the default button is set in a form  the name property should be rendered too  so that the right button is executed rather than just the form's onsubmit method.,0,0
FilteredAbstractColumn unary constructor expects Model instead of IModel,We have this now:public FilteredAbstractColumn(Model displayModel) { super(displayModel); }Here's the super constructor it delegates to:public AbstractColumn(IModel displayModel) { this(displayModel  null); }So I really don't see why the FilteredAbstractColumn would need Model descendants specifically.,0,0
Static Pages -> Passing URI to a Wicket page == 404 Error,Broken url,0,0
Wicket Javadoc Standardization: org.apache.wicket.util.value,Javadoc for the util.value package.,0,0
StringIndexOutOfBoundsException in ServletWebRequest.getRelativePathPrefixToWicketHandler,Request attribute 'javax.servlet.forward.servlet_path' may be equals to empty string.See patch...,0,0
[PATCH] Javascript error in IE7 when selecting a date,When selecting a date in IE7 I get a javascript error on line 227 in wicket-date.js. In this line there is the following check:if (typeof(field.onchange) != 'undefined' ) field.onchange();in IE7 this gives a warning due to field.onchange being null (which is user defined instead of undefined). Changing the check as follows solves this problem for me:if (typeof(field.onchange) != 'undefined' &amp;&amp; field.onchange != null) field.onchange();,0,0
Text not visible in Wicket Ajax Debug window,The Wicket Ajax Debug (WAD) window has a background color set to white but the font color is not set (in wicket-ajax-debug.js) - it uses the base page defaults. So when I have in css for my page setting like this: body color: Color value is invalid  the text in WAD is not visible.Suggested solution: maybe add somewhere in wicket-ajax-debug.js setting: 'color: black;',0,0
setEnabled() does not work on YUI DateField,Calling setEnabled(false) on a YUI DateField component doesn't seem to have any effect. The date field remains editable and the changes get propagated to the underlying model on submit.,0,0
Fix a TODO for 1.3 at AjaxFormSubmitBehavior.onError(),There is the following TODO at org/apache/wicket/ajax/form/AjaxFormSubmitBehavior.onError(): /**  Listener method invoked when the form has been processed and errors occured  @param target  TODO 1.3: make abstract to be consistent with onsubmit()  */ protected void onError(AjaxRequestTarget target) {  } Should this be done for 1.3 or it will stay like it is now for the next major release ?,0,0
javadoc typos,I collected some javadoc typos I came across. See patch for simple ones. These are some other problems in javadocs: broken link in WebRequestCodingStrategy: @see org.apache.wicket.request.IRequestCodingStrategy#encode(java.lang.CharSequence) Application#getSessionStore: object for working getting/ storing session didn't find such classes RequestLogger: InspectorBug  InspectorPage  LiveSessionPage IWrapModel: model will be called detach on when the component is detached when the wrap model javadoc seems to be copied from another flag Component#FLAG_INHERITABLE_MODEL: /** Flag for escaping HTML in model strings */ Model does not implement AbstractModel anymore org.apache.wicket.model.Model: Model is the basic implementation of an AbstractModel,0,0
FeedbackMessages don't get cleaned up in an AJAX request when renderstrategy is REDIRECT_TO_RENDER,the following check in Session#cleanupFeedbackMessages always fails for AjaxRequests when the renderstrategy REDIRECT_TO_RENDER is used.this leads to FeedbackMessages not being removed from the session.if (Application.get().getRequestCycleSettings().getRenderStrategy() != IRequestCycleSettings.REDIRECT_TO_RENDER || (!RequestCycle.get().isRedirect()))RequestCycle.get().isRedirect() in case of a WebRequestCycle returns true for Ajax requests.fix:mark Session#cleanupFeedbackMessages as abstract and implement it in WebSession with an additional check '|| ((WebRequest)RequestCycle.get().getResponse).isAjax()',0,0
StyleSheetReference doesn't take style/locale into account,StyleSheetReference (in essence PackagedResourceReference) doesn't take the style and locale into account as is common for resource loaders.Changing PackagedResourceReference line 102 from ResourceReference ref = new ResourceReference(referer  f);to ResourceReference ref = new ResourceReference(referer  f  getLocale()  getStyle());fixes this issue,0,0
Wicket Javadoc Standardization: org.apache.wicket.util.thread,org.apache.wicket.util.thread Javadoc,0,0
Wicket Javadoc Standardization: org.apache.wicket.util.tester,org.apache.wicket.util.tester Javadoc,0,0
Remove final from WebRequestCodingStrategy. urlCodingStrategyForPath,I am trying to use my own encoding that does not depend on mounted paths. I want normal mounted paths and the default wicket paths to work as usual and for my strategy to be used after they have been tried.For encoding URLs with my strategy I can override WebRequestCodingStrategy .getMountEncoder(IRequestTarget) which allows the normal mounts to be tried first and then return my strategy if non are found.The default decoding works OK but WebRequestCycleProcessor will call WebRequestCodingStrategy .targetForRequest() after the default handling fails and I cannot return my own strategy because I cannot override urlCodingStrategyForPath() because it is final.I have removed this locally and it works as I expected.It seems like the only option at the moment is to use a subclass or WebRequestCodingStrategy AND create an adaptor (wrapper) for WebRequestCodingStrategy which detects when targetForRequest() returns null and returns my own strategy.If the final is removed from rlCodingStrategyForPath(String path) life would be a lot easier!,0,0
Correct javadoc for Fragment,The Fragment constructors without markupProvider argument have been deprecated but the example in the class javadoc's is still using it.,0,0
Missing img alt attribute in WicketAjaxIndicatorAppender,,0,0
Extending PagingNavigator for stateless pages,I am extending PagingNavigator to use stateless links but have found that the underlying PagingNavigation factory method newPagingNavigationLink() does not let me return a subclass of Link. I have tested the change below and it seems to work OK on my stateless pages.Index: /Users/John/Development/wicket/trunk/jdk-1.4/wicket/src/main/java/org/apache/wicket/markup/html/navigation/paging/PagingNavigation.java===================================================================&#8212; /Users/John/Development/wicket/trunk/jdk-1.4/wicket/src/main/java/org/apache/wicket/markup/html/navigation/paging/PagingNavigation.java (revision 585875)+++ /Users/John/Development/wicket/trunk/jdk-1.4/wicket/src/main/java/org/apache/wicket/markup/html/navigation/paging/PagingNavigation.java (working copy)@@ -17 6 +17 7 @@ package org.apache.wicket.markup.html.navigation.paging; import org.apache.wicket.markup.html.basic.Label;+import org.apache.wicket.markup.html.link.Link; import org.apache.wicket.markup.html.list.Loop; import org.apache.wicket.version.undo.Change;@@ -302 7 +303 7 @@ final int pageIndex = getStartIndex() + loopItem.getIteration(); // Add a page link pointing to the page final PagingNavigationLink link = newPagingNavigationLink('pageLink'  pageable  pageIndex);+ final Link link = newPagingNavigationLink('pageLink'  pageable  pageIndex); loopItem.add(link); // Add a page number label to the list which is enclosed by the link@@ -329 8 +330 7 @@ the page index the link points to @return the page navigation link. */ protected PagingNavigationLink newPagingNavigationLink(String id  IPageable pageable  int pageIndex)+ protected Link newPagingNavigationLink(String id  IPageable pageable  int pageIndex) { return new PagingNavigationLink(id  pageable  pageIndex); },0,0
DateTextField.setEnabled() is not propagated to attached DatePicker,DatePicker stays enabled even if the DateTextField it is attached to is disabled.It is even able to change the DateTextField's shown value.Instead the DatePicker should be disabled to  or maybe not shown at all.Attached is a Quickstart-patch showing the effect.,0,0
Problem closing a ModalWindow when used through an IFrame,I'm doing some POC testing to find out how a wicket application could be used through an IFrame and noticed that closing of a ModalWindow fails.My setup:Application A: -a dummy html page that has an IFrame-the contents of the IFrame is requested from Application B&lt;iframe src='http://localhost:8080/mywicketapp/app/' width='100%' height='500'&gt;&lt;/iframe&gt;Application B:-a Wicket application that uses a ModalWindow-deployed to tomcat: http://localhost:8080/mywicketapp/Problem:The ModalWindow is not closed when OK ( or Cancel ) button is clicked when Application B is used throug IFrame of Application A.OK button performs the actual action (in my case deletes an item from a list) but is not closed after the execution of the action.Closing of the ModalWindow works normally when Application B is not used through an IFrame.Reproducing the problem:You can test this by creating a html page with this source:&lt;html&gt;&lt;body&gt;&lt;iframe src='http://www.wicket-library.com/wicket-examples/ajax/modal-window.1' width='100%' height='100%'&gt;&lt;/iframe&gt;&lt;/body&gt;&lt;/html&gt;And then open 'Show modal dialog with panel' and try to close the dialog.,0,0
AjaxEditableLabel: defaultNullLabel() should really be a defaultNullorEmptyLabel(),defaultNullLabel() only inserts '...' when the model is NULL  not when the model contains an empty String.So right now it's impossible to get empty Strings edited with this component.,0,0
XHTML validation failure for DatePicker,org.apache.wicket.extensions.yui.calendar.DatePicker code generates an img tag that is missing the alt tag  which breaks XHTML validation.,0,0
Change log in Form.handleMultiPart() from error to warn,If the upload fails in Form.handleMultipart  perhaps the error should be logged as a warning instead of an error  since the user is being informed that the upload failed.,0,0
AbstractTree utilizes Collections.EMPTY_LIST for a node's children container which causes errors when adding children,AbstractTree utilizes Collections.EMPTY_LIST for a node's children container. This assumes that this node will never have children during its lifecycle as EMPTY_LIST will always be empty since it does not support add(int  Object)To fix  change item = Collections.EMPTY_LIST with item = new ArrayList(0);private final void buildItemChildren(TreeItem item) { List items; // if the node is expanded if (isNodeExpanded((TreeNode)item.getModelObject())) { // build the items for children of the items' treenode. items = buildTreeItems(nodeChildren((TreeNode)item.getModelObject())  item.getLevel() + 1); } else { // it's not expanded  just set children to an empty list //items = Collections.EMPTY_LIST; items = new ArrayList(0); } item.setChildren(items); },0,0
add sanity check on form submit for request method,When refreshing a frameset that includes an already POST submitted Wicket form in a frame  using the redirect to render strategy  Safari erroneously requests the form's original target by GET  rather than the location that was eventually redirected to. Therefore none of the form values are available in the request object and NPEs will occur trying to access them in places like AbstractConverter.java:55.Because Form allows for a particular request method to be specified  I think it should also confirm that the expected method was used instead of waiting for an NPE in validation. The outcome is the same  but the cause of the error (the client) would be more evident in server logs  etc. Patch to come...,0,0
Tolerate malformed If-Modified-Since header,Some kind of RSS aggregator is hitting an rc1 site of mine regularly with dates that don't follow the HTTP spec. Correct to the servlet spec  Jetty throws an exception in this instance which causes Wicket to abort processing the request and log an error. I think it would be better to log the exception as a warning and proceed as if the header had not been present.Example exception:ERROR btpool0-703 org.mortbay.log - /resources/com.typeturner.Typeturner/eat-rssjava.lang.IllegalArgumentException: Cannot convert date: 1194673976 at org.mortbay.jetty.HttpFields.getDateField(HttpFields.java:827) at org.mortbay.jetty.Request.getDateHeader(Request.java:460) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:197),0,0
IDataProvider-Overflow with size(),Hi I get an Integer-overflow with my Dataprovider (yeah  there are a couple of entries in the database). Is there a reason why size() and iterator( first  count ) are limited to Integer?Regards  &#8212; Jan.,1,1
AjaxEditableLabel and AjaxMultiLineEditableLabel do not honour enabled status,On AjaxEditableLabel and subclasses  setEnabled(false) has no effect.It should prevent the component from being editable (i.e. it should behave like a normal Label).,0,0
Ajax Memory Leak in IE,Memory Leak in IE6 (IE7?) when using a DataView with AjaxPagingNavigator and each entry of the DataView table contains an AjaxLink. Memory increases by more than 500KB when displaying 100 items per page. AjaxDebugMode is disabled. Configuration is set to deployment. Version 1.2.6 is working fine.,0,1
i18n: Translation of resource files in Korean,I'd like to upload a patch for Korean resource files.,0,0
NPE in IndexedHybridUrlCodingStrategy during encoding,java.lang.NullPointerException at org.apache.wicket.request.target.coding.IndexedHybridUrlCodingStrategy.appendParameters(IndexedHybridUrlCodingStrategy.java:51) at org.apache.wicket.request.target.coding.HybridUrlCodingStrategy.encode(HybridUrlCodingStrategy.java:409) at org.apache.wicket.protocol.http.request.WebRequestCodingStrategy.pathForTarget(WebRequestCodingStrategy.java:459) at org.apache.wicket.protocol.http.request.WebRequestCodingStrategy.encode(WebRequestCodingStrategy.java:236) at org.apache.wicket.RequestCycle.encodeUrlFor(RequestCycle.java:744) at org.apache.wicket.RequestCycle.urlFor(RequestCycle.java:847) at org.apache.wicket.Component.urlFor(Component.java:3086) at org.apache.wicket.protocol.http.WebRequestCycle.redirectTo(WebRequestCycle.java:144) at org.apache.wicket.request.target.component.PageRequestTarget.respond(PageRequestTarget.java:58) at org.apache.wicket.request.AbstractRequestCycleProcessor.respond(AbstractRequestCycleProcessor.java:103) at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1100) at org.apache.wicket.RequestCycle.step(RequestCycle.java:1169) at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1248) at org.apache.wicket.RequestCycle.request(RequestCycle.java:489) at org.apache.wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:343) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:193),0,0
false positive or wrong unit tests unit tests when ajax is involved,MockWebApplication#setupRequestAndResponse always sets up a non ajax requestcycle.this method is also used to setup the requestcycle for ajax related functionality (eg. BaseWicketTester#clickLink).the consequence are:a) the markup for expected ajax responses contains wicket tags and wicket attributes  although these are never rendered in ajax responses.b) some unit tests (eg. AjaxTimerBehaviorTest#testAddToAjaxUpdate  ComponentBorderTest#testHideableBorder) succeed  when the same code in non-unit-test environment doesn't work  because there is no ajax request during testing  while there is one during normal execution.,0,0
Use X-Forwarded-For header for getting the IP address of the client in WebClientInfo,When using Apache HTTP Server's ProxyPass to forward to other HTTP Servers  such as Jetty  the client's ip address defaults to the server that forwarded the request  usually being 127...,0,0
upgrade to YUI 2.4.0,YUI should be updated to version 2.4.0along with this release  there have been significant changes to YUI Calendar (CalendarNavigator) and YUI Loader.CalendarNavigator will replace the current customized  self-maintained month/year selection.,0,0
WicketTester recreates session after setting attributes on it,The following test for internationalization doesn't work  as rendering the page will create a new session. WicketTester tester = new WicketTester(); tester.getWicketSession().setLocale(Locale.FRENCH); tester.startPage(HelloWorld.class); tester.assertLabel('message'  'Bonjour tout le monde!');But setting up the response and request first works around recreating the session WicketTester tester = new WicketTester(); tester.setupRequestAndResponse(); tester.getWicketSession().setLocale(Locale.FRENCH); tester.startPage(HelloWorld.class); tester.assertLabel('message'  'Bonjour tout le monde!');,0,0
Inside a html tag wicket:message's attribute cannot contain colon : in it  it uses the first colon and tokenizes the rest to be the resource_identifier. Need some way to use colon in the attribute name.,I am trying to use wicket:message inside a tag in the following format wicket:message='attribute:resource_identifier'The attribute:resource_identifier passed as a value to the wicket:message uses the colon to tokenize the attribute and the resource_identifier. Now  The attribute which I am using is a custom attribute 'ric:title' (without quotes) which also has a colon in it. Currently  I have a tag with a custom attribute ric:title and the resource_identifier for it is page.title &lt;div wicket:message='ric:title:page.title' /&gt;  the problem is wicket takes the first colon which is part of my attribute and takes the rest as the resource_identifier and looks for it in the property file and then throws an error.How can I tell wicket to ignore the colon in the attribute name...? and I've tried using slash in front of the colon and it didn't work  I've tried using ascii html entity encoding for colon  which is &#58; and didn't work.So  please make a way to use colon in the attribute.Something like the following would be nice &lt;div wicket:message=' 'ric:title' : page.title'&gt;  which allows the user to set the attribute name in the markup within single quoutes. I am hoping to see this fixed.Thanks,0,0
Temporary files not deleting when multipart upload fails with IO error,I just want to delete temporary files when upload fails (user cancelled or IO error occured)  this is really important when uploading files about 500Mb  and this bug makes security hole (anyone can eating my server's disk space by posting incomplete large files).I can't find simple workaround  and I think that fix by developers will more easy.For example you can handle IO error in class org.apache.wicket.util.upload.FileUploadBase  method parseRequest  when IO error occured  just delete all created temporary files  and only after deleting files throw your FileUploadException.I hope you will fix it soon.Thanks.,1,0
java.lang.IllegalAccessError when changing AjaxEditableLabel,When changing AjaxEditableLabel system throws:java.lang.IllegalAccessError: tried to access methodorg.apache.wicket.Component.onModelChanging()V from classorg.apache.wicket.extensions.ajax.markup.html.AjaxEditableLabel$1 atorg.apache.wicket.extensions.ajax.markup.html.AjaxEditableLabel$1.onModelChanging(AjaxEditableLabel.java:273) at org.apache.wicket.Component.modelChanging(Component.java:2058) at org.apache.wicket.Component.setModelObject(Component.java:2823) at org.apache.wicket.markup.html.form.FormComponent.updateModel(FormComponent.java:992) at org.apache.wicket.markup.html.form.FormComponent.processInput(FormComponent.java:874) &#91;...&#93;The probem is in methd: protected FormComponent newEditor(MarkupContainer parent  String componentId  IModel model) { TextField editor = new TextField(componentId  model) { private static final long serialVersionUID = 1L; protected void onModelChanged() { super.onModelChanged(); AjaxEditableLabel.this.onModelChanged(); //here is a bug } protected void onModelChanging() { super.onModelChanging(); AjaxEditableLabel.this.onModelChanging(); //here is a bug } }; editor.setOutputMarkupId(true); editor.setVisible(false); editor.add(new EditorAjaxBehavior()); return editor; } AjaxEditableLabel.this.XXXXXX is not visible.Artur,0,0
assertComponentOnAjaxResponse does not work with WicketTester.clickLink,assertComponentOnAjaxResponse does not work with clickLink. Workaround are to call wickettester..executeAjaxEvent(ajaxLink 'onclick'); instead.Reason why this fails has something todo with that clickLink creates a servlet response which are empty hence this will always fail: // Get the AJAX response String ajaxResponse = getServletResponse().getDocument(); // Test that the previous response was actually a AJAX response failMessage = 'The Previous response was not an AJAX response. ' + 'You need to execute an AJAX event  using clickLink  before using this assert'; boolean isAjaxResponse = ajaxResponse.startsWith('&lt;?xml version=/'1.0/' encoding=/'UTF-8/'?&gt;&lt;ajax-response&gt;');proposed fix are to rewrite wicketTester.clicklink(string path boolean ajax) to call executeAjaxEvent instead if possible?,0,0
NPE in ListMultipleChoice.updateModel(),I noticed a NullPointerException when I cleared a Form with a ListMultipleChoice to its original state.In updateModel() following statement causes a NPE when something was selected in the multiple select but in the original state nothing was selected:selectedValues.addAll((Collection)getConvertedInput());getConvertedInput() is null  so ArrayList.addAll() operates on the null value and throws the NPE.,0,0
Script in RenderHead method of AjaxFormChoiceComponentUpdatingBehavior needs fixing,The script in the renderHead method of AjaxFormChoiceComponentUpdatingBehavior assumes that the Radio Component will be the immediate child of the RadioGroup Component  But in some or in most of the cases that is not correct.That is not the case even in the Wicket Examples  in examples the hierarchy is RadioGroup/ListView/Radio.I have maodied the rendered script to work for RadioGroup/ListView/Radio hierarchy. And the Patch is attached.RegardsDipu,0,0
Allow to query component markup id without creating one,,0,0
Report last focused element id on ajax request,,0,0
Make Cookie-Detection possible without JavaScript,getClientInfo().getProperties().isCookiesEnabled() returns always false  when JavaScript is disabled.It is possible to detect the availibility of cookies by just testing for JSESSIONID in the current Request. Unfortunately  this cookie is not yet set by the first Redirecting Response that sends the userﾂｴs browser to the HomePage.,0,0
WicketTester Doesn't Support setDefaultFormProcessing(false),I was trying to use the WicketTester to click the button for an AjaxFallbackButton that has setDefaultFormProcessing(false). So I wanted to execute the onclick for the component  like this:tester.executeAjaxEvent('meetingForm:inputForm:rootViewPanel:addOrganization'  'onclick');What seems to happen is that the pages tries to update all the form fields and perform validation. This is incorrect in the context for the setDefaultFormProcessing(false) behavior.I was looking at the source for BaseWicketTester and noticed that in executeAjaxEvent()  it always tries to submit the form if the behavior is a AjaxFormSubmitBehavior. This wouldn't be correct in the case of when you set setDefaultFormProcessing(false) on the button. I think it needs to check for setDefaultFormProcessing at that point.,0,0
Improve SelectOptions: allow customization of created SelectOption objects,I've created a patch that makes SelectOptions more flexible  as it now allows customization ofthe created SelectOption objects (e.g. adding an AjaxEventBehavior).The patch also extends the javadoc of Select  I've added an example on how to use Select  SelectOptions and SelectOption,0,0
HybridUrlCodingStrategy should throw a PageExpiredException if a RequestListenerInterface is targeted on a non-existent page-id/version,let's assume MyPage.class is mounted on /page and at some point the user is on /page.1.3if a click on a Link on that page  which results in a relative url '?wicket:interface...' but is ultimately sent to '/page.1.3?wicket:interface...'  is clicked after a session timeout the request is silently redirected to '/page.0' and the link callback is not processed.fix:before creating a new instance of a HybridBookmarkableRequestTarget  HybridUrlCodingStrategy should check if a RequestListenerInterface is present on the last request and throw a PageExpiredException if this is the case.,0,0
Make substitutePropertyExpressions() in Localizer overridable,I want to extend Localizer.substitutePropertyExpressions(final Component component  final String string  final IModel model) to add a special behaviour when the model for substitution is instance of a Interface which has the Method getMessage(Locale locale).In this case I want to use a custom PropertyVariableInterpolator.So please make the method protected.,0,0
AbstractTextComponent requires itself to be rendered before conversion happens,The bug is reproduced as follows:1. Use StatelessForm.2. Use compound model  eg CompoundPropertyModel. In this case  form components are not initially aware of their model types.3. Use any text component inside  eg TextFieldWhat happens:1. In StatelessForm  form processing occurs BEFORE components were actually rendered.2. BUT AbstractTextComponent guesses its model type ONLY in onBeforeRender().3. onBeforeRender() never gets called  so text component doesn't know its actual type and cannot convert properly.4. Everything crashes because of incorrect type (validators and form submission is working wrong).Obviously  this processing sequence needs to be fixed (eg retrieve model type early or check for stateless forms explicitly).,0,1
DateTimeField does not correct the timezone properly,The DateTimeField has a DateTextField which uses a styledateconverter with timezone correction set to true which is not needed since the DateTimeField accounts for the TimeZone correction. Another problem is that the DateTimeField only sets the timezone of the date (from local-&gt;client)  causing the date to be corrected to the local time. This should instead cause the local time to reflect that of the clients time.,0,0
Javadoc error in QueryStringUrlCodingStrategy,The javadoc uses this as an example:mount(new QueryStringRequestTargetUrlCodingStrategy('/admin/productmanagement'  admin.ProductManagement.class));This does not work. It should say this instead:mount(new QueryStringUrlCodingStrategy('/admin/productmanagement'  admin.ProductManagement.class));,0,0
AbstractPageableView has transient cachedItemCount  but doesn't set it to -1 on deserialization.,AbstractPageableView declares:private transient int cachedItemCount;When this is deserialized  cachedItemCount gets set to 0. This means that the method isItemCountCached() will return true on a deserialized AbstractPageableView. This  in turn  causes getCurrentPage() to return 0  even when the user is not navigating the first page.For me  this is causing huge problems with the paging navigator.My current workaround is this is to add this method to my DataView implementation:private Object readResolve() throws ObjectStreamException { final Class&lt;?&gt; myClass = getClass(); final Class&lt;?&gt; dataView = myClass.getSuperclass(); final Class&lt;?&gt; dataViewBase = dataView.getSuperclass(); final Class&lt;?&gt; abstractPagableView = dataViewBase.getSuperclass(); try { final Field field; field = abstractPagableView.getDeclaredField('cachedItemCount'); field.setAccessible(true); field.setInt(this  -1); } catch (Exception e) { throw new RuntimeException(e); } return this;}Obviously it would be better if the AbstractPagingView could take care of this itself.,0,0
AjaxFormChoiceComponentUpdatingBehavior just updates the group 'grandchildren',Up to 1.3.0  there was a bug in that AjaxFormChoiceComponentUpdatingBehavior updated just the group's direct children. Now it generates the header script quoted below  that iterates over the direct children and then over the children of these  triggering the event for the input grandchildren only. So the situation is even worse. I think that attachChoiceHandlers should descend recursively and search for input elements along all the group descendants  not just one arbitrarily chosen level.function attachChoiceHandlers(markupid  callbackscript) { var choiceElementGroup = document.getElementById(markupid); for( var x = 0; x &lt; choiceElementGroup.childNodes.length; x++ ) { var choiceElementList = choiceElementGroup.childNodes&#91;x&#93;; for( var y = 0; y &lt; choiceElementList.childNodes.length; y++ ) { if (choiceElementList.childNodes&#91;y&#93; &amp;&amp; choiceElementList.childNodes&#91;y&#93;.tagName) { var tag = choiceElementList.childNodes&#91;y&#93;.tagName.toLowerCase(); if (tag == 'input') { Wicket.Event.add(choiceElementList.childNodes[y] 'click'  callbackscript); } } } }},0,1
HybridUrlCodingStrategy and StatelessForm ( or StatelessLink ) results in invalid parameter encoding,I put a header component on one of my pages which contains a statelessform ( or stateless link ) . I mounted the page with a HybridUrlCodingStrategy . When you request the page like thishttp://localhost:9696/mountpath/param1/param1value  stateless form attaches another parameter which shows the forms IFormListener target. The new url is like this :http://localhost:9696/mountpath/param1/param1value/wicket:interface/%3A0%3Aheader%3AloggedOutView%3AloginForm%3A%3AIFormSubmitListener%3A%3A/.0I haven't covered all the source code for now but i think the form changes the page parameters object so i think HybridUrlCodingStrategy must clone initial page parameters before putting it to page metadata. But not sure that this will cause any other problems,0,0
BigDecimalConverter is not precise,Currently  if we use the BigDecimalConverter class  it converts the values by first letting the NumberFormat to parse the value into a Double  which the BigDecimalConverter class in turn turns into a BigDecimal.Unfortunately such an implementation loses precision  for example if we enter '123.45' in a form  it can be converted to '123.45000000000001' or '123.44999999999999999' thanks to the conversion to a Double.Fixing the issue is rather simple: check if the NumberFormat you get is a DecimalFormat  and if yes  simply call format.setParseBigDecimal(true) and the NumberFormat will interpret the values correctly.,0,0
AutoCompleteTextField's *scrollable* suggestion list disappeared when a mouse pointing to the scroll bar in IE6/7,if we define the following CCS to fix the height of the suggestion list  the list will become to be scrollable when it is overflow  for example  there are 100 suggestions should be shown.div.wicket-aa { height: 200px; overflow: auto;}if a user moves his mouse to the scroll bar  the suggestion list will disappear immediately in IE6/7 but in FF. The reason is that the onblur event of the text field is triggered in IE but in FF. At the moment the mouse pointing to the scroll bar  Wicket.AutoComplete.mouseactive is 0  therefore  hideAutoComplete() was called. That's why the suggestion list disappeared in IE6/7.,0,0
Localizer doesn't honor style when caching property lookups,In Wicket 1.2.6  we created some properties files like:Foo.propertiesFoo_style1.propertiesFoo_style2.propertiesand used StringResourceModel to look up property values. This worked correctly as in 1.2.6  Localizer didn't cache the property lookups and respected the style. However  in 1.3  Localizer now caches the lookups but doesn't respect the style when creating the cache key (though it does append the locale to the end of the cache key).The side-effects of this are that whatever style is in use when a property is first looked up  that property value will be returned for all subsequent lookups regardless of style.,0,0
Having instance variables referencing pages causes memory leaks  StackOverflowErrors and ClassCastExceptions,Having references (instance variables)  in objects reachable from the component hierarchy  to pages other than the 'current' page  causes memory leaks StackOverflowErrors and sometimes ClassCastExceptions.This seems to be due to the special serialization code implemented in Page  even if I haven't been able to pinpoint exactly where the problem lies. Standard serialization handles cycles between objects if the deserialization or serialization is done using the same ObjectInputStream or ObjectOutputStream  but here each Page is being deserialized in different ObjectInputStreams.Looking at the stack traces from the StackOverflowErrors it's easy to see that it's the deserialization that goes over the same pages over and over again (although it's new instances).The ClassCastExceptions where because the Page.numericId was zero when serializing them in Page.writeObject  causing the wrong Page to be deserialized in readObject. By looking at the code I can't really understand how the numericId can become zero  except for in the first page. The only thing I can think of is if it's being serialized by another thread before it's initialized.Our application is 'AJAX only' with a main page built up of quite a lot of components in a quite deep hierarchy. When discovering this problem  there was one panel with seven different AjaxLinks that opened ModalWindows  where some of the ModalWindows had fields referencing the contained iframe pages. Clicking around on the links soon made the memory and CPU consumption rise and after a while one of the mentioned errors occurred.Even if I thought that it would  neither turning off page versioning nor setting ISessionSettings.setPageIdUniquePerSession(true) seemed to have any effect.After redesigning the code a bit  removing all the field references to Pages  it seems to work fine again. I realize that having such references isn't a very good design even without this problem. Perhaps it shouldn't be supported at all. It might be  though  that some users have done this and don't know it's a problem (yet).Although in the above case it was only AJAX  I've made an example application that also shows that the same problems occurs using normal links  and pages with references between them. I'll attach that example in a couple of minutes.,0,1
Not all of SignInPanel is properly localized,When logging in without typing a password on the SignInPanel I get the message: veld 'password' is verplicht.instead of veld 'wachtwoord' is verplicht.Furthermore  when logging in fails  I get the message: Sign in failedinstead of 'Inloggen mislukt' or something like that. Maybe there should be properties files included?,0,0
MarkupCache can 'leak' memory,Currently markup cache uses a cache without any capacity upper bound :| normally this would be ok  holding markup of an entire application doesnt require THAT much memory. However  suppose we have Index page with markup Index.html. the page is requested with local en_us and we cache contents of index.html in the cache. now Index is requested with locale en_gb and we cache it AGAIN. Now we have two entries in the cache caching the exact same thing. the more locales users request (we pull the locale from the user's browser) the more copies of the same thing we cache.Thomas Singer reported his application running out of memory  attached memory snapshot contained a MarkupCache instance of over 48MB retained size (the internal map had allocated 4096 keys). He has an application with about 64 pages  and they only support one locale. When I browsed the snapshot I noticed a lot of different locales in the markup cache keys....An ideal solution would be to have two caches. One for &#91;container.class locale style variation&#93;&gt;&#91;resource.name&#93; lookup  and the other for &#91;resource.name&#93;&gt;&#91;resource.contents&#93; lookup.A suboptimal solution would be to place an upper bound on the cache. See attached patch which contains a 1000 item lru cache. if looks ok we can roll it in as a solution for 1.3.2 branch - since it doesnt require any interfaces breakages.,0,1
Input field with autocomplete behavior does not submit the form via enter key in some cases,This is related to WICKET-2 but wasn't fixed in that bug:When you enter nothing in an input field with autocomplete and press enter  type something that doesn't give results or press escape when the autocomplete box has appeared  you have to press enter twice to submit the form.The solution is quite simple: remove line 219 from wicket-autocomplete.js:hidingAutocomplete=1;This variable was introduced to keep enter from submitting  but by setting it here always to 1  enter is blocked in the above cases.,0,0
AbstractCalendar use the wrong resources path,I extends the AbstractCalendar  and want to show the calendar directly. But I got an 'YAHOO is not defined' javascript error  because the javascripts' url it generated are not correct.I find that the contributeDependencies methods in AbstractCalendar don't add the resources correctly. For example  the add(HeaderContributor.forJavaScript(YuiLib.class  'yahoo.js'));should be add(HeaderContributor.forJavaScript(YuiLib.class  'yahoo/yahoo.js'));and add(HeaderContributor.forJavaScript(YuiLib.class  'event.js')); should beadd(HeaderContributor.forJavaScript(YuiLib.class  'event/event.js'));and other resources.,0,0
MiniMap IndexOutOfBoundsException when empty,findKey() assumes that there is at least one entry in the mapThis checks first:Index: /Users/John/Development/wicket/trunk/jdk-1.4/wicket/src/main/java/org/apache/wicket/util/collections/MiniMap.java===================================================================&#8212; /Users/John/Development/wicket/trunk/jdk-1.4/wicket/src/main/java/org/apache/wicket/util/collections/MiniMap.java (revision 614519)+++ /Users/John/Development/wicket/trunk/jdk-1.4/wicket/src/main/java/org/apache/wicket/util/collections/MiniMap.java (working copy)@@ -118 13 +118 16 @@ */ public Object get(final Object key) { // Search for key final int index = findKey(key);- if (index != -1)+ if (size &gt; 0) { // Return value return values&#91;index&#93;;+ // Search for key+ final int index = findKey(key);++ if (index != -1)+ {+ // Return value+ return values[index];+ } } // Failed to find key,0,0
'charset=UTF-8' is appended to Content-Type of  DynamicWebResources,After upgrading from wicket 1.2.6 to 1.3.1 we now have a big problem when opening PDF files inside the IE browser window. Instead the PDF file is now loaded as a separate window  leaving the Browser window empty.I traced the problem down wicket always appending ';charset=UTF-8' to the Content-Type  and this can be viewed by using a http debugger:Wicket 1.2.6: Works Content-Type: application/pdf Wicket 1.3.1: PDF opened outside the browser.Content-Type: application/pdf; charset=UTF-8 The ';charset=UTF-8' is appended in ResourceStreamRequestTarget  and I can't see a way to override it. Please make it possible to have the Content-Type as set by the DynamicWebResource,0,0
bug: setObject(null) called for excplicitly invisible fields in a non-visible enclosure,It seems that the value for fields that are made invisible because a surrounding enclosure is actually lost on submit of the form.Consider the following code:public class HomePage extends WebPage { private MyObject myObject; public HomePage(final PageParameters parameters) { myObject = new MyObject(); myObject.setField1('field1Value'); myObject.setField2('field2Value'); Form f = new Form('f'  new CompoundPropertyModel(myObject)); add(f); f.add(new TextField('field1').setVisible(false)); f.add(new TextField('field2')); f.add(new Button('submit') { @Override public void onSubmit() { System.out.println('Field 2 value should be 'field2Value' but is : ' + myObject.getField2()); } }); } class MyObject implements Serializable { private String field1; private String field2; public String getField1() { return field1; } public void setField1(String field1) { this.field1 = field1; } public String getField2() { return field2; } public void setField2(String field2) { this.field2 = field2; } }}With the following markup:&lt;form wicket:id='f'&gt; &lt;wicket:enclosure child='field1'&gt; &lt;input type='text' wicket:id='field1'/&gt; &lt;input type='text' wicket:id='field2'/&gt; &lt;/wicket:enclosure&gt; &lt;input type='submit' wicket:id='submit'/&gt;&lt;/form&gt;Field1 keeps it's value onSubmit  but the value for field2 is lost  and my model object has null in field2. If I implicitly call setVisible(false) on the TextField for field2  the value is kept onSubmit.Igor put better like this I guess:when the page renders none of the fields are shown. after submit however  myobject.getfield1() is still 'field1value' butmyobject.getfield2() is null - which implies that textfield2 is stillprocessed even though it is inside an enclosure that has been hidden.,0,0
AjaxSubmitLink doesn't always find enclosing form properly,If the AjaxSubmitLink constructor that doesn't take in a form is called  it calls the constructor that does take in a form with null for the form. This seems correct  and it passes the form argument into the constructor of the AjaxFormSubmitBehavior as also seems correct. AjaxFormSubmitBehavior has a private getForm() method that  if the form is null  sensibly searches through the component hierarchy to find a form that contains the component. This is also good. The bit that seems wrong is that the overridden onSubmit(AjaxRequestTarget) and onError(AjaxRequestTarget) methods in AjaxSubmitLink's version of AjaxFormSubmitBehavior call AjaxSubmitLink's onSubmit and onError with the form argument that was originally passed into the constructor. This means that if you originally called the one-argument constructor for AjaxSubmitLink  the onSubmit and onError methods will be called with a null form  rather than the actual form that was submitted.As far as I can see  an easy fix for this would be to make getForm() in AjaxFormSubmitBehavior protected rather than private  and then to call getForm() in the overridden onSubmit and onError in AjaxSubmitLink's version of AjaxFormSubmitBehavior. That way the AjaxSubmitLink's onSubmit and onError would always be called with the actual form that was submitted.,0,0
Escaping DiskPageStore SessionFolder needed,When sessionId=8y4bxNcyiScVVV6QtVp9lg**.node1 Wicket can't create the temp directory because the name contains invalid character (at least on windows).So a FileNotFoundException is thrown.The use case happens when tomcat is configured as (in order to work with apache module mod_jk) &lt;!-- Define an AJP 1.3 Connector on port 8009 --&gt; &lt;Connector port='8009' address='${jboss.bind.address}' protocol='AJP/1.3' emptySessionPath='true' enableLookups='false' redirectPort='8443' /&gt; &lt;Engine name='jboss.web' defaultHost='localhost' jvmRoute='node1'&gt;My very temp solution (to let things go) is  private File getSessionFolder(String sessionId  boolean create) { File storeFolder = getStoreFolder(); File sessionFolder = new File(storeFolder  sessionId.replace('*' '_')); if (create &amp;&amp; sessionFolder.exists() == false) { mkdirs(sessionFolder); } return sessionFolder; }I think that a global solution is needed to fix the problem.,0,0
FormComponent.error(ivalidationerror) error needs to show tried resource keys,Please see the following discussion from Wicket forum http://www.nabble.com/Having-problems-with-resource-keys-in-a-form-which-has-two-panels-of-the-same-kind-td15881597.html,0,0
StyleDateConverter does not use the components Locale when formatting.,The StyleDateConverter class does not use .withLocale(getLocale()) in the getFormat() method.This means that any 'LL' formatted dates do not have the correct translations present when outputting words (eg  month).protected DateTimeFormatter getFormat() { DateTimeFormatter dtf = DateTimeFormat.forPattern(getDatePattern()).withPivotYear(2000); return dtf;}should beprotected DateTimeFormatter getFormat() { DateTimeFormatter dtf = DateTimeFormat.forPattern(getDatePattern()).withLocale(getLocale()).withPivotYear(2000); return dtf;},0,0
External JAvascript references not included,When using IHeaderResponse to include an external Javascript file  it is not included because of this bug:Index: /Users/John/Development/wicket/trunk/jdk-1.4/wicket/src/main/java/org/apache/wicket/markup/html/internal/HeaderResponse.java===================================================================&#8212; /Users/John/Development/wicket/trunk/jdk-1.4/wicket/src/main/java/org/apache/wicket/markup/html/internal/HeaderResponse.java (revision 614519)+++ /Users/John/Development/wicket/trunk/jdk-1.4/wicket/src/main/java/org/apache/wicket/markup/html/internal/HeaderResponse.java (working copy)@@ -177 7 +177 7 @@ { List token1 = Arrays.asList(new Object[] { 'javascript'  url }); List token2 = Arrays.asList(new Object[] { 'javascript'  id }); if (wasRendered(token1) == false &amp;&amp; wasRendered(token2))+ if (wasRendered(token1) == false &amp;&amp; wasRendered(token2) == false) { JavascriptUtils.writeJavascriptUrl(getResponse()  url  id); markRendered(token1);@@ -258 8 +258 7 @@ { if (!closed) { List token = Arrays .asList(new Object[] { 'javascript-event'  target  event  javascript });+ List token = Arrays.asList(new Object[] { 'javascript-event'  target  event  javascript }); if (wasRendered(token) == false) { renderJavascriptReference(WicketEventReference.INSTANCE);@@ -264 7 +263 7 @@ { renderJavascriptReference(WicketEventReference.INSTANCE); JavascriptUtils.writeJavascript(getResponse()  'Wicket.Event.add(' + target + '  /'' + event + '/'  function() { ' + javascript + ';});');+ '  /'' + event + '/'  function() { ' + javascript + ';});'); markRendered(token); } }@@ -275 7 +274 7 @@ */ public void close() {- this.closed = true;+ closed = true; } /**,0,0
CheckGroupSelector should implement ILabelProvider,The CheckGroupSelector component (used to check all Checks within a Checkgroup) should implement ILabelProvider (or extend LabeledWebMarkupContainer) as currently no &lt;label&gt; can be bound to a CheckGroupSelector.,0,0
Allow to change charset in StringRequestTarget,It's impossible to access the created StringBufferResourceStream charset without overriding the entire respond method.,0,0
request to make RadioChoice getPrefix() and getSuffix() non-final,I'm working on a project where we have subclassed RadioChoice  and would like to override the methods getPrefix() and getSuffix(). However these methods are declared as final. Please change them to be non-final  unless there is some particular reason for them to remain final.Thanks!,0,0
AuthenticatedWebApplication uses deprecated constructor of AuthenticatedWebSession,In changing from 1.3.1 to 1.3.2 the AuthenticatedWebSession(AuthenticatedWebApplication  Request) method became deprecated  but AuthenticatedWebApplication#newSession still searches for this one.Simply a matter of changing lines 114-116 of AuthenticatedWebApplication.java from:return webSessionClassRef.get().getDeclaredConstructor( AuthenticatedWebApplication.class  Request.class).newInstance( AuthenticatedWebApplication.this  request);to:return webSessionClassRef.get().getDeclaredConstructor( Request.class).newInstance( request);,0,0
make setAfter/BeforeDisabledLink return 'this' for chaining,Is it possible to make setAfterDisabledLink on AbstractLink return 'this' so that chaining is possible. Now I have somthing similar to the following: fragment.add(new BookmarkablePageLink('season2Link'  ProgramsPage.class  new PageParameters('0=2008')) { { setAfterDisabledLink(''); setBeforeDisabledLink(''); } @Override public boolean isEnabled() { return '2008'.equals(season); } });But it would be nice if I could do: fragment.add(new BookmarkablePageLink('season2Link'  ProgramsPage.class  new PageParameters('0=2008')) { @Override public boolean isEnabled() { return '2008'.equals(season); } }.setBeforeDisabledLink('').setAfterDisabledLink(''));,0,0
Make the Source Code pages for examples stateless,Page expiry is very frustrating  especially when you tab back to the source code to see how something is achieved.Can we make the code pages either static or stateless  so we can bookmark them  send them to colleagues  or come back 30mins later and click a link without it saying 'page expired'?,0,0
WicketTester.startPage(Class) does not trigger WebRequestCycle.onBeginRequest,While using WicketTester to test my WebApplication that is using a custom WebRequestCycle and WebRequestCycleProcessor I noticed that WicketTester does not follow the same RequestCycle as it would do when running in a real live environment resulting in MyWebRequestCycle.onBeginRequest not being called.Using startPage(Page) will call MyWebRequestCycle.onBeginRequest but then the IRequestTarget that is resolved from the Request indicates the Request comes from the DummyHomePage.testPage link. Can startPage be implemented that it really resembles the real live environment? After some research and testing I came up with this implementation  maybe it can be used:public Page startPage(Class pageClass) { WebRequestCycle requestCycle = super.setupRequestAndResponse(); requestCycle.getRequest().getRequestParameters().setBookmarkablePageClass(pageClass.getName()); super.processRequestCycle(requestCycle); return super.getLastRenderedPage();},0,0
WicketTester.clickLink(String) only triggers the WebRequestCycle.onEndRequest,This issue is somewhat related to WICKET-1434.The WebRequestCycle.onBeginRequest is called in a real live environment.I created an implementation for WicketTester for clicking AjaxLink's that triggers the onBeginRequest but I can't really asses if it breaks something. Maybe it can be used as example or something:class MyWicketTester extends WicketTester { public void clickAjaxLink(String linkPath) { WebRequestCycle cycle = super.setupRequestAndResponse(); cycle.getRequest().getRequestParameters().setInterfaceName(IBehaviorListener.class.getSimpleName()); cycle.getRequest().getRequestParameters().setBehaviorId('0'); cycle.getRequest().getRequestParameters().setComponentPath(getComponentFromLastRenderedPage(linkPath).getPath()); super.processRequestCycle(cycle); }},0,0
Unable to use properties file when generating XML files,Please refer to this thread: http://www.nabble.com/Unable-to-use-wicket:message-when-generating-XML-files-td15779276.html,0,0
detach behavior,This was originally posted as a ConcurrentModificationException during detach on the wicket user list (http://markmail.org/message/xnrot5hm4wvow7dq) but later investigations show that there is something else not right.Let me begin by restating the original problem:A couple of days ago Warren came to me with a problem. If he attacheda behavior to a component which potentially throws aRestartResponseAtInterceptPageException aConcurrentModificationException would bubble all the way into tomcatcode.Now you probably are going to say: 'Then don't do that'  but thefact that an exception escapes wicket is imo reason to investigate.So i did some digging. The situation is as follows:In the renderHead method of an IHeaderContributor a check is performedfor an authenticated user  if none is found a RRAIPE is thrown.One of the places that executes renderHead is the onDetach of WebPage.Now suppose we have a Page A which has a component decorated with thisheader contributor  the page also contains a Button to log off users.The onsubmit for this button is as simple as log user off andsetResponsePage(class).This page is usually only accessible if an authenticated user isavailable so everything works fine if that is the case.But then the user decides to log off  the onsubmit is triggered andexits normally. the request continues and reaches the point where theRequestCycle is detaching all RequestTargets (at that point there are2 targets  1 for the current page and 1 set during the onsubmit).During the detach the renderHead method is executed along with thecheck for an authenticated user. Since there isn't one anymore aRRAIPE is thrown  adding a 3rd target to the stack of RequestTargets.The RRAIPE bubbles up to RequestCycle.detach() and is caught andlogged there. Then wicket attempts to detach the next RequestTargetbut since an iterator is used to loop through all targets  theiterator detects the stack has been changed and throws aConcurrentModificationException. Ultimately resulting in a tomcaterror page.I tried changing the iterator loop to a regular for(int i=0;i &lt; .....)loop and this seems to fix the problem  even if later on morerequesttargets are added wicket happily executes them and comes upwith the desire page.There is one disadvantage i see with this solution: the requesttargetthrowing the RRAIPE is not fully detached. Perhaps the RRAIPE can beswallowed after it has added a RequestTarget and only in the case of adetach phase. That way the rest of the page could be normallydetached.Here is where it gets interesting:Johan noticed that WebPage.detach should not call renderHead during detach.In fact the only reason it does so is during development when it does not detect a header element. It then checks if there indeed should not be a header by visiting the behaviors and comparing the output to what it currently has. However as the code comments point out it then does nothing with that information because the code that should handle it does not work yet.So the question became why does the page does not have a header element. At first i thought this is because in this case a setResponsePage is done which would suppress any rendering of the current page.However this is not the case as renderhead is also called during detach in a normal page render. It does not matter if the markupfile contains a header element or not. As it turns out the presence of a header element is checked by getting a wicket component with id header This always returns null as there is no such child component. There is however a child component with an id like _header_0,0,1
nested forms inside a multipart form can't be submitted via ajax,nested forms can't be submitted via ajax if any of the parent forms contain a fileuploadfield (which makes the root form a multipart).fix: skip changing the request to a multipart request in Form#handleMultiPart  if it's an ajax request.these two types of requests mutually exclude each other anyway.,0,0
StreamCorruptedException/PageStore/Serialization broken because ObjectOutputStream was not flushed,The Objects.objectToByteArray() method incorrectly forgets to flush/close the ObjectOutputStream it uses. This can create corrupt object streams.,0,0
Problem with ajax form submission inside model window in IE and Safari,,0,0
Add downloadSources option to quickstart page,would be cool to have a checkbox or a radio&#91;yes/no&#93; that will control -DdownloadSources=true param at http://wicket.apache.org/quickstart.html,0,0
BaseWicketTester.isComponentOnAjaxResponse() test is too strong,Using 1.3.0 but still present in 1.3.2 source.The response i got from the ajax request was :&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;ajax-response&gt;&lt;header-contribution encoding='wicket1' &gt;&lt;![CDATA[&lt;head xmlns:wicket='http://wicket.apache.org'&gt;&lt;script type='text/javascript' src='resources/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js'&gt;&lt;/script&gt;&lt;script type='text/javascript' src='resources/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js'&gt;&lt;/script&gt;&lt;script type='text/javascript' src='resources/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js'&gt;&lt;/script&gt;&lt;script type='text/javascript' id='wicket-ajax-debug-enable'&gt;&lt;Unable to render embedded object: File (--/*--&gt;&lt;) not found.[CDATA[/&gt;&lt;!--/wicketAjaxDebugEnable=true;/--&gt;]]&gt;/&lt;/script&gt;&lt;script type='text/javascript' src='resources/org.apache.wicket.extensions.ajax.markup.html.autocomplete.AutoCompleteBehavior/wicket-autocomplete.js'&gt;&lt;/script&gt;&lt;script type='text/javascript' src='resources/com.amdm.ajf.wicket.component.autocomplete.ImprovedAutoCompleteBehavior/improved-autocomplete.js'&gt;&lt;/script&gt;&lt;/head&gt;]]&gt;&lt;/header-contribution&gt;&lt;component id='ville9' encoding='wicket1' &gt;&lt;![CDATA[&lt;input value='TOULOUSE' autocomplete='off' maxlength='26' type='text' onfocus='this.className='focus';' size='28' name='view:adresse:adresseInner:villeFrancaiseDiv:ville' onchange='wicketThrottler.throttle( 'th1'  200  function() { var wcall=wicketAjaxPost('?wicket:interface=:0:updateExpertWizard:form:view:adresse:adresseInner:villeFrancaiseDiv:ville::IBehaviorListener:3:-1'  wicketSerialize(Wicket.$('ville9')) null null  function() {return Wicket.$('ville9') != null;}.bind(this));});' id='ville9' onblur='this.className='normal';'/&gt;&lt;script type='text/javascript'&gt;&lt;Unable to render embedded object: File (--/*--&gt;&lt;) not found.[CDATA[/&gt;&lt;!--/new Wicket.AutoComplete('ville9' '?wicket:interface=:0:updateExpertWizard:form:view:adresse:adresseInner:villeFrancaiseDiv:ville::IActivePageBehaviorListener:1:-1&amp;wicket:ignoreIfNotActive=true' false);/--&gt;]]&gt;/&lt;/script&gt;]]&gt;&lt;/component&gt;&lt;component id='codePostalBinde8' encoding='wicket1' &gt;&lt;![CDATA[&lt;input value='34200' autocomplete='off' maxlength='5' type='text' onfocus='this.className='focus';' size='5' name='view:adresse:adresseInner:villeFrancaiseDiv:codePostalBinde' onchange='wicketThrottler.throttle( 'th2'  200  function() { var wcall=wicketAjaxPost('?wicket:interface=:0:updateExpertWizard:form:view:adresse:adresseInner:villeFrancaiseDiv:codePostalBinde::IBehaviorListener:3:-1'  wicketSerialize(Wicket.$('codePostalBinde8')) null null  function() {return Wicket.$('codePostalBinde8') != null;}.bind(this));});' id='codePostalBinde8' onblur='this.className='normal';'/&gt;&lt;script type='text/javascript'&gt;&lt;Unable to render embedded object: File (--/*--&gt;&lt;) not found.[CDATA[/&gt;&lt;!--/new Wicket.AutoComplete('codePostalBinde8' '?wicket:interface=:0:updateExpertWizard:form:view:adresse:adresseInner:villeFrancaiseDiv:codePostalBinde::IActivePageBehaviorListener:1:-1&amp;wicket:ignoreIfNotActive=true' false);/--&gt;]]&gt;/&lt;/script&gt;]]&gt;&lt;/component&gt;&lt;/ajax-response&gt;And my test is :tester.assertComponentOnAjaxResponse('updateExpertWizard:form:view:adresse:adresseInner:villeFrancaiseDiv:ville');It fails in BaseWicketTester.isComponentOnAjaxResponse() :// Look for that the component is on the response  using the markup id boolean isComponentInAjaxResponse = ajaxResponse.matches('(?s).*&lt;component id=/'' + markupId + '/' ?&gt;.*'); failMessage = 'Component wasn't found in the AJAX response';because of the attribut { encoding='wicket1' } present in the component tag. The regex must be sweeter like (for example):'(?s).&lt;component id=/'' + markupId + '/' . ?&gt;.*' (or much much better,0,0
Unusual ClassCastException (SimpleAttributeModifier to IBehaviorListener) processing onError.,Build the application from the four class files and one html file below. Run class Start as an application. Go to your browser  to this URL:http://localhost:4280/behaviorbug/Type some text into the text field. After six characters  it will throw a ClassCastException.Source:package com.bugs.behaviorBug;import org.apache.wicket.ajax.AjaxRequestTarget;import org.apache.wicket.ajax.form.AjaxFormComponentUpdatingBehavior;import org.apache.wicket.behavior.SimpleAttributeModifier;import org.apache.wicket.markup.html.form.TextField;import org.apache.wicket.model.IModel;public class BehaviorBug extends TextField { public BehaviorBug(String id  IModel model) { super( id  model ); init(); } private int kc = 0; private int cc = 0; private final SimpleAttributeModifier blackBorder = new SimpleAttributeModifier( 'border-color'  'black' ); private final SimpleAttributeModifier redBorder = new SimpleAttributeModifier( 'border-color'  'red' ); private SimpleAttributeModifier currentBorder = null; private void init() { setBorder( this.blackBorder ); AjaxFormComponentUpdatingBehavior changeWarningBehavior = new AjaxFormComponentUpdatingBehavior( 'onchange' ) { @Override protected void onUpdate(AjaxRequestTarget target) { System.err.println( 'WarningTextField onUpdate onChange ' + BehaviorBug.this.cc++ ); reColor(); } }; // I'm trying to do something tricky here. I want it to validate after every // keystroke  so the user can get instant feedback on when the data is good. AjaxFormComponentUpdatingBehavior keyUpWarningBehavior = new AjaxFormComponentUpdatingBehavior( 'onkeyup' ) { @Override protected void onUpdate(AjaxRequestTarget target) { System.err.println( 'WarningTextField onUpdate onKeyUp ' + BehaviorBug.this.kc++ ); reColor(); // Thread.dumpStack(); } // The implementation of AjaxFormComponentUpdatingBehavior only calls // onUpdate // when the field is valid. Since it won't update when the field is // invalid  I // can't get my instant feedback unless I call onUpdate() when there's an // error. // Since I can't override onEvent() (It's final)  I override onError to // force // an update even when the field is invalid. This should be safe  since // onError() // is only called on invalid data with a null exception  in which case it // does // nothing. // This  however  seems to be what causes the bug. I have no idea why this // would cause the bug. @Override protected void onError(AjaxRequestTarget target  RuntimeException e) { // Called on validation error with a null e. super.onError( target  e ); // Throws e  if it's not null. Does nothing // otherwise. onUpdate( target ); } }; add( changeWarningBehavior ); add( keyUpWarningBehavior ); } private void reColor() { if ( isValid() ) { setBorder( BehaviorBug.this.blackBorder ); } else { setBorder( BehaviorBug.this.redBorder ); } } private void setBorder(SimpleAttributeModifier border) { if ( this.currentBorder != null &amp;&amp; this.currentBorder != border ) { remove( this.currentBorder ); } this.currentBorder = border; add( this.currentBorder ); }}package com.bugs.behaviorBug;import org.apache.wicket.Application;import org.apache.wicket.Page;import org.apache.wicket.Request;import org.apache.wicket.Response;import org.apache.wicket.Session;import org.apache.wicket.protocol.http.WebApplication;import org.apache.wicket.protocol.http.WebSession;/**  @author Miguel Muﾃｱoz @version $Id$  */public class BehaviorBugApplication extends WebApplication { /** Constructor */ public BehaviorBugApplication() { // empty } @Override protected void init() { // empty } @Override public Class&lt;? extends Page&gt; getHomePage() { return Index.class; } /* (non-Javadoc)  @see org.apache.wicket.protocol.http.WebApplication#newSession(org.apache.wicket.Request  org.apache.wicket.Response) */ @Override public Session newSession(Request request  Response response) { return new BugSession( this  request ); } public class BugSession extends WebSession { public BugSession(Application application  Request request) { super(request); setApplication( application ); } }}package com.bugs.behaviorBug;import org.apache.wicket.markup.html.WebPage;import org.apache.wicket.markup.html.form.Form;import org.apache.wicket.markup.html.form.TextField;import org.apache.wicket.model.Model;import org.apache.wicket.validation.IValidator;import org.apache.wicket.validation.validator.StringValidator;/**  @author Miguel Muﾃｱoz @version $Id$  */public class Index extends WebPage { /**  */ public Index() { Form form = new Form('form'); TextField textField = new BehaviorBug('testfield'  new Model()); IValidator lengthValidator = new StringValidator.MaximumLengthValidator(4); textField.add( lengthValidator ); form.add( textField ); add(form); }}package com.bugs.behaviorBug;import org.mortbay.jetty.Connector;import org.mortbay.jetty.Server;import org.mortbay.jetty.nio.SelectChannelConnector;import org.mortbay.jetty.webapp.WebAppContext;/**  @author Miguel Muﾃｱoz @version $Id$  */public class Start { private static final int defaultPort = 4280; /**  @param args */ public static void main(String[] args) { int port = defaultPort; if (args.length != 0) Unknown macro: { try { port = Integer.valueOf( args[0] ); } catch ( NumberFormatException e ) { System.err.println('Unable to parse port parameter /'' + args[0] + '/' as an integer.'); System.err.println('Using default value of x ' + defaultPort); } }  Server server = new Server(); SelectChannelConnector connector = new SelectChannelConnector(); connector.setPort( port ); server.setConnectors( new Connector[] { connector } ); WebAppContext web = new WebAppContext();// web.setContextPath( '/workspace/WicketTutorial' ); web.setContextPath( '/behaviorbug' ); System.out.println( 'CP: ' + web.getContextPath() ); web.setWar( 'src/main/webapp' + port ); server.addHandler( web ); try { server.start(); // Who was the bozo who declared this to throw Exception? server.join(); } catch ( Exception e ) { e.printStackTrace(); System.exit( 1 ); } }}&lt;html&gt;&lt;head&gt;&lt;title&gt;Behavior Bug&lt;/title&gt;&lt;link href='style.css' rel='stylesheet' /&gt;&lt;/head&gt;&lt;body&gt;&lt;div id='container'&gt; &lt;div id='header'&gt;Behavior Bug&lt;/div&gt; &lt;div id='content'&gt; Type some text into the field below. After six characters  you'll get a stack trace. &lt;form wicket:id='form'&gt; &lt;input type='text' wicket:id='testfield' name='txt' width='35' size='25' /&gt;&lt;p&gt; submit: &lt;input type='submit' value='That's all  Folks!'/&gt;&lt;/p&gt; &lt;/form&gt; End of form. &lt;/div&gt;&lt;/div&gt;Test of Build Process.&lt;/body&gt;&lt;/html&gt;,0,0
Allow form to specify prefix for formcomponent names,,0,0
DataTable.html does not validate (HTML 4.01/XHTML-Strict),According to http://www.w3.org/TR/html401/struct/tables.html#h-11.2.3  &lt;tfoot&gt;..&lt;/tfoot&gt; must come before the start of &lt;tbody&gt;. The has not changed for XHTML.Proposed fix: just move &lt;tfoot&gt; up after &lt;thead&gt; and before &lt;tbody&gt;.,0,0
AjaxEditableMultiLineLabel + race condition /,There are two issues concerning AjaxEditableMultiLineLabel:a) Race condition cancel editingUsing 'Esc' to cancel editing might lead to two events to be fired: first onKeypress is executed - which leads to bluring the component in Opera. This results in the onblur-event firing and the input is submitted!Changing the code in onComponentTag to protected void onComponentTag(ComponentTag tag) {  super.onComponentTag(tag); final String saveCall = '{wicketAjaxGet('' + getCallbackUrl() + '&amp;save=true&amp;'+this.name+'='+wicketEncode(this.value)); return false;}'; final String cancelCall = '{wicketAjaxGet('' + getCallbackUrl() + '&amp;save=false'); this.onblur=''; return false;}'; final String keypress = 'var kc=wicketKeyCode(event); if (kc==27) ' + cancelCall + '; '; tag.put('onblur'  saveCall); tag.put('onkeypress'  keypress); }stops onblur being fired.This might also apply for AjaxEditableLabel - though I haven't seen this happening there yet.b) Displaying defaultNullLabel on empty String Model:Should behave like AjaxEditableLabel  i.e.: protected void onComponentTagBody(MarkupStream markupStream  ComponentTag openTag) { Object modelObject = getModelObject(); if (modelObject == null || ''.equals(modelObject)) { replaceComponentTagBody(markupStream  openTag  defaultNullLabel()); } else { super.onComponentTagBody(markupStream  openTag); } },0,0
MarkupCache.putIntoCache doesn't behave correctly!!,'putIntoCache' checks for the locationString not to be null instead of the cacheKey!This way you always get old markup returned instead of the freshly supplied markup which shouldn't be cached at all.,0,0
AutoCompleteTextField - javascript error 'type mismatch' in line 227 in IE,I just swithed from 1.3.2 to 1.3.3 and that resultet in a javascript error 'type mismatch' in line 227  wich is this line in wicket-autocomplete.js:  menu.style.zIndex=index=='auto'?index:Number(index)+1;Only in IE (6.0) - firefox works fine.,0,0
MarkupCache style/variation/locale support broken,We're running into a problem with the change made for this issue: WICKET-1370Basically  if you have a situation like this where the Login page extends DefaultPage and uses &lt;wicket:extend&gt;:Login.htmlDefaultPage.htmlDefaultPage_style1.htmlDefaultPage_style2.htmlThe markup for DefaultPage will always be based on the first style the site is hit with. This is because the location string ('Login.html') hasn't changed with the style change.,0,0
Widen Generics for Lists/Iteratos,It is important to widen the generics for collections.For example it is better (and sometimes necessary) to change the signature of org.apache.wicket.markup.repeater.data.IDataProvider#iterator to:Iterator&lt;? extends T&gt; iterator(int first  int count);I will create and add a patch later.,0,0
WicketAjaxIndicatorAppender rename to AjaxIndicatorAppender,Just a tiny niggle really... but other ajax components start with Ajax.... and I always forget this one! Perhaps rename and keep a deprecated subclass with the old name?,0,0
NPE in EnclosureResolver,if you put a single wicket:container in a wicket:enclosure  it will NPE looking for a 'child' attribute. you can work around by either changing the container to a div (in which case it will correctly default to the single child) or by adding a child='name' attribute to the enclosure to explicitly specify the single child.Caused by: java.lang.NullPointerException at org.apache.wicket.markup.resolver.EnclosureResolver.resolve(EnclosureResolver.java:59) at org.apache.wicket.MarkupContainer.renderNext(MarkupContainer.java:1324) at org.apache.wicket.MarkupContainer.renderComponentTagBody(MarkupContainer.java:1476) at org.apache.wicket.MarkupContainer.renderAssociatedMarkup(MarkupContainer.java:639) at org.apache.wicket.markup.html.panel.Panel.onComponentTagBody(Panel.java:112) at org.apache.wicket.Component.renderComponent(Component.java:2478) ... 47 common frames omitted,0,0
addDomReadyEvent unreliable for Safari,Because Safari doesn't support an onDomReady event  wicket-event.js emulates that behavior using timeouts when that browser is detected. However  the timeout is only set once  for 10ms; window.setTimeout() does not produce a repeating timeout. If the document object is not ready at that point  the registered functions are never called. Often it is ready  so the bug is masked.I discovered this problem in a page that uses the DateTimeField component  which uses onDomReady for its initialization. Sometimes the component works fine  other times nothing happens when you click. It's a fairly complicated page that apparently Safari may spend more than 10ms building.,0,1
make AutoCompleteBehavior's configuration more flexible,add AutoCompleteSettings which encapsulates all needed configuration options  so we don't need hundreds of constructors just to have every combination of configuration options available.,0,1
Localizer API should be enhanced so that the cache implementation can be overwritten,/** Create a new cache  override this method if you want a different map to store the cache keys  for example a map that hold only the last X number of elements..  By default it uses the {@link ConcurrentHashMap}  @return cache */ protected Map newCache() { return new ConcurrentHashMap(); },0,0
Fix default localizations,The english localizations for DateValidato are as follows:DateValidator.minimum='${input}' is less than the minimum of ${minimum}.DateValidator.maximum='${input}' is larger than the maximum of ${maximum}.However the finnish ones instruct that the value must be one-off its minimum or maximum. This is definitely confuses the user/developer.Here is the proposed translation:DateValidator.maximum='${input}' ei voi olla suurempi kuin ${maximum}.DateValidator.minimum='${input}' ei voi olla pienempi kuin ${minimum}.Instead of (Application_fi.properties):DateValidator.minimum='${input}' tulee olla j/u00E4lkeen ${minimum}.DateValidator.maximum='${input}' tulee olla ennen ${maximum}.,0,0
Bookmarkable / Stateless form submit bug,A stateless bookmarkable form submission isn't working correctly for submissions after reboot or session expiration. This may be due to the use of MixedParamUrlCodingStrategy: believe I've tracked down the problem to this code in BookmarkablePageRequestTargetUrlCodingStrategy:  // do some extra work for checking whether this is a normal request to a  // bookmarkable page  or a request to a stateless page (in which case a  // wicket:interface parameter should be available  final String interfaceParameter = (String)parameters  .remove(WebRequestCodingStrategy.INTERFACE_PARAMETER_NAME);  if (interfaceParameter != null)  { WebRequestCodingStrategy.addInterfaceParameters(interfaceParameter  requestParameters); return new BookmarkableListenerInterfaceRequestTarget(pageMapName  (Class)bookmarkablePageClassRef.get()  parameters  requestParameters .getComponentPath()  requestParameters.getInterfaceName()  requestParameters.getVersionNumber()); } The issue is that the 'parameters' will never contain the INTERFACE_PARAMETER_NAME because it would have been removed in WebRequestCodingStrategy:decode:215 which as far as I can tell is always called first (from RequestCycle.step.RESOLVE_TARGET:1233). The 'requestParameters' should already have the interface parameters  so it isn't clear why the addInterfaceParameters() logic is being called again (it is already called in WebRequestCodingStrategy:decode:200). I've got a patch forthcoming.,0,0
Syntactic errors in the manifest OSGi headers,Hello  Not exactly sure about the error location  but upon deployment on a OSGi container (SpringSource Application Context  based on Equinox)  I get the following trace:&#91;2008-05-19 19:39:26.041&#93; fs-watcher &lt;SPOP0004W&gt; The bundle '/home/djo/Java/servers/springsource-ap-1.0.0.beta3/repository/bundles/usr/wicket-datetime-1.4-m2.jar' could not be provisioned is its manifest is malformed. The error encountered whilst parsing the manifest was: The manifest identified by Name 'Wicket Date/Time'  Symbolic Name 'org.apache.wicket.wicket-datetime'  and Version '1.4.0.m2' has the following errors [org.antlr.runtime.NoViableAltException on 'Package Header &#91;Import&#93;' at Char: 768 org.antlr.runtime.NoViableAltException on 'Package Header &#91;Export&#93;' at Char: 101],0,0
AbstractRequestTargetUrlCodingStrategy(line 174) throws confusing exception. It would be better redirect to 404-page in this case.,Steps to reproduce: When user manually types incorrect URL  this confusing exception will be thrown.SEVERE: Internal error for /eshop/profile/pjava.lang.IllegalStateException: URL fragment has unmatched key/value pair: p at org.apache.wicket.request.target.coding.AbstractRequestTargetUrlCodingStrategy.decodeParameters(AbstractRequestTargetUrlCodingStrategy.java:174) at org.apache.wicket.request.target.coding.BookmarkablePageRequestTargetUrlCodingStrategy.decode(BookmarkablePageRequestTargetUrlCodingStrategy.java:76) at org.apache.wicket.protocol.http.request.WebRequestCodingStrategy.targetForRequest(WebRequestCodingStrategy.java:476) at org.apache.wicket.protocol.http.WebRequestCycleProcessor.resolve(WebRequestCycleProcessor.java:175),0,0
Memory leak in Localizer,I noticed recently (and told on IRC) a problem with the Localizer and the way the getCacheKey() method works.I uses the component id of all component in the path to the component to create the key. But each page generation has a different id. This has been fixed recently by breaking outside of the loop which creates the key if the component's parent is a Page instance. This partially solves the always increasing cache. But it still has some issues: with the page completely outside of the path  it could introduce some rare bugs when searching for keys defined in the page properties file (it shouldn't break but skip the 'buffer.append(':').append(cursor.getId())' when the cursor is on a Page instance). there is still a bunch of ids generated when you loop over a repeater (the component of type Item has a new id for every item in the list). this is mitigated by the fact that when doing a normal refresh of the view  the starting id restarts at 1  but if you have an Ajax paging view  it's not restarted and starts again to fill the cache with unwanted keys.there are multiple options: never include the id in the key (I'm not convinced it is necessary; is it really used in the String loader?) don't include the id in the key if the cursor is on a component of type Page or Item don't include the id if it's numeric (is this costly?)In the meantime  I'll make a small fix in my local checkout of Wicket  not including the id if the cursor is on Page or Item,0,1
TimeFrame.equals(Object)  does not work as expected,the equals() method should be implemented for the TimeFrame class,0,0
Memory leak in DiskPageStore,No entries are removed from DiskPageStore.sessionIdToEntryMap. I guess  this should be added to the DiskPageStore.unbind(String sessionId) method: public void unbind(String sessionId) { // FIX: replace get() with remove() SessionEntry entry = (SessionEntry)sessionIdToEntryMap.get(sessionId); if (entry != null) { if (isSynchronous()) { entry.unbind(); } else { List pages = getPagesToSaveList(sessionId); synchronized (pages) { flushPagesToSaveList(sessionId  pages); entry.unbind(); } pagesToSaveAll.remove(sessionId); } } },0,1
HtmlHandler can't handle tags not requiring closed tags if the tag names are uppercase,In HtmlHandler.java  the requiresCloseTag() method only looks the tag name in the Map  without considering the char case: public static boolean requiresCloseTag(final String name) { return doesNotRequireCloseTag.get(name) == null; }Because the keys are all lower case: static { // Tags which are allowed not be closed in HTML doesNotRequireCloseTag.put('p'  Boolean.TRUE); doesNotRequireCloseTag.put('br'  Boolean.TRUE); doesNotRequireCloseTag.put('img'  Boolean.TRUE); doesNotRequireCloseTag.put('input'  Boolean.TRUE); doesNotRequireCloseTag.put('hr'  Boolean.TRUE); doesNotRequireCloseTag.put('link'  Boolean.TRUE); doesNotRequireCloseTag.put('meta'  Boolean.TRUE); }it will fail if uppercase tag names are used in the markup.I've verified that it dies with the following simple markup:&lt;html&gt;&lt;body&gt;&lt;BR&gt;&lt;/body&gt;&lt;/html&gt;,0,0
FileUploadField should return FileUpload as its converted input,FileUploadField should return FileUpload as its converted input so the file can be validated.Eg @Overrideprotected void convertInput() { setConvertedInput(getFileUpload());}Apparently MultiFileUploadField handles this (I've checked  it appears to be in the convertValue method).For more context see http://www.nabble.com/Best-way-of-validating-FileUploadField-td17662018.html,0,1
wicket complains that ValueMap$NullSafeKeyComparator is not serializable,wicket complains that ValueMap$NullSafeKeyComparator is not serializable:2070 ERROR &#91;btpool0-19&#93; org.apache.wicket.util.lang.Objects - Error serializing object class testapp.pages.ContactPage [object=&#91;Page class = testapp.pages.ContactPage  id = 0  version = 0&#93;]org.apache.wicket.util.io.SerializableChecker$WicketNotSerializableException: Unable to serialize class: org.apache.wicket.util.value.ValueMap$NullSafeKeyComparatorField hierarchy is: 0 &#91;class=testapp.pages.ContactPage  path=0&#93; java.lang.Object org.apache.wicket.Component.data [class=&#91;Lorg.apache.wicket.MetaDataEntry;&#93; java.lang.Object org.apache.wicket.Component.data&#91;0&#93; &#91;class=org.apache.wicket.MetaDataEntry&#93; java.lang.Object org.apache.wicket.MetaDataEntry.object &#91;class=org.apache.wicket.PageParameters&#93; private java.util.Comparator java.util.TreeMap.comparator &#91;class=org.apache.wicket.util.value.ValueMap$NullSafeKeyComparator&#93; &lt;----- field that is not serializable at org.apache.wicket.util.io.SerializableChecker.check(SerializableChecker.java:349) at org.apache.wicket.util.io.SerializableChecker.checkFields(SerializableChecker.java:618) at org.apache.wicket.util.io.SerializableChecker.check(SerializableChecker.java:541) at org.apache.wicket.util.io.SerializableChecker.checkFields(SerializableChecker.java:618) at org.apache.wicket.util.io.SerializableChecker.check(SerializableChecker.java:541) at org.apache.wicket.util.io.SerializableChecker.check(SerializableChecker.java:395) at org.apache.wicket.util.io.SerializableChecker.checkFields(SerializableChecker.java:618) at org.apache.wicket.util.io.SerializableChecker.check(SerializableChecker.java:541) at org.apache.wicket.util.io.SerializableChecker.writeObjectOverride(SerializableChecker.java:687) at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:298) at org.apache.wicket.util.io.IObjectStreamFactory$DefaultObjectStreamFactory$2.writeObjectOverride(IObjectStreamFactory.java:127) at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:298) at org.apache.wicket.util.lang.Objects.objectToByteArray(Objects.java:1100) at org.apache.wicket.protocol.http.pagestore.AbstractPageStore.serializePage(AbstractPageStore.java:200) at org.apache.wicket.protocol.http.pagestore.DiskPageStore.storePage(DiskPageStore.java:814) at org.apache.wicket.protocol.http.SecondLevelCacheSessionStore$SecondLevelCachePageMap.put(SecondLevelCacheSessionStore.java:327) at org.apache.wicket.Session.requestDetached(Session.java:1391) at org.apache.wicket.RequestCycle.detach(RequestCycle.java:1113) at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1384) at org.apache.wicket.RequestCycle.request(RequestCycle.java:499) at org.apache.wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:387) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:199) at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1084) at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:360) at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181) at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:726) at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152) at org.mortbay.jetty.Server.handle(Server.java:324) at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:505) at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:828) at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:514) at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:211) at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:380) at org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:395) at org.mortbay.thread.BoundedThreadPool$PoolThread.run(BoundedThreadPool.java:450)Caused by: java.io.NotSerializableException: org.apache.wicket.util.value.ValueMap$NullSafeKeyComparator at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1081) at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1375) at java.io.ObjectOutputStream.defaultWriteObject(ObjectOutputStream.java:391) at java.util.TreeMap.writeObject(TreeMap.java:1466) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:585) at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:917) at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1339) at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1290) at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1079) at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1375) at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1347) at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1290) at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1079) at java.io.ObjectOutputStream.writeArray(ObjectOutputStream.java:1251) at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1075) at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1375) at java.io.ObjectOutputStream.defaultWriteObject(ObjectOutputStream.java:391) at org.apache.wicket.protocol.http.pagestore.AbstractPageStore$PageSerializer.serializePage(AbstractPageStore.java:319) at org.apache.wicket.Page.writePageObject(Page.java:1335) at org.apache.wicket.Component.writeObject(Component.java:4303) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:585) at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:917) at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1339) at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1290) at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1079) at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:302) at org.apache.wicket.util.io.IObjectStreamFactory$DefaultObjectStreamFactory$2.writeObjectOverride(IObjectStreamFactory.java:119) ... 24 more,0,0
Make functionality of ContextImage a behavior so that other types of components can utilize its functionality,It would be better if ContextImage was a behavior rather than an actual component. For instance  if you have an html input of type=image (or a link for that matter) you can still utilize the behavior whereas a component you cannot.,0,0
GuiceComponentInjector mishandles static fields,GuiceComponentInjector mistakenly wraps static fields with serializable proxies. These CGLIB proxies impose limitations (must have default constructor  may not have final methods  etc) on fields which are not strictly necessary. The new implementation allows the use of Binder.requestStaticInjection() which is more flexible.,0,0
org.apache.wicket.util.lang.Objects.convertValue returns null if it cannot convert the value,In the javadoc comment of the method it says that this method should return the value given as parameter if the value cannot be converted to the given type  but actually it returns null if it cannot convert the value. I had a problem with a TextField which had a model value of type java.io.Serializable and I had unfortunately not defined a special converter for the text field so it used org.apache.wicket.util.convert.ConverterLocator.DefaultConverter.convertToObject to convert to the object type. convertToObject uses Objects.convertValue so whenever model object was updated it was set to null. When retrieved from the model  model object was properly shown in the TextField so I had no idea why the value could not be properly setted but only getted.In many cases it would probably help if the Objects.convertValue did what it promises in javadoc (returns the value unconverted)  but how about throwing exception (at some method) if the converter does not know how to convert some kind of objects? This would make it a lot easier to spot the kind of mistakes I had made.,0,0
Allow configuration of the guice Stage for GuiceWebApplicationFactory,I would like to be able to use a init parameter to configure what Stage guice will use simillar to the way that WebApplication get it's configuration type from the wicket.configuration parameter. The parameter name could be wicket-guice.stage to keep with the pattern used by wicket core.,0,0
Improve Locale fallback in BundleStringResourceLoader,While https://issues.apache.org/jira/browse/WICKET-1415 fixed the NPE in BundleStringResourceLoader Locale.getDefault() is a bad choice to get the locale from  as it is determined by the default locale of the jvmrunning the servlet container. I think it's a big coincidence if the jvm default locale is actually the one the user wantsto see in the webapp - Session#getLocale() would probably be a better default.Attached is a patch against current trunk (1.4),0,0
PackagedTextTemplate does not load resource from application resource stream locator,Here is my post to the dev list...file a jira issue-igorOn Wed  Jun 25  2008 at 11:23 AM  Ritz123 &lt;ritesh.trivedi@...&gt; wrote:&gt;&gt; I did some investigation and seems like there is a bug.&gt;&gt; PackagedTextTemplate @line:92 is creating a new ResourceStreamLocator()&gt; instead of using the one from the application. This is causing resources to&gt; be not found if you have custom resource stream loader registered with the&gt; application.&gt;&gt; line 92: private static final IResourceStreamLocator streamLocator = new&gt; ResourceStreamLocator();&gt;&gt; Can Wicket dev confirm?&gt;&gt;&gt; Ritz123 wrote:&gt;&gt;&gt;&gt; Hi &gt;&gt;&gt;&gt; I am trying to use PackagedTextTemplate to load the template  but seems&gt;&gt; like its not looking for the resource in the application registered&gt;&gt; resource stream locator. I get resource not found exception.&gt;&gt;&gt;&gt; HeaderContributor.forCss and forJavascript has worked fine and has found&gt;&gt; resource in the folders for application stream location without any&gt;&gt; issues.&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &#8211;&gt; View this message in context: http://www.nabble.com/Re%3A-PackagedTextTemplate-does-not-load-resource-from-application-resource-stream-locator----BUG---tp18116540p18116540.html&gt; Sent from the Wicket - Dev mailing list archive at Nabble.com.&gt;,0,0
StringResourceModel may fail to format numbers using MessageFormat,StringResourceModel API seems to suggest it's possible to use it without a Component reference using the following approach:m = new StringResourceModel('key'  null  new Model(...)  new Object[] {p1  p2  ...});m.setLocalizer(xxxApplication.get().getResourceSettings().getLocalizer());return m.toString()Unfortunately the above will fail with an exception if the message uses the MessageFormat approach and one of the parametersis a number  since the locale field in StringResourceModel won't be initialized  and will then be passed as null to new MessageFormat(value  locale) at line 514 of StringResourceFormat.I'm using the following crude workaround:StringResourceModel rm = new StringResourceModel(key  null  model  params) { @Override public void setLocalizer(Localizer localizer) { super.setLocalizer(localizer); // crude hack to force into the StringResoruceLoader to grab a locale  // which is needed to format numbers with the MessageFormat approach load(); } }; rm.setLocalizer(GeoServerApplication.get().getResourceSettings().getLocalizer()); return rm.getString();but boy  this looks ugly... Creating a custom subclass that does locale loading in theconstructor would look better  but still quite ugly...,0,0
RfcCompliantEmailAddressValidator accepts whitespace and tab,The RfcCompliantEmailAddressValidator in the org.apache.wicket.extensions.validation.validator package accepts whitespace and tab characters as it uses the regex provided on http://www.ex-parrot.com/~pdw/Mail-RFC822-Address.html which '..will only validate addresses that have had any comments stripped and replaced with whitespace'.,0,0
Inconsisting Handling of id mismatch on wicket:container,Given this simple case:public class Home extends WebPage { public Home() { add(new EmptyPanel('test')); }}and the following HTML page:&lt;span wicket:id='test2'/&gt;Please notice that the ids do not match.Executing this app will give the following Exception:WicketMessage: Unable to find component with id 'test2' in [Page class =com.myapp.wicket.Home  id = 0  version = 0]. This means that you declaredwicket:id=test2 in your markup  but that you either did not add thecomponent to your page at all  or that the hierarchy does not match.Whereas when using a wicket:container instead of a HTML tag  like this:&lt;wicket:container wicket:id='test2'/&gt;And when the ids doesn't match  Wicket throws the following exception:WicketMessage: Failed to handle: &lt;wicket:container wicket:id='test2'/&gt;Which is quite cryptic at the first glance.Original: http://mail-archives.apache.org/mod_mbox/wicket-dev/200803.mbox/%3c15908468.post@talk.nabble.com%3eWe ran across same problem too.,0,0
form action URLs in non-Wicket forms not rewritten,Wicket's RelativePathPrefixHandler rewrites 'href'  'src'  and 'background'URLs in non-Wicket markup but does not rewrite 'action' URLs in forms.There are workarounds but it would be cleaner if Wicket handled this caseby default.Discussion at:http://www.nabble.com/RelativePathPrefixHandler-and-form-'action'-attributes-tt18537680.htmlhttp://www.nabble.com/RelativePathPrefixHandler-and-form-'action'-attributes-tt18536692.html,0,0
In html Include component isAbsolute method returns false for an absolute path in unix-like systems,In isAbsolute method  if colon position is -1 then this url MAY STILL be an absolute url. In unix systems there may not be colon in absolute paths. For example: /home/someuser.somefile.htmlSo  in order to fix this  a leading / (slash) may be checked to exist like:int colonPos = url.indexOf(':');int slashPos = url.indexOf('/');if (colonPos == -1 &amp;&amp; slashPos == -1) {return false; //Relative} else if (colonPos == -1 &amp;&amp; slashPos == 0) {return true; //Absolute}//Original Code//org.apache.wicket.markup.html.include.Include.javaprotected final boolean isAbsolute(String url) { if (url == null) { return false; } // do a fast  simple check first int colonPos; if ((colonPos = url.indexOf(':')) == -1) { return false; /*PROBLEM IS HERE*/ }...,0,0
Generify PropertyColumn,PropertyColumn overrides populateItem incorrectly. PropertyColumn has:public void populateItem(Item item  String componentId  IModel model)whereas ICellPopulator has: void populateItem(final Item&lt;ICellPopulator&lt;T&gt;&gt; cellItem  final String componentId  final IModel&lt;T&gt; rowModel);This makes it hard to extend PropertyColumn.,0,0
Overflow when setting Expires header in WebResource,problematic code:response.setDateHeader('Expires'  System.currentTimeMillis() + (getCacheDuration() * 1000));getCacheDuration() * 1000 is an integer operation causing an overflow if getCacheDuration() is set to be &gt; MAX_INT/1000 seconds (approx. 25 days) which is by far less than the w3c recommendation for 'never expires': 'To mark a response as 'never expires ' an origin server sends an Expires date approximately one year from the time the response is sent. HTTP/1.1 servers SHOULD NOT send Expires dates more than one year in the future.'http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.21changing getCacheDuration() to return long or forcing a long operation fixes the problem:response.setDateHeader('Expires'  System.currentTimeMillis() + getCacheDuration() * 1000L);,0,1
NPE in feedback panel,WicketMessage: Error attaching this container for rendering: [MarkupContainer &#91;Component id = feedbackul  page = nl.topicus.tripleapoc.web.pages.deelnemer.intake.IntakeStap1Personalia  path = 11:layLeft:feedback:feedbackul.FeedbackPanel$2  isVisible = true  isVersioned = false&#93;]Root cause:java.lang.NullPointerException at org.apache.wicket.markup.html.panel.FeedbackPanel.newMessageDisplayComponent(FeedbackPanel.java:324) at org.apache.wicket.markup.html.panel.FeedbackPanel$MessageListView.populateItem(FeedbackPanel.java:88) at org.apache.wicket.markup.html.list.ListView.onPopulate(ListView.java:573) at org.apache.wicket.markup.repeater.AbstractRepeater.onBeforeRender(AbstractRepeater.java:127) at org.apache.wicket.Component.internalBeforeRender(Component.java:1003) at org.apache.wicket.Component.beforeRender(Component.java:1035) at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1589) at org.apache.wicket.Component.onBeforeRender(Component.java:3684) at org.apache.wicket.Component.internalBeforeRender(Component.java:1003) at org.apache.wicket.Component.beforeRender(Component.java:1035) at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1589) at org.apache.wicket.Component.onBeforeRender(Component.java:3684) at org.apache.wicket.Component.internalBeforeRender(Component.java:1003) at org.apache.wicket.Component.prepareForRender(Component.java:2168) at org.apache.wicket.ajax.AjaxRequestTarget.respondComponent(AjaxRequestTarget.java:747) at org.apache.wicket.ajax.AjaxRequestTarget.respondComponents(AjaxRequestTarget.java:649) at org.apache.wicket.ajax.AjaxRequestTarget.respond(AjaxRequestTarget.java:564) at org.apache.wicket.request.AbstractRequestCycleProcessor.respond(AbstractRequestCycleProcessor.java:104) at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1177) at org.apache.wicket.RequestCycle.step(RequestCycle.java:1248) at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1349) at org.apache.wicket.RequestCycle.request(RequestCycle.java:493) at org.apache.wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:387) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:199),0,0
'Invalid procedure call or argument' on AJAX call with IE7,I have a Button that shows a JS alert and then executes an AJAX call.It works fine under Firefox 2  but fails under IE7.. The alert appears  I click 'ok' and then I get the 'Initiating Ajax GET request...' inside 'WICKET AJAX DEBUG'  but it doesn't reach my serverside handler.After clicking 'ok'  in the bottom-left corner of the window appears a javascript error: 'Invalid procedure call or argument'  line 849  code 0.Original discussion: http://www.nabble.com/Button-with-confirmation-with-IE7-td18944137.htmlI'll add a quickstart and a patch in a moment.,0,0
WicketTester.clickLink and IndexedParamUrlCodingStrategy don't work together,IndexedParamUrlCodingStrategy.appendParameters expects String-&gt;String map:.... while (parameters.containsKey(String.valueOf)) { String value = (String)parameters.get(String.valueOf);...but BaseWicketTester.clickLink converts page params to String-&gt;String[] map:.... PageParameters parameters = (PageParameters)getParametersMethod.invoke( bookmarkablePageLink  (Object[])null); setParametersForNextRequest(parameters.toRequestParameters());...And as result we have type cast exception.,0,0
JavascriptStripper ignores context when looking for multiline comments,org.apache.wicket.util.string.JavascriptStripper#stripCommentsAndWhitespace doesn't check the context when looking for multiline comments. In my case  it interprets the default accept header in the jQuery source code as a multiline comment:accepts: { xml: 'application/xml  text/xml'  html: 'text/html'  script: 'text/javascript  application/javascript'  json: 'application/json  text/javascript'  text: 'text/plain'  _default: '/'}The culprit being this string: '/'I don't have a patch and I wouldn't try to write my own JS parser. Maybe replacing the current implementation with a Rhino-based one is an option. Its available via Maven:&lt;dependency&gt; &lt;groupId&gt;rhino&lt;/groupId&gt; &lt;artifactId&gt;js&lt;/artifactId&gt; &lt;version&gt;1.7R1&lt;/version&gt;&lt;/dependency&gt;,0,0
Wicket 1.3.4 violates servlet standard  Glassfish spews warnings,WicketFilter.java line 194 invokes getLastModified() which invokes 'request.getParameterMap()' on line 962. Later on in that same request  WicketFilter.java line 222 invokes doGet() which invokes response.setCharacterEncoding() on line 376.This is just one case where this problem occurs but I believe others might exist. Whenever Wicket violates the standard Glassfish spews out this warning:PWC4011: Unable to set request character encoding to UTF-8 from context &lt;context-path&gt;  because request parameters have already been read  or ServletRequest.getReader() has already been called... you literally end up with tens of these warnings per request  and supposedly  the wrong behavior  Glassfish's FAQ discusses this in more detail: http://wiki.glassfish.java.net/Wiki.jsp?page=FaqWebAppUnableToSetRequestCharEncoding,0,0
WicketRuntimeException when using wicket-auth-roles in a frameset,Hi All I seem to have a very strange exception when using wicket-auth-roles in a frameset.Let me try and sketch out the setup:1) Application home page is called FramesetPage.java &#8211; it extends org.apache.wicket.markup.html.WebPage &#8211; corresponding HTML contains simple frameset with 2 rows2) Top row of frameset contains TopFramePage.java &#8211; it extends org.apache.wicket.markup.html.WebPage &#8211; corresponding HTML contains only an image component as follows: &#8211; add(new Image('bannerImage'  'logo.png'));3) Bottom row of frameset contains BottomFramePage.java &#8211; it extends org.apache.wicket.markup.html.WebPage &#8211; it requires authentication/authorization using wicket-auth-roles (as is  straight out of the jar) &#8211; if not already authenticated/authorized then redirected to MySignInPage.java &#8211; it extends org.apache.wicket.authentication.pages.SignInPage &#8211; corresponding HTML contains standard &lt;span wicket:id='signInPanel'/&gt; tagHere's the strange part: After completing the 'Username' and 'Password' fields of thesignInPanel then the exception displayed in the attached stack trace is thrown. Further  if I replace the imagecomponent in TopFramePage with some CSS that loads the same image then no exception is thrown.Any thoughts on what is causing this problem?Thanks Steve,0,0
Using an AjaxSubmitLink outside of a Form does not set the form property,When constructing an AjaxSubmitLink outside of a form using the constructor:public AjaxSubmitLink(String id  final Form form)The form argument is not set in the link. This prevents the form from seeing the link as its submitting component  which in turn means that using thing like enableDefaultFormProcessing() on the link don't work.Changing the constructor of AjaxSubmitLink to:public AjaxSubmitLink(String id  final Form form){ super(id  form) /* was: super(id) */ ...}will probably fix the problem.A temporary workaround is to implement a getForm() method in the subclass of the submit link which answers the form of the link,0,0
AbstractTree XHTML Strict validation,&#91;Notice: Adapted from http://markmail.org/message/afuxccwazkzwc7bz &#93;I have a rootless BaseTree and see it output &lt;table style='display:none' id='tree1f_0'&gt;&lt;/table&gt;&lt;table class='wicket-tree-content' id='tree1f_1'&gt;&lt;tr&gt;...which according to http://validator.w3.org is invalid strict XHTML. Looking at thecomment in the code  AbstractTree.onRender()  // is this root and tree is in rootless mode? if (this == rootItem &amp;&amp; isRootLess() == true) { // yes  write empty div with id // this is necessary for createElement js to work correctly String tagName = ((ComponentTag)markupStream.get()).getName(); getResponse().write( '&lt;' + tagName + ' style=/'display:none/' id=/'' + getMarkupId() + '/'&gt;&lt;/' + tagName + '&gt;'); markupStream.skipComponent(); }it appears from the comment that the indention was to output a div and not a table. Witha div  we would get valid markup: &lt;div style='display:none' id='tree1f_0'&gt;&lt;/div&gt;&lt;table class='wicket-tree-content' id='tree1f_1'&gt;&lt;tr&gt;...Is there a particular reason to fetch the tagName from the markupStream instead of just hardcodingit to 'div'?Thanks Kaspar,0,0
Unfound markup information is not entirely cached even in deployment mode,Unfound markup information is not entirely cached even in deployment mode  which causes performance problems. The problem has a very broad effect  because checking for non-existent localised versions of markup causes a lot of cases of unfound markup. This showed up first in our load tests  and was later confirmed by profiling.If you don't have the localised version of your markup to your current locale  this markup is looked for but never found. This bug causes the lookup to repeat on every request when the component is repainted  which becomes a major problem in a case with a lot of ajax repaints.You can reproduce the problem with Wicket 1.3.3 easily  for example by putting the log4j.logger.org.apache.wicket.markup.MarkupCache=DEBUG setting in log4j.properties and running Wicket examples in deployment mode. I added several items to the Ajax todo list and this appeared in console repeatedlyDEBUG - MarkupCache - Load markup: cacheKey=org.apache.wicket.examples.ajax.builtin.TodoList$AddItemsContaineren_UShtmlDEBUG - MarkupCache - Markup not found: org.apache.wicket.examples.ajax.builtin.TodoList$AddItemsContaineren_UShtmlThis is caused by the bug that in MarkupCache  the unfound markup information is stored only in markupCache and not in markupKeyCache. I fixed this in the naﾃｯve way but we should really refactor the cache handling so that it does not rely on the same calls being duplicated to markupCache and markupKeyCache .,0,1
DateTimeField: small bugs,Hello  I found 2 different bugs that makes my applications react in the wrong way : onBeforeRender:378When the modelobject-date is null  the hours and minutes are not set to null to. Now only date is set to null. I use this object with ajax  and when the DateTimeField loads with a new modelobject  the hours- and minutesfield holds the old value. If not clear  I can make a quickstart. setDate:231This function adjusts the modelobject with the filled in date. But the hours and minutes aren't add.I have overridden the function so it would work correctly. My code:public void setDate(Date date) Unknown macro: { super.setDate(date); System.out.println(&quot;setDate [&quot; + date + &quot;]&quot;); MutableDateTime modelDate = new MutableDateTime(date); Integer hours = getHours(); Integer minutes = getMinutes(); boolean use12HourFormat = use12HourFormat(); if (hours != null) { modelDate.set(DateTimeFieldType.hourOfDay()  hours.intValue() % (use12HourFormat ? 12 : 24)); modelDate.setMinuteOfHour((minutes != null) ? minutes.intValue() : 0); } setDefaultModelObject(modelDate.toDate()); } Thanks a lot ! Marieke.,0,0
i18n package resource resolving depends too much on available locale,Instead of just depending on the session's locale  our i18n resolving algorithm should look at the form of the file names as well. For instance  if we get a request for /web/resources/foo.Bar/test_en_US.css  it should recognize that test is the base form  and try en and en_US on top of that  regardless of the locale that is was set in the session.,0,0
org.apache.wicket.util.string.Strings#stripJSessionId StringIndexOutOfBoundsException,input:http://abc.com/xx/yy.html?code=a%E2%8C%A9=en&amp;amp;section=DDD&amp;amp;d=173amp;passing the about input to methodorg.apache.wicket.util.string.Strings#stripJSessionIdwill introduce StringIndexOutOfBoundsExceptionbecause '?' appears before ';',0,0
WicketTester Cookie handling,While trying to test my SecureForm implementation (https://issues.apache.org/jira/browse/WICKET-1885) with WicketTester I ran into this issue: A cookie set in the response never shows up in the 'next' request  because both have their own lists of cookies that aren't shared.Afaik both should share the same List instance to handle cookies. That way its possible to set a cookie in the response and read it from the request.A simple testcase is attached.,0,0
FormComponents (and subclasses) should be able to provide their own resource bundles,In order to fully support the idea to break down a large application into small reusable components it seems necessary that FormComponents provide their own resource bundles. We have a project that uses a customized subclass of Checkbox that needs to provide customized error messages. The ideal place for those error messages would be a resource bundle living next to the Checkbox subclass but this is not yet supported. Unfortunately the JavaDoc for ComponentStringResourceLoader indicates (see example: input1.properties =&gt; Required) that support for this already exists.A small change to FormComponent$MessageSource.getMessage(String key) could add support for this. Instead of using the formComponent.getParent() as the base for searching the resource string  simply use the formComponent itself.,0,0
AjaxFallbackButton: inconsistent submit order,I just stumbled upon a problem with a Form containing a nested Form and two AjaxFallbackButtons (submit and preview). I need to implement different onSubmit() behavior of the nested Form depending on the clicked button.The order of onSubmit() calls is:without JS: AjaxFallbackButton.onSubmit(AjaxRequestTarget Form) OuterForm.onSubmit() // not used Inner Form.onSubmit()with JS: Inner Form.onSubmit() OuterForm.onSubmit() // not used AjaxFallbackButton.onSubmit(AjaxRequestTarget Form)With JS  it is therefore not possible to determine which button was clicked from inside a form's onSubmit() method. see also http://www.nabble.com/AjaxFallbackButton%3A-inconsistend-submit-order-td20131329.html,0,0
StatelessForm submitted to the wrong page,I made a small application to reproduce the problem. You can download it from http://aditsu.net/wickettest.zip   I'll try to attach it too.Dependencies: jetty 6  wicket 1.4-m3  slf4j  log4jSteps to reproduce:1. Run the test.Start class2. Open http://localhost:8080 in a browser3. Open http://localhost:8080/page2 in a new tab4. Go to the first tab and click submitResult:WicketRuntimeException: unable to find component with path form on stateless page &#91;Page class = test.Page2  id = 0  version = 0&#93;It looks like the 2 pages are created with the same id in 2 different pagemaps  but when I submit the form  it goes to the second pagemap and finds the second page (with no form on it).,0,0
WebRequestCycleProcessor.resolveHomePageTarget for empty path with enforceMounts=true provokes 403 - 'Direct access not allowed for mounted targets',Scenario: WebApplication.getHomePage() returns a page that is also mounted to a non-empty path by WebApplication.mountBookmarkablePage(). Besides  we have getSecuritySettings().setEnforceMounts(true). Upon a request for the servlet's root URL (i.e.  with requestParameters.getPath()=='')  the methodWebRequestCycleProcessor.resolve will throw a AbortWithWebErrorCodeException(403) with error message 'Direct access not allowed for mounted targets'.This is because WebRequestCycleProcessor.resolveHomePageTarget correctly returns a non-null target  so that the else-branch starting in line 190 of file WebRequestCycleProcessor.java is reached. The comment says 'a target was found  but not by looking up a mount'  which is misleading  because the szenario should desirably work even though property enforceMounts has been set to true.The only (terrible) workaound I have found is to override WebRequestCycleProcessor.resolveHomePageTarget() to return null and establish a home-page-like thing by overriding WebRequestCodingStrategy.urlCodingStrategyForPath() for the empty path.,0,0
RadioChoice disable certain choice bug,I want to disable certain values of a dropdown choice.But the isDisabled is never called only the isEnabled and i don't know the choice in here.,0,0
CheckBox incorrectly converts its model value when a custom Boolean converter is installed - again,Hi I tried the last version of wicket (built from trunk svn) and there is one old bug again:see https://issues.apache.org/jira/browse/WICKET-330There was removed the default Boolean converter ... and the bug is again active.Thx for fixing H.,0,0
wicket:message sometimes broken,The behavior described here: http://cwiki.apache.org/WICKET/wickets-xhtml-tags.html (use wicket:message as attribute) sometimes doesn't work  depending on the hierarchy and the tag where it applies.I've reproduced it using a repeater and applying wicket:message it to a &lt;td&gt; tag.Instead of correctly modifying the attribute  it throws the usual MarkupException 'WicketMessage: Unable to find component with id 'label' in [MarkupContainer',0,0
MarkupContainer.setEnabled() doesn't enable/disable child components,1. Create any components that is derived from MarkupContainer  for example  create Panel. 2. Put some components to the Panel  for example  TextInput  Label etc.3. Call panel.setEnabled(false) Result: all controls on panel are still enabled.Notes: after some investigation I found that MarkupContainer doesn't override setEnabled and therefore it cannot enable/disable components stored in the container. Workaround: manually disable all components that are displayed on the panel  for example:public void setEnabledForChildren(boolean enabled) { setEnabledRecursive(this  enabled); } private void setEnabledRecursive(MarkupContainer container  boolean enabled) { Iterator&lt;? extends Component&gt; iterator = container.iterator(); while (iterator.hasNext()) { Component component = iterator.next(); component.setEnabled(enabled); if (component instanceof MarkupContainer) { setEnabledRecursive((MarkupContainer) component  enabled); } } }I think that MarkupContainer must be responsible for disabling/enabling child components.,0,0
FileUpload.writeToTempFile uses field Id as filename - Windows doesn't support some characters,The component FileUpload tries to create a temporary file using the multipart fieldname's id.That id has invalid characters - not supported on Windows environments  for example.,0,0
Add getter and setter for data provider to  AjaxFallbackDefaultDataTable,Adding at least getter (and a setter too) for data provider would allow for a lot better handling of customized data providers. For example if data provider's results are dependant on external values like  say  boolean stating if table should contain only rows with some specific statistic ('show only items which are on sale' or anything like that) I'd rather do ((ShopDataProvider)table.getDataProvider()).setShowOnlyItemsOnSale(true); instead of recreating the object and replacing it on the page by doing something like get('table').replace(new AjaxFallbackDefaultDataTable('table'  columns  new ShopDataProvider(true)));,0,0
Please make RequestLogger.log(RequestData  SessionData) protected,Could we please make the method above protected (rather than private). This makes it very simple to do something like this: @Override protected IRequestLogger newRequestLogger() { return new RequestLogger() { @Override protected void log(RequestData rd  SessionData sd) { // do my custom logging HERE } }; }ALSO - it would be real nice if at the same time you extract that creation of the AppendingStringBuffer to a method  so that the log method now looks like:protected void log(RequestData rd  SessionData sd){ if (log.isInfoEnabled()) { log.info(createStringBuffer(rd  sd  true); }}protected final void createStringBuffer(RequestData rd  SessionData sd  boolean includeRuntimeInfo) { ... all of the stuff that was taken out of log that creates the ASB if (includeRuntimeInfo) { Runtime runtime = Runtime.getRuntime(); long max = runtime.maxMemory() / 1000000; long total = runtime.totalMemory() / 1000000; long used = total - runtime.freeMemory() / 1000000; asb.append(' maxmem='); asb.append(max); asb.append('M total='); asb.append(total); asb.append('M used='); asb.append(used); asb.append('M'); } return asb;},0,0
rc1 generics - LabelTree,LabelTree.getNodeTextModel requires IModel&lt;Object&gt; and returns IModel&lt;Object&gt;. I was overriding it and returning a Model&lt;String&gt;  but I can't do that anymore. Why not just return IModel&lt;?&gt; ?,0,0
Component.isVisibilityAllowed() not consulted before calling onBeforeRender(),I have a component whose parent does this:class Parent extends Panelprivate Component child;onBeforeRender(){child.setVisibilityAllowed(false);super.onBeforeRender();}I would expect child's onBeforeRender() to not be executed but it is  because Component.internalBeforeRender calls isVisible() rather than determineVisibility().Shouldn't the following line in Component.internalBeforeRender(): if ((isVisible() || callOnBeforeRenderIfNotVisible()) &amp;&amp; !getFlag(FLAG_RENDERING) &amp;&amp; !getFlag(FLAG_PREPARED_FOR_RENDER))be this: if ((determineVisibility() || callOnBeforeRenderIfNotVisible()) &amp;&amp; !getFlag(FLAG_RENDERING) &amp;&amp; !getFlag(FLAG_PREPARED_FOR_RENDER)),0,0
AutoCompleteTextField - gives a type mismatch error on IE - version wicket-1.4-rc1,wicket-autocomplete.jsfunction function showAutoComplete()line 291 container.style.zIndex=(!isNaN(Number(index))?Number(index)+1:index);looks like IE doesn't like big i in zIndex  IE seem to be be happy with zindex not sure if that's the correct way to resolve the issue.,0,0
setters on FeedbackPanel do not return self  which prevents chaining,The setters on FeedbackPanel do not return 'this'.This makes chaining impossible  i.e. add(new FeedbackPanel('id').setFilter(filter).setRenderBodyOnly(true));I think it would be more consistent with the rest of wicket  and useful  if the setters are changed to support chaining.,0,0
AbstractTree breaks on multiple tree model events in the same request,When multiple events are fired by the treemodel  e.g. an expandNode and selectNode  unreachable treeitems end up times in the dirtyitems list.Their children will be added to the treeitemcontainer in ontargetrespond  leading to the situation where it has children that are not rendered.(in development  an 'unrendered component' exception is thrown),0,0
DatePicker is not thread-safe,DatePicker uses 2 SimpleDateFormats as static final fields. That causes random failures under load because SimpleDateFormat is not thread-safe. From its javadocs: 'Date formats are not synchronized. It is recommended to create separate format instances for each thread. If multiple threads access a format concurrently  it must be synchronized externally.'For example:18:34:06 214 (TP-Processor3) ERROR &#91;org.apache.wicket.RequestCycle&#93; - Exception in rendering component: [MarkupContainer &#91;Component id = _header_0&#93;]org.apache.wicket.WicketRuntimeException: Exception in rendering component: [MarkupContainer &#91;Component id = _header_0&#93;] at org.apache.wicket.Component.renderComponent(Component.java:2519) at org.apache.wicket.MarkupContainer.onRender(MarkupContainer.java:1411) at org.apache.wicket.Component.render(Component.java:2317) at org.apache.wicket.MarkupContainer.autoAdd(MarkupContainer.java:223) at org.apache.wicket.markup.resolver.HtmlHeaderResolver.resolve(HtmlHeaderResolver.java:78) at org.apache.wicket.MarkupContainer.renderNext(MarkupContainer.java:1324) at org.apache.wicket.MarkupContainer.renderAll(MarkupContainer.java:1427) at org.apache.wicket.Page.onRender(Page.java:1470) at org.apache.wicket.Component.render(Component.java:2317) at org.apache.wicket.Page.renderPage(Page.java:904) at org.apache.wicket.request.target.component.BookmarkablePageRequestTarget.respond(BookmarkablePageRequestTarget.java:231) at org.apache.wicket.request.AbstractRequestCycleProcessor.respond(AbstractRequestCycleProcessor.java:104) at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1181) at org.apache.wicket.RequestCycle.step(RequestCycle.java:1252) at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1353) at org.apache.wicket.RequestCycle.request(RequestCycle.java:493) at org.apache.wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:355) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:200) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at com.huitale.marketplace.security.SessionHijackingFilter.doFilter(SessionHijackingFilter.java:51) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:175) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:263) at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:190) at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:283) at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:767) at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:697) at org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:889) at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:690) at java.lang.Thread.run(Thread.java:619)Caused by: java.lang.ArrayIndexOutOfBoundsException: 14 at sun.util.calendar.BaseCalendar.getCalendarDateFromFixedDate(BaseCalendar.java:436) at java.util.GregorianCalendar.computeFields(GregorianCalendar.java:2081) at java.util.GregorianCalendar.computeFields(GregorianCalendar.java:1996) at java.util.Calendar.setTimeInMillis(Calendar.java:1104) at java.util.Calendar.setTime(Calendar.java:1070) at java.text.SimpleDateFormat.format(SimpleDateFormat.java:859) at java.text.SimpleDateFormat.format(SimpleDateFormat.java:852) at java.text.DateFormat.format(DateFormat.java:316) at org.apache.wicket.extensions.yui.calendar.DatePicker.configure(DatePicker.java:390) at org.apache.wicket.extensions.yui.calendar.DateTimeField$1.configure(DateTimeField.java:128) at org.apache.wicket.extensions.yui.calendar.DatePicker.renderHead(DatePicker.java:224) at org.apache.wicket.Component.renderHead(Component.java:2568) at org.apache.wicket.markup.html.internal.HtmlHeaderContainer$1.component(HtmlHeaderContainer.java:220) at org.apache.wicket.MarkupContainer.visitChildren(MarkupContainer.java:829) at org.apache.wicket.MarkupContainer.visitChildren(MarkupContainer.java:844) at org.apache.wicket.MarkupContainer.visitChildren(MarkupContainer.java:844) at org.apache.wicket.MarkupContainer.visitChildren(MarkupContainer.java:869) at org.apache.wicket.markup.html.internal.HtmlHeaderContainer.renderHeaderSections(HtmlHeaderContainer.java:211) at org.apache.wicket.markup.html.internal.HtmlHeaderContainer.onComponentTagBody(HtmlHeaderContainer.java:136) at org.apache.wicket.Component.renderComponent(Component.java:2480) ... 35 morehappens because one internal SimpleDateFormat's field changes while the class is formatting a date.,0,1
FormComponent cookie persistent issue,The FormComponent doesnt persistent the cookie correct when there is no context path and the cookie is created on a mounted page. The cookie is created by cannot be retrieved again from the formcomponent. Either the retrieval logic is wrong or the cookie is created wrongly.See this thread for more information:http://www.nabble.com/FormComponent-cookie-persistent-issue-td21197389.html,0,0
Empty File Upload field breaks validation of other fields in WicketTester.,Submitting form with empty FileUpload -field break validations of other fields in WicketTester: TextField mandatority (field.setRequired(true)). TextField input length validation (field.add(StringValidator(lengthBetween(...)))). DropDownChoice validation does not 'see' selection.If File Upload -field is filled  then validations above work.Form submits manually without a problem in web browser.,0,0
FormTester (BaseWicketTester.executeAjaxEvent[component event]) submits also buttons that are hidden (isVisible=false) resulting in exception,FormTester (BaseWicketTester.executeAjaxEvent&#91;component event&#93;) submits also buttons that are hidden (isVisible=false) resulting in exception.I am trying to ajax-click the visible button  but the formTester arranges even the hidden button to be submitted.. the form processing assumes the hidden button is now the submitting button.. and it is hidden  so an exception is thrown:org.apache.wicket.WicketRuntimeException: Submit Button hiddenButton (path=form:hiddenButton) is not visible at org.apache.wicket.markup.html.form.Form$2.component(Form.java:604) at org.apache.wicket.MarkupContainer.visitChildren(MarkupContainer.java:859) at org.apache.wicket.MarkupContainer.visitChildren(MarkupContainer.java:874) at org.apache.wicket.markup.html.form.Form.findSubmittingButton(Form.java:588) at org.apache.wicket.markup.html.form.Form.onFormSubmitted(Form.java:852) at org.apache.wicket.ajax.form.AjaxFormSubmitBehavior.onEvent(AjaxFormSubmitBehavior.java:132) at org.apache.wicket.ajax.AjaxEventBehavior.respond(AjaxEventBehavior.java:166) at org.apache.wicket.ajax.AbstractDefaultAjaxBehavior.onRequest(AbstractDefaultAjaxBehavior.java:299) at org.apache.wicket.util.tester.BaseWicketTester.executeAjaxEvent(BaseWicketTester.java:1170) at org.apache.wicket.util.tester.BaseWicketTester.executeAjaxEvent(BaseWicketTester.java:1080) at com.mycompany.TestHomePage.testAjaxSubmitWhileAnotherButtonIsNotVisible(TestHomePage.java:33) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at junit.framework.TestCase.runTest(TestCase.java:164) at junit.framework.TestCase.runBare(TestCase.java:130) at junit.framework.TestResult$1.protect(TestResult.java:106) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.framework.TestResult.run(TestResult.java:109) at junit.framework.TestCase.run(TestCase.java:120) at junit.framework.TestSuite.runTest(TestSuite.java:230) at junit.framework.TestSuite.run(TestSuite.java:225) at org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:130) at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386) at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)I would assume this is an easy fix to the BaseWicketTester.executeAjaxEvent&#91;component event&#93;) method where it visits the form components...An invasive workaround: Just set your hidden button temporarily visible (from within your wickettest) while executing the ajax event,0,0
Validation messages aren't cleared on success.,When triggering validation messages on a form component  they aren't cleared anymore when afterward we fix our validation problem.The following code demonstrates this issue by making a form with a single text field that is set as required. First  we submit the form without filling in the field. We expect that to cause an error. Which it does. Then  we set a value in the field  and submit again. We expect that to pass validation. It does not  however.Instead  we get this exception:junit.framework.AssertionFailedError: expect no error message  but contains Field 'field' is required. at junit.framework.Assert.fail(Assert.java:47) at junit.framework.Assert.assertTrue(Assert.java:20) at org.apache.wicket.util.tester.WicketTester.assertNoErrorMessage(WicketTester.java:493) at test.spike.net.link.safeonline.TinyTests.wicketTest(TinyTests.java:93)Code:package test.spike;import org.apache.wicket.Page;import org.apache.wicket.markup.html.WebPage;import org.apache.wicket.markup.html.form.Form;import org.apache.wicket.markup.html.form.TextField;import org.apache.wicket.protocol.http.WebApplication;import org.apache.wicket.util.tester.FormTester;import org.apache.wicket.util.tester.WicketTester;import org.junit.Test;public class TinyTests { public static class MyApp extends WebApplication { @Override public Class&lt;? extends Page&gt; getHomePage() { return MyPage.class; } } public static class MyPage extends WebPage { public MyPage() { add(new MyForm('form')); } class MyForm extends Form&lt;String&gt; { private static final long serialVersionUID = 1L; public MyForm(String id) { super(id); TextField&lt;String&gt; f = new TextField&lt;String&gt;('field'); f.setRequired(true); add(f); } } } @Test public void wicketTest() { WicketTester wicket = new WicketTester(new MyApp()); wicket.processRequestCycle(); FormTester form = wicket.newFormTester('form'); form.submit(); wicket.assertErrorMessages(new String[] { 'Field 'field' is required.' }); form = wicket.newFormTester('form'); form.setValue('field'  'foo'); form.submit(); wicket.assertNoErrorMessage(); // &lt;- Exception line. }}&lt;html&gt; &lt;body&gt; &lt;form wicket:id='form'&gt; &lt;input wicket:id='field' /&gt; &lt;input type='submit' /&gt; &lt;/form&gt; &lt;/body&gt;&lt;/html&gt;,0,0
Callback after detaching the page but before the PageMap lock is released,Currently  it is not possible to perform any checks on a page after the request has been detached. In onEndRequest  the PageMap lock has already been cleared  making it unsafe to access the pages involved in the request. Would it be possible to add an extra callback method (ie. onAfterTargetDetach()) to RequestCycle directly after detaching the request targets? We need such a callback to check (in development mode) if all models are detached correctly.,0,0
AutoComplete ShowListOnFocusGain not working,I noticed an issue with the Wicket-Extensions autocomplete behavior when the AutoCompleteSettings ShowListOnFocusGain flag is set to true. Basically  it works as expected in Firefox  but in (at least) Chrome  IE6 and IE7  it displays the list on focus gain  but you cannot use the mouse to select any of the items in the autocomplete list. The debug log showed that as soon as an item in the list was clicked on  the onblur event would fire for the field  which would then immediately fire a focus event  which would trigger reloading the list.This fix for this is trivial: adding one line to the top of obj.onfocus: if (mouseactive==1) return killEvent(event);.I'll post the patch.,0,0
isVisible should not be called after detach,I think isVisible should not be called after detach to prevent model reloads.I found one call to isVisible after detach in method ComponentRequestTarget#respond(RequestCycle). That method initiates a detach and then calls page.endComponentRender. This leads to a call to Page#checkRendering which calls isVisibleInHierarchy() and from there isVisible(). Method checkRendering only does something when the debug setting 'componentUseCheck' is enabled (which according to the javadoc is true by default). Short term workaround: set debug setting 'componentUseCheck' to false.,0,1
AutoComplete - KEY_TAB should work like KEY_ENTER,When selecting an item in a AutoComplete pulldown using the arrow keys and pressing the KEY_ENTER the current item is selected.Doing the same but pressing KEY_TAB instead  the focus shifts to to next input field  but current item is not selected.In a 'normal' pulldown menu KEY_TAB selects current item and shifts to next input.,0,0
BaseWicketTester can't find the pageLink field using reflection when you override the PageLink class.,Currently  BaseWicketTester (line 524) does this: public &lt;C extends Page&gt; Result isPageLink(String path  Class&lt;C&gt; expectedPageClass) { PageLink&lt;?&gt; pageLink = (PageLink&lt;?&gt;)getComponentFromLastRenderedPage(path); try { Field iPageLinkField = pageLink.getClass().getDeclaredField('pageLink'); iPageLinkField.setAccessible(true); IPageLink iPageLink = (IPageLink)iPageLinkField.get(pageLink); return isEqual(expectedPageClass  iPageLink.getPageIdentity()); }The problem manifests when you want to customize a page link's onClick by overriding it like this:new PageLink&lt;AuthPage&gt;('pageLink'  AuthPage.class) { private static final long serialVersionUID = 1L; @Override public void onClick() { Foo.bar(); super.onClick(); }});As a result; the BaseWicketTester tries to look for the pageLink field in the anonymous class instead of the privately declared pageLink field in the PageLink class.BaseWicketTester should either go down the tree:for(Class type = pageLink.getClass(); type != Object.class; type = type.getSuperclass())Or a getter should be made for the pageLink field. (This is what Java wants you to do).,0,0
FileUploadField.onDetach() causes IllegalStateException(),This was detected when using the example/sample Upload demo locally.ERROR - RequestCycle - there was an error cleaning up target org.apache.wicket.request.target.component.listener.ListenerInterfaceRequestTarget@20665159&#91;Page class = org.apache.wicket.examples.upload.UploadPage  id = 0  version = 0&#93;&gt;simpleUpload-&gt;interface org.apache.wicket.markup.html.form.IFormSubmitListener.IFormSubmitListener (request paramaters: &#91;RequestParameters componentPath=0:simpleUpload pageMapName=null versionNumber=0 interfaceName=IFormSubmitListener componentId=null behaviorId=null urlDepth=-1 parameters={} onlyProcessIfPathActive=false&#93;).java.lang.IllegalStateException: Attempt to set model object on null model of component: simpleUpload:fileInput at org.apache.wicket.Component.setDefaultModelObject(Component.java:2962) at org.apache.wicket.markup.html.form.FormComponent.setModelObject(FormComponent.java:1652) at org.apache.wicket.markup.html.form.upload.FileUploadField.onDetach(FileUploadField.java:175)Looking at the source indicates that unless onDetach() is over-ridden the default will always generate this exception. Here is the source for the FileUpLoadField.onDetach(). The line that creates the exception is noted by the '&lt;&lt;&lt;HERE' in the snippet below.FileUpLoadField.onDetach() snippet: /** Clean up at the end of the request. This means closing all inputstreams which might have been opened from the fileUpload.  @see org.apache.wicket.Component#onDetach() */ @Override protected void onDetach() Unknown macro: { if (fileUpload != null &amp;&amp; forceCloseStreamsOnDetach()) { fileUpload.closeStreams(); fileUpload = null; setModelObject(null); &lt;&lt;&lt;HERE } super.onDetach(); } Drilling further down  the setModelObject() calls FormComponent.setModelObject()  which in turns calls Component.setDefaultModelObject(). Inside setDefaultModelObject()  a check is done to see if the model object is null  if it is  it throws an exception: public final Component setDefaultModelObject(final Object object) { final IModel&lt;Object&gt; model = (IModel&lt;Object&gt;)getDefaultModel(); // Check whether anything can be set at all if (model == null) { throw new IllegalStateException( 'Attempt to set model object on null model of component: ' + getPageRelativePath()); } ...},0,0
HtmlProblemFinder documentation bug,In the javadoc of HtmlProblemFinder there is an example how to add additional IMarkupFIlters using Application.getAdditionalMarkupHandler()  this method is no longer available in Wicket 1.3  the documentation should be modified to show a valid example. The only way I can find by setting a new MarkupParserFactory which adds the filter.,0,0
beforeRender not called for behaviour added to ComponentTag,When adding a IMarkupFilter and adding a behaviour to the ComponentTag  the beforeRender method is never called  only onComponentTag will be called  but by then it is too late to modify the component.Usecase: I would like to make components hidden if the markup contains wicket:hidden='hidden'. For this i need to modify the components visiblitiy depending on if the markup contains that attribute.The attached quickstart will never reach the System.out.println('beforeRender: should hide component'); in HiddenComponentMarkupFilter,0,0
KittenCaptchaPanel generates a Ajax callback image url which potentially breaks when used in a Portlet,KittenCaptchaPanel generates the Ajax callback image url in its onclick event handler using: javascript.append('Wicket.$('' + image.getMarkupId() + '').src = ''); javascript.append(image.urlFor(IResourceListener.INTERFACE)); javascript.append('&amp;rand=' + Math.random()); javascript.append(''');Appending the rand parameter using '&amp;rand=' assumes the image url already contains (at least) one other parameter.Within a default (plain website) environment this most likely is true  however in a Portlet this really depends on how the portal encodes the generated image url in the resulting PortletURL.Jetspeed-2 for instance (can) encode this as path element  in which case appending '&amp;rand=' leads to an incorrect and invalid url.For further information  please see WICKET-649 in which I described how I fixed similar cases in several other locations within Wicket.I'll fix this issue likewise in a transparent way replacing the above with the following: javascript.append('Wicket.$('' + image.getMarkupId() + '').src = ''); CharSequence url = image.urlFor(IResourceListener.INTERFACE); javascript.append(url); javascript.append((url.toString().indexOf('?') &gt; -1 ? '&amp;' : '?') + 'rand=' + Math.random()); javascript.append(''');,0,0
AjaxPreprocessingCallDecorator calls the delegate decorator before itself (same behavior as AjaxPostprocessingCallDecorator),AjaxPreprocessingCallDecorator calls the delegate decorator before itself (same behavior as AjaxPostprocessingCallDecorator)  when it should call itself before the delegate.,0,0
Wizard buttons (previous / finish) aren't enabled when they should be,When using the Wizard component in 1.4-SNAPSHOT (sometime after 1.4-RC1)  the previous and finish buttons don't enable when they should. I have found that this is because isEnabledInHierarchy is called multiple times  with the first time being during the POST process  before the wizard step is advanced to the next step. Since the step has not advanced when isEnabled is calculated  you get the following behavior:1 - click 'next' from first step to second - the 'previous' button should be enabled  but it's not2 - the 'finish' button never is enabled  even on the last step,0,0
SmartLinkLabel does not handle ~ in urls,The SmartLinkLabel doesn't care with tilde (~) character  so if i have a link like this: http://localhost/~something than only the http://localhost/ will be a link  and the rest of it won't.The source of the problem is very likely in DefaultLinkParser.java: /** URL pattern */ private static final String urlPattern = '(&#91;a-zA-Z&#93;:////w//.//-//:///)//w//.://-/?&amp;=%*';It just needs to add ~ char to the regexp.,0,0
KittenCaptcha filter declared twice in wicket-examples web.xml,,0,0
Should the QuickStart archetype generated HomePage.html inlude the Wicket namespace in the html tag?,For full history see http://www.nabble.com/What-is-the-best-way-to-handle-%22Undefined-attribute-name-%28wicket%3Aid%29%22--warnings-from-Eclipse-Ganymede--to21788889.html#a21818462Timo It's a very simple change to the archetype: just replace the html open tagwith html xmlns:wicket='http://wicket.apache.org/dtds.data/wicket-xhtml1.3-strict.dtd'in /archetype-resources/src/main/java/HomePage.htmlThe question is  is there any reason why we wouldn't want to do this? I've raised the Jira issue anyway.Regards - Cemal&lt;a href='http://www.jWeekend.co.uk'&gt;jWeekend&lt;/a&gt;,0,0
SerializationChecker issue,When the static initialization of the SerializationChecker class fails (one of the methods is not available) it throws a runtime exception which marks the SerializationChecker class as unavailable in the JVM. Using the SerializationChecker class after that to check for SerializationChecker .isAvailable is pointless because it throws the ClassNotFound exception.,0,0
Component Use Check always fails for visible components inside an invisible border body,,0,0
ApacheLicenceHeaderTests fail after projects' metadata created by Eclipse,Wicket and all it's accompanying projects when being worked on in Eclipse tend to fail several ApacheLicenceHeaderTest as it is an IDE that creates .settings directory containing several xml projects' metadata files. There are 6 solutions:1. don't use eclipse2. skip tests entirely (-Dmaven.test.skip=true passed on the CLI when invoking maven)3. skip running the tests (-DskipTests)4. compile &amp; run but ignore tests failures (-Dmaven.test.failure.ignore=true)5. Modify the ApacheLicenceHeaderTests so that the xml files in the .settings directories are ignoredIMHO  having considered all pros and cons  only 5. is a an option. As there already is an Eclipse originating .xml file that gets ignored I hope that you don't mind going this way. The patch to follow shortly.,0,0
MultiFileUploadField.js can't find file input when serving pages as XHTML,When Wicket-based application serves web pages as XHTML (with the 'Content-type:application/xhtml+xml' header)  upload procedure using MultiFileUploadField.js won't work as it can't find file input even though it's properly added.This happens because @line 65 of MultiFileUploadField.js input tag name is expected to be 'input' (capitalized)  which in XHTML is actually 'input' (lowercase).,0,0
PageLink is inherently non extendable,Due to the fact that there is no accessor provided for the private final IPageLink pageLink  there's no way of writing subclasses that would be aware of the pages they are linking to. My particular case is closely related to the annotation based authorization and an enhancement proposal http://issues.apache.org/jira/browse/WICKET-2089. Now  provided that this enhancement (that otherwise needs more look into) won't make it into wicket/wicket-auth-roles (though I am more than convinced that it should)  and I would have to put the proposed IAuthorisationStrategy implementation outside core wicket  I would also have to write (copy&amp;paste) my own PageLink that exposes its pageLink member in order to retrieve the page class it is referring to and substitute all occurernces of org.apache.wicket.markup.html.link.PageLink with it in my projects  so that my IAuthorisationStrategy implementation can retrieve the page class the the link is pointing to. Please note  that BokmarkablePageLink  which also is constructed with Page class does expose page class identity via public final Class&lt;? extends Page&gt; getPageClass().I suggest that for the sake of keeping the API clean and coherent the method with the same signature as in BookmarkablePageLink should be added to the PageLink. public Class&lt;? extends Page&gt; getPageClass() { return pageLink.getPageIdentity(); }Another question arises - why BookmarkablePageLink is not a subclass of PageLink and why class resolution for those classes differs so much. Wouldn't it be easier to keep the class reference in the BookmarkablePageClass rather than its textual representation and skip all this mumbo-jumbo class resolution. But this is quite another story and OT for this issue.,0,0
Misplaced IllegalStateExceptions when accessing stateful URL with different session,partly copied from the mailing list (http://www.nabble.com/exception-handling-for-session-dependent-URLs-to22037821.html):I recently came across a link to one of my projects where a user linked to a session dependent URL such as /?wicket:interface=:0::IBehaviorListener:2:3when clicking on that URL  a PageExpiredException gets thrown and a redirect to the SessionExpiredPage takes place. So far so good - that's the way it should be.However this works only for the first request (as long as the user doesn't have a session). If the user has a session and clicks on that link different exceptions might get thrown. with the URL mentioned above I've seen either a IllegalStateException (when it couldn't find a IBehaviorListener with the corresponding ID) or a ClassCastException (when it tried to cast a HeaderContributor to an IBehaviorListener in BehaviorRequestTarget). Apart from the ClassCastException  which definitely shouldn't occur  I don't think that IllegalStateExceptions should be thrown in (all of) those cases  as clicking on a session dependent link with a wrong session isn't a far fetched scenario.,0,0
WicketTester fails to execute AjaxBehavior (onclick) due to old requestCycle (this bug is caused by bugfix WICKET-254),WicketTester fails to execute AjaxBehavior (onclick) due to old requestCycle. This bug results from bugfix WICKET-254 (http://issues.apache.org/jira/browse/WICKET-254)See attached QuickstartKnown workaround:// Add following line before your tester.executeAjaxEvent:tester.setupRequestAndResponse(true);@seehttp://issues.apache.org/jira/browse/WICKET-254,0,0
Make Component. 'protected List getBehaviors(Class' public,actually making getbehaviors(class) public will also break codebecause any override already in place will then attempt to reduce thevisibility of the method.add a jira issue  most likely for 1.5 considering 1.4 is already in RC2.-igorOn Thu  Feb 19  2009 at 1:24 PM  Martin Funk &lt;mafulafunk@googlemail.com&gt; wrote:Hi why is Components public final List&lt;IBehavior&gt; getBehaviors()publicand why is protected List&lt;IBehavior&gt; getBehaviors(Class&lt;? extends IBehavior&gt;type)protected?For example for a Behavior I'd like it to be able to tell if an Behavior ofits type is already bound to that component.In its bind() method I'd like to do something like: if (component.getBehaviors(SomeBehavior.class).size() &gt; 1) { throw new Error('Ther may only be one'); }But I have to do something like: for (IBehavior behavior : component.getBehaviors()) { if (behavior instanceof SomeBehavior) { throw new Error('There may only be one'); } }So my whish would be to have em both public. I wouldn't mind seeing em bothfinal  but that might break existing code.mf,0,0
Polish translations for wicket-extensions properties,,0,0
Javascript function Wicket.replaceAll is unbearably slow,I use AbstractAjaxTimerBehavior to update many different components on my pages periodically.After a while  the browser occupies 50% or more of the system resources.I used the javascript profiler in firebug and found that Wicket.replaceAll is responsible for 60+ percent of javascript processing time.The problem is that sequential string processing is used instead of much faster regular expressions,0,1
StringValidator error messages erroneously mention input instead of label,Using a StringValidator.MaximumLengthValidator (or any flavor of the StringValidator class)  the reported errors are currently under the form:StringValidator.minimum='${input}' is shorter than the minimum of ${minimum} characters.which creates odd messages where the content of the field is mentionned instead of the field label.Example: 'Joe' is shorter than the minimum of 5 characters.should be The field 'Name' should be at least 5 characters longThis is specially important in password fields  where the StringValidator is not usable because it displays the input in clear text on the web page: 'x4eR4*z' is shorter than the minimum of 5 characters.should be The field 'Password' should be at least 5 characters long,0,0
Conversion Exception Thrown for Submitting A Page with Multiple Forms within A Border,'org.apache.wicket.util.convert.ConversionException: Can't convert null value to a primitive class: int for setting it on' exception thrown when submitting a Page with multiple Forms within a Border. A 'Bordered' Page with a single Form would not have this problem manifests. Also  if the Page by itself (not contained in a Border) is alright too.,0,0
FormComponentPanel should not add a name attribute,FormComponent adds a name attribute in onComponentTag. This behaviour is inherited by FormComponentPanel  but is not valid for the latter. Often a FormComponentPanel is a div or span  for which the name attribute is not allowed.,0,0
WicketSessionFilter doesn't takes into account WebApplication#getSessionAttributePrefix(WebRequest),WicketSessionFilter#init(FilterConfig)  line 139 constructs the 'sessionKey' without taking into account the return value of WebApplication#getSessionAttributePrefix(WebRequest).Patch:Index: protocol/http/servlet/WicketSessionFilter.java===================================================================&#8212; protocol/http/servlet/WicketSessionFilter.java (revisiﾃｳn: 725053)+++ protocol/http/servlet/WicketSessionFilter.java (copia de trabajo)@@ -28 6 +28 7 @@ import javax.servlet.http.HttpSession; import org.apache.wicket.Session;+import org.apache.wicket.protocol.http.WebApplication; import org.slf4j.Logger; import org.slf4j.LoggerFactory;@@ -136 7 +137 8 @@ log.debug('filterName/ application key set to ' + filterName); } sessionKey = 'wicket:' + filterName + ':' + Session.SESSION_ATTRIBUTE_NAME;+ WebApplication application = WebApplication.get(filterName);+ sessionKey = application.getSessionAttributePrefix(null) + Session.SESSION_ATTRIBUTE_NAME; if (log.isDebugEnabled()) {,0,0
TabbedPanel accepts only ITab(s),TabbedPanel manages a List of ITab(s).This prevents instantiation of TabbedPanel(s) made of any custom ITab implementation.Every reference to List&lt;ITab&gt; should be converted to List&lt;? extends ITab&gt;.Alternatively  TabbedPanel should be declared as:public class TabbedPanel&lt;T extends ITab&gt; extends Panel{}depending on the preferred strategy.,0,0
application_nl.properties is outdated,The application_nl.properties is a bit outdated. I have attached a patch file that contains the diff betweeen application.properties and application_nl.properties @ wicket 1.3.5.,0,0
DropDownChoice NO_SELECTION_VALUE static field is final,Lets say I do this:List&lt;Option&gt; _options = getOptions();someRenderer = new ChoiceRenderer() {...}DropDownChoice _ddc = new DropDownChoice('dropDown'  new Model((Serializable) _option) options  someRenderer);The Option class looks like this:public class Option {private String display_name;private String id;gettersAndSetters...}If I select an Option from the DDC  and that Option has id = -1  the AbstractSingleSelectChoice#getDefaultChoice(final Object selected) will interpret my choice as the protected static final String NO_SELECTION_VALUE = '-1' in AbstractSingleSelectChoice.java.The result will be that the 'Choose one' option is visible in the DDC.Shouldn't the NO_SELECTION_VALUE be customizable?,0,0
Invalid nested form tag name when the form is not visible and setoutputmarkupplaceholdertag(true) has been called,when the an innerform is invisible and you called setoutputmarkupplaceholdertag(true)  onComponentTag not processed and an invalid form tag name results: &lt;form wicket:id=rootform&gt; &lt;form wicket:id=nestedform style='display: none'&gt;&lt;/form&gt;&lt;/form&gt;Component.render(final MarkupStream markupStream) {...if (determineVisibility()) { // render -&gt; replace form with div} else if (markupStream != null){ if (getFlag(FLAG_PLACEHOLDER)) { final ComponentTag tag = markupStream.getTag(); renderPlaceholderTag(tag  getResponse()); ///////////////////////Here form does not replace 'form' with 'div'}markupStream.skipComponent();},0,0
quickstart archetype adds invalid maven-compiler-plugin configuration,the maven-compiler-plugin configuration created by the quickstart archetype contains an invalid tag: &lt;optimise&gt;this should be &lt;optimize&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;inherited&gt;true&lt;/inherited&gt; &lt;configuration&gt; &lt;source&gt;1.5&lt;/source&gt; &lt;target&gt;1.5&lt;/target&gt; &lt;optimise&gt;true&lt;/optimise&gt; &lt;debug&gt;true&lt;/debug&gt; &lt;/configuration&gt; &lt;/plugin&gt;,0,0
Form#getMaxSize() -> no custom format,Hi I found problem with format of 'maxSize' property in component Form:final Map&lt;String  Object&gt; model = new HashMap&lt;String  Object&gt;();model.put('exception'  e);model.put('maxSize'  getMaxSize());... the main problem is if you want modify 'look and feel' of the Bytes format in error messages.Can you add e.g. new method String formatMaxSize() or something similar? The other solution is modification of toString of bean Bytes to get results look like 300kB (now there is 300K ... this is not good for common users). Or is there other simple way how to do this?Regards H.,0,0
onBeforeRender() set visibility of NavigationToolbar prevents it from showing again,This code in NavigationToolbar: @Override protected void onBeforeRender() { setVisible(table.getPageCount() &gt; 1); super.onBeforeRender(); }makes impossible to show toolbar after it became hidden when using with Ajax (AjaxNavigationToolbar)Possible solution: @Override public boolean isVisible() { return table.getPageCount()&gt;1; },0,0
Fix API documentation for DataTable,The example in the DataTable javadoc does not even compile. It says:------------- snip ------------ DataTable table = new DataTable(&quot;datatable&quot;  columns  new UserProvider()  10); table.add(new NavigationToolbar(table)); table.add(new HeadersToolbar(table)); add(table);                        snip ------------                        It should rather be:------------- snip ------------ DataTable table = new DataTable(&quot;datatable&quot;  columns  new UserProvider()  10); table.addBottomToolbar(new NavigationToolbar(table)); table.addTopToolbar(new HeadersToolbar(table  null)); add(table);                        snip ------------,0,0
PatternValidator could allow reverse matches,I need to define a pattern which is invalid as form field input. i.e. I have a user feed back from that receives a lot of spam but the names are normally something like 'xtrqkjitvxqoh'. Instead of having a capture I want to set names with 5 successive consonants as invalid.This patch does the trick...Index: src/main/java/org/apache/wicket/validation/validator/PatternValidator.java===================================================================&#8212; src/main/java/org/apache/wicket/validation/validator/PatternValidator.java (revision 749072)+++ src/main/java/org/apache/wicket/validation/validator/PatternValidator.java (working copy)@@ -64 6 +64 9 @@ /** the &lt;code&gt;java.util.regex.Pattern&lt;/code&gt; */ private final Pattern pattern;+ /** whether to exclude matching input **/+ private boolean reverse;+ /** Constructor that accepts a &lt;code&gt;String&lt;/code&gt; regular expression pattern. @@ -111 6 +114 15 @@ this(pattern.pattern()); }+ /**+ * If set to true then input that matches the pattern is considered invalid.+ * + * @param reverse+ */+ public void setReverse(boolean reverse)+ {+ this.reverse = reverse;+ } /** Gets the regexp pattern.@@ -155 7 +167 7 @@ protected void onValidate(IValidatable&lt;String&gt; validatable) { // Check value against pattern if (!pattern.matcher(validatable.getValue()).matches())+ if (pattern.matcher(validatable.getValue()).matches() == reverse) { error(validatable); },0,0
less dynamic or missing toString( ) methods in Component class,Several toString( ) methods in XXXChange inner classes of Component class are less dynamic or missing  less dynamic like:******************'ComponentModelChange&#91;component: &quot; + getPath() + &quot;&#93;'; as opposed to this.getClass().getSimpleName() + '&#91;component:&quot; + getPath() + &quot;&#93;' Furthermore  toString( ) method is missing altogether in ComponentBorderChange. Attaching simple modification patch for consideration.,0,0
WebApplication is not thread-safe,Instance of class org.apache.wicket.protocol.http.WebApplication is not thread safe being shared among several sessions. Concurrent access to it leads to errors because of the following:1. bufferedResponses field is initialized with a simple HashMap which is not thread safe and can be corrupted when different threads call addBufferedResponse  popBufferedResponse or sessionDestroyed methods concurrently. Here is the stack trace:&#91;27.03.09 20:55:26:669 MSK&#93; 0000009c RequestCycle E org.apache.wicket.RequestCycle logRuntimeException &lt;Null Message&gt; java.util.ConcurrentModificationException at java.util.HashMap$AbstractMapIterator.checkConcurrentMod(Unknown Source) at java.util.HashMap$AbstractMapIterator.makeNext(Unknown Source) at java.util.HashMap$KeyIterator.next(Unknown Source) at java.util.HashMap.analyzeMap(Unknown Source) at java.util.HashMap.rehash(Unknown Source) at java.util.HashMap.rehash(Unknown Source) at java.util.HashMap.putImpl(Unknown Source) at java.util.HashMap.put(Unknown Source) at org.apache.wicket.protocol.http.WebApplication.addBufferedResponse(WebApplication.java:639) at org.apache.wicket.protocol.http.WebRequestCycle.redirectTo(WebRequestCycle.java:201) at org.apache.wicket.request.target.component.PageRequestTarget.respond(PageRequestTarget.java:58) at org.apache.wicket.request.AbstractRequestCycleProcessor.respond(AbstractRequestCycleProcessor.java:104) at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1181) at org.apache.wicket.RequestCycle.step(RequestCycle.java:1252) at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1353) at org.apache.wicket.RequestCycle.request(RequestCycle.java:493) at org.apache.wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:355) at org.apache.wicket.protocol.http.WicketServlet.doPost(WicketServlet.java:145) at javax.servlet.http.HttpServlet.service(HttpServlet.java:738) at javax.servlet.http.HttpServlet.service(HttpServlet.java:831) at com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java:1443) at com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java:1384) at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:131)2. Class org.apache.wicket.util.collections.MostRecentlyUsedMap is not thread-safe and can be courrupted when different threads call addBufferedResponse  popBufferedResponse concurrently.,1,0
Form gets submitted using AjaxSubmitBehavior when sub-form has error's,from http://www.nabble.com/Should-a-form-submit-when-sub-form-has-error%27s--tt22803314.htmlI have a main-form where I add a panel that contains another form.This sub-form contains a formvalidator that gives the error.However the main-form is submitted  but the feedbackpanel does show the error message set in the sub-form's validator.I'll attach 2 patches with testcases displaying the behavior in wicket 1.3 vs 1.4(As a side note  I had to rename the org.apache.wicket.markup.html.form.validation.TestHomePage to org.apache.wicket.markup.html.form.validation.HomePageTest to get the test to run when building wicket),0,0
WicketTester clickLink on submitLink fails with conversion error,When clicking with WicketTester a submitlink that is situated outside a Form  clickLink doesn't process the input correctly. It tries to set null on the inputs (which fails for int properties for obvious reasons).I've attached a quickstart that exhibits this behavior.,0,0
typo in ApplicationContextMock.putBean() exception message:  'alredy',There is a minor typo in ApplicationContextMock.putBean() that is fixed by the attached patch.,0,0
Resource lookup/caching in OSGI environment spams errors for gone resources,I'd put together a simple dynamic menu example running on Modulefusion where the contributed menu items and pages come from another OSGI bundles. It works exactly as expected  eg. submenus appear/disappear automatically without restarts on submenu modules' deploys and undeploys  but after undeploying an already visited page's module  my server logs starts repeating messages like this:352322 &#91;ModificationWatcher Task&#93; ERROR org.apache.wicket.util.resource.UrlResourceStream - getLastModified for bundle://38.0:1/com/ftldev/wicket1/Boo.html failed: No bundle associated with resource: bundle://38.0:1/com/ftldev/wicket1/Boo.htmlI guess this has to do with resource caching. Is it possible to get this behaviour turn into a warning and/or get it stop after the first message? I guess once a resource has gone  it makes no good to keep looking for it forever anyway.. or is it another approach getting around this message? (again  appearently all my app keeps working fine meanwhile..),0,0
YUI library used by Wicket Extensions - DateTime isn't IE8 compatible,YUI library included with Wicket Extensions - DateTime (and potentially others) is the version 2.3.0 which has compatability issues with Internet Explorer 8. The recommended version of YUIlib which is IE8 compliant is 2.7.0.The specific issue I hit was DateTimeField causing block on loading almost random resources on my page  after a while IE8 reported the following error:------Webpage error detailsUser Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729)Timestamp: Thu  9 Apr 2009 06:53:18 UTCMessage: Unknown runtime errorLine: 12Char: 1986Code: 0URI: &#91;hidden to protect the guilty&#93;.YuiLib/calendar/calendar-min.js------Related discussion: http://www.nabble.com/Layout-Manager-causing-IE-8-to-freeze.-td22381589.html,0,0
Nested directory support for ZipResourceStream,It would be nice to have support for nested directories in ZipResourceStream.java,0,0
java.sql.Timestamp converter bug,SqlTimestampConverter should produce a Date/Time as output  but it only produces a time. SqlTimeConverter prints a simple time as expected.Looking in the code SqlTimestampConverter::convertToString uses: DateFormat format = DateFormat.getTimeInstance(dateFormat  locale);when I think it should say: DateFormat format = DateFormat.getDateTimeInstance(DateFormat.SHORT  DateFormat.SHORT  locale);instead.convertToObject would need a corresponding change to: DateFormat format = DateFormat.getDateTimeInstance(DateFormat.SHORT  DateFormat.SHORT  locale);,0,0
Allow overriding of the Validator default MessageKey,Currently there is no other way to change the default message key of any validator. Provide a protected non final method: getMessageKey() to allow overriding of the message key. For example for MinimumValidator:&#91;CODE&#93; public void validate(IValidatable&lt;Z&gt; validatable) { Z value = validatable.getValue(); if (value.compareTo(minimum) &lt; 0) { ValidationError error = new ValidationError(); error.addMessageKey(getMessageKey()); error.setVariable('minimum'  minimum); validatable.error(error); } } protected String getMessageKey() { return 'MinimumValidator'; }&#91;CODE&#93;,0,0
PageParameters always non-empty,Say I mount MyBookmarkablePage like so:mount(new IndexedHybridUrlCodingStrategy('/my/bookmarkable' MyBookmarkablePage.class));where public MyBookmarkablePage() { (...) } public MyBookmarkablePage(PageParameters params) { (...) }When I call http://localhost:8080/app/my/bookmarkable (just that plainurl  no trailing nothing)  then I never get into the no-argsconstructor  always in the params one. This because the params objectcomes with '0'=''  which I feel is wrong.Consequently  params.containsKey('0') returns true - and here I haveto go and check if the value is not empty.Note I'm using IndexedHybridUrlCodingStrategy.,0,0
IndexedHybridUrlCodingStrategy constructor should accept a redirectOnBookmarkableRequest boolan,HybridUrlCodingStrategy has a constructor which accepts a redirectOnBookmarkableRequest boolanIndexedHybridUrlCodingStrategy (which extends HybridUrlCodingStrategy) doesn't contain the same constructor  i think it should.,0,0
The JavaDoc for IPageLink still holds a reference to PageLink which is deprecated,The JavaDoc for IPageLink still holds a reference to PageLink which is deprecated,0,0
open/close div tags are rendered erroneously,Div tags are rendered erroneously if written as an open/close tag.&lt;div/&gt; is rendered as &lt;div&gt; with the closing tag appended at the end of page in wicket-1.4-rc4  while &lt;div&gt;&lt;/div&gt; is rendered correct. Div as open/close tag works fine in wicket-1.4-rc2 even though it gets rendered as separate open and close tags.,0,0
isComponent in BaseWicketTester contains possible nullpointer exception,When attempting to verify if a component exists  attempting to unit test a panel  the tester.assertComponent() call fails due to a nullpointer.This occurs when isComponent() in BaseWicketTester is called and fails to find a component from the last rendered page. Then the component.getClass() in the following line will trigger the nullpointer exception.A very simple fix would be to add a null check before attempting to check the type of the component to be able to provide a better error message.,0,0
Radio#onComponentTag uses Objects.equal instead of model comparator,Radio#onComponentTag uses Objects.equal instead of modelcomparator from RadioGroup. Because of that  it is impossible to use custom model comparator in RadioGroup asRadioGroup must contain values that pass equality check with values in Radios (otherwise  Radios aren't marked as checked in html).,0,0
Remove IComponentBorder in favor of IBehavior,Yeah i think we can depricate IComponentBorder in 1.4 and point to IBehaviorbefore/afterand then remove it in 1.5 and maybe remote also **public final Component setComponentBorder(final IComponentBorder border)in component or make it*public final Component setComponentBorder(final IBehavior border)to make it more clear to people that a border can be set by using a behavior(else who knows..) Hide quoted text -On Sat  May 16  2009 at 12:21  Juergen Donnerstag &lt;juergen.donnerstag@gmail.com&gt; wrote:&gt; Hi &gt;&gt; question: looking at that code&gt;&gt; // Call implementation to render component&gt; final IComponentBorder border =&gt; getComponentBorder();&gt; if (border != null)&gt; {&gt; border.renderBefore(this);&gt; }&gt; notifyBehaviorsComponentBeforeRender();&gt; onRender(markupStream);&gt; notifyBehaviorsComponentRendered();&gt; if (border != null)&gt; {&gt; border.renderAfter(this);&gt; }&gt;&gt; IComponentBorder could be implemented via a behavior as well. Is there&gt; any reason why IComponentBorder needs this special treatment and why&gt; it is not implemented as a behavior?&gt;&gt; -Juergen&gt;-----------------&gt; Yeah i think we can depricate IComponentBorder in 1.4 and point to IBehavior&gt; before/afteri like the ComponentBorder stuff  because you can set it withoutinfluencing any beahavior or component stuff.. just render some contentbefore and after a component..i use it in debugging environmentmm------ Wait for some and give everybody a chance to comment,0,0
When injecting more than one parm in a method  an ArrayIndexOutOfBoundsException is thrown,When using method injection that takes more than one parameter  an ArrayIndexOutOfBoundsException (-1) is thrown. I've isolated code to line 90 of org.apache.wicket.guice.GuiceProxyTargetLocator. parmTypes&#91;2 - i&#93; should read parmTypes&#91;i - 2&#93;. I will attach a (simple) patch with this.,0,0
[devutils] Can only inspect pages in same pagemap as the inspector,The InspectorPage presents a list of pagemaps and pages contained within them  with links to inspect the contents of each page ID.However  when one of these is clicked it tries to resolve the page ID within the current pagemap of the inspector page itself  which is quite possibly not the case.Here is a patch which passes the pagemap name alongside the page ID and looks it up appropropriately.,0,0
ClassCastException in SqlDateConverter,When converting a date string to a java.sql.Date you'll always get a ClassCastException like this one:java.lang.ClassCastException: java.util.Date cannot be cast to java.sql.Date at org.apache.wicket.util.convert.converters.SqlDateConverter.convertToObject(SqlDateConverter.java:43)Reason is DateFormat.parse() returns a java.util.Date  which is cast to java.sql.Date. One solution would bereturn new Date(((java.util.Date)parse(getDateFormat(locale)  value  locale)).getTime())See https://issues.apache.org/jira/browse/WICKET-735,0,0
FormTester.setValue should throw exception if not FormComponent,Should throw exception if not formComponent: public void setValue(final String formComponentId  final String value) { checkClosed(); Component component = workingForm.get(formComponentId); if (component == null) { throw new IllegalArgumentException( 'Unable to set value. Couldn't find component with name: ' + formComponentId); } if (component instanceof IFormSubmittingComponent) { setFormSubmittingComponentValue((IFormSubmittingComponent)component  value); } else if (component instanceof FormComponent) { setFormComponentValue((FormComponent&lt;?&gt;)component  value); } },0,0
BaseWicketTester doesn't invoke Application.newAjaxRequestTarget for ajax request target,When the BaseWicketTester creates a new ajax request target  it does not invoke the application but creates one by itself. This makes it impossible to use the tester when application-specific ajax request target subclassing is used.,0,0
Form generates invalid html in appendDefaultButtonField,The javascript added to the button contains several unescaped &amp;  such as 'b!=null&amp;&amp;b.onclick!=null&amp;&amp;typeof(b.onclick)'  these should be replaced with &amp;. This was already mentioned in ticket 2033  but that ticket is about another problem.,0,0
IChoiceRenderer generic type parameters are wrong throughout the AbstractChoice class hierarchy,All the AbstractChoice components currently make use of an IChoiceRenderer&lt;T&gt;. They should more properly make use of an IChoiceRenderer&lt;? super T&gt;. The excessive strictness of the type parameter prevents users from defining a singleton choicerenderer that can be used for a variety of different choice components for different but related classes.Example use-case: Most of my persistent beans implement INamedPersistentObject  providing getName() and getPrimaryKey() methods. This is enough to implement an IChoiceRenderer&lt;INamedPersistentObject&gt;. I wish to declare a singleton instance of this and reuse it for various choice components on various concrete types  but currently can't without messy casts.I have set priority=blocker on this bug because it is an API issue which really needs consideration before 1.4 is released  as depending on how strict an API/ABI compatibility policy is used  it might be considered unfixable once 1.4 is released GA.,0,0
WicketTester does not accurately simulate scenario where entire page is added to AjaxRequestTarget,If the entire page is added to an AjaxRequestTarget  Wicket treats this as a special case: the normal ajax flow is aborted and the browser is asked to refetch the page in a normal  non-ajax request.For example  if this code is used:public void onClick(AjaxRequestTarget tgt){ tgt.addComponent(getPage());}This causes the browser to reload the page (you can see the location bar in the browser changing).The problem is that WicketTester does not simulate this scenario correctly. If you use WicketTester to test the onClick() listener in the example above  the page is not re-rendered. You can verify this by instrumenting the onBeforeRender method for the page: it is never called.So to summarize:When the framework is run normally  AjaxRequestTarget.addComponent(Page) causes Wicket to start a completely new non-ajax request-response. However when the framework is run using WicketTester  a new request-response is not executed.,0,0
DebugBar throws an java.lang.ExceptionInInitializerError when Tomcat is restarted,I have just added the DebugBar to our base page  and since then when Tomcat is restarted and session would be reloaded by this it throws this exception:1 ERROR org.apache.catalina.session.ManagerBase - Exception loading sessions from persistent storagejava.lang.ExceptionInInitializerError at sun.misc.Unsafe.ensureClassInitialized(Native Method) at sun.reflect.UnsafeFieldAccessorFactory.newFieldAccessor(UnsafeFieldAccessorFactory.java:25) at sun.reflect.ReflectionFactory.newFieldAccessor(ReflectionFactory.java:122) at java.lang.reflect.Field.acquireFieldAccessor(Field.java:918) at java.lang.reflect.Field.getFieldAccessor(Field.java:899) at java.lang.reflect.Field.getLong(Field.java:528) at java.io.ObjectStreamClass.getDeclaredSUID(ObjectStreamClass.java:1614) at java.io.ObjectStreamClass.access$700(ObjectStreamClass.java:52) at java.io.ObjectStreamClass$2.run(ObjectStreamClass.java:425) at java.security.AccessController.doPrivileged(Native Method) at java.io.ObjectStreamClass.&lt;init&gt;(ObjectStreamClass.java:413) at java.io.ObjectStreamClass.lookup(ObjectStreamClass.java:310) at java.io.ObjectStreamClass.initNonProxy(ObjectStreamClass.java:547) at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1583) at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1496) at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1583) at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1496) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1732) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1329) at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1667) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1323) at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1947) at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1871) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1753) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1329) at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1947) at java.io.ObjectInputStream.defaultReadObject(ObjectInputStream.java:480) at org.apache.wicket.Component.readObject(Component.java:4469) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:974) at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1849) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1753) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1329) at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1667) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1323) at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1947) at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1871) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1753) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1329) at java.io.ObjectInputStream.readObject(ObjectInputStream.java:351) at java.util.concurrent.CopyOnWriteArrayList.readObject(CopyOnWriteArrayList.java:845) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:974) at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1849) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1753) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1329) at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1947) at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1871) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1753) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1329) at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1947) at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1871) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1753) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1329) at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1947) at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1871) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1753) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1329) at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1667) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1323) at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1947) at java.io.ObjectInputStream.defaultReadObject(ObjectInputStream.java:480) at org.apache.wicket.Page.readPageObject(Page.java:1349) at org.apache.wicket.Component.readObject(Component.java:4465) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:974) at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1849) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1753) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1329) at java.io.ObjectInputStream.readObject(ObjectInputStream.java:351) at org.apache.wicket.protocol.http.SecondLevelCacheSessionStore$SecondLevelCachePageMap.readObject(SecondLevelCacheSessionStore.java:412) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:974) at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1849) at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1753) at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1329) at java.io.ObjectInputStream.readObject(ObjectInputStream.java:351) at org.apache.catalina.session.StandardSession.readObject(StandardSession.java:1407) at org.apache.catalina.session.StandardSession.readObjectData(StandardSession.java:931) at org.apache.catalina.session.StandardManager.doLoad(StandardManager.java:394) at org.apache.catalina.session.StandardManager.load(StandardManager.java:321) at org.apache.catalina.session.StandardManager.start(StandardManager.java:637) at org.apache.catalina.core.ContainerBase.setManager(ContainerBase.java:432) at org.apache.catalina.core.StandardContext.start(StandardContext.java:4160) at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1014) at org.apache.catalina.core.StandardHost.start(StandardHost.java:736) at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1014) at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:443) at org.apache.catalina.core.StandardService.start(StandardService.java:448) at org.apache.catalina.core.StandardServer.start(StandardServer.java:700) at org.apache.catalina.startup.Catalina.start(Catalina.java:552) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:295) at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:433)Caused by: org.apache.wicket.WicketRuntimeException: There is no application attached to current thread main at org.apache.wicket.Application.get(Application.java:178) at org.apache.wicket.devutils.debugbar.DebugBar.getContributors(DebugBar.java:146) at org.apache.wicket.devutils.debugbar.DebugBar.registerContributor(DebugBar.java:140) at org.apache.wicket.devutils.debugbar.DebugBar.registerStandardContributors(DebugBar.java:152) at org.apache.wicket.devutils.debugbar.DebugBar.&lt;clinit&gt;(DebugBar.java:65) ... 109 more,0,0
Link: PopupSettings - overriding getPopupSettings has no effect,The popup settings are ONLY considered for the resulting JavaScript code when you use the setter setPopupSettings (which is final).The method getPopupSettings is NOT final but it has no effect - internally Link always uses the private field - not the getter.Something like the following code works fine - but is not really clear / intuitive:public class TestLink extends Link { public TestLink(String id) { super(id); setPopupSettings(getPopupSettings()); } public PopupSettings getPopupSettings() { return new PopupSettings(PopupSettings.RESIZABLE).setWindowName('test'); }}I don't know which is the prefered way of Wicket core developers but I can think of two ways to improve on this: Make getPopupSettings final (less work) Use getPopupSettings() within Link instead of the field,0,0
Update hungarian localization,The hungarian translation has some encoding-problem for a long time and there are missing keys from it (like pagingnavigator). I will attach soon a better  fixed localization file. Please accept it in the next release.,0,0
CLONE -Make LoadableDetachableModel writable,To keep it compatible with current usage:public final void setObject(Object obj) { reload(obj); tempModelObject = obj;}protected void reload(Object obj) { throw new OperationNotSupportedException('Read only model');}Subclasses can now implement their own write logic. This is necessary for for instance stand alone dropdownchoice components that need to store their selection.e.g.MyPage { IModel&lt;SchoolYear&gt; selectedSchoolYear; public MyPage() { selectedSchoolYear = new HibernateModel&lt;SchoolYear&gt;(SchoolYear.current()); new SchoolYearDropDownChoice(this  'schoolyear'  selectedSchoolYear); }}If HibernateModel is not writeable then the selected SchoolYear instance would end up in the session.,0,0
IModel parameters of StringResourceModel not getting detached,StringResourceModel supports IModels in the 'parameters' Object[] thatare properly handled in StringResourceModel#getString  meaning theycould get attached because of StringResourceModel. StringResourceModel should probably check the 'parameters' array for IModels(or even IDetachables?) and detach them from StringResourceModel#onDetach,0,0
OutOfMemoryError occur for memory leak on FeedbackPanel & FeedbackMessages,When I uses component.info() method to display a message  my program stopped by OutOfMemoryError or StackOverflowError. I create a sample application to show this problem. Open attached tar.gz file(including a maven project) and run. check 'submit continuously' checkbox and click 'register' button. The program will display current session size continuously on console. the size will be increased  and finally program will be stopped with OutOfMemoryError or StackOverflowError. But if you changes only one line  this program will not be stopped. --original code--  private SubmitLink insertLink = new SubmitLink('insertLink') {  public void onSubmit() {  info('message');  setResponsePage(new Test(testFormBean));  Session session = Session.get();  long size = session.getSizeInBytes();  LOGGER.info('SESSION SIZE: {}'  size);  }  }; --------------------- --changed---------  private SubmitLink insertLink = new SubmitLink('insertLink') {  public void onSubmit() {  Session.get().info('message'); //CHANGED!!!  setResponsePage(new Test(testFormBean));  Session session = Session.get();  long size = session.getSizeInBytes();  LOGGER.info('SESSION SIZE: {}'  size);  }  }; --------------------  so component's info() method is the reason of this problem. If you commented out 'info()' line  this program never crashed. We found out the reason of this problem in a static inner class 'MessageListView' in FeedbackPanel. MessageListView uses annonimous inner class of Model (named ad 'replacementModel')  and it imports a FeedbackMessage object from enclosing instance. FeedbackPanel holds this annonimous inner class and the annonimous inner class holds a FeedbackMessage. When we use component's info() method  the component is assigned into FeedbackMessage object as a 'reporter' object. so  all of FeedbackMessage objects have a component instance inside of himself as 'reporter' (only one exception: if you use Session.get().info() method instead of component's info() method  'reporter' object become null). All already-displayed FeedbackMessages will be purged at 'detach' time from Session object. But FeedbackPanel holds FeedbackMessages. So when page is serialized  all FeedbackMessages  all 'reporter' components is serialized. This is the reason of this problem. We can solve this problem if we do not hold FeedbackMessage instance in the annnonimous inner class.change the code of FeedbackPanel as bellow (this code is based on FeedbackPanel class of wicket 1.4-rc7  line 70):---- original code -----@Overrideprotected void populateItem(final ListItem&lt;FeedbackMessage&gt; listItem){ final FeedbackMessage message = listItem.getModelObject(); message.markRendered(); final IModel&lt;String&gt; replacementModel = new Model&lt;String&gt;() { private static final long serialVersionUID = 1L; /** Returns feedbackPanel + the message level  eg 'feedbackPanelERROR'. This is used as the class of the li / span elements.  @see org.apache.wicket.model.IModel#getObject() */ @Override public String getObject() { return getCSSClass(message); } }; final Component label = newMessageDisplayComponent('message'  message); final AttributeModifier levelModifier = new AttributeModifier('class'  replacementModel); label.add(levelModifier); listItem.add(levelModifier); listItem.add(label);}------------------------ fixed code ----@Overrideprotected void populateItem(final ListItem&lt;FeedbackMessage&gt; listItem){ //FIXED message must not be 'final'. It must not be used in inner class. //If message could be used in inner class  the instance could be hold by //inner class tacitly and never cleared at detach time and will be serialized. FeedbackMessage message = listItem.getModelObject(); message.markRendered(); final IModel&lt;String&gt; replacementModel = new Model&lt;String&gt;() { private static final long serialVersionUID = 1L; /** Returns feedbackPanel + the message level  eg 'feedbackPanelERROR'. This is used as the class of the li / span elements.  @see org.apache.wicket.model.IModel#getObject() */ @Override public String getObject() Unknown macro: { //FIXED -- retrieve a FeedbackMessage object from ListView&#39;s Model. // never hold it. @SuppressWarnings(&quot;unchecked&quot;) List&lt;FeedbackMessage&gt; list = (List&lt;FeedbackMessage&gt;) MessageListView.this.getDefaultModelObject(); FeedbackMessage feedbackMessage = null; int index = listItem.getIndex(); if(index &lt; list.size()) { feedbackMessage = list.get(index); } if(feedbackMessage == null) return &quot;&quot;; return getCSSClass(feedbackMessage); //UNTIL HERE }  }; final Component label = newMessageDisplayComponent('message'  message); final AttributeModifier levelModifier = new AttributeModifier('class'  replacementModel); label.add(levelModifier); listItem.add(levelModifier); listItem.add(label);}--------------------,0,1
JavaDoc: Some JavDoc examples still refer to WicketServlet,Some JavDoc examples still refer to WicketServlet  instead they should use WicketFilter.Most important candidate might be ./wicket-spring/src/main/java/org/apache/wicket/spring/SpringWebApplicationFactory.javagrep . -R --include '*.java' -e 'WicketServlet'indicates that others might be affected too.,0,1
Tag ''has a mismatched close tag at '',in the wicket-auth-roles-1.4-rc7.jar!/org/apache/wicket/authentication/panel/SignInPanel_ja.html tag '&lt;BODY&gt;'has a mismatched close tag at '&lt;/SPAN&gt;',0,0
MarkupComponentBorder fails to close stream (?),MarkupComponentBorder  in findMarkupStream  creates a MarkupResourceStream but doesn't close it.Shouldn't this stream be closed after the call to Application.get().getMarkupSettings().getMarkupParserFactory().newMarkupParser(markupResourceStream).parse(); ?,0,0
KittenCaptcha example broken,KittenCaptcha example brokenNullpointer thrownERROR - RequestCycle - java.lang.NullPointerException at org.apache.wicket.extensions.captcha.kittens.KittenCaptchaPanel$2.onEvent(KittenCaptchaPanel.java:183) at org.apache.wicket.ajax.AjaxEventBehavior.respond(AjaxEventBehavior.java:177) at org.apache.wicket.ajax.AbstractDefaultAjaxBehavior.onRequest(AbstractDefaultAjaxBehavior.java:299)Following diff does the trick. But maybe this is platform dependent as I currently can test undre linux environment.Index: src/main/java/org/apache/wicket/extensions/captcha/kittens/KittenCaptchaPanel.java===================================================================&#8212; src/main/java/org/apache/wicket/extensions/captcha/kittens/KittenCaptchaPanel.java (revision 796623)+++ src/main/java/org/apache/wicket/extensions/captcha/kittens/KittenCaptchaPanel.java (working copy)@@ -170 7 +170 7 @@ // ajax request passing in mouse co-ordinates return generateCallbackScript('showLoadingIndicator(); wicketAjaxGet('' + getCallbackUrl(onlyTargetActivePage) + '&amp;x=' + getEventX(this  event) + '&amp;y=' + getEventY(this  event)');+ '&amp;x=' + getEventX(this  event) + '&amp;y=' + getEventY(this  event)'); } @SuppressWarnings('unchecked'),0,0
DateField.newDateTextField's parameters should be generified,protected DateTextField newDateTextField(String id  PropertyModel&lt;Date&gt; dateFieldModel) { return DateTextField.forShortStyle(id  dateFieldModel); },0,0
AjaxFormSubmitBehavior cannot be applied to Form,I need to apply the above behavior directly to a Form rather than to one of its children. This is so I can listen to the 'onsubmit' event of the form itself rather than attach it to a button.This patch allows you to do thisIndex: AjaxFormSubmitBehavior.java===================================================================&#8212; AjaxFormSubmitBehavior.java (revision 797714)+++ AjaxFormSubmitBehavior.java (working copy)@@ -86 13 +86 20 @@ { // try to find form in the hierarchy of owning component Component component = getComponent(); __form = component.findParent(Form.class); if (__form == null)+ if (component instanceof Form)+ {+ __form = (Form&lt;?&gt;)component;+ }+ else { throw new IllegalStateException( 'form was not specified in the constructor and cannot ' + 'be found in the hierarchy of the component this behavior ' + 'is attached to');+ __form = component.findParent(Form.class);+ if (__form == null)+ {+ throw new IllegalStateException(+ 'form was not specified in the constructor and cannot '+ + 'be found in the hierarchy of the component this behavior '+ + 'is attached to');+ } } } return __form;,0,0
Quickstart for 1.4 uses 1.3 dtd in HomePage.html (with patch),The generated HomePage.html contains the following header:&lt;html xmlns:wicket='http://wicket.apache.org/dtds.data/wicket-xhtml1.3-strict.dtd' &gt;That should be:&lt;html xmlns:wicket='http://wicket.apache.org/dtds.data/wicket-xhtml1.4-strict.dtd' &gt;,0,0
Widen type-constraint on TextTemplate.interpolate(Map variables),The parametrization of interpolate method of TextTemplate and implementors should imho be opened toMap&lt;String ?&gt; in order to be able to use it with Map&lt;String String&gt; or any other value-type.The current parametrization makes it quite clumsy to use.,0,1
DefaultCssAutocompleteTextField should be renamed,DefaultCssAutocompleteTextField should be renamed to DefaultCssAutoCompleteTextField to match the naming of its superclass AutoCompleteTextField.,0,0
DefaultDataTable hides NavigationToolbar once and forever,DefaultDataTable does not show NavigationToolbar if initial data does not require more than one page.DefaultDataTable hides and does not show NavigationToolbar again if data one time does not require more than one page .,0,0
Not all 'domready' events are called when two wicket-event.js files are added to the page,When more than one wicket portlets run in a portal a page could get more than one wicket-event.js entry and more than one Wicket.Event.add(window  'domready'  function() {...});. In this case not all of these 'domready' functions are executed. It happens because Wicket.Event object is created every time browser reaches wicket-event.js entry declaration which in turn causes Wicket.Event.fireDomReadyHandlers function to execute not all functions (this function is called only once when the global variable 'window.loaded' is set to false).Attached patch fixes the problem by ensuring that Wicket.Event object is created only once.,0,0
OnChangeAjaxBehavior + DatePicker do not work together,DatePicker fails to notify component update when OnChangeAjaxBehavior is used on the target input.It works well with AjaxFormComponentUpdatingBehavior.The root cause seems to be in the Wicket.ChangeHandler added by the OnChangeAjaxBehavior  which hides user handler while the DatePicker calls onchange handler directly (wicket-date.js:186):if (field.onchange != null &amp;&amp; typeof(field.onchange) != 'undefined') field.onchange(); Possible fix could be dispatching onchange Event instead of direct handler invocation. Yet I don't know what is purpose of Wicket.ChangeHandler here...,0,0
'Couldn't resolve model type of Model' for PasswordTextField,When using PasswordTextField with CompoundPropertyModel mapped with the Map&lt;String  String&gt; I get the following warning:Couldn't resolve model type of Model:classname=&#91;org.apache.wicket.model.CompoundPropertyModel$AttachedCompoundPropertyModel&#93;:nestedModel=[Model:classname=&#91;org.apache.wicket.model.CompoundPropertyModel&#93;:nestedModel=&#91;org.apache.wicket.util.collections.MiniMap@115126e&#93;] for [MarkupContainer &#91;Component id = password&#93;]  please set the type yourself.This message is fixed if to set password field type manually: new PasswordTextField('').setType(String.class)I propose PasswordTextField to use String.class type by default,0,0
Ajax support for multipart forms broken in a nested form,Ajax support for multipart forms broken in case of using a nested multipart form. The file does not get uploaded  uploadField.getFileUpload() returns null.,0,0
RequestCycle urlFor ignores existing parameters when appending provided params,Link with listener and non empty parameters  built in the following fashion: getRequestCycle().urlFor(this  ILinkListener.INTERFACE  parameters) isn't formed correctly.at RequestCycle 947:AppendingStringBuffer buff = new AppendingStringBuffer(url);WebRequestEncoder encoder = new WebRequestEncoder(buff);This WebRequestEncoder doesn't check  if the parameters are already present in the url provided.In my case  the url from CharSequence url = encodeUrlFor(target); is already similar to: ?wicket:interface=:2:admin:container:tabbedPanel:panel:apartments:0:apartmentAddressEditLink:1:ILinkListener::What WebRequestEncoder does when appending parameters provided explicitly - it simply appends '?' mark and then the parameters list.So resulting url is incorrect and doesn't work:?wicket:interface=:2:admin:container:tabbedPanel:panel:apartments:0:apartmentAddressEditLink:1:ILinkListener::?height=300&amp;width=300(notice leading ?height=300&amp;width=300).,0,0
Improve MixedParamUrlCodingStrategy  introduce Hybrid,The MixedParamUrlCodingStrategy can be improved.The current form has the following shortcomings: it just fails when something is added to the URL  solution: add the option to ignore the added parts (in fact I made this the default) when something is added to the URL  the message is not very clear  solution: rewrite message and add more information it does not accept non-String parameter values  solution: use String.valueOf(paramValue)In addition the patch adds a Hybrid variant.,0,0
Internal Spring beans should be ignored,When looking up Spring beans by type (to inject into @SpringBean fields)  the injector should ignore internal beans  like the ones generated by the &lt;aop:scoped-proxy/&gt; element at the configuration. In this case  the generated name always starts with 'scopedTarget.'.Other cases can be identified by the method 'BeanFactoryUtils.isFactoryDereference(name)'.These beans are created by the container to be used internally  so  shouldn't be considered for injection. The problem is  they usually have a mirror bean (which is the really injected by the container)  so  when Wicket's injector tries to find it  it doesn't find unique beans of the type  forcing us to declare the bean name explicitly.,0,0
AjaxEditableLabel: newPanel - use Component instead of WebComponent for easier subclassing,With the current implementation  subclasses are artifically limited to simple WebComponents.,0,0
Form.findForm(Component c) bug. When form is part of Border and form component like TextField is inside another Border   component cannot resolve its form.,I have Border class which renders Form and some other elements for feedback messages. Class included in attachments. Into this border i am putting form component which is Panel and in that Panel is another Border. Borders form has body container added.When i submit form i get error 'Could not find Form parent for ...'It's because Form.findForm method search for Form.class just in nearest component Border and not in all Borders upper in hierarchy.,0,0
IE8: be more verbose if ajax refresh fails,sometimes we write wrong html code  for example &lt;link rel='xxx'&gt;  instead of &lt;link rel='xxx'/&gt;if parts of the page are refreshed via Ajax on IE  the following code is called: wicket-ajax.js if (window.ActiveXObject) { xmldoc = new ActiveXObject('Microsoft.XMLDOM'); xmldoc.loadXML(text); } else {if loadXML fails there is no direct feedback  you only get a cryptic error message:Wicket.Ajax.Call.failure: Error while parsing response: Object required.if would be great if you write some logs in case of load error:if(!xmldoc.loadXML(text)) { this.failure('error while parsing text: '+text);},0,0
javadoc the CryptedUrlWebRequestCodingStrategy needs to be update/corrected to reflect the usage of session-id for encryption and hence URLs which were bookmarkable before will NOT remain bookmarkable.,The javadoc for CryptedUrlWebRequestCodingStrategy needs to be updated/corrected to reflect the usage of sessionId for encryption  which also entails that the urls which were bookmarkable before will NOT be remain bookmarkable any more.The javadoc currently state 'Because the algorithm is reversible  URLs which were bookmarkable before will remain bookmarkable. ' which is not true anymore.,0,0
Allow using a different FileItemFactory by extracting a method in MultipartServletWebRequest class,Hi there:In MultipartServletWebRequest constructor we have:...(line 93) DiskFileItemFactory factory = new DiskFileItemFactory();...which inhibits anyone from reusing MultipartServletWebRequest with a different factory. The only solution is generate a new class that is a copy of this one  with that line changed.The suggestion is to extract this code into a protected method  so we could just extend this class when there's a need to use a different factory (as in GAE applications). A diff file is added.Thanks in advance Esteban,0,0
AjaxEditableChoiceLabel does not detach choices model,The component org.apache.wicket.extensions.ajax.markup.html.AjaxEditableChoiceLabel never detaches its choices list model  thus keeping this model attached indefinitely. It should detach when the component's own detach method is called  like eg. this:@Overridepublic void detachModels() { choices.detach(); super.detachModels();},0,0
Button.onSubmit javadoc is misleading,The javadoc in org.apache.wicket.markup.html.form.Button.onSubmit() is misleading. It says 'Override this method to provide special submit handling in a multi-button form. It is called whenever the user clicks this particular button.' In reality  the method doesn't get called if the form's validation fails. Not sure if there are other cases as well when the method doesn't get called.,0,0
Regression: 'Could not find child with id:  in the wicket:enclosure' for non-component tag,Attached testcase passes with wicket-1.4.1 but fails with 1.4.2 saying:org.apache.wicket.WicketRuntimeException: Could not find child with id: radio in the wicket:enclosure at org.apache.wicket.markup.html.internal.Enclosure.checkChildComponent(Enclosure.java:210) at org.apache.wicket.markup.html.internal.Enclosure.ensureAllChildrenPresent(Enclosure.java:249) at org.apache.wicket.markup.html.internal.Enclosure.onComponentTagBody(Enclosure.java:169) at org.apache.wicket.Component.renderComponent(Component.java:2626) at org.apache.wicket.MarkupContainer.onRender(MarkupContainer.java:1512) at org.apache.wicket.Component.render(Component.java:2457) at org.apache.wicket.MarkupContainer.autoAdd(MarkupContainer.java:229) at org.apache.wicket.markup.resolver.EnclosureResolver.resolve(EnclosureResolver.java:61) at org.apache.wicket.markup.resolver.ComponentResolvers.resolve(ComponentResolvers.java:81) at org.apache.wicket.MarkupContainer.renderNext(MarkupContainer.java:1418) at org.apache.wicket.MarkupContainer.renderComponentTagBody(MarkupContainer.java:1577) at org.apache.wicket.MarkupContainer.onComponentTagBody(MarkupContainer.java:1501) at org.apache.wicket.Component.renderComponent(Component.java:2626) at org.apache.wicket.MarkupContainer.onRender(MarkupContainer.java:1512) at org.apache.wicket.Component.render(Component.java:2457) at org.apache.wicket.MarkupContainer.renderNext(MarkupContainer.java:1414) at org.apache.wicket.MarkupContainer.renderAll(MarkupContainer.java:1528) at org.apache.wicket.Page.onRender(Page.java:1545) at org.apache.wicket.Component.render(Component.java:2457) at org.apache.wicket.Page.renderPage(Page.java:914) at org.apache.wicket.request.target.component.BookmarkablePageRequestTarget.respond(BookmarkablePageRequestTarget.java:262) at org.apache.wicket.request.AbstractRequestCycleProcessor.respond(AbstractRequestCycleProcessor.java:105) at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1258) at org.apache.wicket.RequestCycle.step(RequestCycle.java:1329) at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1428) at org.apache.wicket.RequestCycle.request(RequestCycle.java:594) at org.apache.wicket.protocol.http.MockWebApplication.processRequestCycle(MockWebApplication.java:478) at org.apache.wicket.protocol.http.MockWebApplication.processRequestCycle(MockWebApplication.java:390) at org.apache.wicket.util.tester.BaseWicketTester.startPage(BaseWicketTester.java:300) at org.apache.wicket.EnclosurePageTest.testRender(EnclosurePageTest.java:23) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at junit.framework.TestCase.runTest(TestCase.java:154) at junit.framework.TestCase.runBare(TestCase.java:127) at junit.framework.TestResult$1.protect(TestResult.java:106) at junit.framework.TestResult.runProtected(TestResult.java:124) at junit.framework.TestResult.run(TestResult.java:109) at junit.framework.TestCase.run(TestCase.java:118) at junit.framework.TestSuite.runTest(TestSuite.java:208) at junit.framework.TestSuite.run(TestSuite.java:203) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.maven.surefire.junit.JUnitTestSet.execute(JUnitTestSet.java:213) at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.executeTestSet(AbstractDirectoryTestSuite.java:140) at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.execute(AbstractDirectoryTestSuite.java:127) at org.apache.maven.surefire.Surefire.run(Surefire.java:177) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) at java.lang.reflect.Method.invoke(Method.java:597) at org.apache.maven.surefire.booter.SurefireBooter.runSuitesInProcess(SurefireBooter.java:345) at org.apache.maven.surefire.booter.SurefireBooter.main(SurefireBooter.java:1009),0,0
NullPointerException in BehaviorRequestTarget.processEvents(BehaviorRequestTarget.java:96),When had the following exception occurring in a production system  while running :java.lang.NullPointerException at org.apache.wicket.request.target.component.listener.BehaviorRequestTarget.processEvents(BehaviorRequestTarget.java:96) at org.apache.wicket.request.AbstractRequestCycleProcessor.processEvents(AbstractRequestCycleProcessor.java:92) at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1241) at org.apache.wicket.RequestCycle.step(RequestCycle.java:1320) at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1419) at org.apache.wicket.RequestCycle.request(RequestCycle.java:545) at org.apache.wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:456) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:289) at com.caucho.server.dispatch.FilterFilterChain.doFilter(FilterFilterChain.java:87) at org.codesmell.jpsak.servlet.EntityManagerFilter.doFilter(EntityManagerFilter.java:40) at com.caucho.server.dispatch.FilterFilterChain.doFilter(FilterFilterChain.java:87) at com.softculture.services.errornotification.wicket.ENFilter.doFilter(ENFilter.java:45) at com.caucho.server.dispatch.FilterFilterChain.doFilter(FilterFilterChain.java:87) at com.caucho.server.webapp.WebAppFilterChain.doFilter(WebAppFilterChain.java:187) at com.caucho.server.dispatch.ServletInvocation.service(ServletInvocation.java:266) at com.caucho.server.hmux.HmuxRequest.handleRequest(HmuxRequest.java:452) at com.caucho.server.port.TcpConnection.handleConnection(TcpConnection.java:563) at com.caucho.server.port.TcpConnection$KeepaliveTask.run(TcpConnection.java:1177) at com.caucho.util.ThreadPool$Item.runTasks(ThreadPool.java:759) at com.caucho.util.ThreadPool$Item.run(ThreadPool.java:681) at java.lang.Thread.run(Thread.java:619)At least checking for null when doing 'if (behaviors.size() &gt; idAsInt)' in BehaviorRequestTarget would be good  maybe more is to be done .,0,0
Upgrade to SLF4J version 1.5.8,Please consider upgrading to SLF4J version 1.5.8 which should--+ be 100% compatible with SLF4J version 1.4.2 that you are currently using (in wicket 1.4.2). Compared to SLF4J version 1.4.2  the latest version  among many small improvements  supports serialization which should be helpful when a logger field is used within a wicket model.--+ I am being conservative when I say 'should'  'is' would have been more accurate.,0,0
Use of Object instead of generic T in StringAutoCompleteRenderer,The method getTextValue is defined in org.apache.wicket.extensions.ajax.markup.html.autocomplete.AbstractAutoCompleteRenderer as: protected abstract String getTextValue(T object);...but overridden in StringAutoCompleteRenderer as: // @see AbstractAutoCompleteTextRenderer#getTextValue(Object) protected String getTextValue(Object object) { return object.toString(); }The Javadoc implies that the intention is to override the superclass' method. I think the parameter type should be changed from Object to T.I recommend that when using something like T  to name the parameter 'value' rather than 'object'. 'object' is misleading  as  by convention  it implies that its data type is Object.,0,0
Easy fix suggestion: In BaseWicketTester 'IFormSubmitting' component should be the submitting component  not just a 'Button',Line 'if (!((formComponent instanceof Button) &amp;&amp; (component instanceof Button)) ||'should be changed intoLine 'if (!((formComponent instanceof IFormSubmittingComponent) &amp;&amp; (component instanceof IFormSubmittingComponent)) ||'See attached quickstart.,0,0
Class not found when using OSGI class loader,I am presently using Guice and OSGi. Our OSGi platform is used as a plugin platform for our web application. We load the OSGi framework and load it into Guice as a service provider. The plugins can be used to return panel or other wicket components that are then used in the pages.When one of the plugins components have a Guice injection  there is a class not found problem that is seen when trying to use injected stuff : org.apache.wicket.guice.GuiceProxyTargetLocator.locateProxyTarget(GuiceProxyTargetLocator.java:79)This class not found is because the Guice injector is trying to access the class directly by making a Class.forName. Since using an OSGi framework  the classloader is not capable of returning the class correctly.To solve this issue  the wicket-guice integration should use the wicket Classes.resolveClass static method that is using a class resolver that can be changed and check for class in other class loader.,0,0
Behavior for accepted locales should fit the HTTP Specification,I try to filter the locales assignable to session on newSession(request  response) in application. The testcase is simple:If application supports locale accepted by user client (http-header 'accepted-language') then i assign it to session  otherwisei use the application default.But the behavior differs to production system. MockHttpRequest.getLocales returns only one locale. But the implementationused in production system (org.apache.catalina.connector.RequestFacade) provides all locales contained in header.So my testcase is working in production but not in test.As an extension to this it COULD be a simplification if application could support query to application supported languages.Normally this is a decision which is made at design time. So if you develop the application you know the supported languages.So it would be great if there would be a place where i can query these easily (extension to settings?).We had two discussions on that in mailing-list:http://www.nabble.com/Howto-accept-other-then-first-locale-in-HTTP-header-%22Accept-Language%22--to25922534.htmlhttp://www.nabble.com/Wickettester-change-locale-of-request-to25907133.htmlSpecification is herehttp://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.4,0,0
Improve consistency of ParseException error messages,Append the line and column number to all ParseException,0,0
MetaDataKey does not meet hashCode() contract,The class MetaDataKey overrides equals() method but uses Object.hashCode(). So FindBugs warns on any use of this class in our Wicket application.,0,0
WebRequestCodingStrategy assumes that a shared resource URL should always be relative to the Wicket handler,We use an absolute URL for the shared resources and as long as the page is directly under the Servlet context we have no problems  but for pages that have additional paths  then it is converted into a bad relative URL. For Example:/cjs/app/test.page - This page's shared resource URLs are not modified  so http://localhost:8080/crtv/css/cjs-3.3.1B.css is correct/cjs/app/orders/contentbuilder.page - This page's shared resource URLs are all modified causing them to be ../http://localhost:8080/crtv/css/cjs-3.3.1B.css  which is bad; and of course with JavaScript it causes us a lot of problemsI propose a simple fix in method: public final CharSequence encode(final RequestCycle requestCycle  final IRequestTarget requestTarget)Change the following line from:if (!sharedResourceURL &amp;&amp; portletRequest)To:if (url.toString().startsWith('http://') || url.toString().startsWith('https://') || (!sharedResourceURL &amp;&amp; portletRequest))Thanks!,0,0
Unnecessary method calls in IDataProvider,Referring to the post on the mailinglist (http://old.nabble.com/Unnecessary-method-calls-in-IDataProvider--ts26266771.html)  here's a quick summary of the problem:If the size() method of an IDataProvider returns zero  the iterator(int int) method should not be called. Calling this method with value zero as second parameter (== count) always results in returning an empty iterator. Therefore a lot of unnecessary method calls (and thus a lot of unnecessary database hits) could be saved if an empty iterator would be used by the DataView whenever size() returns an int &lt;= 0.Please find a project attached with a junit test that illustrates the problem. I tested it with all major releases from 1.4.3. down to 1.3.0. with the same result.,0,1
Inheritance layout excludes XML header from output,When using inheritance layout  if the superclass (Layout class) has an ?xml header at the top  it's excluded from the rendering of subclasses  if they have an associated html file. If the subclass has no .html file associated with it  the ?xml header is preserved in the rendering output.To reproduce: Create a SuperPage class extending WebPage. At the top of SuperPage.html  put '&lt;?xml version='1.0' encoding='utf-8'?&gt;' . Create two subclasses of SuperPage  one with an HTML file and one without. View the sub pages. Notice when the one with an HTML file is rendered  the xml header is excluded.Expected: The ?xml header should always be preserved in the rendered output as it's vital to the layout.,0,0
o.a.wicket.ng.** Resource related classes don't take 'variation' into account,The Resource and ResourceReference related classes in o.a.wicket.ng package don't take into account the 'variation'. Several weeks ago Juergen splitted 'style' and 'variation' in 1.5-SNAPSHOT. It seems Matej have finished the new classes before that split.I'm attaching a patch which includes 'variation' into account.,0,0
RepeatingView's Javadoc to include newChildId() and add(),A minor improvement of the Javadoc to  include newChildId() call  since most people will be using that rather than manual id input add(view) call so that its clear to novice that the components needs to be added typo: missing spaceSee the attached patch.,0,0
Javadoc of Component#setOutputMarkupPlaceholderTag is wrong,The javadoc of Component#setOutputMarkupPlaceholderTag uses the term 'componentid' where it should use 'markupid'.Please update the javadoc from: The tag is of form: &lt;componenttag style='display:none;' id='componentid'/&gt;.to The tag is of form: &lt;componenttag style='display:none;' id='markupid'/&gt;.,0,0
ExternalLink to take IModel instead of IModel for label,I just noticed that this constructor  public ExternalLink(final String id  final IModel&lt;String&gt; href  final IModel&lt;String&gt;* label) takes IModel&lt;String&gt; for label. This is somewhat limiting since the model could hold a number or a date for example. Actually passing a raw IModel with any object inside works just fine. It would be more appropriate if this constructor takes IModel&lt;?&gt; for the label as done in Label constructor. Unfortunately ExternalLink offers a public method getLabel() that returns the label as IModel&lt;String&gt;. So it seems changing it would break compatibility.,0,0
Allow subclasses of AuthenticatedWebSession to set 'signedIn' field,My app implements 'remember me' service by setting cookie in authenticate method of custom session that subclasses AuthenticatedWebSession.In order to automatically login user if cookie present  i need to set 'signedIn' field to true when session is created  however it isn't possible since 'signedIn' is private and no way to set it is available.,0,0
Ajax multipart fails for inner forms added via ajax,When using a file upload in a nested form (e.g. as required when using modal windows)  the file upload will always return null. This bug seems related to WICKET-2433 which was supposed to be fixed in wicket 1.4.2  but in wicket 1.4.3 this effect was observed by several people (see mailing list).,0,0
Some components still escape non-ASCII symbols by default,With fix for WICKET-1054 Wicket (almost) stopped escaping non-ASCII symbols by default  it calls Strings.escapeMarkup(String) or Strings.escapeMarkup(String  false  false).However  there are still some places that also call Strings.escapeMarkup with different args.I used 'Strings.escapeMarkup&#40;.*  false  true&#41;' regex to find them:AbstractChoice.escapeOptionHtml CheckBoxMultipleChoice.onComponentTagBody (the reason i started to dig into this issue)RadioChoice.onComponentTagBodyThey should either call String.escapeMarkup(String) or even use Component.getDefaultModelObjectAsString,0,0
EnumChoiceRenderer misbehaves with anonymous enum classes,Please find attached testcase reproducing the problem.Proper fix is to doreturn object.getDeclaringClass().getSimpleName() + '.' + object.name()instead ofreturn object.getClass().getSimpleName() + '.' + object.name()in EnumChoiceRenderer.resourceKey,0,0
DataTable generates two,The tables generated by DataTable component in the current version of Wicket (1.4.3) do not contain &lt;thead&gt; in the output HTML.It was working correctly in wicket 1.4.0 but there were some changes to fix other issues - see WICKET-2436To replicate - launch the wicket-examples-1.4.3.war and look at the DataTable example:http://localhost:8081/wicket-examples-1.4.3/repeater/?wicket:bookmarkablePage=:org.apache.wicket.examples.repeater.DataTablePageIf you check the HTML source you will see it does not contain thead tag:{html}&lt;table class='dataview' cellspacing='0'&gt; &lt;tr class='navigation'&gt;{html}When you look at http://www.wicket-library.com/wicket-examples/repeater/?wicket:bookmarkablePage=:org.apache.wicket.examples.repeater.DataTablePageit shows:{html}&lt;table class='dataview' cellspacing='0'&gt;&lt;thead&gt; &lt;tr class='navigation'&gt;{html}Must be a previous version?,0,0
Ajax buttons inside ModalWindows don't submit properly,I have a ModalWindow that contains an IndicatingAjaxButton. When I click the button  I get a big Java error complaining that the form submit wasn't multipart.Digging into the javascript in wicket-ajax.js  I found this from line 1102 in the method handleMultipartmultipart=multipart||form.enctype=='multipart/form-data';if (multipart==false) { // nothing to handle return false; }When this executed  multipart was false  and enctype was '' and therefore the submit aborted. This may be the cause.Here's the Java stacktracejava.lang.IllegalStateException: ServletRequest does not contain multipart content at org.apache.wicket.protocol.http.servlet.MultipartServletWebRequest.&lt;init&gt;(MultipartServletWebRequest.java:113) at org.apache.wicket.protocol.http.servlet.MultipartServletWebRequest.&lt;init&gt;(MultipartServletWebRequest.java:83) at org.apache.wicket.extensions.ajax.markup.html.form.upload.MultipartRequest.&lt;init&gt;(MultipartRequest.java:41) at org.apache.wicket.extensions.ajax.markup.html.form.upload.UploadWebRequest.newMultipartWebRequest(UploadWebRequest.java:66) at org.apache.wicket.markup.html.form.Form.handleMultiPart(Form.java:1651) at org.apache.wicket.markup.html.form.Form.onFormSubmitted(Form.java:850) at org.apache.wicket.ajax.form.AjaxFormSubmitBehavior.onEvent(AjaxFormSubmitBehavior.java:135) at org.apache.wicket.ajax.AjaxEventBehavior.respond(AjaxEventBehavior.java:177) at org.apache.wicket.ajax.AbstractDefaultAjaxBehavior.onRequest(AbstractDefaultAjaxBehavior.java:299) at org.apache.wicket.request.target.component.listener.BehaviorRequestTarget.processEvents(BehaviorRequestTarget.java:119) at org.apache.wicket.request.AbstractRequestCycleProcessor.processEvents(AbstractRequestCycleProcessor.java:92) at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1250) at org.apache.wicket.RequestCycle.step(RequestCycle.java:1329) at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1428) at org.apache.wicket.RequestCycle.request(RequestCycle.java:545) at org.apache.wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:479) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:312) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235),0,0
MockHttpServletResponse doesn't delete cookies,From Cookie.setMaxAge javadoc: @param expiry an integer specifying the maximum age of the cookie in seconds; if negative  means the cookie is not stored; if zero  deletes the cookieSo  if maxAge is zero  MockHttpServletResponse should remove cookie.,0,0
Sucessfull login on SignInPanel causes HomePage to become stateful,Quickstart attached.Steps to reproduce1. Unpack attached quickstart2. mvn jetty:run3. Open http://localhost:8080/login4. Enter any credentialsExpected: StatelessHomePage opensActual: exception happends  StatelessHomePage isn't statelessProblem analysis:1. SignInForm manually creates page.2. AbstractListenerInterfaceRequestTarget.onProcessEvents calls requestCycle.setRedirect(true)3. RequestCycle.urlFor(final Component component  final RequestListenerInterface listener  ValueMap params) calls page.setPageStateless(Boolean.FALSE)4. StatelessChecker isn't happy.Fix is simple - SignInForm.onSignInSucceeded should be:if (!continueToOriginalDestination()){ setResponsePage(getApplication().getHomePage());},1,0
Form.isMultipart() doesn't check FormComponent.isMultipart() on nested components,Form.isMultipart() doesn't check FormComponent.isMultipart() on nested components. This breaks submitting of stateless forms with multipart FormComponent but no explicit Form.setMultipart(true) call.,0,0
More pages missing xml prolog,InternalErrorPage.htmlExceptionErrorPage.html,0,0
Resources aren't gziped by default,Wicket gzips its resources by default. The only exception is wicket-datetime module.I think it is worth to use the same policy within wicket subprojects  especially taking into account that usage of DatePicker adds more than 100 Kb of uncompressed java scripts.Here are an headers of request and response:Request headers:Host 127.0.0.1:8080User-Agent Mozilla/5.0 (X11; U; Linux x86_64; ru; rv:1.9.1.6) Gecko/20091215 Ubuntu/9.10 (karmic) Firefox/3.5.6Accept /Accept-Language ru en-us;q=0.7 en;q=0.3Accept-Encoding gzip deflateAccept-Charset windows-1251 utf-8;q=0.7 *;q=0.7Keep-Alive 300Connection keep-aliveReferer http://127.0.0.1:8080/?t=1Response headers:Server Apache-Coyote/1.1Last-Modified Mon  21 Dec 2009 07:26:23 GMTExpires Mon  28 Dec 2009 13:42:11 GMTCache-Control max-age=3600Content-Type text/javascript;charset=UTF-8Content-Length 68179Date Mon  28 Dec 2009 12:42:10 GMT,0,1
Consistently create body for short tags.,When the Wicket HTML contains a tag such as &lt;a wicket:id='foo' /&gt; and the component bound to that tag uses replaceComponentTagBody to write a string to the tag's body  currently nothing happens.Either a text node should be added to the component tag and the body written to it;Or a warning/exception should occur if for some reason it is preferred to not let this method succeed when the component tag has no body yet.I don't see the use of the latter  so I recommend the former be implemented.For now it's just confusing and dangerous. If I give my HTML to a web designed and he changes a few empty HTML tags to short tags  I'll never be warned  but my output WILL be broken.,0,0
Make GoAndClearFilter.defaultClearModel and GoFilter.defaultGoModel internationalizable,Please  change GoAndClearFilter.defaultClearModel and GoFilter.defaultGoModel to ResourceModel with default string (same way as it is done in NoRecordsToolbar.DEFAULT_MESSAGE_MODEL).That'll allow translating button labels without the need to pass custom models.,0,0
WicketTester javadocs are referring in many places to a component's path but it's not documented anywhere,In many places in the WicketTester javadoc there are references to a path parameter explained in the following way: path - path to ComponentBut it's not explained anywhere what a path is  what does it contains  which separator is used there  what's the root of it and so on.Practically  it's impossible understanding how to use WicketTester from its javadoc because of that.,0,0
Ability to add CSS style to table body in DataTable,Being able to dynamically adjust css styles in the table body &lt;tbody&gt; of the DataTable is essential for a lot of advanced functionality e.g. adding a scrollbar to the contents of a table (which also eliminates the need for pagination and enhances usability for certain use cases). Sure one can override DataTable.html and hardcode a css style in the body element  but that is not enough. It must be dynamic and that requires the DataTable.java code to be changed. In the event that a client just provides a complete implementation of DataTable.java   the Toolbar classes can no longer be used since they reference the DataTable concrete class instead of an interface. I provide a patch to fix this issue and augment the DataTable with an extra method: void setTableBodyCss(String cssStyle);,0,0
Multipart forms fails on Chrome during Ajax submit,AjaxSubmitLink doesn't work with multipart forms on Google Chrome. AjaxSubmitLink calls wicketSubmitFormById in its onClick handler. When submiting multipart form this function creates hidden iframe and attaches handleMultipartComplete function to the onload event.handleMultipartComplete calls loadedCallback with envelope parameter. On Google Chrome envelope is undefined so loadedCallback craches ('Could not find root &lt;ajax-response&gt; element' is reported).I dig more and I found that handleMultipartComplete is called before server side callback completes  thats why 'envelope' is undefined....,0,0
Wickettester executeAllTimerBehaviors executes stopped behaviors too,When attempting to test a page with two ajax timer behaviours the first behaviour is triggered correctly. Then that behaviour is stopped (using the stop function) and a second behaviour is started. If executeAllTimerBehaviors is called again both behaviours are triggered even though one is stopped.It would be good if the code in BaseWicketTester.executeAllTimerBehaviors(MarkupContainer container) could validate if the behaviour is stopped or not before trying to execute it.,0,0
Enclosure causes Nullpointer exception,There is a bug in DirectChildTagIterator which causes a Nullpointer exception with the following stack trace:Caused by: java.lang.NullPointerException at org.apache.wicket.markup.html.internal.DirectChildTagIterator.findNext(DirectChildTagIterator.java:115) at org.apache.wicket.markup.html.internal.DirectChildTagIterator.next(DirectChildTagIterator.java:85) at org.apache.wicket.markup.html.internal.Enclosure.ensureAllChildrenPresent(Enclosure.java:236) at org.apache.wicket.markup.html.internal.Enclosure.onComponentTagBody(Enclosure.java:169) at org.apache.wicket.Component.renderComponent(Component.java:2619) ... 106 moreThe problem is in this code fragment:while (markupStream.hasMore()){ final MarkupElement cursor = markupStream.next(); if (cursor.closes(parent))markupStream.hasMore() checks if the currentindex is available to retrieve  while markupStream.next() doesn't retrieve the currentindex  but tries to retrieve the currentindex + 1 element. The right function to get the current element is markupStream.get(). To fix this  it should be like this:while (markupStream.hasMore()) { final MarkupElement cursor = markupStream.get(); markupStream.next(); if (cursor.closes(parent))The best fix is imo to make next() in MarkupStream a void method  which will prevent this in the future.,0,0
CryptedUrlWebRequestCodingStrategy fails in form with method='get',A form fails to submit when it has method='get' set in a wicket application which is using CryptedUrlWebRequestCodingStrategy.This happens because the form is constructed by wicket like this:&lt;form wicket:id='form2' method='get' id='form26' action=''&gt; &lt;div style='display:none'&gt; &lt;input type='hidden' name='form26_hf_0' id='form26_hf_0' /&gt; &lt;input type='hidden' name='x' value='vcH4-yiA7z1xdg19IZiML85IPOzB2CaoynoU6UPAVS9n2G2S2bamuw' /&gt; &lt;/div&gt; &lt;input type='text' wicket:id='text2' value='' name='text2'/&gt; &lt;input type='submit'/&gt;&lt;/form&gt;which can produce a query string in firefox like this:http://localhost:8080/crypt-bug/?form26_hf_0=&amp;x=YhsA9niKQasfMz8FBHuRP1lLAZXPdZy8s1XWlmYcu7WwhnsP*VusYw&amp;text2=test'x' is the second parameter in the query string  but CryptedUrlWebRequestCodingStrategy accesses this parameter as '?x=' where in this case it is '&amp;x='I am attaching the example quickstart app and a possible fix.,0,0
update PropertyColumn Javadoc,hi i find the documentation of the gentrified type T of the org.apache.wicket.extensions.markup.html.repeater.data.table.PropertyColumn a bit misleading. I suggest the javadoc should state 'The Model object type' for &lt;T&gt; instead of 'The type of the property'.thanks pete.,0,0
FormComponent.MessageSource.getMessage(String) and getValidatorKeyPrefix(),I tried to use the getValidatorKeyPrefix() feature to have a more suitable translation key for a RequiredTextField and the ﾂｫ required ﾂｻ message.But Wicket wasn't able to find my key : the debug log said that it couldn't find my key whereas it is well-formed (getValidatorKeyPrefix() + '.Required').So i debugged the getMessage(String) and I understood the problem. Arround the line 175 (in Wicket 1.4.5) we find :// If not found try a more general form &#91;prefix&#93;.&#91;key&#93;if (Strings.isEmpty(message)){resource = prefix(prefix  key);message = getString(localizer  key  formComponent);}The comment is good  but the code is wrong : the resource variable isn't used in the getString(...) ! (I think it's a kind of bad copy/paste from surrounding code)We should find :message = getString(localizer  resource  formComponent);I did it and it works.,0,0
Extract lazy AbstractListDataProvider out of ListDataProvider.,ListDataProvider is handy for quickly providing a List as source for a DataView; but it forces you to pass a list object during construction and doesn't allow you to provide a new list.That means it becomes hard to update the elements in the DataView when the page is (re)rendered. It might be useful to provide an abstract superclass to ListDataProvider which provides an abstract method for obtaining the list allowing the developer to lazy-load the data he wants to show; making sure to always load up-to-date data when the view is being rendered rather than data he passed in during construction which may have become outdated.,0,1
Panel throws MarkupException without passing MarkupStream,Panel throws a MarkupException without passing the MarkupStream while the MarkupStream is available. This makes debugging some errors harder. Code fragment: /**  @see org.apache.wicket.Component#onComponentTagBody(org.apache.wicket.markup.MarkupStream  org.apache.wicket.markup.ComponentTag) */ @Override protected void onComponentTagBody(final MarkupStream markupStream  final ComponentTag openTag) { // Render the associated markup renderAssociatedMarkup('panel'  'Markup for a panel component has to contain part '&lt;wicket:panel&gt;''); if (wasOpenCloseTag == false) { // Skip any raw markup in the body markupStream.skipRawMarkup(); if (markupStream.get().closes(openTag) == false) { throw new MarkupException('close tag not found for tag: ' + openTag.toString() + '. Component: ' + this.toString()); } } },0,0
AjaxFormChoiceComponentUpdatingBehavior cannot find the choice,AjaxFormChoiceComponentUpdatingBehavior tries to find the form components (the choices) by iterating the children elements with tagName 'input' and verifying some constraints. One of this constraints have been changed recently and now the children could not be found:Index: src/main/java/org/apache/wicket/ajax/form/AjaxFormChoiceComponentUpdatingBehavior.java===================================================================&#8212; src/main/java/org/apache/wicket/ajax/form/AjaxFormChoiceComponentUpdatingBehavior.java (revision 909983)+++ src/main/java/org/apache/wicket/ajax/form/AjaxFormChoiceComponentUpdatingBehavior.java (working copy)@@ -70 7 +70 7 @@ asb.append(' for (var i = 0 ; i &lt; inputNodes.length ; i ++) {/n'); asb.append(' var inputNode = inputNodes&#91;i&#93;;/n'); asb.append(' if (!inputNode.type) continue;/n'); asb.append(' if (!(inputNode.className.indexOf('wicket-'+markupId)===0)) continue;/n');+ asb.append(' if (!(inputNode.id.indexOf(markupId+'-')===0)) continue;/n'); asb.append(' var inputType = inputNode.type.toLowerCase();/n'); asb.append(' if (inputType == 'checkbox' || inputType == 'radio') {/n'); asb.append(' Wicket.Event.add(inputNode  'click'  callbackScript);/n');,0,0
AjaxPagingNavigator Link factories should return AbstractLink,AjaxPagingNavigator doesn't submit forms. The mailinglists instruct the user to override the Link factory classes in order to return SubmitLinks. However  both SubmitLink and AjaxSubmitLink do not inherit from Link. It is my opinion that AjaxPagingNavigator.new*Link() functions should return AbstractLink.I am currently forced to fork the majority of AjaxPagingNavigator inorder to create a 'Sub'class.,0,0
Javascript in Form.registerJavascriptNamespaces() fails in Firefox 3.5.8,The undefined comparisons fail for me with a message stating that the Wicket variable is undefined (which the code is actually meant to check),0,0
InjectorHolder.getInjector().inject(this) doesn't work with wicket-guice,Using Wicket-Guice integration for dependency injection does not provide the helper mechanism 'InjectorHolder.getInjector().inject(this)' for classes which do not extend o.a.w.Component.,0,0
DatePicker Calendar: wrong year format when 4 digits are used (yyyy)  e.g. 2010 --> 0010,I found that there is still a bug in Wicket 1.4.7 in case that the datePattern is 'dd/MM/yyyy'.For example  if you use the DatePicker and select a date such as23/02/2010 from the calendar GUI  the date selected in the DateTextField is '23/02/0010'.This is the example Java code: // define the date text field for the data decorrenza DateTextField dataDecorrenzaDaTextField = new DateTextField('dataDecorrenzaDa'  new PropertyModel(this.accordo  'dataDecorrenzaDa')  new PatternDateConverter('dd/MM/yyyy'  true) ); // add the graphical calendar date picker dataDecorrenzaDaTextField.add(new DatePicker() { @Override protected boolean enableMonthYearSelection() { // enable month/year selection return true; } // end enableMonthYearSelection } // end DatePicker );I found that the bug is still in the 'wicket-date.js'  line 137.The wrong code is:if(datePattern.match(/yy+/)) year = Wicket.DateTime.padDateFragment(year % 100);This line also makes the module 100 on the year  when the year pattern is 'yyyy'.The fixed code is:if(datePattern.match(/yyyy+/)) { year = year;} else if(datePattern.match(/yy+/)) year = Wicket.DateTime.padDateFragment(year % 100);,0,0
Enhancing RadioChoice input items with individual title and css class attributes,Wicket is a great framework based on an excellent idea. It is a joy to work with. There are several existing components and most of them are very usable and customizable as much as possible  however there are still a few places for improvement. One of those is org.apache.wicket.markup.html.form.RadioChoice  where it is currently not possible to set HTML title and class attributes for the individual input tags. This would be a great feature for some client-side javascript frameworks  and in my case the JQuery star-rating plugin is even hard to use without these. For this purpose I have created my own private alternative for this component  but it would be good to have it included in wicket  so that others can benefit too.See below the changes I have performed to enable this feature! Please note that all changes are made so that current behavior is not changed only new optional behavior is added.Changes in method onComponentTagBody(...) ... // Add radio tag String title = getTitle(index  choice); String cssClass = getCssClass(index  choice); buffer.append('&lt;input name=/'').append(getInputName()).append('/' type=/'radio/''); if (title != null) buffer.append(' title=/'').append(title).append('/''); if (cssClass != null) buffer.append(' class=/'').append(cssClass).append('/''); buffer.append((isSelected(choice  index  selected) ? ' checked=/'checked/'' : '')); buffer.append((enabled ? '' : ' disabled=/'disabled/'')); buffer.append(' value=/'').append(id).append('/' id=/'').append(idAttr) .append('/''); ...Added two new methods: /** Returns the title attribute to be output for the input tag with the given index and choice value. By default this returns null  and so the title attribute won't be set  but this can be overridden.  @param index @param choice @return title attribute to be used for the given input tag */ protected String getTitle(int index  T choice) { return null; } /** * Returns the CSS class attribute to be output for the input tag with the given index and * choice value. By default this returns null  and so the class attribute won't be set  but this * can be overridden. *  * @param index * @param choice * @return CSS class attribute to be used for the given input tag */ protected String getCssClass(int index  T choice) { return null; },0,0
Set Application ThreadLocal in WicketSessionFilter,WicketSessionFilter currently only sets the Session ThreadLocal  but not the Application ThreadLocale.This leads to WicketRuntimeException when trying to get the Application using Application#get or Session#getApplication.It would be handy if the Application ThreadLocal would also be set in WicketSessionFilter.see also:http://old.nabble.com/Application-get-in-WicketSessionFilter-ts27862681.html#a27862681,0,0
Submitting a form with Ajax in WicketTester does not check if form is multiPart,While executing wicketTester.executeAjaxEvent(butooon  'onclick') i get ServletRequest does not contain multipart content. One possible solution is to explicitly call Form.setMultipart(true)  Wicket tries its best to auto-detect multipart forms but there are certain situation where it cannot.executeAjaxEvent method does not check if form is multiPart. To workaround this problem before executeAjaxEvent we can execute: MockHttpServletRequest servletRequest = wicketTester.getServletRequest(); servletRequest.setUseMultiPartContentType(true);But its annoying to set this flag again and again. Could you extend executeAjaxEvent to check if form is multiPart ? Similar checking is already done in FormTester.onSubmit().,0,0
ListMultipleChoice's Constructors Should Accept IModel>,Currently  the constructors accept IModel&lt;Collection&lt;T&gt;&gt; for the 'model' of the ListMultipleChoice. Thus  you can't pass in an IModel&lt;Set&lt;T&gt;&gt;. The constructors should be modified to take IModel&lt;? extends Collection&lt;T&gt;&gt; instead.,0,0
ListMultipleChoice: updateModel method looses the value submitted from the select control,ListMultipleChoice looses the value submitted from client in certain conditions. This is because the collection returned by getConvertedInput() is passed to model.setObject(); and later  when the model is modified  converted input is affected too. (see ListMultipleChoice.java  line 344 in svn revision 929271).Simple page reproducing this bug under wicket 1.4.6 is attached.Key points in the code  required to reproduce the problem:1. The Form component is wrapped by a Border component2. The model used flor ListMultipleChoice initially returns null from the getObject() method. To see the error open the attached page in browser  select something in the list  press Submit.Resulting message in the feedback panel will be: 'submitted values: []'  i.e. the the submit handler sees empty list in the model.Expected: submit handler must see list of the values selected in the list by user.The reason of the error:1. Method Form.internalUpdateFormComponentModels() in Wicket 1.4.6 calls  ListMultipleChoice.updateModel() two times when the form is wrapped by a border: private void internalUpdateFormComponentModels() { FormComponent.visitComponentsPostOrder(this  new FormModelUpdateVisitor(this)); MarkupContainer border = findParent(Border.class); if (border != null) { FormComponent.visitComponentsPostOrder(border  new FormModelUpdateVisitor(this)); } }2. On the first call of the ListMultipleChoice.updateModel the result of getConvertedInput()  is stored in the model (line 344). Now model and getConvertedInput() share the same collection. On the second call  the collection retrieved from model is cleared (line 326)  and  then getConvertedInput() is used again (but now it returns the empty collection) 314 public void updateModel()315 {316 Collection&lt;T&gt; selectedValues = getModelObject();317 if (selectedValues != null)318 {...326 selectedValues.clear();327 selectedValues.addAll(getConvertedInput());...340 }341 else342 {343 selectedValues = getConvertedInput();344 setDefaultModelObject(selectedValues);345 }346 }I would suggest to not share the collection between getConvertedInput() and the model:343 selectedValues = getConvertedInput(); selectedValues = new ArrayList&lt;T&gt;(selectedValues);344 setDefaultModelObject(selectedValues);,0,0
Textarea ignores first line in case of blank line,When the content of a textarea starts with an empty line  this line disappears when it is placed in the html.This is a known problem with the html textarea element.&lt;textarea&gt;test&lt;/textarea&gt; will result in the same as:&lt;textarea&gt;test&lt;/textarea&gt;Meaning that the first newline in the textarea is ignored. In case of opening a page with a textarea with a leading blank line  this line will be removed when the form is submitted again.See for similar issues in the apache jira STR-1366 and BEEHIVE-1005A possible solution is to change the following method in org.apache.wicket.markup.html.form.TextArea in something like: protected final void onComponentTagBody(final MarkupStream markupStream  final ComponentTag openTag) { checkComponentTag(openTag  'textarea'); String value = getValue(); if (value != null &amp;&amp; value.startsWith('/n')) { value = '/n' + value; } else if (value != null &amp;&amp; value.startsWith('/r/n')) { value = '/r/n' + value; } else if (value != null &amp;&amp; value.startsWith('/r')) { value = '/r' + value; } replaceComponentTagBody(markupStream  openTag  value);},0,0
ChoiceGroup's Constructor Should Accept IModel>,This is very similar to ListMultipleChoice's constructor situation. Changing the constructor signature won't break any existing code  but it will make it easier to use (for times when you have a set-based property).,0,0
More 'IModel<? extends Collection<' Fixes,I searched the code for all occurrences of 'IModel&lt;Collection&lt;' and replaced all that I thought could be replaced with 'IModel&lt;? extends Collection&lt;'.,0,0
FileUpload#writeTo copies the stream / a possible rename would be faster,I used a FileUploadField as described in the wicket-examples (http://www.wicket-library.com/wicket-examples/upload/single) in my webapplication  in order to realise uploading a file and store this on the server. Furthermore I use the method FileUpload#writeTo(File file). This method is not the fastest solution  if you want to store the file  i think. Why don't you try to rename the file on the system first  before you use Streams.copy.There is the interface FileItem. The method FileItem#write(File file) first tries to rename the file. I recognized a great benefit in performance.Thats why i don't use the class FileUpload anymore  and receive such a FileItem from the request instead  like:final FileItem item = ((IMultipartWebRequest) getRequest()).getFile(fileUploadField.getInputName()); item.write(....,0,1
Palette nested in a ListView results in a NPE when an error feedback is logged when submitting form,Reproducing steps:1. Put TestPage.html and TestPage.java into a wicket application  visit test page.2. Hit the save button and NullPointerException will be thrown indicating the 'ids' field of component Palette$Recorder is not initializedIf taken Palette outside of ListView  the code will work fine. TestPage.html:&lt;!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'&gt;&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;html xmlns='http://www.w3.org/1999/xhtml'&gt; &lt;head&gt; &lt;meta http-equiv='Content-Type' content='text/html; charset=utf-8'/&gt; &lt;/head&gt; &lt;body&gt; &lt;form wicket:id='form'&gt; &lt;div wicket:id='palettes'&gt; &lt;div wicket:id='palette'&gt;&lt;/div&gt; &lt;/div&gt; &lt;input type='submit' value='save'&gt;&lt;/input&gt; &lt;/form&gt; &lt;div wicket:id='feedback'&gt;&lt;/div&gt; &lt;/body&gt;&lt;/html&gt;TestPage.java:import java.util.ArrayList;import java.util.List;import org.apache.wicket.extensions.markup.html.form.palette.Palette;import org.apache.wicket.feedback.ContainerFeedbackMessageFilter;import org.apache.wicket.markup.html.WebPage;import org.apache.wicket.markup.html.form.Form;import org.apache.wicket.markup.html.form.IChoiceRenderer;import org.apache.wicket.markup.html.list.ListItem;import org.apache.wicket.markup.html.list.ListView;import org.apache.wicket.markup.html.panel.FeedbackPanel;import org.apache.wicket.model.AbstractReadOnlyModel;import org.apache.wicket.model.IModel;public class TestPage extends WebPage { @SuppressWarnings({ 'unchecked'  'serial' }) public TestPage() { Form form = new Form('form') { @Override protected void onSubmit() { error('Please select a value.'); } }; add(form); List&lt;String&gt; list = new ArrayList&lt;String&gt;(); list.add('1'); form.add(new ListView('palettes'  list) { @Override protected void populateItem(ListItem item) { IChoiceRenderer renderer = new IChoiceRenderer() { public Object getDisplayValue(Object object) { return object; } public String getIdValue(Object object  int index) { return (String) object; } }; final List selected = new ArrayList(); IModel model = new IModel() { public Object getObject() { return selected; } public void setObject(Object object) { selected.clear(); selected.addAll((List) object); } public void detach() { } }; IModel choicesModel = new AbstractReadOnlyModel() { @Override public Object getObject() { final List&lt;String&gt; choices = new ArrayList&lt;String&gt;(); choices.add('1'); choices.add('2'); return choices; } }; item.add(new Palette('palette'  model  choicesModel  renderer  10  false)); } }); add(new FeedbackPanel('feedback'  new ContainerFeedbackMessageFilter(this))); }},0,0
Wrong name for swiss Application.properties,A 'Application_ch.properties' was generated due fixing Issue: WICKET-743 but the correct language-extension for German/Swiss is '_de_CH' and not '_ch' (witch stands for Chamorro).Fix: rename 'Application_ch.properties' to 'Application_de_CH.properties'.,0,0
getConvertedInput() returns null and selectedValues.addAll tries adding it,Came across this bug when upgrading from wicket 1.3 to 1.4.7. It occurred when we were clearing a form. Add a null check toselectedValues.addAll(getConvertedInput());in ListMultipChoice:updateModel() because getConvertedInput() can conceivably be null in normal situations.,0,0
RangeValidator should use getMinimum and getMaximum,Currently  the RangeValidator uses the fields directly  making it impossible to define a dynamic range by overriding getMinimum and getMaximum. Instead of using the fields directly  the validator should call these methods.,0,0
Typo in IllegalStateException when there are multiple beans of the same type,I have a test where there are multiple beans of the same type  I received the following exceptionCaused by: java.lang.IllegalStateException: more then one bean of type &#91;MyClassName&#93; found  you have to specify the name of the bean (@SpringBean(name='foo')) in order to resolve this conflict. Matched beans: MyClassNamer$$EnhancerByMockitoWithCGLIB$$f5bd36c9 MyClassNamePlease note how it states 'then' rather than 'than' since the sentence is about multiple things  'than' is the only appropriate word to use.,0,0
Javadoc for AbortWithHttpStatusException class constructor says 'true' when it should say 'false',Javadoc for AbortWithHttpStatusException class constructor states: @param statusCodeOptional If true and http status could not be set  an IllegalStateException will be thrownBut the code does: if (!statusCodeOptional) { throw new IllegalStateException( 'This exception can only be thrown from within request processing cycle'); }Obviously  the exception is thrown only if the flag statusCodeOptional is set to false  not true.,0,0
WicketSessionFilter still broken: you can only locate or create sessions in the context of a request cycle,Ever since 1.4.8 (see WICKET-2778 and WICKET-2858) WicketSessionFilter has been broken for me. This basically breaks my wicket application completely as I rely on servlets being able to access my wicket session. For that reason  I think Critical or Blocker is a fair priority for this issue.In 1.4.9 I get the following while reverting to 1.4.7 it works as expected:java.lang.IllegalStateException: you can only locate or create sessions in the context of a request cycle at org.apache.wicket.Session.findOrCreate(Session.java:208) at org.apache.wicket.Session.get(Session.java:252) at com.lyndir.lhunath.snaplog.webapp.SnaplogSession.get(SnaplogSession.java:78) at com.lyndir.lhunath.snaplog.webapp.servlet.ImageServlet.doGet(ImageServlet.java:117) at javax.servlet.http.HttpServlet.service(HttpServlet.java:707) at javax.servlet.http.HttpServlet.service(HttpServlet.java:820) at com.google.inject.servlet.ServletDefinition.doService(ServletDefinition.java:216) at com.google.inject.servlet.ServletDefinition.service(ServletDefinition.java:141) at com.google.inject.servlet.ManagedServletPipeline.service(ManagedServletPipeline.java:93) at com.google.inject.servlet.FilterChainInvocation.doFilter(FilterChainInvocation.java:63) at org.apache.wicket.protocol.http.servlet.WicketSessionFilter.doFilter(WicketSessionFilter.java:150) at com.google.inject.servlet.FilterDefinition.doFilter(FilterDefinition.java:129) at com.google.inject.servlet.FilterChainInvocation.doFilter(FilterChainInvocation.java:59) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:363) at com.google.inject.servlet.FilterDefinition.doFilter(FilterDefinition.java:129) at com.google.inject.servlet.FilterChainInvocation.doFilter(FilterChainInvocation.java:59) at com.google.inject.servlet.ManagedFilterPipeline.dispatch(ManagedFilterPipeline.java:122) at com.google.inject.servlet.GuiceFilter.doFilter(GuiceFilter.java:110) at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1139) at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:378) at org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216) at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181) at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:765) at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:417) at org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:230) at org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114) at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152) at org.mortbay.jetty.Server.handle(Server.java:324) at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:535) at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:865) at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:539) at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:212) at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404) at org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:409) at org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:520),0,0
Use Apache Nexus Maven Repository instead of self hosted maven repository on wicketstuff.org,As of June 15  2010 the wicketstuff.org maven repository was down. Instead of fixing the wicketstuff.org server I proposed that the org.apache.wicket artifacts be switched to deploy through the Apache Nexus Maven repository.See this discussion: http://apache-wicket.1842946.n4.nabble.com/proposal-Use-apache-nexus-repository-for-org-apache-wicket-release-and-snapshot-artifacts-tp2256728p2256728.htmlThis page has the registration details: http://www.apache.org/dev/repository-faq.htmlIt says to create a sub issue on this one: https://issues.apache.org/jira/browse/INFRA-1896I think the issue needs to be created by a org.apache.wicket committerThis migration will allow snapshots to be deployed from the apache hudson build cluster into the apache nexus maven repository.There is some kind of switchover that occurs for artifacts that are located through the people at apache method but since wicket artifacts that have been released are in central I see limited impact at this point.Future releases would deploy into this nexus repository which supports staging.I will attach diff's for the trunk 1.5-SNAPSHOT pom.xml and the 1.4.x branch 1.4-SNAPSHOT pom.xml that will create the two additional snapshot and release profiles that can be used for this purpose.,0,0
inconsistency in property expression when using . for self reference,Let's consider this class :class Container { String string = 'foo'; List&lt;String&gt; strings = Arrays.asList(new String[]{'test'}); }This would work:new PropertyModel&lt;String&gt;(container  '.string').getObject()=&gt; returns 'foo'but this doesn't:new PropertyModel&lt;String&gt;(container  '.strings&#91;0&#93;').getObject()it fails withorg.apache.wicket.WicketRuntimeException: no get method defined for class: class org.demo.PropertyModelTest$Container expression: stringsSimilarly  this doesn't work:new PropertyModel&lt;Container&gt;(container  '.').getObject()exception is :java.lang.StringIndexOutOfBoundsException: String index out of range: 0In the end  should the dot being allowed for self reference ? It's already used as the property separator  so it would be quite misleading.I've attached some proper junit test for these points.,0,0
Modal window titles need to be marked up as such  for accessibility,The modal windows are not accessible to screen readers. The titles of the window should be announced to give the contents of the window some context. This is as simple as changing the 'span' that contains the window title to a 'h3' and ensuring the styles are appropriate to match.,0,0
Form.MULTIPART_HINT is not cleared correctly with nested forms,I have a page that looks like this Page  Form  Wizard (contains another Form)  StepOne - contains a FileUploadField StepTwo - has no FileUploadField      (The outer form is there because I have some controls outside the wizard that needed to submit the wizard too).Because I have been using Ajax ModalDialogs  it has been important to get Form.multipart set correctly (otherwise they don't submit back correctly). So I override Wizard.onActiveStepChanged and checked to see if the new wizard step contained a FileUploadField  and set Form.setMultiPart accordingly. However  this only clears Form.MULTIPART_HARD  Form.MULTIPART_HINT is left untouched.When I step from StepOne to StepTwo  the inner form still has MULTIPART_HINT set as it contained a FileUploadField last render. Then the outer form's onRender fires  which clears MULTIPART_HINT  then the outer form's onComponentTag fires. When it checks isMultiPart()  it evaluates to true as the nested Form still returns true from its MULTIPART_HINT  and therefore tag.put('enctype'  'multipart/form-data'); is executed. After that  the inner form's onRender fires which clears its MULTIPART_HINT.When I try to submit StepTwo  the html has enctype='multipart/form-data'  so it does a multipart submit. But wicket is not expecting a multipart submit so it doesn't find any of the submitted form data  and cannot determine which button is pressed  and loses all the form content.,0,0
AbstractPropertyModel getObjectClass don't consider nested IObjectClassAwareModel targets,Currently if AbstractPropertyModel has an target that implements the IObjectClassAwareModel interface  the known class of that target is not used to infer the modeled property type. Requested improvement: use 'target type'+'property expression' to return the property type of the AbstractPropertyModel,0,0
Application addRenderHeadListener causing error,when i try to use addrenderheaderlistener in application with header contributor using methods other than renderonloadjavascript and renderOnDomReadyJavascript i get the exception as ajaxrequesttarget expects  'Only methods that can be called on IHeaderResponse outside renderHead() are renderOnLoadJavascript and renderOnDomReadyJavascriptattaching a quickstart that shows the behavior where ajaxselfupdatingtimer is used. exception as follows :-Only methods that can be called on IHeaderResponse outside renderHead() are renderOnLoadJavascript and renderOnDomReadyJavascriptorg.apache.wicket.WicketRuntimeException: Only methods that can be called on IHeaderResponse outside renderHead() are renderOnLoadJavascript and renderOnDomReadyJavascript at org.apache.wicket.ajax.AjaxRequestTarget$AjaxHeaderResponse.checkHeaderRendering(AjaxRequestTarget.java:872) at org.apache.wicket.ajax.AjaxRequestTarget$AjaxHeaderResponse.renderJavascriptReference(AjaxRequestTarget.java:915) at com.mycompany.WicketApplication$1.renderHead(WicketApplication.java:28) at org.apache.wicket.Application.notifyRenderHeadListener(Application.java:1250) at org.apache.wicket.markup.html.internal.HeaderResponse.&lt;init&gt;(HeaderResponse.java:56) at org.apache.wicket.ajax.AjaxRequestTarget$AjaxHeaderResponse.&lt;init&gt;(AjaxRequestTarget.java:951) at org.apache.wicket.ajax.AjaxRequestTarget.getHeaderResponse(AjaxRequestTarget.java:1018) at org.apache.wicket.ajax.AbstractAjaxTimerBehavior.respond(AbstractAjaxTimerBehavior.java:163) at org.apache.wicket.ajax.AbstractDefaultAjaxBehavior.onRequest(AbstractDefaultAjaxBehavior.java:286) at org.apache.wicket.request.target.component.listener.BehaviorRequestTarget.processEvents(BehaviorRequestTarget.java:119) at org.apache.wicket.request.AbstractRequestCycleProcessor.processEvents(AbstractRequestCycleProcessor.java:92) at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1250) at org.apache.wicket.RequestCycle.step(RequestCycle.java:1329) at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1428) at org.apache.wicket.RequestCycle.request(RequestCycle.java:545) at org.apache.wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:479) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:312) at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157) at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:388) at org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216) at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:182) at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:765) at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:418) at org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:230) at org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114) at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152) at org.mortbay.jetty.Server.handle(Server.java:326) at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:542) at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:923) at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:547) at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:212) at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404) at org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:409) at org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:582),0,0
Markup for AjaxLazyLoadPanel's is not valid HTML,The markup generated for the waiting image is not valid HTML as it lacks an ALT attribute.,0,0
Exposes Application DebugSettings related functionality for JMX,I think it would be cool if the DebugSettingsMBean exposes every IDebugSettings properties for JMX  I'm sending an patch with the code. outputComponentPath outputMarkupContainerClassName linePreciseReportingOnAddComponentEnabled linePreciseReportingOnNewComponentEnabled developmentUtilitiesEnabled,0,0
Remove HeaderContributor and friends in favor of IHeaderContributor,,0,0
Make Component and IBehavior directly implement IHeaderContributor to make things simpler,,0,0
ClassCastException when requesting for non-page class,org.apache.wicket.request.mapper.BookmarkableMapper tries to instantiate Page even for classes which are not Page.Requesting http://localhost:8080/wicket/bookmarkable/com.mycompany.Pojo fails with:ERROR - DefaultExceptionMapper - Unexpected error occurredjava.lang.ClassCastException: com.mycompany.Pojo at org.apache.wicket.session.DefaultPageFactory.newPage(DefaultPageFactory.java:155) at org.apache.wicket.session.DefaultPageFactory.newPage(DefaultPageFactory.java:59) at org.apache.wicket.session.DefaultPageFactory.newPage(DefaultPageFactory.java:43) at org.apache.wicket.Application$2.newPageInstance(Application.java:1425) at org.apache.wicket.request.handler.PageProvider.getPageInstance(PageProvider.java:259) at org.apache.wicket.request.handler.PageProvider.getPageInstance(PageProvider.java:160) at org.apache.wicket.request.handler.render.WebPageRenderer.getPage(WebPageRenderer.java:59) at org.apache.wicket.request.handler.render.WebPageRenderer.renderPage(WebPageRenderer.java:131) at org.apache.wicket.request.handler.render.WebPageRenderer.respond(WebPageRenderer.java:232) at org.apache.wicket.request.handler.RenderPageRequestHandler.respond(RenderPageRequestHandler.java:147) at org.apache.wicket.request.RequestHandlerStack.executeRequestHandler(RequestHandlerStack.java:84) at org.apache.wicket.request.cycle.RequestCycle.processRequest(RequestCycle.java:217) at org.apache.wicket.request.cycle.RequestCycle.processRequestAndDetach(RequestCycle.java:253) at org.apache.wicket.protocol.http.WicketFilter.processRequest(WicketFilter.java:135) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:188) at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)  .....,0,0
DateTime bug with a date pattern without separator,HI I am using wicket-datetime-1.3.7.jarWhen i use a datePattern with a separator dd/MM/yyyy  i get 01/01/2010  it's OK.But when i use the datePattern ddMMyyyy  i get 1110 and it's not correctThe bug is in the substituteDate() method of the wicket-date.js file.I have fixed it. I have attached the fixed method and an example of the problemThanks,0,0
Form.delegateSubmit: invoke onSubmit() of nested Forms before onSubmit() of enclosing Form,As has been discussed on the mailing list:http://mail-archives.apache.org/mod_mbox/wicket-dev/201008.mbox/&lt;AANLkTikq2EgstYuoM0OtzNR5PAHfxi=f4djYVoNky-P0@mail.gmail.com&gt;It can be assumed that an enclosing Form in some way or another may depend on the state of an enclosed Form  but that an enclosed Form should never depend on the state of its enclosing Form.Therefore  Form.delegateSubmit should invoke onSubmit() of the nested Forms  depth first  before invoking onSubmit() of the enclosing Form. At the moment  this is the other way around.The attached patch rectifies this situation. Please review and apply if so desired.,0,0
Add timestamp part to resource filenames for better caching,Even though we have getResourceSettings().setAddLastModifiedTimeToResourceReferenceUrl() this still is far from perfect. It will add a query parameter to resource filenames so caches should invalidate when the parameter changes. However if caching is very aggressive altering the query param might not be enough. Then there will be stale resources left in the cache of the browser or some intermediate proxy. Users will complain and you have to tell them to press F5  clear the cache  or whatever So I decided to implement support for adding the timestamp of the resource as part of the filename.When you have a resource link like &lt;link rel='stylesheet' type='text/css' href='wicket/resource/my.great.app.HomePage/css/style.css'/&gt;a timestamp (the last modified timestamp of the file) will be injected into the base name of the file &lt;link rel='stylesheet' type='text/css' href='wicket/resource/my.great.app.HomePage/css/style-ts1282376261000.css'/&gt;the format is &#91;path-component&#93;* / &#91;base-filename&#93; '-ts' &#91;timestamp-in-milliseconds&#93; (.extension)The prefix '-ts' (TS = timestamp) is to avoid naming conflicts with filenames that already got with a numeric part before the extension.Locales  style and variations are taken into consideration (e.g. style.css  style_de.css  style_en.css)When running your test cases the MockApplication which WicketTester provides in the default case has timestamps disabled so you can check you rendered markup against some predictable url.You can control and check timestamp behavior with getResourceSettings().setUseTimestampOnResources()and  getResourceSettings().getUseTimestampOnResources()Default behavior is 'enabled'You are now able to configure your resource caching for a very large lifetime (say 'infinite'  and get the best possible network performance and utilization of proxies.,0,1
Return the possibility to create custom WebRequest/WebResponse per Application,In Wicket 1.4 there is org.apache.wicket.protocol.http.WebApplication.newWebRequest(HttpServletRequest) and org.apache.wicket.protocol.http.WebApplication.newWebResponse(HttpServletResponse). These are removed in current 1.5 code and there is no way to use org.apache.wicket.extensions.ajax.markup.html.form.upload.UploadWebRequest for example.See wicket-examples &gt; upload.,0,0
WicketServlet failes to initialise with NullPointerException in WebXmlFile.getFilterPath(),java.lang.NullPointerException: null at org.apache.wicket.util.file.WebXmlFile.getFilterPath(WebXmlFile.java:148) ~&#91;wicket-util-1.5-SNAPSHOT.jar:1.5-SNAPSHOT&#93; at org.apache.wicket.util.file.WebXmlFile.getFilterPath(WebXmlFile.java:77) ~&#91;wicket-util-1.5-SNAPSHOT.jar:1.5-SNAPSHOT&#93; at org.apache.wicket.util.file.WebXmlFile.getFilterPath(WebXmlFile.java:60) ~&#91;wicket-util-1.5-SNAPSHOT.jar:1.5-SNAPSHOT&#93; at org.apache.wicket.protocol.http.WicketFilter.init(WicketFilter.java:264) ~&#91;wicket-1.5-SNAPSHOT.jar:1.5-SNAPSHOT&#93; at org.apache.wicket.protocol.http.WicketServlet.init(WicketServlet.java:254) ~&#91;wicket-1.5-SNAPSHOT.jar:1.5-SNAPSHOT&#93; at javax.servlet.GenericServlet.init(GenericServlet.java:241) ~&#91;servlet-api-2.5.jar:2.5&#93;WebXmlFile.getFilterPath tries to retrieve the url-pattern of filter-mapping/filter-name... but in the case of a servlet  filter-mapping does not exists... it should be serlvet-mapping/servlet-name.,0,0
WicketTester does not preserve the form component values when submitting with AjaxSubmitLink,See this thread:http://apache-wicket.1842946.n4.nabble.com/Url-parameters-removed-onClick-wrong-url-encoding-td2541831.htmlAgain you can take a legup project (with Guice 2.0) and substitute the wicket versions -&gt; the test tester.assertModelValue('text'  'sayHello');will fail: expected:&lt;sayHello&gt; but was:&lt;Hello null&gt;,0,0
The new mappers ignore single query parameter with empty value,Making request like http://host:port/?paramName= will result in empty PageParameters.The problem is in org.apache.wicket.request.mapper.AbstractMapper.extractPageParameters(Request  int  IPageParametersEncoder) because it skips the first parameter if its value is empty.This is made because most of the time this is the PageComponentInfo part of the URL.,0,0
AJAX file upload fails in IE8 due to Wicket.Ajax.handleMultipart() sniffing wicket:body tags as an HTML body element when running Wicket in development mode,To reproduce:1. Run provided quickstart project2. Open in IE8. 3. Upload a file. Expected behaviour: File is uploaded  and some basic information about uploaded file is displayed.Observed behaviour:IllegalStateException is thrown.The IllegalStateException is being thrown because the form is being submitted as a normal form. This is because the JS in handleMultipart that traverses up the DOM looking for the actual form is checking tagnames  and in IE8  the tagName of a &lt;wicket:body&gt; is body  so as soon as it hits a wicket:body  it returns false. I've provided a patch that checks for identity against document.body - an alternative is to check that the form.tagUrn is empty  as it would be for a normal HTML element.,0,0
Broken AbstarctCalendar dependency,org.apache.wicket.extensions.yui.calendar.AbstractCalendarmethod contributeDependenciesadd(HeaderContributor.forJavaScript(YuiLib.class  'yahoo-dom-event/yahoo-dom-event.js'));there is no yahoo-dom-event directory  just yahoodomeventso AbstractCalendar fails with js error onYAHOO.namespace('wicket');,0,0
isTemporary behavior and ajax behavior together crashes with WicketRuntimeException: Couldn't find component behavior.,My scenario:1. Component has 2 behaviors: first is temporary and second is ajax behavior.2. Url for Ajax behavior contains behavior's index (e.g.../page?1-1.IBehaviorListener.1-form-text)2. Temporary behavior is removed in detachBehaviors method.3. Ajax request is invoking ListenerInterfaceRequestHandler and it'slooking for behavior on non-existing indexThis scenario causes error on wicket 1.5-M2.1,0,0
No exceptionpage on exceptions during ajax,start the quickstart and wait to see error occuring in console  ajax just stops in browser (nothing is indicating the error),0,0
RequestCycle logs something  when its intended for servlet container,I have something where I reference an image directly in html  wicket has no idea what it should do with it so it passes the request to the servlet container.. It works as I wanted  but should it give an error message?html: &lt;img src='/images/icons/arrow_down_end.png'/&gt;Log:ERROR &#91;org.apache.wicket.request.cycle.RequestCycle&#93; - Unable to execute request. No suitable RequestHandler found. URL=images/icons/arrow_down_end.png,0,0
Add IRequestListener interface to allow easier framework extension points,See http://apache-wicket.1842946.n4.nabble.com/Session-attach-tp3004389p3004681.htmlBasically  add an interface for onBeginRequest and onEndRequest that can be plugged into the WebRequestCycle. This allows framework extensions to plugin their listeners rather than extending WRC  and requiring that you then extend them.,0,0
Adding node to a collapsed tree node should not cause it to expand,The fix for WICKET-3112 made a unwanted minor modification to the Tree behavior that was established in WICKET-2886.Adding a child to a tree node that already has children and that is currently collapsed now causes the parent node to expand so that all the children are displayed. Only adding the first child to a node should cause it to expand  in all other cases the state of the parent node should not change.,0,0
Commons logging must die,In wicket 1.4 (and possibly 1.5) we still depend on commons-logging (and version 1.1 at that)  which not only includes strange logging dependencies from the long departed Avalon project  but also other stuff we really don't want to have. (looking at spring-all-2.5.6 as the main culprit here).,0,0
No Exception page are rendered when using ajax,When using ajax no exception page are rendered if an exception occurs.Just start the quickstart here : https://issues.apache.org/jira/browse/WICKET-3142And select something ind the dropdown,0,0
Dropped support for Servlet 2.5 inadvertently,Fixing 3146 in r1031086 resulted in introducing a dependency on javax.servlet.annotation.* thus rendering WicketFilter unusable in pre-3.0 servlet containers.If pruning the large base of 2.5-compatible containers was intentional then I'd also suggest switching to java 6 (Although servlet 3.0 specs does not explicitly indicate java 6 as a requirement  all 3.0 compliant containers that I'm aware of - namely Jetty 8  Websphere 8  tomcat 7  glassfish 3 - require java 6). Not to mention that this should be spoken out loud (https://cwiki.apache.org/WICKET/migration-to-wicket-15.html does not mention anything about container compliance),0,0
test for undefined in the  same manner throughtout the code.,testing whether a variable is undefined should be done in a similar manner throughout a file.,0,0
Can not create cookies,Hi I'm migrating to wicket 1.5-M3 and I've encountered a problem. I can not create cookies (I presume that I can't delete them either).I've looked through the source code and this is what I found:I add the cookie to the response and I end up with a nice HeaderBufferingWebResponse which contains BufferedWebResponse$AddCookieAction.But then redirectTo(Url  RequestCycle) from WebPageRenderer class is called. Here is the method: private void redirectTo(Url url  RequestCycle requestCycle) { WebResponse response = (WebResponse)requestCycle.getResponse(); String relativeUrl = requestCycle.getUrlRenderer().renderUrl(url); response.reset(); response.sendRedirect(relativeUrl); }response.reset(); - removes all actions from the request.So after this method my request has got only BufferedWebResponse$SendRedirectAction.,0,0
support building wicket offline by resolving DTD references locally,Wicket developers  please give me some comment on this:Some wicket test cases parse XML which refers to an external DTD. An example is org.apache.wicket.protocol.http.WicketFilterTestIt refers to org.apache.wicket.util.file.WebXmlFile will will parse a custom web.xml.The web.xml will make the parser to look up http://java.sun.com/dtd/web-app_2_3.dtdWhen building wicket offline this will cause a network error and the test will fail.I would like to add  org.apache.wicket.util.xml.LocalEntityResolverwhich may contain a set of local entitites to avoid hitting the network.As wicket 1.5 is getting close to final I would like to get some feedback first before putting that into trunk...By adding this like to WebXmlFile network lookup would be avoided. DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance(); DocumentBuilder builder = factory.newDocumentBuilder(); builder.setEntityResolver(LocalEntityResolver.getDefault()); // no more network lookups Document document = builder.parse(is);----------------------------------------------------package org.apache.wicket.util.xml;import org.apache.wicket.util.lang.Args;import org.xml.sax.EntityResolver;import org.xml.sax.InputSource;import org.xml.sax.SAXException;import javax.servlet.Filter;import java.io.IOException;import java.io.InputStream;import java.util.HashMap;import java.util.Map;/** entity resolver that tries to locate a document type definition (DTD) using a set of custom entity resolvers * @author pete */public class LocalEntityResolver implements EntityResolver{ private final Map&lt;EntityKey  EntityLocator&gt; entities = new HashMap&lt;EntityKey  EntityLocator&gt;(3); public static LocalEntityResolver getDefault() { LocalEntityResolver resolver = new LocalEntityResolver(); // // look up servlet 2.3 web.xml DTD right from inside servlet-api.jar // resolver.put(new EntityKey('-//Sun Microsystems  Inc.//DTD Web Application 2.3//EN'  'http://java.sun.com/dtd/web-app_2_3.dtd')  new ServletApiEntityLocator('web-app_2_3.dtd')); return resolver; } public void put(EntityKey key  EntityLocator locator) { Args.notNull(key  'key'); Args.notNull(locator  'locator'); entities.put(key  locator); } public InputSource resolveEntity(String id  String url) throws SAXException  IOException { for (Map.Entry&lt;EntityKey  EntityLocator&gt; entry : entities.entrySet()) if (entry.getKey().id.equals(id) || entry.getKey().url.equals(url)) return entry.getValue().locateInputSource(); return null; } public static class EntityKey { private final String id; private final String url; private EntityKey(String id  String url) { Args.notEmpty(id  'id'); Args.notEmpty(url  'url'); this.id = id; this.url = url; } @Override public boolean equals(Object o) { if (this == o) return true; if (!(o instanceof EntityKey)) return false; EntityKey key = (EntityKey) o; if (!id.equals(key.id)) return false; return url.equals(key.url); } @Override public int hashCode() { int result = id.hashCode(); result = 31 * result + url.hashCode(); return result; } } public static interface EntityLocator { InputSource locateInputSource() throws SAXException  IOException; } public static class ServletApiEntityLocator implements EntityLocator { private final String name; private ServletApiEntityLocator(String name) { this.name = name; } public InputSource locateInputSource() { InputStream stream = Filter.class.getResourceAsStream('resources/' + name); if (stream == null) return null; return new InputSource(stream); } }},0,0
executeAjaxEvent in WicketTester works although Component is not enabled,When Component is disabled the executeAjaxEvent still works. Because it's not checking if Component is enabled.But the event attribute is not rendered to the component if it's disabled.,0,0
Strange IResourceStream type hierarchy,Current type hierarchy looks likeIResourceStream IStringResourceStream AbstractResourceStream AbstractStringResourceStreamIt propobly should rather beIResourceStream AbstractResourceStream IStringResourceStream AbstractStringResourceStream,0,0
Parametrize IFilterStateLocator,Interface org.apache.wicket.extensions.markup.html.repeater.data.table.filter.IFilterStateLocator contains methods which work with Object types. It may be a good improvement to parametrize this interface with type &lt;T&gt; much like the IModel &lt;T&gt;interface in order to introduce type-safety and avoid casting.,0,0
Chunk.slice seq.subList(pos  pos) returns empty list so why bother,In the method Chuck.splice when count &lt;= 0 the following code is exectued:return new ArrayList&lt;T&gt;(seq.subList(pos  pos));Well  seq.subList(pos  pos) returns an empty list so you might want tochange the line to be something like:return new ArrayList&lt;T&gt;();,0,0
Correctness of tests is order dependent  ThreadContext.detach not always called,I have my own build/test env for Wicket and the order in which tests are executed are not necessarily the same as the order that Maven drivesthe tests in the standard test env.If you can manage to run only the testsorg.apache.wicket.request.cycle.RequestCycleListenerTest testBasicOperationsfollowed by test org.apache.wicket.request.mapper.BasicResourceReferenceMapperTest testDecode1the BasicResourceReferenceMapperTest test will fail because itrequires that the ThreadContext have NO application  but theRequestCycleListenerTest does not have a tearDown methodthat calls ThreadContext.detach (nor does it use the BaseWicketTesterwith its tearDown method) so it leaves an application in the ThreadContext.Also  BasicResourceReferenceMapperTest does not use theBaseWicketTester which calls detach in its constructor.The solution is to add the following to BasicResourceReferenceMapperTestprotected void setUp() { org.apache.wicket.ThreadContext.detach(); }In my test env it is simply two lines in a property file to have only the abovetwo tests execute (and in the order specified). Don't know how to do that in Maven.,0,0
IResourceSettings.setUseTimestampOnResources(true) and performance,Hello  I had a problem with slow loading of pages and response to ajax requests. After some debugging I traced the problem to be that wicket constantly tries: DEBUG - UrlResourceStream - cannot convert url: jar:file:/C:/Users/hok/.m2/repository/org/apache/wicket/wicket/1.5-M3/wicket-1.5-M3.jar!/org/apache/wicket/markup/html/wicket-event.js to file (URI is not hierarchical)  falling back to the inputstream for polling DEBUG - ResourceStreamLocator - Attempting to locate resource 'org/apache/wicket/markup/html/wicket-event_en_US.js' on path [folders = []  webapppaths: []] DEBUG - ResourceStreamLocator - Attempting to locate resource 'org/apache/wicket/markup/html/wicket-event_en_US.js' using classloader sun.misc.Launcher$AppClassLoader@cac268 and this happens because that by default (or at least I think so) wicket adds timestamp on the resources - ResourceSettings.setUseTimestampOnResources(true) and every resource is read from the jar files on every request. When a resource is in a jar file a java.lang.IllegalArgumentException: URI is not hierarchical is thrown in the UrlResourceStream constructor and a lot of attempts are made to load the jar file through different loaders. In my case this led to a slow response times. After disabling timestamp on resources (ResourceSettings.setUseTimestampOnResources(false)) the problem disappears and the performance is fine. However in the javadoc of setUseTimestampOnResources: Enabling timestamps on resources will inject the last modification time of the resource into the filename (the name will look something like 'style-ts1282915831000.css' where the large number is the last modified date in milliseconds and '-ts' is a prefix to avoid conflicts with filenames that already contain a number before their extension. * Since browsers and proxies use the filename of the resource as a cache key the changed filename will not hit the cache and the page gets rendered with the changed file.In this case this useful functionality is lost. Is it possible to have 'the best of both worlds'? Thanks.This issue is raised from the discussion:http://apache-wicket.1842946.n4.nabble.com/IResourceSettings-setUseTimestampOnResources-true-and-performance-td3057946.htmlTo observe the performance improvement  please changegetResourceSettings().setUseTimestampOnResources(true);togetResourceSettings().setUseTimestampOnResources(false);in TestApplication. It's most obvious when you press Refresh All link and observe the time for the refresh in both cases,0,1
Form  containing FileUploadField and UploadProgressBar throws an exception when removed from the parent,There is a form which contains FileUploadField  UploadProgressBar and a submit button. The form is added to a WebMarkupContainer. When the form is removed from the WebMarkupContainer an exception is thrown: java.lang.IllegalStateException: Tried to remove a behavior that was not added to the component. Behavior: org.apache.wicket.extensions.ajax.markup.html.form.upload.UploadProgressBar$FormEnabler@1d433c1This can be observed in the attached quickstart.,0,0
Localizer.substitutePropertyExpressions() is called twice when Localizer.getString() is called,When you call getString() on a component this component calls Localizer.getString(). This method then calls Localizer.getStringIgnoreSettings() which calls Localizer.substitutePropertyExpressions() for the first time. The return value of getStringIgnoreSettings() is then again passed to substitutePropertyExpressions().Actually I'm not sure if this is a bug or if this is desired behaviour  but it can lead to problems if you throw an Exception when a resource cannot be found and the value that is put into a string is  for whatever reason  in the format ${foobar}.,0,1
WicketTester can't create new sessions,It looks like currently there is no way to create a new session (e.g. execute Application#newSession through WicketTester).My test case would be something like this: create a session set a configuration option with a form invalidate session create new session assert that the session#getStyle now returns something elseIn wicket-1.4 this was possible with WicketTester#createRequestCycle  but that is gone now.Workaround: create a new WicketTester  which will force to create a new session.,0,0
AutoCompleteTextField does not work in an iframe under IE 6  7 or 8,The code that has been integrated in version 1.4.11 to fix issue WICKET-2279 forces the cursor of an AutoCompleteTextField to do a 'carriage return' after each typed in char when the application runs in an iframe and IE 6  7 or 8 is used.,0,0
DatesPage test LocaleDropDownChoice getObject calls getSelectedLocale()  does not use result,In the DatesPage test  the LocaleDropDownChoice.getObject() method callsgetSelectedLocale() but does not use the result: public List&lt;Locale&gt; getObject() { getSelectedLocale(); List&lt;Locale&gt; locales = new ArrayList&lt;Locale&gt;(LOCALES); Collections.sort(locales  new Comparator&lt;Locale&gt;() { public int compare(Locale o1  Locale o2) { return o1.getDisplayName(selectedLocale).compareTo( o2.getDisplayName(selectedLocale)); } }); return locales; }I would guess that the call getSelectedLocale() could be removed,0,0
AbstractMarkupParser doesn't remove Comments correctly,AbstractMarkupParser removeComment(...) doesn't remove Comments correctlyif two html comments stand to close together &lt;Unable to render embedded object: File (-- foo --&gt; &lt;) not found.-- bar --&gt;foo will be removed but not bar.see:https://github.com/mafulafunk/wicketCommentsgit@github.com:mafulafunk/wicketComments.git,0,0
Complete documentation of Component Lifecycle,Please update javadoc for component lifecycle  it misses important hooks like onBeforeRender()  onInitialize() and onConfigure().,0,0
In extensons CaptchaImageResource render method  while loop does not loop,In the extensons CaptchaImageResource render method  the while-loop:while(true){....return toImageData(image);}can be removed.,0,0
for stateless pages wicket complains with 'The Buffered response should be handled by BufferedResponseRequestHandler',when initially rendering a _stateless_ page I get 'The Buffered response should be handled by BufferedResponseRequestHandler'it's logged by WebPageRenderer#respond(cycle) in line 185 in trunk.I don't know if this really is worth a warning  maybe we can just remove it.There's also method WebPageRenderer#enableRedirectForStatelessPage()which seems to be somehow involved (and still contains a TODO which probably should be resolved before 1.5.0)I would like to fix it for myself but don't know much about the background of that warning.,0,0
AnnotationsRoleAuthorizationStrategy isInstantiationAuthorized package==false  class==true returns true,In the class AnnotationsRoleAuthorizationStrategy's isInstantiationAuthorized method ifthe package authorization is false but the class authorization is true  then the userwill be authorized.Maybe  check the class authorization only if the authorized variable is true.,0,0
NPE with nested property models,After updated from 1.4.8 to 1.4.14 I got this bug.The problem is with nested property models where the 'top' model has a null model object that is bound to a TextField. You get a NPE when the page is rendered. There is a quick workaround by overriding getOjbectClass() on the property model.I provide a running example of the problem.,0,0
Add restartResponseAtSignInPage() Method to AuthenticatedWebApplication,I have a situation where I need to be able to get the sign in page class outside the context of the AuthenticatedWebApplication class itself (or a subclass). Basically  I've got a Spring Security framework that's going to register a custom exception mapper (that wraps the default one). If it sees an AuthenticationCredentialsNotFoundException  it needs to throw a RestartResponseAtInterceptPage(getSignInPage()). Can we add a method that does that? Patch coming...,0,0
ModalWindow title not visible,The title of a Modal window is not shown.,0,0
IResponseFilter doesn't work in 1.5,In current 1.5-SNAPSHOT there are no callers of org.apache.wicket.settings.IRequestCycleSettings.getResponseFilters() and thus filters are never executed.,0,0
DropDownChoice:  'data' or 'choices?',In DropDownChoice  sometimes the constructor argument is called 'data' and sometimes 'choices.' These look like the same parameter; wouldn't it be better to give the same parameter the same name across all the constructors?,0,0
Please use lists instead of arrays,I'm working with 1.5-M3.In most places  indexed collections are lists. But in a few places they're arrays  which creates awkward integrations for various reasons. The ones that I've noticed are:1. DataTable accepts an IColumn&lt;T&gt;[] as a parameter  which is a pain to construct because it's impossible to create a generic array. Instead one has to create a non-generic array (in other words an IColumn[]) or create a list of IColumn&lt;T&gt; and then convert it to an array. Either approach involves suppressing some warning and is unfriendly to developers who don't grok the ins and outs of using arrays and generics together. If DataTable just accepted List&lt;IColumn&lt;T&gt;&gt;  like DataGridView (which takes List&lt;ICellPopulator&lt;T&gt;&gt;)  then the issue will go away. If DataTable wants to use an array internally  then it can do the conversion itself.2. In the new AbstractMapper and several subclassses  the mount path is represented as a String[]. But this collection has to intergrate with the Url class  which represents the same concept as a List&lt;String&gt;. Why not just use List&lt;String&gt; and make it a little easier for everyone to write AbstractMapper implementations?,0,0
Url should accept null parameters list,It's more natural to pass null than an empty list if there are no query parameters. It would be a simple change since Url just copies the parameters into its own list: if it's null then just don't copy. public Url(List&lt;String&gt; segments  List&lt;QueryParameter&gt; parameters  Charset charset) { Args.notNull(segments  'segments'); // Remove: Args.notNull(parameters  'parameters'); this.segments.addAll(segments); if (parameters != null) this.parameters.addAll(parameters); setCharset(charset); },0,0
unable to add nodes to an empty rootless Tree (e.g. LinkTree),2 scenarios which adding new nodes (via ajax) to a rootless Tree is not working as expected.the node is getting added to the treemodel but non is displayed.1) adding a node to the rootnode. the newly added node is not displayed.2) the rootless tree already has a node. if you add additional nodes to the root node  they will be displayed (compare to 1)  if you add an additional node to one of the added nodes  the complete tree will disappear.see attached quickstart,0,0
Multiple language support for UploadProgressBar,Up to now the Feedback (e.g. 'Upload starting'  '15 Minutes remaining'  etc.) is hardcoded into the progressbar.js and therefore doesn't support multiple languages.,0,0
AjaxEditableMultilineLabel generates invalid HTML,When using an AjaxEditableMultilineLabel  the generated markup looks like:&lt;span onclick='&#91;...&#93;'&gt;&lt;p&gt;1st paragraph&lt;/p&gt;&lt;p&gt;2nd paragraph&lt;/p&gt;&lt;/span&gt;This is invalid according to HTML spec (block elements (p) are not allowed within inline elements (span)).AjaxEditableMultilineLabel should be using a &lt;div&gt; element instead of the &lt;span&gt;.,0,0
Ajax submit  link does not show busy indicator under IE,When form is sumbitted via link inside form then busy indicator is not shown under IE.The problem occurs only when form was earlier refreshed via ajax.,0,0
Patches to correct some Findbugs warnings in core  request and util,The patches contain fixes mainly for the followings: only java files in main source directories of core  request and util were touched (so test not) only those were fixed that looked straightforward and locally fixable fixing cases that always result in NPE (2 found) or ClassCastException (1 found) unused local variable  dead store removals redundant instanceof check  nullcheck removals added transient to non serializable fields of serializable classes made inner classes static where the reference to the enclosing classes was not used some extra null checks added with WeakReference usages to avoid NPE 'File#delete() return value not checked': using wickets Files#remove() instead small performance related tasks: using StringBuilder in loop  using map entrySet() instead of keySet() + get()I added some comments to the patches where I tought it is not easy to figure out without the findbugs report why the code was changed. But of course I can explain if other questions arise.,0,1
TreeTable should call attachUpdate javascript on domready event.,Since Wicket-1.4.15 it is possible to filter javascript resources (JavascriptFilteredIntoFooterHeaderResponse) and place them to the tail of HTML document. It means that some embedded javascript can be broken because of too early evaluation and missing dependencies.I have faced with this problem in TreeTable component. But probably there are other places in the framework  affected by this issue.,0,0
Url to the home page is not correct when the current base url has only one segment,The link 'go back' in all Ajax examples in wicket-examples is not correct.In details: 1) current base url looks like : autocomplete?0 (i.e. one segment + one query parameter) 2) 'go back' points to the application home page (Index.class) 3) RequestCycle.mapUrlFor(IRequestHandler) creates Url('') for the home page 4) UrlRenderer.renderUrl(homePageUrl) incorrectly returns '' instead of '.' for this input,0,0
Upgrade jetty version to 7.2,Jetty 6 is a dead end  and servlet api 2.3 is so 2003  it is time to cut the bilical cord and move to at least servlet api 2.5 (which is from januari 2007) so we can run our examples using jetty 7.,0,0
Add class for span with text in wicket-extensions/treetable,Could you  please  add class 'text' for a span with wicket:id='label' to markup in wicket-extensions/org/apache/wicket/extensions/markup/html/tree/table/TreeTable.html as it is done in wicket-extension/org/apache/wicket/extensions/markup/html/tree/table/TreeTable$TreeFragment.html,0,0
'wicket' Maven module brings the other three wicket modules as transitive dependencies,The new three-in-one Maven module 'wicket' brings -core  -util and -request as transitive dependencies.This way if the user app depends on 'wicket' then it will get wicket.jar  wicket-util.jar  wicket-request.jar and wicket-core.jar in its WEB-INF/lib/ folder.,0,0
Improve SerializableChecker message,Currently if the object has an problematic implementation of equals method  the serializable checker will stop its work with an runtime exception. The best would be just log an warn explaining the the problem on console and continue the checks until the non serializable source of the problem.,0,1
Validation Error on AjaxEditableLabel causes ajax calls in loop on Chrome Browser,On Chrome  the component AjaxEditableLabel causes an infinite ajax call's loop if there is an validation error on the input.The attached project shows this bug (Enter 'false' to reproduce the bug  and tape any key to stop it).On Firefox  everithing is OK.,0,1
1.5-RC1 sources seem to be missing in Maven repository,I saw a 1.5-RC1 build here:http://repo1.maven.org/maven2/org/apache/wicket/wicket/1.5-RC1/but it looks like the sources are missing. There are source jar files  but they don't contain any classes. Was that intentional or is something wrong with the build process?,0,0
Extend multiple file handling to IMultipartWebRequest,HTML 5 allows a new attribute with file input tags called 'multiple ' which lets the user choose multiple files to upload. It works for me in Safari 4 and Firefox 3.6. It probably works in Chrome and probably doesn't work in IE (like everything else).So I set about creating a MultiFileUploadField that uses a List&lt;FileUpload&gt; as its model. Unfortunately it looks like while MultipartServletWebRequestImpl does a fine job of parsing out each file in the multi-file upload  the IMultipartWebRequest interface isn't up to the task: it assumes that each field only has one file.I think that it would be straightforward to make IMultipartWebRequest map field names to List&lt;FileItem&gt; instead of just FileItem. The existing FileUpload field (and indeed any other user of this interface) could just use the first FileItem in the list  or the last  if it really wanted to reproduce the existing behavior exactly (in which each new file for some field 'f' overwrites the previous one in the map  leaving the last).Alternately there could be a couple of new methods:public Map&lt;String  List&lt;FileItem&gt;&gt; getFileLists();public List&lt;FileItem&gt; getFileList(final String fieldName);with the other two methods retaining the old behavior.,0,0
HttpsMapper and BookmarkablePageLink,There is a wicket Application which is configured to use HttpsMapper. There are two page: TestPage and TestPage2. TestPage uses @RequireHttps  TestPage2 doesn't. Each page contains a BookmarkablePageLink to the other one. However in this configuration (one with @RequireHttps and one without) the links on the pages are pointing to the page they are added to - the link in TestPage links to TestPage itself (and not to TestPage2) and vice versa. When both of the pages use @RequireHttps or not using it at all the links work normally.,0,0
Comment: org.apache.wicket.util.upload.RequestContext interfsace to interface,Change comment from:Abstracts access to the request information needed for file uploads. This interfsace should betoAbstracts access to the request information needed for file uploads. This interface should be,0,0
Incorrect casts to AuthenticatedWebSession in AuthenticatedWebApplication class,After resolving bug WICKET-2971  several methods in AuthenticatedWebApplication still contain casts to AuthenticatedWebSession instead of casts to AbstractAuthenticatedWebSession. It makes AuthenticatedWebApplication not reusable with custom implementations of AbstractAuthenticatedWebSession class. Several cosmetic changes in code and javadoc should be done.,0,0
org.apache.wicket.request.mapper.parameter.PageParameters Comment,org.apache.wicket.request.mapper.parameter.PageParameters Change:@deprecated use varios setter methods to set parametersto@deprecated use various setter methods to set parameters,0,0
Add wicket version to initial page in wicket-examples,The wicket-examples show the wicket version when you click on a sub page but not on the initial page.I didn't notice the version showing in the DebugBar until after I created this patch.I added in a new HomePageApplication that receives the initial request instead of the static index.html file.,0,0
RememberMe doesn't remember me,When remember me is checked a cookie with crypted username and password should be set I think. But no cookie was set. So when the browser is closed and opened again I was asked again for username and password.,0,0
1.5 equivalant of protected void WebRequestCycle.onRequestTargetSet(IRequestTarget requestTarget) is mising from AbstractRequestCycleListener,There is not method equivalent to WebRequestCycle.onRequestTargetSet(IRequestTarget requestTarget) in AbstractRequestCycleListener.,0,0
org.apache.wicket.util.collection.MultiMap addValue,for org.apache.wicket.util.collection.MultiMap addValue methodchange from: public void addValue(final K key  final V value) { List&lt;V&gt; list = get(key); if (list == null) { list = new ArrayList&lt;V&gt;(1); } list.add(value); put(key  list); }to: public void addValue(final K key  final V value) { List&lt;V&gt; list = get(key); if (list == null) { list = new ArrayList&lt;V&gt;(1); put(key  list); } list.add(value); },0,0
javascript with a less than character ('<') fails to execute when added through a header contribution in ajax response,This is adapted from a wicket users post I made (links are to the same thread in two archive systems):http://markmail.org/search/?q=wicket%20users%20wicket-ajax.js#query:wicket%20users%20wicket-ajax.js+page:1+mid:rfts3ar3upffhbbt+state:resultshttp://mail-archives.apache.org/mod_mbox/wicket-users/201102.mbox/%3CAANLkTi=EkmTA0RnA+GyJE-CQWmkCxRLsjp+z8jwv-Aw9@mail.gmail.com%3EThe problem: I have a panel with this: &lt;wicket:head&gt; &lt;script&gt; if (someVariable &lt; 0) { someVariable = 0; } &lt;/script&gt; &lt;/wicket:head&gt;This script fails to execute when the panel is loaded by ajax. If I replace the less than character '&lt;' with equals '=='  then it executes (but of course  this is not what I need).I tested this in Firefox 4.0b10 and Chrome 8.After some debugging  it seems to me that this needs to be corrected in wicket-ajax.js. The header contribution is sent to the browser inside of a CDATA section so the '&lt;' character arrives to javascript intact. However  in parsing the script tag  the '&lt;' seems to signal the beginning of an HTML tag that then is considered malformed.Possible workarounds for apps: Invert the logic so a greater-than is used. In my example  this would be: 'if (0 &gt; someVariable) {' Put the code into a separate JS file (the downside is it requires another network hop from the browser) Embed the script in &lt;wicket:panel&gt; rather than &lt;wicket:head&gt; (the disadvantage is the script will be re-sent with the panel content when the panel is re-used on the same page),0,0
org.apache.wicket.markup.html.form.AbstractChoice renderer cast in method appendOptionHtml,In class org.apache.wicket.markup.html.form.AbstractChoice&lt;T  E&gt; the renderer instance variable has signature: private IChoiceRenderer&lt;? super E&gt; renderer;In the method appendOptionHtml the renderer's getDisplayValue method is called as follows: T objectValue = (T)renderer.getDisplayValue(choice); where the signature for the IChoiceRenderer&lt;E&gt; getDisplayValue method is: Object getDisplayValue(E object);So  is it a fact that for all usages of AbstractChoice that the display value returned by arenderer of type E will always be of type T (not Object)??? If not  then one should expect cast exceptions.,0,0
org.apache.wicket.util.collections.MostRecentlyUsedMap getRemovedValue method returns Object not V,org.apache.wicket.util.collections.MostRecentlyUsedMap getRemovedValue method: public Object getRemovedValue() { return removedValue; }but should be: public V getRemovedValue() { return removedValue; },0,0
ChangeHandler fires in IE on POS1 and END,In wicket-ajax.js the Wicket.ChangeHandler fires in IE an event on Textfields even if the KEY_POS1 and the KEY_END is pressed.Please add obj.onkeyup = function(event) {  switch (wicketKeyCode(Wicket.fixEvent(event))) { case KEY_ENTER: case KEY_UP: case KEY_DOWN: case KEY_ESC: case KEY_TAB: case KEY_RIGHT: case KEY_LEFT: case KEY_SHIFT: case KEY_ALT: case KEY_CTRL: return Wicket.stopEvent(event); break; default: if (typeof objonchange == 'function')objonchange(); } return null; }case KEY_POS1 and KEY_END to the first case so that these two keys don't fall in the default case.,0,0
Value exchange in a wicket:message throws an exception,i tried to exchange values in a &lt;wicket:message&gt; like described in wiki &lt;https://cwiki.apache.org/WICKET/wickets-xhtml-tags.html#Wicket%27sXHTMLtags-Elementwicket:message&gt;.But i get an exception:ERROR - RequestCycle - No get method defined for class:class org.apache.wicket.markup.resolver.MarkupInheritanceResolver$TransparentWebMarkupContainer expression: vat1valueorg.apache.wicket.WicketRuntimeException: No get method defined for class:class org.apache.wicket.markup.resolver.MarkupInheritanceResolver$TransparentWebMarkupContainer expression: vat1valueat org.apache.wicket.util.lang.PropertyResolver.getGetAndSetter(PropertyResolver.java:488)at org.apache.wicket.util.lang.PropertyResolver.getObjectAndGetSetter(PropertyResolver.java:330)at org.apache.wicket.util.lang.PropertyResolver.getObjectAndGetSetter(PropertyResolver.java:237)...Maybe it's caused by usage of border. I've debugged a bit  but could get a real glue.I added a quick start with test case.,0,0
Add methods to IBehavior to listen for configuration events,I would like for behaviors to be able to contribute to the configuration of a component (i.e. calling setVisible / setEnabled). Now that we have onConfigure  it would be nice to have components notify their behaviors during the configuration process.,0,0
PackagedTextTemplate -> PackageTextTemplate,It's PackageResource but PackagedTextTemplate. Maybe remove the 'd' for sake of consistency.,0,0
Update jetty to 7.3 and spring to 2.5.6.SEC02,Jetty 7.3.0.v20110203 is the latest stable version. Maybe it would be worth to upgrade now from 7.2.2 before wicket 1.5 goes final.Spring 2.5.6.SEC02 is the latest spring version in the 2.x line and it only differs in a few security fixes from the current used version: 2.5.6.,0,0
Greek (el) Application.properties,I am attaching greek Application_el.properties file. Unfortunatelly I myselft do not speak Greek  we have a project partner/client in Greece  which was conmpaining about default 'Choose one' drop down option. I suggested translating the Application.properties file. I know  there are more files  which should be translated to get full translation  but I do not really feel I can ask our Greek partner to do them all  Additionally I can not really validate  how good the translation really is - they are very non-technical persons.,0,0
BaseWicketTester#isInvisible(String path),BaseWicketTester#isInvisible(String path) does not fail if Component does not exist.Similar methods like isVisible  isEnabled  isDisabled and isRequired  they all fail if component does not exist.,0,0
Can't write session to disk with tomcat : Servlet is destroyed before serialization,Hi When I stop my tomcat  I have the following error :GRAVE: Exception au dﾃｩchargement des sessions vers le stockage persistant (persistent storage)java.lang.IllegalStateException: PageManager for application wicket not registered. at lm.lbx.application.PersistentPageManager$SessionEntry.getPageStore(PersistentPageManager.java:86) at lm.lbx.application.PersistentPageManager$SessionEntry.writeObject(PersistentPageManager.java:197) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source) at java.lang.reflect.Method.invoke(Unknown Source) at java.io.ObjectStreamClass.invokeWriteObject(Unknown Source) at java.io.ObjectOutputStream.writeSerialData(Unknown Source) at java.io.ObjectOutputStream.writeOrdinaryObject(Unknown Source) at java.io.ObjectOutputStream.writeObject0(Unknown Source) at java.io.ObjectOutputStream.writeObject(Unknown Source) at org.apache.catalina.session.StandardSession.writeObject(StandardSession.java:1561) at org.apache.catalina.session.StandardSession.writeObjectData(StandardSession.java:1004) at org.apache.catalina.session.StandardManager.doUnload(StandardManager.java:528) at org.apache.catalina.session.StandardManager.unload(StandardManager.java:469) at org.apache.catalina.session.StandardManager.stop(StandardManager.java:678) at org.apache.catalina.core.StandardContext.stop(StandardContext.java:4875) at org.apache.catalina.core.ContainerBase.stop(ContainerBase.java:1106) at org.apache.catalina.core.ContainerBase.stop(ContainerBase.java:1106) at org.apache.catalina.core.StandardEngine.stop(StandardEngine.java:468) at org.apache.catalina.core.StandardService.stop(StandardService.java:604) at org.apache.catalina.core.StandardServer.stop(StandardServer.java:788) at org.apache.catalina.startup.Catalina.stop(Catalina.java:662) at org.apache.catalina.startup.Catalina.start(Catalina.java:629) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source) at java.lang.reflect.Method.invoke(Unknown Source) at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:289) at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:414)After a little digging  it's because tomcat first unload the servlet mapping and destroy the servlet  and then  ask for serialization. I'm not sure it's a wiket bug  tell me if i have to report it against tomcat.Here is the trace of the destroy :Thread &#91;main&#93; (Suspended (breakpoint at line 357 in PersistentPageManager))  PersistentPageManager.destroy() line: 357  PageAccessSynchronizer$1(PageManagerDecorator).destroy() line: 86  LibellexApplication(Application).internalDestroy() line: 658  LibellexApplication(WebApplication).internalDestroy() line: 470  WicketFilter.destroy() line: 456  ApplicationFilterConfig.release() line: 357  StandardContext.filterStop() line: 4106  StandardContext.stop() line: 4869  StandardHost(ContainerBase).stop() line: 1106  StandardEngine(ContainerBase).stop() line: 1106  StandardEngine.stop() line: 468  StandardService.stop() line: 604  StandardServer.stop() line: 788  Catalina.stop() line: 662  Catalina.start() line: 629  NativeMethodAccessorImpl.invoke0(Method  Object  Object[]) line: not available &#91;native method&#93;  NativeMethodAccessorImpl.invoke(Object  Object[]) line: not available  DelegatingMethodAccessorImpl.invoke(Object  Object[]) line: not available  Method.invoke(Object  Object...) line: not available  Bootstrap.start() line: 289  Bootstrap.main(String[]) line: 414 And the trace requesting serialization :Thread &#91;main&#93; (Suspended (breakpoint at line 83 in PersistentPageManager$SessionEntry))  PersistentPageManager$SessionEntry.getPageStore() line: 83  PersistentPageManager$SessionEntry.writeObject(ObjectOutputStream) line: 197  NativeMethodAccessorImpl.invoke0(Method  Object  Object[]) line: not available &#91;native method&#93;  NativeMethodAccessorImpl.invoke(Object  Object[]) line: not available  DelegatingMethodAccessorImpl.invoke(Object  Object[]) line: not available  Method.invoke(Object  Object...) line: not available  ObjectStreamClass.invokeWriteObject(Object  ObjectOutputStream) line: not available  ObjectOutputStream.writeSerialData(Object  ObjectStreamClass) line: not available  ObjectOutputStream.writeOrdinaryObject(Object  ObjectStreamClass  boolean) line: not available  ObjectOutputStream.writeObject0(Object  boolean) line: not available  ObjectOutputStream.writeObject(Object) line: not available  StandardSession.writeObject(ObjectOutputStream) line: 1561  StandardSession.writeObjectData(ObjectOutputStream) line: 1004  StandardManager.doUnload() line: 528  StandardManager.unload() line: 469  StandardManager.stop() line: 678  StandardContext.stop() line: 4875  StandardHost(ContainerBase).stop() line: 1106  StandardEngine(ContainerBase).stop() line: 1106  StandardEngine.stop() line: 468  StandardService.stop() line: 604  StandardServer.stop() line: 788  Catalina.stop() line: 662  Catalina.start() line: 629  NativeMethodAccessorImpl.invoke0(Method  Object  Object[]) line: not available &#91;native method&#93;  NativeMethodAccessorImpl.invoke(Object  Object[]) line: not available  DelegatingMethodAccessorImpl.invoke(Object  Object[]) line: not available  Method.invoke(Object  Object...) line: not available  Bootstrap.start() line: 289  Bootstrap.main(String[]) line: 414 Well at this time  a simple dirty hack is to bypass destroy chain to avoid removal of app from managers properties of class PersistentPageManager. But I would like to have a real clean solution.,0,0
Allow for dynamic prefix and suffixes in CheckBoxMultipleChoice,Currently  CheckBoxMultipleChoice has support for a prefix and a suffix to be defined for each choice being rendered. However  there is no way to change them based on the item being rendered. A possible use case is in case some data needs to be used in either the suffix or prefix for Ajax or other javascript related use.Please consider adding getPrefix(int index  T choice)  and getSuffix(int index  T choice) methods to this component and using them instead of getPrefix() and getSuffix() within the onComponentTagBody method.,0,0
NullPointerException in PersistentPageManager's page cache,From a private email to me by a user:Hi I'm trying to use your gae-initializer to get your test application working on GAE. I'm using version 1.5-rc2 of wicket and your initializer. Using GAE sdk 1.4.2.I'm getting the same problem the person on the 1.5-rc1 release page was getting  and I can't get around it.The homepage loads  but the other page throws the same null pointer exception he was getting:java.lang.NullPointerException at org.apache.wicket.page.PersistentPageManager$SessionEntry.findPage(PersistentPageManager.java:117)....--------------------------------The problem is that org.apache.wicket.page.PersistentPageManager.SessionEntry.addPage(IManageablePage) adds even 'null' pages.,0,0
Link tries to construct the URL when the link is disabled,This piece of code (Link.onComponentTag) tries to construct the URL for a Link  even when it is disabled: CharSequence url = getURL(); url = appendAnchor(tag  url); if (!isLinkEnabled()) disableLink(tag); else { use url }getURL fails for us  because we did not expect it to be called for a disabled link. The constructed url is never used. Can the getURL and appendAnchor be moved inside the else?,0,0
Modify o.a.w.Component.send method signature to exactly match the one defined in superinterface,Current signature in Component:public final void send(IEventSink sink  Broadcast type  Object payload)This is an implementation of o.a.w.event.IEventSource.send:&lt;T&gt; void send(IEventSink sink  Broadcast broadcast  T payload)These are the same at runtime but the difference cause minor annoyance for Eclipse users. For example when creating a new page and defining the WebPage superclass in the wizard  Eclipse will generate a new class with a send method stub which has to be deleted by hand. Exact signatures fix this.,0,0
ResourceMapper doesn't work: mapHandler() always returns null,ResourceMapper#mapHandler uses the following code test whether a particular ResourceReferenceRequestHandler should be mapped:// see if request handler addresses the resource we serveif (resourceReference.getResource().equals(handler.getResource()) == false){ return null;}Unfortunately this if statement always evaluates to true and thus null is returned.The problem is that IResource implementations do not provide an equals() method. In practice this means that the default Object#equals() implementation is used  which nearly always results in false for the equality test.I see two possible solutions:1. Implement equals() for all IResource classes.2. Compare the ResourceReference objects instead  which already have a meaningful equals() implementation. In other words:// see if request handler addresses the resource we serveif (resourceReference.equals(handler.getResourceReference()) == false){ return null;}I'm attaching a quickstart that illustrates this bug.,0,0
HttpsMapper triggers rendering of incorrect absolute callback url for Link,This problem only occurs when HttpsMapper is installed as the root request mapper. Additionally  it only seems to occur when the web context is not root.I mount a simple page so that it is available as http://localhost:8080/myproject/pagetest. That page has one Link (the onclick doesn't do anything). If I access that exact url and show source I see the link callback is rendered incorrectly. It should have the web context mentioned. The fact that Wicket generates an absolute url makes me think the HttpsMapper.mapHandler is touching it in such a way to trigger an absolute url  when the delegate was returning a url expecting it to be relative.&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;body&gt;&lt;a wicket:id='test' href='http://localhost:8080/wicket/page?1-1.ILinkListener-test'&gt;Click Here&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;,0,0
SHOW_NO_EXCEPTION_PAGE responding with HTTP status 500 is overwritten by redirect,If the application is configured with SHOW_NO_EXCEPTION_PAGE as unexpectedExceptionDisplay  an exception thrown while submitting a form should result in an HTTP 500 status.Since the request is already marked as a redirect in AbstractListenerInterfaceRequestTarget#onProcessEvents()  the 500 status is overwritten with status 200 when the redirect is handled afterwards.,0,0
Proposal: merge upload progress monitoring functionality into wicket-core,Based on the dev list mailhttp://apache-wicket.1842946.n4.nabble.com/Proposal-merge-upload-progress-monitoring-functionality-into-wicket-core-td3346567.htmlI am attaching a patch that merges UploadWebRequest and MultipartRequest into their superclasses and moves UploadInfo class from extensions to core.,0,1
Make AjaxLink's URL more configurable,Currently AjaxLink uses AjaxEventBehavior which exposes just its getAjaxCallDecorator() to the user.It would be nice if there is a way to have access to the behavior callback url  e.g. to add some additional parameters  to set channel (wicket-ajax.js)  etc.As solution I suggest to add method 'AjaxLink#newAjaxBehavior()' which by default will return current AjaxEventBehavior but if the user wants she may override it with custom one. This way wicket stateless ajax behavior (see jolira's google code project) can be used as well without the need to re-write (copy/paste) the whole class.,0,0
Add possibility to test Resources/ResourceReferences with WicketTester,Currently WicketTester supports testing of Page  Panel and plain Component (startPage()  startPanel() and startComponent()).It would be good to have similar methods for testing resources and resource references.,0,0
Make Select component generic,Select component should be made generic  so it would be possible to use type safety with this form component.For example: Select&lt;String&gt; select = new Select&lt;String&gt;('select'  new Model&lt;String&gt;());,0,0
Using web.xml  to render error pages via Wicket yields undesired behavior in Wicket 1.5,In my applications I prefer to use Wicket to render all error pages  including my 404 'not found' page. This allows me to reuse a shared page template afforded by Wicket to create my error pages (i.e. by extending a BasePage)  rather than using copy and paste to maintain static error page HTML files.I have been doing this as follows:web.xml: &lt;error-page&gt; &lt;error-code&gt;404&lt;/error-code&gt; &lt;location&gt;/error/404&lt;/location&gt; &lt;/error-page&gt;Now  so long as I have an appropriate bookmarkable page mounted on the '/error/404' path  the servlet container will render my page whenever a 404 'not found' scenario is encountered.This works great in Wicket 1.4.x.However in Wicket 1.5 (RC2 and the latest SNAPSHOT as of this writing)  two problems occur:1. By default  Wicket 1.5 automatically performs a 302 redirect before rendering the error page. This changes the URL from the invalid one (i.e. the one that generated the 404) to the mounted path (/error/404 in this example). This is not the desired behavior for a 404 error page; the original URL requested by the user should be maintained.2. If I attempt to work around the issue by overriding WebPageRenderer.enableRedirectForStatelessPage() to return false  the problem gets worse. Now the URL doesn't change  which is good. But Wicket gets confused about the depth of the request URL path: it seems to calculate relative URLs based on the mounted path rather than the URL that was requested. This causes all relative resources on the page (e.g. stylesheet references) to be miscalculated and break.I will attach two quickstarts: one showing this configuration working in 1.4  and another showing the same setup failing as described above in 1.5-RC2.,0,0
Allow AttributeAppender to also prepend values,This add a flag to AttributeAppender which allows prepending a value to an attribute. This is useful for instance to add a javascript confirmation dialog before performing an action.,0,0
Reset the busy flag in Wicket.Channel if the execution of the callback fails for some reason,If a scheduled (in Wicket.Channel) callback fails for some reason (in my case because WicketAjaxDebug was not yet loaded) then the 'busy' flag for the channel remains 'true' until the page is reloaded.It would be better to try/catch the execution of the callback and reset the flag in case of an error.,0,0
Constructor of org.apache.wicket.PageReference should be public,The construcor of PageReference is not accessible (no qualifier  proteced). Is this for a reason? As far as I can see  a public qualifier would be nice as I rather often created an own class with a similar implementation (because I could not create an instance of PageReference).,0,0
RequestLogger doesn't dump its collected data at the end of the request,From an email in users@:Enabling with getRequestLoggerSettings().setRequestLoggerEnabled(true) doesnt show any requests.Seems that the Application.logEventTarget and Application.logResponseTarget are never invoked at all from the wicket-core nevertheless the get overridden in WebApplication???,0,0
Expose active requests via JMX,It'd be nice if RequestLogger.active was exposed via JMX in the same manner the RequestLogger.liveSessions.size() is. Moreover it'd be great to track and expose the peak number of concurrent (active) requests.,0,0
Autolink (AutolinkBookmarkablePageLink) already rendered problem,Using a menu panel that includes &lt;wicket:link&gt; to return to a page that includes a panel with a &lt;wicket:head&gt; element  gives:The component [AutolinkBookmarkablePageLink &#91;Component id = _autolink_X&#93;] was rendered already,0,0
onInitialize() is not called before StatelessForm.onSubmit(),I have a StatelessForm that has initialization code in onInitialize(). When my form is submitted  the onSubmit() method is invoked before onInitialize() is called. This results in a NullPointerException since the form has not yet had a chance to initialize its instance variables.I expect that onInitialize() will be called before any listener method is invoked.I believe this bug is due to the change in Page.onInitialize() introduced in r1085649.Quickstart attached.,0,0
Popup close link not working in wicket examples linkomatic page,To reproduce:visit http://localhost:8080/linkomatic/homeclick 'Click this button for a popup'click 'close' link,0,0
Add a link to the main page of Wicket Examples in the 'stateless' example page,The stateless page used to demonstrate stateless pages/sessions has no link to the main Wicket Examples page,0,0
CryptoMapper ignores the IProvider argument,CryptoMapper takes a IProvider&lt;ICrypt&gt; argument  and has a default ApplicationCryptoProvider  but always ignored the configured crypto provider and directly retrieves the application crypto provider.,0,0
Let AbstractResourceStreamWriter implement empty getContentType(),AbstractResourceStreamWriter's javadoc says it already:'Base implementation of an IResourceStreamWriter so that you only have to override the write() method'Actually I have to override getContentType() too  which is most of the time superfluous when the request target knows the resource's name and the type can be identified automatically .Please add an empty implementation to AbstractResourceStreamWriter.Thanks,0,0
AppendingStringBuffer.append(StringBuilder  int  int) interprets length as stopIndex,I got a StringIndexOutOfBoundsException while submitting Ajax from Wicket. It points to AppendingStringBuffer:508.The method StringBuilder.getChar expects the arguments (startIndex  stopIndex  buffer  count)AppendingStringBuilder provides (startIndex  length  buffer  count) =&gt; better use startIndex + length instead of length,0,0
NumberTextField and RangeTextField should always render/parse its value with English locale,Wicket started adding some support for the new Html5 input types. Among these are NumberTextField for number type &#91;1&#93; and RangeTextField for range type &#91;2&#93;. The Html5 spec mandates that the 'value'  'min'  'max' attributes for these inputs are floating point numbers. Html5 spec also describes the format of a float number &#91;3&#93;. Simply to say it is a number formatted with English locale (for example: decimal mark is a period).Wicket currently renders min and max spec compliant but renders the value wrong because it uses the client locale for that. Which means for example for a Hungarian client it will generate '3 14' instead '3.14'. This breaks the custom widgets used by browsers for these new inputs (Chrome and Opera have custom ui  FF and IE stil use plain text field) because they expect the value with a period decimal mark. This means that browsers will post the value formatted in English locale too so parsing is also broken for these on the wicket server side because the client locale is used there also.Imho wicket should always use the English locale for rendering/parsing these values in case of these input types.To reproduce you can use the form examples from 'wicket-html5-examples' in the wicketstuff project (I found this bug there).&#91;1&#93; Html5 input number type: http://dev.w3.org/html5/markup/input.number.html&#91;2&#93; Html5 input range type: http://dev.w3.org/html5/markup/input.range.html&#91;3&#93; Html5 float datatype: http://dev.w3.org/html5/markup/datatypes.html#common.data.float,0,0
DatePicker issues with locale medium date format,DateTextField as follows: DateTextField d = new DateTextField(id  model  new StyleDateConverter('M-' false));Case 1: en-US locale for example DatePicker insert 04 rather than Apr in DateTextField  even though pattern clearly says MMMCase 2: pl-PL locale 2010-10-25 is in the DateTextField DatePicker opens on April 2031 rather than October 2010I believe the problem lies in wicket-date.js  in functions substituteDate and parseDate.I know this might be duplicate of WICKET-2427 and WICKET-2375  but apparently this hasn't been properly fixed yet.,0,0
Ajax header-contribution omits IE conditional comments,We have a header contributor which writes an IE conditional comment to the header response for an IE-specific stylesheet.When the page is initially loaded  components on the page render with the IE conditional comment  and are displayed correctly.If a component is added by an ajax request  the header contributor renders the conditional comment to the ajax response  but the conditional comment is omitted from the page output.,0,0
ContainerFeedbackMessageFilter should use Objects.equal for equality checking,In its accept() method ContainerFeedbackMessageFilter currenlty uses 'container == message.getReporter();' but a sibling class ComponentFeedbackMessageFilter uses 'Objects.equal(component  message.getReporter());'.Probably both should behave the same way in this.,0,0
Using render strategy ONE_PASS_RENDER fails for Ajax requests,I have an application which has two pages. Page A has an AjaxLink which makes some checks and either sets some error feedback and stays on the same page (e.g. login page with 'Invalid user' error) or if everything is OK then redirects to page B (via setResponsePage(B.class)).The problem comes when the current render strategy is ONE_PASS_RENDER. In this case no matter that fromUrl and toUrl are different and the request is Ajax the current code directly writes the page markup to the response.I think it should trigger a redirect instead.I am not sure whether it should be redirect to render or to buffer ...,0,0
Application_pt.properties,I had my portuguese partner look at the Application_pt_BR.properties file ason her portuguese laptop the standard english messages showed up. Accordingto her the pt_BR file is also completely valid forApplicaiton_pt.properties. Can I suggest the file is just copied over tothat name?,0,0
Wicket do not test the 'buffer response' property in IRequestCycleSettings when creating the WebResponse in WebApplication,Wicket always create a buffered response. In 1.4 is was configurable.,0,0
Tree 1.4 to 1.5 migration issue warning,Different types of Trees produce the following warning in the console when displayed :WARN - aultMarkupSourcingStrategy - 1.4 to 1.5 migration issue: your item component should be derived from AbstractItem. Item=[TreeItem &#91;Component id = 0&#93;]Examples producing this warning :LinkTree  LabelTree and TreeTable from Ajax-&gt;Tree and TreeTable:'Nested' exampleFeel free to change the priority if this is not important.,0,0
Unable to override final method isLinkEnable of class AbstractLink,I have a form for which I need to disable all form components in certain situations.For this I am using form.setEnabled(false)  which works nicely for all input elements.However the form also contains a number of links (next to some fields)  which need to stay enabled.In the code of the onComponentTag method of the Link class I see the isLinkEnabled method is called to check if the link should be rendered enabled/disabled.In my Link subclass of I need to override isLinkEnabled to force the link being enabled even if the parent form is not.,0,0
BookmarkablePageLink :: setParameter int versions missing,the new URL handling &amp; page parameters allow to use an integer index (great!)however this has not been implemented in BookmarkablePageLink  so this needs to be added private void setParameterImpl(int key  Object value) { if (parameters == null) { parameters = new PageParameters(); } parameters.set(key  value); }and  public MyBookmarkablePageLink&lt;T&gt; setParameter(final int property  final String value) { setParameterImpl(property  value); return this; }(and the same for int and long values),0,0
MarkupResourceStream should use debug instead of info to log non-standard namespace,It is possible to use a non 'wicket' namespace name in markup (for example 'w'). However wicket logs this on info level for every markup file. Imho this is a bit verbose and should be done on the debug level instead. Also wicket should log 'namespace name' instead of 'component name' in this message.,0,0
UrlRenderer should not always add '.' to url,The fix in WICKET-3337 introduced a bug: now an url to a resource can be rendered differently if the base url changes.In practice this means that some js files can end up twice in a page DOM.First with the page load:'wicket/resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event-ts1303754909421.js'and'wicket/resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax-ts1303754909421.js'Secondly after an ajax event two 'new' js gets loaded:'./wicket/resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event-ts1303754909421.js'and'./wicket/resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax-ts1303754909421.js',0,1
parentFolderPlaceholder default value in Settings implementation is inconsistent with the javadoc,In relation to wicket-1992 the javadoc for: org.apache.wicket.settings.IResourceSettings#setParentFolderPlaceholdersays:'Note that by default the placeholder string is empty '' and thus will not allow to access parent folders.'But the default is null  not ''and this generates src url like this: resources/com.test.sub.pack.TestPage/null/null/base/information.pngwhich do work  but probably shouldn't.,1,0
Add converter for Calendar class,Wicket has built in converter for a lot of date/time types (4 in wicket-util  2 in wicket-datetime) but not for Calendar. As Calendar is imho the most usable date/time object in standard java it would be nice if wicket would support it out of box.,0,0
IHeaderResponse.renderJavaScriptReference does not support the 'defer' attribute,It would allow some nice optimization to allow to add script tags with a defer attribute like :&lt;script type='text/javascript' defer='true' src='myScript.js'&gt;&lt;/script&gt;I do not see any way to add the defer attribute right now.,0,0
element in Ajax requests is executed twice in Opera 11,I have component with behavior which adds &lt;script&gt; element in Behavior.onComponentRendered() to respons. This javascript is to be processed in browser when component is rendered. This works pretty well when component is rendered during standard HTTP request. But when the same code is called from Ajax request  this script runs on browser two times! There is some magic in Ajax request processing in wicket-ajax.js: only for Opera and IE these &lt;script&gt; elements from responses are added to HTML and page &lt;header&gt; element as well. Comment says that this is workaround for these browsers  maybe in older versions of Opera dynamically adding element into HTML doesn't run &lt;script&gt; elements within  but now could be obsolete.,0,1
Usage of JavaScriptCompressor by resources other than PackageTextTemplates is lost!,With the refactoring of ResourceReferences  Resources and ResourceStreams it seems that the JavaScriptCompressor is no longer used for resources other than a PackageTextTemplate. In Wicket 1.4 it used to be in JavascriptPackageResource but seeing as this class is gone the JavaScriptCompressor is no longer used.There should be either a subclass of PackageResource which uses the JavaScriptCompressor or a way to intercept the length and the bytes which are written to the stream in PackageResource line 327.,0,0
Improve WebClientInfo logic to extract the exact browser version,A colleague of mine gave some love to WebClientInfo and improved the logic to extract information which browser and its major/minor version.This way it is quite easy to generate something like:&lt;html class='ie7'&gt;  or even &lt;html class='ff3.7'&gt;  ...instead of using IE conditional comments for IE and no way to do that for FF/Chrome/Safari.,0,0
Make Objects.convertValue() generic,o.a.w.util.lang.Objects.convertValue(Object  Class) should use generics similar how it was changed for IConverter.convertToObject().The bad news is that this change is changing the semantics of the function because currently it is sometimes returning the input object (if the conversion was not possible). The good news is that this modification only impacts a small part of wicket.,0,0
Split IHeaderContributor into IHeaderContributor and IComponentAwareHeaderContributor to make implementation cleaner,,0,0
WebPage cannot find the head container if TransparentWebMarkupContainer is associated with,If a page uses TransparentWebMarkupContainer to set some attributes to the &lt;html&gt; tag then org.apache.wicket.markup.html.WebPage.validateHeaders() cannot find the HtmlHeaderContainer because it expects to find it at the first level of children tree.,0,0
Session is invalidated more than once because Session.sessionInvalidated is not reset,org.apache.wicket.Session.detach() invalidates the http session and null-ifies the sessionStore but doesn't reset 'sessionInvalidated' variable and later if a new session store is created (e.g. during commitRequest &#91;1&#93;) then this new session store is again destroyed at the end.1.Thread &#91;qtp1917759555-26&#93; (Suspended (breakpoint at line 80 in RequestAdapter))  PersistentPageManager$PersitentRequestAdapter(RequestAdapter).bind() line: 80  PersistentPageManager$PersitentRequestAdapter.getSessionEntry(boolean) line: 339  PersistentPageManager$PersitentRequestAdapter.storeTouchedPages(List&lt;IManageablePage&gt;) line: 373  PersistentPageManager$PersitentRequestAdapter(RequestAdapter).commitRequest() line: 185  PersistentPageManager(AbstractPageManager).commitRequest() line: 94  PageAccessSynchronizer$1(PageManagerDecorator).commitRequest() line: 68  PageAccessSynchronizer$1.commitRequest() line: 203  Application$2.onDetach(RequestCycle) line: 1522  RequestCycleListenerCollection$3.notify(IRequestCycleListener) line: 100  RequestCycleListenerCollection$3.notify(Object) line: 95  RequestCycleListenerCollection(ListenerCollection&lt;T&gt;).reversedNotify(Iterator&lt;T&gt;  INotifier&lt;T&gt;) line: 121  RequestCycleListenerCollection(ListenerCollection&lt;T&gt;).reversedNotify(INotifier&lt;T&gt;) line: 112  RequestCycleListenerCollection.onDetach(RequestCycle) line: 94  RequestCycle.onDetach() line: 547  RequestCycle.detach() line: 479  RequestCycle.processRequestAndDetach() line: 257  WicketFilter.processRequest(ServletRequest  ServletResponse  FilterChain) line: 138  WicketFilter.doFilter(ServletRequest  ServletResponse  FilterChain) line: 194 ...,0,1
WicketTester.startComponent(Class  Markup) doesn't deliver the contributed response to the headers,There is a regression from RC3 with starting a Panel. The header contribution is not in the 'lastRenderedPageAsString'.See attached test case.,0,0
Component.getAjaxRegionMarkupId loops over all behaviors even if markupId is found,In the Component getAjaxRegionMarkupId consider changing: for (Behavior behavior : getBehaviors()) { if (behavior instanceof IAjaxRegionMarkupIdProvider) { markupId = ((IAjaxRegionMarkupIdProvider)behavior).getAjaxRegionMarkupId(this); }  }to for (Behavior behavior : getBehaviors()) { if (behavior instanceof IAjaxRegionMarkupIdProvider) { markupId = ((IAjaxRegionMarkupIdProvider)behavior).getAjaxRegionMarkupId(this); break; }  },0,0
Please improve ErrorMessage for WicketTester#assertRenderedPage,If WicketTester#assertRenderedPage fails  the errormessage does only say 'classes not same' this is sufficient  but can be improved.At least expected PageClass and Current Page Class should be printed out in the message.,0,0
wickettag contents aren't skipped when trying to find markup in 1.5,The attached quick start  fails to render the components inside the fragment  because it will pick the &lt;span wicket:id='text'&gt; instead of the fragment as markup.I believe the id are only required to be unique 'per level'  so this should work and it should properly find the &lt;wicket:fragment wicket:id='text'&gt;. This also worked fine in 1.4,0,0
MultiFileUploadField internationalisation does not work,We are having an issue setting some properties to override the default text for the MultiFileUploadField component. As per the docs  we have set the following in our local properties file:org.apache.wicket.mfu.caption.unlimited=Ficheros:org.apache.wicket.mfu.caption.limited=Ficheros (m/u00E1ximo ${max}): org.apache.wicket.mfu.delete=Borrarhowever they are not being overridden. We know our properties file is working because we can override other properties  like:workphone.PhoneNumberValidator = N/u00FAmero de tel/u00E9fono no v/u00E1lidoand those come up correctly.I have reproduced this in a quickstart.,0,0
Allow filtering and grouping of resources in the,With DecoratingHeaderResponse and few supporting classes it is possible currently to group and filter header contributions  e.g. to render all JavaScript resources just before the closing tag of the body (&lt;/body&gt;). See http://www.wicket-library.com/wicket-examples/resourceaggregation for an example in action.Unfortunately it is not possible to use the grouping feature in the &lt;head&gt; tag currently because HtmlHeaderContainer first renders its body and then asks for other components' header contributions. While rendering its body it tries to render the placeholder for the header group and fails at org.apache.wicket.resource.filtering.HeaderResponseFilteredResponseContainer.onComponentTagBody(MarkupStream  ComponentTag) saying that the IHeaderResponse is not closed yet.To allow this I'm suggesting a patch that will first collect other components' header contribution  then close the IHeaderResponse and finally collect the &lt;head&gt;'s body. At the end it will render the head's body first and then the header contributions as it is now.,0,0
extremely slow performance in development mode,I just finished migrating application to 1.5 and it became VERY unresponsive and slow in development mode. In deployment it is OK.No changes were made to backend services  only necessary Wicket API use changes related to request cycle.=======================Below is the originals bug: WICKET-3194Hello  I had a problem with slow loading of pages and response to ajax requests. After some debugging I traced the problem to be that wicket constantly tries: DEBUG - UrlResourceStream - cannot convert url: jar:file:/C:/Users/hok/.m2/repository/org/apache/wicket/wicket/1.5-M3/wicket-1.5-M3.jar!/org/apache/wicket/markup/html/wicket-event.js to file (URI is not hierarchical)  falling back to the inputstream for polling DEBUG - ResourceStreamLocator - Attempting to locate resource 'org/apache/wicket/markup/html/wicket-event_en_US.js' on path [folders = []  webapppaths: []] DEBUG - ResourceStreamLocator - Attempting to locate resource 'org/apache/wicket/markup/html/wicket-event_en_US.js' using classloader sun.misc.Launcher$AppClassLoader@cac268 and this happens because that by default (or at least I think so) wicket adds timestamp on the resources - ResourceSettings.setUseTimestampOnResources(true) and every resource is read from the jar files on every request. When a resource is in a jar file a java.lang.IllegalArgumentException: URI is not hierarchical is thrown in the UrlResourceStream constructor and a lot of attempts are made to load the jar file through different loaders. In my case this led to a slow response times. After disabling timestamp on resources (ResourceSettings.setUseTimestampOnResources(false)) the problem disappears and the performance is fine. However in the javadoc of setUseTimestampOnResources: Enabling timestamps on resources will inject the last modification time of the resource into the filename (the name will look something like 'style-ts1282915831000.css' where the large number is the last modified date in milliseconds and '-ts' is a prefix to avoid conflicts with filenames that already contain a number before their extension. * Since browsers and proxies use the filename of the resource as a cache key the changed filename will not hit the cache and the page gets rendered with the changed file.In this case this useful functionality is lost. Is it possible to have 'the best of both worlds'? Thanks.This issue is raised from the discussion:http://apache-wicket.1842946.n4.nabble.com/IResourceSettings-setUseTimestampOnResources-true-and-performance-td3057946.htmlTo observe the performance improvement  please changegetResourceSettings().setUseTimestampOnResources(true);togetResourceSettings().setUseTimestampOnResources(false);in TestApplication. It's most obvious when you press Refresh All link and observe the time for the refresh in both cases,0,1
npe in StoredResponsesMap,While doing some load testing with with a small prog using Apache httpclient (45 threads  only the get requests were done) I got this error17:59:22.086 ERROR &#91;&quot;http-bio-8080&quot;-exec-1&#93; DefaultExceptionMapper - 108 - Unexpected error occurredjava.lang.NullPointerException: null at org.apache.wicket.protocol.http.StoredResponsesMap$Value.access$000(StoredResponsesMap.java:37) ~&#91;wicket-core-1.5-RC4.2.jar:1.5-RC4.2&#93; at org.apache.wicket.protocol.http.StoredResponsesMap.removeEldestEntry(StoredResponsesMap.java:73) ~&#91;wicket-core-1.5-RC4.2.jar:1.5-RC4.2&#93; at java.util.LinkedHashMap.addEntry(LinkedHashMap.java:410) ~&#91;na:1.6.0_22&#93; at java.util.HashMap.put(HashMap.java:385) ~&#91;na:1.6.0_22&#93; at org.apache.wicket.protocol.http.StoredResponsesMap.put(StoredResponsesMap.java:95) ~&#91;wicket-core-1.5-RC4.2.jar:1.5-RC4.2&#93; at org.apache.wicket.protocol.http.WebApplication.storeBufferedResponse(WebApplication.java:723) ~&#91;wicket-core-1.5-RC4.2.jar:1.5-RC4.2&#93; at org.apache.wicket.request.handler.render.WebPageRenderer.storeBufferedResponse(WebPageRenderer.java:73) ~&#91;wicket-core-1.5-RC4.2.jar:1.5-RC4.2&#93; at org.apache.wicket.request.handler.render.WebPageRenderer.respond(WebPageRenderer.java:258) ~&#91;wicket-core-1.5-RC4.2.jar:1.5-RC4.2&#93; at org.apache.wicket.request.handler.RenderPageRequestHandler.respond(RenderPageRequestHandler.java:139) ~&#91;wicket-core-1.5-RC4.2.jar:1.5-RC4.2&#93; at org.apache.wicket.request.cycle.RequestCycle$HandlerExecutor.respond(RequestCycle.java:718) ~&#91;wicket-core-1.5-RC4.2.jar:1.5-RC4.2&#93; at org.apache.wicket.request.RequestHandlerStack.execute(RequestHandlerStack.java:63) ~&#91;wicket-request-1.5-RC4.2.jar:1.5-RC4.2&#93; at org.apache.wicket.request.RequestHandlerStack.execute(RequestHandlerStack.java:96) ~&#91;wicket-request-1.5-RC4.2.jar:1.5-RC4.2&#93; at org.apache.wicket.request.cycle.RequestCycle.processRequest(RequestCycle.java:212) &#91;wicket-core-1.5-RC4.2.jar:1.5-RC4.2&#93; at org.apache.wicket.request.cycle.RequestCycle.processRequestAndDetach(RequestCycle.java:253) &#91;wicket-core-1.5-RC4.2.jar:1.5-RC4.2&#93; at org.apache.wicket.protocol.http.WicketFilter.processRequest(WicketFilter.java:138) &#91;wicket-core-1.5-RC4.2.jar:1.5-RC4.2&#93; at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:194) &#91;wicket-core-1.5-RC4.2.jar:1.5-RC4.2&#93; at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243) &#91;catalina.jar:7.0.12&#93; at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210) &#91;catalina.jar:7.0.12&#93;via jmx I could see that only 45 sessions were thereand that the PeakNumberOfActiveRequests was also 45.,0,0
wicket-datetime datepicker fails to display calendar with js error in calendar.js:3225 in IE8,,0,0
Scalability issue with PageAccessSynchronizer,Class org.apache.wicket.page.PageAccessSynchronizer uses a global lock (org.apache.wicket.page.PageAccessSynchronizer.semaphore) that is needed e.g. when a new instance of a Page is created or when an instance of a page is retrieved  The lock is global and becomes quickly contented. When testing with two parallel threads  about 20% of all statistical stack samples waited for the lock  with four parallel threads about 50%.The stack waiting for the lock isat org.apache.wicket.page.PageAccessSynchronizer.lockPage(PageAccessSynchronizer.java:119)at org.apache.wicket.page.PageAccessSynchronizer$1.getPage(PageAccessSynchronizer.java:187)called either byat org.apache.wicket.Page.dirty(Page.java:327)as part of the Page ctor  or byat org.apache.wicket.DefaultMapperContext.getPageInstance(DefaultMapperContext.java:117)when retrieving page.Some threads' stacks:waiting on (a java.lang.Object@0xHEXADDR)at org.apache.wicket.page.PageAccessSynchronizer.lockPage(PageAccessSynchronizer.java:119)at org.apache.wicket.page.PageAccessSynchronizer$1.getPage(PageAccessSynchronizer.java:187)at org.apache.wicket.DefaultMapperContext.getPageInstance(DefaultMapperContext.java:117)at org.apache.wicket.request.handler.PageProvider.getPageInstance(PageProvider.java:246)at org.apache.wicket.request.handler.PageProvider.getPageInstance(PageProvider.java:159)at org.apache.wicket.request.handler.ListenerInterfaceRequestHandler.getPage(ListenerInterfaceRequestHandler.java:89)at org.apache.wicket.request.handler.ListenerInterfaceRequestHandler.respond(ListenerInterfaceRequestHandler.java:141)at org.apache.wicket.request.cycle.RequestCycle$HandlerExecutor.respond(RequestCycle.java:718)at org.apache.wicket.request.RequestHandlerStack.execute(RequestHandlerStack.java:63)at org.apache.wicket.request.cycle.RequestCycle.processRequest(RequestCycle.java:212)at org.apache.wicket.request.cycle.RequestCycle.processRequestAndDetach(RequestCycle.java:253)at org.apache.wicket.protocol.http.WicketFilter.processRequest(WicketFilter.java:138)at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:194)....at java.lang.Object.wait(Native Method)waiting on (a java.lang.Object@0xHEXADDR) at org.apache.wicket.page.PageAccessSynchronizer.lockPage(PageAccessSynchronizer.java:119)at org.apache.wicket.page.PageAccessSynchronizer$1.touchPage(PageAccessSynchronizer.java:194)at org.apache.wicket.Page.dirty(Page.java:327)at org.apache.wicket.Page.init(Page.java:770)at org.apache.wicket.Page.&lt;init&gt;(Page.java:223)at org.apache.wicket.Page.&lt;init&gt;(Page.java:202)at org.apache.wicket.markup.html.WebPage.&lt;init&gt;(WebPage.java:99)at x.y.z.page.base.Page.&lt;init&gt;(Page.java:100)at x.y.z.page.base.ControllerBasedPage.&lt;init&gt;(ControllerBasedPage.java:41)....at java.lang.Object.wait(Native Method)waiting on (a java.lang.Object@0xHEXADDR) at org.apache.wicket.page.PageAccessSynchronizer.lockPage(PageAccessSynchronizer.java:119)at org.apache.wicket.page.PageAccessSynchronizer$1.touchPage(PageAccessSynchronizer.java:194)at org.apache.wicket.Page.dirty(Page.java:327)at org.apache.wicket.Page.init(Page.java:770)at org.apache.wicket.Page.&lt;init&gt;(Page.java:223)at org.apache.wicket.Page.&lt;init&gt;(Page.java:202)at org.apache.wicket.markup.html.WebPage.&lt;init&gt;(WebPage.java:99)at x.y.z.page.base.Page.&lt;init&gt;(Page.java:100)at x.y.z.page.base.ControllerBasedPage.&lt;init&gt;(ControllerBasedPage.java:41)at x.y.z.page.NavigationAndContent.&lt;init&gt;(NavigationAndContent.java:43)at x.y.z.page.MailDetail.&lt;init&gt;(MailDetail.java:84)x.y.z.page.login.Login.&lt;init&gt;-wicket.Page.&lt;init&gt;-wicket.page.PageAccessSynchronizer.lockPage-WAIT_FOR_LOCKat java.lang.Object.wait(Native Method)waiting on (a java.lang.Object@0xHEXADDR) at org.apache.wicket.page.PageAccessSynchronizer.lockPage(PageAccessSynchronizer.java:119)at org.apache.wicket.page.PageAccessSynchronizer$1.touchPage(PageAccessSynchronizer.java:194)at org.apache.wicket.Page.dirty(Page.java:327)at org.apache.wicket.Page.init(Page.java:770)at org.apache.wicket.Page.&lt;init&gt;(Page.java:223)at org.apache.wicket.Page.&lt;init&gt;(Page.java:202)at org.apache.wicket.markup.html.WebPage.&lt;init&gt;(WebPage.java:99)at x.y.z.page.base.Page.&lt;init&gt;(Page.java:100)at x.y.z.page.login.Login.&lt;init&gt;(Login.java:23).....at java.lang.Object.wait(Native Method)waiting on (a java.lang.Object@0xHEXADDR) at org.apache.wicket.page.PageAccessSynchronizer.lockPage(PageAccessSynchronizer.java:119)at org.apache.wicket.page.PageAccessSynchronizer$1.touchPage(PageAccessSynchronizer.java:194)at org.apache.wicket.Page.dirty(Page.java:327)at org.apache.wicket.Page.init(Page.java:770)at org.apache.wicket.Page.&lt;init&gt;(Page.java:223)at org.apache.wicket.Page.&lt;init&gt;(Page.java:202)....at java.lang.Object.wait(Native Method)at org.apache.wicket.page.PageAccessSynchronizer.lockPage(PageAccessSynchronizer.java:119)at org.apache.wicket.page.PageAccessSynchronizer$1.touchPage(PageAccessSynchronizer.java:194)at org.apache.wicket.Page.dirty(Page.java:327)at org.apache.wicket.Page.init(Page.java:770)at org.apache.wicket.Page.&lt;init&gt;(Page.java:223)at org.apache.wicket.Page.&lt;init&gt;(Page.java:202).....,0,1
Add RestartResponseException constructors to specify a RedirectPolicy,Since Wicket 1.5 uses RedirectPolicy.AUTO_REDIRECT  it would be good to be able to specify an explicit other policy.We often use this in cases we need to redireect  even though the AUTO_REDIRECT might choose not to do so (the reason being to transport cookies/new session to the user between those requests). Also in some rare cases we need to force a NEVER_REDIRECT for a certain page in order to keep the URL as is.It would be great if there were overloaded constructors to specify the RedirectPolicy for the RenderPageRequestHandler.,0,0
throw new RestartResponseAtInterceptPageException is not serializable,throw new RestartResponseAtInterceptPageException gives:org.apache.wicket.RestartResponseAtInterceptPageExceptionERROR - Error serializing object class org.apache.wicket.markup.html.pages.ExceptionErrorPage [object=&#91;Page class = org.apache.wicket.markup.html.pages.ExceptionErrorPage  id = 1  render count = 1&#93;]org.apache.wicket.util.io.SerializableChecker$WicketNotSerializableException: Unable to serialize class: org.apache.wicket.request.flow.ResetResponseException$ResponseResettingDecoratorField hierarchy is: 1 &#91;class=org.apache.wicket.markup.html.pages.ExceptionErrorPage  path=1&#93; private final java.lang.Throwable org.apache.wicket.markup.html.pages.ExceptionErrorPage.throwable &#91;class=org.apache.wicket.RestartResponseAtInterceptPageException&#93; private final org.apache.wicket.request.IRequestHandler org.apache.wicket.request.RequestHandlerStack$ReplaceHandlerException.replacementRequestHandler &#91;class=org.apache.wicket.request.flow.ResetResponseException$ResponseResettingDecorator&#93; &lt;----- field that is not serializable,0,0
Touch the page only when it is just read from the page store,Currently PageProvider#getPageInstance() 'touches' the page for each call  i.e. schedules it to be persisted at the end of the request life. This always goes to PageAccessSynchronizer#touchPage() and respectively #lockPage().With the suggested patch this will be done at most once per PageProvider#getPage().This change causes some tests related to error pages to fail. The problem is that ALWAYS_REDIRECT is used for error pages thus REDIRECT_TO_RENDER strategy which expects the page to be stored before the redirect. Changing it to AUTO_REDIRECT leads to the default REDIRECT_TO_BUFFER to be used and the problem is solved because the response is buffered in the special map and the page is not needed after the redirect.,0,0
unexpected order of head contributions,when markup uses w-head contribution for static scripts&lt;wicket:head&gt; &lt;script type='text/javascript' src='http://link.from.markup/h.js' &gt;&lt;/script&gt;&lt;/wicket:head&gt;and then component adds something dynamically in renderHead@Override public void renderHead(IHeaderResponse response) { super.renderHead(response); response.renderJavaScriptReference('http://link.from.renderheadmethod/body.js'); }the dynamic link comes first and therefore does not work  repro case attachedExpected: that programmatic contributions use after ones from markup,0,0
html file are not encoding to utf-8,The file SignOutPage_fr.html (all html file) is not properly encoding to utf-8  the accent 'Dﾃｩconnexion' is not display correctly on browser.,0,0
Warning text outdated in InheritedMarkupMarkupLoader,' Enable debug messages for org.apache.wicket.util.resource.Resource to get a list of all filenames tried.');--&gt; org.apache.wicket.util.resource.Resource no longer exists. Looks like it has been renamed to org.apache.wicket.util.resource.locator.ResourceStreamLocator.,0,0
Differentiate Google Chrome from Safari in wicket-xyz.js,Currently Google Chrome is treated as Safari in wicket-ajax.js and wicket-event.js.This causes Wicket.replaceOuterHtmlSafari() to be used while Chrome supports Range and ContextualFragment like Gecko browsers.The special code in replaceOuterHtmlSafari() is for older versions of Safari but it is hard to test  so improvements in this area for Safari 5 will be done when Wicket Ajax starts use some JS library.This change is a bit risky because until now Chrome was treated as Safari and we all tested this behavior but I tested all Ajax examples in wicket-examples and my application and everything seems to be OK.,0,0
CheckGroup's model update should be aligned with ListMultipleChoice,Please improve CheckGroup to handle its model updates as ListMultipleChoice does  allowing a model to be notified of changes. See attached patch.,0,0
wicket FileChannelPool has scalability issues,I benchmarked the FileChannelPool  which is used in the pagemanager's DiskStore  against a simple unpooled 'new RandomAccessFile(name  'rw').getChannel()' implementation. The filechannelpool caches 50 handles by default to 50 session diskstore files  and keeps these handles open as long as possible or necessary.The benchmark results are performed from 1 to 8 threads and with active file set size varied. I tested 10  50  60 and 100 active files. To understand the results  FCP stands for the time spent on wicket's FileChannelPool. FC stands for time spent on unpooled FileChannel.The times are the time it took to perform 100000 per thread of the following: open a randomly chosen file from set of active files read a randomly positioned 10k chunk of a simulated session file that is 100000 bytes long (seek to 0 .. 90000 and then read 10000 bytes) close fileResults for 10 files: FCP: 79 161 318 481 763 1239 1355 1423 ms FC: 531 660 848 859 1141 1285 1372 1509 msResults for 50 files: FCP: 82 165 323 516 756 1248 1560 1587 ms FC: 529 666 800 851 1150 1268 1389 1490 msResults for 60 files: FCP: 219 857 2535 3669 4584 5641 6443 7235 ms FC: 520 639 901 1034 1196 1314 1501 1559 msResults for 100 files: FCP: 471 3588 5989 7814 10048 11790 13580 15130 ms FC: 547 667 903 1093 1195 1388 1446 1603 msBonus result: near worst case behavior of filechannelpool of just 10 cached channels and 100 files active set: FCP: 744 4669 8182 11295 14934 17799 21959 24964 ms FC: 549 681 905 1112 1338 1383 1440 1564 msDiscussion of the results: it appears that there is little difference in performance on the unpooled file channel for any active set size. This is not unexpected: there are no synchronization points and the kernel doesn't much care either way  because all these files together only took 100 * 100k of memory  or about 10 MB &#8211; easily cached entirely in my 4 GB. However  the FileChannelPool shows significant performance degradation as soon as the active set exceeds the pool's size. It seems to perform order of magnitude worse with 100 files as opposed to 50  indicating that wicket websites may suffer rapid performance degradation under load. In case the number of active sessions is much larger than the pool  the very worst behavior is simulated as the last result.FileChannelPool's key problem is that it optimizes performance for the lightly loaded case  and actually harms performance when load gets higher. The harm is not much &#8211; in the worst case  only something like 29 microseconds per request &#8211; but the best case win isn't great either  about 5.6 microseconds per request (10 files  1 thread). In the interests of simplifying pageStore  I propose deleting FileChannelPool entirely.,0,1
ModalWindow shows 'Page Expired',A simple ModalWindow containing a WebPage opened by an AjaxLink shows 'Page Expired' instead of the desired page contents. Downgrading to 1.4.17 makes the problem disappear. See the attached quickstart.,0,0
Simplify BrowserInfoPage by using InterceptData,http://localhost:8080/hellobrowser/ application is broken in current trunk.The problem is that it calculates the 'continueTo' url too soon (before render time) and the generated url is wrong relative to the URL of the page that is going to be rendered.The whole concept can be greatly simplified by using org.apache.wicket.RestartResponseAtInterceptPageException.,0,0
Remove duplicated resource resolution logic,PackageResourceReference#lookupStream( locale  style  variation) and ResourceNameIterator duplicates the path sufix logic used to resolve the resource,0,0
Prevent ResourceNameIterator from iterate the same name twice,To reproduce: public void test() { String path = 'test_patch.test_extension'; String style = null; String variation = 'var'; Locale locale = Locale.getDefault(); String extensions = null; boolean strict = false; ResourceNameIterator resourceNameIterator = new ResourceNameIterator(path  style  variation  locale  extensions  strict); while (resourceNameIterator.hasNext()) { System.out.println(resourceNameIterator.next()); } },0,0
Localizer.get() should be static,org.apache.wicket.Localizer offers a get() method but it is not static.,0,0
LinkType inner class is duplicated,Both o.a.w.markup.html.tree.BaseTree and o.a.w.extensions.markup.html.tree.DefaultAbstractTree classes define the same LinkType inner class. Imho this duplication should be removed.,0,0
some jmx values are not working since they require wickets filter environment (application  session  etc.),,0,0
RequestLogger doesn't log incoming event and outgoing page,The requestlogger currently doesn't log the incoming request and the outgoing page  which it did in 1.4.x (and earlier). This is due togetRequestLogger().logEventTarget(handler);getRequestLogger().logResponseTarget(handler);not being called. This results in log entries like:&#91;2011-06-22 11:43:20 836&#93; &#91;TP-Processor6&#93; RequestLogger | time=12 event=null response=null sessioninfo=...which isn't saying much  and making every presentation I gave on the RequestLogger  and chapter 14 from WiA look foolish,0,0
WicketTester does not follow absolute redirects,Wicket tester does not follow absolute redirects:This is a problem when using HttpsMapper. For example when requesting a page over http:// with an forced redirect to https:// for secure access will make wicket tester return 'null' for the last renderer page instead of the rendered page instance. In general all kinds of absolute redirects to another page will not be tracked by wicket tester. So this potentially a problem for all kinds of tests that rely on absolute redirects.,0,0
In wicket 1.5 urlFor returns incorrect string for package mounted pages,Attached two quickstart projects for 1.4 and 1.5.Then access http://localhost:8080/app/Page1 and see 1.5 returns wrong address.,0,0
The wicket:enclosure attribute doesn't work properly,When the hidden child becomes visible again  it fails to appear on the page. The same thing works correctly with the wicket:enclosure tag.Example code:public class TestPage extends WebPage { public TestPage() { final Label l = new Label('msg'  'hi'); add(l); add(new Link&lt;Void&gt;('b') { private static final long serialVersionUID = 1L; @Override public void onClick() { l.setVisible(!l.isVisible()); } }); }}TestPage.html:&lt;html xmlns:wicket&gt;&lt;body&gt;&lt;div wicket:enclosure='msg'&gt;&lt;span wicket:id='msg'&gt;&lt;/span&gt;&lt;/div&gt;&lt;input type='button' value='Toggle' wicket:id='b'&gt;&lt;/body&gt;&lt;/html&gt;,0,0
in environments without reliable timestamps (e.g. some clusters) resource caching is useless,As mentioned already in the wicket userlist iirc wicket's default resource caching strategy using resource file timestamps will not work in some cluster environments. Cluster deployers seem to be quite dumb and not preserve the 'lastModified' file attribute. So depending on the server instance the resource is delivered from it will contain multiple timestamps for the same resource. Apparently timestamps seem to be unsuitable for the purpose of caching in that environment.,0,0
Modal window won't show in internet explorer document mode 8,Plain modal window won't show after revision 1135146  WICKET-3782 Notifications before and after DOM node replacement (...) using Internet Explorer 9 in document mode quirks  7 and 8. Works in document mode 9  Opera 11.11  Chrome 13.0.782.32 beta-m  Firefox 3.6.18 and 5.0Seems like the lines:var newElement = Wicket.$(element.id);Wicket.Event.publish('/dom/node/added'  newElement);the 2nd time they run  element.id = ''  which makes Wicket.$ (document.getElementById('')) crash  and an 'ERROR: Wicket.Ajax.Call.processEvaluation: Exception evaluating javascript: &#91;object Error&#93;' is logged to the Wicket ajax debug window.Quick workaround: Somewhere in your code  include the following script: &lt;script type='text/javascript'&gt; oldFu = Wicket.$; Wicket.$ = function(arg) { if (arg == null || typeof(arg) == 'undefined' || arg == '') { return null; } return oldFu(arg); }&lt;/script&gt;Where the difference to the original $ function is the arg=='' check,0,0
make PropertiesFactory easier to use outside of wicket scope,In relation to WICKET-3850  it'd be nice if PropertiesFactory didn't rely on Application at all  but rather on the only part of the Application it uses: IResourceSettings.,0,0
StoredResponsesMapTest Random.nextInt takes only positive integer arguments  not 0,In the test StoredResponsesMapTest the line: String key2 = keys.get(rnd.nextInt(keys.size() - 1));has a problem since the integer argument to Random.nextInt can not be 0  but the keysList has size 1.,0,0
AbstractTransformerBehavior sets wrong namespace,AbstractTransformerBehaviour adds a wicket namespace (http://wicket.apache.org) to its tag which is different from that of the whole page (http://wicket.apache.org/dtds.data/wicket-xhtml1.4-strict.dtd).This causes (at least) XPath queries for Wicket nodes to fail when matching the contents of components with an AbstractTransformerBehavior.,0,0
URIs should be used instead of URLs as Set or Map keys.,URLs are not suitable for use as Set or Map keys because their equals() and hashCode() methods are not well defined. URIs should be used to identify the location and URLs to access the actual resources.See thread for http://mail-archives.apache.org/mod_mbox/wicket-users/201107.mbox/%3CCAPdiUN6CaH9rn4+tD9_hXP-dmBGn-SvFu=RvCMh8AYx5_1JkkA@mail.gmail.com%3ESpecifically:&#91;1&#93; 'More Joy of Sets' example with URL from Google Tech Talks:http://www.youtube.com/watch?v=wDN_EYUvUq0#t=9m58s,0,0
Allow validators to detach by mixing in IDetachable,,0,0
Reference to a non-existing images causes IllegalStateException 'ResourceResponse#setWriteCallback() must be set.',A Page containing a PackageResourceReference to a nonexisting image fails with an Illegalstateexception. Debugging through the code reveals that hust before this exception a 404 HTTP Code ist set. This 404 gets hidden by the exception.I could not script a unittest for this problem  but it is easily reproduced in my browsers (Firefox 4  IE 8). A page class and html will be attached,0,0
setResponsePage in AjaxLink goes always to localhost:8080 instead to the right host and port,setResponsePage in an AjaxLink in Wicket 1.4 redirects with a relative path to the response page.Wicket 1.5 takes the absolute path 'localhost:8080/path to the response page' even when the host and port are different.(e.g. with Apache2 a virtual host is created with server name www.mycompany.com  setResponce wil go to 'localhost:8080/path to page' instead of 'www.mycompany.com/path to page'),0,0
Problems concerning IE9 with 'ActiveX Filtering' enabled,Internet Explorer 9 contains a new feature to block all ActiveX content by default: http://ie.microsoft.com/testdrive/Browser/ActiveXFiltering/About.html If the feature is enabled  all ActiveX controls are blocked silently. With Wicket this currently results in a lot of JavaScript content (but not all of it) being blocked as well. The user can allow an exception by clicking on a small icon in the address bar  however  he usually will be only able to do so  if he knows exactly what causes the problem.A user who enabled the feature himself might still see what is wrong  but the feature can be also enabled in a domain policy  which might make solving the problem much more difficult and have adverse effects on customers.The reason that some JavaScript content is blocked along with blocking ActiveX elements is the usage of window.ActiveXObject:wicket-ajax.js:&gt;if (window.ActiveXObject) { &gt; transport = new ActiveXObject('Microsoft.XMLHTTP'); &gt; Wicket.Log.info('Using ActiveX transport'); &gt;} else if (window.XMLHttpRequest) { &gt; transport = new XMLHttpRequest(); &gt; Wicket.Log.info('Using XMLHttpRequest transport'); &gt;}According to  http://blogs.msdn.com/b/ie/archive/2011/05/02/activex-filtering-for-developers.aspx the usage of this pattern is not advisable and the order should be changed to:&gt;// Best Practice: Use Native XHR  if available&gt;if (window.XMLHttpRequest) {&gt; // If IE7+  Gecko  WebKit: Use native object&gt; var xmlHttp = new XMLHttpRequest();&gt;}&gt;else if (window.ActiveXObject) {&gt; // ...if not  try the ActiveX control &gt; var xmlHttp = new ActiveXObject('Microsoft.XMLHTTP');&gt;}The problem is reported to be fixed in JQuery 1.5.1  for instance.,0,0
in development mode Wicket stops picking up markup changes,I have wicket application running via mvn jetty:run under JRebel to facilitate code hotswap.With 1.5RC5.1 Wicket does not pick markup changes unless I change requested version  and it still put version on URL even I have getPageSettings.setVersionPagesByDefault(false);   but that is a minor inconvenience.More annoying that after awhile Wicket stops picking up changes in the markup of components used on my page. I mean that I can change markup for my components and it gets reflected upon page refresh (with requesting non existent version)  but at some point it stops  changes to the markup of subcomponents are not picked up.That forces me to restart application  which is major productivity killer....,0,1
Modal window does not show the right page,1.5-RC5.1 is OK  I noticed it with version 1145888 on trunk.When ModalWindow displays a page (panel is OK)  it displays the home page instead of the right page.,0,0
renderCSSReference doesn't work with mountPage('/'),response.renderCSSReference(new PackageResourceReference(BasePage.class  'BasePage.css'));will correctly render the css reference if the page is not mounted or if it is mounted to a location other than '/'. However if I mount the page to '/' using WebApplication.mountPage() then the css reference doesn't work.,0,0
PageParameters#set not follow INamedParameters#set behavior,Couple of problems to work with page parameters:Major - The PageParameters#set(final String name  final Object value  final int index) used remove/add pattern instead of set parameter value by specified index.Minor - Inposible to get the index of key in elegant way to use obtained index in #set operation,0,0
Encoding problem with POSTing a form with Ajax,The form is always posted using Ajax in UTF-8  but if you're using a different encoding in the DB or the HTML aswell  the string is ugly obviously. Wicket should convert from UTF-8 to the given encoding (detecting from getMarkupSettings().setDefaultMarkupEncoding('...'); or getRequestCycleSettings().setResponseRequestEncoding('...'); or an other settings parameter which could be given to wicket)I'm attaching a quickstart project which demonstrate this issue by echoing back the string given to a textarea.,0,0
Encoding problem with JavaScriptRefrences,Let we have a javascript which contains some strings (which eventually should be appended to DOM)  and let we have a page in different encoding from UTF-8  like ISO-8859-2. The anomaly is the following: If the encoding of the JS is UTF-8  then the Ajax query which injects the JS is working OK. The injected string looks like it should be  no magic chars. But if we don't use the JS from Ajax  but plain request  then the string is ugly because JS is in UTF-8  but the page is in ISO-8859-2. If the encoding of the JS is the same as the Page then the response of the Ajax request will be ugly  but the plain non-ajax will be OK.,0,0
SCRIPT tags in Ajax-Response are not evaluated in Chrome,if a JavaScript script tag is added to AjaxRequestTarget (by Behavior via JavaScriptUtils.writeJavaScript)  it is not evaluated on Chrome browser. While debugging through wicket-ajax.js  it turns out  that replaceOuterHtmlSafari function is not called for Chrome  but the Gecko version gets executed instead (fall to '} else /* GECKO */ {' in Wicket.replaceOuterHtml). And the Gecko version does not do any special handling of SCRIPT tag  since Firefox does execute SCRIPT nodes added dynamically to the DOM. This behavior occurs since 1.5-RC5.1.There is a quickstart webapp attached to this ticket. HomePage contains a Label with Behavior attached and an AjaxLink. Behavior add a JavaScript showing alert message. It is shown once the page is loaded and once the ajax link is clicked. In Chrome there is not alert message after clicking the ajax link.,0,0
FilterForm#enableFocusTracking(FormComponent) method uses ComponentTag#put(String CharSequence) with key='id' which gives a warning in Wicket 1.5,A warning 'Please use component.setMarkupId(String) to change the tag's 'id' attribute.' is issued every time the component is rendered as the put(String  CharSequence) method on ComponentTag is called with 'id' as a key.To get rid of the warning message the FilterForm#enableFocusTracking(FormComponent) should be updated according to the warning message.,0,0
NPE with RequestLogger enabled and Https,There is a wicket application with https enabled: setRootRequestMapper(new HttpsMapper(getRootRequestMapper()  new HttpsConfig()));The RequestLogger is also enabled:  getRequestLoggerSettings().setRequestLoggerEnabled(true);The bug can be reproduced by:1. Try to access the page with 'localhost/h' (deliberately excluding the https protocol prefix).2. A NPE is thrown:java.lang.NullPointerException at org.apache.wicket.protocol.http.RequestLogger.getRequestHandlerString(RequestLogger.java:532) at org.apache.wicket.protocol.http.RequestLogger.getDelegateString(RequestLogger.java:574) at org.apache.wicket.protocol.http.RequestLogger.getRequestHandlerString(RequestLogger.java:556) at org.apache.wicket.protocol.http.RequestLogger.logEventTarget(RequestLogger.java:513) at org.apache.wicket.protocol.http.RequestLoggerRequestCycleListener.registerHandler(RequestLoggerRequestCycleListener.java:119) at org.apache.wicket.protocol.http.RequestLoggerRequestCycleListener.onRequestHandlerResolved(RequestLoggerRequestCycleListener.java:64),0,0
NPE when requesting http://example.com/app/wicket/resource/org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow/res/,When requesting the following URL  the default caching strategy throws a NullPointerException and this is logged. This request is performed by some spider agent of Microsoft (trying to kill Wicket!) with user agent 'Microsoft Office Protocol Discovery':Url=http://example.com/app/wicket/resource/org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow/res/java.lang.NullPointerException: caching strategy must not return an empty filename at org.apache.wicket.request.mapper.BasicResourceReferenceMapper.mapRequest(BasicResourceReferenceMapper.java:102) at org.apache.wicket.request.mapper.ParentPathReferenceRewriter.mapRequest(ParentPathReferenceRewriter.java:83) at org.apache.wicket.request.mapper.CompoundRequestMapper.mapRequest(CompoundRequestMapper.java:129) at org.apache.wicket.request.cycle.RequestCycle.resolveRequestHandler(RequestCycle.java:183) at org.apache.wicket.request.cycle.RequestCycle.processRequest(RequestCycle.java:208) at org.apache.wicket.request.cycle.RequestCycle.processRequestAndDetach(RequestCycle.java:253) at org.apache.wicket.protocol.http.WicketFilter.processRequest(WicketFilter.java:160) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:216)A couple of points: the exception should log which strategy caused the empty filename the exception might want to log the requested URL for the resource perhaps a NullPointerException is not the best exception to throw  but rather something that results in a 404 or a 403 maybe not even throwing an exception is the best way to handle this case  instead rely on the container or another mapper to take the lead?,0,0
CryptoMapper does not correctly decrypt URLs for the home page,I proposed a solution for WICKET-3514  which I had been using myself. I didn't notice that it was incorporated into Wicket. This patch represents a bug fix I made to the new CryptoMapper which is not in Wicket.Encrypted URLs for the home page (where the unencrypted URL is something like '?4' - no segments  just parameters) are not correctly decrypted.,0,0
Improve AJAX FunctionsExecutor robustness with try/catch,The attached patch improves wicket-ajax.js by executing its 'step' functions in a simple try/catch. This ensures that issues like WICKET-3820 don't fail catastrophically (leaving the channel busy).This poster might have had a similar failure.http://apache-wicket.1842946.n4.nabble.com/Re-Captcha-with-WiQuery-ButtonBehavior-causes-quot-Channel-busy-postponing-quot-td3679429.html,0,0
IResourceCachingStrategy is too much bound to PackageResource  make it more general,Somebody recently complained on the wicket userlist that IResourceCachingStrategy is not very versatile but only useable for PackageResources. I 100% agree would like to generalize the caching part by introducing the interface 'ICacheableResourceReference' (instead of referring to PackageResource). This makes it easy to use caching for other resource types. Since we are so close to 1.5 I would like to ask first if the patch is acceptable by you.,0,0
the wrong option in select components is rendered (Combination of reusing panels and defaultFormProcessing==false),We are reusing a panel (let's say a PersonPanel  two instances). There is a forward / back ajax-navigation between the panels  which is implemented with component.replace. So the component path for the select of both panels are the same. The back-function is implemented with setDefaultFormProcessing(false). If now showing PersonPanel1 --&gt; Forward --&gt; PersonPanel2 --&gt; Back --&gt; PersonPanel1 --&gt; Forward --&gt; PersonPanel2  the selects of the panel 2 are showing the values of panel1.The Reason:In the 'Select.isSelected(...)' the getInputAsArray() is used (instead of the getRawInput()). So request parameters are overruling the raw input  if the component path is the same.Wicket-Code:if (hasRawInput()) { String[] paths = getInputAsArray();I think  instead of calling getInputAsArray() the getRawInput()(With a split for the MultiSelect-support) should be used.,0,0
A (stateless) page immediately disappears after the first render,Using setResponsePage(new SomeStatelessNonBookmarkablePage(aParameter)) renders the page but trying to reload the page in the browser fails with PageExpiredException.The reason is that the page is stateless and thus it is not saved in the page stores. Since it was scheduled for render with setResponsePage(Page) method its Url is created by PageInstanceMapper (i.e. something like: wicket/page?1). An attempt to refresh such page fails with 'Page with id '1' is not found =&gt; PageExpiredException'.Igor suggested to call 'page.setStatelessHint(false)' for all pages passed to PageProvider(IRequestablePage) constructor  i.e. such pages must be stored.This solved the problem but exposed few more problems: MockPageManager (used in WicketTester) until now always touched/stored pages  no matter their statelessness org.apache.wicket.markup.html.internal.EnclosureTest.testRender10() was wrong for some unknown reason. All expectations against EnclosurePageExpectedResult_10-2.html should not have the enclosure rendered because 'input' component is invisible,0,0
TextTemplateResourceReference should be registered into the ResourceReferenceRegistry because otherwise the next request is served by PackageResourceReference,The title says it all.If the TextTemplateResourceReference is not registered then BasicResourceReferenceMapper receives autocreated PackageResRef which doesn't make variable substitutions.,0,0
Modal Window is not shown in IE8,On examples page http://wicketstuff.org/wicket/ajax/modal-window if you click on 'Show modal dialog with a page' or 'Show modal dialog with panel'  no modal windows will be shown.,0,0
Potential StackOverflowError in SerializableChecker,At line 517 it checks if 'streamObj' has already been checked  but at 522 it puts 'original' in the map. I don't know what's needed to reproduce it  but wicket-weld triggered it for me. You probably need a class with custom serialization which tries to serialize itself recursively. Changing line 522 to 'streamObj' fixed it for me.,0,1
Make AbstractMapper.getPlaceholder and similar methods as public methods,Playing with mappers and Scala I found that because of Scala's limitation  there's no way to call protected static methods even from subclasses.Thinking about Wicket-Scala interoperability  I think that these methods could be changed to public or to non-static methods.There's no gain nor design reason to leave these methods as protected static  IMO.,0,0
SignInPanel prevents the page being Stateless when signing in with the 'rember me' facility.,This worked fine with 1.5-RC5  so I think it is a regression. Start the webapp ( mvn clean jetty:run ) Log-in with remember me checked. Stop the webapp restart it ( mvn clean jetty:run ) The browser should re-log-on and wicket will throw a RuntimeException. If you refresh the browser  you are properly logged-on.See the attached quickstart.,0,0
Page Lock on Browser Back Button after Page Expiry,In the attached quickstart  after page expiry and browser back navigation  a server error occurs such as:'failed to acquire lock to page 0  attempted for 1 minutes out of allowed 1 minute'This appears to be related to request logging  but I have seen other strange errors without request logging such asorg.apache.wicket.request.handler.ComponentNotFoundException: Could not find component 'form' on page 'class web.page.ExpiredPagealso with browser history back navigation.I have seen none of these errors in Wicket 1.4. I guess the reason for not having seen this before it that http cache headers are different in 1.5.,0,0
SignInPanel may lead to infinite redirects if there is rememberMe cookie with outdated data,quickstart4.zip from WICKET-3991 shows that having outdated 'RememberMe' data in the cookie may lead to infinite loop: SignInPanel#onBeforeRender() -&gt; signIn(oldCredentials) -&gt; go to SignInPage -&gt; try to load SignInPanel again.,0,1
Wicket 1.5 Form Post Action and Link Get discard Page Class Information,Page expiry is a very annoying and perplexing event especially if users stay logged in via remember-me cookie.It is therefore not a fancy enhancement but an essential business requirement to not drop the user out of context after session expiry.Only stateless pages can fully achieve this  but it is not always desirable to go fully stateless  especially while a recovery solution already exists.In 1.4  this appears to be automatic with BookmarkablePageRequestTargetUrlCodingStrategy - without any additional coding.The solution is well known - keep as much state in the client as required to recover the page class  and possibly even its page parameters  and to not destroy this information.The two attached testcases show two possible methods of page fallback recovery (one with AJAX  one without) that already work behind the scenes.Of course it is easy with AJAX  to just force a page reload  but this is not discussed here. AJAX just serves to demonstrate how easy the principle actually is.In most cases the user could successfully reload the page but Wicket 1.5 can't create a response because it has forgotten the class of the expired page.In 1.4  it is possible to recover the class of an expired page via its mount path.This feature is lost in 1.5.To get this functionality back in a more streamlined fashion  I am additionaly proposing in a separate jira issue 4013 to store page class and page parameters in PageExpiredException.Meanwhile  the focus of this issue is to request whatever means to not overwrite the path of a page in a form post action or get request  and to get the page class back as in 1.4 by whatever means.The two attached testcases may be helpful for expermintation. The 1.4 tescase demonstrates how the scheme works  unfortunately I could not fill the blanks in the 1.5 testcase.In 1.4 a form tag is rendered as:&lt;form wicket:id='form' action='?wicket:interface=:0:form::IFormSubmitListener::'This is requested as:/testForm.0?wicket:interface=:0:form::IFormSubmitListener::and the page class can be recovered from the mount path 'testForm' as in mount(new HybridUrlCodingStrategy('testForm'  TestPageForm.class));an anchor tag is rendered as:&lt;a href='?wicket:interface=:0:linkSwitch::ILinkListener::'This is requested as:/testLink.0?wicket:interface=:0:linkSwitch::ILinkListener::and the page class can be recovered from the mount path 'test' as in mount(new HybridUrlCodingStrategy('testLink'  TestPageLink.class));In 1.5 a form tag is rendered as:&lt;form wicket:id='form' action='wicket/page?0-2.IFormSubmitListener-form'This is requested requested as:/wicket/page?0-1.IFormSubmitListener-formThis overwrites the mount path 'testForm' as in mountPage('testForm'  TestPageForm.class);Consequently the server cannot discover the page classan anchor tag is rendered as:&lt;a href='wicket/page?0-1.ILinkListener-linkSwitch'This is requested requested as:/wicket/page?0-1.ILinkListener-linkSwitchThis overwrites the mount path 'testLink' as in mountPage('testLink'  TestPageLink.class);Consequently the server cannot discover the page class,0,0
MarkupContainer.toString(true) fails with MarkupNotFoundException if the call is made in the component constructor,org.apache.wicket.MarkupContainer.toString(boolean) uses 'if (getMarkup() != null)' to decide whether to write something for the markup but since recently Component#getMarkup() throws MarkupNotFoundException when there is no markup and doesn't return null.,0,0
Please Allow AjaxLink to use getChannelName,Please allow AjaxLink to provide an empty getChannelName() that is called by its internal AjaxEventBehavior  so that Ajax-Channels can be used withoutoverriding the whole behavior.I know  not all methods should be provided and I also know its possible to override the AjaxEventBehavior  but an AjaxLink should at least provide the Possibilityto assign it to a specific Channel.THanks..,0,0
ComponentStringResourceLoader must not include the index of repeater items in resource lookup but still resolve properties to them,Issue when using a StringResourceModel to lookup a resource for a component underneath a repeating view.When a StringResourceModel is used by a component under a repeating view  the ComponentStringResourceLoader doesn't find the resource.This seems to be a problem introduced by the fix for 3671.In ComponentStringResourceLoader  getResourcePath excludes all AbstractRepeaters  however getComponentStack doesn't leading to the two being out of sync for the elements of the component hierarchy under the repeating view.,0,0
Fix Javadoc in SimpleAttributeModifier.,,0,0
AbstractTree#updateTree(AjaxRequestTarget target) is invoked even when request is non-ajax,I came across an issue when trying to get Brix working in wicket 1.5.It occurs when the Tree has: setLinkType(LinkType.REGULAR);Caused by: java.lang.IllegalArgumentException: Argument 'target' may not be null. at org.apache.wicket.util.lang.Args.notNull(Args.java:39) at org.apache.wicket.markup.html.tree.AbstractTree.updateTree(AbstractTree.java:1138) at org.apache.wicket.markup.html.tree.LinkIconPanel.onNodeLinkClicked(LinkIconPanel.java:82) at org.apache.wicket.markup.html.tree.LinkIconPanel$1.onClick(LinkIconPanel.java:59) at org.apache.wicket.markup.html.tree.BaseTree$5.onClick(BaseTree.java:386) at org.apache.wicket.markup.html.link.Link.onLinkClicked(Link.java:187)I only had a quick search across the wicket codebase to see if this method is called elsewhereTo fix LinkIconPanel line 82 should beif (target != null) {tree.updateTree(target);}BaseTree - line 294 also calls updateTree(target) with no null check.,0,0
Memory leakage in browser with AbstractAjaxTimerBehavior,Adding an AbstractAjaxTimerBehavior to a page causes the browser (tested on Firefox and Chrome) to leak memory. More noticeable with a short update interval (I have been using 1 second). It is not as bad in the beginning  but gradually gets worse  eventually increasing memory usage by over 1MB per request.,0,1
LocaleFirstMapper does not strip Locale from url in getCompatibilityScore(),LocaleFirstMapper delegates the call to getCompatibilityScore() to the chained IRequestMapper without stripping the locale from the url.Since most request mappers generate a compatibility score by counting the number of matching segments from the start of the url  they will mostly return a score of 0.Practically this means that all request mappers behind the LocaleFirstMapper stop responding to urls.,0,1
Register devutils only if IDebugSettings#isDevelopmentUtilitiesEnabled() is true,,0,0
Assume that form.onsubmit() without explicit return value means that submit should proceed,If &lt;form&gt;'s onsubmit handler doesn't return a boolean value that specifies whether the form submit should actually happen then assume that it should happen.,0,0
AjaxIndicatorAppender removes itself immediately when added via ajax,When addding/replacing IndicatingAjaxLink's using ajax in Wicket 1.5.0 it's indicator markup is directly removed when parsing the ajax response. The AjaxIndicatorAppender renders a bit of javascript to the response (when it is an ajax request) to remove previous indicators from the dom (see issue WICKET-722) but in 1.5.0 the execution order of the javascript is different  causing the indicator markup to be added first and the javascript to remove previous versions of the indicator to be run next and thus removing the newly added indicator.De ajax debug windows shows that the component is replaced first and then the javascript is run. In 1.4.18 ajax logging shows the javascript run first and then the component gets replaced  resulting in correct behavior.,0,0
Wicket quickstart advertise HTTPS but it doesn't work when started with jetty:run,The pregenerated 'keystore' is put in src/test/resources and thus is not in the classpath when started with 'mvn jetty:run'. This leads to a broken link in the home page of the quickstart.We should either move the keystore file or disable the link when HTTPS is not enabled.,0,0
INamedParameters.getAllNamed() returns a list of NamedPairs defined as inner class of PageParameters,In an attempt to create my own implementation of PageParameterEncoder and PageParameters  I encountered the following problem with the API:The interface INamedParameters defines the method getAllNamed() that returns a list of NamedPairs defined as inner class of PageParameters .I believe that an interface shouldnt be referencing any element from an implementation to be a true extensible interface.,0,0
Error detaching RequestCycle listener after serialization failure,Error detaching RequestCycle listener is produced after org.apache.wicket.serialize.java.JavaSerializer.serialize(Object) returns null.Below is the stacktrace of the error:20-09-2011 16:46:44 875 ERROR org.apache.wicket.request.cycle.RequestCycleListenerCollection$3.notify:105 - Error detaching request cycle listener: org.apache.wicket.Application$2@b45ad3djava.lang.IllegalArgumentException: Argument 'data' may not be null. at org.apache.wicket.util.lang.Args.notNull(Args.java:39) at org.apache.wicket.pageStore.AsynchronousDataStore$Entry.&lt;init&gt;(AsynchronousDataStore.java:271) at org.apache.wicket.pageStore.AsynchronousDataStore.storeData(AsynchronousDataStore.java:215) at org.apache.wicket.pageStore.DefaultPageStore.storePageData(DefaultPageStore.java:115) at org.apache.wicket.pageStore.DefaultPageStore.storePage(DefaultPageStore.java:144) at org.apache.wicket.page.PageStoreManager$PersistentRequestAdapter.storeTouchedPages(PageStoreManager.java:377) at org.apache.wicket.page.RequestAdapter.commitRequest(RequestAdapter.java:171) at org.apache.wicket.page.AbstractPageManager.commitRequest(AbstractPageManager.java:94) at org.apache.wicket.page.PageManagerDecorator.commitRequest(PageManagerDecorator.java:68) at org.apache.wicket.page.PageAccessSynchronizer$2.commitRequest(PageAccessSynchronizer.java:213) at org.apache.wicket.Application$2.onDetach(Application.java:1552) at org.apache.wicket.request.cycle.RequestCycleListenerCollection$3.notify(RequestCycleListenerCollection.java:101) at org.apache.wicket.request.cycle.RequestCycleListenerCollection$3.notify(RequestCycleListenerCollection.java:97) at org.apache.wicket.util.listener.ListenerCollection.reversedNotify(ListenerCollection.java:121) at org.apache.wicket.util.listener.ListenerCollection.reversedNotify(ListenerCollection.java:112) at org.apache.wicket.request.cycle.RequestCycleListenerCollection.onDetach(RequestCycleListenerCollection.java:95) at org.apache.wicket.request.cycle.RequestCycle.onDetach(RequestCycle.java:542) at org.apache.wicket.request.cycle.RequestCycle.detach(RequestCycle.java:481) at org.apache.wicket.request.cycle.RequestCycle.processRequestAndDetach(RequestCycle.java:257) at org.apache.wicket.protocol.http.WicketFilter.processRequest(WicketFilter.java:162) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:218) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:224) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:185) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:472) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:151) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:100) at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:929) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:405) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:269) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:515) at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:302) at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908) at java.lang.Thread.run(Thread.java:662),0,0
Provide new HybridPageParametersEncoder class for backwards compatibility with pre 1.5.x Hybrid URL encoding,Any 1.4 app that has been live for a while would likely have a collection of links pointing to it from external sites on the web. You really want the Wicket 1.5 version of your app to be able to handle any existing hybrid style links without generating an error.The links are in the style:/myPage/paramName1/paramValue1/paramName2/paramValue2When migrating to 1.5  without a 1.4 compatible IPageParametersEncoder implementation  you need to include the full parameter specification in every mount if you want to avoid making changes to each individual Page class that reads parameters. The attached IPageParametersEncoder implementation means that is no longer necessary. All that is needed is to mount your pages as follows:mount(new MountedMapper('/myPage/'  MyPage.class  new HybridPageParametersEncoder());I'm submitting this .java file as a patch so that hopefully it may be included in future 1.5.x versions of Wicket to make it easy to implement backwards compatible URL parameter encoding for other 1.4 migrators.This code is based on a suggestion by luniv on StackOverflow here: http://stackoverflow.com/questions/6154430/how-do-i-mimic-hybridurlcodingstrategy-in-wicket-1-5,0,0
Make Application#init() run after IInitializers to allow the application to override any settings configured by initializers,wicket.properties urls are added to an HashSet  causing the IInitializers to be loaded in random order. In AbstractClassResolver.getResources  the HashSet should be changed to a LinkedHashSet.,0,0
SmartLinkLabel doesn't recognize already tagged links,The SmartLinkLabel works as expected for the texts without &lt;a&gt;..&lt;/a&gt; tag. for text likeextensions @ http://www.wicketframework.org/wicket-extensions/index.html are cool!!SmartLinkLabel generates the html - extensions @ &lt;a href='http://www.wicketframework.org/wicket-extensions/index.html'&gt;http://www.wicketframework.org/wicket-extensions/index.html&lt;/a&gt; are cool!!but for the text likeextensions @ &lt;a href='http://www.wicketframework.org/wicket-extensions/index.html'&gt;http://www.wicketframework.org/wicket-extensions/index.html&lt;/a&gt; are cool!!SmartLinkLabel generates the html - extensions @ &lt;a href='&lt;a href='http://www.wicketframework.org/wicket-extensions/index.html'&gt;http://www.wicketframework.org/wicket-extensions/index.html&lt;/a&gt;'&gt;&lt;a href='http://www.wicketframework.org/wicket-extensions/index.html'&gt;http://www.wicketframework.org/wicket-extensions/index.html&lt;/a&gt;&lt;/a&gt; are cool!!I think this is a bug &amp; needs a fix.,0,0
addDomReadyEvent broken for IE,Wicket.Event.addDomReadyEvent is broken in IE since 1.5.1. I identified WICKET-4080 as the cause of the problem: onreadystatechange with readyState='loaded' is sometimes fired before the document is fully loaded  causing scripts that reference DOM nodes to fail.See http://msdn.microsoft.com/en-us/library/ms534359%28v=vs.85%29.aspx for the order of the readystate events.The attached quickstart reproduces the issue (you may need to F5 a few times as it does not happen reliably). The actual JS error is:SCRIPT5007: The property 'onkeydown' has no value: The object is null or undefinedwicket-autocomplete-ver-1317728550188.js  Line 91 Character 9,0,0
Automatic Image Linking broken for images in base packages,Automatic linking seems to be broken when used in conjunction with base classes and referencing relative images located in a different package.The attached quickstart application contains a base page wicket.bugs.autolink.page.base.BasePage whose HTML references an image located at &lt;BasePage Package&gt;/theme/logo.png: &lt;img src='theme/logo.png' ...&gt;When accessing this page via http://localhost:8080/base the image is rendered as expected.The application contains a second page wicket.bugs.autolink.page.home.HomePage extending the BasePage and that adds a second reference to this image via &lt;img src='../base/theme/logo.png' ...&gt; =&gt; this kind of references used to work in Wicket 1.4When accessing this page via http://localhost:8080/home none of the two images (the one inherited from the base page and the one added) is displayed.The inherited image reference is rendered as: &lt;img src='theme/logo.png' border='1' onclick='window.location.href=&#039;theme/logo.png&#039;;return false;'/&gt; =&gt; theme/logo.png seems not to be an auto link =&gt; I have no idea why an onclick event is rendered by Wicketand the explicitly added image reference is rendered as &lt;img src='wicket/resource/wicket.bugs.autolink.page.home.HomePage/../base/theme/logo-ver-1318516450215.png' /&gt; =&gt; accessing the URL http://localhot:8080/wicket/resource/wicket.bugs.autolink.page.home.HomePage/../base/theme/logo-ver-1318516450215.png results in:WARN - WicketObjects - Could not resolve class &#91;base&#93;java.lang.ClassNotFoundException: base at java.net.URLClassLoader$1.run(URLClassLoader.java:200) at java.security.AccessController.doPrivileged(Native Method) at java.net.URLClassLoader.findClass(URLClassLoader.java:188) at java.lang.ClassLoader.loadClass(ClassLoader.java:306) at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:268) at java.lang.ClassLoader.loadClass(ClassLoader.java:251) at org.eclipse.jetty.webapp.WebAppClassLoader.loadClass(WebAppClassLoader.java:424) at org.eclipse.jetty.webapp.WebAppClassLoader.loadClass(WebAppClassLoader.java:377) at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:319) at java.lang.Class.forName0(Native Method) at java.lang.Class.forName(Class.java:242) at org.apache.wicket.application.AbstractClassResolver.resolveClass(AbstractClassResolver.java:110) at org.apache.wicket.util.lang.WicketObjects.resolveClass(WicketObjects.java:68) at org.apache.wicket.request.mapper.BasicResourceReferenceMapper.resolveClass(BasicResourceReferenceMapper.java:143) at org.apache.wicket.request.mapper.BasicResourceReferenceMapper.mapRequest(BasicResourceReferenceMapper.java:120) at org.apache.wicket.request.mapper.ParentPathReferenceRewriter.mapRequest(ParentPathReferenceRewriter.java:83) at org.apache.wicket.request.mapper.CompoundRequestMapper.mapRequest(CompoundRequestMapper.java:130) at org.apache.wicket.request.cycle.RequestCycle.resolveRequestHandler(RequestCycle.java:179) at org.apache.wicket.request.cycle.RequestCycle.processRequest(RequestCycle.java:204) at org.apache.wicket.request.cycle.RequestCycle.processRequestAndDetach(RequestCycle.java:251) at org.apache.wicket.protocol.http.WicketFilter.processRequest(WicketFilter.java:162) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:218),0,0
Localizer.getCacheKey() generating redundant keys for same values causing memory leak.,Note: To reproduce this  just add a breakpoint or a logger in Localizer.addKeyToCache(). After running all pages/scenarios once that method should not be called again. But if it does get called you know that there are redundant keys being produced for the same value.After running a web app for about a day  I will get out of mem exception. With a heap dump I will see most of the memory taken by Localizer  with keys such as:androidapp-10:_wicket_link-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-28-4-4-4-4-4-4-28-52-4-4-76-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-27-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-28-4-4-4-4-4-4-4-30-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-41-4-4-4-4-26-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-41-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4-4...Each of these types of keys are duplicated several thousand times. Here is a snipplet if the report:Found 60 occurrences of char[] with at least 10 instances having identical content. Total size is 401 451 248 bytes.Top elements include:6 454 x androidapp-10:_wicket_link-4-4-4-4-4-4-4-4-4-4-4-4... (15 722 bytes)6 453 x facebook-10:_wicket_link-4-4-4-4-4-4-4-4-4-4-4-4-4... (15 720 bytes)5 866 x home-9:_autolink_5-10:_wicket_link-4-4-4-4-4-4-4-4... (15 720 bytes)5 183 x candidates-9:_autolink_7-10:_wicket_link-4-4-4-4-4... (15 614 bytes)686 x candidates-9:_autolink_8-10:_wicket_link-4-4-4-4-4... (16 567 bytes),0,1
Automatic Linking in base page broken,Automatic linking used in base pages is broken.The attached quickstart application contains a base page wicket.bugs.autolink.page.base.BasePage which has a relative image reference: &lt;img src='theme/logo.png' border='1' width='50px' height='50px' /&gt;When accessing this page via http://localhost:8080/base the image is rendered as expected.The generated HTML output is: &lt;img src='wicket/resource/wicket.bugs.autolink.page.base.BasePage/theme/logo-ver-1319028241918.png' border='1' width='50px' height='50px'/&gt;The application contains a second page wicket.bugs.autolink.page.home.HomePage extending the BasePage.When accessing this page via http://localhost:8080/home the image inherited from the base page is not displayed.The inherited image reference is rendered as: &lt;img src='theme/logo.png' border='1' onclick='window.location.href=&#039;theme/logo.png&#039;;return false;'/&gt; =&gt; Problem 1: theme/logo.png is not autolinked anymore  it should point to wicket/resource/wicket.bugs.autolink.page.base.BasePage/theme/logo-ver-1319028241918.png =&gt; Problem 2: for some reasons a onclick event is rendered by Wicket I configured the Wicket app with: public void init() { super.init(); getMarkupSettings().setAutomaticLinking(true); getResourceSettings().setParentFolderPlaceholder('$up$'); mountPage('/home'  HomePage.class); mountPage('/base'  BasePage.class); },0,0
NPE in CachingResourceStreamLocator due to the search in parent's markup in Autolink code,Trying to open http://localhost:8080/mappers/en_US (Request Mapper examples) the following exception is thrown:java.lang.NullPointerException at org.apache.wicket.util.resource.locator.caching.CachingResourceStreamLocator.locate(CachingResourceStreamLocator.java:114) at org.apache.wicket.request.resource.PackageResource.exists(PackageResource.java:442) at org.apache.wicket.markup.resolver.AutoLinkResolver$ResourceReferenceAutolink.&lt;init&gt;(AutoLinkResolver.java:583) at org.apache.wicket.markup.resolver.AutoLinkResolver$AbstractAutolinkResolverDelegate.newPackageResourceReferenceAutoComponent(AutoLinkResolver.java:113) at org.apache.wicket.markup.resolver.AutoLinkResolver$AnchorResolverDelegate.newAutoComponent(AutoLinkResolver.java:483) at org.apache.wicket.markup.resolver.AutoLinkResolver.resolveAutomaticLink(AutoLinkResolver.java:876) at org.apache.wicket.markup.resolver.AutoLinkResolver.resolve(AutoLinkResolver.java:808)..It is caused by my fix for WICKET-4141 from yesterday.,0,0
Add localization resources for DataTable components,Add localization for DataTable components (no records and navigation toolbars),0,0
AbstractResourceAggregatingHeaderResponse does not order javascript properly,I decided to give AbstractResourceAggregatingHeaderResponse a try but I found a problem in its design that  I think  makes it unusable.How it works:1-the IHeaderResponse#renderJavaScriptReference(ResourceReference) methods are intercepted and the resource references are stored in a list and not rendered right away. Each resource ref is assigned a key for grouping.2-When close() is called on the response  the aggregator writes out all the accumulated resource references which have not been rendered yet. This step can be used to group multiple resources into a single merged resource.The problem:AbstractResourceAggregatingHeaderResponse does not intercept calls to IHeaderResponse#renderJavaScriptReference(url) or IHeaderResponse#renderJavaScript(Script). They are directly executed by the underlying response.example:AbstractDefaultAjaxBehavior#renderHead() does the following : response.renderJavaScriptReference(WicketEventReference.INSTANCE); response.renderJavaScriptReference(WicketAjaxReference.INSTANCE); response.renderJavaScript('Wicket.Ajax.baseUrl=&#91;...&#93;');With the non-aggregating header response  the Wicket .js ref script tags are rendered in the markup before the inline javascript code and all is well.With the aggregating version  the Wicket js resource references are rendered last (in close()). This means that the inline javascript code (which uses Wicket.Ajax) is executed before the Wicket .js files are loaded  causing a javascript error (Wicket is undefined).This problem also applies to css resource references because order of inclusion is important for them too.Short of a big refactor to force each rendered javascript to list its dependencies  I don't see how this problem can be solved. I opened this ticket primarily to share my findings and let people comment on possible solutions other than removing the code.The problem is also present in AbstractDependencyRespectingResourceAggregatingHeaderResponse.NOTE:wiQuery uses AbstractResourceAggregatingHeaderResponse  but resolves the issue by intercepting all renderJavaScript* methods and keeping their order.,0,0
Error page resource relative urls are wrong,The wicket page exposed as 404 error page has wrong links to resources. The sample project is attached.Run the project with 'mvn jetty:run' and go to url 'http://localhost:8080/bug/404' - it's mapped wicket page  works perfect. But if you type any wrong url such as 'http://localhost:8080/bug/aaaaaa' the page doesn't have styles and images.,0,0
Add additional constructor to DownloadLink that accepts the filename in a Model,There are cases when the file name that will be used in DownloadLink is unknown at construction time. If the filename is stored in a IModel this limitation will be solved.,0,0
Enclosure can't find a child with deeper path in TransparentWebMarkupContainer,Using the Wicket enclosure-tag in an TransparentWebMarkupContainer throws the following exception. I've just converted some working 1.4.18 code to 1.5.2 and got this error (see also http://apache-wicket.1842946.n4.nabble.com/Enclosures-and-transparent-WebContainer-tp3935753p3935753.html). Changing the component hierarchy without using a transparent WebMarkupContainer would fix the problem  but this is not an option if you migrate projects from 1.4 to 1.5org.apache.wicket.WicketRuntimeException: Could not find child with id: column:info in the wicket:enclosure at org.apache.wicket.markup.html.internal.Enclosure.checkChildComponent(Enclosure.java:232) at org.apache.wicket.markup.html.internal.Enclosure.getChildComponent(Enclosure.java:211) at org.apache.wicket.markup.html.internal.Enclosure.onInitialize(Enclosure.java:127) at org.apache.wicket.Component.fireInitialize(Component.java:919) at org.apache.wicket.MarkupContainer.internalInitialize(MarkupContainer.java:1002) at org.apache.wicket.MarkupContainer.addedComponent(MarkupContainer.java:979) at org.apache.wicket.MarkupContainer.add(MarkupContainer.java:171) at org.apache.wicket.MarkupContainer.autoAdd(MarkupContainer.java:300) at org.apache.wicket.MarkupContainer.renderNext(MarkupContainer.java:1463) at org.apache.wicket.MarkupContainer.renderAll(MarkupContainer.java:1638) at org.apache.wicket.MarkupContainer.renderComponentTagBody(MarkupContainer.java:1613) at org.apache.wicket.MarkupContainer.onComponentTagBody(MarkupContainer.java:1567) at org.apache.wicket.markup.html.panel.DefaultMarkupSourcingStrategy.onComponentTagBody(DefaultMarkupSourcingStrategy.java:72) at org.apache.wicket.Component.internalRenderComponent(Component.java:2516) at org.apache.wicket.MarkupContainer.onRender(MarkupContainer.java:1576) at org.apache.wicket.Component.internalRender(Component.java:2346) at org.apache.wicket.Component.render(Component.java:2274) at org.apache.wicket.MarkupContainer.renderNext(MarkupContainer.java:1474) at org.apache.wicket.MarkupContainer.renderAll(MarkupContainer.java:1638) at org.apache.wicket.Page.onRender(Page.java:904) at org.apache.wicket.markup.html.WebPage.onRender(WebPage.java:140) at org.apache.wicket.Component.internalRender(Component.java:2346) at org.apache.wicket.Component.render(Component.java:2274) at org.apache.wicket.Page.renderPage(Page.java:1035) at org.apache.wicket.request.handler.render.WebPageRenderer.renderPage(WebPageRenderer.java:105) at org.apache.wicket.request.handler.render.WebPageRenderer.respond(WebPageRenderer.java:224) at org.apache.wicket.request.handler.RenderPageRequestHandler.respond(RenderPageRequestHandler.java:167) at org.apache.wicket.request.cycle.RequestCycle$HandlerExecutor.respond(RequestCycle.java:750) at org.apache.wicket.request.RequestHandlerStack.execute(RequestHandlerStack.java:64) at org.apache.wicket.request.cycle.RequestCycle.execute(RequestCycle.java:252) at org.apache.wicket.request.cycle.RequestCycle.processRequest(RequestCycle.java:209) at org.apache.wicket.request.cycle.RequestCycle.processRequestAndDetach(RequestCycle.java:280) at org.apache.wicket.protocol.http.WicketFilter.processRequest(WicketFilter.java:162) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:218) at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1326) at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:479) at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:119) at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:520) at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:227) at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:940) at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:409) at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:186) at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:874) at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:117) at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:250) at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:149) at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:110) at org.eclipse.jetty.server.Server.handle(Server.java:349) at org.eclipse.jetty.server.HttpConnection.handleRequest(HttpConnection.java:441) at org.eclipse.jetty.server.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:904) at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:565) at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:217) at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:46) at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:545) at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:43) at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:598) at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:533) at java.lang.Thread.run(Thread.java:662),0,0
NullPointerException in JsonRequestLogger when logging resource requests,The use of NopAnnotationIntrospector causes NullPointerExceptions when trying to log enum values. The attached patch fixes this by changing to JacksonAnnotationIntrospector  which is the default introspector.,0,0
AppendingStringBuffer.insert  infinite loop,When trying to insert a StringBuffer into an AppendingStringBuffer  the method public AppendingStringBuffer insert(final int offset  final Object obj)will call itself repeatedly generating an infinite loop.The fix would be to call toString() method if the object is a StringBufferpublic AppendingStringBuffer insert(final int offset  final Object obj) { if (obj instanceof AppendingStringBuffer) { AppendingStringBuffer asb = (AppendingStringBuffer)obj; return insert(offset  asb.value  0  asb.count); } else if (obj instanceof StringBuffer) { //return insert(offset  obj); return insert(offset  obj.toString()); } return insert(offset  String.valueOf(obj)); },0,1
ListenerInterfaceRequestHandler should not assume existence of a page,ListenerInterfaceRequestHandler should not assume a page instance is always available in isPageInstanceCreated. This handler can also be used for links on bookmarkable pages. The attached patch fixes this.,0,0
RequestHandlerStack: Unnecessary Stacktrace in log on PageExpiredException,We use session.replaceSession() when a user logs out which appears to clear all previous pages (which is good)  and when the user tries to go back he gets a PageExpiredException (which is also good).Only that this exception is logged in error level from the RequestHandlerStack is very ugly and triggers our customer's log monitoring tool. PageExpiredExceptions should never bubble up into the log unless they cannot be handled correctly.This is the stacktrace:ERROR request.RequestHandlerStack - Error detaching RequestHandlerorg.apache.wicket.protocol.http.PageExpiredException: Page with id '2' has expired. at org.apache.wicket.request.handler.PageProvider.getPageInstance(PageProvider.java:169) at org.apache.wicket.request.handler.PageProvider.getPageClass(PageProvider.java:227) at org.apache.wicket.request.handler.logger.PageLogData.&lt;init&gt;(PageLogData.java:49) at org.apache.wicket.request.handler.RenderPageRequestHandler.detach(RenderPageRequestHandler.java:147) at org.apache.wicket.request.cycle.RequestCycle$HandlerExecutor.detach(RequestCycle.java:761) at org.apache.wicket.request.RequestHandlerStack.detach(RequestHandlerStack.java:180) at org.apache.wicket.request.cycle.RequestCycle.onDetach(RequestCycle.java:565) at org.apache.wicket.request.cycle.RequestCycle.detach(RequestCycle.java:508) at org.apache.wicket.request.cycle.RequestCycle.processRequestAndDetach(RequestCycle.java:284) at org.apache.wicket.protocol.http.WicketFilter.processRequest(WicketFilter.java:162) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:218) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:175) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102) at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:568) at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:568) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:286) at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:844) at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583) at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:447) at java.lang.Thread.run(Thread.java:722),0,0
Do not add anti cache parameter to the images used for the Tree's junction links,Since a while Wicket automatically adds antiCache pararemeter to the url of the Image components which are re-rendered in Ajax request.This new feature makes the Tree component slower to rerender because the link's images are re-rendered for each expand.,0,1
update/improve javadocs of SpringComponentInjector and GuiceComponentInjector.,Update/improve javadocs of SpringComponentInjector and GuiceComponentInjector to reflect new listener usage on application init(),0,0
Allow passing custom AjaxChannel in AjaxLazyLoadPanel,Can LAZY_LOAD_COMPONENT_ID be public? Sometimes id is needed beforehand. AjaxLazyLoadPanel uses anonymous AbstractDefaultAjaxBehavior  so AjaxChannel cannot be easily overridden. Is it possible to introduce AjaxLazyLoadPanel#getChannel()?,0,0
Add CachingResourceVersion#invalidate(IStaticCacheableResource) to manually purge cache entries,Add CachingResourceVersion#invalidate(IStaticCacheableResource) to manually purge cache entries.We had the uncommon requirement on the mailing list that a user needs to replace a static resource at runtime. I order to still use caching for resource versions a method to expire entries in CachingResourceVersion should be helpful.Adding this method to a concrete class should not affect API compatibility.,0,0
dropping ajax request causes componentnotfoundexception,issue described in http://osdir.com/ml/users-wicket.apache.org/2011-11/msg00019.html,0,0
add wicket-jar_es.properties for spanish localization,add wicket-jar_es.properties for spanish localization,0,0
AbstractResourceAggregatingHeaderResponse forgets some information about references,Seen in Wicket 1.5.3 and SVN r1199294. AbstractResourceAggregatingHeaderResponse.java public void renderJavaScriptReference(String url  String id  boolean defer) { topLevelReferences.add(new ResourceReferenceAndStringData(null  null  url  null  ResourceType.JS  defer  null  null)); }forgets the id. public void renderCSSReference(ResourceReference reference  PageParameters pageParameters  String media  String condition) { topLevelReferences.add(new ResourceReferenceAndStringData(reference  null  null  media  ResourceType.CSS  false  null  condition)); }forgets the page parameters.I think a quickstart should not be necessary.,0,0
Upgrade pom reference for joda-time from 1.6.2 to 2.0,Current stable version of joda-time is 2.0. Wicket could upgrade to the latest and greatest version.Changelog and migration: http://joda-time.sourceforge.net/upgradeto200.htmlAll tests pass with 2.0 instead of 1.6.2. wicket-examples also run properly.,0,0
DebugBar displays stacktrace with FeedbackPanels,Clicking Inspector from DebugBar when a FeedbackPanel is displaying a message results in this stacktrace in log. Everything seems to work  extra stuff in logs is just annoying.ERROR - Component - Error while getting default model object for Component: [ListItem &#91;Component id = 0  page = com.mycompany.HomePage  path = 8:form:feedback:feedbackul:messages:0.ListItem  isVisible = true  isVersioned = false&#93;  children = &#91;Component id = message&#93;]java.lang.IndexOutOfBoundsException: Index: 0 at java.util.Collections$EmptyList.get(Collections.java:3204) at org.apache.wicket.markup.html.list.ListItemModel.getObject(ListItemModel.java:58) at org.apache.wicket.Component.getDefaultModelObject(Component.java:1640) at org.apache.wicket.Component.getDefaultModelObjectAsString(Component.java:1668) at org.apache.wicket.markup.html.debug.PageView$4.component(PageView.java:211) at org.apache.wicket.markup.html.debug.PageView$4.component(PageView.java:184) at org.apache.wicket.util.visit.Visits.visitChildren(Visits.java:143) at org.apache.wicket.util.visit.Visits.visitChildren(Visits.java:161) at org.apache.wicket.util.visit.Visits.visitChildren(Visits.java:161) at org.apache.wicket.util.visit.Visits.visitChildren(Visits.java:161) at org.apache.wicket.util.visit.Visits.visitChildren(Visits.java:161) at org.apache.wicket.util.visit.Visits.visitChildren(Visits.java:122) at org.apache.wicket.util.visit.Visits.visitChildren(Visits.java:191) at org.apache.wicket.MarkupContainer.visitChildren(MarkupContainer.java:923) at org.apache.wicket.markup.html.debug.PageView.getComponentData(PageView.java:182) at org.apache.wicket.markup.html.debug.PageView.&lt;init&gt;(PageView.java:130) at org.apache.wicket.devutils.inspector.InspectorPage.&lt;init&gt;(InspectorPage.java:66) at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57) at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) at java.lang.reflect.Constructor.newInstance(Constructor.java:525) at org.apache.wicket.session.DefaultPageFactory.newPage(DefaultPageFactory.java:173) at org.apache.wicket.session.DefaultPageFactory.newPage(DefaultPageFactory.java:97) at org.apache.wicket.session.DefaultPageFactory.newPage(DefaultPageFactory.java:47) at org.apache.wicket.DefaultMapperContext.newPageInstance(DefaultMapperContext.java:107) at org.apache.wicket.request.handler.PageProvider.resolvePageInstance(PageProvider.java:264) at org.apache.wicket.request.handler.PageProvider.getPageInstance(PageProvider.java:165) at org.apache.wicket.request.handler.render.PageRenderer.getPage(PageRenderer.java:78) at org.apache.wicket.request.handler.render.WebPageRenderer.renderPage(WebPageRenderer.java:105) at org.apache.wicket.request.handler.render.WebPageRenderer.respond(WebPageRenderer.java:224) at org.apache.wicket.request.handler.RenderPageRequestHandler.respond(RenderPageRequestHandler.java:167) at org.apache.wicket.request.cycle.RequestCycle$HandlerExecutor.respond(RequestCycle.java:750) at org.apache.wicket.request.RequestHandlerStack.execute(RequestHandlerStack.java:64) at org.apache.wicket.request.cycle.RequestCycle.execute(RequestCycle.java:252) at org.apache.wicket.request.cycle.RequestCycle.processRequest(RequestCycle.java:209) at org.apache.wicket.request.cycle.RequestCycle.processRequestAndDetach(RequestCycle.java:280) at org.apache.wicket.protocol.http.WicketFilter.processRequest(WicketFilter.java:162) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:218) at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1326) at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:479) at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:119) at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:520) at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:227) at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:940) at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:409) at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:186) at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:874) at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:117) at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:110) at org.eclipse.jetty.server.Server.handle(Server.java:349) at org.eclipse.jetty.server.HttpConnection.handleRequest(HttpConnection.java:441) at org.eclipse.jetty.server.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:904) at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:565) at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:217) at org.eclipse.jetty.server.BlockingHttpConnection.handle(BlockingHttpConnection.java:50) at org.eclipse.jetty.server.bio.SocketConnector$ConnectorEndPoint.run(SocketConnector.java:245) at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:598) at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:533) at java.lang.Thread.run(Thread.java:722),0,0
UrlRenderer renders invalid relative URLs if first segment contains colon,Seen on Wicket 1.5.3.If a relative url of a link starts with a path segment containing a colon then the whole uri will be regarded as absolute uri  so typically browsers will complain that there is no handle for the protocol foo in foo:bar/dee/per.See also the attached quickstart. The start page contains three links  one relative with colon  one absolute and one to a mounted page without colon for comparison.The application also has a static switch to add an extended urlrenderer  prepending './' if needed. This fix is merely a quick shot and there might be better alternatives.,0,0
Wicket autocomplete keeps working on the replaced element when somehow the element is replaced by another ajax request when it is shown.,,0,0
Thread Test Uses Sun Proprietary API,The ResourceTestPage class uses classes from com.sun.* packages to do image I/O. This breaks the build for me using Oracle's JDK7 on linux (see environment). You should use the ImageIO class instead.,0,0
Quality of ThumbnailImageResource,The control over the quality of generated thumbnails has been lost after modifications proposed in WICKET-2450 (the performance has been greatly improved though). That article http://today.java.net/pub/a/today/2007/04/03/perils-of-image-getscaledinstance.html proposes multi-step approach when downscaling images. It produces much better visual results with no dramatic performance loss. Can we use that code? It also would be nice to have image rendering hints configurable as they were before.,0,1
Remove superfluous call to ResourceReference#getResource() in ResourceMapper when trying to map the resource URL,The getResource() method is being called for a mounted ResourceReference even when the url does not match. So far it seems to only happen when some wicket Ajax is included in the page. To get around the problem  I've added a check on my ResourceReference that looks for the mounted name in the request url but it seems like the mounting should handle that. To reproduce the error:1. Call mountResource('uploadedfiles'  MyResourceReference.class);2. Add an AjaxFallbackLink to a page3. In MyResourceReference getResource() method return null;4. Run the application and open the page with an AjaxFallbackLink and you will get java.lang.NullPointerExceptionat org.apache.wicket.request.mapper.ResourceMapper.mapHandler(ResourceMapper.java:167)at org.apache.wicket.request.mapper.CompoundRequestMapper.mapHandler(CompoundRequestMapper.java:156)at org.apache.wicket.request.cycle.RequestCycle.mapUrlFor(RequestCycle.java:401)at org.apache.wicket.request.cycle.RequestCycle.urlFor(RequestCycle.java:485)at org.apache.wicket.markup.html.internal.HeaderResponse.renderJavaScriptReference(HeaderResponse.java:205)...The class org.apache.wicket.request.mapper.ResourceMap calls the getResource() (line 167) method even though the url does not match the mounted name.,0,1
Rendering of resources in the header with dependency resolving and support for bundles,The current API for resources does not allow resources to define dependencies nor does it provide native support for bundles. In short  a resource reference should be able to define that it requires other resources to be available as well  much like AbstractResourceDependentResourceReference does. This support should be part of ResourceReference itself and should not be limited to just references (anything that can be added to a header can be a dependency).Furthermore  many have requested support for resource bundles. A bundle combines several resources of the same type into one. When a bundle is rendered  all resources that are part of the bundle should not be rendered  otherwise you'll end up with duplicate resources. Although it is often requested that all resources should be combined into one (or two  a js and a css)  I do not believe this is a good solution as there is no way of knowing which page requires which resources. In the worst case  this will cause every page to contain a different permutation of resources  requiring the user to download all resources again and again for every page. Therefore  the bundles require the developer to manually register bundles. If one resource from a bundle is required  the bundle will rendered instead.Finally  the default HeaderResponse renders many script tags for onDomReady and onLoad scripts. These scripts should be combined into one or two script tags.I'm currently working on implementing these features at Github. My progress can be found at https://github.com/papegaaij/wicket/tree/wicket+wiquery,0,1
Select component loses it's value,Select component loses selected option and shows the first option in some situations (one example is when you try to submit a form  but there are validation errors).It was working fine in 1.4.18  but it's broken in 1.4.19.This must be caused by the solution from this issue https://issues.apache.org/jira/browse/WICKET-3962I think the problem is likely in Select.isSelected method  where String[] paths = getInputAsArray() is actually an array of uuid-s  so uuid-s are compared to paths.I haven't tested wicket 1.5  but this problem may also affect 1.5 versions.,0,0
Performance regression in Component.configure() in 1.5,Wicket 1.5 is slower than 1.4 in rendering deep component trees.See the attached application that adds recursively components with specified depth. In 1.5 it is several times slower than 1.4.I found several problems:1) org.apache.wicket.Component.configure() calls org.apache.wicket.Component.setRenderAllowed()The problems is that configure() is called for each component in the hierarchy and setRenderAllowed() is overwritten in MarkupContainer to visit all children and call it for them. And the final result is that setRenderAllowed() is called for the parent and all its children  then for the first child and all its children again  and so on...The solution is to completely remove org.apache.wicket.MarkupContainer.setRenderAllowed()2) If you increase the number of components to &gt; 1000 in 1.5 we hit StackOverflowError in 2.1) org.apache.wicket.MarkupContainer.getMarkupType()2.2) org.apache.wicket.Component.getLocale()2.3) org.apache.wicket.MarkupContainer.internalMarkRendering(boolean)For 2.1 and 2.2 I suggest to add transient fields which will cache the calculated value after the first call of the get method.For 2.3 I don't see a solution for now,0,1
CheckGroupSelector 'Select all' behavior broken when the CheckGroup contains a single check box.,When CheckGroupSelector is used with a CheckGroup that contains a single checkbox  select all behavior is broken. The problem is in CheckGroupSelector.js which assumes &gt;1 checkboxes in a CheckGroup.,0,0
PageSavingThread.stop() blocks forever,The PageSavingThread may exit without nulling the stop flag. For example when an OutOfMemoryError or any other runtime exception is thrown in the run method.Properly set the flag in a finally clause.Is this class still present in 1.5?,0,1
ListView causes page ID increment,A ListView with setReuseItems(false) causes the page ID to increment when the page is reloaded or the back button is pressed. This new ID is not reflected in the URL so Ajax actions against the new ID are lost when navigating away and back again. Steps to reproduce in quickstart1) Load quickstart project in browser2) Click 'Link to Other' then click browser's back button.3) Notice the log statement indicates the HomePage ID is 2  yet the URL remains at ID 04) Click 'Ajax Increment Link' a few times5) Click 'Link to Other' then click browser's back button6) Notice the counter is at zero  and subsequent clicks to the 'Ajax Increment Link' start from zero. The current page ID output in the log is 4.,0,0
MockHttpServletResponse.addCookie(Cookie) adds duplicate cookies,org.apache.wicket.protocol.http.mock.MockHttpServletResponse.addCookie(Cookie) makes a bad check whether the cookie to be added is already in the list of cookies.Since javax.servlet.http.Cookie doesn't implement #equals() 'cookies.remove(cookie)' wont remove the previous cookie because the identity is different.According to http://www.ietf.org/rfc/rfc2109.txt  p.4.3.3 : If a user agent receives a Set-Cookie response header whose NAME is the same as a pre-existing cookie  and whose Domain and Path attribute values exactly (string) match those of a pre-existing cookie  the new cookie supersedes the old. However  if the Set- Cookie has a value for Max-Age of zero  the (old and new) cookie is discarded. Otherwise cookies accumulate until they expire (resources permitting)  at which time they are discarded.I.e. the equality is on the name  path and domain.,0,0
FormTester doesn't handle nested forms correctly,While working on WICKET-4295  I discovered that FormTester doesn't handle nested form submits correctly.The browser will always submit the outermost form  because that is the only form it sees. Wicket will then determine the correct form by looking at the submitting component. If you create a FormTester on an inner form  however  the test request will point directly at that inner form. This is a problem for the new feature in WICKET-4295  but also in general since it does not correctly model the actual interaction. Also the submitting component is not found due to the wrong form being looked at. (form.getRootForm() == Form.this in Form#findSubmittingButton()) This means that for a nested form  the submitting component could never be found! I think it's mostly luck that this is not a bigger issue in tests It is possible to have the correct handling in a test  if you do newFormTester(outerForm) and then submit with a submit button in the inner form (formtester.submit('inner:submitButton')).I think FormTester should do the correct thing on its own though. The fix is trivial: in submit() don't just use the form it's pointing at  but use form.getRootForm(). This fixes both the correct request handling  as well as the issue with not finding the submitting component.I'll attach the appropriate patches.,0,0
StringValueConversionException for correct situation,StringValue.toOptionalLong() produces org.apache.wicket.util.string.StringValueConversionException if empty string was passed.Let me suggest  that this behavior should be changes for all toOptionalXXX methods except getOptionalString method.The problem in inner code:The problem in following code:public final Long toOptionalLong() throws StringValueConversionException { return (text == null) ? null : toLongObject(); }Should be something like this:The problem in following code:public final Long toOptionalLong() throws StringValueConversionException { return Strings.isEmpty() ? null : toLongObject(); }But there is another problem: what to do if incorrect param was passed - for example 'abc' for parameter of Long type?,0,0
Logic or Exception Message is incorrect in ModalWindow.setCookieName,The logic of the compound conditional statement is incorrect or the message passed to the Exception is incorrect. /** Sets the name of the cookie that is used to remember window position (and size if the window is resizable).  @param cookieName Name of the cookie @return this */ public StatelessModalWindow setCookieName(String cookieName) Unknown macro: { if (cookieName != null &amp;&amp; cookieName.indexOf(&quot; &quot;) != -1 &amp;&amp; cookieName.indexOf(&quot;|&quot;) != -1) { throw new IllegalArgumentException('Cookie name may not contain ' ' or '|' characters.'); } this.cookieName = cookieName; return this; } The logic reads: If the String is not null and it contains a comma and it contains a pipe  then throw the exception.,0,0
Wicket autocomplete doesn't take the scrollbar into account when calculating the width,,0,0
Make AjaxRequestTarget an interface and move the impl to AjaxRequestHandler,AjaxRequestTarget is a class with many final methods and constructor which relies on ThreadLocal (RequestCycle.get()) which makes it difficult to mock it for testing.By introducing IAjaxRequestHandler interface this problem will be solved. This additionally will allow to provide custom implementation which may generate JSON ajax response instead of XML.The change is simple but it changes the signature of all onXyz() (onEvent  onClick  onUpdate  ...) methods and this will cause a lot of compilation errors.The fix is quite easy though: replace AjaxRequestTarget with IAjaxRequestHandler.,0,0
Rerendering a page with WicketTester after you loose permission does not give access-denied,Since WICKET-4256 WicketTester does not give an access-denied page when you try to rerender a page instance after loosing permission to render that page. A testcase is added to WicketTesterTest (rerenderNotAllowed) to demonstrate the problem.,0,0
Implement onValidateModelObjects() and beforeUpdateFormComponentModels() for nested forms,The onValidateModelObjects() Method in a Form is used for late-stage validation that allows outside frameworks to validate any beans that the form is updating (like JSR303 Bean Validation). This method is called after the model is updated.If you override this method for validation in your form and your form is nested in another form  this method will not be invoked if the outer form is submitted. Only the onValidateModelObjects() Method of the outer form is invoked.It would be great  if you change the implementation in the form in that way you did for the nested form validation and submission.The same problem exists for the beforeUpdateFormComponentModels() Method.,0,0
Extract the code that creates the XML for Ajax responses out of AjaxRequestHandler,Currently the code that generates the &lt;ajax-response&gt; object is inside AjaxRequestHandler and it is impossible to reuse it.It will be better if the response data and the logic to serialize it is outside. This way other IRequestHandlers can reuse it or a different serialization strategy can be applied (e.g. JSON).,0,0
BufferedWebResponse fails to add/clear cookie in redirect,bufferedWebResponse.addCookie( cookie );That fails under certain conditions: (1) when called on the last of three 302 redirects during OpenID login; and (2) on single redirect immediately after container startup  though it later recovers. Failure confirmed in Firebug; no cookies sent in any of the response headers. My workaround is to bypass the buffered response. This works:((HttpServletResponse)bufferedWebResponse.getContainerResponse()).addCookie( cookie );,0,0
Markup Inheritance & getVariation(): markup loading (and merging) order depends on whether the super constructor adds components or not.,I have a web page 'ChildPage' that inherits (java/markup) from a 'SuperPage' ('ChildPage' --&gt; 'SuperPage'). 'ChildPage' now needs to override getVariation() to return a variation string  for example 'test'. The variation string is preferably set in the ChildPages constructor  maybe by a PageParameter.I would expect the following markup: ChildPage_test.html merged with SuperPage.html. This is the case  when SuperPage has no component added in its constructor. But when SuperPage has a component added in constructor  then I get ChildPage.html merged with SuperPage.html.quickstart 'myproject_1.5.4' (wicket 1.5.4) shows:ChildPage1 inherits from SuperPage1 (no component added)ChildPage2 inherits from SuperPage2 (label added) Click on 'load ChildPage1_test.html ' -&gt; markup ok: ChildPage1_test.html merged with SuperPage1.html Click on 'load ChildPage2_test.html ' -&gt; markup not ok: ChildPage2.html merged with SuperPage2.html : expected ChildPage2_test.html merged with SuperPage2.htmlsame with 'myproject2_1.4.19' (wicket 1.4.19) works fine!At the moment I moved the logic into getVariation() with: return getPageParameters.get('variation').toString();This works and that's why I'm unsure if it is a bug at all.Here is some debugging output from MarkupCache:1 : hildPage1 inherits from SuperPage1 (no component added)child constructor ------&gt; Class=ChildPage1 variationString=testDEBUG - MarkupCache - Load markup: cacheKey=com.mycompany.ChildPage1_test_en_US.htmlDEBUG - MarkupCache - Loading markup from file:/C:/testumgebung/eclipseWorkspace/myproject/target/classes/com/mycompany/ChildPage1_test.htmlDEBUG - AbstractMarkupParser - The markup file does not have a XML declaration prolog with 'encoding' attribute:file:/C:/testumgebung/eclipseWorkspace/myproject/target/classes/com/mycompany/ChildPage1_test.html. It is more save to use it. E.g. &lt;?xml version='1.0' encoding='UTF-8' ?&gt;DEBUG - WebAppClassLoader - loaded class com.mycompany.ChildPage1 from sun.misc.Launcher$AppClassLoader@11b86e7DEBUG - MarkupCache - Load markup: cacheKey=com.mycompany.SuperPage1_test_en_US.htmlDEBUG - MarkupCache - Loading markup from file:/C:/testumgebung/eclipseWorkspace/myproject/target/classes/com/mycompany/SuperPage1.htmlDEBUG - AbstractMarkupParser - The markup file does not have a XML declaration prolog with 'encoding' attribute:file:/C:/testumgebung/eclipseWorkspace/myproject/target/classes/com/mycompany/SuperPage1.html. It is more save to use it. E.g. &lt;?xml version='1.0' encoding='UTF-8' ?&gt;DEBUG - MergedMarkup - Merge markup: derived markup: ChildPage1_test.html; base markup: SuperPage1.htmlDEBUG - WebAppClassLoader - loaded class com.mycompany.SuperPage1 from sun.misc.Launcher$AppClassLoader@11b86e7DEBUG - MergedMarkup - Merge markup: file:/C:/testumgebung/eclipseWorkspace/myproject/target/classes/com/mycompany/ChildPage1_test.html2: ChildPage2 inherits from SuperPage2 (label added)DEBUG - MarkupCache - Load markup: cacheKey=com.mycompany.ChildPage2_en_US.htmlDEBUG - MarkupCache - Loading markup from file:/C:/testumgebung/eclipseWorkspace/myproject/target/classes/com/mycompany/ChildPage2.htmlDEBUG - AbstractMarkupParser - The markup file does not have a XML declaration prolog with 'encoding' attribute:file:/C:/testumgebung/eclipseWorkspace/myproject/target/classes/com/mycompany/ChildPage2.html. It is more save to use it. E.g. &lt;?xml version='1.0' encoding='UTF-8' ?&gt;DEBUG - WebAppClassLoader - loaded class com.mycompany.ChildPage2 from sun.misc.Launcher$AppClassLoader@11b86e7DEBUG - MarkupCache - Load markup: cacheKey=com.mycompany.SuperPage2_en_US.htmlDEBUG - MarkupCache - Loading markup from file:/C:/testumgebung/eclipseWorkspace/myproject/target/classes/com/mycompany/SuperPage2.htmlDEBUG - AbstractMarkupParser - The markup file does not have a XML declaration prolog with 'encoding' attribute:file:/C:/testumgebung/eclipseWorkspace/myproject/target/classes/com/mycompany/SuperPage2.html. It is more save to use it. E.g. &lt;?xml version='1.0' encoding='UTF-8' ?&gt;DEBUG - MergedMarkup - Merge markup: derived markup: ChildPage2.html; base markup: SuperPage2.htmlDEBUG - WebAppClassLoader - loaded class com.mycompany.SuperPage2 from sun.misc.Launcher$AppClassLoader@11b86e7DEBUG - MergedMarkup - Merge markup: file:/C:/testumgebung/eclipseWorkspace/myproject/target/classes/com/mycompany/ChildPage2.html...child constructor ------&gt; Class=ChildPage2 variationString=test,0,0
Duplicate html ID for generated divs in modal.js,using wicket's ModalWindow creates invalid markup since it creates two divs with id='_wicket_window_11',0,0
Form components' name/value are encoded in stateless form's action url,Stateless forms aren't working well as you can see on wicket examples: http://www.wicket-library.com/wicket-examples/stateless/fooThe first time you submit  (for example  the value 10)  everything works as supposed to. If you now change the value (to 11 for example) and submit the form  the value wicket shows is 10.I think the problem is stateless forms are generating an action URL with submitted values on query string  and when you resubmit the form  this values on query string replace the POST(or GET) values.,0,0
Useless concatenation with empty string in DefaultAuthenticationStrategy.save,There is an empty string used in string construction in DefaultAuthenticationStrategy.save which is not necessary.,0,0
Two WicketSerializableException classes,o.a.w.util.io.WicketSerializeableException is dead code  superceded by o.a.w.util.io.SerializableChecker$WicketSerializeableException.,0,0
datatime extension's calendar-min.js appears to be corrupted / out of sync,In some cases  when including a datepicker as a component inside a modal window. Internet Explorer 7/8 throw a runtime exception.This happens only in deployment mode  after re-minifying calendar.js and replacing calendar-min.js the problem goes away  the files seem to be out of sync or corrupted.,0,0
org.apache.wicket.validation.ValidatorAdapter class causes problem with validator properties to be loaded,PROBLEM:&lt;e1nPL&gt; hi I am having such problem: &lt;e1nPL&gt; I have implemented validator by implementing IValidator&lt;T&gt; interface&lt;e1nPL&gt; and I have impelemnted the same validator by extending AbstractValidator&lt;T&gt; classCODE: ===================== VALIDATOR EXTENDED FROM AbstractValidator ===================== package com.mycompany; import java.util.regex.Pattern; import org.apache.wicket.IClusterable; import org.apache.wicket.util.lang.Classes; import org.apache.wicket.validation.IValidatable; import org.apache.wicket.validation.IValidator; import org.apache.wicket.validation.ValidationError; import org.apache.wicket.validation.validator.AbstractValidator; /** * @author e1n */ public class PasswordPolicyValidator&lt;T&gt; extends AbstractValidator&lt;T&gt; { private static final Pattern UPPER = Pattern.compile('&#91;A-Z&#93;'); private static final Pattern LOWER = Pattern.compile('&#91;a-z&#93;'); private static final Pattern NUMBER = Pattern.compile('&#91;0-9&#93;'); @Override public void onValidate(IValidatable&lt;T&gt; validatable) { final String password = (String)validatable.getValue(); if (!NUMBER.matcher(password).find()) { error(validatable  'no-digit'); } if (!LOWER.matcher(password).find()) { error(validatable  'no-lower'); } if (!UPPER.matcher(password).find()) { error(validatable  'no-upper'); }  }  @Override public void error(IValidatable&lt;T&gt; validatable  String errorKey) { ValidationError err = new ValidationError(); err.addMessageKey(Classes.simpleName(getClass()) + '.' + errorKey); validatable.error(err); }  }   =============== VALIDATOR directly implementing IValidator interfce ==================== package com.mycompany;  import java.util.regex.Pattern; import org.apache.wicket.IClusterable; import org.apache.wicket.util.lang.Classes; import org.apache.wicket.validation.IValidatable; import org.apache.wicket.validation.IValidator; import org.apache.wicket.validation.ValidationError; import org.apache.wicket.validation.validator.AbstractValidator;  /** * * @author e1n */ public class PasswordPolicyValidator&lt;T&gt; implements IValidator&lt;T&gt; {  private static final Pattern UPPER = Pattern.compile('&#91;A-Z&#93;'); private static final Pattern LOWER = Pattern.compile('&#91;a-z&#93;'); private static final Pattern NUMBER = Pattern.compile('&#91;0-9&#93;');  public void validate(IValidatable&lt;T&gt; validatable) { final String password = (String)validatable.getValue();  if (!NUMBER.matcher(password).find()) { error(validatable  'no-digit'); } if (!LOWER.matcher(password).find()) { error(validatable  'no-lower'); } if (!UPPER.matcher(password).find()) { error(validatable  'no-upper'); } } public void error(IValidatable&lt;T&gt; validatable  String errorKey) { ValidationError err = new ValidationError(); err.addMessageKey(Classes.simpleName(getClass()) + '.' + errorKey); validatable.error(err); } }&lt;e1nPL&gt; I also have properties file which is named after validator class&lt;e1nPL&gt; and placed in the same package&lt;e1nPL&gt; my problem is that when i use to validate my form field validator which implements IValidator interface it is not capable of loading error messages from properties file&lt;e1nPL&gt; but when i am using validator which is extending AbstractValidator class&lt;e1nPL&gt; properties file with error msgs gets loadedPOSSIBLE FIX:&lt;e1nPL&gt; ok i have found class which is responsible for my problem and it is probably a bug&lt;e1nPL&gt; org.apache.wicket.validation.ValidatorAdapter&lt;e1nPL&gt; which wraps classes that directly implements IValidator interface&lt;e1nPL&gt; then when resources are loaded  and properties file are searched in class path etc.  loaders search in wrong path that is build against org.apache.wicket.validation.ValidatorAdapter PLACE WHER FIX SHOULD OCCOURorg.apache.wicket.resource.loader.ValidatorStringResourceLoader::loadStringResource(java.lang.Class java.lang.String java.util.Locale java.lang.String java.lang.String),0,0
Add maxlength to  wicket-datetime hours  minutes input fields,I watched an end user type an entire time into the hour component without tabbing over to the minute.So  I'd like to suggest a minor change to DateTimeField.html to add the maxlength='2' to the current size='2' on the hour/min input controls.I think it might be a simple way to give earlier feedback (I've found it unwise to rely on instructions like 'Please enter dates and times like this...' ).I can't think of any downside to this addition.,0,0
StringIndexOutOfBoundsException when forwarding requests,We're getting StringIndexOutOfBoundsException from wicket when forwarding a request from our servlet filter (using request dispatcher) to wicket.The problem occurs whenever the original URI is shorter than the wicket filter mapping.I created an example webapp (based on the quickstart) in which a ForwardFilter is mapped to /f/* and it forwards all the requests to /wicket/ (see web.xml snippet below).With this webapp a request to 'http://localhost:8081/wicket/f/' results in the following exception:ERROR - RequestCycle - Error during processing error messagejava.lang.StringIndexOutOfBoundsException: String index out of range: -5 at java.lang.String.substring(String.java:1958) at java.lang.String.substring(String.java:1925) at org.apache.wicket.protocol.http.servlet.ServletWebRequest.getContextRelativeUrl(ServletWebRequest.java:180) at org.apache.wicket.protocol.http.servlet.ServletWebRequest.getClientUrl(ServletWebRequest.java:140) at org.apache.wicket.request.UrlRenderer.&lt;init&gt;(UrlRenderer.java:59) at org.apache.wicket.request.cycle.RequestCycle.newUrlRenderer(RequestCycle.java:148) at org.apache.wicket.request.cycle.RequestCycle.getUrlRenderer(RequestCycle.java:172) at org.apache.wicket.request.handler.render.WebPageRenderer.respond(WebPageRenderer.java:145) at org.apache.wicket.request.handler.RenderPageRequestHandler.respond(RenderPageRequestHandler.java:167) at org.apache.wicket.request.cycle.RequestCycle$HandlerExecutor.respond(RequestCycle.java:781) at org.apache.wicket.request.RequestHandlerStack.execute(RequestHandlerStack.java:64) at org.apache.wicket.request.cycle.RequestCycle.executeExceptionRequestHandler(RequestCycle.java:304) at org.apache.wicket.request.cycle.RequestCycle.executeExceptionRequestHandler(RequestCycle.java:313) at org.apache.wicket.request.cycle.RequestCycle.executeExceptionRequestHandler(RequestCycle.java:313) at org.apache.wicket.request.cycle.RequestCycle.executeExceptionRequestHandler(RequestCycle.java:313) at org.apache.wicket.request.cycle.RequestCycle.executeExceptionRequestHandler(RequestCycle.java:313) at org.apache.wicket.request.cycle.RequestCycle.executeExceptionRequestHandler(RequestCycle.java:313) at org.apache.wicket.request.cycle.RequestCycle.executeExceptionRequestHandler(RequestCycle.java:313) at org.apache.wicket.request.cycle.RequestCycle.executeExceptionRequestHandler(RequestCycle.java:313) at org.apache.wicket.request.cycle.RequestCycle.executeExceptionRequestHandler(RequestCycle.java:313) at org.apache.wicket.request.cycle.RequestCycle.executeExceptionRequestHandler(RequestCycle.java:313) at org.apache.wicket.request.cycle.RequestCycle.executeExceptionRequestHandler(RequestCycle.java:313) at org.apache.wicket.request.cycle.RequestCycle.processRequest(RequestCycle.java:227) at org.apache.wicket.request.cycle.RequestCycle.processRequestAndDetach(RequestCycle.java:283) at org.apache.wicket.protocol.http.WicketFilter.processRequest(WicketFilter.java:162) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:218) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210) at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:684) at org.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:471) at org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDispatcher.java:402) at org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:329) at org.jfrog.ForwardFilter.doFilter(ForwardFilter.java:22) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:240) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:164) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:498) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:164) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:100) at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:562) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:394) at org.apache.coyote.http11.Http11AprProcessor.process(Http11AprProcessor.java:284) at org.apache.coyote.http11.Http11AprProtocol$Http11ConnectionHandler.process(Http11AprProtocol.java:322) at org.apache.tomcat.util.net.AprEndpoint$SocketProcessor.run(AprEndpoint.java:1714) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603) at java.lang.Thread.run(Thread.java:722)web.xml snippet &lt;filter&gt; &lt;filter-name&gt;forward&lt;/filter-name&gt; &lt;filter-class&gt;org.jfrog.ForwardFilter&lt;/filter-class&gt; &lt;/filter&gt; &lt;filter&gt; &lt;filter-name&gt;wicket.wicket&lt;/filter-name&gt; &lt;filter-class&gt;org.apache.wicket.protocol.http.WicketFilter&lt;/filter-class&gt; &lt;init-param&gt; &lt;param-name&gt;applicationClassName&lt;/param-name&gt; &lt;param-value&gt;org.jfrog.WicketApplication&lt;/param-value&gt; &lt;/init-param&gt; &lt;/filter&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;forward&lt;/filter-name&gt; &lt;url-pattern&gt;/f/*&lt;/url-pattern&gt; &lt;/filter-mapping&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;wicket.wicket&lt;/filter-name&gt; &lt;url-pattern&gt;/wicket/*&lt;/url-pattern&gt; &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt; &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt; &lt;/filter-mapping&gt;This bug is opened here following a bug we found in Artifactory after upgrading to Wicket 1.5,0,0
ChoiceFilteredPropertyColumn with setNullValid to true,When filtering with a ChoiceFilteredPropertyColumn  the 'Choose one' value disappears  so you can't undo the filter.Set 'setNullValid' to true in the ChoiceFilter class so that you can choose the null value.,0,0
CheckGroup model in AjaxFormChoiceComponentUpdatingBehavior onUpdate contains only last checked item,CheckGroup model in AjaxFormChoiceComponentUpdatingBehavior onUpdate contains only last checked item.P.S. A model in Form onSubmit contains all selected items.,0,0
Unversioned pages don't get touched when created and cannot be found by ID later,When I tell Wicket not to version pages by default via IPageSettings#setVersionPagesByDefault(false)  created pages cannot be found later by theirs ID. Versioned pages are touched upon creation in dirty(boolean) method and thus stored in the page store. But unversioned ones are not! So when I create a Page  wrap it inside a PageProvider and RenderPageRequestHandler  then get its URL with urlFor  the URL is useless  because the page is referenced by its ID in the URL but it cannot be found by that URL later.I'll give you an simple example.PAGE 1: public class WicketMainPage extends WebPage {  public WicketMainPage() { PopupPage page = new PopupPage('Created: ' + new Date()); // getSession().getPageManager().touchPage(page); PageProvider pp = new PageProvider(page); RenderPageRequestHandler rh = new RenderPageRequestHandler(pp); add(new Label('url'  urlFor(rh).toString())); } } as you can see  I only create an instance of second page (which is not bookmarkable as it has some parameters)  wrap it in page provider and request handler and simply output URL for it (of course it is an stateful URL). The second page is just simple outputting text from constructor PAGE 2: public class PopupPage extends WebPage {  public PopupPage(String text) { add(new Label('text'  text)); } } When I run this  the app outputs an relative part of URL to the second page... if I copy this into browser  everything works  when pages are versioned. But when I set setVersionPagesByDefault(false) I start to get PageExpiredException whe trying to access the second page. When I uncomment the touchPage line  everythings works even with unversiones paged. I think  that instead of explicitly touching the page  it should be done by Wicket when retrieving the url for it. Somewhere in mapUrlFor or mapHandler  etc... Or maybe it should be touched in the dirty method just like versioned pages.,0,0
Wicket 1.5 rewrites template content where it should not,I have recently upgraded from Wicket 1.4.14 to 1.5.4. One issue that Iencountered is that &lt;script&gt; tags in panel templates are rewritten byWicket  even when the &lt;script&gt; tags in question have no wicket handlersattached to them. I.e. the following panel template (notice that thereare no wicket:id attributes whatsoever):&lt;wicket:panel&gt; &lt;script id='template-upload' type='text/x-jquery-tmpl'&gt; &lt;span&gt;${name}&lt;/span&gt; &lt;/script&gt;&lt;/wicket:panel&gt;Would render in the panel as:&lt;script id='template-upload' type='text/x-jquery-tmpl'&gt;/&lt;![CDATA[/ &lt;span&gt;${name}&lt;/span&gt;/]]&gt;/&lt;/script&gt;Imho this is unwanted behavior that is a regression from the behavior inWicket 1.4.x (or at least 1.4.14). Wicket should not add content to thebody of the script tags (or any other tags in a template  unless theircontent is provided programmatically)  as it does not have the knowledgehow that affects the functionality of the page. Moreover  the contentthat Wicket adds to these script tags is only correct for Javascript(hence incorrect for the scripts in the example as they are notjavascript). In the above example adding /*  */will change the functionality of the script tag. If the '/&lt;![CDATA[/'part was necessary in the script tags above  they should be added by theperson that provides the template  not magically added by Wicket.I have attached a quickstart that demonstrates the issue. The quickstart has a &lt;script id='script1'&gt;Some Text&lt;/script&gt; element in HomePage.html that (by javascript) is shown in an alert box. Because of this bug  the alert will now start with '/&lt;![CDATA[/'  while it should simply show the text. See HomePage.html in the provided quickstart.,0,0
executeAllTimerBehaviors does not find all timer behaviours,WicketTester tester = new WicketTester();tester.startPage(WaitPage.class);tester.assertRenderedPage(WaitPage.class);tester.executeAllTimerBehaviors(tester.getLastRenderedPage()); public WaitPage() { Label message = new Label('message'  'Please wait ..'); add(message); add(new AjaxSelfUpdatingTimerBehavior(Duration.milliseconds(1000)) { @Override protected void onPostProcessTarget(AjaxRequestTarget target) { // wait for background thread to complete // if (task.isDone()) { ... stop(); setResponsePage(NextPage.class); } });The timer does not fire.Problem 1: The code looks for MarkupContainers Problem 2: The code looks for AjaxSelfUpdatingTimerBehavior but should look for AbstractAjaxTimerBehavior,0,0
Replace all String.split(char) with Wicket's Strings.split(String  char) for better performance,java.lang.String#split() method uses not-compiled java.lang.regex.Pattern objects to do its job. For splitting on a single character it is much better to use wicket-util's Strings#split(String  char),0,0
PageProvider should create a new Page instance if PageParameters are changed  even if a stored page exists.,The 'getStoredPage(int)' method returns a stored page instance even if user changes parameter values encoded into URL  and the PageParameters object of the stored page instance is never changed. So same page is displayed always though user changes url on browser manually.   HOW TO REPRODUCT **  1. unpack the attached sample project 'pagebug.tar.gz'.2. mvn jetty:run3. access to http://localhost:8080/user/user1You will see a form filled with information about user 1. The user's name is 'user 1'  age is 30 and country is 'Japan'.The mount path of this page is '/user/${userId}'. so 'user1' in the accessed url is a parameter value.after accessing to the url  the url will be changed to http://localhost:8080/user/user1?0 . it contains the page id of the currently displayed page.4. change some values and submit the form. page id will be changed on every submit.5. change only parameter value in url to 'user2'. Never change page-id.for example  if you now access to http://localhost:8080/user/user1?5  change the url to http://localhost:8080/user/user2?5 .6. This program must display information about user2  because the parameter value of url is changed. But you will see the information of user 1. Wicket always display the page of page-id = 5 (even though user changed url manually).In this sample program  I use LoadableDetachableModel for retrieving current parameter-value. But I don't get the new parameter-value because pageParameters object in a page instance is never changed after the construction. pageParameters is fixed in the constructor of Page class.I think that there are no easy way to retrieve parameter-values encoded into mount-path. Request.getRequestParameters() does not contain parameters encoded into mount-path. So there are no work-around for this issue.   HOW TO FIX THIS ISSUE **  We must return null from getStoredPage(int) method of PageProvider class  if current PageParameters is not same with the PageParameters of a stored page. In current code  getStoredPage(int) checks only if the class of both pages are same. We must check the PageParameters of both pages.   PATCH **  I attached a pache for PageProvider class. try it.,0,0
processScript in Wicket.Head.Contributor doesn't remove CDATA - eval fails in IE,There's incosistency between org.apache.wicket.util.string.JavaScriptUtils and wicket-ajax.jsEven though the source is marked with comment Script open tag. If this tag is changed  also update Wicket.Head.Contributor.processScript() function from wicket-ajax.jsIn JavaScriptUtils there are:public final static String SCRIPT_CONTENT_PREFIX = '/n/&lt;![CDATA[//n';public final static String SCRIPT_CONTENT_SUFFIX = '/n/]]&gt;//n';in wicket-ajax.js (line 1742 in 1.5.5 version) there are:// get rid of prefix and suffix  they are not eval-d correctlytext = text.replace(/^&lt;Unable to render embedded object: File (--//&#42;--&gt;&lt;) not found.[CDATA[//&#42;&gt;&lt;!--&#42;///  '');text = text.replace(///&#42;--&gt;]]&gt;&#42;//$/  '');As you can see the sequences in java and javascript DO NOT MATCH! There are missing new lines in JS and there are extra HTML comments &lt;!-- --&gt; that aren't added by the Java code.The result is  that these extra lines aren't removed and IE fails to eval such a javascript. I could fix this issue by editing the wicket-ajax.js like this:text = text.replace(/^/n//&#42;&lt;![CDATA[&#42;///n/  '');text = text.replace(//n//&#42;]]&gt;&#42;///n$/  '');But we need it fixed officially  because we use gradle for Wicket dependency.,0,0
Change IValidationError API to work with java.io.Serializable as other methods (info  error  success  ...) in Component and Session,Since a while o.a.w.Component's and o.a.w.Session #info()  #error()  #success()  etc. methods accept java.io.Serializable.With this ticket I suggest a change that will make o.a.w.validation.IValidationError in sync with this.,0,0
Repaint the initial state of the page if the page is expired  a new one is freshly created and the requested component is not available,From the users@ mailing list: http://markmail.org/thread/ttox5ymihtf5y55iA ComponentNotFoundException is being thrown if the page is expired  a new page is freshly created and due to component replacement the requested sub-component is not reachable.The parent component depends on whether a user is logged in. The sub-component has a link inside which is not reachable after page expiration because a different parent component is used in this case.,0,0
setTextEncoding on JavascriptResourceReferences/CssResourceReferences,Setting the encoding of JavascriptResources and CssResources in wicket is by now not easily to achieve.By now only html files are equipped with the charset option afterwads  but not CSS or JS files. Content-Type: application/javascript;charset=UTF8org.apache.wicket.request.resource.AbstractResource#setResponseHeaders() does take the textEncoding into account but there is no way to set it from the outside without introducing new classes by copy/pasting existing Resources and adapt them. The only resource which is able to modify the content-type through the constructor is the TextTemplateResource. One can specify 'application/javascript; charset=UTF8' and pass it as the content-type parameter. It's a hack  but this string then used for the content-type header.A separate charset parameter would be better in my opinion. UserGroup post: http://apache-wicket.1842946.n4.nabble.com/setTextEncoding-on-JavascriptResourceReferences-CssResourceReferences-td4472204.html,0,0
Autocomplete IE javascript error: 'target' is null or not an object,When I click to autocomplete textfield the javascript error bellow is shown.Webpage error detailsUser Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729)Timestamp: Thu  22 Mar 2012 08:05:57 UTCMessage: 'target' is null or not an objectLine: 68Char: 1Code: 0URI: http://xxx:8080/wicket/resource/org.apache.wicket.extensions.ajax.markup.html.autocomplete.AutoCompleteBehavior/wicket-autocomplete-ver-C51E30D722C9620E9D06F141A171849F.jsWicket 1.5.4 works fine.,0,0
Use an external host for the static javascript files (specially JQuery),There should be some (easy) way to specify an external URL (for example  on a CDN) for the JQuery script.IJavaScriptLibrarySettings.setJQueryReference() takes only a ResourceReference as a parameter  that must point to an application resource. One could create an IResource that redirects to the CDN  but that would require an additional request anyway.That support should exist also for wicket-ajax.js and wicket-event.js  but it is less of an issue  since they are tied to the Wicket version anyway (JQuery is hosted for free in a number of CDNs  so using them is very compelling).If there is some workaround  it should be documented in the wiki.,0,0
Stateful components which are invisible force page to be stateful,Stateful components which are not rendered (setVisible(false)) force the page to be stateful.Page#isPageStateless() visits all components to check Component#isStateless()  whether they are visible or not.Please change this so invisible components no longer force a page to be stateful.,0,0
Generic registry of javascript/css resource references,It would be nice if JavaScriptLibrarySettings had a generic mechanism to register javascript/css resource references (maybe using something like MetaDataKeys).This way  extension/third-party components (ModalWindow  DateTimeField  etc.) could register their resources  or just lookup for substitute resource references for their own scripts/stylesheets.This would allow some optimizations  such as minification/compression and joining many files into one  and hosting static files in CDNs.,0,1
Inline Enclosure needs to check isVisibleInHierarchy  not only isVisible,If the Visibility of the child component from the inline enclure uses setVisibleAllowed  the enclosure is rendered if the component is not visible. Take a look to the updateVisibility-method of the InlineEnclosure-Class. In my opinion the method should check for isVisibleInHierarchy.,0,0
ﾐ慴ｰﾐｺﾐｵ ModificationWatcher easier for extending,org.apache.wicket.util.watch.ModificationWatcher is very well encapsulated and if someone wants to extend it then he will have to copy/paste its code in the new class.The purpose of this task is to make ModificationWatcher more friendly for sub-classing.,0,0
Add setHeader() to MockHttpServletRequest to be able to override default headers,org.apache.wicket.protocol.http.mock.MockHttpServletRequest#setDefaultHeaders() sets few default headers but since there is only #addHeader() and no #setHeader() there is no way to override the value of 'User-Agent' header for example.http://stackoverflow.com/questions/9893609/can-one-set-the-browser-type-in-wicket-1-5-test-cases,0,0
Component#setDefaultModel() should call #modelChanging(),Component#setDefaultModel() should call #modelChanging() as #setDefaultModelObject() does.It worked by chance so far because addStateChange() is called.http://markmail.org/thread/uxl6uufusggqbb6s,0,0
wicket:link component ids get too long,The resolve() method of org.apache.wicket.markup.parser.filter.WicketLinkTagHandler appends modifies the original tag id and appends the next autoId to it. The problem is that this is done during every render  the the component id gets longer and longer.I had a situation on a production server where component ids were over 10k. RepeatingView just added to the problem.Long story short  I think resolve should just return the TransparentWebMarkupContainer with the modified id  and not set the original id.,0,1
TagUtils uses wrong separator in its #copyAttributes(),org.apache.wicket.markup.TagUtils#copyAttributes(Component  ComponentTag) uses '  ' as a separator for the attributes that it copies.If the attribute is 'class' then the separator should be ' '  if it is 'style' or 'onclick' then it should be '; '  ...,0,0
Give StringValue toEnum methods,In 1.4  Resources had a ValueMap as parameters  which had among other methods #getAsEnum. In 1.5  PageParameters are used instead  and the StringValues used here have all kinds of toSomething methods  but nothing for enums. I propose adding these for completeness.,0,0
TextTemplate in RenderHead() on component doesn't Re-Render for every page,I have a project that uses a menu thats repeated on every page. If I first view it on a mounted page /PageName and then look at it on a BookMarkable page/wicket/bookmarkable/page.class.name?foo the images referenced in my template do not appear.(the javascript template image strings do not change),0,0
HtmlHandler wrongly handles tags not requiring closed tags if the markup does not have 'top' level tag,Hi  I have custom component (extends MarkupContainer implements IMarkupCacheKeyProvider  IMarkupResourceStreamProvider) which fetches its HTML markup from database. Following HTML markup: &lt;img alt='' src='logo.png'&gt; &lt;br&gt;Some text &lt;br&gt;Some more text causes following error: 2012-04-12 10:52:53 012 &#91;http-8080-6&#93; ERROR: Unexpected error occurred Unable to find close tag for: '&lt;img alt='logo' src='logo.png'&gt;' in org.apache.wicket.util.resource.StringResourceStream@3d7e16fc  MarkupStream: &#91;unknown&#93;  at org.apache.wicket.markup.MarkupFragment.&lt;init&gt;(MarkupFragment.java:127)  at org.apache.wicket.markup.MarkupStream.getMarkupFragment(MarkupStream.java:485)  at org.apache.wicket.MarkupContainer.autoAdd(MarkupContainer.java:244)  at org.apache.wicket.MarkupContainer.renderNext(MarkupContainer.java:1421)  at org.apache.wicket.MarkupContainer.renderAll(MarkupContainer.java:1596)  at org.apache.wicket.MarkupContainer.renderComponentTagBody(MarkupContainer.java:1571)  at org.apache.wicket.MarkupContainer.onComponentTagBody(MarkupContainer.java:1525) I think the problem is that org.apache.wicket.markup.parser.filter.HtmlHandler does not handle such markup correctly. It does not call ComponentTag.setHasNoCloseTag(true) for the img tag. Such call is missing in postProcess() method. I think that this problem can be fixed by inserting: top.setHasNoCloseTag(true); after line 80 in HtmlHandler.java file. Michal,0,0
NumberTextField renders its value in unsupported number format,The issue is similar to WICKET-3591 but its fix doesn't help when the model object of the NumberTextField is a BigDecimal because BigDecimalConverter#convertToString() produces something like '123  456  789' and this is not supported by &lt;input type='number'&gt;'s spec: http://dev.w3.org/html5/markup/datatypes.html#common.data.float.,0,0
Make it easier to produce a page with links with absolute urls,We needed to create a page which links have absolute urls (protocol  host  port included). So I created a simple extension of MountedMapper that makes the relative url returned by super.mapHandler() to an absolute one.So far so far but later Wicket uses org.apache.wicket.request.UrlRenderer#shouldRenderAsFull() to decide whether to actually render the url as full (i.e. as absolute) and since the protocol  the host and the port matches with the current request's url attributes it decides to render the url as relative.Since Url class is final it is not possible to create a custom AbsoluteUrl which #toString() delegates to #toString(StringMode.FULL).I see two solutions:1) provide AbsoluteUrl class which is again final and uses StringMode.FULL2) add a boolean flag to Url that is used by UrlRenderer#shouldRenderAsFull() so I can force full modeDo you have other solutions ?,0,0
AjaxLazyLoadPanel not replaced within AjaxTabbedPanel,An AjaxLazyLoadPanel is not replaced when added as panel of an AbstractTab within an AjaxTabbedPanel.A set breakpoint in AjaxLazyLoadPanel constructor at AbstractDefaultAjaxBehavior.respond method is never reached.The attached quickstart will demonstrate the behavior.This is reproducible with version 6.0.0-beta1 and 6.0-SNAPSHOT.,0,0
AbstractTextComponent not escaping html data by default therefore user text is not redisplayed correctly,User input is not escaped in all text fields by default (and the default is not configurable).This leads to user entered text not being redisplayed correctly. You can replicate using the project from WICKET-3330. Just enter the text my&frac12;companyname and press enter The field will not redisplay the text entered properly,0,0
Fix missing in 1.4.19  was fixed in 1.3.3:  Discrepancy between Button implementation of getForm and the code in Form.findSubmittingButton(),There is a discrepancy between Button implementation of getForm (derived from FromComponent) and the code in org.apache.wicket.markup.html.form.Form.findSubmittingButton()Last one assumes form can be null while org.apache.wicket.markup.html.form.FormComponent.getForm() throws an exception if it is soThis was fixed in 1.3.3 based on https://issues.apache.org/jira/browse/WICKET-1414. Please migrate the fix to 1.4 code line.,0,0
wicktTester.getLastResponseAsString() returns wrong result after starting a Component,&gt; This following test : @Test public void test() throws Exception { WicketTester tester=new WicketTester(); tester.startComponentInPage(new Label('lableId'  'content') { @Override protected void onComponentTag(ComponentTag tag) { super.onComponentTag(tag); tag.put('test' '123'); } }); tester.assertResultPage('icket:id=/'lableId/' test=/'123/'&gt;content'); assertEquals('icket:id=/'lableId/' test=/'123 /'&gt;content' tester.getLastResponseAsString()); assertEquals('' tester.getResponse().getDocument());}exposes the wrong behaviour of test.getLastResponseAsString() after starting a component.It should return something such as '&lt;span&gt; .... &lt;/span&gt;'  bit it returns a string 'cut in the middle' : cket:id=/'lableId/' test=/'123/'&gt;contentsee attached quickstart,0,0
Spaces in path cause ModifcationWatcher to fail,The ModificationWatcher isn't able to reload resource files if there's a space in the path.The problem is that Files#getLocalFileFromUrl(String) receives an URL encoded String in which spaces are encoded to %20. They are never decoded and passed to File(). The fix is not to use the external representation of an URL but the file representation.,0,0
UrlRenderer produces wrong full urls when the passed parameter is not absolute (as Url understands 'absolute'),Code like:Url baseUrl = Url.parse('one/two/three');baseUrl.setProtocol('http');baseUrl.setHost('www.example.com');baseUrl.setPort(8888);UrlRenderer renderer = new UrlRenderer(new MockWebRequest(baseUrl));renderer.setBaseUrl(baseUrl); // this is needed because MockWebRequest cuts dataString fullUrl = renderer.renderFullUrl(Url.parse('../four'));Produces url: http://www.example.com/../four while it has to be http://www.example.com/one/four,0,0
Wicket example 'forminput' is broken due to bad url for IOnChangeListener,http://localhost:8080/forminput (wicket-examples) doesn't change the locale of the labels when the locale select is changed.The reason seems to be the produced url: './.?5-1.IOnChangeListener-inputForm-localeSelect' This is parsed to a Url with one empty segment and thus HomePageMapper doesn't match it and doesn't handle it.,0,0
OpenCloseTagExpander should include i tag,The OpenCloseTagExpander automatically expands similar tags like 'b'  'em' and 'strong' but not 'i'. To be consistent the 'i' tag should also be transformed.,0,0
Recorder#getSelectedChoices() can be very slow under certain circumstances,In Recorder#getSelectedChoices() the inner for-loop getPalette().getChoices() is called for every iteration. Depending on the efficiency of the implementation of the underlying model this might result in poor performance.,0,0
AjaxEditableLabel not selecting text or moving cursor on Firefox 11.0 or Safari 5.0.5,The class Javadoc for AjaxEditableLabel says:'''onEdit(AjaxRequestTarget) is called when the label is clicked and the editor is to be displayed. The default implementation switches the label for the editor and places the caret at the end of the text.&lt;/li&gt;'''However this does not happen on Firefox or Safari.Looking at the code  it is actually trying to place the caret at the end of the line and selecting the text in the form field. (This selecting the text is what I also want  and also the most common behavior of such ajax-editable fields on other big websites on the Internet)// put focus on the textfield and stupid explorer hack to move the// caret to the endtarget.appendJavaScript('{ var el=wicketGet('' + editor.getMarkupId() + '');' + ' if (el.createTextRange) { ' + ' var v = el.value; var r = el.createTextRange(); ' + ' r.moveStart('character'  v.length); r.select(); } }');target.focusComponent(editor);However the 'stupid explorer hack' as the code calls it  probably only works on explorer  because the el.createTextRange method is quite old and deprecated (it's only needed on MSIE &lt;9)I'm getting good results by just calling select() on the DOM element. I don't have MSIE available to test there but I think it will work there too.// put focus on the textfield and stupid explorer hack to move the// caret to the endtarget.appendJavaScript('{ var el=wicketGet('' + editor.getMarkupId() + '');' + ' el.select(); ' + ' }');target.focusComponent(editor);,0,0
Final methods on ResourceNameIterator prevent full customization of IResourceStreamLocator,IResourceStreamLocator contains the method newResourceNameIterator(...) which builds a ResourceNameIterator. Unfortunately ResourceNameIterator declares several getter methods (getLocale()  getStyle()  getVariation()  getExtension()) as final and thus ties the public API to the internal implementation of ResourceNameIterator. Therefore it's not possible to fully customize the behavior of ResourceNameIterator by subclassing.,0,0
Add Generics to TabbedPanel:,In 1.5  TabbedPanel#tabs has a wildcard signature: List&lt;? extends ITab&gt;. This makes it impossible to add tabs to that list  even though adding panels is one of the stated purposes of the #getTabs() method.On #wicket  dashorst suggested giving TabbedPanel a type parameter &lt;T extends ITab&gt;  which I think is a good idea. It should definitely be added in 6.0.What about 1.5.x? This would be a source-level break  but I think binaries should still work.,0,0
AbstractDefaultAjaxBehavior.getCallbackFunctionBody uses jQuery.extend,Wicket components should not rely on jQuery. jQuery.extend should be made available through the Wicket JS api and AbstractDefaultAjaxBehavior.getCallbackFunctionBody should use that.,0,0
Unencoded ampersands in CSS-/Javascript-Reference,Ampersands in CSS-/Javascript-References are not encoded properly  see the source code (html) in:http://www.wicket-library.com/wicket-examples/resourceaggregation &lt;!-- BasicGroupingKey &#91;group=GLOBAL  loadOrder=0  css=true&#93; --&gt;&lt;link rel='stylesheet' type='text/css' href='./wicket/resource/org.apache.wicket.Application/merged-resources?refs=org.apache.wicket.examples.resourcedecoration.HomePage:footer.css%7Corg.apache.wicket.examples.resourcedecoration.HomePage:header.css&amp;type=css' /&gt;&lt;!-- BasicGroupingKey &#91;group=APPLICATION  loadOrder=0  css=true&#93; --&gt;&lt;link rel='stylesheet' type='text/css' href='./wicket/resource/org.apache.wicket.Application/merged-resources?refs=org.apache.wicket.examples.resourcedecoration.HomePage:app.css&amp;type=css' /&gt;&lt;!-- BasicGroupingKey &#91;group=PAGE  loadOrder=0  css=true&#93; --&gt;&lt;link rel='stylesheet' type='text/css' href='./wicket/resource/org.apache.wicket.Application/merged-resources?refs=org.apache.wicket.examples.resourcedecoration.HomePage:HomePage.css&amp;type=css' /&gt;,0,0
Component#getMarkupId() generates id that gets hidden by AdBlock,Component#getMarkupId() generates ids containing string 'ad'. Element with such id (e.g.  'buttonad') is then hidden by the AdBlock plugin (because it matches AdBlock's CSS selector #buttonad).Since AdBlock is quite a common plugin  this issue might affect most of the applications using Wicket.Test project and screenshot is attached.&#8211;Wicket 1.4.21Firefox 12  AdBlock 2.0.3Linux 3.3.5  x86_64,0,0
Wicket 1.5.6 duplicates segments in absolute URLs,Since we migrate our application to Wicket 1.5.6 some URLs from BookmarkablePageLinks have duplicate segements for indicating a Shop and a Language item from our persistence model. For indicating a Shop and Language item we use our own ShopMapper and LanguageMapper (subclass of AbstractComponentMapper). This was working until we migrate to 1.5.6.For instance ...correct URL: host/servlet/shop/en/pagewrong URL: host/servlet/shop/en/shop/en/pageThis happens  for example  when the protocol of the linked URL is different from the current protocol (http/https). So  basically  all links that point to pages that are annotated with @RequireHttps are wrong.In our Application class we set the HttpsMapper as RootRequestMapper  e.g.:setRootRequestMapper(new HttpsMapper(new ShopMapper(new LanguageMapper(getRootRequestMapper()))  new HttpsConfig() ) );Using a debugger  I've tracked down the spot where wrong URL is rendered:org.apache.wicket.request.Url.resolveRelative(),0,0
Resource filtering breaks the calculation of rendered resources,The calculation of rendered resources at org.apache.wicket.markup.head.internal.HeaderResponse#rendered field is broken when org.apache.wicket.markup.head.filter.FilteringHeaderResponse is in use.The problem is that org.apache.wicket.markup.head.filter.FilteringHeaderResponse#getContent(String) creates its own instance of HeaderResponse and thus has its own 'rendered' set.If a filtered resource depends on a resource which is rendered in the head (i.e. in the default filtered bucked named 'headerBucket') then the latter is also rendered in the custom filter.,0,0
Shared Behavior's renderHead method called only for one component  not for all of them,When using a shared behavior among many components  its renderHead method is called only once. The reason is at the end of the Component.renderHead(HtmlHeaderContainer) method: for (Behavior behavior : getBehaviors()) { if (isBehaviorAccepted(behavior)) { if (response.wasRendered(behavior) == false) // &lt;---- check whether the behavior has been marked as rendered { behavior.renderHead(this  response); response.markRendered(behavior); // &lt;---- behavior marked as rendered } } }When calling this method of the first component  which contains given Behavior  the Behavior is added to the set of the already-rendered elements. This means  its renderHead method is never called for the rest of the components  which contain it.From documentation I suggest: Behaviors can be shared among more components (if they are not 'attached' in bind() method)  as written in Behavior class javadoc: 'They can be bound to a concrete component (...)  but they don't need to.' A Behavior method should behave the same way  as the same code placed directly in the component (in the corresponding method)Moreover  in the documentation of the Behavior.renderHead is written: 'Render to the web response whatever the component wants to contribute to the head section.' So as I understand it  the information about component should also be the 'key' whether to mark the Behavior rendered or not. More precisely  the proposed solution should be something like the following (Couple means something like a class with two fields - Behavior and Component): for (Behavior behavior : getBehaviors()) { if (isBehaviorAccepted(behavior)) { Couple c = new Couple(behavior  this); // &lt;---- create couple if (response.wasRendered(c) == false) // &lt;---- check the couple { behavior.renderHead(this  response); response.markRendered(c); // &lt;---- mark the couple as rendered } } }Maybe this is not a bug  but a feature. In case of the feature I think  that it requires at least a clarification in the documentation. In (probably) all other usage of shared Behavior  the Behavior does not cause any troubles and it behaves as expected from the documentation. But this method has quite inconsistent effect  comparing to the other ones.If an example is needed:I need a Behavior to attach all components  which have to automatically contribute to HTML head a JavaScript and CSS file with the same name as the component. The Behavior does not hold any data (no fields  empty bind method)  so I would like to make it singleton (or not directly pattern Singleton as such - for example let it overridable  but provide a default instance). Because creating new instances does not have much sense in this case and it brings many unnecessary objects on the heap.Using of new instance per component works fine  of course  but the issue is in the situation  if I need the shared instance across the application.,0,0
ThreadContext does not properly remove the ThreadLocal from the current thread,Actually  I only checked 6.0.0-beta2 and master  6.0.0-beta2 is not in the drop down.ThreadLocal.get() returns the current value  if one is set. If not  it creates a new value using the initialValue() method  AND (importantly) registers the ThreadLocal in the Thread's Map of ThreadLocals.In order for the get(false) method to work as expected  we must actually call ThreadLocal.remove() after a ThreadLocal.get() that returned null.Also  after the request was processed  we never properly remove the ThreadLocal from the Thread  we were simply setting it to the previous value  which was null most of the time. This is not enough. The ThreadLocal was still attached to the Thread  just the value it was storing was null.Here's hoping that Jira is working again and I can attach a patch.,0,0
NumberTextField does not have default minimum and maximum,Javadoc of NumberTextField says:A TextField for HTML5 &lt;input&gt; with type number.Automatically validates the input against the configured min and max attributes. If any of them is null then Double.MIN_VALUE and Double.MAX_VALUE are used respectfully. Note: FormComponent.setType(Class) must be called explicitly!It is not true. We have constructor which sets them to null: public NumberTextField(String id  IModel&lt;N&gt; model  Class&lt;N&gt; type) { super(id  model  type); validator = null; minimum = null; maximum = null; }and if I don't set them manually  in case of error nulls go to RangeValidator (line 84-85: error.setVariable('minimum'  min); error.setVariable('maximum'  max);causing:java.lang.IllegalArgumentException: Argument 'value' may not be null.Nevertheless  I think reflection API should be used to determine if given Number has MAX_VALUE/MIN_VALUE and this one should be used. In other case I think it is ok to use Double.MAX_VALUE/MIN_VALUE.or maybe you have another ideas?,0,0
URLRenderer renderFullUrl,When using the following code to create an absolute url in wicket 1.5.7 from a page class and parameters  there are also duplicate segments in the url. the rendered absolute url is not correct.final Url url = RequestCycle.get().mapUrlFor( pageClass  pageParameters );final String result = RequestCycle.get().getUrlRenderer().renderFullUrl( url );RequestCycle.get().mapUrlFor(..) does not return an 'absolute' url (first segment will not be empty).See also description in WICKET-4561,0,0
Closing  tag is incorrectly setup as autocomponent,The closing instance of the &lt;wicket:container&gt; tag returns true when isAutoComponentTag() is called whereas the opening instance correctly returns false.The problem lies probably in the WicketTagIdentifier class which simply checks if there is a wicket:id attribute value and makes all tags (opening or closing) autocomponent tags if there is no wicket:id.Obviously any closing tag doesnt have a wicket:id assigned.,0,0
WicketAjaxDebug.logError used in Wicket.Head.addJavascript - JS error when wicket-ajax-debug.js not loaded,Wicket.Head.addJavascript (defined in wicket-ajax.js) encapsulates javascript in this code:content = 'try{'+content+'}catch(e){WicketAjaxDebug.logError(e);}'; However  WicketAjaxDebug can be undefined as it's declared in wicket-ajax-debug.js which might not be included. As a consequence  catch block will fail and obfuscate any error catched.I believe this catch block should call Wicket.Log.error(e) instead.,0,0
DataTable toolbars do not handle dynamically changing columns in the table,All the packaged toolbars for the DataTables fail to handle dynamically changing column in the table.HeadersToolbar - is new columns are added  they do not have headers. If columns are removed  the headers are not removed.NoRecordsToolbar - colspan is static to the number of columns when the table was created. If more columns are added  or if columns are removed  then the incorrect colspan is used.NavigationToolbar - incorrect static colspan  like NoRecordsToolbar.FilterToolbar - same problem as HeadersToolbar  just s/header/filter/,0,0
Vars in ValidationErrors should be properly converted,Currently variables in ValidationErrors are substituted with Strings.toString().This is problematic for variables with different representations in different languages (e.g. decimal separator). The converter of the processing component should be used instead.,0,0
ResourceStreamLocator vs ResourceFinder,I'm a bit confused by the responsibilities of ResourceFinder vs ResourceStreamLocator. Looking around in the code  I found the following: IResourceFinder is apparently only implemented via its extension interface IResourcePath. Its two implementations Path and WebApplicationPath look through a list of filesystem folders for files. ResourceStreamLocator does two things: it loads resources  either via an IResourceFinder (which only finds filesystem resources) or via the classloader (it does this itself). it uses a ResourceNameIterator to generate all possible filename variations based on locale and style and then tries to load one of them via the above mechanisms.Is this correct?If so  I think we have some mixed-up responsibilities here. I propose the following: add a third IResourcePath implementation (e.g. ClassloaderPath) that handles loading of resources in classpaths. It should be able to try multiple paths (e.g. '/'  'META-INF/resources' etc). Instead of a single ResourceFinder  Application should have a list of them  by default containing WebApplicationPath (today's default) and the new ClassloaderPath. ResourceStreamLocator should not do any loading on its own at all and just use the ResourceFinders defined in this new list in Application.This would also get rid of the hard-coded 'META-INF/resources' lookup that currently is done in ResourceStreamLocator (I'll write a second ticket about that  it's causing us some problems).I think this could still be done within 6.0. Objections?,0,0
Optimize PageExpiredException to not load its stacktrace,The stacktrace of PageExpiredException is useless. It is being thrown at only one place - PageProvider  so it is always the same. But it is really useless for the end user.Overriding its #fillInStackTrace() to return null will be a minor performance improvement.,0,1
WicketFilter unify the filterPath,WICKET-4626 WicketFilter unify the filterPathUse of getter/setter internally to limit read/writes to filterPath field location.Removed lazy initialization code from main code path.Provide a new method #canonicaliseFilterPath(String) to convert'/wicket/' into 'wicket/' as expected internally and maybe used byunit tests to further validate correct values for filterPath.Added unit test for this new method and use method in setter.,0,0
Change Url#parse() methods to accept CharSequence instead of String,RequestCycle#urlFor() methods return CharSequence.By making org.apache.wicket.request.Url#parse() methods accepting CharSequence instead of j.l.String the user will save some typing (adding .toString()).,0,0
AbstractLink does not call getBody to get its body,AbstractLink#getBody() is not final  and can be overridded  but AbstractLink#onComponentTagBody() does not call it. Instead it references the bodyModel set by the setBody() method.,0,0
ResourceStreamResource should use #getResourceStream() instead of directly using the 'stream' field,org.apache.wicket.request.resource.ResourceStreamResource#newResourceResponse() resolves the IResourceStream by using #internalGetResourceStream() but later still uses the 'stream' member field.,0,0
MultiFileUploadField after selecting a file does not hide properly input field,Component org.apache.wicket.markup.html.form.upload.MultiFileUploadField in related javascript uses code: ''this.style.position = 'absolute'; this.style.left = '-1000px' ' to hide a file input after selecting a file.Unfortunately on my screen (1920x1200) if I put this component on the right side of a page then after selecting a file  'the hidden input' is moved to the left of its container  but still visible for a user.Changing style.position to 'fixed' should resolve the problem  so the input field will be positioned relative to the browser window  not to its ancestor.,0,0
Using setResponsePage() before page rendering should skip the rendering of the page,This ticket follows from the email thread http://markmail.org/thread/uk5y4ddoopntmkgdWhen setResponsePage() is used  the current page is still rendered. The response thus generated is then thrown away completely and a replacement request handler is used. I can think of 3 reasons why this should be avoided:1-Performance; it's wasteful to render components to discard them right away2-Needs complete components hierarchy; even if setResponsePage() is used in a page constructor (e.g. when redirecting depending on page parameters)  since the page will be rendered  all of its components or some substitutes must be added to the page. Otherwise Wicket will throw a missing component exception in dev mode.3-Feedback messages; if the needlessly rendered page contains a feedback panel  feedback messages registered in the session will be swallowed by the thrown away page rendering.,0,1
Make it possible to use JsonFunction as a AjaxCallListener's handler,Currently the IAjaxCallListener's handlers could be an instance of CharSequence. Wicket wraps them in JsonFunction and sets the respective parameters for the handler.By making JsonFunction itself a CharSequence allows the developer to use it as a handler and to provide the whole JS function code  not just the body which makes the code looks a little bit strange because some variables are assumed to be passed (the parameters) from somewhere else.,0,0
AjaxFallbackLink and log a warning when there are several ajax event behaviors on the same event,When I was using an AjaxFallbackLink I got the warning about multiple Behaviours changing the 'onclick' attribute.I changed it to AjaxLink and the warning disappeared.,0,0
Atmosphere Modul not working on first page after Jetty restart,After Jetty is started if the very first page being visited is a page with AtmosphereBehavior (using @Subscribe)  for some reason by the time the page is being registered by EventBus (#registerPage(String trackingId  Page page)) the session is null and after the page has been rendered its not null any more thus having a different PageKey and so the events for the page are filtered out at line #140 or EventBusIf you just add Session.get().bind() in the constructor method of your page  everything would work as expected.,0,0
encodeURL broken on Tomcat 7.0.28,During page transition wicket used to encode an '../../tisch' which results in an exception:Caused by: java.lang.IllegalArgumentException at org.apache.catalina.connector.Response.normalize(Response.java:1799)The transition (within an ajax call) :http://localhost:8080/wicket/bookmarkable/de.test.pool.manage.ManagePool?11http://localhost:8080/tischIMHO the double parent '..' is correctThere exists already an bugzilla issue created but rejected as invalid https://issues.apache.org/bugzilla/show_bug.cgi?id=53469.If the wicket code works as expected there must be an error in the tomcat. Maybe the wicket development team has closer access to the tomcat developers,0,0
Upgrade Atmosphere to 1.0-beta,Version 1.0 of the Atmosphere Framework is nearing completion. Wicket-atmosphere should be upgraded to 1.0-beta. Using the beta is fine  because wicket-atmosphere itself is also beta.,0,0
Add an additional Ajax call listener point - before the call,We need to add another point in the Ajax call lifecycle that is called as early as possible.Until now we have the preconditions which are called in jQuery's beforeSend() and they may stop the call completely. If they pass then the dynamic extra parameters are evaluated and the 'before' handlers are executed.But in some cases one may need to execute some handler as early as possible. For example to transfer the value of some complex widget to &lt;input type='hidden'&gt; which will be serialized in jQuery's data with the default means. Using dynamic extra parameters will be able to do the same but the price will be much higher because the hidden field's value will be already in the data with an empty value and one should care to remove it before adding the dynamic value.So I suggest to move 'before' handlers at the top of Wicket.Ajax.doAjax() method and add a new one - 'beforeSend' which will do the same as 'before' handlers until now.,0,0
LazyInitProxyFactory uses wrong ClassLoader in OSGi environment,The method LazyInitProxyFactory#createProxy use Thread.currentThread().getContextClassLoader() to create a new proxy instance. It seems that this is not correct in an OSGi environment.Preferred is to use the ClassLoader provided by the AbstractClassResolver class (getClassResolver is not part of IClassResolver). Then it will be something like: ClassLoader classLoader; if (Application.exists()) { AbstractClassResolver classResolver = (AbstractClassResolver) Application.get() .getApplicationSettings() .getClassResolver(); classLoader = classResolver.getClassLoader(); } else { classLoader = Thread.currentThread().getContextClassLoader(); } try { return Proxy.newProxyInstance(classLoader  new Class[] { type  Serializable.class  ILazyInitProxy.class  IWriteReplace.class }  handler); },0,0
ResourceModel once assigned should not re-assign,ResourceModel's AssignmentWrapper is itself a ResourceModel.But sometimes you want to assign a ResourceModel to a component explicitely via #wrapOnAssignment() before passing the wrapper elsewhere.This is not possible currently  because the passed AssignmentWrapper will re-assign to the component it is passed to.,0,0
XmlPullParser doesn't parse correctly attributes with complex namespace,Having a markup like:&lt;a class='addthis_button_google_plusone_badge' g:plusone:size='smallbadge' g:plusone:href='https://plus.google.com/25252/'&gt;&lt;/a&gt; causes XmlPullParser to throw the following exception:java.text.ParseException: Same attribute found twice: g:plusone (line 19  column 100) at org.apache.wicket.markup.parser.XmlPullParser.parseTagText(XmlPullParser.java:673) at org.apache.wicket.markup.parser.XmlPullParser.next(XmlPullParser.java:294) at org.apache.wicket.markup.parser.filter.RootMarkupFilter.nextElement(RootMarkupFilter.java:58).....,0,0
AutoLinkResolver looks in the wrong scope,When turning on MarkupSettings#automaticLinking  AutoLinkResolver is supposed to touch tags like &lt;img&gt; and &lt;a&gt; and set their src/href attributes so that packaged resources are correctly referenced.I found a situation where that does not work: If you have a panel  and e.g. an &lt;img&gt; tag inside that panel  and the &lt;img&gt; tag is NOT enclosed in a container component  it looks for the resource in the scope of the surrounding component  not in the panel's scope. It obviously can't find it there  so it just dumps the raw attribute.If you put that &lt;img&gt; tag into a MarkupContainer (like WMC) then it works correctly. So it looks like the scope is off-by-one or something like that. I'll investigate.,0,0
tag broken in certain situations when  reference added in page header section,Closing &lt;/script&gt; tag is swallowed in certain situations when external script reference is added (&lt;script src=''&gt;&lt;/script&gt;) to the page &lt;head&gt;&lt;/head&gt; section in Wicket 6.0.0-beta2 and beta3 and SNAPSHOTOriginal source code for &lt;head&gt; section:&lt;head&gt; &lt;meta charset='utf-8' /&gt; &lt;title&gt;Apache Wicket Quickstart&lt;/title&gt; &lt;link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:regular bold' rel='stylesheet' type='text/css' /&gt; &lt;link rel='stylesheet' href='style.css' type='text/css' media='screen' title='Stylesheet' /&gt; &lt;script type='text/javascript' src='http://akuku/something1.js'&gt;&lt;/script&gt; &lt;script type='text/javascript' src='http://akuku/something2.js'&gt;&lt;/script&gt; &lt;script type='text/javascript' src='http://akuku/something3.js'&gt;&lt;/script&gt; &lt;script type='text/javascript' src='akuku/something4.js'&gt;&lt;/script&gt; &lt;script type='text/javascript' src='/akuku/something5.js'&gt;&lt;/script&gt; &lt;script type='text/javascript' src='akuku/something6.js'&gt;&lt;/script&gt;Rendered HTML: &lt;head&gt; &lt;meta charset='utf-8' /&gt; &lt;title&gt;Apache Wicket Quickstart&lt;/title&gt; &lt;link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:regular bold' rel='stylesheet' type='text/css' /&gt; &lt;link rel='stylesheet' href='style.css' type='text/css' media='screen' title='Stylesheet'/&gt; &lt;script type='text/javascript' src='http://akuku/something1.js'&gt;&lt;/script&gt; &lt;script type='text/javascript' src='http://akuku/something2.js'&gt;&lt;script type='text/javascript' src='http://akuku/something3.js'&gt;&lt;script type='text/javascript' src='akuku/something4.js'&gt;&lt;/script&gt;&lt;script type='text/javascript' src='/akuku/something5.js'&gt;&lt;script type='text/javascript' src='akuku/something6.js'&gt;&lt;/script&gt; &lt;/head&gt;,0,0
Unescaped html in autocomplete,Create list of Strings with html keywords: List&lt;String&gt; list = Arrays.asList('a'  '&lt;td&gt;'  '&lt;li&gt;' '&lt;/td&gt;');Let autocomplete display these values: @Override protected Iterator getChoices(String input) { return list.iterator(); }html is unescaped  strings are 'copy and paste''d to htmlAjax response (from Firebug) looks like this:&lt;ul&gt;&lt;li textvalue='a'&gt;a&lt;/li&gt;&lt;li textvalue='&lt;td&gt;'&gt;&lt;td&gt;&lt;/li&gt;&lt;li textvalue='&lt;li&gt;'&gt;&lt;li&gt;&lt;/li&gt;&lt;li textvalue='&lt;/td&gt;'&gt;&lt;/td&gt;&lt;/li&gt;&lt;/ul&gt;,0,0
Allow using custom CSS classes for the selected and last TabbedPanel tabs,Make it possible to use custom CSS classes for the selected and last tab in TabbedPanel,0,0
StringValidator.exactLength has wrong variable in ErrorMessage,In error message for StringValidator.exactLength is variable ${exact}   but in StringValidator.decorate is added variable length to map and not exact. Exception when is error message interpolate for show in feedback.Caused by: java.lang.IllegalArgumentException: Value of variable [&#91;exact&#93;] could not be resolved while interpolating [['${label}' is not exactly ${exact} characters long.]]property from application.StringValidator.exact='${label}' is not exactly ${exact} characters long.When I added same property in my own properties and change exact to length  it works.,0,0
tracking id retrieved in AtmosphereBehavior#onRequest() is always 0,jquery.atmosphere.js will always use 0 as initial tracking-id to send request and then reassign it from server response.AtmosphereBehavior#getUUID() shouldn't return the tracking-id from request header  since the initial request's tracking-id is 0.The correct way to retrieve tracking-id is calling AtmosphereResource#uuid(),0,0
ThreadContext should be detached before each subscribed page gets notified,Since the event subscriptions may cross different sessions  before entering request cycles of notified page  the ThreadContext should be detached except application instance.In EventBus#post(Object event)  ThreadContext.detach() should be placed inside the for-loop block of atmosphere resources otherwise Session().get() may return previous page's session.,0,0
Filter component does not clear filter fields,The GoAndClearFilter.onClearSubmit() does not clear filter fields because the originalState member has the current values of the filter. I think it should create a new instance of the originalState class instead of clone the model.To verify use the phonebook sample (https://github.com/wicketstuff/core/tree/master/jdk-1.6-parent/phonebook). The clear only works if 'go' was not pressed after enter some values in the filter  but if you press go and then want to clear the filter it keeps the values.Attached is a patch that makes the phonebook sample work.It might also be useful if the originalState attribute were made protected or accessible via protected method to allow users to overwrite the onClearSubmit() method and access the originalState attribute.,0,0
TimeField not able to work with a java.sql.Time,When using the TimeField with a model whose object is a java.sql.Time  I get an error similar to the following when submitting the form:Last cause: Cannot parse '1/1/70' using format java.text.SimpleDateFormat@b4dc7db3Here's how the TimeField is constructed:TimeField tf = new TimeField(id  new Model&lt;java.sql.Time&gt;() {public java.sql.Time getObject() {// return java.sql.Time}});This error is occurring because SqlTimeConverter is trying to convert the string representation of the java.util.Date obtained from the TimeField. TimeField doesn't support anything other than java.util.Date. It would be useful if TimeField could work with subclasses of java.util.Date such as java.sql.Time. In order to achieve this  I would like to propose:Changing setConvertedInput(new Date(date.getMillis())); in DateTimeField.convertInput() to setConvertedInput(newDateInstance(date.getMillis()));Create an overridable newDateInstance(long) method. Users of TimeField can override this method to create a java.sql.Time instance instead of a java.util.Date. The form component conversion process will then work when the model object is a java.sql.Time.,0,0
CssPackageResource doesn't work if the extension isn't css,CssPackageResource#processResponse is never called if the extension isn't css. It works for .css because PackageResourceReference#getResource checks if the extension is css and then creates a CssPackageResource. For anything else than .css/.js a PackageResource is created.Actually the overridden processResponse method in CssPackageResource (instead of PackageResource) should get called  but ResourceReferenceRegistry#createDefaultResourceReference installs a plain PackageResource which gets called later.,0,0
KittenCaptchaPanel is broken,The code from the KittenCaptchaPanel example works fine with wicket versions 1.5.8 and 6.0.0-beta1  but fails to highlight kittens with versions 6.0.0-beta2 and 6.0.0-beta3.,0,0
SerializingObjectSizeOfStrategy do not use framework serializer,Currently default implementation of SerializingObjectSizeOfStrategy do not use FrameworkSettings  thus it causes a ObjectNotSerializableException if serializer have custom behaviours.,0,0
Resource bundles are not resolved on PriorityHeaderItems,If a bundle X provides resource A  and resource A is rendered as priority header item  the resource A is rendered  not bundle X.,0,0
''NEW VALUE' is not a valid Serializable' error during ajax form submission,I attached a quickstart with a test in TestHomePage#formSubmitsSuccessfully.The test throws ''NEW VALUE' is not a valid Serializable' error when 'NEW VALUE' string in 'value' textField is submitted as a part of myForm ajax submission.The problem is that a call to Objects#convertValue(nonNullNonArrayValue  Object.class) will always return null if nonNullNonArrayValue is a value that is not null and not an array! Shouldn't it always return the first parameter when the second parameter is Object.class?Sven on Wicket forum suggested to fix this as by adding another if-statement in Objects#convertValue() if (toType.isInstance(value)) { result = toType.cast(value);}See the following forum thread for more information http://apache-wicket.1842946.n4.nabble.com/Issues-with-default-type-conversion-in-1-5-td4651857.html,0,0
FormComponents remain invalid forever if there is no feedback panel,if there is no feedback panel the error messages are not removed in ondetach and form component re-validation is skipped so the form component  once marked as invalid  will remain invalid forever or at least until its error messages are rendered.the error messages should be dropped and the form component should be re-validated on every form submit.,0,0
DOM ids change of the input fields of FilterToolbar,The fix in WICKET-3916 is not effective: https://fisheye6.atlassian.com/changelog/wicket?cs=1148229https://github.com/apache/wicket/blob/master/wicket-core/src/main/java/org/apache/wicket/Component.java#L2506As one can see in Component.internalRenderComponent()  the method Component.onComponentTag()  where the markup id is written to the tag  is called before the behavior had a chance to call setOutputMarkupId(true). (The Behavior.onComponentTag() is called in Component.renderComponentTag() a few lines down. The behavior has to call setOutputMarkupId() earlier  like in onConfigure(),0,0
JavaScriptStripper fails with single line comments,The valid inputx++ //x++gets transformed tox++ x++which is syntactically invalid. This breaks the unminified version of bootstrap 2.1.1.The problem doesn't occur with multiline comments because the linebreaks are preserved there.,0,0
Clicking on Label of Radio doesn't update component with Ajax update,We just upgraded a application from wicket 1.4 to wicket 6.We discovered that when clicking on the label of a radio button that has a AjaxFormChoiceComponentUpdatingBehavior attached the radio is not selected.I'll attach 2 testcases (one for wicket 1.4 and one for wicket 6),0,0
Wicket 6: modal windows in Safari are always in drag or resize mode,In Wicket 6 using Safari  a modal dialog will not allow interactions with form components. The whole dialog always seems to be in 'drag' mode. Click anywhere on the panel and the dialog will drag.Interaction works fine with all other browsers.,0,0
ComponentFeedbackPanel broken under Wicket 6.0.0 when RenderStrategy.REDIRECT_TO_RENDER,Test case created on github  see https://github.com/danhaywood/wicket-4773browse to http://localhost:8080/wicket-examples/forminput and follow the instructions.,0,0
PageParameters#mergeWith may loose values of the 'other' PP,The code at org.apache.wicket.request.mapper.parameter.PageParameters#mergeWith() looks like:for (NamedPair curNamed : other.getAllNamed()) set(curNamed.getKey()  curNamed.getValue());may loose some values if 'other' has a named parameter with several values.With the current code only the last name/value pair is preserved.,0,0
Using both MountedMapper and CryptoMapper causes warning,Having both MountedMapper and CryptoMapper causes:WARN - WebPageRenderer - The Buffered response should be handled by BufferedResponseRequestHandler public void init() { setRootRequestMapper(new CryptoMapper(getRootRequestMapper()  this)); mountPage('/home'  HomePage.class); super.init(); } public HomePage(final PageParameters parameters) { super(parameters); add(new Label('version'  getApplication().getFrameworkSettings().getVersion())); add(new Form&lt;Void&gt;('form')); }--HomePage.html...&lt;form wicket:id='form'&gt;&lt;/form&gt;...,0,0
DOM ids change of the input fields of FilterToolbar,The fix in WICKET-3916 is not effective: https://fisheye6.atlassian.com/changelog/wicket?cs=1148229https://github.com/apache/wicket/blob/master/wicket-core/src/main/java/org/apache/wicket/Component.java#L2506As one can see in Component.internalRenderComponent()  the method Component.onComponentTag()  where the markup id is written to the tag  is called before the behavior had a chance to call setOutputMarkupId(true). (The Behavior.onComponentTag() is called in Component.renderComponentTag() a few lines down. The behavior has to call setOutputMarkupId() earlier  like in onConfigure(),0,0
URL rendering regression,The way URLs are encoded was changed (WICKET-4645) and now the first request (with ;jsessionid in path) generates invalid internal links:My page is mounted to '/Home/' and I get redirected to '/Home/;jsessionid=1234?0' (fine). There's a Link on the page and the generated URL for it is '../Home;jsessionid=1234?0-1.ILinkListener-link'. Note the missing '/'. This results in a 404 and breaks basically all of my system tests.I'll attach a simple quickstart which demonstrates the problem. It's important to delete the jsessionid cookie before accessing the page.,0,0
RfcCompliantEmailAddressValidator error message not defined,The error message of the RfcCompliantEmailAddressValidator seems not to be defined.In case of validation error the following warning occurs: org.apache.wicket.markup.html.form.FormComponentCould not locate error message for component:RequiredTextField@description:form_id:emailand error:[ValidationError message=&#91;null&#93; keys=&#91;RfcCompliantEmailAddressValidator&#93; variables=[[pattern=(??:/r/n)?[ /t])*(???:[^()&lt;&gt;@ ;:/'.[] .../t])))/&gt;(??:/r/n)?[ /t]))))?;/s*)]]]. Tried keys:email.RfcCompliantEmailAddressValidator RfcCompliantEmailAddressValidator.,0,0
Wicket unit tests rely on hashmap iteration order,Starting from version 7u5 java has supported randomizing the hashmap String key order (enabling this will fix CVE-2012-2739). It is also a good way to test the code if it is relying on hashmap order.More details: http://docs.oracle.com/javase/7/docs/technotes/guides/collections/changes7.htmlIn the latest Java 8 (b58) the randomized hashmap is enabled by default causing some wicket unit tests to fail randomly.,0,0
DatePickerTest fails because of java inconsistensy on localizing March german shortname Mrz vs Mﾃ､r,The Oracle java7 and older return Mrz as german march short name.The Oracle java8 seems to have switched to the official (see http://de.wikipedia.org/wiki/Vorlage:Monat_Name-Nummer ) three letter short name Mﾃ､r.Some googling showed that IBM java has used the offical short name at least since 2008.I propose as a fix that the non-english test language is changed to something other than Locale.GERMAN in DatePickerTest method myTestExecution. For example Locale.ITALIAN  which has had consistent localization in Java world. Plus of course the reference data in DatesPage1_ExpectedResult.html needs to be regenerated.,0,0
UrlDecoder should log a message when invalid input is provided,In the class: org.apache.wicket.protocol.http.WicketURLDecoder there are two IllegalArgumentException which should be wrapped in WicketRuntimeException  otherwise they are caught by the exception handler form the servlet container (jetty  tomcat  ...) which then uses their http 500 error code configuration instead of the exception handling of wicket.Wrapping them would be good for consistency and help manage runtime exceptions. These are the two exceptions:throw new IllegalArgumentException('URLDecoder: Incomplete trailing escape (%) pattern'); throw new IllegalArgumentException('URLDecoder: Illegal hex characters in escape (%) pattern - ' + e.getMessage());,0,0
Add #setStatus(int) in AbstractResource.ResourceResponse,org.apache.wicket.request.resource.AbstractResource.ResourceResponse provides #setError(int code  String message) but doesn't provide #setStatus(int code).This makes it hard to set custom headers (e.g. cache control) and set status 304 because if HttpServletResponse#setErrorCode() is used then many headers are reset (including the cache control ones).,0,0
AjaxEditableChoiceLabel won't close select onblur,AjaxEditableChoiceLabel wonﾂｴt close the select combo (showed after clicking in the asociated label) when it losses the focus. It's supossed to call the onCancel method like it does in AjaxEditableLabel but the select turns into a label only selecting a different value in the select combo (it doesn't work pressing Escape or clicking in other part of the page).I fix it localy adding this code:editor.add(new AjaxEventBehavior('blur') { protected void onEvent(AjaxRequestTarget target) { AjaxEditableChoiceLabel.this.onCancel(target); }});For the editor declared as DropDownChoice in line 183 of AjaxEditableChoiceLabel .java.,0,0
CLONE - BaseWicketTester.clickLink() does not work with a ResourceLink with ResourceReference,When using BaseWicketTester.clickLink() with a ResourceLink with a ResourceReference  it does not work.Clicking link in server (Jetty) it works and opens the resource. See attached quickstart.When the ResourceLink is created with the Resource directly  BaseWicketTester.clickLink() works. @Test public void clickingLink() { // doesn't work tester.clickLink('shared'); Assert.assertEquals(tester.getContentTypeFromResponseHeader()  'text/plain'); } @Test public void usingListener() { // doesn't work either tester.executeListener(tester.getComponentFromLastRenderedPage('shared')  IResourceListener.INTERFACE); Assert.assertEquals(tester.getContentTypeFromResponseHeader()  'text/plain'); },0,0
Make SerializationChecker easier for extending so custom checks can be added to it,Currently SerializationChecker is used in DEV mode when there is a problem with the serialization of a page to show which member field causes the problem.The checker can be improved to support additional custom checks like the one described at http://wicketinaction.com/2011/11/detect-attached-models-and-entities/ and similar.,0,0
Modal panel mouse pointer in resize style for MSIE8 and MSIE9,In IE8 and IE9 the mouse pointer has the w-resize or e-resize style when hovering above a panel modal window. The wicket example does not have a doctype so Internet Explorer goes into quirks mode. Quirks mode is not an option for us.http://www.wicket-library.com/wicket-examples-6.0.x/ajax/modal-windowI will attach a quickstart.,0,0
Return error code 400 when an Ajax request has no base url set in header/request parameters.,Hello currently we've got a problem with faked ajax requests. these ajax requests misses some parameters  but the wicket-ajax header flag is set. So ServletWebRequest throws an exception:java.lang.IllegalStateException: Current ajax request is missing the base url header or parameter at org.apache.wicket.util.lang.Checks.notNull(Checks.java:38) at org.apache.wicket.protocol.http.servlet.ServletWebRequest.getClientUrl(ServletWebRequest.java:171) at org.apache.wicket.request.UrlRenderer.&lt;init&gt;(UrlRenderer.java:59)These faked requests are so massive  that our application is no longer monitorable. Our workaround rejects these requests via apache config. Instead of logging an exception  in deployment mode wicket should log a warning and reject the request,0,1
AbstractResourceReferenceMapper doesn't escape separators in style/variation names,org.apache.wicket.request.mapper.AbstractResourceReferenceMapper#encodeResourceReferenceAttributes() doesn't escape '-' character when generating the query string parameter with the locale-style-variation.So using a style with name 'a-b' leads to parameter with name '-a-b' and later is decoded to style == 'a' and variation == 'b',0,0
Integer overflow in AbstractToolbar,private static int counter = 0;This counter will overflow anytime... Please remove static.,1,1
Making MultiFileUploadField use HTML5 multiple attr & remove confusing fakepath,WICKET-3370 prepared the terrain (all major browsers except IE already support it).I will make a Git pull request for getting this into the master branch.Here is what the changes do (commit comment):Added the possibility to select multiple files in the OS dialog forbrowsers that support HTML5 'multiple' attribute. For browsers that donot support it  or if you do not set the boolean to true  it will behavethe same as before.New: easier select multiple files from multiple folders shows the multiple files after choosing them - one per lineFixes: the delete buttons are aligned instead of positioning after thevariable length file names useless and confusing 'C:/fakepath' in filenames reported by somebrowsers (in multiple with single select mode) are now hidden.,0,0
Page parameters not working with CryptoMapper,When CryptoMapper is used  page parameters do not work. This is because the incorrect request is set in the request cycle. The incorrect request contains the encrypted url  where the page parameters are encoded into the url segments. When the CryptoMapper maps a url to a request handler  it should set the request to the correct request when the request handler is selected.This was reported on the users@ list  but I have also fallen victim to it when getting urlFor(resourceReference  pageParameters) and the pageParameters not comming out on the other end.See:http://mail-archives.apache.org/mod_mbox/wicket-users/201211.mbox/%3C50991F74.3050605@unknown.za.net%3Ehttps://github.com/jesselong/wicket/commits/for-apache-master-pr-4 (3 commits),0,0
Wicket-Atmosphere track message length,When activating a PerRequestBroadcastFilter  the methods annotated with @Subscribe are unable to contribute to the AjaxRequestTarget.At the Filter level  the messages are OK but the client receives an empty &lt;ajax-response&gt;.A quickstart is attached where target/WEB-INF/lib is provided because jquery.atmosphere.js has been modified in order to activate track message length.Feel free to ask for more info.Regards Pierre Goupil,0,0
CheckBoxMultipleChoice should implement getAdditionalAttributes as RadioChoice,Today there is no way to add additional attributes to each checkbox in CheckBoxMultipleChoice  the only way is to override the entire appendOptionHtml and copy the entire original source code and in that add your additional attribute. A much better way is to have Wicket provide a extension hook like org.apache.wicket.markup.html.form.RadioChoice.getAdditionalAttributes(int  T).,0,0
Rendering of feedback messages fails with DebugBar in page,After the page is detached to calculate its size  messages are no longer available for FeedbackPanel to get the CSS styling for messages  failing with a NullPointerException.,0,0
ValidationError messages for NumberTextFields with minimum/maximum are always English,Although my Form's Locale is  e.g.  de_DE  the error message generated from AbstractRangeValidator#validate(IValidatable) is always English.My German custom message for resource key 'RangeValidator.range' in the Page's resource bundle gets ignored too - the default custom message from the resource bundle is used instead.Reason might be that Component#getLocale() invoked from Localizer#getStringIgnoreSettings(String  Component  IModel  Locale  String  String) always returns NumberTextField#HTML5_LOCALE (fix for WICKET-3591).Pls. see attached quickstart.I'm a Wicket newbie  so could very well be that I'm missing something.,0,0
Use a Set to keep the supported wicket elements in WicketTagIdentifier,WicketTagIdentifier stores a private static collection of wellKnownTagNames as an ArrayList.and a method called isWellKnown is called from within WicketTagIdentifier.onComponentTag and presumably it's called on every Wicket tag parsed. private boolean isWellKnown(final ComponentTag tag) { for (String name : wellKnownTagNames) { if (tag.getName().equalsIgnoreCase(name)) { return true; } } return false; }This method iterates over the list elements until an item is found so has O performance. If this array list was to be changed to a Set instead it would have O(1) performance. I haven't got any metrics on the usage and I don't think the improvement would be sensational but for web apps with large quantities of markup it could make some difference. For such a simple change it's probably worth it.,0,1
UrlRenderer.renderRelativeUrl misbehavior if the filterPath is composed.,Using an application with a composed filterPath like:&lt;filter-mapping&gt; &lt;filter-name&gt;wicket.jsessionid&lt;/filter-name&gt; &lt;url-pattern&gt;/demo/test/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt; Wicket fails to properly render a bookmarkable link.I've debuged my app and the problem is here:UrlRenderer.removeCommonPrefixes()Line 309:String filterPath = request.getFilterPath();if (filterPath != null &amp;&amp; segments.isEmpty() == false){ if (filterPath.equals(UrlUtils.normalizePath(segments.get(0)))) { LOG.debug('Removing the filter path '{}' from '{}''  filterPath  segments); segments.remove(0); }}This code assumes that the filter path is a single segment path  not a composed path.I've only reached this bug browsing my website with the cookies disable. This is why it's not critical.,0,0
AjaxPagingNaviagtionLink should provide updateAjaxAttributes like AjaxLink,It is cumbersome to override AjaxPagingNavigationLink#newAjaxPagingNavigationBehavior to provide a subclass of AjaxPagingNavigationBehavior with it's updateAjaxAttributes overriden to allow for changing the ajax attributes. It would be easier if the AjaxPagingNavigationLink worked like AjaxLink.,0,0
ConcatBundleResource should use the respective ITextResourceCompressor,Css and JavaScript bundles are not processed by Css/JavaScriptCompressors.org.apache.wicket.resource.bundles.ConcatBundleResource#readAllResources directly reads the resources' stream.,0,0
Use a behavior that modifies AbstractLink's markup when disabled,Currently Wicket transforms &lt;a&gt; tag to &lt;span&gt;&lt;em&gt; when a link is disabled.Recently Wicket-Bootstrap user filed issue https://github.com/l0rdn1kk0n/wicket-bootstrap/issues/79 that this breaks the UI because Twitter Bootstrap needs just 'disabled='disabled'' attribute in &lt;a&gt;.With the new strategy it will be possible to set global strategy and override it per link.,0,0
PagingNavigation: possible to call setStartIndex() earlier than onBeforeRender?,PagingNavigation has two actions in its onBeforeRender implementation:setDefaultModel(new Model&lt;Integer&gt;((int)Math.max(Integer.MAX_VALUE  pageable.getPageCount())));setStartIndex();Building my own PagingNavigation extending PagingNavigation  not being able to retrieve the start index before onBeforeRender  forces me to put a lot of logical code into my own onBeforeRender implementation.So there's a valid workaround  but I'd expect this to work from onConfigure also  maybe even from onInitialize.As far as I can see it should be possible to call the two methods earlier than onBeforeRender  however I might be missing the 'big picture' and oversee some side effects this could cause.,0,0
Form#visitFormComponents can cause ClassCastException,The current method signature of Form#visitComponents allows for passing in an implementation of IVisitor that will cause a ClassCastException. ExampleAdd a CheckBox and TextField to the Form. Pass in an IVisitor&lt;CheckBox&gt; to visitComponents. There will be a ClassCastException when the IVisitor&lt;CheckBox&gt; attempts to visit the TextField.The method signature should be changed topublic final &lt;R&gt; R visitFormComponents(final IVisitor&lt;FormComponent&lt;?&gt;  R&gt; visitor)or the method should be removed to prevent confusion.,0,0
Wrong charset or screwed up characters in Norwegian properties-file,In Wicket 6  up to and including 6.3.0  the Application_no.properties file has mangled all the Norwegian special characters (ﾃｦ ﾃｸ and ﾃ･). Seems to be the only one of the Norwegian properties-files with problems  as far as I could tell.Edit: Also  the file is in UTF-8-format  which doesn't work...,0,0
ModalWindow overwrites window.onbeforeunload,If window.onbeforeunload is changed after a ModalWindow is opened the change is lost when the ModalWindow is closed. I expected calling ModalWindow#showUnloadConfirmation(false) would fix this  but the javascript for the modal window unconditionally overwrites window.onbeforeunload. I suggest checking settings.unloadConfirmation before overwriting window.onbeforeunload.,0,0
org.apache.wicket.util.resource.Patht#find fails on Windows,Windows users report that test org.apache.wicket.util.resource.PathTest#loadFromRootUsingSubpathInFilename fails for them.The suggested solution is to rework Path#find to:@Override public IResourceStream find(final Class&lt;?&gt; clazz  final String pathname) { final File file = new File(folder  pathname); final File pathOnlyFile = new File(pathname); if (file.exists()) { return new FileResourceStream(file); } if (pathOnlyFile.exists()) { return new FileResourceStream(pathOnlyFile); } else { return null; } }but I'm not quite sure in this solution.,0,0
Rendered Url on root context with cookies disabled might result in double slash //,When a link is rendered on root context with cookies disabled (or on first access with container sending jsessionid)  a rendered link url might be prepended with './' thus resulting in a double slash  ('.//').,0,0
CryptoMapper ignores original queryString parameters,When an AjaxRequest with parameters (e.g.: Autocomplete.getChoices()) arrives and CryptoMapper decrypts it  original queryString parameters dissapears.Debugging CryptoMapper  I've checked that this method:private Url decryptUrl(final Request request  final Url encryptedUrl) { ...}receives querystrings parameters (on field url.parameter from 'request' parameter) and the new Url returned by the method never adds them to its own list.,0,0
Websocket broadcast support does not work with OSGi,WICKET-4832 provides websocket support but this does not work in an OSGi environment because the packages are not unique.This patch provides the changes to make it run under OSGi. Most of the changes are in the wicket-native-websocket modules  but WicketFilter from wicket-core has a new method to let AbstractUpgradeFilter only override the required parts (was TODO in original code).,0,0
Header can not be set from IRequestCycleListener#onEndRequest(),Due to HeaderBufferingWebResponse a header can no longer be set from IRequestCycleListener#onEndRequest().In 1.4.x this was possible because BufferedWebResponse just passed through all headers to HttpServletResponse.,0,0
Mounted page is not throwing ExpireException with setting setRecreateMountedPagesAfterExpiry(false),We have a page that is both bookmarkable (and accessible with certain page parameters) and has a second constructor taking an object. When ever the session time-out we want to show a session expired page. But we get a exception because Wicket is trying to rebuild the page with no page parameters. We have set the setting getPageSettings().setRecreateMountedPagesAfterExpiry(false); This works when clicking on (ajax)links  but it's not working when using the back/forward button in the browser (or javascript:history.go(-1)).I'll attache a quickstart.,0,0
Palette does not handle disabled choices correctly,It is possible to add choices to a Palette with the disabled HTML attribute. This attribute is respected by all modern browsers and prevents the selection of disabled choices.However Palette also has a double-click handler  which will ignore the disabled attribute and add the choice to the selection.The Javascript palette.js can be modified to prevent disabled choices from being added to the selection:Wicket.Palette.moveHelper=function(source  dest) { var dirty=false; for (var i=0;i&lt;source.options.length;i++) { if (source.options&#91;i&#93;.selected &amp;&amp; !source.options&#91;i&#93;.disabled) { dest.appendChild(source.options[i]); i--; dirty=true; } } return dirty; };Maybe it makes sense to integrate this into Palette?,0,0
DownloadLink uses wrong encoding for spaces/non-ASCII characters,When downloading a file with spaces and non-ASCII characters in the filename using DownloadLink  all browsers I tested show a wrong filename in the file download dialog. For a file named Test 'ﾃ､'.txt  I got the following output from different browsers:IE: Test+'ﾃ､'.txtFF: Test+%27%C3%A4%27.txtChrome: Test+%27ﾃ､%27.txtI have attached a patch that fixes the issue for me. The problem is thata) the used URL encoding is wrong. PATH encoding  not QUERY encoding is requiredb) only IE needs the filename to be encoded  other browsers seem to work with the original nameSee e.g. http://stackoverflow.com/questions/93551/how-to-encode-the-filename-parameter-of-content-disposition-header-in-http for a discussion of the underlying issue.Note: I do not believe the attached patch is the optimal fix for this issue. I would prefer removing the encoding handling from DownloadLink and putting it into AbstractResource.setResponseHeaders()  so other components using attachments benefit  too.,0,0
Rendered URL is resulting with double slash when using AuthenticatedWebApplication,When the application requires authentication and a page requiring authentication is the first page to be accessed the url for the Login page is including a double slash causing a 404. This only happens when the page locked down is mounted with mountPackage.,0,0
Wicket-atmosphere filters should be functions on AtmosphereResource,With a function on AtmosphereResource  rather than a predicate  it is possible to filter on attributes in the AtmosphereRequest. This would allow you to create filters that differentiate on the receiver  without relying on the heavy-weight contextAwareFilter().,0,1
Allow passing parameters to atmosphere JS,Currently  it is not possible to pass parameters to the atmosphere JS  for example to disable websocket. In some situations you might want to change some of the default settings used by wicket-atmosphere to get everything working in your setup. For example  if your hosting provider does not support websocket  you should set the transport to streaming.,0,0
compareTo methods of Actions in BufferedWebResponse violate Comparable contract,I've never seen this result in an exception so far  but the implementations of the methods is wrong and will fail on java 7 if multiple action instances of the same class are sorted using Collections.sort. The sorting should return 0 if instances are of the same type.,0,0
AjaxFormChoiceComponentUpdatingBehavior cannot be triggered with BaseWicketTester#executeAjaxEvent(),BaseWicketTester executes AjaxFormComponentUpdatingBehavior only.,0,0
Rename Component#renderHead(HtmlHeaderContainer),It seems it happens somewhat often that users mistakenly override renderHead(HtmlHeaderContainer) rather than renderHead(IHeaderResponse). Code completion makes this a very easy mistake.I propose renaming the somewhat-internal method renderHead(HtmlHeaderContainer) to renderIntoPageHeaderContainer or something like that. We can't just make the method package private  since it is needed by Panel  Border and FormComponentPanel to render the header sections of their associated markup.,0,0
Move the logic for creating the proper PackageResource from PackageResourceReference to ResourceReferenceRegistry,org.apache.wicket.request.resource.PackageResourceReference#getResource() has a logic that decides what type of PackageResource to return depending on the file extension. It supports only .css and .js at the moment.ResourceReferenceRegistry (RRR) uses this logic for unknown ResRefs. It will be better if this mapping is moved to RRR and be possible to add custom mappings.,0,0
client side memory leak on  date picker,Under certain conditions date picker component leaks memory at client side. More concretely DatePicker#renderHead tries to clean up existing date pickers viaAjaxRequestTarget target = component.getRequestCycle().find(AjaxRequestTarget.class); if (target != null) { String escapedComponentMarkupId = getEscapedComponentMarkupId(); String javascript = 'var e = Wicket.$('' + escapedComponentMarkupId + 'Dp' + ''); if (e != null &amp;&amp; typeof(e.parentNode) != 'undefined' &amp;&amp; ' + 'typeof(e.parentNode.parentNode != 'undefined')) {' + 'e.parentNode.parentNode.removeChild(e.parentNode);' + 'YAHOO.wicket.' + escapedComponentMarkupId + 'DpJs.destroy(); delete YAHOO.wicket.' + escapedComponentMarkupId + 'DpJs;}'; target.prependJavaScript(javascript); }but this fails if 'panel' containing date pickers is completely replaced via AJAX. E.g. for date pickers placed on an AJAX navigated repeater. The result is that client side objectYAHOO.wicketobject grows and grows... and for1- Wicket 1.5.x and wicket 1.4.x this means time for creating new date pickers grows steadily.2- For wicket 1.6.x there seems not to have any performance hindrance (only the memory leak).I attach quick starts demonstrating this.,0,1
extra recursion on Wicket.DOM.get,Any reason for DOM.get not being likeget: function (arg) { if (isUndef(arg)) { return null; } if (arguments.length &gt; 1) { var e = []; for (var i = 0; i &lt; arguments.length; i++) { e.push(get(arguments[i])); } return e; } else if (typeof arg === 'string') { return document.getElementById(arg); } else { return arg; }instead of get: function (arg) { if (isUndef(arg)) { return null; } if (arguments.length &gt; 1) { var e = []; for (var i = 0; i &lt; arguments.length; i++) { e.push(Wicket.$(arguments[i])); } return e; } else if (typeof arg === 'string') { return document.getElementById(arg); } else { return arg; }?,0,1
wicket-ajax-jquery.js fails with 'member not found' on IE for delayed ajax requests,Channel#done() uses setTimeout() to execute delayed Ajax calls.On IE when the delayed call is executed  jquery's #preventDefault() fails with 'member not found' because the original event object's properties (here e.returnValue) can no longer be accessed.,0,0
AbstractNumberConverter issue when used with NumberFormat#getCurrencyInstance,Summary of the discussion on users@:There is an issue when using AbstractNumberConverter when #getNumberFormat returns NumberFormat#getCurrencyInstance()I think the problem is due to AbstractNumberConverter#parse(Object  double  double  Locale):if (value instanceof String){ // Convert spaces to no-break space (U+00A0) to fix problems with // browser conversions. // Space is not valid thousands-separator  but no-br space is. value = ((String)value).replace(' '  '/u00A0');}Which replace spaces  so a string like '1 5 竄ｬ' is invalid while being parsed.public class CurrencyConverter extends AbstractNumberConverter&lt;Double&gt;{ private static final long serialVersionUID = 1L; public CurrencyConverter() { } @Override protected Class&lt;Double&gt; getTargetType() { return Double.class; } @Override public NumberFormat getNumberFormat(Locale locale) { return NumberFormat.getCurrencyInstance(locale); } @Override public Double convertToObject(String value  Locale locale) { locale = Locale.FRANCE; return this.parse(value  Double.MIN_VALUE  Double.MAX_VALUE  locale);// This does work:// final NumberFormat format = this.getNumberFormat(locale);// return this.parse(format  value  locale); }}As Sven indicates  there is (yet another) issue in Java currency formating (space as thousand separator)http://matthiaswessendorf.wordpress.com/2007/12/03/javas-numberformat-bug/http://bugs.sun.com/view_bug.do?bug_id=4510618So will I let you decide whether or not you wish to fix it (the space before the currency symbol).Thanks &amp; best regards Sebastien.,0,0
WicketTester should send copies of its cookies,There are some bugs related to cookie handling in BaseWicketTester.Problem 1) a cookie set in the request should not be in the response unless manually set by the server codeProblem 2) wicket tester sends the original cookie instance to the server. If the server code manipulates the cookie anyhow (e.g. change its value) but do not send it back explicitly in the response then the original cookie in WicketTester (the request cookie) is updated while it shouldn't be.A possible solutions for these problems can be found at:https://github.com/apache/wicket/pull/28,0,0
Wicket Enclosure fails with more than one component,An enclosure like:&lt;wicket:enclosure child='message'&gt; &lt;span wicket:id='message' /&gt; &lt;a href='#' wicket:id='link'&gt;&lt;/a&gt;&lt;/wicket:enclosure&gt;fails with:org.apache.wicket.WicketRuntimeException: The component(s) below failed to render. Possible reasons could be that: 1) you have added a component in code but forgot to reference it in the markup (thus the component will never be rendered)  2) if your components were added in a parent container then make sure the markup for the child container includes them in &lt;wicket:extend&gt;.1. [ExternalLink &#91;Component id = link&#93;]It will report failed rendering for all components within the enclosure except the child.This works if I turn the enclosure into an inline enclosure:&lt;div wicket:enclosure='message'&gt; &lt;span wicket:id='message' /&gt; &lt;a href='#' wicket:id='link'&gt;&lt;/a&gt;&lt;/div&gt;I got this error when upgrading from Wicket 6.2.0 to 6.3.0.I also noticed that the AjaxEnclosureListener only visits the InlineEnclosures.,0,0
BaseWicketTester#clickLink() doesn not serialize form to request for SubmitLink but does for AjaxSubmitLink,BaseWicketTester#clickLink() handles AjaxSubmitLink and SubmitLink onconsistently for the former all form inputs are serialized to the request before triggering.,0,0
InlineEnclosureHandler always uses 'wicket' namespace,The name of the wicket namespace is hardcoded in InlineEnclosureHandler:public final static String INLINE_ENCLOSURE_ATTRIBUTE_NAME = 'wicket:enclosure';This constant is also used by InlineEnclosure and was probably never meant to be part of the public API.These classes should respect the user defined namespace provided by the MarkupResourceStream.,0,0
Set the component as a context to the ajax listeners,Currently to get the component in an Ajax listener (before  success  complete  ...) one has to use: attrs.event.target.In Wicket 1.5 one could use 'this' in ajax call decorators because the script was a value of the inline attribute.Currently 'this' in event listeners is unusable. It would be good to set the component as a context.,0,0
Add equals() and hashcode() implementation to INamedParameters.NamedPair,It would be handy to have an equals() and hascode() implementation based on key and value  so that it is possible to do things likepageParameters.getAllNamed().contains(myNamedPair)In case you are interested:My current use case is that the page should check whether it is actually called with the pageparameters needed (i.e. using the unique  canonical URL)  however ignoring some special params.,0,0
Session.exists() returns false when ThreadContext#session is not set to current session,There are several places in Wicket which check for the existence of a Session before actually getting a reference to it  e.g. FeedbackCollector: public final List&lt;FeedbackMessage&gt; collect(final IFeedbackMessageFilter filter) { ... if (includeSession &amp;&amp; Session.exists()) { messages.addAll(Session.get().getFeedbackMessages().messages(filter)); } }If no one has called Session#get()  all calls to Session#exists() return false although a session might exist in the session store  i.e. it might just not be set to ThreadContext#session already.,0,0
AutoComplete should not request suggestions if input is no longer active element,If an ajax change event handler disables and re-renders an AutoCompleteTextField  a pending ajax request for suggestions will trigger a ListenerInvocationNotAllowedExecption. This leads to a log warning 'behavior not enabled; ignore call' but the redirect to the AccessDeniedPage is ignored by wicket-autocomplete.js.,0,0
Possible bug in org.apache.wicket.util.lang.Packages when building path with repeating names,When trying to build the absolute path from package 'com.foo.bar' with relative path 'baz/foo/qux' in method org.apache.wicket.util.lang.Packages.absolutePath(String  String) the block: else if (absolutePath.size() &lt;= i || absolutePath.get(i).equals(folder) == false) { // Add to stack absolutePath.add(folder); }doesn't run for the 'foo' part of the relative path because absolutePath.get(1) == foo from the package == foo from the relative path.So the resulting absolute path is 'com/foo/bar/baz/qux' rather than the expected 'com/foo/bar/baz/foo/qux'.Seems like the 'else if' should just be a 'else'.,0,0
AutoComplete still triggers redundant events to registered change listener,,0,0
Improve UrlRenderer to be able to render urls without scheme and/or host,UrlRenderer can be improved to support rendering urls like: //hostname:1234/a/b //hostname/a/b /a/b,0,0
Allow PackageResource to decide itself whether it could be accepted or not,By default PackageResource uses IPackageResourceGuard to check whether it can be rendered or not.By making org.apache.wicket.request.resource.PackageResource#accept(Class  String) protected the resource itself can do the check  e.g. allow the access when usually the guard would reject.,0,0
UrlRenderer#removeCommonPrefixes() fails when contextPath+filterPrefix has more segments than the argument,I get this exception when trying to create a URL with RequestCycle#urlFor:org.apache.wicket.WicketRuntimeException: An error occurred while generating an Url for handler 'ResourceReferenceRequestHandler{resourceReference=scope: org.apache.wicket.Application; name: ImageResource; locale: null; style: null; variation: null  pageParameters=publicId=[f74df62d-cbdb-49db-96e4-36e3ea62610e]  type=[sr]}' at org.apache.wicket.request.cycle.RequestCycle.urlFor(RequestCycle.java:516) &#91;wicket-core-6.6.0.jar:6.6.0&#93; at org.apache.wicket.request.cycle.RequestCycle.urlFor(RequestCycle.java:473) &#91;wicket-core-6.6.0.jar:6.6.0&#93; at xxx.XXXWebApplication.urlFor(XXXWebApplication.java:161) ~&#91;xxx-web-0.1.0-SNAPSHOT.jar:0.1.0-SNAPSHOT&#93;&#91;...&#93;Caused by: java.lang.IndexOutOfBoundsException: Index: 0  Size: 0 at java.util.ArrayList.rangeCheck(ArrayList.java:604) ~&#91;na:1.7.0_10&#93; at java.util.ArrayList.remove(ArrayList.java:445) ~&#91;na:1.7.0_10&#93; at org.apache.wicket.request.UrlRenderer.removeCommonPrefixes(UrlRenderer.java:319) ~&#91;wicket-request-6.6.0.jar:6.6.0&#93; at org.apache.wicket.request.UrlRenderer.renderRelativeUrl(UrlRenderer.java:220) ~&#91;wicket-request-6.6.0.jar:6.6.0&#93; at org.apache.wicket.request.UrlRenderer.renderUrl(UrlRenderer.java:117) ~&#91;wicket-request-6.6.0.jar:6.6.0&#93; at org.apache.wicket.request.cycle.RequestCycle.renderUrl(RequestCycle.java:529) &#91;wicket-core-6.6.0.jar:6.6.0&#93; at org.apache.wicket.request.cycle.RequestCycle.urlFor(RequestCycle.java:511) &#91;wicket-core-6.6.0.jar:6.6.0&#93; ... 46 common frames omittedThe app uses a context path and no filter path. I see that UrlRenderer#removeCommonPrefixes receives an empty list and the code in the method assumes that context path + filter path is always a common prefix and tries to remove it later from the empty list.,0,0
form#onSubmit() is called on just replaced nested forms,I use wizard api from wicket extensions.Next button is implemented like org.apache.wicket.extensions.wizard.NextButton.It means: if step is complete wizardModel.next() is called and step content is replaced.I send you example - see attachment.In the example Step2Panel contains inner form 'innerForm'.The problem is when we leave step 1 (click to next button) - innerForm.onSubmit from step 2 is called. Obversely when we leave step 2 innerForm.onSubmit is not called!One solution is to call form.process(null) manually in Nextbutton.onClick before step content is replaced. It is wrong again becaouse innerForm.onSubmit is called twice.,0,
Allow WebApplication-specific Spring configuration,SpringWebApplicationFactory allows two places to defined a WebApplication: in the global root application context loaded by Spring's ContextLoaderListener in a filter-specific additional web applcation context.SpringComponentInjector is not aware of this additional context but just uses the global one. This imposes the following restrictions: the filter-specific context cannot define any beans to be used by SpringComponentInjector SpringComponentInjector cannot work without a global root application  i.e.ContextLoaderListener is required.Starting with Wicket 6.7.0 the filter-specific context is made accessible to SpringComponentInjector. If no application context is given explicitly to SpringComponentInjector's constructor  by default the injector uses the application context used to create the WebApplication.Benefits: no need to define ContextLoaderListener in web.xml (i.e. less xml) use application-specific beans defined in the filter-specific application context,0,0
InlineEnclosure are piling up on each render,InlineEnclosureHandler#resolve() uses an auto-incremented id for its resolved InlineEnclosure  On the next render  a new instance will be resolved  since the id of the already resolved InlineEnclosure does not match the id in the markup.But InlineEnclosures are not removed after render as other auto-components  thus all instances pile up in the owning container of the markup.,0,0
FormTester throws an exception when a Palette component is added to a Form associated with a compound property model,FormTester throws an exception when a Palette component is added to a Form associated with a compound property model:org.apache.wicket.WicketRuntimeException: No get method defined for class ... expression: choicesIt worked fine in Wicket 6.5.0  and works fine if the form is not associated with a compound property model.,0,0
The Bootstrap class does not provide a handle for the CSSResourceReferences.,The Bootstrap class provides JavaScriptResourceReference via the plain() and responsive() methods.It should also provide access to bootstrapCss and bootstrapResponsiveCss to enable the applications to use CSS bundles.,0,0
Extract the short names of the ajax attributes as a constants,Currently the short names of the AjaxRequestAttributes are hardcoded to AbstractDefaultAjaxBehavior#renderAttributes().,0,0
AjaxSelfUpdatingTimerBehavior in hidden component in ModalWindow causes Ajax Response Error,I have a ModalWindow which shows a panel with a hidden label with an AjaxSelfUpdatingTimerBehavior. When the modal window is shown  the following error occurs in the Wicket Ajax Debug console:ERROR: Wicket.Ajax.Call.processEvaluation: Exception evaluating javascript: TypeError: Cannot read property 'label5' of undefined  text: (function(){clearTimeout(Wicket.TimerHandles['label5']); delete Wicket.TimerHandles['label5'];})();,0,0
Set a different TimeZone for the RequestLogger,I'm using wicket 1.5.9. In my log4j.xml I have:&lt;logger name='org.apache.wicket.protocol.http.RequestLogger'&gt; &lt;level value='info'/&gt;&lt;/logger&gt;but when I'm testing my log file output is showing the request logger information using GMT timezone and I need to be GMT+1. Following Martin Grigorov is it possible to remove the final from org.apache.wicket.protocol.http.AbstractRequestLogger#formatDate method?,0,0
Wicket ignores allowDefault:false attribute in multipart ajax requests,,0,0
Component.continueToOriginalDestination() can redirect to ./.,Following scenario:Home page redirects to login page via RestartResponseException if no user is logged in.The user logs in  and is led back to the originally called page via continueToOriginalDestination().If the original page was the home page  Wicket's UrlRenderer produces a target url of ./. here (which IE browsers can't handle).,0,0
Improve ResourceReference#getDependencies() API,currently the signature ispublic Iterable&lt;? extends HeaderItem&gt; getDependencies()which is awkward to use.suppose i want a javascript reference that should include a css reference as a dependency  i cannot simply add it to iterable like this:new ResourceReference(Some.class  'some.js') { Iterable getDependencies() { Iterable supers=super.getDependencies(); // supers.add(CSS); &lt;=== cannot do this  instead List list=new ArrayList(); for (reference:supers) { list.add(reference); } // now i can finally add mine list.add(CSS); return list; }}instead change Iterable to a List that is backed by a mutable one. this should make extending much easier. if List is too 'open' create Appendable { append(); } backed by a list and use that.,0,0
SecurePackageResourceGuard is blocking access to web fonts,,0,0
Evaluation of returned data (which includes alot of javascript) very slow after ajax call in IE10.,We're using ajax to update a treetable. In IE10  when the ajax call returns the data  which contains alot of javascript code  processEvaluation in wicket-ajax-jquery.js stalls on var text = jQuery(node).text();In jQuery procedure Sizzle.getText is called  which eventually returns property elem.textContent. In IE10 this last statement takes about 26 seconds for our case while the same statement in chrome takes about 6 ms.It seems strange that IE10 takes this long to return the textContent of a node  but why is this necessary in the first place?The purpose of var text = jQuery(node).text() would be to get the text of the node. I think it would suffice to state var text = node.childNodes&#91;0&#93;.nodeValue instead of var text = Query(node).text()  because the text is in the node itself  and it's not necessary to get the text from its descendants  because it has no descendants.In our case this modification improves the duration from 25915 ms to 8 ms in IE10.,0,1
wicket-atmosphere EventBus constructor throws NullPointerException under invalid state,With invalid configuration  like the WebApplication not yet associated with the servlet  wicket-atmosphere throws NPE.Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'atmosphereEventBus' defined in class id.co.bippo.springapp.AppConfig: Instantiation of bean failed; nested exception is org.springframework.beans.factory.BeanDefinitionStoreException: Factory method [public org.apache.wicket.atmosphere.EventBus id.co.bippo.springapp.AppConfig.atmosphereEventBus()] threw exception; nested exception is java.lang.NullPointerException at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:581) ~[spring-beans-3.2.2.RELEASE.jar:3.2.2.RELEASE] at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1031) ~[spring-beans-3.2.2.RELEASE.jar:3.2.2.RELEASE] at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:927) ~[spring-beans-3.2.2.RELEASE.jar:3.2.2.RELEASE] at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:490) ~[spring-beans-3.2.2.RELEASE.jar:3.2.2.RELEASE] at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:461) ~[spring-beans-3.2.2.RELEASE.jar:3.2.2.RELEASE] at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:314) ~[spring-beans-3.2.2.RELEASE.jar:3.2.2.RELEASE] at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:194) ~[spring-beans-3.2.2.RELEASE.jar:3.2.2.RELEASE] at org.springframework.beans.factory.support.DefaultListableBeanFactory.findAutowireCandidates(DefaultListableBeanFactory.java:910) ~[spring-beans-3.2.2.RELEASE.jar:3.2.2.RELEASE] at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:853) ~[spring-beans-3.2.2.RELEASE.jar:3.2.2.RELEASE] at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:768) ~[spring-beans-3.2.2.RELEASE.jar:3.2.2.RELEASE] at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:486) ~[spring-beans-3.2.2.RELEASE.jar:3.2.2.RELEASE] ... 107 common frames omittedCaused by: org.springframework.beans.factory.BeanDefinitionStoreException: Factory method [public org.apache.wicket.atmosphere.EventBus id.co.bippo.springapp.AppConfig.atmosphereEventBus()] threw exception; nested exception is java.lang.NullPointerException at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:181) ~[spring-beans-3.2.2.RELEASE.jar:3.2.2.RELEASE] at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:570) ~[spring-beans-3.2.2.RELEASE.jar:3.2.2.RELEASE] ... 117 common frames omittedCaused by: java.lang.NullPointerException: null at org.apache.wicket.atmosphere.EventBus.&lt;init&gt;(EventBus.java:113) ~[wicket-atmosphere-0.8.jar:0.8] at id.co.bippo.springapp.SoluvasWebApplication.getEventBus(SoluvasWebApplication.java:296) ~[SoluvasWebApplication.class:na] at id.co.bippo.springapp.AppConfig.atmosphereEventBus(AppConfig.java:270) ~[AppConfig.class:na] at id.co.bippo.springapp.AppConfig$$EnhancerByCGLIB$$a9c1dc07.CGLIB$atmosphereEventBus$1(&lt;generated&gt;) ~[spring-core-3.2.2.RELEASE.jar:na] at id.co.bippo.springapp.AppConfig$$EnhancerByCGLIB$$a9c1dc07$$FastClassByCGLIB$$40a0fc3e.invoke(&lt;generated&gt;) ~[spring-core-3.2.2.RELEASE.jar:na] at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:228) ~[spring-core-3.2.2.RELEASE.jar:3.2.2.RELEASE] at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:286) ~[spring-context-3.2.2.RELEASE.jar:3.2.2.RELEASE] at id.co.bippo.springapp.AppConfig$$EnhancerByCGLIB$$a9c1dc07.atmosphereEventBus(&lt;generated&gt;) ~[spring-core-3.2.2.RELEASE.jar:na] at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.7.0_15] at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) ~[na:1.7.0_15] at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.7.0_15] at java.lang.reflect.Method.invoke(Method.java:601) ~[na:1.7.0_15] at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:160) ~[spring-beans-3.2.2.RELEASE.jar:3.2.2.RELEASE] ... 118 common frames omittedIt should wrap the NPE in a more descriptive error. Suggestion: 'Provided Wicket WebApplication is not associated with a ServletContext. Please ensure Wicket application is fully initialized before creating Atmosphere EventBus.',0,0
InterceptData never gets cleared from session after continueToOriginalDestination is called and another page is requested afterwards,We have the same problem as earlier described by Chris in WICKET-4500:'The above fix is great but we've run into another problem. If an admin user attempts to go to a restricted page and gets redirected via a RedirectToInterceptException but then decides not to log on but then goes to the normal home page authentication and then successfully logs on as a standard user that authentication will redirect to where the admin initially wanted to go to - because they never authenticated as admin continueToOriginalDestination was never called and so Wicket still thinks that when continueToOriginalDestination is called after the standard user's authentication that it needs to redirect to the original admin page... fun!Would it be possible to introduce an explicit 'clearRedirect' method so that when the home page does a RestartResponseException to redirect to the standard user authentication page it can  at the same time  do a 'clearRedirect' so that a subsequent call to continueToOriginalDestination does not attempt to go to the admin page.I can't remove the continueToOriginalDestination from the standard user authentication page because it is still required to perform a continue when it was reached by a RedirectToIntercepException from restricted pages other than the home page. ',0,0
Exception while rendering absolute URL with UrlResourceReference,While rendering absolute url UrlRenderer calls renderFullUrl on line 112 which causes error.,0,0
Create an interface for the roles replacing the current Roles class,Currently the roles in wicket are managed by a final class  Roles  that extends HashSet.In my current projects I have to manage permissions considering several factors that include the role  the creator and the type of data  and this must be done also when displaying tables with several rows. Having the possibility to create my own Roles class I can integrate my restrictions with wicket authorization and add some performance improvements (required in this case because the validation must be done at the field level).,0,0
PageRequestHandlerTracker doesn't track resolves of handlers caused by Exception,PageRequestHandlerTracker should implement #onExceptionRequestHandlerResolved(),0,0
Log additional info when FormComponent fails in updateCollectionModel,When a form component using Collections (e.g. CheckGroup) fails to set the collection in the Model's contained object due to an exception  it produces some log output that looks thus:INFO - FormComponent - no setter for the property attached to [CheckGroup &#91;Component id = group&#93;] This may be misleading  as any exception will produce this output  including for example a NullPointerException that occurs inside the setter itself. In other words  setter for the property may well exist but an exception sometime during the setter invocation still results in the 'no setter' log feedback. Suggested improvement is to include some details about the caught exception in this log message that may more directly point to the cause of the failure.,0,0
URL query parameter values containing equals sign get cut off,When calling a page with a query parameter like 'param1=val1=val2' the value of 'param1' obtained from PageParameters will be 'val1'. Everything after the equals sign inside the parameter value gets cut off.,0,0
The url gets longer when using StatelessForm with GET method,The request parameter used for IRequestListener resolution is added to the page parameters for each form submit.,0,0
PageStoreManager.SessionEntry keeps outdated sessionId when container changes sessionId,PageStoreManager keeps the initial sessionId for each SessionEntry.If the container changes the sessionId later (e.g. Tomcat's 'Session Fixation Protection')  all pages continue to be stored under the the initial sessionId. This is necessary to be able to access old pages even after a change to the sessionId.However PageStoreManager#sessionExpired(String) passes the current sessionId to the PageStore. If it is not longer equal the original sessionId  the PageStore will fail to remove the stored pages for the session.,1,0
Make ThrottlingSettings mutable,ThrottlingSettings can be modifiable so if an Ajax behavior sets some default throttling setting then a component using this behavior can just change the delay or postpone flag without the need to set a completely new one.,0,0
Move Form hidden field rendering to dedicated method,Form renders its hidden fields in onComponentTagBody()  which is never called when the markup sourcing strategy is PanelMarkupSourcingStrategy. Please can we move this to a dedicated method which can be called from MarkupSourcingStrategy#onComponentTagBody() when the component is instanceof Form.,0,0
Incorrect signature of types which extend Comparable,AbstractRangeValidator has the following Signature:public abstract class AbstractRangeValidator&lt;R extends Comparable&lt;R&gt; &amp; Serializable  V extends Serializable&gt; extends Behavior implements IValidator&lt;V&gt;Because of this it cannot be used with DateMidnight as its Comparable implementation is in a base class.I think the correct signature should be:public abstract class AbstractRangeValidator&lt;R extends Comparable&lt;? super R&gt; &amp; Serializable  V extends Serializable&gt; extends Behavior implements IValidator&lt;V&gt;,0,0
Change AjaxRequestAttributes#eventPropagation to BUBBLE,AjaxRequestAttributes#eventPropagation should initially be set to BUBBLE to be consistent with jquery.,0,0
Page redirects can fail when using url encoding,When url encoding is used instead of cookies for session management  some redirections do not work in Wicket 6.8.0. The problem appears to be in UrlRenderer.renderRelativeUrl  which returns the (invalid) relative URL:'..//demo/app;jsessionid=0BFE4703434CFF7BEBAE5CBF6C60B15F' when passed the URL:'http://localhost:8080/demo/app;jsessionid=0BFE4703434CFF7BEBAE5CBF6C60B15F'and when the UrlRenderer's base URL is: 'wicket/page?1-1.ILinkListener-link'This is because the removeCommonPrefixes method tries to compare segments between the encoded target URL and a URL parsed from (URLRenderer line 319):Url commonPrefix = Url.parse(request.getContextPath() + request.getFilterPath());This second URL does not contain the ;jsessionid=... suffix and the removeCommonPrefixes method doesn't remove prefixes properly. The problem doesn't occur when using cookies for session management  of course.This issue is new between Wicket version 6.2.0 and 6.8.0. When deployed into a servlet container using url-encoding for session management  the following app works under Wicket 6.2.0 but fails (because of redirecting to an invalid URL) under Wicket 6.8.0:// ------------------------// App.javaimport org.apache.wicket.protocol.http.WebApplication;import org.apache.wicket.Page;public class App extends WebApplication { @Override public Class&lt;? extends Page&gt; getHomePage() { return A.class; }}// ------------------------// A.javaimport org.apache.wicket.markup.html.WebPage;import org.apache.wicket.markup.html.link.Link;public class A extends WebPage { public A() { add(new Link&lt;Object&gt;('link') { @Override public void onClick() { setResponsePage(B.class); } }); }}// ------------------------// B.javaimport org.apache.wicket.markup.html.WebPage;import org.apache.wicket.markup.html.link.Link;public class B extends WebPage { public B() { add(new Link&lt;Object&gt;('link') { @Override public void onClick() { setResponsePage(A.class); } }); }}// ------------------------Clicking the link on the home page A will successfully navigate to page B. Clicking the link on page B should navigate to page A. Under Wicket 6.2.0  or Wicket 6.8.0 with cookies  it works. With Wicket 6.8.0 and url-encoding  it tries to redirect to an incorrect URL like http://localhost:8080/demo/app//demo/app;jsessionid=0BFE4703434CFF7BEBAE5CBF6C60B15Fwhich fails (note the double slash and repeated context/filter in the URL). It is possible to configure Tomcat to use url encoding instead of cookies for session management by editing the conf/context.xml file within the Tomcat installation and making the root element of that file read: &lt;Context cookies='false'&gt;,0,0
Base url is incorrect for error dispatched pages,The fix for https://issues.apache.org/jira/browse/WICKET-4387 includes the following code in org.apache.wicket.protocol.http.servlet.ServletWebRequest#ServletWebRequest(HttpServletRequest httpServletRequest  String filterPrefix  Url url):if (forwardAttributes != null || errorAttributes != null) { if (LOG.isDebugEnabled()) { LOG.debug('Setting filterPrefix('{}') to '' because there is either an error or a forward. {}  {}'  new Object[] {filterPrefix  forwardAttributes  errorAttributes}); } // the filter prefix is not needed when the current request is internal // see WICKET-4387 this.filterPrefix = '';The filterPrefix is actually needed later when a request is made due to an error (e.g. 404):public Url getClientUrl() { if (errorAttributes != null &amp;&amp; !Strings.isEmpty(errorAttributes.getRequestUri())) { String problematicURI = Url.parse(errorAttributes.getRequestUri()  getCharset()) .toString(); return getContextRelativeUrl(problematicURI  filterPrefix);With filterPrefix=='' the urls for any resources in the error page are wrong.,0,0
Provide default messages for upload exceptions,Error message keys for upload exceptions are prefixed with the form's markup id currently. If we let the Localizer do this  Wicket can provide default messages for different locales.,0,0
Use documented jQuery APIs for triggering the special event 'inputchange',jQuery 1.9/2.0 changed its internals and now the special event 'inputchange' doesn't work.wicket-examples' autocomplete demo shows the problem.,0,0
AjaxEditableLabel not working well in form,Using quickstart I created new maven project (using 6.8.0 wicket + extensions).Code of my page ispackage net.betlista;import org.apache.wicket.extensions.ajax.markup.html.AjaxEditableLabel;import org.apache.wicket.markup.html.WebPage;import org.apache.wicket.markup.html.form.Form;import org.apache.wicket.model.CompoundPropertyModel;public class AjaxEditableLabelInFormTestPage extends WebPage { Form&lt;AjaxEditableLabelInFormTestPageModel&gt; form = new Form('form'); AjaxEditableLabel&lt;String&gt; text = new AjaxEditableLabel&lt;String&gt;('text'); public AjaxEditableLabelInFormTestPage() { form.setModel(new CompoundPropertyModel&lt;AjaxEditableLabelInFormTestPage.AjaxEditableLabelInFormTestPageModel&gt;(new AjaxEditableLabelInFormTestPageModel())); form.add(text); add(form); } class AjaxEditableLabelInFormTestPageModel { String text; }}code for markup HTML is&lt;!DOCTYPE html PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN' 'http://www.w3.org/TR/html4/loose.dtd'&gt;&lt;html&gt; &lt;head&gt; &lt;meta http-equiv='Content-Type' content='text/html; charset=ISO-8859-1'&gt; &lt;title&gt;Insert title here&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;form wicket:id='form'&gt; &lt;span wicket:id='text'&gt;text&lt;/span&gt; &lt;/form&gt; &lt;/body&gt;&lt;/html&gt;and when I edit the label and press tab  it changed to regular page text (span)  but when I press enter (while editing) the component is still input instead of span and the content is not submitted also. It's not possible to change the component to span again...,0,1
Direct iframe removal not supported by Firefox: tab title stays as 'Connecting',Hi When using the post via iframe feature of Wicket (for multipart Ajax request) with Firefox  the tab title is changed to 'Connecting...' and it doesn't get back to the original page title at all  even after the Ajax call returned.The iframe is removed in the onload of the iframe ( seehttps://github.com/apache/wicket/blob/master/wicket-core/src/main/java/org/apache/wicket/ajax/res/js/wicket-ajax-jquery.js#L868) and it seems to be problematic for Firefox.Looks like there is some literature about it here:http://stackoverflow.com/questions/7285866/never-ending-connecting-message-after-ajax-form-submitand using a pattern like the following should fix it:iframe.onload = function(){ // Do work with the content of the iframe窶ｦ setTimeout(function(){ iframe.parentNode.removeChild(iframe); }  0);}Quickstart coming with a way to reproduce the problem: Launch the application using Start.java; Go to http://localhost:8080/ with Firefox; Upload a file via the Ajax submit button; The tab title stays as 'Connecting...'.Now uncomment the resource replacement line in the WicketApplication file  restart the app and it should work correctly.Patch using a setTimeout call coming too.,0,0
AjaxEditableLabel doesn't provide a way to configure Ajax attributes for its Ajax behaviors,AjaxEditableLabel uses EditorAjaxBehavior and LabelAjaxBehavior to change its modes.At the moment there is no way to configure custom Ajax attributes for both behaviors.,0,0
ModalWindow is not visible in Safari when opened from a link at the bottom of a large page,I am not able to see a ModalWindow in Safari and I expect to see it centered on my view port.Steps:1. Start with a large web page with a link to open the ModalWindow at the bottom of the page. You need a large page where you have to scroll down to find the link.2. Click the link3. Observe that the mask for the ModalWindow displays  but the ModalWindow does not. Scrolling back up  re-sizing  and maximizing will still not display the ModalWindow.,0,0
CDI integration fails in Glassfish 4.0 with WELD-000070,When CDI is configured in the Application and a page has a non-static inner class the page throws exception  regardless of whether there are any injected fields.Caused by: org.jboss.weld.exceptions.DefinitionException: WELD-000070 Simple bean &#91;EnhancedAnnotatedTypeImpl&#93; private class com.inversebit.HomePage$AForm cannot be a non-static inner class at org.jboss.weld.injection.producer.BasicInjectionTarget.checkType(BasicInjectionTarget.java:81) at org.jboss.weld.injection.producer.BasicInjectionTarget.&lt;init&gt;(BasicInjectionTarget.java:69) at org.jboss.weld.injection.producer.BeanInjectionTarget.&lt;init&gt;(BeanInjectionTarget.java:52) at org.jboss.weld.manager.InjectionTargetFactoryImpl.createInjectionTarget(InjectionTargetFactoryImpl.java:95) at org.jboss.weld.manager.InjectionTargetFactoryImpl.createInjectionTarget(InjectionTargetFactoryImpl.java:78) ... 65 more,0,0
use jquery 'focusin'/'focusout' for ajax focus tracking,Focus tracking in wicket-ajax-jquery.js can be simplified with jQuery bubbling 'focusin'/'focusout'.,0,0
Wicket generates invalid HTML by expanding col tags,hi I just noticed that wicket expands col tags  even though the (x)html specifications forbids it.take this markup as an example:&lt;table&gt; &lt;colgroup&gt; &lt;col width='20%' /&gt; &lt;col width='80%' /&gt; &lt;/colgroup&gt; &lt;tbody&gt; &lt;tr&gt; &lt;td&gt;I take a fifth of the available space&lt;/td&gt; &lt;td&gt;I take four fifth of the available space&lt;/td&gt; &lt;/tr&gt; &lt;/tbody&gt;&lt;/table&gt;Instead of return this as-is  it get's converted to:&lt;table&gt; &lt;colgroup&gt; &lt;col width='20%'&gt;&lt;/col&gt; &lt;col width='80%'&gt;&lt;/col&gt; &lt;/colgroup&gt; &lt;tbody&gt; &lt;tr&gt; &lt;td&gt;I take a fifth of the available space&lt;/td&gt; &lt;td&gt;I take four fifth of the available space&lt;/td&gt; &lt;/tr&gt; &lt;/tbody&gt;&lt;/table&gt;But the specifications mention that col tags must not have end tags. This may be related to WICKET-2765  as this seems to be the point when col was added to the OpenCloseTagExpander class. Note that it is ok to have a non closing col tag in html (self-closing in xhtml). It's all about generating a separated end tag.This happens in wicket 6.8  but I guess it's relevant to all versions down to wicket 1.4.Specs for reference:http://www.w3.org/TR/1999/REC-html401-19991224/struct/tables.html#edef-COLhttp://www.w3.org/TR/html-markup/col.htmlKind regards Konrad,0,0
JS: High stack size in Function Executor causes 'too much recursion',The Function Executor in wicket-ajax-jquery.js uses recursion and deferred calls to the notify() function to ensure synchronous execution of all tasks contained in an AjaxResponse.Each task calls notif() when it is finished. This causes a recursive call to processNext() thus raising the stack for each execution. If there are a lot of task to handle  the stack size will increase beyond the possible stack size in the client causing a 'too much recursion' exception and increasingly low performance.The deferred execution of notify is only necessary if the task executor has to wait for long running tasks to finish at some uncertain point in the future. Examples: downloading of external resources (js  css  images). These task can call back the executor as soon as they are really finished (e.g. load event triggerd).The problem is that the majority of tasks don't need to wait but return instantly instead. Examples: exchanging components  executing custom javascripts that do not use the '|-syntax' to include the notify callback.Current fix: The depth of the stack is counted and if a depth of &gt;= 1000 is reached  a timeout will interrupt the synchronous task queue execution. A new executor will continue with an empty stack.Problems with that approach:  why 1000? several ajax requests might interrupt each other because the synchronous execution is broken. if an executed custom javascript creates a big stack itself (e.g. by using jquery a lot) the stack will add to the stack used by the Function Executor so that it may still be too big.Proposal to fix this: see also the attached patch.Another callback notifyContinue() is supported that can be called whenever the task will return instantly. This callback avoids the recursive call to processNext and continues in a simple loop over all the tasks.,0,1
Broken Link in Tomcat because of Page Mount,I post this message on the user mailing List (http://apache-wicket.1842946.n4.nabble.com/Broken-Link-in-Tomcat-because-of-Page-Mount-tt4659663.html) and Martin Grigorov asked me  to create a ticket on Jira.Broken Link in Tomcat because of Page MountFollowing situation:-I have a Wicket Application(6.8.0) which runs under the context 'webapp' on a Tomcat 7.0.41-I mount a Page with two parameters (this is important) in the WicketApplication. mountPage('/mount/${parameter1}/${parameter2}'  MountedPage.class);-The mounted Page(MountedPage.class) has only a simple Link-There are two links on the HomePage to the mounted Page. They are declared as follows: add(new Link&lt;Void&gt;('link') { @Override public void onClick() { setResponsePage(MountedPage.class  linkParameters); } }); add(new Link&lt;Void&gt;('brokenLink') { @Override public void onClick() { setResponsePage(new MountedPage(linkParameters)); } });I deploy this Application as a war file on a Tomcat under the context 'webapp'.When I call the first Link on the HomePage and then the Link on the mounted Page  everything works fine.But if I call the second Link and then the Link on the mounted Page  the link is broken.The context is missing in the generated link http://localhost:8080/wicket/bookmarkable/com.mycompany.LinkedPageDoes anyone have an idea  why the second link does not work on Tomcat?I add a Quickstart and the war file as attachment.Ps: Both links works fine in Jetty. Pss:If I remove the mount command  both links will work in Tomcat too.,0,0
Allow configuring the resource used by ResourceStreamRequestHandler,During the migration from Wicket 1.4 to 1.5.10 I found out that the ResourceStreamResource.respond() does not set the ContentType charset if the resource is of type StringResourceStream. Even though the stream holds the charset  it is not set  although quite a few other header parameters are (well this is understandable because not all ResourceStreams are StringResourceStreams. Also  it is difficult to call the resource.setTextEncoding  because the current flow in resourceStreamRequestHandler.respond does not allow easy overriding of any smaller piece of respond than the whole method. The practical issue was to download a CSV file by clicking a button. I managed to fix the issue by copy/paste/Overriding the ResourceStreamRequestHandler.respond  but IMHO this is not nice: private void addCsvButton() { Form&lt;?&gt; form = new Form&lt;Void&gt;('form') { @Override protected void onSubmit() { final String fileName = getFileName('csv'); TableCsvResourceFactory factory = new TableCsvResourceFactory(); final IResourceStream resourceStream = factory.getResourceStream(tableModel.getObject()); ResourceStreamRequestHandler resourceStreamRequestHandler = new ResourceStreamRequestHandler( resourceStream) { final ContentDisposition contentDisposition = ContentDisposition.ATTACHMENT; @Override public void respond(IRequestCycle requestCycle) { Attributes attributes = new Attributes(requestCycle.getRequest()  requestCycle.getResponse()); ResourceStreamResource resource = new ResourceStreamResource(resourceStream); resource.setFileName(fileName); if (contentDisposition != null) { resource.setContentDisposition(contentDisposition); } else { resource.setContentDisposition(Strings.isEmpty(fileName) ? ContentDisposition.INLINE : ContentDisposition.ATTACHMENT); } final Duration cacheDuration = getCacheDuration(); if (cacheDuration != null) { resource.setCacheDuration(cacheDuration); }+ resource.setTextEncoding('UTF-8'); resource.respond(attributes); } }; RequestCycle.get().scheduleRequestHandlerAfterCurrent(resourceStreamRequestHandler); } }; form.setVisible(displayCsv); add(form); }There are a couple of problems with the current implementation of ResourceStreamRequestHandler:1) I didn't figure out yet any other way how to call the  resource.setTextEncoding('UTF-8');except by copy/pasting the whole ResourceStreamRequestHandler.respond() code to the Override. It would be nice  if there would be some cleaner hook to override some smaller part of this method  such as an empty default implementation of setTextEncoding() that would be always called but would not do anything for other types.2) A second approach would be to create a StringResourceStreamRequestHandler extends ResourceStreamRequestHandler that would be otherwise the same  but would use IStringResource instead of IResource  and would also set the TextEncoding.3) However  third  I didn't yet find any good way to get the encoding from the StringResourceStream itself  because the AbstractStringResourceStream has a protected getCharset(). This problem could be overcome by adding public version of getCharset() to StringResourceStream  or as I did  create a parallel subclass CharsetStringResourceStream that is a copy/paste from StringResourceStream but is non-final and has public getCharset(). After this you could dynamically set the text encoding in ResourceStreamRequestHandler.respond for example like this: if (getResourceStream() instanceof CharsetStringResourceStream) { resource.setTextEncoding(((CharsetStringResourceStream)getResourceStream()).getCharsetName()); }Anyway  I think the usage of StringResourceStream with ResourceStreamRequestHandler should be improved somehow  at the moment I think it is a bit awkward to use.,0,0
Url can't parse urls with username and password,Url tries to parse the password as the portnumber  because it's after the :  resulting in the following exception:java.lang.NumberFormatException: For input string: '23dc429c-4ffa-4e99-8e24-984571f4c3b6@digdag-rest-dev2.topicusonderwijs.nl' java.lang.NumberFormatException.forInputString(NumberFormatException.java:65) java.lang.Integer.parseInt(Integer.java:492) java.lang.Integer.parseInt(Integer.java:527) org.apache.wicket.request.Url.parse(Url.java:276) org.apache.wicket.request.Url.parse(Url.java:192) org.apache.wicket.protocol.http.servlet.ServletWebResponse.encodeRedirectURL(ServletWebResponse.java:212) org.apache.wicket.protocol.http.servlet.ServletWebResponse.sendRedirect(ServletWebResponse.java:236) org.apache.wicket.protocol.http.BufferedWebResponse$SendRedirectAction.invoke(BufferedWebResponse.java:400) org.apache.wicket.protocol.http.BufferedWebResponse.writeTo(BufferedWebResponse.java:588) org.apache.wicket.protocol.http.HeaderBufferingWebResponse.stopBuffering(HeaderBufferingWebResponse.java:60) org.apache.wicket.protocol.http.HeaderBufferingWebResponse.flush(HeaderBufferingWebResponse.java:97) org.apache.wicket.protocol.http.WicketFilter.processRequestCycle(WicketFilter.java:269) org.apache.wicket.protocol.http.WicketFilter.processRequest(WicketFilter.java:201) org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:282),0,0
FilenameWithVersionResourceCachingStrategy breaks silently when the versionPrefix is contained in the original filename,If a resource name contains the character used as version prefix then FilenameWithVersionResourceCachingStrategy#undecorateUrl() will split the decorated filename wrongly and the resource response will return 404 (Not found).,0,0
ComponentRenderer.renderComponent fails to render two components with different component IDs,After WICKET-5232 was fixed  #renderComponent now accepts component with any component ID. However since the markup of the RenderPage is cached  after calling #renderComponent for one component it will fail for components having different component ID.This could be fixed as I suggested in WICKET-5232: RenderPage could implement IMarkupCacheKeyProvider interface and return null in #getCacheKey.,0,0
XmlAjaxResponse restores wrong response,XmlAjaxResponse#writeComponent() erroneously sets the passed response into the requestCycle  although it never was the old (=original) response: @Overrideprotected void writeComponent(Response response  ...){ ... // Restore original response RequestCycle.get().setResponse(response);}AjaxRequestHandler#respond(...) restores the correct old response afterwards  but temporarily the current response of the RequestCycle is wrong.,0,0
Do not set the location.hash when clicking on a link,Clicking an AjaxLink or SubmitLink sets the location.hash to an empty value (..../someUrl?some=param#).This interferes with JavaScript libraries which need to use 'hashchange' event.Additionally in two of our apps we experience a strange page reloads after clicking on AjaxLink.The issue is not easy to reproduce but it seems to be caused by the used href='#' somehow.Applying a custom behavior that overrides href='#' with href='javascript:;' fixes the problem.The problem occurred on Google Chrome and IE9 so far.,0,0
Wicket Tree rendering broken in 7.x,While testing WICKET-5267 (EventDelegationBehavior) I've noticed that the Tree component renders with broken layout in Wicket 7.x.It looks like a CSS related issue.,0,0
Tabindex overwritten in modal window for IE - Works in FF  Chrome,Attribute tabindex gets overwritten in ModalDialog  when using IE 8 9 10.. It works fine in FF  Chrome.This breaks chances of creating accessability by using tab.See attachment for testproject  which works in ff chrome  fails in ie 8 9 10.1) Open modallink (lightbox)2) use tabbutton - in ff  chrome you'll tab between closebutton and content  in ie this fails cause tabindex gets overwritten by -1. I suspect it's this codepart in modal.js that does it.if (Wicket.Browser.isIE()) { this.disabledTabsRevertList = []; for (var j = 0; j &lt; this.tabbableTags.length; j++) { var tagElements = doc.getElementsByTagName(this.tabbableTags&#91;j&#93;); for (var k = 0 ; k &lt; tagElements.length; k++) { // if this is not an iframe window and the element is child of window content  // don't disable tab on it if (win.isIframe() === true || this.isParent(tagElements&#91;k&#93;  win.content) === false) { var element = tagElements[k]; element.hiddenTabIndex = element.tabIndex; element.tabIndex='-1'; this.disabledTabsRevertList.push(element); } } } },0,0
o.a.w.a.AtmosphereBehavior onBroadcast should log DEBUG  not INFO,Logging of onBroadcast is too verbose to be on INFO level :14:48:54.812 | INFO | oryBean_Worker-4 | o.a.w.a.EventBus | pache.wicket.atmosphere.EventBus 203 | registering component for page 1 for session A3D08FEE5445F872C8A69289C00F79E3: crumbHolder:jobListPanel14:48:54.831 | INFO | Shared-AsyncOp-0 | o.a.w.a.AtmosphereBehavior | et.atmosphere.AtmosphereBehavior 129 | onBroadcast: 32501&lt;|msg|&gt;&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;ajax-response&gt;&lt;component id='jobListPanel1ea9' &gt;&lt;![CDATA[&lt;div id='jobListPanel1ea9'&gt;&lt;h3&gt;Device Presences&lt;/h3&gt;&lt;div class='btn-toolbar'&gt; &lt;a href='#' class='btn btn-danger' id='deleteAllBtn1f27'&gt;&lt;i class='icon-trash'&gt;&lt;/i&gt; Delete all&lt;/a&gt;&lt;span style='display:none;' class='wicket-ajax-indicator' id='deleteAllBtn1f27--ajax-indicator'&gt;&lt;img src='./wicket/resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/indicator-ver-1373820815000.gif' alt=''/&gt;&lt;/span&gt;&lt;/div&gt;&lt;table id='devicePresenceTable1f33' class='table-striped table-bordered table'&gt;&lt;thead&gt; &lt;tr class='navigation'&gt; &lt;td colspan='5'&gt;...It should be DEBUG level only,0,0
Too deep recursion in AbstractHierarchyIterator,In application we have code as follows: MarkupContainer mc = ...; ComponentHierarchyIterator iter = mc.visitChildren(FormComponent.class); for (Component c : iter) { ... }However  when run  on many pages this causes java.lang.StackOverflowError  with lots of the stacktrace filled with lines like this:... org.apache.wicket.util.iterator.AbstractHierarchyIterator.moveUp(AbstractHierarchyIterator.java:302) org.apache.wicket.util.iterator.AbstractHierarchyIterator.moveUp(AbstractHierarchyIterator.java:302) org.apache.wicket.util.iterator.AbstractHierarchyIterator.nextNode(AbstractHierarchyIterator.java:259) org.apache.wicket.util.iterator.AbstractHierarchyIterator.moveDown(AbstractHierarchyIterator.java:170) org.apache.wicket.util.iterator.AbstractHierarchyIterator.nextNode(AbstractHierarchyIterator.java:236) org.apache.wicket.util.iterator.AbstractHierarchyIterator.moveUp(AbstractHierarchyIterator.java:297) org.apache.wicket.util.iterator.AbstractHierarchyIterator.nextNode(AbstractHierarchyIterator.java:259) org.apache.wicket.util.iterator.AbstractHierarchyIterator.moveDown(AbstractHierarchyIterator.java:170) org.apache.wicket.util.iterator.AbstractHierarchyIterator.nextNode(AbstractHierarchyIterator.java:236) org.apache.wicket.util.iterator.AbstractHierarchyIterator.moveDown(AbstractHierarchyIterator.java:170) org.apache.wicket.util.iterator.AbstractHierarchyIterator.nextNode(AbstractHierarchyIterator.java:236) org.apache.wicket.util.iterator.AbstractHierarchyIterator.moveDown(AbstractHierarchyIterator.java:170) org.apache.wicket.util.iterator.AbstractHierarchyIterator.nextNode(AbstractHierarchyIterator.java:236) org.apache.wicket.util.iterator.AbstractHierarchyIterator.moveDown(AbstractHierarchyIterator.java:170) org.apache.wicket.util.iterator.AbstractHierarchyIterator.nextNode(AbstractHierarchyIterator.java:236) org.apache.wicket.util.iterator.AbstractHierarchyIterator.moveUp(AbstractHierarchyIterator.java:297) org.apache.wicket.util.iterator.AbstractHierarchyIterator.moveUp(AbstractHierarchyIterator.java:302) org.apache.wicket.util.iterator.AbstractHierarchyIterator.nextNode(AbstractHierarchyIterator.java:259)...It seems that the search for next component in the iteration produces too deep recursion here (not infinite  but too deep for processing a typical page with relatively lots of components) and I suspect that the length of the stack used by the iterator is proportional to the total number of components in the page.,0,1
o.a.w.extensions.markup.html.form.DateTextField should be applicable to HTML5 date input types,Markup:&lt;input type='date' wicket:id='startDateFld'/&gt;Java:add(new DateTextField('startDateFld'  new Model&lt;Date&gt;()));It should accept the following HTML5 input types:1. date2. datetime3. datetime-local4. month5. time6. weekError:Component [startDateFld] (path = [24:compId:startDateFld]) must be applied to a tag with [type] attribute matching [text]  not [date] MarkupStream: [markup = file:/home/ceefour/git/quikdo-hub/freq.web/target/classes/com/quikdo/freq/web/DateRangePanel.html&lt;input type='date' wicket:id='startDateFld'/&gt;  index = 0  current = '&lt;input type='date' wicket:id='startDateFld'/&gt;' (line 0  column 0)] at org.apache.wicket.markup.MarkupStream.throwMarkupException(MarkupStream.java:526) at org.apache.wicket.Component.checkComponentTagAttribute(Component.java:3578) at org.apache.wicket.markup.html.form.TextField.onComponentTag(TextField.java:104) at org.apache.wicket.Component.internalRenderComponent(Component.java:2520) at org.apache.wicket.MarkupContainer.onRender(MarkupContainer.java:1493) at org.apache.wicket.Component.internalRender(Component.java:2379) at org.apache.wicket.Component.render(Component.java:2307) at org.apache.wicket.MarkupContainer.renderNext(MarkupContainer.java:1390) at org.apache.wicket.MarkupContainer.renderAll(MarkupContainer.java:1554) at org.apache.wicket.MarkupContainer.renderComponentTagBody(MarkupContainer.java:1529) at org.apache.wicket.MarkupContainer.renderAssociatedMarkup(MarkupContainer.java:689) at org.apache.wicket.markup.html.panel.AssociatedMarkupSourcingStrategy.renderAssociatedMarkup(AssociatedMarkupSourcingStrategy.java:76) at org.apache.wicket.markup.html.panel.PanelMarkupSourcingStrategy.onComponentTagBody(PanelMarkupSourcingStrategy.java:112) at org.apache.wicket.Component.internalRenderComponent(Component.java:2549) at org.apache.wicket.MarkupContainer.onRender(MarkupContainer.java:1493) at org.apache.wicket.Component.internalRender(Component.java:2379) at org.apache.wicket.Component.render(Component.java:2307) at org.apache.wicket.core.util.string.ComponentRenderer.renderComponent(ComponentRenderer.java:107) at com.quikdo.freq.web.FrequencyPage$FrequencyForm$1.load(FrequencyPage.java:91) at com.quikdo.freq.web.FrequencyPage$FrequencyForm$1.load(FrequencyPage.java:1) at org.apache.wicket.model.LoadableDetachableModel.getObject(LoadableDetachableModel.java:121) at de.agilecoders.wicket.core.markup.html.bootstrap.components.PopoverBehavior.newContent(PopoverBehavior.java:68) at de.agilecoders.wicket.core.markup.html.bootstrap.components.PopoverBehavior.onComponentTag(PopoverBehavior.java:47) at org.apache.wicket.Component.renderComponentTag(Component.java:3970) at org.apache.wicket.Component.internalRenderComponent(Component.java:2540) at org.apache.wicket.MarkupContainer.onRender(MarkupContainer.java:1493) at org.apache.wicket.Component.internalRender(Component.java:2379) at org.apache.wicket.Component.render(Component.java:2307) at org.apache.wicket.MarkupContainer.renderNext(MarkupContainer.java:1390) at org.apache.wicket.MarkupContainer.renderAll(MarkupContainer.java:1554) at org.apache.wicket.MarkupContainer.renderComponentTagBody(MarkupContainer.java:1529) at org.apache.wicket.MarkupContainer.onComponentTagBody(MarkupContainer.java:1484) at org.apache.wicket.markup.html.form.Form.onComponentTagBody(Form.java:1683) at org.apache.wicket.markup.html.panel.DefaultMarkupSourcingStrategy.onComponentTagBody(DefaultMarkupSourcingStrategy.java:71) at org.apache.wicket.Component.internalRenderComponent(Component.java:2549) at org.apache.wicket.MarkupContainer.onRender(MarkupContainer.java:1493) at org.apache.wicket.Component.internalRender(Component.java:2379) at org.apache.wicket.Component.render(Component.java:2307) at org.apache.wicket.MarkupContainer.renderNext(MarkupContainer.java:1390) at org.apache.wicket.MarkupContainer.renderAll(MarkupContainer.java:1554) at org.apache.wicket.MarkupContainer.renderComponentTagBody(MarkupContainer.java:1529) at org.apache.wicket.MarkupContainer.onComponentTagBody(MarkupContainer.java:1484) at org.apache.wicket.markup.html.panel.DefaultMarkupSourcingStrategy.onComponentTagBody(DefaultMarkupSourcingStrategy.java:71) at org.apache.wicket.Component.internalRenderComponent(Component.java:2549) at org.apache.wicket.MarkupContainer.onRender(MarkupContainer.java:1493) at org.apache.wicket.Component.internalRender(Component.java:2379) at org.apache.wicket.Component.render(Component.java:2307) at org.apache.wicket.MarkupContainer.renderNext(MarkupContainer.java:1390) at org.apache.wicket.MarkupContainer.renderAll(MarkupContainer.java:1554) at org.apache.wicket.MarkupContainer.renderComponentTagBody(MarkupContainer.java:1529) at org.apache.wicket.MarkupContainer.onComponentTagBody(MarkupContainer.java:1484) at org.apache.wicket.markup.html.panel.DefaultMarkupSourcingStrategy.onComponentTagBody(DefaultMarkupSourcingStrategy.java:71) at org.apache.wicket.Component.internalRenderComponent(Component.java:2549) at org.apache.wicket.MarkupContainer.onRender(MarkupContainer.java:1493) at org.apache.wicket.Component.internalRender(Component.java:2379) at org.apache.wicket.Component.render(Component.java:2307) at org.apache.wicket.MarkupContainer.renderNext(MarkupContainer.java:1390) at org.apache.wicket.MarkupContainer.renderAll(MarkupContainer.java:1554) at org.apache.wicket.Page.onRender(Page.java:876) at org.apache.wicket.markup.html.WebPage.onRender(WebPage.java:142) at org.apache.wicket.Component.internalRender(Component.java:2379) at org.apache.wicket.Component.render(Component.java:2307) at org.apache.wicket.Page.renderPage(Page.java:1010) at org.apache.wicket.request.handler.render.WebPageRenderer.renderPage(WebPageRenderer.java:121) at org.apache.wicket.request.handler.render.WebPageRenderer.respond(WebPageRenderer.java:271) at org.apache.wicket.core.request.handler.RenderPageRequestHandler.respond(RenderPageRequestHandler.java:165) at org.apache.wicket.request.cycle.RequestCycle$HandlerExecutor.respond(RequestCycle.java:861) at org.apache.wicket.request.RequestHandlerStack.execute(RequestHandlerStack.java:64) at org.apache.wicket.request.cycle.RequestCycle.execute(RequestCycle.java:261) at org.apache.wicket.request.cycle.RequestCycle.processRequest(RequestCycle.java:218) at org.apache.wicket.request.cycle.RequestCycle.processRequestAndDetach(RequestCycle.java:289) at org.apache.wicket.protocol.http.WicketFilter.processRequestCycle(WicketFilter.java:259) at org.apache.wicket.protocol.http.WicketFilter.processRequest(WicketFilter.java:201) at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:282) at org.atmosphere.util.AtmosphereFilterChain.doFilter(AtmosphereFilterChain.java:155) at org.atmosphere.util.AtmosphereFilterChain.invokeFilterChain(AtmosphereFilterChain.java:132) at org.atmosphere.handler.ReflectorServletProcessor$FilterChainServletWrapper.service(ReflectorServletProcessor.java:314) at org.atmosphere.handler.ReflectorServletProcessor.onRequest(ReflectorServletProcessor.java:172) at org.atmosphere.cpr.AsynchronousProcessor.action(AsynchronousProcessor.java:259) at org.atmosphere.cpr.AsynchronousProcessor.suspended(AsynchronousProcessor.java:166) at org.atmosphere.container.BlockingIOCometSupport.service(BlockingIOCometSupport.java:101) at org.atmosphere.container.Tomcat7BIOSupportWithWebSocket.doService(Tomcat7BIOSupportWithWebSocket.java:65) at org.atmosphere.container.TomcatWebSocketUtil.doService(TomcatWebSocketUtil.java:87) at org.atmosphere.container.Tomcat7BIOSupportWithWebSocket.service(Tomcat7BIOSupportWithWebSocket.java:61) at org.atmosphere.cpr.AtmosphereFramework.doCometSupport(AtmosphereFramework.java:1441) at org.atmosphere.cpr.AtmosphereServlet.doPost(AtmosphereServlet.java:296) at org.atmosphere.cpr.AtmosphereServlet.doGet(AtmosphereServlet.java:282) at javax.servlet.http.HttpServlet.service(HttpServlet.java:621) at javax.servlet.http.HttpServlet.service(HttpServlet.java:728) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210) at com.codahale.metrics.servlet.AbstractInstrumentedFilter.doFilter(AbstractInstrumentedFilter.java:97) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210) at ch.qos.logback.classic.selector.servlet.LoggerContextFilter.doFilter(LoggerContextFilter.java:70) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:222) at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:123) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:472) at org.apache.catalina.core.StandardHostValve.__invoke(StandardHostValve.java:171) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:99) at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:947) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:408) at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1009) at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:589) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1686) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) at java.lang.Thread.run(Thread.java:724),0,0
MarkupCache ignores enforceReload flag,MarkupCache ignores the enforceReload flag in the loadMarkupAndWatchForChanges() method. v6.9.1 lines 498 to 511 should be wrapped in an 'if (!enforceReload){ }'.,0,0
OnEventHeaderItem should remove 'on' prefix for the event name,OnEventHeaderItem uses JavaScript event registration  instead of inline DOM attributes  so it should remove 'on' prefixes when it is provided by the user application.For example: onclick =&gt; click.,0,0
Create a module for Native WebSocket based on JSR 356,Tomcat 8 will soon release its RC1 that contains an implementation of JSR 356 - WebSocket 1.0Wicket should provide module to integrate with this API. It should work with other implementations of this JSR too,0,0
Static id counter AbstractToolbar prevents stable component paths for testing,see summary,0,0
AbstractResource should check for error code first before for modifications,Since org.apache.wicket.request.resource.AbstractResource#setResponseHeaders() gives a chance to the application to set custom headers it should first check for error and status codes set and then check for modifications (Not Modified).Because now one needs to reset the modification time of the resource if she wants to set error or status code.,0,0
Export resources' version cache attribute as request cycle metadata,It would be nice if the IResourceCachingStrategies provided Wicket export the extracted version for the lifecycle of the request.An application may need this version to be able to check later whether the requested resource is the one that the system will actually deliver.E.g. web container 1 may deliver the page markup to the browser and then disappear due to upgrade. Then all requests for the resources in that page will be automatically redirected to web container 2 that may have new versions of the resources. In this case the application may return 302/303 (redirect) or 404 (Not found) or whatever is the best for the case.,0,0
AuthenticatedWebSession#authenticate should be protected  not public,A common source of confusion in trainings is that when implementing security using wicket-auth-roles  you have to implement #authenticate in your own session class  but in the login form's #onSubmit you have to call #signIn.Both #authenticate and #signIn are public and both have identical signatures. Their names mean basically the same thing too. This is rather error-prone.I propose changing the visibility of #authenticate to protected. That way  it will still work the same as it does now  except it won't show up in code-completion anymore and won't compete with #signIn anymore.This should not be an API break  since #authenticate is abstract anyway and is always implemented in user code. Raising visibility from protected to public is always legal  so user code should not break from this change.Opinions?,1,0
No page id appended to some stateful pages using repeaters,My test case is a page containing a ListView with a single stateful child. In that case  there is no redirect done to append a pageId to the url because the page's statefulness check is erroneous.Analysis:This calls page.isPageStateless() to dertermine whether a pageId should be addedBookmarkableMapper(AbstractBookmarkableMapper).getPageInfo(IPageRequestHandler) line: 440BookmarkableMapper(AbstractBookmarkableMapper).mapHandler(IRequestHandler) line: 387SystemMapper(CompoundRequestMapper).mapHandler(IRequestHandler) line: 215RequestCycle.mapUrlFor(IRequestHandler) line: 429WebPageRenderer.respond(RequestCycle) line: 268RenderPageRequestHandler.respond(IRequestCycle) line: 165RequestCycle$HandlerExecutor.respond(IRequestHandler) line: 861RequestCycle$HandlerExecutor(RequestHandlerStack).execute(IRequestHandler) line: 64RequestCycle.execute(IRequestHandler) line: 261The problem I see is that AbstractRepeater's onPopulate() is called during onBeforeRender() and this is not done when the stateless status of the page is first checked. Therefore  no pageId is added unless other components not located inside repeaters are also stateful. See thread http://wicket-users.markmail.org/thread/6q2dmns7lqjgkok7I will add a quickstart.,0,0
if wicket is an external lib  BundleStringResourceLoader doesn't work,We have got serveral Wicket-based Wepapps on our server and in order to save space  we have move all shared libs (including wicket) into a shared folder which is included via the 'common.loader' of the catalina.properties file. (Using Apache Tomcat/7.0.39)The Problem is now  that StringResourceModel works normal  but the BundleStringResourceLoader doesn't work anymore. It always returns null.How to reproduce:Build attached quickstartRemove wicket-libs from warDeploy in Tomcat,0,0
PriorityHeaderItem+OnDomReadyHeaderItem has no priority in Ajax response,PriorityHeaderItems+OnDomReadyHeaderItem have no priority in Ajax responses.org.apache.wicket.ajax.AbstractAjaxResponse.AjaxHeaderResponse#render() doesn't extract the wrapped header item and thus doesn't process OnDomReady/OnLoad/OnEvent header items properly.,0,0
Wicket doesn't encrypt links and Ajax URLs for mounted pages when CryptoMapper is used,URL encryption does not work in Wicket links and Ajax URLs.For links the URL appears unencrypted in the href attribute value and is only later forwarded to the encrypted URL using a 302 response.I am uploading a quickstart.,1,0
wicket-bean-validation french translation,French transalation for wicket-bean-validation to put in org/apache/wicket/bean/validation directory,0,0
Make Palette a FormComponentPanel,Having Palette extend FormComponentPanel would allow it to be used as any other FormComponent  e.g. controlling required and validation.,0,0
org.apache.wicket.util.string.StringValue#equals broken,The #equals implementation for org.apache.wicket.util.string.StringValue is broken. The following throws an exception instead of just printing 'false':StringValue val = StringValue.valueOf('bla'  Locale.FRANCE);StringValue val2 = StringValue.valueOf('bla'  Locale.CANADA);System.out.println(val.equals(val2));This part of #equalsObjects.isEqual(locale  stringValue.locale)should probably be replaced with something like(locale == stringValue.locale || (locale != null &amp;&amp; locale.equals(stringValue.locale))-&gt; Objects.isEqual is not suitable to determine equality of Locale,0,0
ResourceAggregator looses information about priority/filtering/... when using a bundle,If a resource reference is part of a bundle and this resource reference is rendered with PriorityHeaderItem then the bundle is not rendered with priority.,0,0
SourcesPage fails on resources with non-ASCII characters,When created with a String input argument  XhtmlRenderer uses the deprecated java.io.StringBufferInputStream  which 'does not properly convert characters into bytes' (javadoc).Thus the rendered output may contain invalid characters for the Ajax response.,0,0
Log the exception if the application cannot start properly,WicketFilter doesn't provide helpful information when the application cannot be initialized for some reason.At the moment it just does:log.warn('initialization failed  destroying now');1) it doesn't log the cause exception2) the severity is rather FATAL than WARN,0,0
Allow form components to trim the input themselves,Make org.apache.wicket.markup.html.form.FormComponent#trim non-final so they can trim the input with more sophisticated ways.String#trim() removes only the breaking whitespaces. To trim non-breaking ones the application can use Guava's CharMatcher.WHITESPACE.trimFrom(str) for example.,0,0
wicket-bean-validation PropertyValidator_fr.properties.xml : org.xml.sax.SAXParseException,French translation for wicket-bean-validation was added in WICKET-5333.It was a properties file that was working.Unfortunatly in the source code it was changed in a XML file that is not weel-formed!java.util.InvalidPropertiesFormatException: org.xml.sax.SAXParseException; lineNumber: 24; columnNumber: 110; The content of elements must consist of well-formed character data or markup. at java.util.XMLUtils.load(XMLUtils.java:76) ~&#91;na:1.7.0_21&#93; at java.util.Properties.loadFromXML(Properties.java:868) ~&#91;na:1.7.0_21&#93;,0,0
Allow DebugBar contributors to be removed,Please add a way to unregister DebugBar contributors.I wish to remove some of the default contributors and currently have to do this by using reflection to lookup the 'CONTRIBS_META_KEY' field.The reason why I'm removing contributors (perhaps there's a better solution?): PageSizeDebugPanel tries to serialize the whole page during page rendering  while models are still attached. This causes most of our database-backed models to complain that they're being serialized without being detached (as this usually means somebody probably forgot to call detach() somewhere). InspectorDebugPanel - InspectorPage currently shows me a blank component tree because it doesn't have @RequireHttps as all our other pages do and thus redirects to an http:// URL and can't see the session. So we copied InspectorPage (since it's final and can't be subclassed) to add @RequireHttps and likewise copied InspectorDebugPanel.,0,1
Allow continued processing with WicketTester after exception is thrown,When exposing an exception while processing  WicketTester is left in an inconsistent state. Since #setupNextRequestCycle() is not called  no additional processing is possible afterwards: org.apache.wicket.WicketRuntimeException: No RequestCycle is currently set!For tests expecting WicketTester#process() to fail  it would be nice to be able to continue processing with the same tester instance afterwards.,0,0
Behaviors#internalAdd(Behavior) erroneously gets id for stateless behaviors,see http://markmail.org/thread/jtd4zn527r343jbm,0,0
Improve 'mvn jetty:run' to behave as Start.java,Merge Pull Request https://github.com/apache/wicket/pull/59 that updates Jetty 9.0.x and improves 'mvn jetty:run' to support HTTPS as Start.java does.,0,0
Do not initialize pages which were not rendered,Since WICKET-5083 (6.8.0) Wicket initializes the page before calculating whether the page is stateless.We identified a performance problem when a page is constructed (and thus touched) but then ignored via setResponsePage(AnotherPage.class)/RestartResponsePage and thus is not rendered and initialized.In this case there is no reason to check whether the page is stateful and store it. Using browser back button will go to the previous page anyway.For example: pageA has a link to PageB in PageB's constructor a RestartResponseException(PageC.class) PageC is renderedIn this example PageB will be fully initialized in org.apache.wicket.page.RequestAdapter#commitRequest to check whether it is stateful or not. But there is really no reason to store it at all since PageB has never been rendered.In our case PageB#onInitialize was expensive (read some settings from the backend) and thus we noticed the difference.,0,1
BOM in UTF markup file breaks encoding detection,I have project with internationalization and experienced this problem with one of the pages with non-english content. Page had UTF-8 encoding  but my JVM encoding is different. I always use '&lt;?xml encoding ... ?&gt;' to specify encoding for markup pages (and 'MarkupSettings.defaultMarkupEncoding' is not set).Unexpectedly I got problem with bad encoding on page. After several hours of debugging I found what source of this issue was UTF BOM (Byte order mark) at the beggining of file and inability of 'XmlReader' to process it. 'XmlReader.getXmlDeclaration' tries to match xml declaration with regular expression  but fails because of BOM. After that encoding defaults to JVM encoding.It's possible to use 'org.apache.commons.io.input.BOMInputStream' to handle BOM or you could handle it manually inside 'XmlReader'.PS: issue found with Wicket 1.5.10 and I see same code in 6.12.0 without BOM handling  so I added it to 'Affects Version/s'  but no proof-in-code available from me at this moment.,0,0
this.replaceWith is broken when called from onInitialize,When calling this.replaceWith within the onInitialize method  wicket throws an exception:'Last cause: org.apache.wicket.Component has not been properly initialized. Something in the hierarchy of com.mycompany.PanelA has not called super.onInitialize() in the override of onInitialize() method'This happens because detach is called on the panel being replaced which clears Component.request flags (sets to 0) which causes the exception on line 864 of Component.java:if (!getRequestFlag(RFLAG_INITIALIZE_SUPER_CALL_VERIFIED)) { // throws here},0,0
PropertyValidator ignoring groups with the @NotNull annotation only,When using groups in your JSR303 compliant classes  Wicket does not honor the groups for the @NotNull annotation.,0,0
ComponentRenderer.renderComponent() adds a page to DataStore,I'm using ComponenetRenderer withing CustomTooltipBehavior (wicket-jquery-ui) to generate tooltip content. I add this to about 50 rows in my table so I run renderComponent() method as many times.All worked fine but there was a problem with performance when I used Fragment component with markup attached to the WebPage. I did some digging and finally checked http://localhost:8080/context/wicket/internal/debug/diskDataStore and it appeared that for one request  Wicket stores 51 pages in it. All of the size of the whole page (about 300kB) and all of them named org.apache.wicket.core.util.string.ComponentRenderer$RenderPage.I changed implementation from Fragment to Panel componenet and the size was reduced to (1kB) but still all of these items were stored in the DataStore.It seems that this method is creating a dummy page in order to create the markup  but how can I avoid storing these pages?,0,1
Page.isPageStateless() returning true in regular run but false in WicketTester,Motivation:Healthcheck/heartbeat pages must always be stateless to prevent significant amounts of session creation and storage.Also each anonymously accessed page in a public site should be stateless due to the same reason (otherwise the site could easily be DoSsed down).It would be nice to verify these requirements by tests.If I create an ought-to-be-stateless page with an AjaxLink which is hidden by a behavior:public class MyPage extends WebPage { public MyPage() { add(new AjaxLink&lt;Void&gt;('link') { @Override public void onClick(AjaxRequestTarget target) { // } }.add(new Behavior() { @Override public void onConfigure(Component c) { c.setVisible(false); } })); add(new Label('isPageStateless'  new AbstractReadOnlyModel&lt;Boolean&gt;() { @Override public Boolean getObject() { return MyPage.this.isPageStateless(); } })); }}then checking through a web server the page correctly prints 'true'  and no HttpSessions are created.However  when I try to verify statelessness through WicketTester  the following test passes:@Testpublic void testName() throws Exception { WicketTester tester = new WicketTester(new WebApplication() { @Override public Class&lt;? extends Page&gt; getHomePage() { return MyPage.class; } }); tester.startPage(MyPage.class); tester.assertLabel('isPageStateless'  'false'); assertFalse(tester.getLastRenderedPage().isPageStateless());}It seems that somehow due to WicketTester  isPageStateless() is being invoked before any behaviors are run (and thus the AjaxLink is still visible)  and since stateless-flag for the page is cached  it remains false.If it's by design that isPageStateless should always return the same result during each request  then I guess that the statelessness resolution process must not depend on anything happening after the page constructor? I assume it's not by design.Suggestions:A) Obvious fix would be to remove stateless-flag caching  since apparently it is causing problems  as also suggested by a hackish comment in Page.init(). In general  caching should always be used sparingly.B) Or maybe whoever is invoking isPageStateless() at an early stage should actually be using Page.peekPageStateless()? But this doesn't really seem like a real fix  more like a temporary hack.C) All caching could also be disabled during test runs  but this would not be a good thing since tests should reproduce the actual behavior as closely as possible.D) In case this is a known issue without a proper fix  how then could I verify page statelessness through WicketTester? Currently I'm clearing the stateless-cache by reflection  which feels kind of bad...,1,1
WicketTester doesn't preserve the request cookies when #executeListener() is used,org.apache.wicket.util.tester.BaseWicketTester#executeListener(org.apache.wicket.Component  org.apache.wicket.RequestListenerInterface) creates a new new MockHttpServletRequest but doesn't do the cookie management as in org.apache.wicket.util.tester.BaseWicketTester#setupNextRequestCycle() (the only other place where a new MockHttpServletRequest is created).,0,0
Implement BigIntegerConverter,There are converters for all the other datatypes (subclass of AbstractNumberConverter)  but none for BigIntegerConverter  it would seem.,0,0
Allow restarting AbstractAjaxTimerBehavior without updating its hosting component,Currently when AbstractAjaxTomerBehavior is restarted  its updates its whole hosting component. This is undesirable when you have added the behavior to the page or another component high in the hierarchy.,0,0
Make CaptchaImageResource easier to extend and reuse,Wicket-Extensions' CaptchaImageResource generates its image byte array in the private #render() method. By making this method protected it will be easy to use third-party/custom code to generate the image and re-use the invalidation logic.,0,0
Use method chaining where it makes sense,It's quite inconvinient to have Component.setMetaData which return void.For stacking purposes it'll be better to make this method return 'this'.,0,0
Remove 'final' from org.apache.wicket.markup.html.form.EnumChoiceRenderer#getDisplayValue,org.apache.wicket.markup.html.form.EnumChoiceRenderer#getDisplayValue() adds unnecessary indirection by providing overrideable #postprocess() method.If an application doesn't want to use the default implementation to resolve a display value by using i18n resources then it should provide its own custom implementation of IChoiceRenderer because org.apache.wicket.markup.html.form.EnumChoiceRenderer#getDisplayValue is final and it will throw MissingResourceException.If an application needs to use different logic it should be able to override #getDisplayValue(). If it needs to do something like #postprocess() then it can do:public Object getDisplayValue() { Object orig = super.getDisplayValue(); return manipulate(orig);},0,0
PackageResource#internalGetResourceStream() should return ProcessingResourceStream only when the resource is existing,The fix for WICKET-4762 introduced ProcessingResourceStream - a resource stream that wraps another IResourceStream and processes its InputStream (e.g. compresses it).There is a bug that even when the resource is not found  i.e. the resource stream is null  Wicket still wraps it in ProcessingResourceStream.Another inefficiency is that ResourceStreamWrapper (the parent of ProcessingResourceStream) declares its method #getDelegate() as protected. It should be public.,0,0
WebPageRenderer should honor RedirectPolicy.ALWAYS_REDIRECT more consistently,In WebPageRenderer shouldPreserveClientUrl() currently has precedence over RedirectPolicy.ALWAYS_REDIRECT.This can lead to confusion or unexpected behavior when RedirectPolicy.ALWAYS_REDIRECT is explicitely set  but for some reason shouldPreserveClientUrl() returns true and thus no redirect is performed due to the logic in WebPageRenderer.A fix for this particular problem could be implemented in WebPageRenderer as of Wicket 6.12.0 by changing line 211 to: (shouldPreserveClientUrl &amp;&amp; getRedirectPolicy() != RedirectPolicy.ALWAYS_REDIRECT)) //Note that this problem is slightly related to WICKET-5484. Both fixes combined the line could look like this: (shouldPreserveClientUrl &amp;&amp; !isAjax &amp;&amp; getRedirectPolicy() != RedirectPolicy.ALWAYS_REDIRECT)) //,0,0
AuthenticatedWebApplication#onUnauthorizedPage() should work with Component  not Page,As discussed at http://markmail.org/message/o2ayjxt7vb7dyjvf org.apache.wicket.authroles.authentication.AuthenticatedWebApplication#onUnauthorizedPage() should have a parameter with type 'Component'  not 'Page' because this Page is partially constructed - on the constructor of org.apache.wicket.Component is executed.All other super constructors (e.g. MarkupContainer  Page  WebPage  YourPage) are not.,0,0
WebApplication ignores a SecurityException when reading the configuration type,The WebApplication class has a piece of code in the method getConfigurationType()  that ignores a SecurityException.Code snippet: try { result = System.getProperty('wicket.' + Application.CONFIGURATION); } catch (SecurityException e) { // Ignore - we're not allowed to read system properties. }This apparently causes a performance problem at one of our customers  where they had shared classloading enabled. Permissions were set differently on shared classloader level  which caused the retrieval of the property to fail silently  while taking about 10ms longer. This code is called everytime Component.getMarkupId is called  which means with 300+ components on a page  you get a delay of 3 seconds or more.Ofcourse the problem can be (and has been) solved with a correct configuration. My request however is that the exception is atleast logged at some level (warning for example)  so spotting the problem will become a lot easier (it took us 2 weeks to narrow it down).,0,1
Disable jar indexing,Wicket's pom.xml uses maven-jar-plugin with &lt;index&gt;true&lt;/index&gt;  which creates META-INF/INDEX.LIST file in the JAR files. This is useless when done only for a single jar file and might in some cases even be harmful.I propose to disable the generation INDEX.LIST files both in Wicket 6 and 7.For a full discussion of the drawbacks  see the corresponding bug track at Tomcat's Bugzilla: https://issues.apache.org/bugzilla/show_bug.cgi?id=49236,0,1
Page is not touched during initialization,After migration from 6.12.0 to 6.13.0 our app stopped working.I figured out that there is a new condition in Page#dirty(final boolean isInitialization) on line 288:if (isInitialization == false){ pageManager.touchPage(this);}That means that nely constructed page does not get touched thus is not stored in page store.The problem is that when I do something like thisprintPage = new PrintPage(event.getFormId()  event.getFormData());PageProvider pp = new PageProvider(printPage);RenderPageRequestHandler rh = new RenderPageRequestHandler(pp);CharSequence url = RequestCycle.get().urlFor(rh);I get an URL pointing to page with id X - but that page is not found because it was not stored and I ends with nonsense PageExpired exception.I notice that 6.13.0 version fixed some bugs with stateless / statefull pages  etc. so that may be the cause. Nevertheless I think it's a bug.If you do not want to touch page during creation  then it must get touched whenever it is involved in some request handler.,0,0
DefaultPropertyResolver should resolve the Property according to the getter first,A domain model model2 may extend a domain model model1 and have JSR303 annotations on one or more getter to override constraints. In such a case  DefaultPropertyResolver cannot detect the right domain model implementation since direct property analysis is done first. Indeed  with the current implementation  if a property is declared in model1 and the getter is overriden in model2  model1 is systematically affected as the property class owner although model2 is the actual implementation associated with the Wicket model. As a consequence  some constraints validations may never been thrown.Swapping direct property analysis and getter analysis solves this problem.Workaround: providing my own property resolver.,0,0
Memory model improvements for Session fields,Currently org.apache.wicket.Session#sequence and org.apache.wicket.Session#pageId are primitive ints  non-volatile.They are accessed only in their getter methods where they are read and incremented. To make sure their values are correct the getter methods are synchronized on the session instance. This synchronization may lead to slower execution of the getter when another thread/request does something slower in another synchronized method of Session.Using AtomicInteger should improve here.Other fields of Session like locale and style are not synchronized and different threads may read old value for them. Using AtomicReference should improve this.Some special boolean fields like 'dirty' and 'sessionInvalidated' should be made volatile to avoid dirty reads.With WICKET-5473 org.apache.wicket.Session#nextPageId() and org.apache.wicket.Session#nextSequenceValue() call #dirty() only for bound sessions. The check whether the session is bound or not should really be in #dirty() itself.,0,1
Allow using child selector for JS event bindings,http://api.jquery.com/on/ has an optional 'selector' parameter that is used to to filter the descendants of the selected elements that trigger the event.It would be nice if Wicket's Wicket.Event.add() API provides a way to use it.Additionally it should be possible the selector to be set via AjaxRequestAttributes,0,0
IE11 returns false for Wicket.Browser.isIE(),As of Internet Explorer 11 this statement returns false instead of true (like it did prior to version 11):typeof(document.all) !== 'undefined'This statement is used on line 56 of wicket-event-jquery.js which means Wicket.Browser.isIE() will return false in IE11.,0,0
Failing HTTPS redirect to RequireHttps annotated pages with ONE_PASS_RENDER strategy,Activated JS: Start the quickstart -&gt; Press the submit buttons -&gt; See the secured page with https!Deactivates JS: (NoScript Firefox Plugin): Start the quickstart -&gt; Press the submit buttons -&gt; See the secured page BUT with HTTP!There was no proper https redirect.If I change the rendering strategy to REDIRECT_TO_BUFFER everything works fine  but if I change the strategy to ONE_PASS_RENDER the https forwarding does't work anymore. But only if I deactivate all scripts...Regards Dmitriy,0,1
Ajax indicator not working when display is set to none in css,I created a simple quickstart with one AjaxLink and one div used as ajax indicator (id ajax_indicator). When I set display: none to ajax_indicator in css  is does not show up when pressing link. When I remove display:none from css  it disappears after when ajax request is finished and works fine for next ajax requests.,0,0
Inefficient DefaultPageStore.SerializedPagesCache,We have identified some problems in org.apache.wicket.pageStore.DefaultPageStore.SerializedPagesCache.Some history first: At https://cwiki.apache.org/confluence/display/WICKET/Page+Storage I have explained how the page storage management works in Wicket 1.5+ In brief:First level cache/store is the HttpSession - here Wicket saves the live instances of all touched pages in the last request cycle.Second level cache/store is DefaultPageStore.SerializedPagesCache - here Wicket saves the last N (org.apache.wicket.settings.StoreSettings#getInmemoryCacheSize) used pages in the whole application (by default 40 pages)Third level cache/store is DiskDataStore - here Wicket stores all pages and depending on org.apache.wicket.settings.StoreSettings#getMaxSizePerSession it will 'recycle' the file contentsThe identified problems: org.apache.wicket.pageStore.DefaultPageStore.SerializedPagesCache uses ArrayList as a data structure to keep SerializedPage instances. When the limit N (StoreSettings#getInmemoryCacheSize) is reached the ArrayList uses #remove() to remove the oldest entry. The #remove(0) operation internally uses System.arraycopy() to compact the internal array structure. As you already realize this ArrayList is constantly being recompacted in any application in production. DefaultPageStore.SerializedPagesCache#cache (the same ArrayList) is used as synchronization monitor for every operation (read/write/remove). I.e. we have synchronization on application level !! at the moment DefaultPageStore.SerializedPagesCache stores org.apache.wicket.pageStore.DefaultPageStore.SerializedPage. This is a structure of {String sessionId  int pageId  byte[] data}.Since this data is stored in the application scope it is never replicated  so there is no need to serialize the live page instance to byte[] at all. Only the third level cache (IDataStore) should work with byte[]A workaround to avoid the slowness caused by this is to set 0 or negative value to org.apache.wicket.settings.StoreSettings#setInmemoryCacheSize,0,1
Allow models of subtypes of Select type parameter in SelectOption constructor,SelectOption's use of the model is read only  so no risk problem if we use an IModel&lt;? extends T&gt; instead of IModel&lt;T&gt;,0,0
Add WebSocketBehavior/Resource#onPush() callback method,A user reported that WebSocketBehavior misses #onPush() callback method and #onEvent() has to be overridden to be able to process IWebSocketPushMessages.,0,0
NPE calling PackageResource.getResourceStream() if there is no RequestCycle defined,From my email on the list:Since the introduction of the ProcessingResourceStream  it's notpossible to call PackageResource.getResourceStream() anymore if thereis no RequestCycle defined.Typically  we call it in our Application init() to prepare (mostlypreprocess and cache) a couple of resources before opening theapplication to the public.We now have a NPE here:https://github.com/apache/wicket/blob/master/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResource.java#L496This problem was introduced by this commit:https://github.com/apache/wicket/commit/29b26ffffdd619f4e2fe86aa2d2b02ff3e1d6017#diff-428db8d5278d2ac567e471efd377c7c7Thanks.,0,0
Intern strings generated by Wicket that have bigger chance to be duplicated,I've been doing some performance measurements recently and I've noticed that Wicket produces some higher number of String objects like: small numbers ('1'  '2'  '3'  ...) generated from repeaters' String.valueOf(nextId) HTML element names/attributes ('span'  'div'  ...) generated in XmlTag#getName  #getAttribute  ...We can reduce memory usage for those by using String#intern().Since Java 7 the interned strings are stored in the Heap memory so this won't affect negatively the perm generation.Interned strings are GC-ed so this is also not a concern.http://java-performance.info/string-intern-in-java-6-7-8/ provides good explanation how to avoid the CPU penalty caused by String#intern() if needed.,0,1
continueToOriginalDestination() fails after redirectToInterceptPage() on AjaxRequest,Consider the following requests: user clicks link on HomePage wicket-ajax.js sends ajax request to AjaxLink HomePage redirects to InterceptPage user clicks link on InterceptPage request (ajax or normal) is sent to InterceptPage InterceptPage continues to original destination with redirect original Ajax request is sent by the browser and not by wicket-ajax.js Wicket AjaxRequest renders the responseThe resulting &lt;ajax-response/&gt; is rendered in the browser :/.,0,0
AbstractAutoCompleteBehavior.WrappedHeaderItem should depend on wicket-ajax.js,Classorg.apache.wicket.extensions.ajax.markup.html.autocomplete.AbstractAutoCompleteBehavior.WrappedHeaderItem inherits empty list from HeaderItem in public Iterable&lt;? extends HeaderItem&gt; getDependencies() { return Collections.emptyList(); }Using JavaScriptFilteredIntoFooterHeaderResponse causes renderingWicket.Event.add(window  'domready'  function(event) { new Wicket.AutoComplete(before jQuery refrence.Please  add JQueryResourceReference (other if needed) into dependency list of org.apache.wicket.extensions.ajax.markup.html.autocomplete.AbstractAutoCompleteBehavior.WrappedHeaderItem,0,0
Don't cache the result of AuthenticatedWebApplication#getWebSessionClass(),Currently the AuthenticatedWebApplication constructor obtains and holds a reference to the AbstractAuthenticatedWebSession class. This makes it impossible for classes extending AuthenticatedWebApplication to use a class based upon something passed into their constructors. The only option is to provide a 'static'/'constant' class from the getWebSessionClass() method.I don't see any advantage to holding this reference. Instead I propose that the class is changed to simply calling getWebSessionClass() each time the class is needed.,0,0
Autolinking does not always work in inheritted markup,If you have auto-linked auto components that point to package resource  like:&lt;wicket:link&gt;&lt;img src='myimage.png'/&gt;&lt;/wicket:link&gt;defined in the grandparent markup  where the grandparent and parent are from different packages  then they do get rendered correctly.Problem is this: AutoLinkResolver checks that the package resource actually exists. It checks by creating a PackageResourceReference and attempts to get the reference from that. The class used as the context for the PackageResourceReference is the class which owns the markup in which the auto-link appeared. The key is the original reference (href or src) in the tag. So far everything is correct.Wicket knows which class owned the markup by using ComponentTag#getMarkupClass(). It is therefore important that ComponentTag#getMarkupClass() always returns the correct class. But it doesn't.When we have a three level merged markup (child  parent  grandparent)  this happens: parent markup is merged into grandparent using MergedMarkup. All ComponentTags that were originally from grandparent are called :#setMarkupClass(GrandParent.class)  so that they will know they came from the grandparent. So far so good.Now  in order to get the child markup stream  we merge child markup onto the parent markup. Now  all ComponentTags in the parent markup are setMarkupClass(Parent.class). Problem is  this is not true. Some of these ComponentTags actually came from the grandparent  so the ComponentTag ends up returning the incorrect class (Parent.class instead of GrandParent.class) in #getMarkupClass().Because ComponentTag#getMarkupClass() can return the wrong value  if the Parent and GrandParent are in different packages  then a resource that would be loadable by the grandparent is no longer loadable  because we are using the parent  which cannot find it.Solution  fix MergedMarkup to only setMarkupClass() if getMarkupClass() == null.,0,0
Upgrade wicket-atmosphere to the latest version of atmosphere,Wicket-atmosphere should be upgraded to atmosphere 2.1.4 and js 2.1.6. It's guava dependency to 17.0,0,0
AjaxButton #onSubmit() #onError() intricacies,Overriding AjaxButton's hook #onSubmit() is prone to possible programming errors: with JavaScript enabled  #onSubmit() will not be called  leaving the developer without clue that the wrong method was overwritten with JavaScript disabled  #onSubmit(ART  Form) will not be called - furthermore if the markup includes type='submit' or no type attribute  #onSubmit() will be called instead.#onError() and #onError(ART  Form) have identical intricacies.To make things consistent I propose the following change for Wicket 7.x: declare #onSubmit() and #onError() final on AjaxButton in #onComponentTag() make sure the &lt;button&gt;-Tag has type='button'  so the browser does not submit the form when JavaScript is disabled. For fallack support we have AjaxFallbackButton already.Any objections or better ideas?,0,0
Atmosphere: updates infinitly with long polling transport,I found a problem when I use long polling for the transport :When the EventBus loop to the list of AtmosphereResource (on post method) and if the update is too long of each AtmosphereResource  the list of AtmosphereResource is update and reorder (because atmosphere remove and registry the AtmosphereResource due to long polling) and then the loop on EventBus never stop and update is infinitie.To solve the probleme I do that on line 366 of EventBus.java :for (AtmosphereResource resource : ImmutableList.copyOf(broadcaster.getAtmosphereResources()))rather thanfor (AtmosphereResource resource : broadcaster.getAtmosphereResources())Best regards,0,1
SelectOptions with #setRecreateChoices(true) loses selection on form errors,Having SelectOptions#setRecreateChoices(true)  on every render each choice is represented by a new SelectOption instance with a new UUID.If the form has submit errors  no UUID will match the RAW-Input of the Select. Thus the selection is lost.,0,0
Add AjaxChannel.DEFAULT constant = '0' and type 'Queue',Can I request AjaxChannel.DEFAULT public static constant with a value of '0' ? I don't feel comfortable typing '0' there  I much prefer a constant. http://apache-wicket.1842946.n4.nabble.com/ListenerInvocationNotAllowedException-and-EmptyRequestHandler-tp4663618p4666126.html,0,0
CLONE - ModalWindow is not visible in Safari when opened from a link at the bottom of a large page,I am not able to see a ModalWindow in Safari and I expect to see it centered on my view port.Steps:1. Start with a large web page with a link to open the ModalWindow at the bottom of the page. You need a large page where you have to scroll down to find the link.2. Click the link3. Observe that the mask for the ModalWindow displays  but the ModalWindow does not. Scrolling back up  re-sizing  and maximizing will still not display the ModalWindow.,0,0
Remove second  for CDI related stuff in wicket-examples' web.xml,Trying to deploy wicket-examples.war (7.0) in Tomcat 7/8 fails with:3-Jun-2014 10:28:09.485 SEVERE &#91;localhost-startStop-1&#93; org.apache.catalina.core.StandardContext.listenerStart Exception sending context initialized event to listener instance of class org.jboss.weld.environment.servlet.BeanManagerResourceBindingListener java.lang.RuntimeException: Could not bind BeanManager reference to JNDI: Context is read only If the naming context is read-only  you may need to use a configuration tobind the BeanManager instead  such as Tomcat's context.xml or Jetty's jetty-web.xml. at org.jboss.weld.environment.servlet.BeanManagerResourceBindingListener.contextInitialized(BeanManagerResourceBindingListener.java:84) at org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:4739) .....,0,0
Do not throw when WebSocket is not supported,When the browser does not support WebSocket  /wicket-websocket-jquery.js throws an 'is not supported' string from the initialize() method  which runs in the DOM ready event. This break any other initialization of the page that takes place after the WebSocket initialization  leading to less than graceful degradation of functionality.,0,0
ConcatBundleResource#reportError() doesn't print the resource attributes,org.apache.wicket.resource.bundles.ConcatBundleResource#reportError() prints just the scope and the name of the missing resource.It will be much more useful if the attributes (locale  style and variation) are printed too.,0,0
Allow submitting with POST method for PhantomJS,With the PhantomJS browser form submit is done using get instead of post due to change &#91;1&#93; since 6.12.0This is incorrect and fails with larger requests  PhantomJS only allows a limited get request size. For PhantomJS post must be used as for other browsers.&#91;1&#93; https://git-wip-us.apache.org/repos/asf?p=wicket.git;a=commitdiff;h=f0b251e3,0,0
Fix the encoding of the Chinese translations for Wizard component,Reported on the users@ mailing lists: http://markmail.org/message/wbdffw5llrxfjqlq,0,0
CheckingOutputObjectStream should filter duplicates by identity  not by equality,As discussed at http://markmail.org/message/kdbyimrznubgtz5n the checks for duplicates by equality is not correct (and optimal).CheckingOOS already filters checked objects by identity (see org.apache.wicket.core.util.objects.checker.CheckingObjectOutputStream#checked) so there is no need to check second time (via Stack#equals()).,0,0
WebPageRenderer should bind a Session if redirect is required and the session is temporary.,WebApplication.storeBufferedResponse does not check if sessionId is null. This could lead to wrong behaviors as it happens in the quickstart project. Let's say we have a stateless home page with page parameters that are populated inside page constructor. Under these conditions class WebPageRenderer will call storeBufferedResponse and will redirect the response to the final URL (line 289). But as the session is temporary  the buffered response is not consumed and WebPageRenderer will rise a warning (line 194).I think we should check for null sessionId inside WebApplication or inside WebPageRender.,0,0
Allow subclasses of ComponentStringResourceLoader to stop at specific components,Sometimes is desirable to stop loading of string resources at a specific component  e.g. to limit overriding of keys to parts of the web page.An additional hook-method in ComponentStringResourceLoader would allow subclasses to implement this without duplicating parental logic.,0,0
missing generic cast causes compile error on OS X / jdk 8,when trying to compile wicket-7 from HEAD it fails under OS X / JDK 1.8.0_11. Casting a NULL to generic type (T) solves the issues. This seems like some odd case of failing type inference.The problematic source line is: return getEnumImpl(key  eClass  null);The compiler error is: Error:(792  35) java: incompatible types: inference variable T has incompatible upper bounds java.lang.Enum&lt;T&gt; TThis will fix the issue: return getEnumImpl(key  eClass  (T)null);I found that there is a fix WICKET-5427 which does not work in most current JDK 1.8.0_11 anymore. -Could not change the wicket-6 branch since the change will break the clirr plugin (see WICKET-5427).-,0,0
Problem with setting of IComponentInheritedModel and FLAG_INHERITABLE_MODEL,Described in the mailing list:http://mail-archives.apache.org/mod_mbox/wicket-users/201407.mbox/%3CCAF2_608c8TOZjprV8Md15KJpRET6YQdXHe%3DwRzF-y5G_zAXcDg%40mail.gmail.com%3EI'm aware of the another issue (https://issues.apache.org/jira/browse/WICKET-3413) which dealt with the exact same code - and I believe there was a mistake in the solution that leads to this issue.Please see the attached quickstart (including a JUnit test) to reproduce the error.,0,0
PropertyResolver does not scan for NotNull in annotation tree,When annotating a field of a bean with e.g. org.hibernate.validator.constraints.NotEmpty  this impliesjavax.validation.constraints.NotNull  but PropertyValidator only checks for the annotations immediately on the filed not the tree of annotations. As a result Wicket does not mark the field as required in the UI  which it should.Also PropertyResolver.findNotNullConstraints() is not even protected  so cannot be patched in a simple way.So as a solution I suggest changing findNotNullConstraints() to be protected and rather be something like findConstraints(filter)  or findConstraints(clazz)  and then in that method method recursively invoking getComposingConstraints to get all constraints  but collecting only those of interest. Possibly some care needs to be taken to prevent infinite recursion where constraints are composed of each other (if that compiles).,0,0
wicket-autocomplete may fail after preceeding Ajax request,The following processing sequence leads to a JavaScript error: form is shown including an autoCompleteTextField user enters criteria and immediately presses enter actualUpdateChoices() is scheduled by the throttler form is submitted via ajax autoCompleteTextField is removed from DOM throttler executes actualUpdateChoices() wicket-autocomplete fails with precondition  since element is no longer in DOM: var elementVal = Wicket.$(elementId).value;,0,0
Add a setting to MultiFileUploadField to not close the file uploads' streams,As explained at http://markmail.org/message/hdde56myxso5cwgy MultiFileUploadField should provide a setting that decides whether its file uploads should close their streams at the end of the request cycle.,0,0
Rename log4j.properties in the quickstart when creating a project for WildFly,As discovered at http://markmail.org/message/wlm4tjvmn62j3cit Wicket Quickstart should remove log4j.properties from the generated project when it will be deployed at WildFly (JBoss 8).maven-archetype-plugin supports special names (e.g. _something_) for files in the fileSet which can be renamed by using system properties.Using this we can rename _log4j.properties_ to log4j.properties by default and to wildfly-doesnt-need-log4j.properties when WildFly is selected from an additional drop-down at http://wicket.apache.org/start/quickstart.html,0,0
Form#findSubmittingComponent() should not throw exceptions if the submitter is disabled/invisible,As explained by a user at http://markmail.org/message/s262q4yc3ubymglr it is unexpected that org.apache.wicket.markup.html.form.Form#findSubmittingButton() throws runtime exceptions when the submitter is invisible or disabled.As discussed at http://markmail.org/message/qhjepkihr27uywaj the checks should be moved to the code related to executing the submitter's action method (i.e. onSubmit()) and leave all other users of Form#findSubmittingButton() decide for themselves whether the change of the visiblility/enable state is a problem of not.,0,0
RenderStrategy REDIRECT_TO_RENDER lets fail test with BaseWicketTester#startComponentInPage,After changing the RenderStrategy from REDIRECT_TO_BUFFER to REDIRECT_TO_RENDER tests with BaseWicketTester#startComponentInPage fail.Stacktrace:org.apache.wicket.markup.MarkupNotFoundException: Can not determine Markup. Component is not yet connected to a parent. &#91;Page class = org.apache.wicket.util.tester.BaseWicketTester$StartComponentInPage  id = 0  render count = 1&#93; at org.apache.wicket.Component.getMarkup(Component.java:749) at org.apache.wicket.util.tester.BaseWicketTester$StartComponentInPage.getMarkup(BaseWicketTester.java:1453) at org.apache.wicket.Component.internalRender(Component.java:2309) at org.apache.wicket.Component.render(Component.java:2272) at org.apache.wicket.Page.renderPage(Page.java:1024) at org.apache.wicket.request.handler.render.WebPageRenderer.renderPage(WebPageRenderer.java:122) at org.apache.wicket.request.handler.render.WebPageRenderer.respond(WebPageRenderer.java:221) at org.apache.wicket.util.tester.BaseWicketTester$LastPageRecordingPageRendererProvider$1.respond(BaseWicketTester.java:2657) at org.apache.wicket.core.request.handler.RenderPageRequestHandler.respond(RenderPageRequestHandler.java:175) at org.apache.wicket.request.cycle.RequestCycle$HandlerExecutor.respond(RequestCycle.java:862) at org.apache.wicket.request.RequestHandlerStack.execute(RequestHandlerStack.java:64) at org.apache.wicket.request.cycle.RequestCycle.execute(RequestCycle.java:261) at org.apache.wicket.request.cycle.RequestCycle.processRequest(RequestCycle.java:218) at org.apache.wicket.request.cycle.RequestCycle.processRequestAndDetach(RequestCycle.java:289) at org.apache.wicket.util.tester.BaseWicketTester.processRequest(BaseWicketTester.java:654) at org.apache.wicket.util.tester.BaseWicketTester.processRequest(BaseWicketTester.java:712) at org.apache.wicket.util.tester.BaseWicketTester.processRequest(BaseWicketTester.java:593) at org.apache.wicket.util.tester.BaseWicketTester.startPage(BaseWicketTester.java:818) at org.apache.wicket.util.tester.BaseWicketTester.startPage(BaseWicketTester.java:835) at org.apache.wicket.util.tester.BaseWicketTester.startComponentInPage(BaseWicketTester.java:1387) at org.apache.wicket.util.tester.BaseWicketTester.startComponentInPage(BaseWicketTester.java:1317) at org.foo.StatelessTest.testComponents(StatelessTest.java:97),0,0
Nested Redirects and REDIRECT_TO_BUFFER,When the render strategy is REDIRECT_TO_BUFFER  redirects cannot be nested. After the second redirect  Wicket renders the buffered first page in preference to the second page. The relevant code is in WebPageRenderer.respond: if (bufferedResponse != null) { logger.warn('The Buffered response should be handled by BufferedResponseRequestHandler'); // if there is saved response for this URL render it bufferedResponse.writeTo((WebResponse)requestCycle.getResponse()); }The attached quickstart demonstrates the issue. Simply navigate to the home page. The observed behavior is that Page1 is displayed  but I expect Page2 to be displayed.I can work around the issue by calling WebApplication.getAndRemoveBufferedResponse() to clear the render buffer  but I am uneasy with this solution since it seems like I am playing with Wicket internals; albeit the function is public.,0,0
Add WicketTester assertion methods for component's markup style  variation and locale,From the users@ mailing list: http://markmail.org/message/r4q5h566novcwakgAdd methods to WicketTester to be able to assert that a given component in the last rendered page (or even the page itself) has been rendered with a markup with a given variation (or style  or locale).,0,0
Use Log4j 2.x for the archetype,Apache Log4j 2 is out since a while.It is similar in functionality to SLF4J + Logback now.Let's upgrade the quickstart from Log4j 1.2.17 to latest 2.x.,0,0
ResourceUtils.getLocaleFromFilename cannot handle filenames with classifiers,When I try to get PathLocale with ResourceUtils  than get wrong values  when the files contains '.' in name.Example: 'jquery.test.js' PathLocale.path=jquery  PathLocale.locale = nullor jquery.test_hu.js'.PathLocale.path=jquery  PathLocale.locale = nullThat's why I'd like to use jquery.test_hu.js' as resource  the ResourceStreamLocator try to find jquery.test_hu_hu_HU.js  jquery.test_hu_hu.js  and after jquery.test_hu.js.Because the ResourceStreamLocator.locate PathLocale data = ResourceUtils.getLocaleFromFilename(path); if ((data != null) &amp;&amp; (data.locale != null)) { path = data.path; locale = data.locale; }doesn't work in this case.Should change the ResourceUtils public static PathLocale getLocaleFromFilename(String path) { int pos = path.indexOf('.');----------------To int pos = path.lastIndexOf('.');,0,0
StringValidator should set 'minlength' attribute to input and textarea,At the moment StringValidator sets 'maxlength' to input elements.According to http://www.w3.org/TR/html5/forms.html#the-maxlength-and-minlength-attributes maxlength could be set also to textarea elements.And there is 'minlength' attribute that could also be set automatically by Wicket.,0,0
OnChangeAjaxBehavior should listen for both 'inputchange' and 'change' events for TextField and TextArea,WICKET-5603 introduced a regression that a TextField using OnChangeAjaxBehavior doesn't work anymore when used as date picker  or Select2.The problem is that usually extensions like DatePicker and Select2 will fire 'change' event when they update the text input.OnChangeAjaxBehavior should use both 'inputchange' and 'change' events for TextField and TextArea components.,0,0
SecuritySettings.setEnforceMounts() does not work when the mounted mapper is not in the root compound mapper,BookmarkableMapper.isPageMounted() assumes that all mounted mappers are in Application.getRootRequestMapperAsCompound(). Sometimes the mappers make a tree structure  with multiple compounds existing  sometimes separated by wrappers  like HttpsMapper and CryptoMapper.Because of this  BookmarkableMapper fails to realise that a page is mounted and so does not enforce mounting.,0,0
MockHttpServletRequest.buildRequest() should work for parameters with multiple values with multipart content type,The following code in the method MockHttpServletRequest.buildRequest() iterates over all values of a parameter. When writing the value to the outputstream it doesn't use the iteration variable  but instead retrieves the value with 'post.getParameterValue(parameterName)' which always returns the first element of the list. List&lt;StringValue&gt; values = post.getParameterValues(parameterName); for (StringValue value : values) { newAttachment(out); out.write('; name=/''.getBytes()); out.write(parameterName.getBytes()); out.write('/''.getBytes()); out.write(crlf.getBytes()); out.write(crlf.getBytes()); out.write(post.getParameterValue(parameterName).toString().getBytes()); out.write(crlf.getBytes()); }So for a given list of values '3'  '2' and '1'  it actually writes '3'  '3' and '3'.,0,0
wicket-autocomplete prevents 'change'-listener when leaving input via mouse click,wicket-autocomplete's ignoreChange is true initially  this prevents 'change' events being fired when the user enters something and then clicks somewhere else,0,0
Upgrade Atmosphere to 2.2.2,Wicket-atmosphere should be upgraded to the latest version of Atmosphere.,0,0
Component queuing breaks with html tags that don't require close tag.,Component queuing try to skip to close tag also for those tags that don't have one. This leads to a EmptyStackException (see ArrayListStack#peek).,0,0
Avoid using input names that conflict with JavaScript DOM API method and attribute names,If you use input names that conflict with JavaScript DOM API method and attribute names the ability to use the DOM method/attribute on the form element is hampered.For example  JQuery stops working if you have a form control with input name 'nodeName' (&lt;select name='nodeName'&gt;).This is because form.nodeName is no longer a string  but is a element. JQuery expects element.nodeName to return a string and exceptions ensue.,0,1
Dequeue auto component can't resolve components if they are nested in child markup,If a container has an auto component (ex: enclouse) in its markup but this later is nested inside a child  the autocomponent won't be resolved if child is a IQueueRegion. For example (taken from quickstart): &lt;span wicket:id='myBorder'&gt; bar &lt;wicket:enclosure&gt; &lt;span wicket:id='c'&gt;c&lt;/span&gt; &lt;/wicket:enclosure&gt; &lt;/span&gt;,0,0
ContextNotActiveException thrown when using both CDI & Native WebSocket,Native Websockets does not works anymore while used in conjunction with CDI. Repro step are quite simple  please see attached quickstart.WARN &#91;RequestCycleExtra&#93; Handling the following exception: org.jboss.weld.context.ContextNotActiveException: WELD-001303: No active contexts for scope type javax.enterprise.context.RequestScoped at org.jboss.weld.manager.BeanManagerImpl.getContext(BeanManagerImpl.java:680) &#91;weld-core-impl-2.1.2.Final.jar:2014-01-09 09:23&#93; at org.jboss.weld.bean.proxy.ContextBeanInstance.getInstance(ContextBeanInstance.java:79) &#91;weld-core-impl-2.1.2.Final.jar:2014-01-09 09:23&#93; at org.jboss.weld.bean.proxy.ProxyMethodHandler.invoke(ProxyMethodHandler.java:99) &#91;weld-core-impl-2.1.2.Final.jar:2014-01-09 09:23&#93; at org.jboss.weld.proxies.Conversation$795552506$Proxy$_$$_WeldClientProxy.getId(Unknown Source) &#91;weld-core-impl-2.1.2.Final.jar:&#93; at org.apache.wicket.cdi.ConversationPropagator.onRequestHandlerResolved(ConversationPropagator.java:107) &#91;wicket-cdi-1.1-7.0.0-20141021.124705-313.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.request.cycle.RequestCycleListenerCollection$5.notify(RequestCycleListenerCollection.java:155) &#91;wicket-core-7.0.0-20141021.124144-486.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.request.cycle.RequestCycleListenerCollection$5.notify(RequestCycleListenerCollection.java:151) &#91;wicket-core-7.0.0-20141021.124144-486.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.util.listener.ListenerCollection.notify(ListenerCollection.java:80) &#91;wicket-util-7.0.0-20141021.123902-532.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.request.cycle.RequestCycleListenerCollection.onRequestHandlerResolved(RequestCycleListenerCollection.java:150) &#91;wicket-core-7.0.0-20141021.124144-486.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.request.cycle.RequestCycleListenerCollection$5.notify(RequestCycleListenerCollection.java:155) &#91;wicket-core-7.0.0-20141021.124144-486.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.request.cycle.RequestCycleListenerCollection$5.notify(RequestCycleListenerCollection.java:151) &#91;wicket-core-7.0.0-20141021.124144-486.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.util.listener.ListenerCollection.notify(ListenerCollection.java:80) &#91;wicket-util-7.0.0-20141021.123902-532.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.request.cycle.RequestCycleListenerCollection.onRequestHandlerResolved(RequestCycleListenerCollection.java:150) &#91;wicket-core-7.0.0-20141021.124144-486.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.request.cycle.RequestCycleListenerCollection$5.notify(RequestCycleListenerCollection.java:155) &#91;wicket-core-7.0.0-20141021.124144-486.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.request.cycle.RequestCycleListenerCollection$5.notify(RequestCycleListenerCollection.java:151) &#91;wicket-core-7.0.0-20141021.124144-486.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.util.listener.ListenerCollection.notify(ListenerCollection.java:80) &#91;wicket-util-7.0.0-20141021.123902-532.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.request.cycle.RequestCycleListenerCollection.onRequestHandlerResolved(RequestCycleListenerCollection.java:150) &#91;wicket-core-7.0.0-20141021.124144-486.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.request.cycle.RequestCycle.execute(RequestCycle.java:264) &#91;wicket-core-7.0.0-20141021.124144-486.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.request.cycle.RequestCycle.processRequest(RequestCycle.java:222) &#91;wicket-core-7.0.0-20141021.124144-486.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.request.cycle.RequestCycle.processRequestAndDetach(RequestCycle.java:293) &#91;wicket-core-7.0.0-20141021.124144-486.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.protocol.ws.api.AbstractWebSocketProcessor.broadcastMessage(AbstractWebSocketProcessor.java:219) &#91;wicket-native-websocket-core-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.protocol.ws.api.AbstractWebSocketProcessor.onClose(AbstractWebSocketProcessor.java:157) &#91;wicket-native-websocket-core-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT&#93; at org.apache.wicket.protocol.ws.javax.WicketEndpoint.onClose(WicketEndpoint.java:71) &#91;wicket-native-websocket-javax-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT&#93; at io.undertow.websockets.jsr.UndertowSession.close(UndertowSession.java:181) &#91;undertow-websockets-jsr-1.0.15.Final.jar:1.0.15.Final&#93; at io.undertow.websockets.jsr.ServerWebSocketContainer.close(ServerWebSocketContainer.java:464) &#91;undertow-websockets-jsr-1.0.15.Final.jar:1.0.15.Final&#93; at io.undertow.websockets.jsr.Bootstrap$WebSocketListener.contextDestroyed(Bootstrap.java:82) &#91;undertow-websockets-jsr-1.0.15.Final.jar:1.0.15.Final&#93; at io.undertow.servlet.core.ApplicationListeners.contextDestroyed(ApplicationListeners.java:185) &#91;undertow-servlet-1.0.15.Final.jar:1.0.15.Final&#93; at io.undertow.servlet.core.DeploymentImpl.destroy(DeploymentImpl.java:224) &#91;undertow-servlet-1.0.15.Final.jar:1.0.15.Final&#93; at io.undertow.servlet.core.DeploymentManagerImpl.undeploy(DeploymentManagerImpl.java:572) &#91;undertow-servlet-1.0.15.Final.jar:1.0.15.Final&#93; at org.wildfly.extension.undertow.deployment.UndertowDeploymentService.stopContext(UndertowDeploymentService.java:119) at org.wildfly.extension.undertow.deployment.UndertowDeploymentService.stop(UndertowDeploymentService.java:101) at org.jboss.msc.service.ServiceControllerImpl$StopTask.stopService(ServiceControllerImpl.java:2056) at org.jboss.msc.service.ServiceControllerImpl$StopTask.run(ServiceControllerImpl.java:2017) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) &#91;rt.jar:1.7.0_65&#93; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) &#91;rt.jar:1.7.0_65&#93; at java.lang.Thread.run(Thread.java:745) &#91;rt.jar:1.7.0_65&#93;Thanks &amp; best regards Sebastien,0,0
Atmosphere Eventbus throws Concurrent Modification Exception,As already commented in WICKET-5619 the problem of Concurrent Modification Exceptions are still valid like you can see on the following description when the exception occurs:You have multiple users surfing a page (Page A) which has subscribes for an event (Event A). Now a user (User A) does an action which triggers the Event A to get posted to the Eventbus. While the eventbus posts the event to the registered listeners  a User B leaves the page and unregisters for the event  f.e because he now want's surfs another page  which does not subscribe to the event. Now the ConcurrentModificationException occurs because the unregistering of User B changed the list of listeners while the eventbus is still posting the event to the different listeners. The interesting thing is  that not the initial starter of the event crashes  but all other users which are trying to surf other pages which are listening on the event gets the exception.In my opinion this issue can be solved if the line:  Collection&lt;EventSubscription&gt; eventSubscriptions = subscriptions.get(key);subscriptionsForPage = Iterables.filter(eventSubscriptions  new EventFilter(event)); makes an copy of the EventSubscriptions an works on this copy instead on the original list. When the eventbus now trys to post the event on a component which does not exists anymore he could try to unregister the component from the original subscribers list. Also:Iterable&lt;EventSubscription&gt; subscriptionsForPage; synchronized (this) { key = trackedPages.get(resource.uuid()); Collection&lt;EventSubscription&gt; eventSubscriptions = subscriptions.get(key); subscriptionsForPage = Iterables.filter(eventSubscriptions  new EventFilter(event)); }creates a lazy iterator on the the eventSubscriptions  and will be iterated outside the synchronized block.You need to create a copy of the eventSubscriptions  because this might be changed during the unregistering process:public synchronized void unregister(Component component) { ... Collection&lt;EventSubscription&gt; subscriptionsForPage = subscriptions.get(pageKey); Iterator&lt;EventSubscription&gt; it = subscriptionsForPage.iterator(); while (it.hasNext()) { if (it.next().getComponentPath().equals(componentPath)) it.remove(); } }it.remove() changes the iterator within the lazy Iterator!It is possible to have a quick look at it? This problem affected our productive system!,0,1
Log a warning when WebSocketResponse#sendError() is used,As discussed at http://markmail.org/message/x6xj4l2vo6iijan5 it will be better to log the passed error code and message instead of throwing unsupported exception.Additionally it will be good to provide a factory method for the WebSocketResponse so the application can write a proper error response in its own format to the client if needed.,0,0
Add a factory method for WebSocketRequestHandler,Add a new factory method to WebSocketSettings for creating instances of WebSocketRequestHandler.,0,0
Wicket Ajax Click handling gets requeued in OnDomReady so fire out of order,While debugging some jquery script ordering  we noticed the following and I'm looking for views on why this is done and/or if it's a bug:1. Wicket assembles all ajax click handlers and writes them out into a single Wicket.Event.add(window 'domready' function(event) { .... script invocation written in to the &lt;head&gt; element of the page.2. For things like click handlers  Wicket writes out Wicket.Ajax.ajax( {'c': 'selection4e2'  'u':'.....'  'm':'POST'}) calls that execute within the onDomReady function defined in (1)3. This invocation of (2) in turn invokes jquery( fn ); This requeues the function invocation at the back of the jquery event queue for onDomReady processing4. Any custom scripts that we added using OnDomReadyHeaderItem  regardless of where we put them on the page after the standard Wicket click handler JS  are now invoked  according to page order.5. The re-queued functions from (3) now execute after my custom scripts. These custom scripts modify the DOM (table paging/filtering etc) and this mechanism now results in Wicket JS errors since the Wicket click handler binding fail to find the required elements in the DOM.Is this re-queueing intentional  and is there a reason that we couldnt just execute the click handler additions in step (1) rather than re-queuing the JS call?A workaround for this is to wrap all of our application JS functions in a separate jQuery( ... ) invocation  so that we can requeue all of our functions after all the requeued Wicket ones. It works  but we dont understand the need for Wicket to perform this requeueing instead of just executing the function as and where defined on the page.,0,0
NullPointerException in IntHashMap,I was looking through a tester's log file to track down a separate issue. I came across a NullPointerException with IntHashMap  apparently when the server was shutting down.See also WICKET-5584  which also deals with a NullPointerException with IntHashMap  and also seems to relate to a null modCount (judging by the line number).INFO (ExampleServer) [2014-11-06 00:49:24 979] - com.example.server.ExampleServer.stopServer(ExampleServer.java:268): Stopping server.INFO (ServerConnector) [2014-11-06 00:49:24 982] - org.eclipse.jetty.server.AbstractConnector.doStop(AbstractConnector.java:306): Stopped ServerConnector@3b7d3a38{HTTP/1.1}{0.0.0.0:8099}INFO (Application) [2014-11-06 00:49:24 983] - org.apache.wicket.Application.destroyInitializers(Application.java:588): [org.apache.wicket.protocol.http.WicketFilter-55b0dcab] destroy: Wicket core library initializerINFO (Application) [2014-11-06 00:49:24 983] - org.apache.wicket.Application.destroyInitializers(Application.java:588): [org.apache.wicket.protocol.http.WicketFilter-55b0dcab] destroy: Wicket extensions initializerERROR (DiskDataStore) [2014-11-06 00:49:24 988] - org.apache.wicket.pageStore.DiskDataStore.saveIndex(DiskDataStore.java:282): Couldn't write DiskDataStore index to file C:/Windows/SERVIC~2/NETWOR~1/AppData/Local/Temp/org.apache.wicket.protocol.http.WicketFilter-55b0dcab-filestore/DiskDataStoreIndex.java.lang.NullPointerException at org.apache.wicket.util.collections.IntHashMap$HashIterator.&lt;init&gt;(IntHashMap.java:777) at org.apache.wicket.util.collections.IntHashMap$EntryIterator.&lt;init&gt;(IntHashMap.java:871) at org.apache.wicket.util.collections.IntHashMap$EntryIterator.&lt;init&gt;(IntHashMap.java:871) at org.apache.wicket.util.collections.IntHashMap.newEntryIterator(IntHashMap.java:896) at org.apache.wicket.util.collections.IntHashMap$EntrySet.iterator(IntHashMap.java:1055) at org.apache.wicket.util.collections.IntHashMap.writeObject(IntHashMap.java:1128) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:483) at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:988) at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1496) at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348) at java.util.HashMap.internalWriteEntries(HashMap.java:1777) at java.util.HashMap.writeObject(HashMap.java:1354) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:483) at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:988) at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1496) at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348) at org.apache.wicket.pageStore.DiskDataStore.saveIndex(DiskDataStore.java:274) at org.apache.wicket.pageStore.DiskDataStore.destroy(DiskDataStore.java:106) at org.apache.wicket.pageStore.AsynchronousDataStore.destroy(AsynchronousDataStore.java:118) at org.apache.wicket.pageStore.AbstractPageStore.destroy(AbstractPageStore.java:53) at org.apache.wicket.pageStore.AbstractCachingPageStore.destroy(AbstractCachingPageStore.java:102) at org.apache.wicket.page.PageStoreManager.destroy(PageStoreManager.java:437) at org.apache.wicket.Application.internalDestroy(Application.java:659) at org.apache.wicket.protocol.http.WebApplication.internalDestroy(WebApplication.java:607) at org.apache.wicket.protocol.http.WicketFilter.destroy(WicketFilter.java:605) at org.eclipse.jetty.servlet.FilterHolder.destroyInstance(FilterHolder.java:173) at org.eclipse.jetty.servlet.FilterHolder.doStop(FilterHolder.java:151) at org.eclipse.jetty.util.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:89) at org.eclipse.jetty.util.component.ContainerLifeCycle.stop(ContainerLifeCycle.java:143) at org.eclipse.jetty.util.component.ContainerLifeCycle.doStop(ContainerLifeCycle.java:162) at org.eclipse.jetty.server.handler.AbstractHandler.doStop(AbstractHandler.java:73) at org.eclipse.jetty.servlet.ServletHandler.doStop(ServletHandler.java:230) at org.eclipse.jetty.util.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:89) at org.eclipse.jetty.util.component.ContainerLifeCycle.stop(ContainerLifeCycle.java:143) at org.eclipse.jetty.util.component.ContainerLifeCycle.doStop(ContainerLifeCycle.java:162) at org.eclipse.jetty.server.handler.AbstractHandler.doStop(AbstractHandler.java:73) at org.eclipse.jetty.security.SecurityHandler.doStop(SecurityHandler.java:411) at org.eclipse.jetty.security.ConstraintSecurityHandler.doStop(ConstraintSecurityHandler.java:457) at org.eclipse.jetty.util.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:89) at org.eclipse.jetty.util.component.ContainerLifeCycle.stop(ContainerLifeCycle.java:143) at org.eclipse.jetty.util.component.ContainerLifeCycle.doStop(ContainerLifeCycle.java:162) at org.eclipse.jetty.server.handler.AbstractHandler.doStop(AbstractHandler.java:73) at org.eclipse.jetty.server.session.SessionHandler.doStop(SessionHandler.java:127) at org.eclipse.jetty.util.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:89) at org.eclipse.jetty.util.component.ContainerLifeCycle.stop(ContainerLifeCycle.java:143) at org.eclipse.jetty.util.component.ContainerLifeCycle.doStop(ContainerLifeCycle.java:162) at org.eclipse.jetty.server.handler.AbstractHandler.doStop(AbstractHandler.java:73) at org.eclipse.jetty.server.handler.ContextHandler.doStop(ContextHandler.java:833) at org.eclipse.jetty.servlet.ServletContextHandler.doStop(ServletContextHandler.java:215) at org.eclipse.jetty.util.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:89) at org.eclipse.jetty.util.component.ContainerLifeCycle.stop(ContainerLifeCycle.java:143) at org.eclipse.jetty.util.component.ContainerLifeCycle.doStop(ContainerLifeCycle.java:162) at org.eclipse.jetty.server.handler.AbstractHandler.doStop(AbstractHandler.java:73) at org.eclipse.jetty.server.Server.doStop(Server.java:456) at org.eclipse.jetty.util.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:89) at com.example.server.ExampleServer.stopServer(ExampleServer.java:269) at com.example.server.ExampleServer.stop(ExampleServer.java:279)INFO (ContextHandler) [2014-11-06 00:49:24 990] - org.eclipse.jetty.server.handler.ContextHandler.doStop(ContextHandler.java:863): Stopped o.e.j.s.ServletContextHandler@63f259c3{/ null UNAVAILABLE},0,0
It is impossible to determine the form submitting component's inputName when AjaxFormSubmitBehavior is used,It is impossible to determine inputName in Form.delegateSubmit method (was working in version 1.4)as per Martin's comment from this thread: http://markmail.org/message/eiji4elt4mitf2m5I see a way to simplify this code so it will be possible to do what youneed:1) AjaxFormSubmitBehavior should implement IFormSubmitter2) onEvent() should do: getForm().getRootForm().onFormSubmitted(this)then you can cast to AbstractAjaxBehavior and call getComponent() and thencast to IFormSubmittingComponent to get the input nameI'm not sure whether clirr-maven-plugin will allow this change in 6.x thoughPlease file a ticket and I'll take a look in the next days.,0,0
Support  src attribute by Link (TextTemplateLink),The Link class has support for the href proper elements and elements for generating an onclick handler. For the TextTemplateLInk this is not enough  as binding it to a &lt;script&gt; tag results in an onclick handler. As in the &lt;head&gt; tag it is impossible to click on anything  this doesn't work.,0,0
